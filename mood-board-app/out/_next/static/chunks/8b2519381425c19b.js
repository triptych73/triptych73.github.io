(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67034,(e,t,r)=>{var n={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,s=l(e),a=s[0],o=s[1],u=new i((a+o)*3/4-o),h=0,c=o>0?a-4:a;for(r=0;r<c;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[h++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],a=0,o=n-i;a<o;a+=16383)s.push(function(e,t,n){for(var i,s=[],a=t;a<n;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[i>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&s.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),s.join("")};for(var r=[],n=[],i="u">typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)r[a]=s[a],n[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n[45]=62,n[95]=63},72:function(e,t,r){"use strict";var n=r(675),i=r(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var n=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(n,i),l=a(s),u=l.write(n,i);return u!==s&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(A(e,ArrayBuffer)||e&&A(e.buffer,ArrayBuffer)||"u">typeof SharedArrayBuffer&&(A(e,SharedArrayBuffer)||e&&A(e.buffer,SharedArrayBuffer)))return function(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),n}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return o.from(h,t,r);var g=function(e){if(o.isBuffer(e)){var t=0|d(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(g)return g;if("u">typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),!o.TYPED_ARRAY_SUPPORT&&"u">typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return h(e)},o.allocUnsafeSlow=function(e){return h(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||A(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return S(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return k(e).length;default:if(i)return n?-1:S(e).length;t=(""+t).toLowerCase(),i=!0}}function g(e,t,r){var i,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=D[e[s]];return i}(this,t,r);case"utf8":case"utf-8":return v(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return i=this,s=t,a=r,0===s&&a===i.length?n.fromByteArray(i):n.fromByteArray(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function p(e,t,r,n,i){var s;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(s=r*=1)!=s&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return y(e,[t],r,n,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var s,a=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var h=-1;for(s=r;s<o;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*a}else -1!==h&&(s-=s-h),h=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){c=!1;break}if(c)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(A(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),A(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(A(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?v(this,0,e):g.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,i){if(A(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var s=i-n,a=r-t,l=Math.min(s,a),u=this.slice(n,i),h=e.slice(t,r),c=0;c<l;++c)if(u[c]!==h[c]){s=u[c],a=h[c];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return p(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return p(this,e,t,r,!1)};function v(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,a,o,l,u=e[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=r)switch(c){case 1:u<128&&(h=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=c}var d=n,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var g="",m=0;m<f;)g+=String.fromCharCode.apply(String,d.slice(m,m+=4096));return g}function w(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function b(e,t,r,n,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function x(e,t,r,n,i,s){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function E(e,t,r,n,s){return t*=1,r>>>=0,s||x(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function I(e,t,r,n,s){return t*=1,r>>>=0,s||x(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,h,c,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var f=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return i=t,s=r,C(S(e,this.length-i),this,i,s);case"ascii":return a=t,o=r,C(_(e),this,a,o);case"latin1":case"binary":return function(e,t,r,n){return C(_(t),e,r,n)}(this,e,t,r);case"base64":return l=t,u=r,C(k(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=r,C(function(e,t){for(var r,n,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||w(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=1,a=0;for(this[t]=255&e;++a<r&&(s*=256);)this[t+a]=e/s&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=r-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return E(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return E(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return I(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return I(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var s=i-1;s>=0;--s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,n),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%l]}return this};var T=/[^+/0-9A-Za-z-_]/g;function S(e,t){t=t||1/0;for(var r,n=e.length,i=null,s=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function _(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function k(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(T,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function C(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function A(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var D=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},783:function(e,t){t.read=function(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,u=l>>1,h=-7,c=r?i-1:0,d=r?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=n;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=u}return(f?-1:1)*a*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=5960464477539062e-23*(23===i),f=n?0:s-1,g=n?1:-1,m=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&o,f+=g,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[r+f]=255&a,f+=g,a/=256,u-=8);e[r+f-g]|=128*m}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}},a=!0;try{n[e](r,r.exports,s),a=!1}finally{a&&delete i[e]}return r.exports}s.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},52683,e=>{"use strict";let t,r;var n,i,s,a,o,l,u,h,c,d,f,g,m,p,y,v,w,b,x,E,I,T,S,_,k,C,A,D,N,M,R,O,L,P=e.i(43476),F=e.i(71645),V=e.i(74080);let B="u">typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function U(e){let t=Object.prototype.toString.call(e);return"[object Window]"===t||"[object global]"===t}function j(e){return"nodeType"in e}function q(e){var t,r;return e?U(e)?e:j(e)&&null!=(t=null==(r=e.ownerDocument)?void 0:r.defaultView)?t:window:window}function z(e){let{Document:t}=q(e);return e instanceof t}function K(e){return!U(e)&&e instanceof q(e).HTMLElement}function G(e){return e instanceof q(e).SVGElement}function $(e){return e?U(e)?e.document:j(e)?z(e)?e:K(e)||G(e)?e.ownerDocument:document:document:document}let Q=B?F.useLayoutEffect:F.useEffect;function H(e){let t=(0,F.useRef)(e);return Q(()=>{t.current=e}),(0,F.useCallback)(function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return null==t.current?void 0:t.current(...r)},[])}function W(e,t){void 0===t&&(t=[e]);let r=(0,F.useRef)(e);return Q(()=>{r.current!==e&&(r.current=e)},t),r}function J(e,t){let r=(0,F.useRef)();return(0,F.useMemo)(()=>{let t=e(r.current);return r.current=t,t},[...t])}function Y(e){let t=H(e),r=(0,F.useRef)(null),n=(0,F.useCallback)(e=>{e!==r.current&&(null==t||t(e,r.current)),r.current=e},[]);return[r,n]}function X(e){let t=(0,F.useRef)();return(0,F.useEffect)(()=>{t.current=e},[e]),t.current}let Z={};function ee(e,t){return(0,F.useMemo)(()=>{if(t)return t;let r=null==Z[e]?0:Z[e]+1;return Z[e]=r,e+"-"+r},[e,t])}function et(e){return function(t){for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return n.reduce((t,r)=>{for(let[n,i]of Object.entries(r)){let r=t[n];null!=r&&(t[n]=r+e*i)}return t},{...t})}}let er=et(1),en=et(-1);function ei(e){if(!e)return!1;let{KeyboardEvent:t}=q(e.target);return t&&e instanceof t}function es(e){if(function(e){if(!e)return!1;let{TouchEvent:t}=q(e.target);return t&&e instanceof t}(e)){if(e.touches&&e.touches.length){let{clientX:t,clientY:r}=e.touches[0];return{x:t,y:r}}else if(e.changedTouches&&e.changedTouches.length){let{clientX:t,clientY:r}=e.changedTouches[0];return{x:t,y:r}}}return"clientX"in e&&"clientY"in e?{x:e.clientX,y:e.clientY}:null}let ea=Object.freeze({Translate:{toString(e){if(!e)return;let{x:t,y:r}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;let{scaleX:t,scaleY:r}=e;return"scaleX("+t+") scaleY("+r+")"}},Transform:{toString(e){if(e)return[ea.Translate.toString(e),ea.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:r,easing:n}=e;return t+" "+r+"ms "+n}}}),eo="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]",el={display:"none"};function eu(e){let{id:t,value:r}=e;return F.default.createElement("div",{id:t,style:el},r)}function eh(e){let{id:t,announcement:r,ariaLiveType:n="assertive"}=e;return F.default.createElement("div",{id:t,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":n,"aria-atomic":!0},r)}let ec=(0,F.createContext)(null),ed={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},ef={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:r}=e;return r?"Draggable item "+t.id+" was moved over droppable area "+r.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:r}=e;return r?"Draggable item "+t.id+" was dropped over droppable area "+r.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function eg(e){var t;let r,{announcements:n=ef,container:i,hiddenTextDescribedById:s,screenReaderInstructions:a=ed}=e,{announce:o,announcement:l}=function(){let[e,t]=(0,F.useState)("");return{announce:(0,F.useCallback)(e=>{null!=e&&t(e)},[]),announcement:e}}(),u=ee("DndLiveRegion"),[h,c]=(0,F.useState)(!1);if((0,F.useEffect)(()=>{c(!0)},[]),t=(0,F.useMemo)(()=>({onDragStart(e){let{active:t}=e;o(n.onDragStart({active:t}))},onDragMove(e){let{active:t,over:r}=e;n.onDragMove&&o(n.onDragMove({active:t,over:r}))},onDragOver(e){let{active:t,over:r}=e;o(n.onDragOver({active:t,over:r}))},onDragEnd(e){let{active:t,over:r}=e;o(n.onDragEnd({active:t,over:r}))},onDragCancel(e){let{active:t,over:r}=e;o(n.onDragCancel({active:t,over:r}))}}),[o,n]),r=(0,F.useContext)(ec),(0,F.useEffect)(()=>{if(!r)throw Error("useDndMonitor must be used within a children of <DndContext>");return r(t)},[t,r]),!h)return null;let d=F.default.createElement(F.default.Fragment,null,F.default.createElement(eu,{id:s,value:a.draggable}),F.default.createElement(eh,{id:u,announcement:l}));return i?(0,V.createPortal)(d,i):d}function em(){}(n=d||(d={})).DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable";let ep=Object.freeze({x:0,y:0});function ey(e,t){let{data:{value:r}}=e,{data:{value:n}}=t;return n-r}let ev=e=>{let{collisionRect:t,droppableRects:r,droppableContainers:n}=e,i=[];for(let e of n){let{id:n}=e,s=r.get(n);if(s){let r=function(e,t){let r=Math.max(t.top,e.top),n=Math.max(t.left,e.left),i=Math.min(t.left+t.width,e.left+e.width),s=Math.min(t.top+t.height,e.top+e.height);if(n<i&&r<s){let a=t.width*t.height,o=e.width*e.height,l=(i-n)*(s-r);return Number((l/(a+o-l)).toFixed(4))}return 0}(s,t);r>0&&i.push({id:n,data:{droppableContainer:e,value:r}})}}return i.sort(ey)};function ew(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:ep}let eb=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.reduce((e,t)=>({...e,top:e.top+ +t.y,bottom:e.bottom+ +t.y,left:e.left+ +t.x,right:e.right+ +t.x}),{...e})};function ex(e){if(e.startsWith("matrix3d(")){let t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}if(e.startsWith("matrix(")){let t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}let eE={ignoreTransform:!1};function eI(e,t){void 0===t&&(t=eE);let r=e.getBoundingClientRect();if(t.ignoreTransform){let{transform:t,transformOrigin:n}=q(e).getComputedStyle(e);t&&(r=function(e,t,r){let n=ex(t);if(!n)return e;let{scaleX:i,scaleY:s,x:a,y:o}=n,l=e.left-a-(1-i)*parseFloat(r),u=e.top-o-(1-s)*parseFloat(r.slice(r.indexOf(" ")+1)),h=i?e.width/i:e.width,c=s?e.height/s:e.height;return{width:h,height:c,top:u,right:l+h,bottom:u+c,left:l}}(r,t,n))}let{top:n,left:i,width:s,height:a,bottom:o,right:l}=r;return{top:n,left:i,width:s,height:a,bottom:o,right:l}}function eT(e){return eI(e,{ignoreTransform:!0})}function eS(e,t){let r=[];return e?function n(i){var s,a;let o;if(null!=t&&r.length>=t||!i)return r;if(z(i)&&null!=i.scrollingElement&&!r.includes(i.scrollingElement))return r.push(i.scrollingElement),r;if(!K(i)||G(i)||r.includes(i))return r;let l=q(e).getComputedStyle(i);return(i!==e&&(void 0===(s=l)&&(s=q(i).getComputedStyle(i)),o=/(auto|scroll|overlay)/,["overflow","overflowX","overflowY"].some(e=>{let t=s[e];return"string"==typeof t&&o.test(t)}))&&r.push(i),void 0===(a=l)&&(a=q(i).getComputedStyle(i)),"fixed"===a.position)?r:n(i.parentNode)}(e):r}function e_(e){let[t]=eS(e,1);return null!=t?t:null}function ek(e){return B&&e?U(e)?e:j(e)?z(e)||e===$(e).scrollingElement?window:K(e)?e:null:null:null}function eC(e){return U(e)?e.scrollX:e.scrollLeft}function eA(e){return U(e)?e.scrollY:e.scrollTop}function eD(e){return{x:eC(e),y:eA(e)}}function eN(e){return!!B&&!!e&&e===document.scrollingElement}function eM(e){let t={x:0,y:0},r=eN(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},n={x:e.scrollWidth-r.width,y:e.scrollHeight-r.height},i=e.scrollTop<=t.y,s=e.scrollLeft<=t.x;return{isTop:i,isLeft:s,isBottom:e.scrollTop>=n.y,isRight:e.scrollLeft>=n.x,maxScroll:n,minScroll:t}}(i=f||(f={}))[i.Forward=1]="Forward",i[i.Backward=-1]="Backward";let eR={x:.2,y:.2};function eO(e){return e.reduce((e,t)=>er(e,eD(t)),ep)}function eL(e,t){if(void 0===t&&(t=eI),!e)return;let{top:r,left:n,bottom:i,right:s}=t(e);e_(e)&&(i<=0||s<=0||r>=window.innerHeight||n>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}let eP=[["x",["left","right"],function(e){return e.reduce((e,t)=>e+eC(t),0)}],["y",["top","bottom"],function(e){return e.reduce((e,t)=>e+eA(t),0)}]];class eF{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=eS(t),n=eO(r);for(const[t,i,s]of(this.rect={...e},this.width=e.width,this.height=e.height,eP))for(const e of i)Object.defineProperty(this,e,{get:()=>{let i=s(r),a=n[t]-i;return this.rect[e]+a},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class eV{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var t;return null==(t=this.target)?void 0:t.removeEventListener(...e)})},this.target=e}add(e,t,r){var n;null==(n=this.target)||n.addEventListener(e,t,r),this.listeners.push([e,t,r])}}function eB(e,t){let r=Math.abs(e.x),n=Math.abs(e.y);return"number"==typeof t?Math.sqrt(r**2+n**2)>t:"x"in t&&"y"in t?r>t.x&&n>t.y:"x"in t?r>t.x:"y"in t&&n>t.y}function eU(e){e.preventDefault()}function ej(e){e.stopPropagation()}(s=g||(g={})).Click="click",s.DragStart="dragstart",s.Keydown="keydown",s.ContextMenu="contextmenu",s.Resize="resize",s.SelectionChange="selectionchange",s.VisibilityChange="visibilitychange",(a=m||(m={})).Space="Space",a.Down="ArrowDown",a.Right="ArrowRight",a.Left="ArrowLeft",a.Up="ArrowUp",a.Esc="Escape",a.Enter="Enter",a.Tab="Tab";let eq={start:[m.Space,m.Enter],cancel:[m.Esc],end:[m.Space,m.Enter,m.Tab]},ez=(e,t)=>{let{currentCoordinates:r}=t;switch(e.code){case m.Right:return{...r,x:r.x+25};case m.Left:return{...r,x:r.x-25};case m.Down:return{...r,y:r.y+25};case m.Up:return{...r,y:r.y-25}}};class eK{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new eV($(t)),this.windowListeners=new eV(q(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(g.Resize,this.handleCancel),this.windowListeners.add(g.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(g.Keydown,this.handleKeyDown))}handleStart(){let{activeNode:e,onStart:t}=this.props,r=e.node.current;r&&eL(r),t(ep)}handleKeyDown(e){if(ei(e)){let{active:t,context:r,options:n}=this.props,{keyboardCodes:i=eq,coordinateGetter:s=ez,scrollBehavior:a="smooth"}=n,{code:o}=e;if(i.end.includes(o))return void this.handleEnd(e);if(i.cancel.includes(o))return void this.handleCancel(e);let{collisionRect:l}=r.current,u=l?{x:l.left,y:l.top}:ep;this.referenceCoordinates||(this.referenceCoordinates=u);let h=s(e,{active:t,context:r.current,currentCoordinates:u});if(h){let t=en(h,u),n={x:0,y:0},{scrollableAncestors:i}=r.current;for(let r of i){let i=e.code,{isTop:s,isRight:o,isLeft:l,isBottom:u,maxScroll:c,minScroll:d}=eM(r),f=function(e){if(e===document.scrollingElement){let{innerWidth:e,innerHeight:t}=window;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}let{top:t,left:r,right:n,bottom:i}=e.getBoundingClientRect();return{top:t,left:r,right:n,bottom:i,width:e.clientWidth,height:e.clientHeight}}(r),g={x:Math.min(i===m.Right?f.right-f.width/2:f.right,Math.max(i===m.Right?f.left:f.left+f.width/2,h.x)),y:Math.min(i===m.Down?f.bottom-f.height/2:f.bottom,Math.max(i===m.Down?f.top:f.top+f.height/2,h.y))},p=i===m.Right&&!o||i===m.Left&&!l,y=i===m.Down&&!u||i===m.Up&&!s;if(p&&g.x!==h.x){let e=r.scrollLeft+t.x,s=i===m.Right&&e<=c.x||i===m.Left&&e>=d.x;if(s&&!t.y)return void r.scrollTo({left:e,behavior:a});s?n.x=r.scrollLeft-e:n.x=i===m.Right?r.scrollLeft-c.x:r.scrollLeft-d.x,n.x&&r.scrollBy({left:-n.x,behavior:a});break}if(y&&g.y!==h.y){let e=r.scrollTop+t.y,s=i===m.Down&&e<=c.y||i===m.Up&&e>=d.y;if(s&&!t.x)return void r.scrollTo({top:e,behavior:a});s?n.y=r.scrollTop-e:n.y=i===m.Down?r.scrollTop-c.y:r.scrollTop-d.y,n.y&&r.scrollBy({top:-n.y,behavior:a});break}}this.handleMove(e,er(en(h,this.referenceCoordinates),n))}}}handleMove(e,t){let{onMove:r}=this.props;e.preventDefault(),r(t)}handleEnd(e){let{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){let{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function eG(e){return!!(e&&"distance"in e)}function e$(e){return!!(e&&"delay"in e)}eK.activators=[{eventName:"onKeyDown",handler:(e,t,r)=>{let{keyboardCodes:n=eq,onActivation:i}=t,{active:s}=r,{code:a}=e.nativeEvent;if(n.start.includes(a)){let t=s.activatorNode.current;return(!t||e.target===t)&&(e.preventDefault(),null==i||i({event:e.nativeEvent}),!0)}return!1}}];class eQ{constructor(e,t,r){var n;void 0===r&&(r=function(e){let{EventTarget:t}=q(e);return e instanceof t?e:$(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:i}=e,{target:s}=i;this.props=e,this.events=t,this.document=$(s),this.documentListeners=new eV(this.document),this.listeners=new eV(r),this.windowListeners=new eV(q(s)),this.initialCoordinates=null!=(n=es(i))?n:ep,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){let{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:r}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(g.Resize,this.handleCancel),this.windowListeners.add(g.DragStart,eU),this.windowListeners.add(g.VisibilityChange,this.handleCancel),this.windowListeners.add(g.ContextMenu,eU),this.documentListeners.add(g.Keydown,this.handleKeydown),t){if(null!=r&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(e$(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(eG(t))return void this.handlePending(t)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){let{active:r,onPending:n}=this.props;n(r,e,this.initialCoordinates,t)}handleStart(){let{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(g.Click,ej,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(g.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;let{activated:r,initialCoordinates:n,props:i}=this,{onMove:s,options:{activationConstraint:a}}=i;if(!n)return;let o=null!=(t=es(e))?t:ep,l=en(n,o);if(!r&&a){if(eG(a)){if(null!=a.tolerance&&eB(l,a.tolerance))return this.handleCancel();if(eB(l,a.distance))return this.handleStart()}return e$(a)&&eB(l,a.tolerance)?this.handleCancel():void this.handlePending(a,l)}e.cancelable&&e.preventDefault(),s(o)}handleEnd(){let{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){let{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===m.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}let eH={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class eW extends eQ{constructor(e){const{event:t}=e;super(e,eH,$(t.target))}}eW.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:r}=e,{onActivation:n}=t;return!!r.isPrimary&&0===r.button&&(null==n||n({event:r}),!0)}}];(o=p||(p={}))[o.RightClick=2]="RightClick";(l=y||(y={}))[l.Pointer=0]="Pointer",l[l.DraggableRect=1]="DraggableRect",(u=v||(v={}))[u.TreeOrder=0]="TreeOrder",u[u.ReversedTreeOrder=1]="ReversedTreeOrder";let eJ={x:{[f.Backward]:!1,[f.Forward]:!1},y:{[f.Backward]:!1,[f.Forward]:!1}};(h=w||(w={}))[h.Always=0]="Always",h[h.BeforeDragging=1]="BeforeDragging",h[h.WhileDragging=2]="WhileDragging",(b||(b={})).Optimized="optimized";let eY=new Map;function eX(e,t){return J(r=>e?r||("function"==typeof t?t(e):e):null,[t,e])}function eZ(e){let{callback:t,disabled:r}=e,n=H(t),i=(0,F.useMemo)(()=>{if(r||"u"<typeof window||void 0===window.ResizeObserver)return;let{ResizeObserver:e}=window;return new e(n)},[r]);return(0,F.useEffect)(()=>()=>null==i?void 0:i.disconnect(),[i]),i}function e0(e){return new eF(eI(e),e)}function e1(e,t,r){void 0===t&&(t=e0);let[n,i]=(0,F.useState)(null);function s(){i(n=>{if(!e)return null;if(!1===e.isConnected){var i;return null!=(i=null!=n?n:r)?i:null}let s=t(e);return JSON.stringify(n)===JSON.stringify(s)?n:s})}let a=function(e){let{callback:t,disabled:r}=e,n=H(t),i=(0,F.useMemo)(()=>{if(r||"u"<typeof window||void 0===window.MutationObserver)return;let{MutationObserver:e}=window;return new e(n)},[n,r]);return(0,F.useEffect)(()=>()=>null==i?void 0:i.disconnect(),[i]),i}({callback(t){if(e)for(let r of t){let{type:t,target:n}=r;if("childList"===t&&n instanceof HTMLElement&&n.contains(e)){s();break}}}}),o=eZ({callback:s});return Q(()=>{s(),e?(null==o||o.observe(e),null==a||a.observe(document.body,{childList:!0,subtree:!0})):(null==o||o.disconnect(),null==a||a.disconnect())},[e]),n}let e2=[];function e5(e,t){void 0===t&&(t=[]);let r=(0,F.useRef)(null);return(0,F.useEffect)(()=>{r.current=null},t),(0,F.useEffect)(()=>{let t=e!==ep;t&&!r.current&&(r.current=e),!t&&r.current&&(r.current=null)},[e]),r.current?en(e,r.current):ep}function e6(e){return(0,F.useMemo)(()=>{let t,r;return e?(t=e.innerWidth,{top:0,left:0,right:t,bottom:r=e.innerHeight,width:t,height:r}):null},[e])}let e3=[];function e8(e){if(!e)return null;if(e.children.length>1)return e;let t=e.children[0];return K(t)?t:e}let e4=[{sensor:eW,options:{}},{sensor:eK,options:{}}],e7={current:{}},e9={draggable:{measure:eT},droppable:{measure:eT,strategy:w.WhileDragging,frequency:b.Optimized},dragOverlay:{measure:eI}};class te extends Map{get(e){var t;return null!=e&&null!=(t=super.get(e))?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,r;return null!=(t=null==(r=this.get(e))?void 0:r.node.current)?t:void 0}}let tt={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new te,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:em},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:e9,measureDroppableContainers:em,windowRect:null,measuringScheduled:!1},tr={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:em,draggableNodes:new Map,over:null,measureDroppableContainers:em},tn=(0,F.createContext)(tr),ti=(0,F.createContext)(tt);function ts(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new te}}}function ta(e,t){switch(t.type){case d.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case d.DragMove:if(null==e.draggable.active)return e;return{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case d.DragEnd:case d.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case d.RegisterDroppable:{let{element:r}=t,{id:n}=r,i=new te(e.droppable.containers);return i.set(n,r),{...e,droppable:{...e.droppable,containers:i}}}case d.SetDroppableDisabled:{let{id:r,key:n,disabled:i}=t,s=e.droppable.containers.get(r);if(!s||n!==s.key)return e;let a=new te(e.droppable.containers);return a.set(r,{...s,disabled:i}),{...e,droppable:{...e.droppable,containers:a}}}case d.UnregisterDroppable:{let{id:r,key:n}=t,i=e.droppable.containers.get(r);if(!i||n!==i.key)return e;let s=new te(e.droppable.containers);return s.delete(r),{...e,droppable:{...e.droppable,containers:s}}}default:return e}}function to(e){let{disabled:t}=e,{active:r,activatorEvent:n,draggableNodes:i}=(0,F.useContext)(tn),s=X(n),a=X(null==r?void 0:r.id);return(0,F.useEffect)(()=>{if(!t&&!n&&s&&null!=a){if(!ei(s)||document.activeElement===s.target)return;let e=i.get(a);if(!e)return;let{activatorNode:t,node:r}=e;(t.current||r.current)&&requestAnimationFrame(()=>{for(let e of[t.current,r.current]){if(!e)continue;let t=e.matches(eo)?e:e.querySelector(eo);if(t){t.focus();break}}})}},[n,t,i,a,s]),null}function tl(e,t){let{transform:r,...n}=t;return null!=e&&e.length?e.reduce((e,t)=>t({transform:e,...n}),r):r}let tu=(0,F.createContext)({...ep,scaleX:1,scaleY:1});(c=x||(x={}))[c.Uninitialized=0]="Uninitialized",c[c.Initializing=1]="Initializing",c[c.Initialized=2]="Initialized";let th=(0,F.memo)(function(e){var t,r,n,i,s,a,o,l;let u,h,c,g,m,p,b,E,{id:I,accessibility:T,autoScroll:S=!0,children:_,sensors:k=e4,collisionDetection:C=ev,measuring:A,modifiers:D,...N}=e,[M,R]=(0,F.useReducer)(ta,void 0,ts),[O,L]=function(){let[e]=(0,F.useState)(()=>new Set),t=(0,F.useCallback)(t=>(e.add(t),()=>e.delete(t)),[e]);return[(0,F.useCallback)(t=>{let{type:r,event:n}=t;e.forEach(e=>{var t;return null==(t=e[r])?void 0:t.call(e,n)})},[e]),t]}(),[P,U]=(0,F.useState)(x.Uninitialized),j=P===x.Initialized,{draggable:{active:z,nodes:G,translate:$},droppable:{containers:H}}=M,Z=null!=z?G.get(z):null,et=(0,F.useRef)({initial:null,translated:null}),en=(0,F.useMemo)(()=>{var e;return null!=z?{id:z,data:null!=(e=null==Z?void 0:Z.data)?e:e7,rect:et}:null},[z,Z]),ei=(0,F.useRef)(null),[ea,eo]=(0,F.useState)(null),[el,eu]=(0,F.useState)(null),eh=W(N,Object.values(N)),ed=ee("DndDescribedBy",I),ef=(0,F.useMemo)(()=>H.getEnabled(),[H]),em=(0,F.useMemo)(()=>({draggable:{...e9.draggable,...null==A?void 0:A.draggable},droppable:{...e9.droppable,...null==A?void 0:A.droppable},dragOverlay:{...e9.dragOverlay,...null==A?void 0:A.dragOverlay}}),[null==A?void 0:A.draggable,null==A?void 0:A.droppable,null==A?void 0:A.dragOverlay]),{droppableRects:ey,measureDroppableContainers:ex,measuringScheduled:eE}=function(e,t){let{dragging:r,dependencies:n,config:i}=t,[s,a]=(0,F.useState)(null),{frequency:o,measure:l,strategy:u}=i,h=(0,F.useRef)(e),c=function(){switch(u){case w.Always:return!1;case w.BeforeDragging:return r;default:return!r}}(),d=W(c),f=(0,F.useCallback)(function(e){void 0===e&&(e=[]),d.current||a(t=>null===t?e:t.concat(e.filter(e=>!t.includes(e))))},[d]),g=(0,F.useRef)(null),m=J(t=>{if(c&&!r)return eY;if(!t||t===eY||h.current!==e||null!=s){let t=new Map;for(let r of e){if(!r)continue;if(s&&s.length>0&&!s.includes(r.id)&&r.rect.current){t.set(r.id,r.rect.current);continue}let e=r.node.current,n=e?new eF(l(e),e):null;r.rect.current=n,n&&t.set(r.id,n)}return t}return t},[e,s,r,c,l]);return(0,F.useEffect)(()=>{h.current=e},[e]),(0,F.useEffect)(()=>{c||f()},[r,c]),(0,F.useEffect)(()=>{s&&s.length>0&&a(null)},[JSON.stringify(s)]),(0,F.useEffect)(()=>{c||"number"!=typeof o||null!==g.current||(g.current=setTimeout(()=>{f(),g.current=null},o))},[o,c,f,...n]),{droppableRects:m,measureDroppableContainers:f,measuringScheduled:null!=s}}(ef,{dragging:j,dependencies:[$.x,$.y],config:em.droppable}),eT=J(e=>{var t;return null==z?null:null!=(t=null!=m?m:e)?t:null},[m=(g=null!=z?G.get(z):void 0)?g.node.current:null,z]),eC=(0,F.useMemo)(()=>el?es(el):null,[el]),eA=(u=(null==ea?void 0:ea.autoScrollEnabled)===!1,h="object"==typeof S?!1===S.enabled:!1===S,c=j&&!u&&!h,"object"==typeof S?{...S,enabled:c}:{enabled:c}),eL=eX(eT,em.draggable.measure);!function(e){let{activeNode:t,measure:r,initialRect:n,config:i=!0}=e,s=(0,F.useRef)(!1),{x:a,y:o}="boolean"==typeof i?{x:i,y:i}:i;Q(()=>{if(!a&&!o||!t){s.current=!1;return}if(s.current||!n)return;let e=null==t?void 0:t.node.current;if(!e||!1===e.isConnected)return;let i=ew(r(e),n);if(a||(i.x=0),o||(i.y=0),s.current=!0,Math.abs(i.x)>0||Math.abs(i.y)>0){let t=e_(e);t&&t.scrollBy({top:i.y,left:i.x})}},[t,a,o,n,r])}({activeNode:null!=z?G.get(z):null,config:eA.layoutShiftCompensation,initialRect:eL,measure:em.draggable.measure});let eP=e1(eT,em.draggable.measure,eL),eV=e1(eT?eT.parentElement:null),eB=(0,F.useRef)({activatorEvent:null,active:null,activeNode:eT,collisionRect:null,collisions:null,droppableRects:ey,draggableNodes:G,draggingNode:null,draggingNodeRect:null,droppableContainers:H,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),eU=H.getNodeFor(null==(t=eB.current.over)?void 0:t.id),ej=function(e){let{measure:t}=e,[r,n]=(0,F.useState)(null),i=eZ({callback:(0,F.useCallback)(e=>{for(let{target:r}of e)if(K(r)){n(e=>{let n=t(r);return e?{...e,width:n.width,height:n.height}:n});break}},[t])}),[s,a]=Y((0,F.useCallback)(e=>{let r=e8(e);null==i||i.disconnect(),r&&(null==i||i.observe(r)),n(r?t(r):null)},[t,i]));return(0,F.useMemo)(()=>({nodeRef:s,rect:r,setRef:a}),[r,s,a])}({measure:em.dragOverlay.measure}),eq=null!=(r=ej.nodeRef.current)?r:eT,ez=j?null!=(n=ej.rect)?n:eP:null,eK=!!(ej.nodeRef.current&&ej.rect),eG=(p=eX(s=eK?null:eP),ew(s,p)),e$=e6(eq?q(eq):null),eQ=(a=j?null!=eU?eU:eT:null,b=(0,F.useRef)(a),E=J(e=>a?e&&e!==e2&&a&&b.current&&a.parentNode===b.current.parentNode?e:eS(a):e2,[a]),(0,F.useEffect)(()=>{b.current=a},[a]),E),eH=function(e,t){void 0===t&&(t=eI);let[r]=e,n=e6(r?q(r):null),[i,s]=(0,F.useState)(e3);function a(){s(()=>e.length?e.map(e=>eN(e)?n:new eF(t(e),e)):e3)}let o=eZ({callback:a});return Q(()=>{null==o||o.disconnect(),a(),e.forEach(e=>null==o?void 0:o.observe(e))},[e]),i}(eQ),eW=tl(D,{transform:{x:$.x-eG.x,y:$.y-eG.y,scaleX:1,scaleY:1},activatorEvent:el,active:en,activeNodeRect:eP,containerNodeRect:eV,draggingNodeRect:ez,over:eB.current.over,overlayNodeRect:ej.rect,scrollableAncestors:eQ,scrollableAncestorRects:eH,windowRect:e$}),e0=eC?er(eC,$):null,te=function(e){let[t,r]=(0,F.useState)(null),n=(0,F.useRef)(e),i=(0,F.useCallback)(e=>{let t=ek(e.target);t&&r(e=>e?(e.set(t,eD(t)),new Map(e)):null)},[]);return(0,F.useEffect)(()=>{let t=n.current;if(e!==t){s(t);let a=e.map(e=>{let t=ek(e);return t?(t.addEventListener("scroll",i,{passive:!0}),[t,eD(t)]):null}).filter(e=>null!=e);r(a.length?new Map(a):null),n.current=e}return()=>{s(e),s(t)};function s(e){e.forEach(e=>{let t=ek(e);null==t||t.removeEventListener("scroll",i)})}},[i,e]),(0,F.useMemo)(()=>e.length?t?Array.from(t.values()).reduce((e,t)=>er(e,t),ep):eO(e):ep,[e,t])}(eQ),tt=e5(te),tr=e5(te,[eP]),th=er(eW,tt),tc=ez?eb(ez,eW):null,td=en&&tc?C({active:en,collisionRect:tc,droppableRects:ey,droppableContainers:ef,pointerCoordinates:e0}):null,tf=function(e,t){if(!e||0===e.length)return null;let[r]=e;return r.id}(td,0),[tg,tm]=(0,F.useState)(null),tp=(o=eK?eW:er(eW,tr),l=null!=(i=null==tg?void 0:tg.rect)?i:null,{...o,scaleX:l&&eP?l.width/eP.width:1,scaleY:l&&eP?l.height/eP.height:1}),ty=(0,F.useRef)(null),tv=(0,F.useCallback)((e,t)=>{let{sensor:r,options:n}=t;if(null==ei.current)return;let i=G.get(ei.current);if(!i)return;let s=e.nativeEvent,a=new r({active:ei.current,activeNode:i,event:s,options:n,context:eB,onAbort(e){if(!G.get(e))return;let{onDragAbort:t}=eh.current,r={id:e};null==t||t(r),O({type:"onDragAbort",event:r})},onPending(e,t,r,n){if(!G.get(e))return;let{onDragPending:i}=eh.current,s={id:e,constraint:t,initialCoordinates:r,offset:n};null==i||i(s),O({type:"onDragPending",event:s})},onStart(e){let t=ei.current;if(null==t)return;let r=G.get(t);if(!r)return;let{onDragStart:n}=eh.current,i={activatorEvent:s,active:{id:t,data:r.data,rect:et}};(0,V.unstable_batchedUpdates)(()=>{null==n||n(i),U(x.Initializing),R({type:d.DragStart,initialCoordinates:e,active:t}),O({type:"onDragStart",event:i}),eo(ty.current),eu(s)})},onMove(e){R({type:d.DragMove,coordinates:e})},onEnd:o(d.DragEnd),onCancel:o(d.DragCancel)});function o(e){return async function(){let{active:t,collisions:r,over:n,scrollAdjustedTranslate:i}=eB.current,a=null;if(t&&i){let{cancelDrop:o}=eh.current;a={activatorEvent:s,active:t,collisions:r,delta:i,over:n},e===d.DragEnd&&"function"==typeof o&&await Promise.resolve(o(a))&&(e=d.DragCancel)}ei.current=null,(0,V.unstable_batchedUpdates)(()=>{R({type:e}),U(x.Uninitialized),tm(null),eo(null),eu(null),ty.current=null;let t=e===d.DragEnd?"onDragEnd":"onDragCancel";if(a){let e=eh.current[t];null==e||e(a),O({type:t,event:a})}})}}ty.current=a},[G]),tw=(0,F.useCallback)((e,t)=>(r,n)=>{let i=r.nativeEvent,s=G.get(n);null!==ei.current||!s||i.dndKit||i.defaultPrevented||!0===e(r,t.options,{active:s})&&(i.dndKit={capturedBy:t.sensor},ei.current=n,tv(r,t))},[G,tv]),tb=(0,F.useMemo)(()=>k.reduce((e,t)=>{let{sensor:r}=t;return[...e,...r.activators.map(e=>({eventName:e.eventName,handler:tw(e.handler,t)}))]},[]),[k,tw]);(0,F.useEffect)(()=>{if(!B)return;let e=k.map(e=>{let{sensor:t}=e;return null==t.setup?void 0:t.setup()});return()=>{for(let t of e)null==t||t()}},k.map(e=>{let{sensor:t}=e;return t})),Q(()=>{eP&&P===x.Initializing&&U(x.Initialized)},[eP,P]),(0,F.useEffect)(()=>{let{onDragMove:e}=eh.current,{active:t,activatorEvent:r,collisions:n,over:i}=eB.current;if(!t||!r)return;let s={active:t,activatorEvent:r,collisions:n,delta:{x:th.x,y:th.y},over:i};(0,V.unstable_batchedUpdates)(()=>{null==e||e(s),O({type:"onDragMove",event:s})})},[th.x,th.y]),(0,F.useEffect)(()=>{let{active:e,activatorEvent:t,collisions:r,droppableContainers:n,scrollAdjustedTranslate:i}=eB.current;if(!e||null==ei.current||!t||!i)return;let{onDragOver:s}=eh.current,a=n.get(tf),o=a&&a.rect.current?{id:a.id,rect:a.rect.current,data:a.data,disabled:a.disabled}:null,l={active:e,activatorEvent:t,collisions:r,delta:{x:i.x,y:i.y},over:o};(0,V.unstable_batchedUpdates)(()=>{tm(o),null==s||s(l),O({type:"onDragOver",event:l})})},[tf]),Q(()=>{eB.current={activatorEvent:el,active:en,activeNode:eT,collisionRect:tc,collisions:td,droppableRects:ey,draggableNodes:G,draggingNode:eq,draggingNodeRect:ez,droppableContainers:H,over:tg,scrollableAncestors:eQ,scrollAdjustedTranslate:th},et.current={initial:ez,translated:tc}},[en,eT,td,tc,G,eq,ez,ey,H,tg,eQ,th]),function(e){let t,{acceleration:r,activator:n=y.Pointer,canScroll:i,draggingRect:s,enabled:a,interval:o=5,order:l=v.TreeOrder,pointerCoordinates:u,scrollableAncestors:h,scrollableAncestorRects:c,delta:d,threshold:g}=e,m=function(e){let{delta:t,disabled:r}=e,n=X(t);return J(e=>{if(r||!n||!e)return eJ;let i={x:Math.sign(t.x-n.x),y:Math.sign(t.y-n.y)};return{x:{[f.Backward]:e.x[f.Backward]||-1===i.x,[f.Forward]:e.x[f.Forward]||1===i.x},y:{[f.Backward]:e.y[f.Backward]||-1===i.y,[f.Forward]:e.y[f.Forward]||1===i.y}}},[r,t,n])}({delta:d,disabled:!a}),[p,w]=(t=(0,F.useRef)(null),[(0,F.useCallback)((e,r)=>{t.current=setInterval(e,r)},[]),(0,F.useCallback)(()=>{null!==t.current&&(clearInterval(t.current),t.current=null)},[])]),b=(0,F.useRef)({x:0,y:0}),x=(0,F.useRef)({x:0,y:0}),E=(0,F.useMemo)(()=>{switch(n){case y.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case y.DraggableRect:return s}},[n,s,u]),I=(0,F.useRef)(null),T=(0,F.useCallback)(()=>{let e=I.current;if(!e)return;let t=b.current.x*x.current.x,r=b.current.y*x.current.y;e.scrollBy(t,r)},[]),S=(0,F.useMemo)(()=>l===v.TreeOrder?[...h].reverse():h,[l,h]);(0,F.useEffect)(()=>{if(!a||!h.length||!E)return void w();for(let e of S){if((null==i?void 0:i(e))===!1)continue;let t=c[h.indexOf(e)];if(!t)continue;let{direction:n,speed:s}=function(e,t,r,n,i){let{top:s,left:a,right:o,bottom:l}=r;void 0===n&&(n=10),void 0===i&&(i=eR);let{isTop:u,isBottom:h,isLeft:c,isRight:d}=eM(e),g={x:0,y:0},m={x:0,y:0},p={height:t.height*i.y,width:t.width*i.x};return!u&&s<=t.top+p.height?(g.y=f.Backward,m.y=n*Math.abs((t.top+p.height-s)/p.height)):!h&&l>=t.bottom-p.height&&(g.y=f.Forward,m.y=n*Math.abs((t.bottom-p.height-l)/p.height)),!d&&o>=t.right-p.width?(g.x=f.Forward,m.x=n*Math.abs((t.right-p.width-o)/p.width)):!c&&a<=t.left+p.width&&(g.x=f.Backward,m.x=n*Math.abs((t.left+p.width-a)/p.width)),{direction:g,speed:m}}(e,t,E,r,g);for(let e of["x","y"])m[e][n[e]]||(s[e]=0,n[e]=0);if(s.x>0||s.y>0){w(),I.current=e,p(T,o),b.current=s,x.current=n;return}}b.current={x:0,y:0},x.current={x:0,y:0},w()},[r,T,i,w,a,o,JSON.stringify(E),JSON.stringify(m),p,h,S,c,JSON.stringify(g)])}({...eA,delta:$,draggingRect:tc,pointerCoordinates:e0,scrollableAncestors:eQ,scrollableAncestorRects:eH});let tx=(0,F.useMemo)(()=>({active:en,activeNode:eT,activeNodeRect:eP,activatorEvent:el,collisions:td,containerNodeRect:eV,dragOverlay:ej,draggableNodes:G,droppableContainers:H,droppableRects:ey,over:tg,measureDroppableContainers:ex,scrollableAncestors:eQ,scrollableAncestorRects:eH,measuringConfiguration:em,measuringScheduled:eE,windowRect:e$}),[en,eT,eP,el,td,eV,ej,G,H,ey,tg,ex,eQ,eH,em,eE,e$]),tE=(0,F.useMemo)(()=>({activatorEvent:el,activators:tb,active:en,activeNodeRect:eP,ariaDescribedById:{draggable:ed},dispatch:R,draggableNodes:G,over:tg,measureDroppableContainers:ex}),[el,tb,en,eP,R,ed,G,tg,ex]);return F.default.createElement(ec.Provider,{value:L},F.default.createElement(tn.Provider,{value:tE},F.default.createElement(ti.Provider,{value:tx},F.default.createElement(tu.Provider,{value:tp},_)),F.default.createElement(to,{disabled:(null==T?void 0:T.restoreFocus)===!1})),F.default.createElement(eg,{...T,hiddenTextDescribedById:ed}))}),tc=(0,F.createContext)(null),td="button";function tf(e){let{id:t,data:r,disabled:n=!1,attributes:i}=e,s=ee("Draggable"),{activators:a,activatorEvent:o,active:l,activeNodeRect:u,ariaDescribedById:h,draggableNodes:c,over:d}=(0,F.useContext)(tn),{role:f=td,roleDescription:g="draggable",tabIndex:m=0}=null!=i?i:{},p=(null==l?void 0:l.id)===t,y=(0,F.useContext)(p?tu:tc),[v,w]=Y(),[b,x]=Y(),E=(0,F.useMemo)(()=>a.reduce((e,r)=>{let{eventName:n,handler:i}=r;return e[n]=e=>{i(e,t)},e},{}),[a,t]),I=W(r);return Q(()=>(c.set(t,{id:t,key:s,node:v,activatorNode:b,data:I}),()=>{let e=c.get(t);e&&e.key===s&&c.delete(t)}),[c,t]),{active:l,activatorEvent:o,activeNodeRect:u,attributes:(0,F.useMemo)(()=>({role:f,tabIndex:m,"aria-disabled":n,"aria-pressed":!!p&&f===td||void 0,"aria-roledescription":g,"aria-describedby":h.draggable}),[n,f,m,p,g,h.draggable]),isDragging:p,listeners:n?void 0:E,node:v,over:d,setNodeRef:w,setActivatorNodeRef:x,transform:y}}let tg={timeout:25};function tm(e){let{animation:t,children:r}=e,[n,i]=(0,F.useState)(null),[s,a]=(0,F.useState)(null),o=X(r);return r||n||!o||i(o),Q(()=>{if(!s)return;let e=null==n?void 0:n.key,r=null==n?void 0:n.props.id;null==e||null==r?i(null):Promise.resolve(t(r,s)).then(()=>{i(null)})},[t,n,s]),F.default.createElement(F.default.Fragment,null,r,n?(0,F.cloneElement)(n,{ref:a}):null)}let tp={x:0,y:0,scaleX:1,scaleY:1};function ty(e){let{children:t}=e;return F.default.createElement(tn.Provider,{value:tr},F.default.createElement(tu.Provider,{value:tp},t))}let tv={position:"fixed",touchAction:"none"},tw=e=>ei(e)?"transform 250ms ease":void 0,tb=(0,F.forwardRef)((e,t)=>{let{as:r,activatorEvent:n,adjustScale:i,children:s,className:a,rect:o,style:l,transform:u,transition:h=tw}=e;if(!o)return null;let c=i?u:{...u,scaleX:1,scaleY:1},d={...tv,width:o.width,height:o.height,top:o.top,left:o.left,transform:ea.Transform.toString(c),transformOrigin:i&&n?function(e,t){let r=es(e);if(!r)return"0 0";let n={x:(r.x-t.left)/t.width*100,y:(r.y-t.top)/t.height*100};return n.x+"% "+n.y+"%"}(n,o):void 0,transition:"function"==typeof h?h(n):h,...l};return F.default.createElement(r,{className:a,style:d,ref:t},s)}),tx={duration:250,easing:"ease",keyframes:e=>{let{transform:{initial:t,final:r}}=e;return[{transform:ea.Transform.toString(t)},{transform:ea.Transform.toString(r)}]},sideEffects:(t={styles:{active:{opacity:"0"}}},e=>{let{active:r,dragOverlay:n}=e,i={},{styles:s,className:a}=t;if(null!=s&&s.active)for(let[e,t]of Object.entries(s.active))void 0!==t&&(i[e]=r.node.style.getPropertyValue(e),r.node.style.setProperty(e,t));if(null!=s&&s.dragOverlay)for(let[e,t]of Object.entries(s.dragOverlay))void 0!==t&&n.node.style.setProperty(e,t);return null!=a&&a.active&&r.node.classList.add(a.active),null!=a&&a.dragOverlay&&n.node.classList.add(a.dragOverlay),function(){for(let[e,t]of Object.entries(i))r.node.style.setProperty(e,t);null!=a&&a.active&&r.node.classList.remove(a.active)}})},tE=0,tI=F.default.memo(e=>{var t;let{adjustScale:r=!1,children:n,dropAnimation:i,style:s,transition:a,modifiers:o,wrapperElement:l="div",className:u,zIndex:h=999}=e,{activatorEvent:c,active:d,activeNodeRect:f,containerNodeRect:g,draggableNodes:m,droppableContainers:p,dragOverlay:y,over:v,measuringConfiguration:w,scrollableAncestors:b,scrollableAncestorRects:x,windowRect:E}=(0,F.useContext)(ti),I=(0,F.useContext)(tu),T=(t=null==d?void 0:d.id,(0,F.useMemo)(()=>{if(null!=t)return++tE},[t])),S=tl(o,{activatorEvent:c,active:d,activeNodeRect:f,containerNodeRect:g,draggingNodeRect:y.rect,over:v,overlayNodeRect:y.rect,scrollableAncestors:b,scrollableAncestorRects:x,transform:I,windowRect:E}),_=eX(f),k=function(e){let{config:t,draggableNodes:r,droppableContainers:n,measuringConfiguration:i}=e;return H((e,s)=>{if(null===t)return;let a=r.get(e);if(!a)return;let o=a.node.current;if(!o)return;let l=e8(s);if(!l)return;let{transform:u}=q(s).getComputedStyle(s),h=ex(u);if(!h)return;let c="function"==typeof t?t:function(e){let{duration:t,easing:r,sideEffects:n,keyframes:i}={...tx,...e};return e=>{let{active:s,dragOverlay:a,transform:o,...l}=e;if(!t)return;let u={x:a.rect.left-s.rect.left,y:a.rect.top-s.rect.top},h={scaleX:1!==o.scaleX?s.rect.width*o.scaleX/a.rect.width:1,scaleY:1!==o.scaleY?s.rect.height*o.scaleY/a.rect.height:1},c={x:o.x-u.x,y:o.y-u.y,...h},d=i({...l,active:s,dragOverlay:a,transform:{initial:o,final:c}}),[f]=d,g=d[d.length-1];if(JSON.stringify(f)===JSON.stringify(g))return;let m=null==n?void 0:n({active:s,dragOverlay:a,...l}),p=a.node.animate(d,{duration:t,easing:r,fill:"forwards"});return new Promise(e=>{p.onfinish=()=>{null==m||m(),e()}})}}(t);return eL(o,i.draggable.measure),c({active:{id:e,data:a.data,node:o,rect:i.draggable.measure(o)},draggableNodes:r,dragOverlay:{node:s,rect:i.dragOverlay.measure(l)},droppableContainers:n,measuringConfiguration:i,transform:h})})}({config:i,draggableNodes:m,droppableContainers:p,measuringConfiguration:w}),C=_?y.setRef:void 0;return F.default.createElement(ty,null,F.default.createElement(tm,{animation:k},d&&T?F.default.createElement(tb,{key:T,id:d.id,ref:C,as:l,activatorEvent:c,adjustScale:r,className:u,transition:a,rect:_,style:{zIndex:h,...s},transform:S},n):null))}),tT=e=>{let t,r=new Set,n=(e,n)=>{let i="function"==typeof e?e(t):e;if(!Object.is(i,t)){let e=t;t=(null!=n?n:"object"!=typeof i||null===i)?i:Object.assign({},t,i),r.forEach(r=>r(t,e))}},i=()=>t,s={setState:n,getState:i,getInitialState:()=>a,subscribe:e=>(r.add(e),()=>r.delete(e))},a=t=e(n,i,s);return s},tS=e=>{let t=e?tT(e):tT,r=e=>(function(e,t=e=>e){let r=F.default.useSyncExternalStore(e.subscribe,F.default.useCallback(()=>t(e.getState()),[e,t]),F.default.useCallback(()=>t(e.getInitialState()),[e,t]));return F.default.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},t_=Array.from({length:8}).reduce((e,t,r)=>(e[r]={id:r,name:["Ground: Lobby","Level 1: Guest","Level 2: Kitchen","Level 3: Living","Levl 4: Bed 1","Level 5: Bed 2","Level 6: Master","Level 8: Sky Room"][r]||`Level ${r}`,items:[]},e),{}),tk=(r?tS(r):tS)(e=>({currentFloor:0,floors:t_,assets:[{type:"furniture",src:"/assets/sofa.png",label:"Sofa"},{type:"furniture",src:"/assets/table.png",label:"Table"},{type:"decor",src:"/assets/rug.png",label:"Rug"},{type:"decor",src:"/assets/lamp.png",label:"Lamp"}],setCurrentFloor:t=>e({currentFloor:t}),setFloorName:(t,r)=>e(e=>({floors:{...e.floors,[t]:{...e.floors[t],name:r}}})),addItemToFloor:(t,r)=>e(e=>{let n=e.floors[t],i=n.items.length>0?Math.max(...n.items.map(e=>e.zIndex)):0,s={...r,id:((e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[e]];return t})(),zIndex:i+1};return{floors:{...e.floors,[t]:{...n,items:[...n.items,s]}}}}),updateItem:(t,r,n)=>e(e=>({floors:{...e.floors,[t]:{...e.floors[t],items:e.floors[t].items.map(e=>e.id===r?{...e,...n}:e)}}})),removeItem:(t,r)=>e(e=>({floors:{...e.floors,[t]:{...e.floors[t],items:e.floors[t].items.filter(e=>e.id!==r)}}})),bringToFront:(t,r)=>e(e=>{let n=e.floors[t],i=Math.max(...n.items.map(e=>e.zIndex),0);return{floors:{...e.floors,[t]:{...n,items:n.items.map(e=>e.id===r?{...e,zIndex:i+1}:e)}}}}),sendToBack:(t,r)=>e(e=>{let n=e.floors[t],i=Math.min(...n.items.map(e=>e.zIndex),0);return{floors:{...e.floors,[t]:{...n,items:n.items.map(e=>e.id===r?{...e,zIndex:i-1}:e)}}}}),loadFloors:t=>e({floors:t})})),tC=(e=new Map,t=null,r)=>({nextPart:e,validators:t,classGroupId:r}),tA=[],tD=(e,t,r)=>{if(0==e.length-t)return r.classGroupId;let n=e[t],i=r.nextPart.get(n);if(i){let r=tD(e,t+1,i);if(r)return r}let s=r.validators;if(null===s)return;let a=0===t?e.join("-"):e.slice(t).join("-"),o=s.length;for(let e=0;e<o;e++){let t=s[e];if(t.validator(a))return t.classGroupId}},tN=(e,t)=>{let r=tC();for(let n in e)tM(e[n],r,n,t);return r},tM=(e,t,r,n)=>{let i=e.length;for(let s=0;s<i;s++)tR(e[s],t,r,n)},tR=(e,t,r,n)=>{"string"==typeof e?tO(e,t,r):"function"==typeof e?tL(e,t,r,n):tP(e,t,r,n)},tO=(e,t,r)=>{(""===e?t:tF(t,e)).classGroupId=r},tL=(e,t,r,n)=>{tV(e)?tM(e(n),t,r,n):(null===t.validators&&(t.validators=[]),t.validators.push({classGroupId:r,validator:e}))},tP=(e,t,r,n)=>{let i=Object.entries(e),s=i.length;for(let e=0;e<s;e++){let[s,a]=i[e];tM(a,tF(t,s),r,n)}},tF=(e,t)=>{let r=e,n=t.split("-"),i=n.length;for(let e=0;e<i;e++){let t=n[e],i=r.nextPart.get(t);i||(i=tC(),r.nextPart.set(t,i)),r=i}return r},tV=e=>"isThemeGetter"in e&&!0===e.isThemeGetter,tB=[],tU=(e,t,r,n,i)=>({modifiers:e,hasImportantModifier:t,baseClassName:r,maybePostfixModifierPosition:n,isExternal:i}),tj=/\s+/,tq=e=>{let t;if("string"==typeof e)return e;let r="";for(let n=0;n<e.length;n++)e[n]&&(t=tq(e[n]))&&(r&&(r+=" "),r+=t);return r},tz=[],tK=e=>{let t=t=>t[e]||tz;return t.isThemeGetter=!0,t},tG=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,t$=/^\((?:(\w[\w-]*):)?(.+)\)$/i,tQ=/^\d+\/\d+$/,tH=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,tW=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,tJ=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,tY=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,tX=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,tZ=e=>tQ.test(e),t0=e=>!!e&&!Number.isNaN(Number(e)),t1=e=>!!e&&Number.isInteger(Number(e)),t2=e=>e.endsWith("%")&&t0(e.slice(0,-1)),t5=e=>tH.test(e),t6=()=>!0,t3=e=>tW.test(e)&&!tJ.test(e),t8=()=>!1,t4=e=>tY.test(e),t7=e=>tX.test(e),t9=e=>!rt(e)&&!ro(e),re=e=>rg(e,rv,t8),rt=e=>tG.test(e),rr=e=>rg(e,rw,t3),rn=e=>rg(e,rb,t0),ri=e=>rg(e,rp,t8),rs=e=>rg(e,ry,t7),ra=e=>rg(e,rE,t4),ro=e=>t$.test(e),rl=e=>rm(e,rw),ru=e=>rm(e,rx),rh=e=>rm(e,rp),rc=e=>rm(e,rv),rd=e=>rm(e,ry),rf=e=>rm(e,rE,!0),rg=(e,t,r)=>{let n=tG.exec(e);return!!n&&(n[1]?t(n[1]):r(n[2]))},rm=(e,t,r=!1)=>{let n=t$.exec(e);return!!n&&(n[1]?t(n[1]):r)},rp=e=>"position"===e||"percentage"===e,ry=e=>"image"===e||"url"===e,rv=e=>"length"===e||"size"===e||"bg-size"===e,rw=e=>"length"===e,rb=e=>"number"===e,rx=e=>"family-name"===e,rE=e=>"shadow"===e,rI=((e,...t)=>{let r,n,i,s,a=e=>{let t=n(e);if(t)return t;let s=((e,t)=>{let{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:i,sortModifiers:s}=t,a=[],o=e.trim().split(tj),l="";for(let e=o.length-1;e>=0;e-=1){let t=o[e],{isExternal:u,modifiers:h,hasImportantModifier:c,baseClassName:d,maybePostfixModifierPosition:f}=r(t);if(u){l=t+(l.length>0?" "+l:l);continue}let g=!!f,m=n(g?d.substring(0,f):d);if(!m){if(!g||!(m=n(d))){l=t+(l.length>0?" "+l:l);continue}g=!1}let p=0===h.length?"":1===h.length?h[0]:s(h).join(":"),y=c?p+"!":p,v=y+m;if(a.indexOf(v)>-1)continue;a.push(v);let w=i(m,g);for(let e=0;e<w.length;++e){let t=w[e];a.push(y+t)}l=t+(l.length>0?" "+l:l)}return l})(e,r);return i(e,s),s};return s=o=>{var l;let u;return n=(r={cache:(e=>{if(e<1)return{get:()=>void 0,set:()=>{}};let t=0,r=Object.create(null),n=Object.create(null),i=(i,s)=>{r[i]=s,++t>e&&(t=0,n=r,r=Object.create(null))};return{get(e){let t=r[e];return void 0!==t?t:void 0!==(t=n[e])?(i(e,t),t):void 0},set(e,t){e in r?r[e]=t:i(e,t)}}})((l=t.reduce((e,t)=>t(e),e())).cacheSize),parseClassName:(e=>{let{prefix:t,experimentalParseClassName:r}=e,n=e=>{let t,r=[],n=0,i=0,s=0,a=e.length;for(let o=0;o<a;o++){let a=e[o];if(0===n&&0===i){if(":"===a){r.push(e.slice(s,o)),s=o+1;continue}if("/"===a){t=o;continue}}"["===a?n++:"]"===a?n--:"("===a?i++:")"===a&&i--}let o=0===r.length?e:e.slice(s),l=o,u=!1;return o.endsWith("!")?(l=o.slice(0,-1),u=!0):o.startsWith("!")&&(l=o.slice(1),u=!0),tU(r,u,l,t&&t>s?t-s:void 0)};if(t){let e=t+":",r=n;n=t=>t.startsWith(e)?r(t.slice(e.length)):tU(tB,!1,t,void 0,!0)}if(r){let e=n;n=t=>r({className:t,parseClassName:e})}return n})(l),sortModifiers:(u=new Map,l.orderSensitiveModifiers.forEach((e,t)=>{u.set(e,1e6+t)}),e=>{let t=[],r=[];for(let n=0;n<e.length;n++){let i=e[n],s="["===i[0],a=u.has(i);s||a?(r.length>0&&(r.sort(),t.push(...r),r=[]),t.push(i)):r.push(i)}return r.length>0&&(r.sort(),t.push(...r)),t}),...(e=>{let t=(e=>{let{theme:t,classGroups:r}=e;return tN(r,t)})(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=e;return{getClassGroupId:e=>{if(e.startsWith("[")&&e.endsWith("]")){var r;let t,n,i;return -1===(r=e).slice(1,-1).indexOf(":")?void 0:(n=(t=r.slice(1,-1)).indexOf(":"),(i=t.slice(0,n))?"arbitrary.."+i:void 0)}let n=e.split("-"),i=+(""===n[0]&&n.length>1);return tD(n,i,t)},getConflictingClassGroupIds:(e,t)=>{if(t){let t=n[e],i=r[e];if(t){if(i){let e=Array(i.length+t.length);for(let t=0;t<i.length;t++)e[t]=i[t];for(let r=0;r<t.length;r++)e[i.length+r]=t[r];return e}return t}return i||tA}return r[e]||tA}}})(l)}).cache.get,i=r.cache.set,s=a,a(o)},(...e)=>s(((...e)=>{let t,r,n=0,i="";for(;n<e.length;)(t=e[n++])&&(r=tq(t))&&(i&&(i+=" "),i+=r);return i})(...e))})(()=>{let e=tK("color"),t=tK("font"),r=tK("text"),n=tK("font-weight"),i=tK("tracking"),s=tK("leading"),a=tK("breakpoint"),o=tK("container"),l=tK("spacing"),u=tK("radius"),h=tK("shadow"),c=tK("inset-shadow"),d=tK("text-shadow"),f=tK("drop-shadow"),g=tK("blur"),m=tK("perspective"),p=tK("aspect"),y=tK("ease"),v=tK("animate"),w=()=>["auto","avoid","all","avoid-page","page","left","right","column"],b=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],x=()=>[...b(),ro,rt],E=()=>["auto","hidden","clip","visible","scroll"],I=()=>["auto","contain","none"],T=()=>[ro,rt,l],S=()=>[tZ,"full","auto",...T()],_=()=>[t1,"none","subgrid",ro,rt],k=()=>["auto",{span:["full",t1,ro,rt]},t1,ro,rt],C=()=>[t1,"auto",ro,rt],A=()=>["auto","min","max","fr",ro,rt],D=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],N=()=>["start","end","center","stretch","center-safe","end-safe"],M=()=>["auto",...T()],R=()=>[tZ,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...T()],O=()=>[e,ro,rt],L=()=>[...b(),rh,ri,{position:[ro,rt]}],P=()=>["no-repeat",{repeat:["","x","y","space","round"]}],F=()=>["auto","cover","contain",rc,re,{size:[ro,rt]}],V=()=>[t2,rl,rr],B=()=>["","none","full",u,ro,rt],U=()=>["",t0,rl,rr],j=()=>["solid","dashed","dotted","double"],q=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],z=()=>[t0,t2,rh,ri],K=()=>["","none",g,ro,rt],G=()=>["none",t0,ro,rt],$=()=>["none",t0,ro,rt],Q=()=>[t0,ro,rt],H=()=>[tZ,"full",...T()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[t5],breakpoint:[t5],color:[t6],container:[t5],"drop-shadow":[t5],ease:["in","out","in-out"],font:[t9],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[t5],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[t5],shadow:[t5],spacing:["px",t0],text:[t5],"text-shadow":[t5],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",tZ,rt,ro,p]}],container:["container"],columns:[{columns:[t0,rt,ro,o]}],"break-after":[{"break-after":w()}],"break-before":[{"break-before":w()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:x()}],overflow:[{overflow:E()}],"overflow-x":[{"overflow-x":E()}],"overflow-y":[{"overflow-y":E()}],overscroll:[{overscroll:I()}],"overscroll-x":[{"overscroll-x":I()}],"overscroll-y":[{"overscroll-y":I()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:S()}],"inset-x":[{"inset-x":S()}],"inset-y":[{"inset-y":S()}],start:[{start:S()}],end:[{end:S()}],top:[{top:S()}],right:[{right:S()}],bottom:[{bottom:S()}],left:[{left:S()}],visibility:["visible","invisible","collapse"],z:[{z:[t1,"auto",ro,rt]}],basis:[{basis:[tZ,"full","auto",o,...T()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[t0,tZ,"auto","initial","none",rt]}],grow:[{grow:["",t0,ro,rt]}],shrink:[{shrink:["",t0,ro,rt]}],order:[{order:[t1,"first","last","none",ro,rt]}],"grid-cols":[{"grid-cols":_()}],"col-start-end":[{col:k()}],"col-start":[{"col-start":C()}],"col-end":[{"col-end":C()}],"grid-rows":[{"grid-rows":_()}],"row-start-end":[{row:k()}],"row-start":[{"row-start":C()}],"row-end":[{"row-end":C()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":A()}],"auto-rows":[{"auto-rows":A()}],gap:[{gap:T()}],"gap-x":[{"gap-x":T()}],"gap-y":[{"gap-y":T()}],"justify-content":[{justify:[...D(),"normal"]}],"justify-items":[{"justify-items":[...N(),"normal"]}],"justify-self":[{"justify-self":["auto",...N()]}],"align-content":[{content:["normal",...D()]}],"align-items":[{items:[...N(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...N(),{baseline:["","last"]}]}],"place-content":[{"place-content":D()}],"place-items":[{"place-items":[...N(),"baseline"]}],"place-self":[{"place-self":["auto",...N()]}],p:[{p:T()}],px:[{px:T()}],py:[{py:T()}],ps:[{ps:T()}],pe:[{pe:T()}],pt:[{pt:T()}],pr:[{pr:T()}],pb:[{pb:T()}],pl:[{pl:T()}],m:[{m:M()}],mx:[{mx:M()}],my:[{my:M()}],ms:[{ms:M()}],me:[{me:M()}],mt:[{mt:M()}],mr:[{mr:M()}],mb:[{mb:M()}],ml:[{ml:M()}],"space-x":[{"space-x":T()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":T()}],"space-y-reverse":["space-y-reverse"],size:[{size:R()}],w:[{w:[o,"screen",...R()]}],"min-w":[{"min-w":[o,"screen","none",...R()]}],"max-w":[{"max-w":[o,"screen","none","prose",{screen:[a]},...R()]}],h:[{h:["screen","lh",...R()]}],"min-h":[{"min-h":["screen","lh","none",...R()]}],"max-h":[{"max-h":["screen","lh",...R()]}],"font-size":[{text:["base",r,rl,rr]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[n,ro,rn]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",t2,rt]}],"font-family":[{font:[ru,rt,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[i,ro,rt]}],"line-clamp":[{"line-clamp":[t0,"none",ro,rn]}],leading:[{leading:[s,...T()]}],"list-image":[{"list-image":["none",ro,rt]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",ro,rt]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:O()}],"text-color":[{text:O()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...j(),"wavy"]}],"text-decoration-thickness":[{decoration:[t0,"from-font","auto",ro,rr]}],"text-decoration-color":[{decoration:O()}],"underline-offset":[{"underline-offset":[t0,"auto",ro,rt]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:T()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ro,rt]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ro,rt]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:L()}],"bg-repeat":[{bg:P()}],"bg-size":[{bg:F()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},t1,ro,rt],radial:["",ro,rt],conic:[t1,ro,rt]},rd,rs]}],"bg-color":[{bg:O()}],"gradient-from-pos":[{from:V()}],"gradient-via-pos":[{via:V()}],"gradient-to-pos":[{to:V()}],"gradient-from":[{from:O()}],"gradient-via":[{via:O()}],"gradient-to":[{to:O()}],rounded:[{rounded:B()}],"rounded-s":[{"rounded-s":B()}],"rounded-e":[{"rounded-e":B()}],"rounded-t":[{"rounded-t":B()}],"rounded-r":[{"rounded-r":B()}],"rounded-b":[{"rounded-b":B()}],"rounded-l":[{"rounded-l":B()}],"rounded-ss":[{"rounded-ss":B()}],"rounded-se":[{"rounded-se":B()}],"rounded-ee":[{"rounded-ee":B()}],"rounded-es":[{"rounded-es":B()}],"rounded-tl":[{"rounded-tl":B()}],"rounded-tr":[{"rounded-tr":B()}],"rounded-br":[{"rounded-br":B()}],"rounded-bl":[{"rounded-bl":B()}],"border-w":[{border:U()}],"border-w-x":[{"border-x":U()}],"border-w-y":[{"border-y":U()}],"border-w-s":[{"border-s":U()}],"border-w-e":[{"border-e":U()}],"border-w-t":[{"border-t":U()}],"border-w-r":[{"border-r":U()}],"border-w-b":[{"border-b":U()}],"border-w-l":[{"border-l":U()}],"divide-x":[{"divide-x":U()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":U()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...j(),"hidden","none"]}],"divide-style":[{divide:[...j(),"hidden","none"]}],"border-color":[{border:O()}],"border-color-x":[{"border-x":O()}],"border-color-y":[{"border-y":O()}],"border-color-s":[{"border-s":O()}],"border-color-e":[{"border-e":O()}],"border-color-t":[{"border-t":O()}],"border-color-r":[{"border-r":O()}],"border-color-b":[{"border-b":O()}],"border-color-l":[{"border-l":O()}],"divide-color":[{divide:O()}],"outline-style":[{outline:[...j(),"none","hidden"]}],"outline-offset":[{"outline-offset":[t0,ro,rt]}],"outline-w":[{outline:["",t0,rl,rr]}],"outline-color":[{outline:O()}],shadow:[{shadow:["","none",h,rf,ra]}],"shadow-color":[{shadow:O()}],"inset-shadow":[{"inset-shadow":["none",c,rf,ra]}],"inset-shadow-color":[{"inset-shadow":O()}],"ring-w":[{ring:U()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:O()}],"ring-offset-w":[{"ring-offset":[t0,rr]}],"ring-offset-color":[{"ring-offset":O()}],"inset-ring-w":[{"inset-ring":U()}],"inset-ring-color":[{"inset-ring":O()}],"text-shadow":[{"text-shadow":["none",d,rf,ra]}],"text-shadow-color":[{"text-shadow":O()}],opacity:[{opacity:[t0,ro,rt]}],"mix-blend":[{"mix-blend":[...q(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":q()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[t0]}],"mask-image-linear-from-pos":[{"mask-linear-from":z()}],"mask-image-linear-to-pos":[{"mask-linear-to":z()}],"mask-image-linear-from-color":[{"mask-linear-from":O()}],"mask-image-linear-to-color":[{"mask-linear-to":O()}],"mask-image-t-from-pos":[{"mask-t-from":z()}],"mask-image-t-to-pos":[{"mask-t-to":z()}],"mask-image-t-from-color":[{"mask-t-from":O()}],"mask-image-t-to-color":[{"mask-t-to":O()}],"mask-image-r-from-pos":[{"mask-r-from":z()}],"mask-image-r-to-pos":[{"mask-r-to":z()}],"mask-image-r-from-color":[{"mask-r-from":O()}],"mask-image-r-to-color":[{"mask-r-to":O()}],"mask-image-b-from-pos":[{"mask-b-from":z()}],"mask-image-b-to-pos":[{"mask-b-to":z()}],"mask-image-b-from-color":[{"mask-b-from":O()}],"mask-image-b-to-color":[{"mask-b-to":O()}],"mask-image-l-from-pos":[{"mask-l-from":z()}],"mask-image-l-to-pos":[{"mask-l-to":z()}],"mask-image-l-from-color":[{"mask-l-from":O()}],"mask-image-l-to-color":[{"mask-l-to":O()}],"mask-image-x-from-pos":[{"mask-x-from":z()}],"mask-image-x-to-pos":[{"mask-x-to":z()}],"mask-image-x-from-color":[{"mask-x-from":O()}],"mask-image-x-to-color":[{"mask-x-to":O()}],"mask-image-y-from-pos":[{"mask-y-from":z()}],"mask-image-y-to-pos":[{"mask-y-to":z()}],"mask-image-y-from-color":[{"mask-y-from":O()}],"mask-image-y-to-color":[{"mask-y-to":O()}],"mask-image-radial":[{"mask-radial":[ro,rt]}],"mask-image-radial-from-pos":[{"mask-radial-from":z()}],"mask-image-radial-to-pos":[{"mask-radial-to":z()}],"mask-image-radial-from-color":[{"mask-radial-from":O()}],"mask-image-radial-to-color":[{"mask-radial-to":O()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":b()}],"mask-image-conic-pos":[{"mask-conic":[t0]}],"mask-image-conic-from-pos":[{"mask-conic-from":z()}],"mask-image-conic-to-pos":[{"mask-conic-to":z()}],"mask-image-conic-from-color":[{"mask-conic-from":O()}],"mask-image-conic-to-color":[{"mask-conic-to":O()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:L()}],"mask-repeat":[{mask:P()}],"mask-size":[{mask:F()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",ro,rt]}],filter:[{filter:["","none",ro,rt]}],blur:[{blur:K()}],brightness:[{brightness:[t0,ro,rt]}],contrast:[{contrast:[t0,ro,rt]}],"drop-shadow":[{"drop-shadow":["","none",f,rf,ra]}],"drop-shadow-color":[{"drop-shadow":O()}],grayscale:[{grayscale:["",t0,ro,rt]}],"hue-rotate":[{"hue-rotate":[t0,ro,rt]}],invert:[{invert:["",t0,ro,rt]}],saturate:[{saturate:[t0,ro,rt]}],sepia:[{sepia:["",t0,ro,rt]}],"backdrop-filter":[{"backdrop-filter":["","none",ro,rt]}],"backdrop-blur":[{"backdrop-blur":K()}],"backdrop-brightness":[{"backdrop-brightness":[t0,ro,rt]}],"backdrop-contrast":[{"backdrop-contrast":[t0,ro,rt]}],"backdrop-grayscale":[{"backdrop-grayscale":["",t0,ro,rt]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[t0,ro,rt]}],"backdrop-invert":[{"backdrop-invert":["",t0,ro,rt]}],"backdrop-opacity":[{"backdrop-opacity":[t0,ro,rt]}],"backdrop-saturate":[{"backdrop-saturate":[t0,ro,rt]}],"backdrop-sepia":[{"backdrop-sepia":["",t0,ro,rt]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":T()}],"border-spacing-x":[{"border-spacing-x":T()}],"border-spacing-y":[{"border-spacing-y":T()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",ro,rt]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[t0,"initial",ro,rt]}],ease:[{ease:["linear","initial",y,ro,rt]}],delay:[{delay:[t0,ro,rt]}],animate:[{animate:["none",v,ro,rt]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[m,ro,rt]}],"perspective-origin":[{"perspective-origin":x()}],rotate:[{rotate:G()}],"rotate-x":[{"rotate-x":G()}],"rotate-y":[{"rotate-y":G()}],"rotate-z":[{"rotate-z":G()}],scale:[{scale:$()}],"scale-x":[{"scale-x":$()}],"scale-y":[{"scale-y":$()}],"scale-z":[{"scale-z":$()}],"scale-3d":["scale-3d"],skew:[{skew:Q()}],"skew-x":[{"skew-x":Q()}],"skew-y":[{"skew-y":Q()}],transform:[{transform:[ro,rt,"","none","gpu","cpu"]}],"transform-origin":[{origin:x()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:H()}],"translate-x":[{"translate-x":H()}],"translate-y":[{"translate-y":H()}],"translate-z":[{"translate-z":H()}],"translate-none":["translate-none"],accent:[{accent:O()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:O()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ro,rt]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":T()}],"scroll-mx":[{"scroll-mx":T()}],"scroll-my":[{"scroll-my":T()}],"scroll-ms":[{"scroll-ms":T()}],"scroll-me":[{"scroll-me":T()}],"scroll-mt":[{"scroll-mt":T()}],"scroll-mr":[{"scroll-mr":T()}],"scroll-mb":[{"scroll-mb":T()}],"scroll-ml":[{"scroll-ml":T()}],"scroll-p":[{"scroll-p":T()}],"scroll-px":[{"scroll-px":T()}],"scroll-py":[{"scroll-py":T()}],"scroll-ps":[{"scroll-ps":T()}],"scroll-pe":[{"scroll-pe":T()}],"scroll-pt":[{"scroll-pt":T()}],"scroll-pr":[{"scroll-pr":T()}],"scroll-pb":[{"scroll-pb":T()}],"scroll-pl":[{"scroll-pl":T()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ro,rt]}],fill:[{fill:["none",...O()]}],"stroke-w":[{stroke:[t0,rl,rr,rn]}],stroke:[{stroke:["none",...O()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}});function rT(...e){return rI(function(){for(var e,t,r=0,n="",i=arguments.length;r<i;r++)(e=arguments[r])&&(t=function e(t){var r,n,i="";if("string"==typeof t||"number"==typeof t)i+=t;else if("object"==typeof t)if(Array.isArray(t)){var s=t.length;for(r=0;r<s;r++)t[r]&&(n=e(t[r]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}(e))&&(n&&(n+=" "),n+=t);return n}(e))}let rS=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},r_=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var rk={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let rC=(0,F.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:i="",children:s,iconNode:a,...o},l)=>(0,F.createElement)("svg",{ref:l,...rk,width:t,height:t,stroke:e,strokeWidth:n?24*Number(r)/Number(t):r,className:r_("lucide",i),...!s&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(o)&&{"aria-hidden":"true"},...o},[...a.map(([e,t])=>(0,F.createElement)(e,t)),...Array.isArray(s)?s:[s]])),rA=(e,t)=>{let r=(0,F.forwardRef)(({className:r,...n},i)=>(0,F.createElement)(rC,{ref:i,iconNode:t,className:r_(`lucide-${rS(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...n}));return r.displayName=rS(e),r},rD=rA("building-2",[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]]);function rN(){let{currentFloor:e,floors:t,setCurrentFloor:r}=tk();return(0,P.jsxs)("div",{className:"w-64 bg-midnight border-r border-surface-light flex flex-col h-full shrink-0",children:[(0,P.jsxs)("div",{className:"p-6 border-b border-surface-light flex items-center gap-3",children:[(0,P.jsx)("div",{className:"p-2 bg-bronze/10 rounded-lg text-bronze",children:(0,P.jsx)(rD,{size:24})}),(0,P.jsxs)("div",{children:[(0,P.jsx)("h1",{className:"font-serif text-portland text-lg leading-tight",children:"St Mary"}),(0,P.jsx)("p",{className:"font-sans text-xs text-bronze uppercase tracking-widest",children:"Somerset Tower"})]})]}),(0,P.jsxs)("nav",{className:"flex-1 overflow-y-auto py-4",children:[(0,P.jsx)("div",{className:"px-4 mb-2",children:(0,P.jsx)("h2",{className:"text-[10px] uppercase tracking-widest text-portland/40 font-bold mb-2",children:"Floors"})}),(0,P.jsx)("ul",{children:Object.values(t).map(t=>(0,P.jsx)("li",{children:(0,P.jsx)("button",{onClick:()=>r(t.id),className:rT("w-full text-left px-6 py-3 text-sm font-sans transition-all border-l-2",e===t.id?"bg-surface text-bronze border-bronze":"text-portland/60 border-transparent hover:text-portland hover:bg-surface/50"),children:(0,P.jsxs)("div",{className:"flex items-center justify-between",children:[(0,P.jsx)("span",{children:t.name}),t.items.length>0&&(0,P.jsx)("span",{className:"text-[10px] bg-surface-light px-1.5 py-0.5 rounded text-portland/40",children:t.items.length})]})})},t.id))})]}),(0,P.jsx)("div",{className:"p-4 border-t border-surface-light text-[10px] text-portland/20 text-center",children:"SMS-1694  MOOD BOARD"})]})}let rM=rA("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),rR=rA("box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);function rO({type:e,src:t,label:r}){let{attributes:n,listeners:i,setNodeRef:s,isDragging:a}=tf({id:`asset-${t}`,data:{isNew:!0,type:e,src:t,label:r}});return(0,P.jsxs)("div",{ref:s,...i,...n,className:rT("aspect-square bg-surface border border-surface-light rounded-lg flex flex-col items-center justify-center gap-2 cursor-grab hover:border-bronze transition-colors group",a&&"opacity-50"),children:[(0,P.jsx)("div",{className:"w-10 h-10 bg-midnight/50 rounded flex items-center justify-center text-bronze/50 group-hover:text-bronze transition-colors",children:"furniture"===e?(0,P.jsx)(rR,{size:20}):(0,P.jsx)(rM,{size:20})}),(0,P.jsx)("span",{className:"text-xs text-portland/60 font-sans group-hover:text-portland",children:r})]})}function rL(){let{assets:e}=tk();return(0,P.jsxs)("div",{className:"w-72 bg-midnight border-l border-surface-light flex flex-col h-full shrink-0",children:[(0,P.jsx)("div",{className:"p-4 border-b border-surface-light",children:(0,P.jsx)("h2",{className:"font-serif text-portland text-sm",children:"Asset Library"})}),(0,P.jsx)("div",{className:"p-4 grid grid-cols-2 gap-3 overflow-y-auto",children:e.map(e=>(0,P.jsx)(rO,{...e},e.src))}),(0,P.jsx)("div",{className:"p-4 mt-auto border-t border-surface-light",children:(0,P.jsx)("button",{className:"w-full py-2 border border-dashed border-surface-light text-portland/40 hover:text-bronze hover:border-bronze rounded text-xs uppercase tracking-widest transition-colors",children:"Upload Image"})})]})}let rP=rA("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),rF=rA("bring-to-front",[["rect",{x:"8",y:"8",width:"8",height:"8",rx:"2",key:"yj20xf"}],["path",{d:"M4 10a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2",key:"1ltk23"}],["path",{d:"M14 20a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2",key:"1q24h9"}]]),rV=rA("send-to-back",[["rect",{x:"14",y:"14",width:"8",height:"8",rx:"2",key:"1b0bso"}],["rect",{x:"2",y:"2",width:"8",height:"8",rx:"2",key:"1x09vl"}],["path",{d:"M7 14v1a2 2 0 0 0 2 2h1",key:"pao6x6"}],["path",{d:"M14 7h1a2 2 0 0 1 2 2v1",key:"19tdru"}]]);function rB({item:e,floorId:t}){let{updateItem:r,removeItem:n,bringToFront:i,sendToBack:s}=tk(),[a,o]=(0,F.useState)(!1),{attributes:l,listeners:u,setNodeRef:h,transform:c,isDragging:d}=tf({id:e.id,data:{...e,isExisting:!0}}),f={transform:ea.Translate.toString(c),left:e.x,top:e.y,width:e.width,height:e.height,zIndex:e.zIndex,position:"absolute"};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{ref:h,style:f,...u,...l,onContextMenu:e=>{e.preventDefault(),o(!a)},className:rT("group absolute touch-none select-none",!e.src&&"bg-surface border border-dashed border-bronze/50",a?"ring-2 ring-bronze":"hover:ring-1 hover:ring-bronze/30"),children:[e.src&&(0,P.jsx)("img",{src:e.src,alt:"item",className:"w-full h-full object-contain pointer-events-none"}),a&&(0,P.jsxs)("div",{className:"absolute -top-12 left-1/2 -translate-x-1/2 bg-midnight/90 backdrop-blur border border-surface-light rounded flex gap-1 p-1 z-[9999]",children:[(0,P.jsx)("button",{onClick:()=>i(t,e.id),className:"p-1.5 hover:bg-surface rounded text-portland/80",title:"Bring to Front",children:(0,P.jsx)(rF,{size:14})}),(0,P.jsx)("button",{onClick:()=>s(t,e.id),className:"p-1.5 hover:bg-surface rounded text-portland/80",title:"Send to Back",children:(0,P.jsx)(rV,{size:14})}),(0,P.jsx)("div",{className:"w-px bg-surface-light mx-1"}),(0,P.jsx)("button",{onClick:()=>n(t,e.id),className:"p-1.5 hover:bg-alert/20 text-alert rounded",title:"Remove",children:(0,P.jsx)(rP,{size:14})})]}),(0,P.jsx)("div",{className:"absolute bottom-0 right-0 w-4 h-4 cursor-se-resize bg-transparent z-50 opacity-0 group-hover:opacity-100",onMouseDown:n=>{let i,s,a,o,l,u;return n.stopPropagation(),n.preventDefault(),i=n.clientX,s=n.clientY,a=e.width,o=e.height,l=n=>{let l=n.clientX-i,u=n.clientY-s,h=a,c=o;"br".includes("r")&&(h=a+l),"br".includes("b")&&(c=o+u),h<50&&(h=50),c<50&&(c=50),r(t,e.id,{width:h,height:c})},u=()=>{window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",u)},void(window.addEventListener("mousemove",l),window.addEventListener("mouseup",u))},children:(0,P.jsx)("div",{className:"absolute bottom-1 right-1 w-2 h-2 bg-bronze rounded-sm"})})]}),a&&(0,P.jsx)("div",{className:"fixed inset-0 z-[1] bg-transparent",onClick:()=>o(!1)})]})}function rU(){let{currentFloor:e,floors:t}=tk(),{setNodeRef:r}=function(e){let{data:t,disabled:r=!1,id:n,resizeObserverConfig:i}=e,s=ee("Droppable"),{active:a,dispatch:o,over:l,measureDroppableContainers:u}=(0,F.useContext)(tn),h=(0,F.useRef)({disabled:r}),c=(0,F.useRef)(!1),f=(0,F.useRef)(null),g=(0,F.useRef)(null),{disabled:m,updateMeasurementsFor:p,timeout:y}={...tg,...i},v=W(null!=p?p:n),w=eZ({callback:(0,F.useCallback)(()=>{if(!c.current){c.current=!0;return}null!=g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{u(Array.isArray(v.current)?v.current:[v.current]),g.current=null},y)},[y]),disabled:m||!a}),[b,x]=Y((0,F.useCallback)((e,t)=>{w&&(t&&(w.unobserve(t),c.current=!1),e&&w.observe(e))},[w])),E=W(t);return(0,F.useEffect)(()=>{w&&b.current&&(w.disconnect(),c.current=!1,w.observe(b.current))},[b,w]),(0,F.useEffect)(()=>(o({type:d.RegisterDroppable,element:{id:n,key:s,disabled:r,node:b,rect:f,data:E}}),()=>o({type:d.UnregisterDroppable,key:s,id:n})),[n]),(0,F.useEffect)(()=>{r!==h.current.disabled&&(o({type:d.SetDroppableDisabled,id:n,key:s,disabled:r}),h.current.disabled=r)},[n,s,r,o]),{active:a,rect:f,isOver:(null==l?void 0:l.id)===n,node:b,over:l,setNodeRef:x}}({id:"canvas"}),n=t[e];return(0,P.jsx)("div",{className:"flex-1 bg-surface-light/30 relative overflow-hidden bg-grid-pattern p-10",children:(0,P.jsxs)("div",{ref:r,className:rT("w-full h-full bg-portland/5 border border-dashed border-portland/10 rounded-xl relative shadow-inner","transition-colors"),children:[(0,P.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none select-none",children:(0,P.jsx)("h1",{className:"text-8xl font-serif text-portland/5",children:n.name.split(":")[0]})}),n.items.map(e=>(0,P.jsx)(rB,{item:e,floorId:n.id},e.id))]})})}e.i(14539);var rj=e.i(76510),rq=e.i(92953),rz=e.i(8070),rK=e.i(47167),rG=e.i(67034),r$=e.i(97427),rQ="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,rH={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function r(){}function n(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let r=t-this.blockSize,i=this.C,s=this.h,a=0;for(;a<t;){if(0==s)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){n(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var s,a={};function o(e){var t;return -128<=e&&e<128?(t=function(e){return new i([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(a,e)?a[e]:a[e]=t(e)):new i([0|e],e<0?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return u;if(e<0)return g(l(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new i(t,0)}var u=o(0),h=o(1),c=o(0x1000000);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function g(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new i(r,~e.h).add(h)}function m(e,t){return e.add(g(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function v(e,t){if(d(t))throw Error("division by zero");if(d(e))return new y(u,u);if(f(e))return t=v(g(e),t),new y(g(t.g),g(t.h));if(f(t))return t=v(e,g(t)),new y(g(t.g),t.h);if(e.g.length>30){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var r=h,n=t;0>=n.l(e);)r=w(r),n=w(n);var i=b(r,1),s=b(n,1);for(n=b(n,2),r=b(r,2);!d(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=b(n,1),r=b(r,1)}return t=m(e,i.j(t)),new y(i,t)}for(i=u;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=l(r)).j(t);f(a)||a.l(e)>0;)r-=n,a=(s=l(r)).j(t);d(s)&&(s=h),i=i.add(s),e=m(e,a)}return new y(i,e)}function w(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new i(r,e.h)}function b(e,t){let r=t>>5;t%=32;let n=e.g.length-r,s=[];for(let i=0;i<n;i++)s[i]=t>0?e.i(i+r)>>>t|e.i(i+r+1)<<32-t:e.i(i+r);return new i(s,e.h)}(s=i.prototype).m=function(){if(f(this))return-g(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},s.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(f(this))return"-"+g(this).toString(e);let t=l(Math.pow(e,6));var r=this;let n="";for(;;){let i=v(r,t).g,s=(((r=m(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(d(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},s.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return f(e=m(this,e))?-1:+!d(e)},s.abs=function(){return f(this)?g(this):this},s.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],n=0;for(let i=0;i<=t;i++){let t=n+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);n=s>>>16,t&=65535,s&=65535,r[i]=s<<16|t}return new i(r,-0x80000000&r[r.length-1]?-1:0)},s.j=function(e){if(d(this)||d(e))return u;if(f(this))return f(e)?g(this).j(g(e)):g(g(this).j(e));if(f(e))return g(this.j(g(e)));if(0>this.l(c)&&0>e.l(c))return l(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(let t=0;t<e.g.length;t++){let i=this.i(n)>>>16,s=65535&this.i(n),a=e.i(t)>>>16,o=65535&e.i(t);r[2*n+2*t]+=s*o,p(r,2*n+2*t),r[2*n+2*t+1]+=i*o,p(r,2*n+2*t+1),r[2*n+2*t+1]+=s*a,p(r,2*n+2*t+1),r[2*n+2*t+2]+=i*a,p(r,2*n+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new i(r,0)},s.B=function(e){return v(this,e).h},s.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new i(r,this.h&e.h)},s.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new i(r,this.h|e.h)},s.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new i(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,I=rH.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=l,i.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return g(e(t.substring(1),r));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let n=l(Math.pow(r,8)),i=u;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),r);s<8?(s=l(Math.pow(r,s)),i=i.j(s).add(l(a))):i=(i=i.j(n)).add(l(a))}return i},E=rH.Integer=i}).apply(void 0!==rQ?rQ:"u">typeof self?self:"u">typeof window?window:{});var rW=e.i(83877),rJ="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,rY={};(function(){var e,t,r=Object.defineProperty,n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof rJ&&rJ];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&r(i,e,{configurable:!0,writable:!0,value:t})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push([t,e[t]]);return r}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function l(e,t,r){return e.call.apply(e.bind,arguments)}function u(e,t,r){return(u=l).apply(null,arguments)}function h(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function c(e,t){function r(){}r.prototype=t.prototype,e.Z=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Ob=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}var d="u">typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function f(e){let t=e.length;if(t>0){let r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function g(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];var r=typeof n;if("array"==(r="object"!=r?r:n?Array.isArray(n)?"array":r:"null")||"object"==r&&"number"==typeof n.length){r=e.length||0;let t=n.length||0;e.length=r+t;for(let i=0;i<t;i++)e[r+i]=n[i]}else e.push(n)}}var m=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new p,e=>e.reset());class p{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let y,v=!1,w=new class{constructor(){this.h=this.g=null}add(e,t){let r=m.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},b=()=>{let e=Promise.resolve(void 0);y=()=>{e.then(x)}};function x(){let e;for(var t;e=null,w.g&&(e=w.g,w.g=w.g.next,w.g||(w.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}m.j(t),m.h<100&&(m.h++,t.next=m.g,m.g=t)}v=!1}function E(){this.u=this.u,this.C=this.C}function I(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}E.prototype.u=!1,E.prototype.dispose=function(){this.u||(this.u=!0,this.N())},E.prototype[Symbol.dispose]=function(){this.dispose()},E.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},I.prototype.h=function(){this.defaultPrevented=!0};var M=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function R(e){return/^[\s\xa0]*$/.test(e)}function O(e,t){I.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}c(O,I),O.prototype.init=function(e,t){let r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement)),this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&O.Z.h.call(this)},O.prototype.h=function(){O.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var L="closure_listenable_"+(1e6*Math.random()|0),P=0;function F(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++P,this.da=this.fa=!1}function V(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e,t,r){for(let n in e)t.call(r,e[n],n,e)}function U(e){let t={};for(let r in e)t[r]=e[r];return t}let j="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function q(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t])e[r]=n[r];for(let t=0;t<j.length;t++)r=j[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function z(e){this.src=e,this.g={},this.h=0}function K(e,t){let r=t.type;if(r in e.g){var n,i=e.g[r],s=Array.prototype.indexOf.call(i,t,void 0);(n=s>=0)&&Array.prototype.splice.call(i,s,1),n&&(V(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function G(e,t,r,n){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!r==s.capture&&s.ha==n)return i}return -1}z.prototype.add=function(e,t,r,n,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=G(e,t,n,i);return a>-1?(t=e[a],r||(t.fa=!1)):((t=new F(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var $="closure_lm_"+(1e6*Math.random()|0),Q={};function H(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");let a=o(i)?!!i.capture:!!i,l=X(e);if(l||(e[$]=l=new z(e)),(r=l.add(t,r,n,a,s)).proxy)return r;if(n=function e(t){return Y.call(e.src,e.listener,t)},r.proxy=n,n.src=e,n.listener=r,e.addEventListener)M||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(J(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function W(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[L])K(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(J(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=X(t))?(K(r,e),0==r.h&&(r.src=null,t[$]=null)):V(e)}}}function J(e){return e in Q?Q[e]:Q[e]="on"+e}function Y(e,t){if(e.da)e=!0;else{t=new O(t,this);let r=e.listener,n=e.ha||e.src;e.fa&&W(e),e=r.call(n,t)}return e}function X(e){return(e=e[$])instanceof z?e:null}var Z="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[Z]||(e[Z]=function(t){return e.handleEvent(t)}),e[Z])}function et(){E.call(this),this.i=new z(this),this.M=this,this.G=null}function er(e,t){let r,n;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new I(t,e);else if(t instanceof I)t.target=t.target||e;else{var a=t;q(t=new I(s,e),a)}if(a=!0,i)for(n=i.length-1;n>=0;n--)a=en(r=t.g=i[n],s,!0,t)&&a;if(a=en(r=t.g=e,s,!0,t)&&a,a=en(r,s,!1,t)&&a,i)for(n=0;n<i.length;n++)a=en(r=t.g=i[n],s,!1,t)&&a}function en(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==r){let t=a.listener,r=a.ha||a.src;a.fa&&K(e.i,a),i=!1!==t.call(r,n)&&i}}return i&&!n.defaultPrevented}c(et,E),et.prototype[L]=!0,et.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else(i=o(i)?!!i.capture:!!i,n=ee(n),t&&t[L])?(t=t.i,(a=String(r).toString())in t.g&&(n=G(r=t.g[a],n,i,s))>-1&&(V(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[a],t.h--))):t&&(t=X(t))&&(r=t.g[r.toString()],t=-1,r&&(t=G(r,n,i,s)),(n=t>-1?r[t]:null)&&W(n))}(this,e,t,r,n)},et.prototype.N=function(){if(et.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let r=e.g[t];for(let e=0;e<r.length;e++)V(r[e]);delete e.g[t],e.h--}}this.G=null},et.prototype.J=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},et.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ei extends E{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=u(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:a.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function es(e){E.call(this),this.h=e,this.g={}}c(es,E);var ea=[];function eo(e){B(e.g,function(e,t){this.g.hasOwnProperty(t)&&W(e)},e),e.g={}}es.prototype.N=function(){es.Z.N.call(this),eo(this)},es.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=a.JSON.stringify,eu=a.JSON.parse,eh=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ec(){}function ed(){}var ef={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function eg(){I.call(this,"d")}function em(){I.call(this,"c")}c(eg,I),c(em,I);var ep={},ey=null;function ev(){return ey=ey||new et}function ew(e){I.call(this,ep.Ia,e)}function eb(e){let t=ev();er(t,new ew(t))}function ex(e,t){I.call(this,ep.STAT_EVENT,e),this.stat=t}function eE(e){let t=ev();er(t,new ex(t,e))}function eI(e,t){I.call(this,ep.Ja,e),this.size=t}function eT(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function eS(){this.g=!0}function e_(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var r=s[e];if(!(r.length<2)){var n=r[1];if(Array.isArray(n)&&!(n.length<1)){var i=n[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<n.length;e++)n[e]=""}}}}return el(s)}catch(e){return t}}(e,r)+(n?" "+n:"")})}ep.Ia="serverreachability",c(ew,I),ep.STAT_EVENT="statevent",c(ex,I),ep.Ja="timingevent",c(eI,I),eS.prototype.ua=function(){this.g=!1},eS.prototype.info=function(){};var ek={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eC={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function eA(){}function eD(e){return encodeURIComponent(String(e))}function eN(e,t,r,n){this.j=e,this.i=t,this.l=r,this.S=n||1,this.V=new es(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eM}function eM(){this.i=null,this.g="",this.h=!1}c(eA,ec),eA.prototype.g=function(){return new XMLHttpRequest},e=new eA;var eR={},eO={};function eL(e,t,r){e.M=1,e.A=e3(e0(t)),e.u=r,e.R=!0,eP(e,null)}function eP(e,t){e.F=Date.now(),eV(e),e.B=e0(e.A);var r,n,i,s,a,l,h=e.B,c=e.S;Array.isArray(c)||(c=[String(c)]),tu(h.i,"t",c),e.C=0,h=e.j.L,e.h=new eM,e.g=tW(e.j,h?t:null,!e.u),e.P>0&&(e.O=new ei(u(e.Y,e,e.g),e.P)),t=e.V,h=e.g,c=e.ba;var d="readystatechange";Array.isArray(d)||(d&&(ea[0]=d.toString()),d=ea);for(let e=0;e<d.length;e++){let r=function e(t,r,n,i,s){if(i&&i.once)return function e(t,r,n,i,s){if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=ee(n),t&&t[L]?t.K(r,n,o(i)?!!i.capture:!!i,s):H(t,r,n,!0,i,s)}(t,r,n,i,s);if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=ee(n),t&&t[L]?t.J(r,n,o(i)?!!i.capture:!!i,s):H(t,r,n,!1,i,s)}(h,d[e],c||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}t=e.J?U(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),eb(),r=e.i,n=e.v,i=e.B,s=e.l,a=e.S,l=e.u,r.info(function(){if(r.g)if(l){var e="",t=l.split("&");for(let r=0;r<t.length;r++){var o=t[r].split("=");if(o.length>1){let t=o[0];o=o[1];let r=t.split("_");e=r.length>=2&&"type"==r[1]?e+(t+"=")+o+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+n+"\n"+i+"\n"+e})}function eF(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eV(e){e.T=Date.now()+e.H,eB(e,e.H)}function eB(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eT(u(e.aa,e),t)}function eU(e){e.D&&(a.clearTimeout(e.D),e.D=null)}function ej(e){0==e.j.I||e.K||tK(e.j,e)}function eq(e){eU(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eo(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function ez(e,t){try{var r=e.j;if(0!=r.I&&(r.g==e||eH(r.h,e))){if(!e.L&&eH(r.h,e)&&3==r.I){try{var n=r.Ba.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.v){if(r.g)if(r.g.F+3e3<e.F)tz(r),tR(r);else break e;tU(r),eE(18)}}else r.xa=i[1],0<r.xa-r.K&&i[2]<37500&&r.F&&0==r.A&&!r.C&&(r.C=eT(u(r.Va,r),6e3));1>=eQ(r.h)&&r.ta&&(r.ta=void 0)}else t$(r,11)}else if((e.L||r.g==e)&&tz(r),!R(t))for(i=r.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=r.K))if(r.K=l,o=o[1],2==r.I)if("c"==o[0]){r.M=o[1],r.ba=o[2];let t=o[3];null!=t&&(r.ka=t,r.j.info("VER="+r.ka));let i=o[4];null!=i&&(r.za=i,r.j.info("SVER="+r.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(r.O=n=1.5*l,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=n.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eW(s,s.h),s.h=null))}if(n.G){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.wa=e,e6(n.J,n.G,e))}}if(r.I=3,r.l&&r.l.ra(),r.aa&&(r.T=Date.now()-e.F,r.j.info("Handshake RTT: "+r.T+"ms")),(n=r).na=tH(n,n.L?n.ba:null,n.W),e.L){eJ(n.h,e);var a=n.O;a&&(e.H=a),e.D&&(eU(e),eV(e)),n.g=e}else tB(n);r.i.length>0&&tL(r)}else"stop"!=o[0]&&"close"!=o[0]||t$(r,7);else 3==r.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?t$(r,7):tM(r):"noop"!=o[0]&&r.l&&r.l.qa(o),r.A=0)}}eb(4)}catch(e){}}eN.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tC(e)?t.j():this.Y(e)},eN.prototype.Y=function(e){try{if(e==this.g)e:{let f=tC(this.g),g=this.g.ya(),m=this.g.ca();if(!(f<3)&&(3!=f||this.g&&(this.h.h||this.g.la()||tA(this.g)))){this.K||4!=f||7==g||(8==g||m<=0?eb(3):eb(2)),eU(this);var t=this.g.ca();this.X=t;var r=function(e){if(!eF(e))return e.g.la();let t=tA(e.g);if(""===t)return"";let r="",n=t.length,i=4==tC(e.g);if(!e.h.i){if("u"<typeof TextDecoder)return eq(e),ej(e),"";e.h.i=new a.TextDecoder}for(let s=0;s<n;s++)e.h.h=!0,r+=e.h.i.decode(t[s],{stream:!(i&&s==n-1)});return t.length=0,e.h.g+=r,e.C=0,e.h.g}(this);if(this.o=200==t,n=this.i,i=this.v,s=this.B,o=this.l,l=this.S,n.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+l+"]: "+i+"\n"+s+"\n"+f+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var n,i,s,o,l,u,h=this.g;if((u=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!R(u)){var c=u;break t}}c=null}if(e=c)e_(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ez(this,e);else{this.o=!1,this.m=3,eE(12),eq(this),ej(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<r.length;)if((t=function(e,t){var r=e.C,n=t.indexOf("\n",r);return -1==n?eO:isNaN(r=Number(t.substring(r,n)))?eR:(n+=1)+r>t.length?eO:(t=t.slice(n,n+r),e.C=n+r,t)}(this,r))==eO){4==f&&(this.m=4,eE(14),e=!1),e_(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eR){this.m=4,eE(15),e_(this.i,this.l,r,"[Invalid Chunk]"),e=!1;break}else e_(this.i,this.l,t,null),ez(this,t);if(eF(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=f||0!=r.length||this.h.h||(this.m=1,eE(16),e=!1),this.o=this.o&&e,e){if(r.length>0&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.aa&&!d.P&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+r.length),tj(d),d.P=!0,eE(11))}}else e_(this.i,this.l,r,"[Invalid Chunked Response]"),eq(this),ej(this)}else e_(this.i,this.l,r,null),ez(this,r);4==f&&eq(this),this.o&&!this.K&&(4==f?tK(this.j,this):(this.o=!1,eV(this)))}else(function(e){let t={};e=(e.g&&tC(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(R(e[n]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;t>0&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[n]);let i=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let s=t[i]||[];t[i]=s,s.push(r)}var n=function(e){return e.join(", ")};for(let e in t)n.call(void 0,t[e],e,t)})(this.g),400==t&&r.indexOf("Unknown SID")>0?(this.m=3,eE(12)):(this.m=0,eE(13)),eq(this),ej(this)}}}catch(e){}finally{}},eN.prototype.cancel=function(){this.K=!0,eq(this)},eN.prototype.aa=function(){var e,t;this.D=null;let r=Date.now();r-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(eb(),eE(17)),eq(this),this.m=2,ej(this)):eB(this,this.T-r)};var eK=class{constructor(e,t){this.g=e,this.map=t}};function eG(e){this.l=e||10,e=a.PerformanceNavigationTiming?(e=a.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function e$(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eQ(e){return e.h?1:e.g?e.g.size:0}function eH(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eW(e,t){e.g?e.g.add(t):e.h=t}function eJ(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eY(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.G);return t}return f(e.i)}eG.prototype.cancel=function(){if(this.i=eY(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eX=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eZ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eZ?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e5(this,th(e.i)),this.m=e.m):e&&(t=String(e).match(eX))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e8(t[2]||""),this.g=e8(t[3]||"",!0),e2(this,t[4]),this.h=e8(t[5]||"",!0),e5(this,t[6]||"",!0),this.m=e8(t[7]||"")):(this.l=!1,this.i=new ti(null,this.l))}function e0(e){return new eZ(e)}function e1(e,t,r){e.j=r?e8(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e5(e,t,r){var n,i;t instanceof ti?(e.i=t,n=e.i,(i=e.l)&&!n.j&&(ts(n),n.i=null,n.g.forEach(function(e,t){let r=t.toLowerCase();t!=r&&(ta(this,t),tu(this,r,e))},n)),n.j=i):(r||(t=e4(t,tr)),e.i=new ti(t,e.l))}function e6(e,t,r){e.i.set(t,r)}function e3(e){return e6(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e8(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e4(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,e7),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e7(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eZ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e4(t,e9,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e4(t,e9,!0),"@"),e.push(eD(r).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.u)&&e.push(":",String(r))),(r=this.h)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(e4(r,"/"==r.charAt(0)?tt:te,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",e4(r,tn)),e.join("")},eZ.prototype.resolve=function(e){let t=e0(this),r=!!e.j;r?e1(t,e.j):r=!!e.o,r?t.o=e.o:r=!!e.g,r?t.g=e.g:r=null!=e.u;var n=e.h;if(r)e2(t,e.u);else if(r=!!e.h){if("/"!=n.charAt(0))if(this.g&&!this.h)n="/"+n;else{var i=t.h.lastIndexOf("/");-1!=i&&(n=t.h.slice(0,i+1)+n)}if(".."==(i=n)||"."==i)n="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){n=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let r=i[t++];"."==r?n&&t==i.length&&e.push(""):".."==r?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),n&&t==i.length&&e.push("")):(e.push(r),n=!0)}n=e.join("/")}else n=i}return r?t.h=n:r=""!==e.i.toString(),r?e5(t,th(e.i)):r=!!e.m,r&&(t.m=e.m),t};var e9=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tr=/[#\?@]/g,tn=/#/g;function ti(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ts(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let r=0;r<e.length;r++){let n=e[r].indexOf("="),i,s=null;n>=0?(i=e[r].substring(0,n),s=e[r].substring(n+1)):i=e[r],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function ta(e,t){ts(e),t=tc(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function to(e,t){return ts(e),t=tc(e,t),e.g.has(t)}function tl(e,t){ts(e);let r=[];if("string"==typeof t)to(e,t)&&(r=r.concat(e.g.get(tc(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)r=r.concat(e[t]);return r}function tu(e,t,r){ta(e,t),r.length>0&&(e.i=null,e.g.set(tc(e,t),f(r)),e.h+=r.length)}function th(e){let t=new ti;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tc(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function td(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function tf(){this.g=new eh}function tg(e){this.i=e.Sb||null,this.h=e.ab||!1}function tm(e,t){et.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tp(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function ty(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tv(e)}function tv(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tw(e){let t="";return B(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function tb(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=tw(r),"string"==typeof e?null!=r&&eD(r):e6(e,t,r))}function tx(e){et.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ti.prototype).add=function(e,t){ts(this),this.i=null,e=tc(this,e);let r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},t.forEach=function(e,t){ts(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},t.set=function(e,t){return ts(this),this.i=null,to(this,e=tc(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tl(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let n=0;n<t.length;n++){var r=t[n];let i=eD(r);r=tl(this,r);for(let t=0;t<r.length;t++){let n=i;""!==r[t]&&(n+="="+eD(r[t])),e.push(n)}}return this.i=e.join("&")},c(tg,ec),tg.prototype.g=function(){return new tm(this.i,this.h)},c(tm,et),(t=tm.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tv(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||a).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,ty(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tv(this)),this.g&&(this.readyState=3,tv(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tp(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ty(this):tv(this),3==this.readyState&&tp(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,ty(this))},t.Na=function(e){this.g&&(this.response=e,ty(this))},t.ga=function(){this.g&&ty(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(tm.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),c(tx,et);var tE=/^https?$/i,tI=["POST","PUT"];function tT(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tS(e),tk(e)}function tS(e){e.A||(e.A=!0,er(e,"complete"),er(e,"error"))}function t_(e){if(e.h&&void 0!==s){if(e.v&&4==tC(e))setTimeout(e.Ca.bind(e),0);else if(er(e,"readystatechange"),4==tC(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,n=!0;break;default:n=!1}if(!(t=n)){if(r=0===s){let t=String(e.D).match(eX)[1]||null;!t&&a.self&&a.self.location&&(t=a.self.location.protocol.slice(0,-1)),r=!tE.test(t?t.toLowerCase():"")}t=r}if(t)er(e,"complete"),er(e,"success");else{e.o=6;try{var i=tC(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tS(e)}}finally{tk(e)}}}}function tk(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let r=e.g;e.g=null,t||er(e,"ready");try{r.onreadystatechange=null}catch(e){}}}function tC(e){return e.g?e.g.readyState:0}function tA(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tD(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tN(e){this.za=0,this.i=[],this.j=new eS,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tD("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tD("baseRetryDelayMs",5e3,e),this.Za=tD("retryDelaySeedMs",1e4,e),this.Ta=tD("forwardChannelMaxRetries",2,e),this.va=tD("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eG(e&&e.concurrentRequestLimit),this.Ba=new tf,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tM(e){if(tO(e),3==e.I){var t=e.V++,r=e0(e.J);if(e6(r,"SID",e.M),e6(r,"RID",t),e6(r,"TYPE","terminate"),tF(e,r),(t=new eN(e,e.j,t)).M=2,t.A=e3(e0(r)),r=!1,a.navigator&&a.navigator.sendBeacon)try{r=a.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!r&&a.Image&&((new Image).src=t.A,r=!0),r||(t.g=tW(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eV(t)}tQ(e)}function tR(e){e.g&&(tj(e),e.g.cancel(),e.g=null)}function tO(e){tR(e),e.v&&(a.clearTimeout(e.v),e.v=null),tz(e),e.h.cancel(),e.m&&("number"==typeof e.m&&a.clearTimeout(e.m),e.m=null)}function tL(e){if(!e$(e.h)&&!e.m){e.m=!0;var t=e.Ea;y||b(),v||(y(),v=!0),w.add(t,e),e.D=0}}function tP(e,t){var r;r=t?t.l:e.V++;let n=e0(e.J);e6(n,"SID",e.M),e6(n,"RID",r),e6(n,"AID",e.K),tF(e,n),e.u&&e.o&&tb(n,e.u,e.o),r=new eN(e,e.j,r,e.D+1),null===e.u&&(r.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tV(e,r,1e3),r.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eW(e.h,r),eL(r,n,t)}function tF(e,t){e.H&&B(e.H,function(e,r){e6(t,r,e)}),e.l&&B({},function(e,r){e6(t,r,e)})}function tV(e,t,r){r=Math.min(e.i.length,r);let n=e.l?u(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?r>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let u=0;u<r;u++){var s=i[u].g;let r=i[u].map;if((s-=t)<0)t=Math.max(0,i[u].g-100),l=!1;else try{s="req"+s+"_";try{var a=r instanceof Map?r:Object.entries(r);for(let[t,r]of a){let n=r;o(r)&&(n=el(r)),e.push(s+t+"="+encodeURIComponent(n))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){n&&n(r)}}if(l){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,r),a}function tB(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;y||b(),v||(y(),v=!0),w.add(t,e),e.A=0}}function tU(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eT(u(e.Da,e),tG(e,e.A)),e.A++,!0)}function tj(e){null!=e.B&&(a.clearTimeout(e.B),e.B=null)}function tq(e){e.g=new eN(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e6(t,"RID","rpc"),e6(t,"SID",e.M),e6(t,"AID",e.K),e6(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e6(t,"TO",e.ia),e6(t,"TYPE","xmlhttp"),tF(e,t),e.u&&e.o&&tb(t,e.u,e.o),e.O&&(e.g.H=e.O);var r=e.g;e=e.ba,r.M=1,r.A=e3(e0(t)),r.u=null,r.R=!0,eP(r,e)}function tz(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function tK(e,t){var r,n=null;if(e.g==t){tz(e),tj(e),e.g=null;var i=2}else{if(!eH(e.h,t))return;n=t.G,eJ(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;er(i=ev(),new eI(i,n)),tL(e)}else tB(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(r=t,!(eQ(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=r.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eT(u(e.Ea,e,r),tG(e,e.D)),e.D++,!0)))||2==i&&tU(e)))switch(n&&n.length>0&&((t=e.h).i=t.i.concat(n)),s){case 1:t$(e,5);break;case 4:t$(e,10);break;case 3:t$(e,6);break;default:t$(e,2)}}}function tG(e,t){let r=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(r*=2),r*t}function t$(e,t){if(e.j.info("Error code "+t),2==t){let t,s,o;var r,n=u(e.bb,e),i=e.Ua;let l=!i;i=new eZ(i||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||e1(i,"https"),e3(i),l?function(e,t){let r=new eS;if(a.Image){let n=new Image;n.onload=h(td,r,"TestLoadImage: loaded",!0,t,n),n.onerror=h(td,r,"TestLoadImage: error",!1,t,n),n.onabort=h(td,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=h(td,r,"TestLoadImage: timeout",!1,t,n),a.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(i.toString(),n):(r=i.toString(),t=new eS,s=new AbortController,o=setTimeout(()=>{s.abort(),td(t,"TestPingServer: timeout",!1,n)},1e4),fetch(r,{signal:s.signal}).then(e=>{clearTimeout(o),e.ok?td(t,"TestPingServer: ok",!0,n):td(t,"TestPingServer: server error",!1,n)}).catch(()=>{clearTimeout(o),td(t,"TestPingServer: error",!1,n)}))}else eE(2);e.I=0,e.l&&e.l.pa(t),tQ(e),tO(e)}function tQ(e){if(e.I=0,e.ja=[],e.l){let t=eY(e.h);(0!=t.length||0!=e.i.length)&&(g(e.ja,t),g(e.ja,e.i),e.h.i.length=0,f(e.i),e.i.length=0),e.l.oa()}}function tH(e,t,r){var n=r instanceof eZ?e0(r):new eZ(r);if(""!=n.g)t&&(n.g=t+"."+n.g),e2(n,n.u);else{var i=a.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new eZ(null);n&&e1(e,n),t&&(e.g=t),i&&e2(e,i),r&&(e.h=r),n=e}return r=e.G,t=e.wa,r&&t&&e6(n,r,t),e6(n,"VER",e.ka),tF(e,n),n}function tW(e,t,r){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tx(e.Aa&&!e.ma?new tg({ab:r}):e.ma)).Fa(e.L),t}function tJ(){}function tY(){}function tX(e,t){et.call(this),this.g=new tN(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!R(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!R(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t1(this)}function tZ(e){eg.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t0(){em.call(this),this.status=1}function t1(e){this.g=e}(t=tx.prototype).Fa=function(e){this.H=e},t.ea=function(t,r,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);r=r?r.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=d(u(this.Ca,this));try{this.B=!0,this.g.open(r,String(t),!0),this.B=!1}catch(e){tT(this,e);return}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,o]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&t instanceof a.FormData,!(Array.prototype.indexOf.call(tI,r,void 0)>=0)||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(e,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tT(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,er(this,"complete"),er(this,"abort"),tk(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tk(this,!0)),tx.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?t_(this):this.Xa())},t.Xa=function(){t_(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tC(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eu(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tN.prototype).ka=8,t.I=1,t.connect=function(e,t,r,n){eE(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.J=tH(this,null,this.W),tL(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new eN(this,this.j,e),s=this.o;if(this.U&&(s?q(s=U(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var n=this.i[r];if("__data__"in n.map&&"string"==typeof(n=n.map.__data__)){n=n.length;break t}n=void 0}if(void 0===n)break;if((t+=n)>4096){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tV(this,i,t),e6(r=e0(this.J),"RID",e),e6(r,"CVER",22),this.G&&e6(r,"X-HTTP-Session-Id",this.G),tF(this,r),s&&(this.R?t="headers="+eD(tw(s))+"&"+t:this.u&&tb(r,this.u,s)),eW(this.h,i),this.Ra&&e6(r,"TYPE","init"),this.S?(e6(r,"$req",t),e6(r,"SID","null"),i.U=!0,eL(i,r,null)):eL(i,r,t),this.I=2}}else 3==this.I&&(e?tP(this,e):0==this.i.length||e$(this.h)||tP(this))},t.Da=function(){if(this.v=null,tq(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eT(u(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eE(10),tR(this),tq(this))},t.Va=function(){null!=this.C&&(this.C=null,tR(this),tU(this),eE(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eE(2)):(this.j.info("Failed to ping google.com"),eE(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tJ.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tY.prototype.g=function(e,t){return new tX(e,t)},c(tX,et),tX.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},tX.prototype.close=function(){tM(this.g)},tX.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.v&&((r={}).__data__=el(e),e=r);t.i.push(new eK(t.Ya++,e)),3==t.I&&tL(t)},tX.prototype.N=function(){this.g.l=null,delete this.j,tM(this.g),delete this.g,tX.Z.N.call(this)},c(tZ,eg),c(t0,em),c(t1,tJ),t1.prototype.ra=function(){er(this.g,"a")},t1.prototype.qa=function(e){er(this.g,new tZ(e))},t1.prototype.pa=function(e){er(this.g,new t0)},t1.prototype.oa=function(){er(this.g,"b")},tY.prototype.createWebChannel=tY.prototype.g,tX.prototype.send=tX.prototype.o,tX.prototype.open=tX.prototype.m,tX.prototype.close=tX.prototype.close,N=rY.createWebChannelTransport=function(){return new tY},D=rY.getStatEventTarget=function(){return ev()},A=rY.Event=ep,C=rY.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ek.NO_ERROR=0,ek.TIMEOUT=8,ek.HTTP_ERROR=6,k=rY.ErrorCode=ek,eC.COMPLETE="complete",_=rY.EventType=eC,ed.EventType=ef,ef.OPEN="a",ef.CLOSE="b",ef.ERROR="c",ef.MESSAGE="d",et.prototype.listen=et.prototype.J,S=rY.WebChannel=ed,rY.FetchXmlHttpFactory=tg,tx.prototype.listenOnce=tx.prototype.K,tx.prototype.getLastError=tx.prototype.Ha,tx.prototype.getLastErrorCode=tx.prototype.ya,tx.prototype.getStatus=tx.prototype.ca,tx.prototype.getResponseJson=tx.prototype.La,tx.prototype.getResponseText=tx.prototype.la,tx.prototype.send=tx.prototype.ea,tx.prototype.setWithCredentials=tx.prototype.Fa,T=rY.XhrIo=tx}).apply(void 0!==rJ?rJ:"u">typeof self?self:"u">typeof window?window:{});class rX{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}rX.UNAUTHENTICATED=new rX(null),rX.GOOGLE_CREDENTIALS=new rX("google-credentials-uid"),rX.FIRST_PARTY=new rX("first-party-uid"),rX.MOCK_USER=new rX("mock-user");let rZ="12.8.0",r0=new rW.Logger("@firebase/firestore");function r1(){return r0.logLevel}function r2(e,...t){if(r0.logLevel<=rW.LogLevel.DEBUG){let r=t.map(r3);r0.debug(`Firestore (${rZ}): ${e}`,...r)}}function r5(e,...t){if(r0.logLevel<=rW.LogLevel.ERROR){let r=t.map(r3);r0.error(`Firestore (${rZ}): ${e}`,...r)}}function r6(e,...t){if(r0.logLevel<=rW.LogLevel.WARN){let r=t.map(r3);r0.warn(`Firestore (${rZ}): ${e}`,...r)}}function r3(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function r8(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,r4(e,n,r)}function r4(e,t,r){let n=`FIRESTORE (${rZ}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw r5(n),Error(n)}function r7(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||r4(t,i,n)}let r9={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ne extends r$.FirebaseError{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class nt{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class nr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class nn{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(rX.UNAUTHENTICATED))}shutdown(){}}class ni{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ns{constructor(e){this.t=e,this.currentUser=rX.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){r7(void 0===this.o,42304);let r=this.i,n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),i=new nt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new nt,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{r2("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(r2("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new nt)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(r2("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(r7("string"==typeof t.accessToken,31837,{l:t}),new nr(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return r7(null===e||"string"==typeof e,2055,{h:e}),new rX(e)}}class na{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=rX.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class no{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new na(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(rX.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class nl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class nu{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,rq._isFirebaseServerApp)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){r7(void 0===this.o,3512);let r=e=>{null!=e.error&&r2("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.m;return this.m=e.token,r2("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{r2("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?n(e):r2("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new nl(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(r7("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new nl(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class nh{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let r=function(e){let t="u">typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(0);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function nc(e,t){return e<t?-1:+(e>t)}function nd(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return nf(r)===nf(i)?nc(r,i):nf(r)?1:-1}return nc(e.length,t.length)}function nf(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function ng(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}let nm="__name__";class np{constructor(e,t,r){void 0===t?t=0:t>e.length&&r8(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&r8(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===np.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof np?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=np.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return nc(e.length,t.length)}static compareSegments(e,t){let r=np.isNumericId(e),n=np.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?np.extractNumericId(e).compare(np.extractNumericId(t)):nd(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return E.fromString(e.substring(4,e.length-2))}}class ny extends np{construct(e,t,r){return new ny(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new ne(r9.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new ny(t)}static emptyPath(){return new ny([])}}let nv=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class nw extends np{construct(e,t,r){return new nw(e,t,r)}static isValidIdentifier(e){return nv.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),nw.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===nm}static keyField(){return new nw([nm])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new ne(r9.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new ne(r9.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new ne(r9.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new ne(r9.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new nw(t)}static emptyPath(){return new nw([])}}class nb{constructor(e){this.path=e}static fromPath(e){return new nb(ny.fromString(e))}static fromName(e){return new nb(ny.fromString(e).popFirst(5))}static empty(){return new nb(ny.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ny.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ny.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new nb(new ny(e.slice()))}}function nx(e){if(!nb.isDocumentKey(e))throw new ne(r9.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function nE(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function nI(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":r8(12329,{type:typeof e})}function nT(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new ne(r9.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=nI(e);throw new ne(r9.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function nS(e,t){if(t<=0)throw new ne(r9.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function n_(e,t){let r={typeString:e};return t&&(r.value=t),r}function nk(e,t){let r;if(!nE(e))throw new ne(r9.INVALID_ARGUMENT,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new ne(r9.INVALID_ARGUMENT,r);return!0}class nC{static now(){return nC.fromMillis(Date.now())}static fromDate(e){return nC.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*1e6);return new nC(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new ne(r9.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new ne(r9.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?nc(this.nanoseconds,e.nanoseconds):nc(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:nC._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(nk(e,nC._jsonSchema))return new nC(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}nC._jsonSchemaVersion="firestore/timestamp/1.0",nC._jsonSchema={type:n_("string",nC._jsonSchemaVersion),seconds:n_("number"),nanoseconds:n_("number")};class nA{static fromTimestamp(e){return new nA(e)}static min(){return new nA(new nC(0,0))}static max(){return new nA(new nC(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class nD{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function nN(e){return e.fields.find(e=>2===e.kind)}function nM(e){return e.fields.filter(e=>2!==e.kind)}function nR(e,t){let r=nc(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=function(e,t){let r=nw.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:nc(e.kind,t.kind)}(e.fields[n],t.fields[n])))return r;return nc(e.fields.length,t.fields.length)}nD.UNKNOWN_ID=-1;class nO{constructor(e,t){this.fieldPath=e,this.kind=t}}class nL{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new nL(0,nV.min())}}function nP(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new nV(nA.fromTimestamp(1e9===n?new nC(r+1,0):new nC(r,n)),nb.empty(),t)}function nF(e){return new nV(e.readTime,e.key,-1)}class nV{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new nV(nA.min(),nb.empty(),-1)}static max(){return new nV(nA.max(),nb.empty(),-1)}}function nB(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=nb.comparator(e.documentKey,t.documentKey))?r:nc(e.largestBatchId,t.largestBatchId)}let nU="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class nj{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function nq(e){if(e.code!==r9.FAILED_PRECONDITION||e.message!==nU)throw e;r2("LocalStore","Unexpectedly lost primary lease")}class nz{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&r8(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new nz((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof nz?t:nz.resolve(t)}catch(e){return nz.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):nz.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):nz.reject(t)}static resolve(e){return new nz((t,r)=>{t(e)})}static reject(e){return new nz((t,r)=>{r(e)})}static waitFor(e){return new nz((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=nz.resolve(!1);for(let r of e)t=t.next(e=>e?nz.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new nz((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new nz((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let nK="SimpleDb";class nG{static open(e,t,r,n){try{return new nG(t,e.transaction(n,r))}catch(e){throw new nW(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new nt,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new nW(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let r=n0(t.target.error);this.S.reject(new nW(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(r2(nK,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new nY(this.transaction.objectStore(e))}}class n${static delete(e){return r2(nK,"Removing database:",e),nX((0,r$.getGlobal)().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!(0,r$.isIndexedDBAvailable)())return!1;if(n$.F())return!0;let e=(0,r$.getUA)(),t=n$.M(e),r=nQ(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<r&&r<4.5)}static F(){return void 0!==rK.default&&"YES"===rK.default.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,12.2===n$.M((0,r$.getUA)())&&r5("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(r2(nK,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new nW(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new ne(r9.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new ne(r9.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new nW(e,n))},n.onupgradeneeded=e=>{r2(nK,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,n.transaction,e.oldVersion,this.version).next(()=>{r2(nK,"Database upgrade to version "+this.version+" complete")})}})),this.K&&(this.db.onversionchange=e=>this.K(e)),this.db}q(e){this.K=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.L(e);let t=nG.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),nz.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(r2(nK,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function nQ(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class nH{constructor(e){this.U=e,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(e){this.U=e}done(){this.$=!0}j(e){this.W=e}delete(){return nX(this.U.delete())}}class nW extends ne{constructor(e,t){super(r9.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function nJ(e){return"IndexedDbTransactionError"===e.name}class nY{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(r2(nK,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(r2(nK,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),nX(r)}add(e){return r2(nK,"ADD",this.store.name,e,e),nX(this.store.add(e))}get(e){return nX(this.store.get(e)).next(t=>(void 0===t&&(t=null),r2(nK,"GET",this.store.name,e,t),t))}delete(e){return r2(nK,"DELETE",this.store.name,e),nX(this.store.delete(e))}count(){return r2(nK,"COUNT",this.store.name),nX(this.store.count())}H(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new nz((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.J(e,(e,r)=>{t.push(r)}).next(()=>t)}}Z(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new nz((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}X(e,t){r2(nK,"DELETE ALL",this.store.name);let r=this.options(e,t);r.Y=!1;let n=this.cursor(r);return this.J(n,(e,t,r)=>r.delete())}ee(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.J(n,t)}te(e){let t=this.cursor({});return new nz((r,n)=>{t.onerror=e=>{n(n0(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}J(e,t){let r=[];return new nz((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new nH(i),a=t(i.primaryKey,i.value,s);if(a instanceof nz){let e=a.catch(e=>(s.done(),nz.reject(e)));r.push(e)}s.isDone?n():null===s.G?i.continue():i.continue(s.G)}}).next(()=>nz.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function nX(e){return new nz((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(n0(e.target.error))}})}let nZ=!1;function n0(e){let t=n$.M((0,r$.getUA)());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new ne("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return nZ||(nZ=!0,setTimeout(()=>{throw e},0)),e}}return e}let n1="IndexBackfiller";class n2{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){r2(n1,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();r2(n1,`Documents written: ${e}`)}catch(e){nJ(e)?r2(n1,"Ignoring IndexedDB error during index backfill: ",e):await nq(e)}await this.re(6e4)})}}class n5{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let r=new Set,n=t,i=!0;return nz.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return r2(n1,`Processing collection: ${t}`),this.oe(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(n,r)).next(r=>(r2(n1,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}_e(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=nF(t);nB(n,r)>0&&(r=n)}),new nV(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class n6{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}function n3(e){return null==e}function n8(e){return 0===e&&1/e==-1/0}function n4(e){return"number"==typeof e&&Number.isInteger(e)&&!n8(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function n7(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=n}}return r}(e.get(r),t);return t+"\x01\x01"}n6.ce=-1;function n9(e){let t=e.length;if(r7(t>=2,64408,{path:e}),2===t)return r7("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),ny.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>r)&&r8(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:r8(61167,{path:e})}s=t+2}return new ny(n)}let ie="remoteDocuments",it="owner",ir="owner",ii="mutationQueues",is="mutations",ia="batchId",io="userMutationsIndex",il=["userId","batchId"],iu={},ih="documentMutations",ic="remoteDocumentsV14",id=["prefixPath","collectionGroup","readTime","documentId"],ig="documentKeyIndex",im=["prefixPath","collectionGroup","documentId"],ip="collectionGroupIndex",iy=["collectionGroup","readTime","prefixPath","documentId"],iv="remoteDocumentGlobal",iw="remoteDocumentGlobalKey",ib="targets",ix="queryTargetsIndex",iE=["canonicalId","targetId"],iI="targetDocuments",iT=["targetId","path"],iS="documentTargetsIndex",i_=["path","targetId"],ik="targetGlobalKey",iC="targetGlobal",iA="collectionParents",iD=["collectionId","parent"],iN="clientMetadata",iM="bundles",iR="namedQueries",iO="indexConfiguration",iL="collectionGroupIndex",iP="indexState",iF=["indexId","uid"],iV="sequenceNumberIndex",iB=["uid","sequenceNumber"],iU="indexEntries",ij=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],iq="documentKeyIndex",iz=["indexId","uid","orderedDocumentKey"],iK="documentOverlays",iG=["userId","collectionPath","documentId"],i$="collectionPathOverlayIndex",iQ=["userId","collectionPath","largestBatchId"],iH="collectionGroupOverlayIndex",iW=["userId","collectionGroup","largestBatchId"],iJ="globals",iY=[ii,is,ih,ie,ib,it,iC,iI,iN,iv,iA,iM,iR],iX=[...iY,iK],iZ=[ii,is,ih,ic,ib,it,iC,iI,iN,iv,iA,iM,iR,iK],i0=[...iZ,iO,iP,iU],i1=[...i0,iJ];class i2 extends nj{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function i5(e,t){return n$.O(e.le,t)}function i6(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function i3(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function i8(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class i4{constructor(e,t){this.comparator=e,this.root=t||i9.EMPTY}insert(e,t){return new i4(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,i9.BLACK,null,null))}remove(e){return new i4(this.comparator,this.root.remove(e,this.comparator).copy(null,null,i9.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new i7(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new i7(this.root,e,this.comparator,!1)}getReverseIterator(){return new i7(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new i7(this.root,e,this.comparator,!0)}}class i7{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class i9{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:i9.RED,this.left=null!=n?n:i9.EMPTY,this.right=null!=i?i:i9.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new i9(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return i9.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return i9.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,i9.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,i9.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw r8(43730,{key:this.key,value:this.value});if(this.right.isRed())throw r8(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw r8(27949);return e+ +!this.isRed()}}i9.EMPTY=null,i9.RED=!0,i9.BLACK=!1,i9.EMPTY=new class{constructor(){this.size=0}get key(){throw r8(57766)}get value(){throw r8(16141)}get color(){throw r8(16727)}get left(){throw r8(29726)}get right(){throw r8(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new i9(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class se{constructor(e){this.comparator=e,this.data=new i4(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new st(this.data.getIterator())}getIteratorFrom(e){return new st(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof se)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new se(this.comparator);return t.data=e,t}}class st{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sr(e){return e.hasNext()?e.getNext():void 0}class sn{constructor(e){this.fields=e,e.sort(nw.comparator)}static empty(){return new sn([])}unionWith(e){let t=new se(nw.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new sn(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ng(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class si extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ss{constructor(e){this.binaryString=e}static fromBase64String(e){return new ss(function(e){try{return atob(e)}catch(e){throw"u">typeof DOMException&&e instanceof DOMException?new si("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new ss(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return nc(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ss.EMPTY_BYTE_STRING=new ss("");let sa=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function so(e){if(r7(!!e,39018),"string"==typeof e){let t=0,r=sa.exec(e);if(r7(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:sl(e.seconds),nanos:sl(e.nanos)}}function sl(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function su(e){return"string"==typeof e?ss.fromBase64String(e):ss.fromUint8Array(e)}let sh="server_timestamp",sc="__type__",sd="__previous_value__",sf="__local_write_time__";function sg(e){return(e?.mapValue?.fields||{})[sc]?.stringValue===sh}function sm(e){let t=e.mapValue.fields[sd];return sg(t)?sm(t):t}function sp(e){let t=so(e.mapValue.fields[sf].timestampValue);return new nC(t.seconds,t.nanos)}class sy{constructor(e,t,r,n,i,s,a,o,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u,this.apiKey=h}}let sv="(default)";class sw{constructor(e,t){this.projectId=e,this.database=t||sv}static empty(){return new sw("","")}get isDefaultDatabase(){return this.database===sv}isEqual(e){return e instanceof sw&&e.projectId===this.projectId&&e.database===this.database}}let sb="__type__",sx="__max__",sE={mapValue:{fields:{__type__:{stringValue:sx}}}},sI="__vector__",sT="value",sS={nullValue:"NULL_VALUE"};function s_(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?sg(e)?4:sj(e)?0x1fffffffffffff:sB(e)?10:11:r8(28295,{value:e})}function sk(e,t){if(e===t)return!0;let r=s_(e);if(r!==s_(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return sp(e).isEqual(sp(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=so(e.timestampValue),i=so(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return su(e.bytesValue).isEqual(su(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return sl(e.geoPointValue.latitude)===sl(t.geoPointValue.latitude)&&sl(e.geoPointValue.longitude)===sl(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return sl(e.integerValue)===sl(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=sl(e.doubleValue),n=sl(t.doubleValue);return r===n?n8(r)===n8(n):isNaN(r)&&isNaN(n)}return!1;case 9:return ng(e.arrayValue.values||[],t.arrayValue.values||[],sk);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(i6(s)!==i6(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!sk(s[e],a[e])))return!1;return!0;default:return r8(52216,{left:e})}}function sC(e,t){return void 0!==(e.values||[]).find(e=>sk(e,t))}function sA(e,t){var r,n,i,s,a,o;if(e===t)return 0;let l=s_(e),u=s_(t);if(l!==u)return nc(l,u);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return nc(e.booleanValue,t.booleanValue);case 2:let h,c;return h=sl(e.integerValue||e.doubleValue),h<(c=sl(t.integerValue||t.doubleValue))?-1:h>c?1:h===c?0:isNaN(h)?isNaN(c)?0:-1:1;case 3:return sD(e.timestampValue,t.timestampValue);case 4:return sD(sp(e),sp(t));case 5:return nd(e.stringValue,t.stringValue);case 6:let d,f;return r=e.bytesValue,n=t.bytesValue,d=su(r),f=su(n),d.compareTo(f);case 7:return function(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=nc(r[e],n[e]);if(0!==t)return t}return nc(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:let g;return i=e.geoPointValue,s=t.geoPointValue,0!==(g=nc(sl(i.latitude),sl(s.latitude)))?g:nc(sl(i.longitude),sl(s.longitude));case 9:return sN(e.arrayValue,t.arrayValue);case 10:let m,p,y,v,w;return a=e.mapValue,o=t.mapValue,m=a.fields||{},p=o.fields||{},y=m[sT]?.arrayValue,v=p[sT]?.arrayValue,0!==(w=nc(y?.values?.length||0,v?.values?.length||0))?w:sN(y,v);case 11:return function(e,t){if(e===sE.mapValue&&t===sE.mapValue)return 0;if(e===sE.mapValue)return 1;if(t===sE.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=nd(n[e],s[e]);if(0!==t)return t;let a=sA(r[n[e]],i[s[e]]);if(0!==a)return a}return nc(n.length,s.length)}(e.mapValue,t.mapValue);default:throw r8(23264,{he:l})}}function sD(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return nc(e,t);let r=so(e),n=so(t),i=nc(r.seconds,n.seconds);return 0!==i?i:nc(r.nanos,n.nanos)}function sN(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=sA(r[e],n[e]);if(t)return t}return nc(r.length,n.length)}function sM(e){var t,r;let n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(n=so(e.timestampValue),`time(${n.seconds},${n.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?su(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,nb.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=sM(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${sM(e.fields[i])}`;return r+"}"}(e.mapValue):r8(61005,{value:e})}function sR(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function sO(e){return!!e&&"integerValue"in e}function sL(e){return!!e&&"arrayValue"in e}function sP(e){return!!e&&"nullValue"in e}function sF(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function sV(e){return!!e&&"mapValue"in e}function sB(e){return(e?.mapValue?.fields||{})[sb]?.stringValue===sI}function sU(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return i3(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=sU(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=sU(e.arrayValue.values[r]);return t}return{...e}}function sj(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===sx}let sq={mapValue:{fields:{[sb]:{stringValue:sI},[sT]:{arrayValue:{}}}}};function sz(e,t){let r=sA(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function sK(e,t){let r=sA(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class sG{constructor(e){this.value=e}static empty(){return new sG({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!sV(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=sU(t)}setAll(e){let t=nw.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=sU(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());sV(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return sk(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];sV(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(i3(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new sG(sU(this.value))}}class s${constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new s$(e,0,nA.min(),nA.min(),nA.min(),sG.empty(),0)}static newFoundDocument(e,t,r,n){return new s$(e,1,t,nA.min(),r,n,0)}static newNoDocument(e,t){return new s$(e,2,t,nA.min(),nA.min(),sG.empty(),0)}static newUnknownDocument(e,t){return new s$(e,3,t,nA.min(),nA.min(),sG.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(nA.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=sG.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=sG.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=nA.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof s$&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new s$(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class sQ{constructor(e,t){this.position=e,this.inclusive=t}}function sH(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?nb.comparator(nb.fromName(a.referenceValue),r.key):sA(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function sW(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!sk(e.position[r],t.position[r]))return!1;return!0}class sJ{constructor(e,t="asc"){this.field=e,this.dir=t}}class sY{}class sX extends sY{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new s3(e,t,r):"array-contains"===t?new s9(e,r):"in"===t?new ae(e,r):"not-in"===t?new at(e,r):"array-contains-any"===t?new ar(e,r):new sX(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new s8(e,r):new s4(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(sA(t,this.value)):null!==t&&s_(this.value)===s_(t)&&this.matchesComparison(sA(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return r8(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class sZ extends sY{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new sZ(e,t)}matches(e){return s0(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function s0(e){return"and"===e.op}function s1(e){return"or"===e.op}function s2(e){return s5(e)&&s0(e)}function s5(e){for(let t of e.filters)if(t instanceof sZ)return!1;return!0}function s6(e,t){let r=e.filters.concat(t);return sZ.create(r,e.op)}class s3 extends sX{constructor(e,t,r){super(e,t,r),this.key=nb.fromName(r.referenceValue)}matches(e){let t=nb.comparator(e.key,this.key);return this.matchesComparison(t)}}class s8 extends sX{constructor(e,t){super(e,"in",t),this.keys=s7("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class s4 extends sX{constructor(e,t){super(e,"not-in",t),this.keys=s7("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function s7(e,t){return(t.arrayValue?.values||[]).map(e=>nb.fromName(e.referenceValue))}class s9 extends sX{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return sL(t)&&sC(t.arrayValue,this.value)}}class ae extends sX{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&sC(this.value.arrayValue,t)}}class at extends sX{constructor(e,t){super(e,"not-in",t)}matches(e){if(sC(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!sC(this.value.arrayValue,t)}}class ar extends sX{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!sL(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>sC(this.value.arrayValue,e))}}class an{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function ai(e,t=null,r=[],n=[],i=null,s=null,a=null){return new an(e,t,r,n,i,s,a)}function as(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof sX)return t.field.canonicalString()+t.op.toString()+sM(t.value);if(s2(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),n3(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>sM(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>sM(e)).join(",")),e.Te=t}return e.Te}function aa(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var r,n;if(r=e.orderBy[i],n=t.orderBy[i],!(r.dir===n.dir&&r.field.isEqual(n.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof sX?r instanceof sX&&t.op===r.op&&t.field.isEqual(r.field)&&sk(t.value,r.value):t instanceof sZ?r instanceof sZ&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,n,i)=>t&&e(n,r.filters[i]),!0):void r8(19439)}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!sW(e.startAt,t.startAt)&&sW(e.endAt,t.endAt)}function ao(e){return nb.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function al(e,t){return e.filters.filter(e=>e instanceof sX&&e.field.isEqual(t))}function au(e,t,r){let n=sS,i=!0;for(let r of al(e,t)){let e=sS,t=!0;switch(r.op){case"<":case"<=":var s;e="nullValue"in(s=r.value)?sS:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?sR(sw.empty(),nb.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?sB(s)?sq:{mapValue:{}}:r8(35942,{value:s});break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=sS}0>sz({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>sz({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function ah(e,t,r){let n=sE,i=!0;for(let r of al(e,t)){let e=sE,t=!0;switch(r.op){case">=":case">":var s;e="nullValue"in(s=r.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?sR(sw.empty(),nb.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?sq:"mapValue"in s?sB(s)?{mapValue:{}}:sE:r8(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=sE}sK({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];sK({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}class ac{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function ad(e){return new ac(e)}function af(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ag(e){return null!==e.collectionGroup}function am(e){if(null===e.Ie){let t;e.Ie=[];let r=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),r.add(t.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new se(nw.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new sJ(t,n))}),r.has(nw.keyField().canonicalString())||e.Ie.push(new sJ(nw.keyField(),n))}return e.Ie}function ap(e){return e.Ee||(e.Ee=ay(e,am(e))),e.Ee}function ay(e,t){if("F"===e.limitType)return ai(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new sJ(e.field,t)});let r=e.endAt?new sQ(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new sQ(e.startAt.position,e.startAt.inclusive):null;return ai(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function av(e,t){let r=e.filters.concat([t]);return new ac(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function aw(e,t,r){return new ac(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function ab(e,t){return aa(ap(e),ap(t))&&e.limitType===t.limitType}function ax(e){return`${as(ap(e))}|lt:${e.limitType}`}function aE(e){var t;let r;return`Query(target=${r=(t=ap(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof sX?`${t.field.canonicalString()} ${t.op} ${sM(t.value)}`:t instanceof sZ?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),n3(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(e=>sM(e)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(e=>sM(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function aI(e,t){var r,n,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):nb.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let r of am(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(r=e,n=t,(!r.startAt||(i=r.startAt,o=sH(i,am(r),n),i.inclusive?!!(o<=0):!!(o<0)))&&(!r.endAt||(s=r.endAt,l=sH(s,am(r),n),s.inclusive?!!(l>=0):!!(l>0))))}function aT(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function aS(e){return(t,r)=>{let n=!1;for(let i of am(e)){let e=function(e,t,r){var n;let i,s,a=e.field.isKeyField()?nb.comparator(t.key,r.key):(n=e.field,i=t.data.field(n),s=r.data.field(n),null!==i&&null!==s?sA(i,s):r8(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return r8(19790,{direction:e.dir})}}(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class a_{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){i3(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return i8(this.inner)}size(){return this.innerSize}}let ak=new i4(nb.comparator),aC=new i4(nb.comparator);function aA(...e){let t=aC;for(let r of e)t=t.insert(r.key,r);return t}function aD(e){let t=aC;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function aN(){return new a_(e=>e.toString(),(e,t)=>e.isEqual(t))}let aM=new i4(nb.comparator),aR=new se(nb.comparator);function aO(...e){let t=aR;for(let r of e)t=t.add(r);return t}let aL=new se(nc);function aP(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:n8(t)?"-0":t}}function aF(e){return{integerValue:""+e}}class aV{constructor(){this._=void 0}}function aB(e,t){return e instanceof aG?sO(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class aU extends aV{}class aj extends aV{constructor(e){super(),this.elements=e}}function aq(e,t){let r=aQ(t);for(let t of e.elements)r.some(e=>sk(e,t))||r.push(t);return{arrayValue:{values:r}}}class az extends aV{constructor(e){super(),this.elements=e}}function aK(e,t){let r=aQ(t);for(let t of e.elements)r=r.filter(e=>!sk(e,t));return{arrayValue:{values:r}}}class aG extends aV{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function a$(e){return sl(e.integerValue||e.doubleValue)}function aQ(e){return sL(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class aH{constructor(e,t){this.field=e,this.transform=t}}class aW{constructor(e,t){this.version=e,this.transformResults=t}}class aJ{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new aJ}static exists(e){return new aJ(void 0,e)}static updateTime(e){return new aJ(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function aY(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class aX{}function aZ(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new a4(e.key,aJ.none()):new a2(e.key,e.data,aJ.none());{let r=e.data,n=sG.empty(),i=new se(nw.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new a5(e.key,n,new sn(i.toArray()),aJ.none())}}function a0(e,t,r,n){return e instanceof a2?function(e,t,r,n){if(!aY(e.precondition,t))return r;let i=e.value.clone(),s=a8(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,r,n):e instanceof a5?function(e,t,r,n){if(!aY(e.precondition,t))return r;let i=a8(e.fieldTransforms,n,t),s=t.data;return(s.setAll(a6(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):aY(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function a1(e,t){var r,n;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||!(!r||!n)&&ng(r,n,(e,t)=>{var r,n;return e.field.isEqual(t.field)&&(r=e.transform,n=t.transform,r instanceof aj&&n instanceof aj||r instanceof az&&n instanceof az?ng(r.elements,n.elements,sk):r instanceof aG&&n instanceof aG?sk(r.Ae,n.Ae):r instanceof aU&&n instanceof aU)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class a2 extends aX{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class a5 extends aX{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function a6(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function a3(e,t,r){let n=new Map;r7(e.length===r.length,32656,{Ve:r.length,de:e.length});for(let s=0;s<r.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);n.set(a.field,(i=r[s],o instanceof aj?aq(o,l):o instanceof az?aK(o,l):i))}return n}function a8(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,function(e,t,r){var n;let i,s,a;return e instanceof aU?(n=t,i={fields:{[sc]:{stringValue:sh},[sf]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}},n&&sg(n)&&(n=sm(n)),n&&(i.fields[sd]=n),{mapValue:i}):e instanceof aj?aq(e,t):e instanceof az?aK(e,t):(a=a$(s=aB(e,t))+a$(e.Ae),sO(s)&&sO(e.Ae)?aF(a):aP(e.serializer,a))}(e,s,t))}return n}class a4 extends aX{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class a7 extends aX{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class a9{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&function(e,t,r){let n,i;e instanceof a2?(n=e.value.clone(),i=a3(e.fieldTransforms,t,r.transformResults),n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()):e instanceof a5?function(e,t,r){if(!aY(e.precondition,t))return t.convertToUnknownDocument(r.version);let n=a3(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(a6(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}(e,t,r):t.convertToNoDocument(r.version).setHasCommittedMutations()}(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=a0(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=a0(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=aN();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=aZ(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(nA.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),aO())}isEqual(e){return this.batchId===e.batchId&&ng(this.mutations,e.mutations,(e,t)=>a1(e,t))&&ng(this.baseMutations,e.baseMutations,(e,t)=>a1(e,t))}}class oe{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){r7(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let n=aM,i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new oe(e,t,r,n)}}class ot{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class or{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class on{constructor(e,t){this.count=e,this.unchangedNames=t}}function oi(e){switch(e){case r9.OK:return r8(64938);case r9.CANCELLED:case r9.UNKNOWN:case r9.DEADLINE_EXCEEDED:case r9.RESOURCE_EXHAUSTED:case r9.INTERNAL:case r9.UNAVAILABLE:case r9.UNAUTHENTICATED:return!1;case r9.INVALID_ARGUMENT:case r9.NOT_FOUND:case r9.ALREADY_EXISTS:case r9.PERMISSION_DENIED:case r9.FAILED_PRECONDITION:case r9.ABORTED:case r9.OUT_OF_RANGE:case r9.UNIMPLEMENTED:case r9.DATA_LOSS:return!0;default:return r8(15467,{code:e})}}function os(e){if(void 0===e)return r5("GRPC error has no .code"),r9.UNKNOWN;switch(e){case M.OK:return r9.OK;case M.CANCELLED:return r9.CANCELLED;case M.UNKNOWN:return r9.UNKNOWN;case M.DEADLINE_EXCEEDED:return r9.DEADLINE_EXCEEDED;case M.RESOURCE_EXHAUSTED:return r9.RESOURCE_EXHAUSTED;case M.INTERNAL:return r9.INTERNAL;case M.UNAVAILABLE:return r9.UNAVAILABLE;case M.UNAUTHENTICATED:return r9.UNAUTHENTICATED;case M.INVALID_ARGUMENT:return r9.INVALID_ARGUMENT;case M.NOT_FOUND:return r9.NOT_FOUND;case M.ALREADY_EXISTS:return r9.ALREADY_EXISTS;case M.PERMISSION_DENIED:return r9.PERMISSION_DENIED;case M.FAILED_PRECONDITION:return r9.FAILED_PRECONDITION;case M.ABORTED:return r9.ABORTED;case M.OUT_OF_RANGE:return r9.OUT_OF_RANGE;case M.UNIMPLEMENTED:return r9.UNIMPLEMENTED;case M.DATA_LOSS:return r9.DATA_LOSS;default:return r8(39323,{code:e})}}(R=M||(M={}))[R.OK=0]="OK",R[R.CANCELLED=1]="CANCELLED",R[R.UNKNOWN=2]="UNKNOWN",R[R.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",R[R.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",R[R.NOT_FOUND=5]="NOT_FOUND",R[R.ALREADY_EXISTS=6]="ALREADY_EXISTS",R[R.PERMISSION_DENIED=7]="PERMISSION_DENIED",R[R.UNAUTHENTICATED=16]="UNAUTHENTICATED",R[R.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",R[R.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",R[R.ABORTED=10]="ABORTED",R[R.OUT_OF_RANGE=11]="OUT_OF_RANGE",R[R.UNIMPLEMENTED=12]="UNIMPLEMENTED",R[R.INTERNAL=13]="INTERNAL",R[R.UNAVAILABLE=14]="UNAVAILABLE",R[R.DATA_LOSS=15]="DATA_LOSS";let oa=null;function oo(){return new TextEncoder}let ol=new E([0xffffffff,0xffffffff],0);function ou(e){let t=oo().encode(e),r=new I;return r.update(t),new Uint8Array(r.digest())}function oh(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new E([r,n],0),new E([i,s],0)]}class oc{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new od(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new od(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new od(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=E.fromNumber(this.ge)}ye(e,t,r){let n=e.add(t.multiply(E.fromNumber(r)));return 1===n.compare(ol)&&(n=new E([n.getBits(0),n.getBits(1)],0)),n.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,r]=oh(ou(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);if(!this.we(n))return!1}return!0}static create(e,t,r){let n=new oc(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>n.insert(e)),n}insert(e){if(0===this.ge)return;let[t,r]=oh(ou(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);this.be(n)}}be(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class od extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class of{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,og.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new of(nA.min(),n,new i4(nc),ak,aO())}}class og{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new og(r,t,aO(),aO(),aO())}}class om{constructor(e,t,r,n){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=n}}class op{constructor(e,t){this.targetId=e,this.Ce=t}}class oy{constructor(e,t,r=ss.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class ov{constructor(){this.ve=0,this.Fe=ox(),this.Me=ss.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=aO(),t=aO(),r=aO();return this.Fe.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:r8(38017,{changeType:i})}}),new og(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=ox()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,r7(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class ow{constructor(e){this.Ge=e,this.ze=new Map,this.je=ak,this.He=ob(),this.Je=ob(),this.Ze=new i4(nc)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:r8(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,r)=>{this.rt(r)&&t(r)})}st(e){let t=e.targetId,r=e.Ce.count,n=this.ot(t);if(n){let a=n.target;if(ao(a))if(0===r){let e=new nb(a.path);this.et(t,e,s$.newNoDocument(e,nA.min()))}else r7(1===r,20013,{expectedCount:r});else{let n=this._t(t);if(n!==r){var i,s;let r,a,o=this.ut(e),l=o?this.ct(o,e,n):1;0!==l&&(this.it(t),this.Ze=this.Ze.insert(t,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),oa?.lt((i=e.Ce,s=this.Ge.ht(),r={localCacheCount:n,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(a=i.unchangedNames)&&(r.bloomFilter={applied:0===l,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>o?.mightContain(e)??!1}),r))}}}}ut(e){let t,r,n=e.Ce.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=su(i).toUint8Array()}catch(e){if(e instanceof si)return r6("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new oc(t,s,a)}catch(e){return r6(e instanceof od?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.ge?null:r}ct(e,t,r){return 2*(t.Ce.count!==r-this.Pt(e,t.targetId))}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;e.mightContain(s)||(this.et(t,r,null),n++)}),n}Tt(e){let t=new Map;this.ze.forEach((r,n)=>{let i=this.ot(n);if(i){if(r.current&&ao(i.target)){let t=new nb(i.target.path);this.It(t).has(n)||this.Et(n,t)||this.et(n,t,s$.newNoDocument(t,e))}r.Be&&(t.set(n,r.ke()),r.Ke())}});let r=aO();this.Je.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.je.forEach((t,r)=>r.setReadTime(e));let n=new of(e,t,this.Ze,this.je,r);return this.je=ak,this.He=ob(),this.Je=ob(),this.Ze=new i4(nc),n}Ye(e,t){if(!this.rt(e))return;let r=2*!!this.Et(e,t.key);this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let n=this.nt(e);this.Et(e,t)?n.qe(t,1):n.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new ov,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new se(nc),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new se(nc),this.He=this.He.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||r2("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new ov),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ob(){return new i4(nb.comparator)}function ox(){return new i4(nb.comparator)}let oE={asc:"ASCENDING",desc:"DESCENDING"},oI={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},oT={and:"AND",or:"OR"};class oS{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function o_(e,t){return e.useProto3Json||n3(t)?t:{value:t}}function ok(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function oC(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function oA(e){let t;return r7(!!e,49232),nA.fromTimestamp(new nC((t=so(e)).seconds,t.nanos))}function oD(e,t){return oN(e,t).canonicalString()}function oN(e,t){let r=new ny(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function oM(e){let t=ny.fromString(e);return r7(oH(t),10190,{key:t.toString()}),t}function oR(e,t){return oD(e.databaseId,t.path)}function oO(e,t){let r=oM(t);if(r.get(1)!==e.databaseId.projectId)throw new ne(r9.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new ne(r9.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new nb(oV(r))}function oL(e,t){return oD(e.databaseId,t)}function oP(e){let t=oM(e);return 4===t.length?ny.emptyPath():oV(t)}function oF(e){return new ny(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function oV(e){return r7(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function oB(e,t,r){return{name:oR(e,t),fields:r.value.mapValue.fields}}function oU(e,t,r){let n=oO(e,t.name),i=oA(t.updateTime),s=t.createTime?oA(t.createTime):nA.min(),a=new sG({mapValue:{fields:t.fields}}),o=s$.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function oj(e,t){var r,n;let i;if(t instanceof a2)i={update:oB(e,t.key,t.value)};else if(t instanceof a4)i={delete:oR(e,t.key)};else if(t instanceof a5){let r;i={update:oB(e,t.key,t.data),updateMask:(n=t.fieldMask,r=[],n.fields.forEach(e=>r.push(e.canonicalString())),{fieldPaths:r})}}else{if(!(t instanceof a7))return r8(16599,{dt:t.type});i={verify:oR(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof aU)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof aj)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof az)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof aG)return{fieldPath:t.field.canonicalString(),increment:r.Ae};throw r8(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:ok(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:r8(27497)),i}function oq(e,t){var r;let n=t.currentDocument?void 0!==(r=t.currentDocument).updateTime?aJ.updateTime(oA(r.updateTime)):void 0!==r.exists?aJ.exists(r.exists):aJ.none():aJ.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let r;return r=null,"setToServerValue"in t?(r7("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new aU):"appendMissingElements"in t?r=new aj(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new az(t.removeAllFromArray.values||[]):"increment"in t?r=new aG(e,t.increment):r8(16584,{proto:t}),new aH(nw.fromServerFormat(t.fieldPath),r)}):[];if(t.update){t.update.name;let r=oO(e,t.update.name),s=new sG({mapValue:{fields:t.update.fields}});return t.updateMask?new a5(r,s,new sn((t.updateMask.fieldPaths||[]).map(e=>nw.fromServerFormat(e))),n,i):new a2(r,s,n,i)}return t.delete?new a4(oO(e,t.delete),n):t.verify?new a7(oO(e,t.verify),n):r8(1463,{proto:t})}function oz(e,t){return{documents:[oL(e,t.path)]}}function oK(e,t){var r,n;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=oL(e,i);let o=function(e){if(0!==e.length)return function e(t){var r;let n;return t instanceof sX?function(e){if("=="===e.op){if(sF(e.value))return{unaryFilter:{field:o$(e.field),op:"IS_NAN"}};if(sP(e.value))return{unaryFilter:{field:o$(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(sF(e.value))return{unaryFilter:{field:o$(e.field),op:"IS_NOT_NAN"}};if(sP(e.value))return{unaryFilter:{field:o$(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:o$(e.field),op:oI[e.op],value:e.value}}}(t):t instanceof sZ?1===(n=(r=t).getFilters().map(t=>e(t))).length?n[0]:{compositeFilter:{op:oT[r.op],filters:n}}:r8(54877,{filter:t})}(sZ.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:o$(e.field),direction:oE[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=o_(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(r=t.startAt).inclusive,values:r.position}),t.endAt&&(s.structuredQuery.endAt={before:!(n=t.endAt).inclusive,values:n.position}),{ft:s,parent:i}}function oG(e){var t,r,n;let i,s,a,o,l=oP(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){r7(1===h,65062);let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=oQ(e.unaryFilter.field);return sX.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=oQ(e.unaryFilter.field);return sX.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=oQ(e.unaryFilter.field);return sX.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=oQ(e.unaryFilter.field);return sX.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return r8(61313);default:return r8(60726)}}(t):void 0!==t.fieldFilter?sX.create(oQ(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return r8(58110);default:return r8(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?sZ.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return r8(1026)}}(t.compositeFilter.op)):r8(30097,{filter:t})}(u.where))instanceof sZ&&s2(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new sJ(oQ(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let g=null;u.limit&&(g=n3(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let m=null;u.startAt&&(a=!!(r=u.startAt).before,m=new sQ(r.values||[],a));let p=null;return u.endAt&&(o=!(n=u.endAt).before,p=new sQ(n.values||[],o)),new ac(l,c,f,d,g,"F",m,p)}function o$(e){return{fieldPath:e.canonicalString()}}function oQ(e){return nw.fromServerFormat(e.fieldPath)}function oH(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function oW(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class oJ{constructor(e,t,r,n,i=nA.min(),s=nA.min(),a=ss.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new oJ(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new oJ(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new oJ(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new oJ(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class oY{constructor(e){this.yt=e}}function oX(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:oZ(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;n.document={name:oR(i=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:ok(i,t.version.toTimestamp()),createTime:ok(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:o0(t.version)};else{if(!t.isUnknownDocument())return r8(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:o0(t.version)}}return n}function oZ(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function o0(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function o1(e){let t=new nC(e.seconds,e.nanoseconds);return nA.fromTimestamp(t)}function o2(e,t){let r=(t.baseMutations||[]).map(t=>oq(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>oq(e.yt,t)),i=nC.fromMillis(t.localWriteTimeMs);return new a9(t.batchId,i,r,n)}function o5(e){var t;let r,n=o1(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?o1(e.lastLimboFreeSnapshotVersion):nA.min();return new oJ(void 0!==e.query.documents?(r7(1===(r=(t=e.query).documents.length),1966,{count:r}),ap(ad(oP(t.documents[0])))):ap(oG(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,i,ss.fromBase64String(e.resumeToken))}function o6(e,t){let r,n=o0(t.snapshotVersion),i=o0(t.lastLimboFreeSnapshotVersion);r=ao(t.target)?oz(e.yt,t.target):oK(e.yt,t.target).ft;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:as(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function o3(e){let t=oG({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?aw(t,t.limit,"L"):t}function o8(e,t){return new ot(t.largestBatchId,oq(e.yt,t.overlayMutation))}function o4(e,t){let r=t.path.lastSegment();return[e,n7(t.path.popLast()),r]}function o7(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:o0(n.readTime),documentKey:n7(n.documentKey.path),largestBatchId:n.largestBatchId}}class o9{getBundleMetadata(e,t){return i5(e,iM).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:o1(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return i5(e,iM).put({bundleId:t.id,createTime:o0(oA(t.createTime)),version:t.version})}getNamedQuery(e,t){return i5(e,iR).get(t).next(e=>{if(e)return{name:e.name,query:o3(e.bundledQuery),readTime:o1(e.readTime)}})}saveNamedQuery(e,t){return i5(e,iR).put({name:t.name,readTime:o0(oA(t.readTime)),bundledQuery:t.bundledQuery})}}class le{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){return new le(e,t.uid||"")}getOverlay(e,t){return i5(e,iK).get(o4(this.userId,t)).next(e=>e?o8(this.serializer,e):null)}getOverlays(e,t){let r=aN();return nz.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new ot(t,i);n.push(this.bt(e,s))}),nz.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(n7(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(i5(e,iK).X(i$,n))}),nz.waitFor(i)}getOverlaysForCollection(e,t,r){let n=aN(),i=n7(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,1/0],!0);return i5(e,iK).H(i$,s).next(e=>{for(let t of e){let e=o8(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=aN(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return i5(e,iK).ee({index:iH,range:a},(e,t,r)=>{let a=o8(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}bt(e,t){return i5(e,iK).put(function(e,t,r){let[n,i,s]=o4(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:oj(e.yt,r.mutation)}}(this.serializer,this.userId,t))}}class lt{St(e){return i5(e,iJ)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{let t=e?.value;return t?ss.fromUint8Array(t):ss.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class lr{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(sl(e.integerValue));else if("doubleValue"in e){let r=sl(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),n8(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),"string"==typeof r&&(r=so(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(su(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?sj(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):sB(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):r8(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let r=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(r)))this.Ot(e,t),this.Ct(r[e],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let n=r[sT].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(sl(n)),this.Ot(sT,t),this.Ct(r[sT],t)}qt(e,t){let r=e.values||[];for(let e of(this.Ft(t,50),r))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),nb.fromName(e).path.forEach(e=>{this.Ft(t,60),this.$t(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function ln(e){return Math.ceil((64-function(e){let t=0;for(let r=0;r<8;++r){let n=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e))/8)}lr.Wt=new lr;class li{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ht(r.value),r=t.next();this.Jt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Xt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ht(e);else if(e<2048)this.Ht(960|e>>>6),this.Ht(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Ht(480|e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e);else{let e=t.codePointAt(0);this.Ht(240|e>>>18),this.Ht(128|63&e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e)}}this.Jt()}Yt(e){let t=this.en(e),r=ln(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),r=ln(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t,r=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),n=!!(128&r[0]);r[0]^=n?255:128;for(let e=1;e<r.length;++e)r[e]^=255*!!n;return r}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Ht(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class ls{constructor(e){this.cn=e}Bt(e){this.cn.Qt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.Yt(e)}vt(){this.cn.rn()}}class la{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Xt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class lo{constructor(){this.cn=new li,this.ascending=new ls(this.cn),this.descending=new la(this.cn)}seed(e){this.cn.seed(e)}ln(e){return 0===e?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class ll{constructor(e,t,r,n){this.hn=e,this.Pn=t,this.Tn=r,this.In=n}En(){let e=this.In.length,t=0===e||255===this.In[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.In,0),t!==e?r.set([0],this.In.length):++r[r.length-1],new ll(this.hn,this.Pn,this.Tn,r)}Rn(e,t,r){return{indexId:this.hn,uid:e,arrayValue:lc(this.Tn),directionalValue:lc(this.In),orderedDocumentKey:lc(t),documentKey:r.path.toArray()}}An(e,t,r){let n=this.Rn(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function lu(e,t){let r=e.hn-t.hn;return 0!==r||0!==(r=lh(e.Tn,t.Tn))||0!==(r=lh(e.In,t.In))?r:nb.comparator(e.Pn,t.Pn)}function lh(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function lc(e){return(0,r$.isSafariOrWebkit)()?function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(e):e}function ld(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e)}class lf{constructor(e){for(const t of(this.Vn=new se((e,t)=>nw.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.mn=[],e.filters))t.isInequality()?this.Vn=this.Vn.add(t):this.mn.push(t)}get fn(){return this.Vn.size>1}gn(e){if(r7(e.collectionGroup===this.collectionId,49279),this.fn)return!1;let t=nN(e);if(void 0!==t&&!this.pn(t))return!1;let r=nM(e),n=new Set,i=0,s=0;for(;i<r.length&&this.pn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Vn.size>0){let e=this.Vn.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.yn(e,t)||!this.wn(this.dn[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.dn.length||!this.wn(this.dn[s++],e))return!1}return!0}bn(){if(this.fn)return null;let e=new se(nw.comparator),t=[];for(let r of this.mn)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new nO(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new nO(r.field,0))}for(let r of this.dn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new nO(r.field,+("asc"!==r.dir))));return new nD(nD.UNKNOWN_ID,this.collectionId,t,nL.empty())}pn(e){for(let t of this.mn)if(this.yn(t,e))return!0;return!1}yn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}wn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function lg(e){return e instanceof sX}function lm(e){return e instanceof sZ&&s2(e)}function lp(e){return lg(e)||lm(e)||function(e){if(e instanceof sZ&&s1(e)){for(let t of e.getFilters())if(!lg(t)&&!lm(t))return!1;return!0}return!1}(e)}function ly(e,t){return r7(e instanceof sX||e instanceof sZ,38388),r7(t instanceof sX||t instanceof sZ,25473),lw(e instanceof sX?t instanceof sX?sZ.create([e,t],"and"):lv(e,t):t instanceof sX?lv(t,e):function(e,t){if(r7(e.filters.length>0&&t.filters.length>0,48005),s0(e)&&s0(t))return s6(e,t.getFilters());let r=s1(e)?e:t,n=s1(e)?t:e,i=r.filters.map(e=>ly(e,n));return sZ.create(i,"or")}(e,t))}function lv(e,t){if(s0(t))return s6(t,e.getFilters());{let r=t.filters.map(t=>ly(e,t));return sZ.create(r,"or")}}function lw(e){if(r7(e instanceof sX||e instanceof sZ,11850),e instanceof sX)return e;let t=e.getFilters();if(1===t.length)return lw(t[0]);if(s5(e))return e;let r=t.map(e=>lw(e)),n=[];return r.forEach(t=>{t instanceof sX?n.push(t):t instanceof sZ&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length?n[0]:sZ.create(n,e.op)}class lb{constructor(){this.Sn=new lx}addToCollectionParentIndex(e,t){return this.Sn.add(t),nz.resolve()}getCollectionParents(e,t){return nz.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return nz.resolve()}deleteFieldIndex(e,t){return nz.resolve()}deleteAllFieldIndexes(e){return nz.resolve()}createTargetIndexes(e,t){return nz.resolve()}getDocumentsMatchingTarget(e,t){return nz.resolve(null)}getIndexType(e,t){return nz.resolve(0)}getFieldIndexes(e,t){return nz.resolve([])}getNextCollectionGroupToUpdate(e){return nz.resolve(null)}getMinOffset(e,t){return nz.resolve(nV.min())}getMinOffsetFromCollectionGroup(e,t){return nz.resolve(nV.min())}updateCollectionGroup(e,t,r){return nz.resolve()}updateIndexEntries(e,t){return nz.resolve()}}class lx{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new se(ny.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new se(ny.comparator)).toArray()}}let lE="IndexedDbIndexManager",lI=new Uint8Array(0);class lT{constructor(e,t){this.databaseId=t,this.Dn=new lx,this.Cn=new a_(e=>as(e),(e,t)=>aa(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Dn.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.Dn.add(t)});let i={collectionId:r,parent:n7(n)};return i5(e,iA).put(i)}return nz.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return i5(e,iA).H(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(n9(n.parent))}return r})}addFieldIndex(e,t){let r=i5(e,iO),n={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;let i=r.add(n);if(t.indexState){let r=i5(e,iP);return i.next(e=>{r.put(o7(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=i5(e,iO),n=i5(e,iP),i=i5(e,iU);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=i5(e,iO),r=i5(e,iU),n=i5(e,iP);return t.X().next(()=>r.X()).next(()=>n.X())}createTargetIndexes(e,t){return nz.forEach(this.vn(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new lf(t).bn();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=i5(e,iU),n=!0,i=new Map;return nz.forEach(this.vn(t),t=>this.Fn(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(n){let e=aO(),n=[];return nz.forEach(i,(i,s)=>{r2(lE,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${as(t)}`);let a=function(e,t){let r=nN(t);if(void 0===r)return null;for(let t of al(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let r=new Map;for(let n of nM(t))for(let t of al(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}(s,i),l=function(e,t){let r=[],n=!0;for(let i of nM(t)){let t=0===i.kind?au(e,i.fieldPath,e.startAt):ah(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new sQ(r,n)}(s,i),u=function(e,t){let r=[],n=!0;for(let i of nM(t)){let t=0===i.kind?ah(e,i.fieldPath,e.endAt):au(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new sQ(r,n)}(s,i),h=this.Mn(i,s,l),c=this.Mn(i,s,u),d=this.xn(i,s,o),f=this.On(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return nz.forEach(f,i=>r.Z(i,t.limit).next(t=>{t.forEach(t=>{let r=nb.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}return nz.resolve(null)})}vn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(r7(t instanceof sX||t instanceof sZ,34018),t instanceof sX)return t;if(1===t.filters.length)return e(t.filters[0]);let r=t.filters.map(t=>e(t)),n=sZ.create(r,t.op);return lp(n=lw(n))?n:(r7(n instanceof sZ,64498),r7(s0(n),40251),r7(n.filters.length>1,57927),n.filters.reduce((e,t)=>ly(e,t)))}(function e(t){if(r7(t instanceof sX||t instanceof sZ,20012),t instanceof sX){if(t instanceof ae){let e=t.value.arrayValue?.values?.map(e=>sX.create(t.field,"==",e))||[];return sZ.create(e,"or")}return t}let r=t.filters.map(t=>e(t));return sZ.create(r,t.op)}(e));return r7(lp(t),7391),lg(t)||lm(t)?[t]:t.getFilters()})(sZ.create(e.filters,"and")).map(t=>ai(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t)),t}On(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Nn(t[h/l]):lI,c=this.Bn(e,o,r[h%l],n),d=this.Ln(e,o,i[h%l],s),f=a.map(t=>this.Bn(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}Bn(e,t,r,n){let i=new ll(e,nb.empty(),t,r);return n?i:i.En()}Ln(e,t,r,n){let i=new ll(e,nb.empty(),t,r);return n?i.En():i}Fn(e,t){let r=new lf(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.gn(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.vn(t);return nz.forEach(n,t=>this.Fn(e,t).next(e=>{e?0!==r&&e.fields.length<function(e){let t=new se(nw.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}(t)&&(r=1):r=0})).next(()=>null!==t.limit&&n.length>1&&2===r?1:r)}kn(e,t){let r=new lo;for(let n of nM(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.ln(n.kind);lr.Wt.Dt(e,i)}return r.un()}Nn(e){let t=new lo;return lr.Wt.Dt(e,t.ln(0)),t.un()}Kn(e,t){let r,n=new lo;return lr.Wt.Dt(sR(this.databaseId,t),n.ln(0===(r=nM(e)).length?0:r[r.length-1].kind)),n.un()}xn(e,t,r){if(null===r)return[];let n=[];n.push(new lo);let i=0;for(let s of nM(e)){let e=r[i++];for(let r of n)if(this.qn(t,s.fieldPath)&&sL(e))n=this.Un(n,s,e);else{let t=r.ln(s.kind);lr.Wt.Dt(e,t)}}return this.$n(n)}Mn(e,t,r){return this.xn(e,t,r.position)}$n(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Un(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new lo;n.seed(r.un()),lr.Wt.Dt(e,n.ln(t.kind)),i.push(n)}return i}qn(e,t){return!!e.filters.find(e=>e instanceof sX&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=i5(e,iO),n=i5(e,iP);return(t?r.H(iL,IDBKeyRange.bound(t,t)):r.H()).next(e=>{let t=[];return nz.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{let n,i;t.push((n=r?new nL(r.sequenceNumber,new nV(o1(r.readTime),new nb(n9(r.documentKey)),r.largestBatchId)):nL.empty(),i=e.fields.map(([e,t])=>new nO(nw.fromServerFormat(e),t)),new nD(e.indexId,e.collectionGroup,i,n)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:nc(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=i5(e,iO),i=i5(e,iP);return this.Wn(e).next(e=>n.H(iL,IDBKeyRange.bound(t,t)).next(t=>nz.forEach(t,t=>i.put(o7(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return nz.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?nz.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),nz.forEach(i,r=>this.Qn(e,t,r).next(t=>{let i=this.Gn(n,r);return t.isEqual(i)?nz.resolve():this.zn(e,n,r,t,i)}))))})}jn(e,t,r,n){return i5(e,iU).put(n.Rn(this.uid,this.Kn(r,t.key),t.key))}Hn(e,t,r,n){return i5(e,iU).delete(n.An(this.uid,this.Kn(r,t.key),t.key))}Qn(e,t,r){let n=i5(e,iU),i=new se(lu);return n.ee({index:iq,range:IDBKeyRange.only([r.indexId,this.uid,lc(this.Kn(r,t))])},(e,n)=>{i=i.add(new ll(r.indexId,t,ld(n.arrayValue),ld(n.directionalValue)))}).next(()=>i)}Gn(e,t){let r=new se(lu),n=this.kn(t,e);if(null==n)return r;let i=nN(t);if(null!=i){let s=e.data.field(i.fieldPath);if(sL(s))for(let i of s.arrayValue.values||[])r=r.add(new ll(t.indexId,e.key,this.Nn(i),n))}else r=r.add(new ll(t.indexId,e.key,lI,n));return r}zn(e,t,r,n,i){r2(lE,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=sr(s),l=sr(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=sr(a)):t?(i(o),o=sr(s)):(o=sr(s),l=sr(a))}}(n,i,lu,n=>{s.push(this.jn(e,t,r,n))},n=>{s.push(this.Hn(e,t,r,n))}),nz.waitFor(s)}Wn(e){let t=1;return i5(e,iP).ee({index:iV,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>lu(e,t)).filter((e,t,r)=>!t||0!==lu(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=lu(i,e),s=lu(i,t);if(0===r)n[0]=e.En();else if(r>0&&s<0)n.push(i),n.push(i.En());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.Jn(n[e],n[e+1]))return[];let t=n[e].An(this.uid,lI,nb.empty()),r=n[e+1].An(this.uid,lI,nb.empty());i.push(IDBKeyRange.bound(t,r))}return i}Jn(e,t){return lu(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(lS)}getMinOffset(e,t){return nz.mapArray(this.vn(t),t=>this.Fn(e,t).next(e=>e||r8(44426))).next(lS)}}function lS(e){r7(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>nB(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new nV(t.readTime,t.documentKey,r)}let l_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class lk{static withCacheSize(e){return new lk(e,lk.DEFAULT_COLLECTION_PERCENTILE,lk.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function lC(e,t,r){let n=e.store(is),i=e.store(ih),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.ee({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{r7(1===o,47070,{batchId:r.batchId})}));let u=[];for(let e of r.mutations){var h,c;let n=(h=e.key.path,c=r.batchId,[t,n7(h),c]);s.push(i.delete(n)),u.push(e.key)}return nz.waitFor(s).next(()=>u)}function lA(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw r8(14731);t=e.noDocument}return JSON.stringify(t).length}lk.DEFAULT_COLLECTION_PERCENTILE=10,lk.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lk.DEFAULT=new lk(0x2800000,lk.DEFAULT_COLLECTION_PERCENTILE,lk.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lk.DISABLED=new lk(-1,0,0);class lD{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.Zn={}}static wt(e,t,r,n){return r7(""!==e.uid,64387),new lD(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return lM(e).ee({index:io,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=i5(e,ih),s=lM(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;r7("number"==typeof a,49019);let f=new a9(a,t,r,n),g=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>oj(o.yt,e)),d=f.mutations.map(e=>oj(o.yt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),m=[],p=new se((e,t)=>nc(e.canonicalString(),t.canonicalString()));for(let e of n){let t=(u=this.userId,h=e.key.path,[u,n7(h),a]);p=p.add(e.key.path.popLast()),m.push(s.put(g)),m.push(i.put(t,iu))}return p.forEach(t=>{m.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[a]=f.keys()}),nz.waitFor(m).next(()=>f)})}lookupMutationBatch(e,t){return lM(e).get(t).next(e=>e?(r7(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),o2(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?nz.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let r=e.keys();return this.Zn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return lM(e).ee({index:io,range:n},(e,t,n)=>{t.userId===this.userId&&(r7(t.batchId>=r,47524,{Yn:r}),i=o2(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=-1;return lM(e).ee({index:io,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return lM(e).H(io,t).next(e=>e.map(e=>o2(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=[this.userId,n7(t.path)],n=IDBKeyRange.lowerBound(r),i=[];return i5(e,ih).ee({range:n},(r,n,s)=>{let[a,o,l]=r,u=n9(o);if(a===this.userId&&t.path.isEqual(u))return lM(e).get(l).next(e=>{if(!e)throw r8(61480,{er:r,batchId:l});r7(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(o2(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new se(nc),n=[];return t.forEach(t=>{let i=[this.userId,n7(t.path)],s=IDBKeyRange.lowerBound(i),a=i5(e,ih).ee({range:s},(e,n,i)=>{let[s,a,o]=e,l=n9(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),nz.waitFor(n).next(()=>this.tr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=[this.userId,n7(r)],s=IDBKeyRange.lowerBound(i),a=new se(nc);return i5(e,ih).ee({range:s},(e,t,i)=>{let[s,o,l]=e,u=n9(o);s===this.userId&&r.isPrefixOf(u)?u.length===n&&(a=a.add(l)):i.done()}).next(()=>this.tr(e,a))}tr(e,t){let r=[],n=[];return t.forEach(t=>{n.push(lM(e).get(t).next(e=>{if(null===e)throw r8(35274,{batchId:t});r7(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(o2(this.serializer,e))}))}),nz.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return lC(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.nr(t.batchId)}),nz.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}nr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return nz.resolve();let r=IDBKeyRange.lowerBound([this.userId]),n=[];return i5(e,ih).ee({range:r},(e,t,r)=>{if(e[0]===this.userId){let t=n9(e[1]);n.push(t)}else r.done()}).next(()=>{r7(0===n.length,56720,{rr:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return lN(e,this.userId,t)}ir(e){return i5(e,ii).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function lN(e,t,r){let n=[t,n7(r.path)],i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return i5(e,ih).ee({range:s,Y:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function lM(e){return i5(e,is)}class lR{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new lR(0)}static ar(){return new lR(-1)}}class lO{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.ur(e).next(t=>{let r=new lR(t.highestTargetId);return t.highestTargetId=r.next(),this.cr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.ur(e).next(e=>nA.fromTimestamp(new nC(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.ur(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.ur(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.cr(e,n)))}addTargetData(e,t){return this.lr(e,t).next(()=>this.ur(e).next(r=>(r.targetCount+=1,this.hr(t,r),this.cr(e,r))))}updateTargetData(e,t){return this.lr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>i5(e,ib).delete(t.targetId)).next(()=>this.ur(e)).next(t=>(r7(t.targetCount>0,8065),t.targetCount-=1,this.cr(e,t)))}removeTargets(e,t,r){let n=0,i=[];return i5(e,ib).ee((s,a)=>{let o=o5(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>nz.waitFor(i)).next(()=>n)}forEachTarget(e,t){return i5(e,ib).ee((e,r)=>{t(o5(r))})}ur(e){return i5(e,iC).get(ik).next(e=>(r7(null!==e,2888),e))}cr(e,t){return i5(e,iC).put(ik,t)}lr(e,t){return i5(e,ib).put(o6(this.serializer,t))}hr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.ur(e).next(e=>e.targetCount)}getTargetData(e,t){let r=as(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),i=null;return i5(e,ib).ee({range:n,index:ix},(e,r,n)=>{let s=o5(r);aa(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=lL(e);return t.forEach(t=>{let s=n7(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),nz.waitFor(n)}removeMatchingKeys(e,t,r){let n=lL(e);return nz.forEach(t,t=>{let i=n7(t.path);return nz.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=lL(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=lL(e),i=aO();return n.ee({range:r,Y:!0},(e,t,r)=>{let n=new nb(n9(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=n7(t.path),n=IDBKeyRange.bound([r],[r+"\0"],!1,!0),i=0;return lL(e).ee({index:iS,Y:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}At(e,t){return i5(e,ib).get(t).next(e=>e?o5(e):null)}}function lL(e){return i5(e,iI)}let lP="LruGarbageCollector";function lF([e,t],[r,n]){let i=nc(e,r);return 0===i?nc(t,n):i}class lV{constructor(e){this.Pr=e,this.buffer=new se(lF),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>lF(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class lB{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Ar(e){r2(lP,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){nJ(e)?r2(lP,"Ignoring IndexedDB error during garbage collection: ",e):await nq(e)}await this.Ar(3e5)})}}class lU{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return nz.resolve(n6.ce);let r=new lV(t);return this.Vr.forEachTarget(e,e=>r.Er(e.sequenceNumber)).next(()=>this.Vr.mr(e,e=>r.Er(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(r2("LruGarbageCollector","Garbage collection skipped; disabled"),nz.resolve(l_)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(r2("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),l_):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,n,i,s,a,o,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(r2("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(l=Date.now(),r1()<=rW.LogLevel.DEBUG&&r2("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${n} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),nz.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}class lj{constructor(e,t){this.db=e,this.garbageCollector=new lU(this,t)}dr(e){let t=this.pr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}mr(e,t){return this.yr(e,(e,r)=>t(r))}addReference(e,t,r){return lq(e,r)}removeReference(e,t,r){return lq(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return lq(e,t)}wr(e,t){let r;return r=!1,i5(e,ii).te(n=>lN(e,n,t).next(e=>(e&&(r=!0),nz.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.yr(e,(s,a)=>{if(a<=t){let t=this.wr(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,nA.min()),lL(e).delete([0,n7(s.path)])))});n.push(t)}}).next(()=>nz.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return lq(e,t)}yr(e,t){let r=lL(e),n,i=n6.ce;return r.ee({index:iS},([e,r],{path:s,sequenceNumber:a})=>{0===e?(i!==n6.ce&&t(new nb(n9(n)),i),i=a,n=s):i=n6.ce}).next(()=>{i!==n6.ce&&t(new nb(n9(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function lq(e,t){var r;return lL(e).put((r=e.currentSequenceNumber,{targetId:0,path:n7(t.path),sequenceNumber:r}))}class lz{constructor(){this.changes=new a_(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,s$.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?nz.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class lK{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return i5(e,ic).put(r)}removeEntry(e,t,r){let n;return i5(e,ic).delete([(n=t.path.toArray()).slice(0,n.length-2),n[n.length-2],oZ(r),n[n.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.br(e,r)))}getEntry(e,t){let r=s$.newInvalidDocument(t);return i5(e,ic).ee({index:ig,range:IDBKeyRange.only(l$(t))},(e,n)=>{r=this.Sr(t,n)}).next(()=>r)}Dr(e,t){let r={size:0,document:s$.newInvalidDocument(t)};return i5(e,ic).ee({index:ig,range:IDBKeyRange.only(l$(t))},(e,n)=>{r={document:this.Sr(t,n),size:lA(n)}}).next(()=>r)}getEntries(e,t){let r=ak;return this.Cr(e,t,(e,t)=>{let n=this.Sr(e,t);r=r.insert(e,n)}).next(()=>r)}vr(e,t){let r=ak,n=new i4(nb.comparator);return this.Cr(e,t,(e,t)=>{let i=this.Sr(e,t);r=r.insert(e,i),n=n.insert(e,lA(t))}).next(()=>({documents:r,Fr:n}))}Cr(e,t,r){if(t.isEmpty())return nz.resolve();let n=new se(lH);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(l$(n.first()),l$(n.last())),s=n.getIterator(),a=s.getNext();return i5(e,ic).ee({index:ig,range:i},(e,t,n)=>{let i=nb.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>lH(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.j(l$(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),oZ(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return i5(e,ic).H(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=ak;for(let i of e){let e=this.Sr(nb.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(aI(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=ak,s=lQ(t,r),a=lQ(t,nV.max());return i5(e,ic).ee({index:ip,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.Sr(nb.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new lG(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return i5(e,iv).get(iw).next(e=>(r7(!!e,20021),e))}br(e,t){return i5(e,iv).put(iw,t)}Sr(e,t){if(t){let e=function(e,t){var r;let n,i;if(t.document)n=oU(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=nb.fromSegments(t.noDocument.path),r=o1(t.noDocument.readTime);n=s$.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return r8(56709);{let e=nb.fromSegments(t.unknownDocument.path),r=o1(t.unknownDocument.version);n=s$.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime((i=new nC((r=t.readTime)[0],r[1]),nA.fromTimestamp(i))),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(nA.min())))return e}return s$.newInvalidDocument(e)}}class lG extends lz{constructor(e,t){super(),this.Mr=e,this.trackRemovals=t,this.Or=new a_(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new se((e,t)=>nc(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Or.get(i);if(t.push(this.Mr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=oX(this.Mr.serializer,s);n=n.add(i.path.popLast());let l=lA(o);r+=l-a.size,t.push(this.Mr.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=oX(this.Mr.serializer,s.convertToNoDocument(nA.min()));t.push(this.Mr.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.Mr.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.Mr.updateMetadata(e,r)),nz.waitFor(t)}getFromCache(e,t){return this.Mr.Dr(e,t).next(e=>(this.Or.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Mr.vr(e,t).next(({documents:e,Fr:t})=>(t.forEach((t,r)=>{this.Or.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function l$(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function lQ(e,t){let r=t.documentKey.path.toArray();return[e,oZ(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function lH(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=nc(r[e],n[e]))return i;return(i=nc(r.length,n.length))||(i=nc(r[r.length-2],n[n.length-2]))||nc(r[r.length-1],n[n.length-1])}class lW{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class lJ{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&a0(r.mutation,e,sn.empty(),nC.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,aO()).next(()=>t))}getLocalViewOfDocuments(e,t,r=aO()){let n=aN();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=aA();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=aN();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,aO()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=ak,s=aN(),a=aN();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof a5)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),a0(a.mutation,t,a.mutation.getFieldMask(),nC.now())):s.set(t.key,sn.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new lW(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=aN(),n=new i4((e,t)=>e-t),i=aO();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||sn.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||aO()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=aN();l.forEach(e=>{if(!i.has(e)){let n=aZ(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return nz.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return nb.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ag(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):nz.resolve(aN()),a=-1,o=i;return s.next(t=>nz.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t)?nz.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,aO())).next(e=>({batchId:a,changes:aD(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new nb(t)).next(e=>{let t=aA();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=aA();return this.indexManager.getCollectionParents(e,i).next(a=>nz.forEach(a,a=>{let o=new ac(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,s$.newInvalidDocument(n)))});let r=aA();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&a0(s.mutation,n,sn.empty(),nC.now()),aI(t,n)&&(r=r.insert(e,n))}),r})}}class lY{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return nz.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,{id:t.id,version:t.version,createTime:oA(t.createTime)}),nz.resolve()}getNamedQuery(e,t){return nz.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,{name:t.name,query:o3(t.bundledQuery),readTime:oA(t.readTime)}),nz.resolve()}}class lX{constructor(){this.overlays=new i4(nb.comparator),this.Lr=new Map}getOverlay(e,t){return nz.resolve(this.overlays.get(t))}getOverlays(e,t){let r=aN();return nz.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.bt(e,t,n)}),nz.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.Lr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.Lr.delete(r)),nz.resolve()}getOverlaysForCollection(e,t,r){let n=aN(),i=t.length+1,s=new nb(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return nz.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new i4((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=aN(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=aN(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return nz.resolve(a)}bt(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.Lr.get(n.largestBatchId).delete(r.key);this.Lr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new ot(t,r));let i=this.Lr.get(t);void 0===i&&(i=aO(),this.Lr.set(t,i)),this.Lr.set(t,i.add(r.key))}}class lZ{constructor(){this.sessionToken=ss.EMPTY_BYTE_STRING}getSessionToken(e){return nz.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,nz.resolve()}}class l0{constructor(){this.kr=new se(l1.Kr),this.qr=new se(l1.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let r=new l1(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new l1(e,t))}Qr(e,t){e.forEach(e=>this.removeReference(e,t))}Gr(e){let t=new nb(new ny([])),r=new l1(t,e),n=new l1(t,e+1),i=[];return this.qr.forEachInRange([r,n],e=>{this.Wr(e),i.push(e.key)}),i}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new nb(new ny([])),r=new l1(t,e),n=new l1(t,e+1),i=aO();return this.qr.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new l1(e,0),r=this.kr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class l1{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return nb.comparator(e.key,t.key)||nc(e.Hr,t.Hr)}static Ur(e,t){return nc(e.Hr,t.Hr)||nb.comparator(e.key,t.key)}}class l2{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new se(l1.Kr)}checkEmpty(e){return nz.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new a9(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.Jr=this.Jr.add(new l1(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return nz.resolve(s)}lookupMutationBatch(e,t){return nz.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.Xr(t+1),n=r<0?0:r;return nz.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return nz.resolve(0===this.mutationQueue.length?-1:this.Yn-1)}getAllMutationBatches(e){return nz.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new l1(t,0),n=new l1(t,1/0),i=[];return this.Jr.forEachInRange([r,n],e=>{let t=this.Zr(e.Hr);i.push(t)}),nz.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new se(nc);return t.forEach(e=>{let t=new l1(e,0),n=new l1(e,1/0);this.Jr.forEachInRange([t,n],e=>{r=r.add(e.Hr)})}),nz.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;nb.isDocumentKey(i)||(i=i.child(""));let s=new l1(new nb(i),0),a=new se(nc);return this.Jr.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Hr)),!0)},s),nz.resolve(this.Yr(a))}Yr(e){let t=[];return e.forEach(e=>{let r=this.Zr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){r7(0===this.ei(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Jr;return nz.forEach(t.mutations,n=>{let i=new l1(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){let r=new l1(t,0),n=this.Jr.firstAfterOrEqual(r);return nz.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,nz.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class l5{constructor(e){this.ti=e,this.docs=new i4(nb.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return nz.resolve(r?r.document.mutableCopy():s$.newInvalidDocument(t))}getEntries(e,t){let r=ak;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():s$.newInvalidDocument(e))}),nz.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=ak,s=t.path,a=new nb(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=nB(nF(a),r)||(n.has(a.key)||aI(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return nz.resolve(i)}getAllFromCollectionGroup(e,t,r,n){r8(9500)}ni(e,t){return nz.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new l6(this)}getSize(e){return nz.resolve(this.size)}}class l6 extends lz{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Mr.addEntry(e,n)):this.Mr.removeEntry(r)}),nz.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class l3{constructor(e){this.persistence=e,this.ri=new a_(e=>as(e),aa),this.lastRemoteSnapshotVersion=nA.min(),this.highestTargetId=0,this.ii=0,this.si=new l0,this.targetCount=0,this.oi=lR._r()}forEachTarget(e,t){return this.ri.forEach((e,r)=>t(r)),nz.resolve()}getLastRemoteSnapshotVersion(e){return nz.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return nz.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),nz.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),nz.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new lR(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,nz.resolve()}updateTargetData(e,t){return this.lr(t),nz.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,nz.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.ri.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.ri.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),nz.waitFor(i).next(()=>n)}getTargetCount(e){return nz.resolve(this.targetCount)}getTargetData(e,t){let r=this.ri.get(t)||null;return nz.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),nz.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),nz.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),nz.resolve()}getMatchingKeysForTargetId(e,t){let r=this.si.jr(t);return nz.resolve(r)}containsKey(e,t){return nz.resolve(this.si.containsKey(t))}}class l8{constructor(e,t){this._i={},this.overlays={},this.ai=new n6(0),this.ui=!1,this.ui=!0,this.ci=new lZ,this.referenceDelegate=e(this),this.li=new l3(this),this.indexManager=new lb,this.remoteDocumentCache=new l5(e=>this.referenceDelegate.hi(e)),this.serializer=new oY(t),this.Pi=new lY(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new lX,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new l2(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){r2("MemoryPersistence","Starting transaction:",e);let n=new l4(this.ai.next());return this.referenceDelegate.Ti(),r(n).next(e=>this.referenceDelegate.Ii(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ei(e,t){return nz.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}}class l4 extends nj{constructor(e){super(),this.currentSequenceNumber=e}}class l7{constructor(e){this.persistence=e,this.Ri=new l0,this.Ai=null}static Vi(e){return new l7(e)}get di(){if(this.Ai)return this.Ai;throw r8(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),nz.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),nz.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),nz.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(e=>this.di.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return nz.forEach(this.di,r=>{let n=nb.fromPath(r);return this.mi(e,n).next(e=>{e||t.removeEntry(n,nA.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return nz.or([()=>nz.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class l9{constructor(e,t){this.persistence=e,this.fi=new a_(e=>n7(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new lU(this,t)}static Vi(e,t){return new l9(e,t)}Ti(){}Ii(e){return nz.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}mr(e,t){return nz.forEach(this.fi,(r,n)=>this.wr(e,r,n).next(e=>e?nz.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.ni(e,n=>this.wr(e,n,t).next(e=>{e||(r++,i.removeEntry(n,nA.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),nz.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),nz.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),nz.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),nz.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(s_(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=sm(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return su(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var n;let i;return n=t.mapValue,i=0,i3(n.fields,(t,r)=>{i+=t.length+e(r)}),i;default:throw r8(13486,{value:t})}}(e.data.value)),t}wr(e,t,r){return nz.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.fi.get(t);return nz.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class ue{constructor(e){this.serializer=e}k(e,t,r,n){let i=new nG("createOrUpgrade",t);r<1&&n>=1&&(e.createObjectStore(it),e.createObjectStore(ii,{keyPath:"userId"}),e.createObjectStore(is,{keyPath:ia,autoIncrement:!0}).createIndex(io,il,{unique:!0}),e.createObjectStore(ih),ut(e),e.createObjectStore(ie));let s=nz.resolve();return r<3&&n>=3&&(0!==r&&(e.deleteObjectStore(iI),e.deleteObjectStore(ib),e.deleteObjectStore(iC),ut(e)),s=s.next(()=>{let e,t;return e=i.store(iC),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:nA.min().toTimestamp(),targetCount:0},e.put(ik,t)})),r<4&&n>=4&&(0!==r&&(s=s.next(()=>i.store(is).H().next(t=>{e.deleteObjectStore(is),e.createObjectStore(is,{keyPath:ia,autoIncrement:!0}).createIndex(io,il,{unique:!0});let r=i.store(is),n=t.map(e=>r.put(e));return nz.waitFor(n)}))),s=s.next(()=>{e.createObjectStore(iN,{keyPath:"clientId"})})),r<5&&n>=5&&(s=s.next(()=>this.gi(i))),r<6&&n>=6&&(s=s.next(()=>(e.createObjectStore(iv),this.pi(i)))),r<7&&n>=7&&(s=s.next(()=>this.yi(i))),r<8&&n>=8&&(s=s.next(()=>this.wi(e,i))),r<9&&n>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&n>=10&&(s=s.next(()=>this.bi(i))),r<11&&n>=11&&(s=s.next(()=>{e.createObjectStore(iM,{keyPath:"bundleId"}),e.createObjectStore(iR,{keyPath:"name"})})),r<12&&n>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(iK,{keyPath:iG})).createIndex(i$,iQ,{unique:!1}),t.createIndex(iH,iW,{unique:!1})})),r<13&&n>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(ic,{keyPath:id})).createIndex(ig,im),t.createIndex(ip,iy)}).next(()=>this.Si(e,i)).next(()=>e.deleteObjectStore(ie))),r<14&&n>=14&&(s=s.next(()=>this.Di(e,i))),r<15&&n>=15&&(s=s.next(()=>{e.createObjectStore(iO,{keyPath:"indexId",autoIncrement:!0}).createIndex(iL,"collectionGroup",{unique:!1}),e.createObjectStore(iP,{keyPath:iF}).createIndex(iV,iB,{unique:!1}),e.createObjectStore(iU,{keyPath:ij}).createIndex(iq,iz,{unique:!1})})),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(iP).clear()}).next(()=>{t.objectStore(iU).clear()})),r<17&&n>=17&&(s=s.next(()=>{e.createObjectStore(iJ,{keyPath:"name"})})),r<18&&n>=18&&(0,r$.isSafariOrWebkit)()&&(s=s.next(()=>{t.objectStore(iP).clear()}).next(()=>{t.objectStore(iU).clear()})),s}pi(e){let t=0;return e.store(ie).ee((e,r)=>{t+=lA(r)}).next(()=>{let r={byteSize:t};return e.store(iv).put(iw,r)})}gi(e){let t=e.store(ii),r=e.store(is);return t.H().next(t=>nz.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.H(io,n).next(r=>nz.forEach(r,r=>{r7(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=o2(this.serializer,r);return lC(e,t.userId,n).next(()=>{})}))}))}yi(e){let t=e.store(iI),r=e.store(ie);return e.store(iC).get(ik).next(e=>{let n=[];return r.ee((r,i)=>{let s=new ny(r),a=[0,n7(s)];n.push(t.get(a).next(r=>r?nz.resolve():t.put({targetId:0,path:n7(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>nz.waitFor(n))})}wi(e,t){e.createObjectStore(iA,{keyPath:iD});let r=t.store(iA),n=new lx,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:n7(n)})}};return t.store(ie).ee({Y:!0},(e,t)=>i(new ny(e).popLast())).next(()=>t.store(ih).ee({Y:!0},([e,t,r],n)=>i(n9(t).popLast())))}bi(e){let t=e.store(ib);return t.ee((e,r)=>{let n=o5(r),i=o6(this.serializer,n);return t.put(i)})}Si(e,t){let r=t.store(ie),n=[];return r.ee((e,r)=>{let i=t.store(ic),s=(r.document?new nb(ny.fromString(r.document.name).popFirst(5)):r.noDocument?nb.fromSegments(r.noDocument.path):r.unknownDocument?nb.fromSegments(r.unknownDocument.path):r8(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>nz.waitFor(n))}Di(e,t){let r=t.store(is),n=new lK(this.serializer),i=new l8(l7.Vi,this.serializer.yt);return r.H().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??aO();o2(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),nz.forEach(r,(e,r)=>{let s=new rX(r),a=le.wt(this.serializer,s),o=i.getIndexManager(s);return new lJ(n,lD.wt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new i2(t,n6.ce),e).next()})})}}function ut(e){e.createObjectStore(iI,{keyPath:iT}).createIndex(iS,i_,{unique:!0}),e.createObjectStore(ib,{keyPath:"targetId"}).createIndex(ix,iE,{unique:!0}),e.createObjectStore(iC)}let ur="IndexedDbPersistence",un="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class ui{constructor(e,t,r,n,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Ci=i,this.window=s,this.document=a,this.Fi=l,this.Mi=u,this.xi=h,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=-1/0,this.ki=e=>Promise.resolve(),!ui.v())throw new ne(r9.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new lj(this,n),this.Ki=t+"main",this.serializer=new oY(o),this.qi=new n$(this.Ki,this.xi,new ue(this.serializer)),this.ci=new lt,this.li=new lO(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new lK(this.serializer),this.Pi=new o9,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===u&&r5(ur,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ne(r9.FAILED_PRECONDITION,un);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.li.getHighestSequenceNumber(e))}).then(e=>{this.ai=new n6(e,this.Fi)}).then(()=>{this.ui=!0}).catch(e=>(this.qi&&this.qi.close(),Promise.reject(e)))}zi(e){return this.ki=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.qi.q(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ci.enqueueAndForget(async()=>{this.started&&await this.$i()}))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>i5(e,iN).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ji(e).next(e=>{e||(this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Ji(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(nJ(e))return r2(ur,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return r2(ur,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ci.enqueueRetryable(()=>this.ki(e)),this.isPrimary=e})}ji(e){return i5(e,it).get(ir).next(e=>nz.resolve(this.Xi(e)))}Yi(e){return i5(e,iN).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,18e5)){this.Li=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=i5(e,iN);return t.H().next(e=>{let r=this.ns(e,18e5),n=e.filter(e=>-1===r.indexOf(e));return nz.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.rs(t.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.$i().then(()=>this.es()).then(()=>this.Gi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.Mi?nz.resolve(!0):i5(e,it).get(ir).next(t=>{if(null!==t&&this.ts(t.leaseTimestampMs,5e3)&&!this.ss(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new ne(r9.FAILED_PRECONDITION,un);return!1}}return!(!this.networkEnabled||!this.inForeground)||i5(e,iN).H().next(e=>void 0===this.ns(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&r2(ur,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[it,iN],e=>{let t=new i2(e,n6.ce);return this.Ji(t).next(()=>this.Yi(t))}),this.qi.close(),this.ls()}ns(e,t){return e.filter(e=>this.ts(e.updateTimeMs,t)&&!this.ss(e.clientId))}hs(){return this.runTransaction("getActiveClients","readonly",e=>i5(e,iN).H().next(e=>this.ns(e,18e5).map(e=>e.clientId)))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(e,t){return lD.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new lT(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return le.wt(this.serializer,e)}getBundleCache(){return this.Pi}runTransaction(e,t,r){var n;let i;r2(ur,"Starting transaction:",e);let s=18===(n=this.xi)||17===n?i1:16===n||15===n?i0:14===n||13===n?iZ:12===n?iX:11===n?iY:void r8(60245);return this.qi.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,n=>(i=new i2(n,this.ai?this.ai.next():n6.ce),"readwrite-primary"===t?this.ji(i).next(e=>!!e||this.Hi(i)).next(t=>{if(!t)throw r5(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)),new ne(r9.FAILED_PRECONDITION,nU);return r(i)}).next(e=>this.Zi(i).next(()=>e)):this.Ps(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Ps(e){return i5(e,it).get(ir).next(e=>{if(null!==e&&this.ts(e.leaseTimestampMs,5e3)&&!this.ss(e.ownerId)&&!this.Xi(e)&&!(this.Mi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new ne(r9.FAILED_PRECONDITION,un)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return i5(e,it).put(ir,t)}static v(){return n$.v()}Ji(e){let t=i5(e,it);return t.get(ir).next(e=>this.Xi(e)?(r2(ur,"Releasing primary lease."),t.delete(ir)):nz.resolve())}ts(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(r5(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ni=()=>{this.Ci.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.$i()))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground="visible"===this.document.visibilityState)}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){"function"==typeof this.window?.addEventListener&&(this.Oi=()=>{this._s();let e=/(?:Version|Mobile)\/1[456]/;(0,r$.isSafari)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(e){try{let t=null!==this.Ui?.getItem(this.rs(e));return r2(ur,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return r5(ur,"Failed to get zombied client id.",e),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(e){r5("Failed to set zombie client id.",e)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch(e){}}rs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function us(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class ua{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=n}static Es(e,t){let r=aO(),n=aO();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new ua(e,t.fromCache,r,n)}}class uo{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ul{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(0,r$.isSafari)()?8:nQ((0,r$.getUA)())>0?6:4}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.gs(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ps(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new uo;return this.ys(e,t,r).next(n=>{if(i.result=n,this.As)return this.ws(e,t,r,n.size)})}).next(()=>i.result)}ws(e,t,r,n){return r.documentReadCount<this.Vs?(r1()<=rW.LogLevel.DEBUG&&r2("QueryEngine","SDK will not create cache indexes for query:",aE(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),nz.resolve()):(r1()<=rW.LogLevel.DEBUG&&r2("QueryEngine","Query:",aE(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.ds*n?(r1()<=rW.LogLevel.DEBUG&&r2("QueryEngine","The SDK decides to create cache indexes for query:",aE(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ap(t))):nz.resolve())}gs(e,t){if(af(t))return nz.resolve(null);let r=ap(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=ap(t=aw(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=aO(...n);return this.fs.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.bs(t,n);return this.Ss(t,s,i,r.readTime)?this.gs(e,aw(t,null,"F")):this.Ds(e,s,t,r)}))})))}ps(e,t,r,n){return af(t)||n.isEqual(nA.min())?nz.resolve(null):this.fs.getDocuments(e,r).next(i=>{let s=this.bs(t,i);return this.Ss(t,s,r,n)?nz.resolve(null):(r1()<=rW.LogLevel.DEBUG&&r2("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),aE(t)),this.Ds(e,s,t,nP(n,-1)).next(e=>e))})}bs(e,t){let r=new se(aS(e));return t.forEach((t,n)=>{aI(e,n)&&(r=r.add(n))}),r}Ss(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}ys(e,t,r){return r1()<=rW.LogLevel.DEBUG&&r2("QueryEngine","Using full collection scan to execute query:",aE(t)),this.fs.getDocumentsMatchingQuery(e,t,nV.min(),r)}Ds(e,t,r,n){return this.fs.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let uu="LocalStore";class uh{constructor(e,t,r,n){this.persistence=e,this.Cs=t,this.serializer=n,this.vs=new i4(nc),this.Fs=new a_(e=>as(e),aa),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new lJ(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}async function uc(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let n;return e.mutationQueue.getAllMutationBatches(r).next(i=>(n=i,e.Os(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let i=[],s=[],a=aO();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({Ns:e,removedBatchIds:i,addedBatchIds:s}))})})}function ud(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function uf(e,t,r){let n=aO(),i=aO();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=ak;return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(nA.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):r2(uu,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{Bs:n,Ls:i}})}function ug(e,t){return e.persistence.runTransaction("Allocate target","readwrite",r=>{let n;return e.li.getTargetData(r,t).next(i=>i?(n=i,nz.resolve(n)):e.li.allocateTargetId(r).next(i=>(n=new oJ(t,i,"TargetPurposeListen",r.currentSequenceNumber),e.li.addTargetData(r,n).next(()=>n))))}).then(r=>{let n=e.vs.get(r.targetId);return(null===n||r.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(e.vs=e.vs.insert(r.targetId,r),e.Fs.set(t,r.targetId)),r})}async function um(e,t,r){let n=e.vs.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,n))}catch(e){if(!nJ(e))throw e;r2(uu,`Failed to update sequence numbers for target ${t}: ${e}`)}e.vs=e.vs.remove(t),e.Fs.delete(n.target)}function up(e,t,r){let n=nA.min(),i=aO();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=ap(t),void 0!==(o=e.Fs.get(a))?nz.resolve(e.vs.get(o)):e.li.getTargetData(s,a)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,e.li.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Cs.getDocumentsMatchingQuery(s,t,r?n:nA.min(),r?i:aO())).next(r=>(uw(e,aT(t),r),{documents:r,ks:i}))})}function uy(e,t){let r=e.li,n=e.vs.get(t);return n?Promise.resolve(n.target):e.persistence.runTransaction("Get target data","readonly",e=>r.At(e,t).next(e=>e?e.target:null))}function uv(e,t){let r=e.Ms.get(t)||nA.min();return e.persistence.runTransaction("Get new document changes","readonly",n=>e.xs.getAllFromCollectionGroup(n,t,nP(r,-1),Number.MAX_SAFE_INTEGER)).then(r=>(uw(e,t,r),r))}function uw(e,t,r){let n=e.Ms.get(t)||nA.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.Ms.set(t,n)}async function ub(e,t,r,n){let i=aO(),s=ak;for(let e of r){let r=t.Ks(e.metadata.name);e.document&&(i=i.add(r));let n=t.qs(e);n.setReadTime(t.Us(e.metadata.readTime)),s=s.insert(r,n)}let a=e.xs.newChangeBuffer({trackRemovals:!0}),o=await ug(e,ap(ad(ny.fromString(`__bundle__/docs/${n}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>uf(t,a,s).next(e=>(a.apply(t),e)).next(r=>e.li.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.li.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,r.Bs,r.Ls)).next(()=>r.Bs)))}async function ux(e,t,r=aO()){let n=await ug(e,ap(o3(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=oA(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return e.Pi.saveNamedQuery(i,t);let a=n.withResumeToken(ss.EMPTY_BYTE_STRING,s);return e.vs=e.vs.insert(a.targetId,a),e.li.updateTargetData(i,a).next(()=>e.li.removeMatchingKeysForTargetId(i,n.targetId)).next(()=>e.li.addMatchingKeys(i,r,n.targetId)).next(()=>e.Pi.saveNamedQuery(i,t))})}let uE="firestore_clients";function uI(e,t){return`${uE}_${e}_${t}`}let uT="firestore_mutations";function uS(e,t,r){let n=`${uT}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let u_="firestore_targets";function uk(e,t){return`${u_}_${e}_${t}`}let uC="SharedClientState";class uA{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static $s(e,t,r){let n=JSON.parse(r),i,s="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new ne(n.error.code,n.error.message)),s?new uA(e,t,n.state,i):(r5(uC,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class uD{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static $s(e,t){let r=JSON.parse(t),n,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new ne(r.error.code,r.error.message)),i?new uD(e,r.state,n):(r5(uC,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class uN{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=aL;for(let e=0;n&&e<r.activeTargetIds.length;++e)n=n4(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new uN(e,i):(r5(uC,`Failed to parse client data for instance '${e}': ${t}`),null)}}class uM{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new uM(t.clientId,t.onlineState):(r5(uC,`Failed to parse online state: ${e}`),null)}}class uR{constructor(){this.activeTargetIds=aL}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class uO{constructor(e,t,r,n,i){var s,a,o;this.window=e,this.Ci=t,this.persistenceKey=r,this.zs=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.js=this.Hs.bind(this),this.Js=new i4(nc),this.started=!1,this.Zs=[];const l=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=uI(this.persistenceKey,this.zs),this.Ys=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.Js=this.Js.insert(this.zs,new uR),this.eo=RegExp(`^${uE}_${l}_([^_]*)$`),this.no=RegExp(`^${uT}_${l}_(\\d+)(?:_(.*))?$`),this.ro=RegExp(`^${u_}_${l}_(\\d+)$`),this.io=(a=this.persistenceKey,`firestore_online_state_${a}`),this.so=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.js)}static v(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.hs())){if(e===this.zs)continue;let t=this.getItem(uI(this.persistenceKey,e));if(t){let r=uN.$s(e,t);r&&(this.Js=this.Js.insert(r.clientId,r))}}this.oo();let e=this.storage.getItem(this.io);if(e){let t=this._o(e);t&&this.ao(t)}for(let e of this.Zs)this.Hs(e);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ys,JSON.stringify(e))}getAllActiveQueryTargets(){return this.uo(this.Js)}isActiveQueryTarget(e){let t=!1;return this.Js.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.co(e,"pending")}updateMutationState(e,t,r){this.co(e,t,r),this.lo(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(uk(this.persistenceKey,e));if(t){let n=uD.$s(e,t);n&&(r=n.state)}}return t&&this.ho.Qs(e),this.oo(),r}removeLocalQueryTarget(e){this.ho.Gs(e),this.oo()}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(uk(this.persistenceKey,e))}updateQueryState(e,t,r){this.Po(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.lo(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.To(e)}notifyBundleLoaded(e){this.Io(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return r2(uC,"READ",e,t),t}setItem(e,t){r2(uC,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){r2(uC,"REMOVE",e),this.storage.removeItem(e)}Hs(e){if(e.storageArea===this.storage){if(r2(uC,"EVENT",e.key,e.newValue),e.key===this.Xs)return void r5("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ci.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.eo.test(e.key)){if(null==e.newValue){let t=this.Eo(e.key);return this.Ro(t,null)}{let t=this.Ao(e.key,e.newValue);if(t)return this.Ro(t.clientId,t)}}else if(this.no.test(e.key)){if(null!==e.newValue){let t=this.Vo(e.key,e.newValue);if(t)return this.mo(t)}}else if(this.ro.test(e.key)){if(null!==e.newValue){let t=this.fo(e.key,e.newValue);if(t)return this.po(t)}}else if(e.key===this.io){if(null!==e.newValue){let t=this._o(e.newValue);if(t)return this.ao(t)}}else if(e.key===this.Ys){let t=function(e){let t=n6.ce;if(null!=e)try{let r=JSON.parse(e);r7("number"==typeof r,30636,{yo:e}),t=r}catch(e){r5(uC,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==n6.ce&&this.sequenceNumberHandler(t)}else if(e.key===this.so){let t=this.wo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.bo(e)))}}}else this.Zs.push(e)})}}get ho(){return this.Js.get(this.zs)}oo(){this.setItem(this.Xs,this.ho.Ws())}co(e,t,r){let n=new uA(this.currentUser,e,t,r),i=uS(this.persistenceKey,this.currentUser,e);this.setItem(i,n.Ws())}lo(e){let t=uS(this.persistenceKey,this.currentUser,e);this.removeItem(t)}To(e){let t={clientId:this.zs,onlineState:e};this.storage.setItem(this.io,JSON.stringify(t))}Po(e,t,r){let n=uk(this.persistenceKey,e),i=new uD(e,t,r);this.setItem(n,i.Ws())}Io(e){let t=JSON.stringify(Array.from(e));this.setItem(this.so,t)}Eo(e){let t=this.eo.exec(e);return t?t[1]:null}Ao(e,t){let r=this.Eo(e);return uN.$s(r,t)}Vo(e,t){let r=this.no.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return uA.$s(new rX(i),n,t)}fo(e,t){let r=Number(this.ro.exec(e)[1]);return uD.$s(r,t)}_o(e){return uM.$s(e)}wo(e){return JSON.parse(e)}async mo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.So(e.batchId,e.state,e.error);r2(uC,`Ignoring mutation for non-active user ${e.user.uid}`)}po(e){return this.syncEngine.Do(e.targetId,e.state,e.error)}Ro(e,t){let r=t?this.Js.insert(e,t):this.Js.remove(e),n=this.uo(this.Js),i=this.uo(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Co(s,a).then(()=>{this.Js=r})}ao(e){this.Js.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}uo(e){let t=aL;return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class uL{constructor(){this.vo=new uR,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new uR,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class uP{Mo(e){}shutdown(){}}let uF="ConnectivityMonitor";class uV{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){for(let e of(r2(uF,"Network connectivity changed: AVAILABLE"),this.Lo))e(0)}Bo(){for(let e of(r2(uF,"Network connectivity changed: UNAVAILABLE"),this.Lo))e(1)}static v(){return"u">typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let uB=null;function uU(){return null===uB?uB=0x10000000+Math.round(0x80000000*Math.random()):uB++,"0x"+uB.toString(16)}let uj="RestConnection",uq={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class uz{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${n}`,this.$o=this.databaseId.database===sv?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Wo(e,t,r,n,i){let s=uU(),a=this.Qo(e,t.toUriEncodedString());r2(uj,`Sending RPC '${e}' ${s}:`,a,r);let o={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(o,n,i);let{host:l}=new URL(a),u=(0,r$.isCloudWorkstation)(l);return this.zo(e,a,o,r,u).then(t=>(r2(uj,`Received RPC '${e}' ${s}: `,t),t),t=>{throw r6(uj,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",r),t})}jo(e,t,r,n,i,s){return this.Wo(e,t,r,n,i)}Go(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+rZ,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}Qo(e,t){let r=uq[e],n=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(n=`${n}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),n}terminate(){}}class uK{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}let uG="WebChannelConnection",u$=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};class uQ extends uz{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){uQ.c_||(u$(D(),A.STAT_EVENT,e=>{e.stat===C.PROXY?r2(uG,"STAT_EVENT: detected buffering proxy"):e.stat===C.NOPROXY&&r2(uG,"STAT_EVENT: detected no buffering proxy")}),uQ.c_=!0)}zo(e,t,r,n,i){let s=uU();return new Promise((i,a)=>{let o=new T;o.setWithCredentials(!0),o.listenOnce(_.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case k.NO_ERROR:let t=o.getResponseJson();r2(uG,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case k.TIMEOUT:r2(uG,`RPC '${e}' ${s} timed out`),a(new ne(r9.DEADLINE_EXCEEDED,"Request time out"));break;case k.HTTP_ERROR:let r=o.getStatus();if(r2(uG,`RPC '${e}' ${s} failed with status:`,r,"response text:",o.getResponseText()),r>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,r=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(r9).indexOf(e)>=0?e:r9.UNKNOWN);a(new ne(r,t.message))}else a(new ne(r9.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new ne(r9.UNAVAILABLE,"Connection failed."));break;default:r8(9055,{l_:e,streamId:s,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{r2(uG,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(n);r2(uG,`RPC '${e}' ${s} sending request:`,n),o.send(t,"POST",l,r,15)})}T_(e,t,r){let n=uU(),i=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=this.createWebChannelTransport(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},o=this.longPollingOptions.timeoutSeconds;void 0!==o&&(a.longPollingTimeout=Math.round(1e3*o)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Go(a.initMessageHeaders,t,r),a.encodeInitMessageHeaders=!0;let l=i.join("");r2(uG,`Creating RPC '${e}' stream ${n}: ${l}`,a);let u=s.createWebChannel(l,a);this.I_(u);let h=!1,c=!1,d=new uK({Ho:t=>{c?r2(uG,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(h||(r2(uG,`Opening RPC '${e}' stream ${n} transport.`),u.open(),h=!0),r2(uG,`RPC '${e}' stream ${n} sending:`,t),u.send(t))},Jo:()=>u.close()});return u$(u,S.EventType.OPEN,()=>{c||(r2(uG,`RPC '${e}' stream ${n} transport opened.`),d.i_())}),u$(u,S.EventType.CLOSE,()=>{c||(c=!0,r2(uG,`RPC '${e}' stream ${n} transport closed`),d.o_(),this.E_(u))}),u$(u,S.EventType.ERROR,t=>{c||(c=!0,r6(uG,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),d.o_(new ne(r9.UNAVAILABLE,"The operation could not be completed")))}),u$(u,S.EventType.MESSAGE,t=>{if(!c){let r=t.data[0];r7(!!r,16349);let i=r?.error||r[0]?.error;if(i){r2(uG,`RPC '${e}' stream ${n} received error:`,i);let t=i.status,r=function(e){let t=M[e];if(void 0!==t)return os(t)}(t),s=i.message;void 0===r&&(r=r9.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),c=!0,d.o_(new ne(r,s)),u.close()}else r2(uG,`RPC '${e}' stream ${n} received:`,r),d.__(r)}}),uQ.u_(),setTimeout(()=>{d.s_()},0),d}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return N()}}function uH(){return"u">typeof window?window:null}function uW(){return"u">typeof document?document:null}function uJ(e){return new oS(e,!0)}uQ.c_=!1;class uY{constructor(e,t,r=1e3,n=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=n,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),n=Math.max(0,t-r);n>0&&r2("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,n,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}let uX="PersistentStream";class uZ{constructor(e,t,r,n,i,s,a,o){this.Ci=e,this.b_=r,this.S_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new uY(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===r9.RESOURCE_EXHAUSTED?(r5(t.toString()),r5("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===r9.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.D_===t&&this.G_(e,r)},t=>{e(()=>{let e=new ne(r9.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(e=>{r(()=>this.z_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.F_?this.H_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return r2(uX,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(r2(uX,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class u0 extends uZ{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let r;if("targetChange"in t){var n,i;t.targetChange;let s="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:r8(39313,{state:n}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(r7(void 0===i||"string"==typeof i,58123),ss.fromBase64String(i||"")):(r7(void 0===i||i instanceof rG.Buffer||i instanceof Uint8Array,16193),ss.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;r=new oy(s,a,o,l&&new ne(void 0===l.code?r9.UNKNOWN:os(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=oO(e,n.document.name),s=oA(n.document.updateTime),a=n.document.createTime?oA(n.document.createTime):nA.min(),o=new sG({mapValue:{fields:n.document.fields}}),l=s$.newFoundDocument(i,s,a,o);r=new om(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=oO(e,n.document),s=n.readTime?oA(n.readTime):nA.min(),a=s$.newNoDocument(i,s);r=new om([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=oO(e,n.document);r=new om([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return r8(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new on(n,i);r=new op(e.targetId,s)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return nA.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?nA.min():t.readTime?oA(t.readTime):nA.min()}(e);return this.listener.J_(t,r)}Z_(e){let t,r={};r.database=oF(this.serializer),r.addTarget=function(e,t){let r,n=t.target;if((r=ao(n)?{documents:oz(e,n)}:{query:oK(e,n).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=oC(e,t.resumeToken);let n=o_(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(nA.min())>0){r.readTime=ok(e,t.snapshotVersion.toTimestamp());let n=o_(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let n=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return r8(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});n&&(r.labels=n),this.K_(r)}X_(e){let t={};t.database=oF(this.serializer),t.removeTarget=e,this.K_(t)}}class u1 extends uZ{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return r7(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,r7(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,r;r7(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let n=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(r7(void 0!==r,14353),t.map(e=>{let t;return(t=e.updateTime?oA(e.updateTime):oA(r)).isEqual(nA.min())&&(t=oA(r)),new aW(t,e.transformResults||[])})):[]),i=oA(e.commitTime);return this.listener.na(i,n)}ra(){let e={};e.database=oF(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>oj(this.serializer,e))};this.K_(t)}}class u2{}class u5 extends u2{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new ne(r9.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Wo(e,oN(t,r),n,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===r9.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ne(r9.UNKNOWN,e.toString())})}jo(e,t,r,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.jo(e,oN(t,r),n,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===r9.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ne(r9.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class u6{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(r5(t),this.aa=!1):r2("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let u3="RemoteStore";class u8{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo(e=>{r.enqueueAndForget(async()=>{hs(this)&&(r2(u3,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await u7(e),e.Va.set("Unknown"),e.Ea.delete(4),await u4(e)}(this))})}),this.Va=new u6(r,n)}}async function u4(e){if(hs(e))for(let t of e.Ra)await t(!0)}async function u7(e){for(let t of e.Ra)await t(!1)}function u9(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),hi(e)?hn(e):hx(e).O_()&&ht(e,t))}function he(e,t){let r=hx(e);e.Ia.delete(t),r.O_()&&hr(e,t),0===e.Ia.size&&(r.O_()?r.L_():hs(e)&&e.Va.set("Unknown"))}function ht(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(nA.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}hx(e).Z_(t)}function hr(e,t){e.da.$e(t),hx(e).X_(t)}function hn(e){e.da=new ow({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),hx(e).start(),e.Va.ua()}function hi(e){return hs(e)&&!hx(e).x_()&&e.Ia.size>0}function hs(e){return 0===e.Ea.size}async function ha(e){e.Va.set("Online")}async function ho(e){e.Ia.forEach((t,r)=>{ht(e,t)})}async function hl(e,t){e.da=void 0,hi(e)?(e.Va.ha(t),hn(e)):e.Va.set("Unknown")}async function hu(e,t,r){if(e.Va.set("Online"),t instanceof oy&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let n of t.targetIds)e.Ia.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ia.delete(n),e.da.removeTarget(n))}(e,t)}catch(r){r2(u3,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await hh(e,r)}else if(t instanceof om?e.da.Xe(t):t instanceof op?e.da.st(t):e.da.tt(t),!r.isEqual(nA.min()))try{let t,n=await ud(e.localStore);r.compareTo(n)>=0&&await ((t=e.da.Tt(r)).targetChanges.forEach((t,n)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(n);i&&e.Ia.set(n,i.withResumeToken(t.resumeToken,r))}}),t.targetMismatches.forEach((t,r)=>{let n=e.Ia.get(t);if(!n)return;e.Ia.set(t,n.withResumeToken(ss.EMPTY_BYTE_STRING,n.snapshotVersion)),hr(e,t);let i=new oJ(n.target,t,r,n.sequenceNumber);ht(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){r2(u3,"Failed to raise snapshot:",t),await hh(e,t)}}async function hh(e,t,r){if(!nJ(t))throw t;e.Ea.add(1),await u7(e),e.Va.set("Offline"),r||(r=()=>ud(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{r2(u3,"Retrying IndexedDB access"),await r(),e.Ea.delete(1),await u4(e)})}function hc(e,t){return t().catch(r=>hh(e,r,t))}async function hd(e){var t;let r=hE(e),n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;hs(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,n);if(null===t){0===e.Ta.length&&r.L_();break}n=t.batchId,function(e,t){e.Ta.push(t);let r=hE(e);r.O_()&&r.Y_&&r.ea(t.mutations)}(e,t)}catch(t){await hh(e,t)}hf(e)&&hg(e)}function hf(e){return hs(e)&&!hE(e).x_()&&e.Ta.length>0}function hg(e){hE(e).start()}async function hm(e){hE(e).ra()}async function hp(e){let t=hE(e);for(let r of e.Ta)t.ea(r.mutations)}async function hy(e,t,r){let n=e.Ta.shift(),i=oe.from(n,t,r);await hc(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await hd(e)}async function hv(e,t){t&&hE(e).Y_&&await async function(e,t){var r;if(oi(r=t.code)&&r!==r9.ABORTED){let r=e.Ta.shift();hE(e).B_(),await hc(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await hd(e)}}(e,t),hf(e)&&hg(e)}async function hw(e,t){e.asyncQueue.verifyOperationInProgress(),r2(u3,"RemoteStore received new credentials");let r=hs(e);e.Ea.add(3),await u7(e),r&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await u4(e)}async function hb(e,t){t?(e.Ea.delete(2),await u4(e)):t||(e.Ea.add(2),await u7(e),e.Va.set("Unknown"))}function hx(e){var t,r,n;return e.ma||(t=e.datastore,r=e.asyncQueue,n={Zo:ha.bind(null,e),Yo:ho.bind(null,e),t_:hl.bind(null,e),J_:hu.bind(null,e)},t.sa(),e.ma=new u0(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.ma.B_(),hi(e)?hn(e):e.Va.set("Unknown")):(await e.ma.stop(),e.da=void 0)})),e.ma}function hE(e){var t,r,n;return e.fa||(t=e.datastore,r=e.asyncQueue,n={Zo:()=>Promise.resolve(),Yo:hm.bind(null,e),t_:hv.bind(null,e),ta:hp.bind(null,e),na:hy.bind(null,e)},t.sa(),e.fa=new u1(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.fa.B_(),await hd(e)):(await e.fa.stop(),e.Ta.length>0&&(r2(u3,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class hI{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new nt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new hI(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ne(r9.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hT(e,t){if(r5("AsyncQueue",`${t}: ${e}`),nJ(e))return new ne(r9.UNAVAILABLE,`${t}: ${e}`);throw e}class hS{static emptySet(e){return new hS(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||nb.comparator(t.key,r.key):(e,t)=>nb.comparator(e.key,t.key),this.keyedMap=aA(),this.sortedSet=new i4(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof hS)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new hS;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class h_{constructor(){this.ga=new i4(nb.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?0!==e.type&&3===r.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==r.type?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.ga=this.ga.remove(t):1===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):r8(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class hk{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new hk(e,t,hS.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ab(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class hC{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class hA{constructor(){this.queries=hD(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new ne(r9.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=hD(),t.forEach((t,r)=>{for(let t of r.ba)t.onError(e)})}}function hD(){return new a_(e=>ax(e),ab)}async function hN(e,t){let r=3,n=t.query,i=e.queries.get(n);i?!i.Sa()&&t.Da()&&(r=2):(i=new hC,r=+!t.Da());try{switch(r){case 0:i.wa=await e.onListen(n,!0);break;case 1:i.wa=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(r){let e=hT(r,`Initialization of query '${aE(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.ba.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&hL(e)}async function hM(e,t){let r=t.query,n=3,i=e.queries.get(r);if(i){let e=i.ba.indexOf(t);e>=0&&(i.ba.splice(e,1),0===i.ba.length?n=+!t.Da():!i.Sa()&&t.Da()&&(n=2))}switch(n){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function hR(e,t){let r=!1;for(let n of t){let t=n.query,i=e.queries.get(t);if(i){for(let e of i.ba)e.Fa(n)&&(r=!0);i.wa=n}}r&&hL(e)}function hO(e,t,r){let n=e.queries.get(t);if(n)for(let e of n.ba)e.onError(r);e.queries.delete(t)}function hL(e){e.Ca.forEach(e=>{e.next()})}(L=O||(O={})).Ma="default",L.Cache="cache";class hP{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new hk(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.Ka||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=hk.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==O.Cache}}class hF{constructor(e,t){this.qa=e,this.byteLength=t}Ua(){return"metadata"in this.qa}}class hV{constructor(e){this.serializer=e}Ks(e){return oO(this.serializer,e)}qs(e){return e.metadata.exists?oU(this.serializer,e.document,!1):s$.newNoDocument(this.Ks(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return oA(e)}}class hB{constructor(e,t){this.$a=e,this.serializer=t,this.Wa=[],this.Qa=[],this.collectionGroups=new Set,this.progress=hU(e)}get queries(){return this.Wa}get documents(){return this.Qa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Wa.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Qa.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let r=ny.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.qa.document&&(this.Qa[this.Qa.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,r=new hV(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.Ks(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||aO()).add(e);t.set(r,n)}}return t}async ja(e){let t=await ub(e,new hV(this.serializer),this.Qa,this.$a.id),r=this.za(this.documents);for(let t of this.Wa)await ux(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ha:this.collectionGroups,Ja:t}}}function hU(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class hj{constructor(e){this.key=e}}class hq{constructor(e){this.key=e}}class hz{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=aO(),this.mutatedKeys=aO(),this.eu=aS(e),this.tu=new hS(this.eu)}get nu(){return this.Za}ru(e,t){let r=t?t.iu:new h_,n=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),h=aI(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(r.track({type:3,doc:h}),f=!0):this.su(u,h)||(r.track({type:2,doc:h}),f=!0,(o&&this.eu(h,o)>0||l&&0>this.eu(h,l))&&(a=!0)):!u&&h?(r.track({type:0,doc:h}),f=!0):u&&!h&&(r.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{tu:s,iu:r,Ss:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var r,n;let i;return r=e.type,n=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return r8(20277,{Vt:e})}})(r)-i(n)||this.eu(e.doc,t.doc)}),this.ou(r),n=n??!1;let a=t&&!n?this._u():[],o=0===this.Ya.size&&this.current&&!n?1:0,l=o!==this.Xa;return(this.Xa=o,0!==s.length||l)?{snapshot:new hk(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new h_,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Za=this.Za.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Za=this.Za.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=aO(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))});let t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new hq(e))}),this.Ya.forEach(r=>{e.has(r)||t.push(new hj(r))}),t}cu(e){this.Za=e.ks,this.Ya=aO();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return hk.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Xa,this.hasCachedResults)}}let hK="SyncEngine";class hG{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class h${constructor(e){this.key=e,this.hu=!1}}class hQ{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new a_(e=>ax(e),ab),this.Iu=new Map,this.Eu=new Set,this.Ru=new i4(nb.comparator),this.Au=new Map,this.Vu=new l0,this.du={},this.mu=new Map,this.fu=lR.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function hH(e,t,r=!0){let n,i=cg(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.lu()):n=await hJ(i,t,r,!0),n}async function hW(e,t){let r=cg(e);await hJ(r,t,!0,!1)}async function hJ(e,t,r,n){let i,s=await ug(e.localStore,ap(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await hY(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&u9(e.remoteStore,s),i}async function hY(e,t,r,n,i){e.pu=(t,r,n)=>(async function(e,t,r,n){let i=t.view.ru(r);i.Ss&&(i=await up(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return ce(e,t.targetId,o.au),o.snapshot})(e,t,r,n);let s=await up(e.localStore,t,!0),a=new hz(t,s.ks),o=a.ru(s.documents),l=og.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);ce(e,r,u.au);let h=new hG(t,r,a);return e.Tu.set(t,h),e.Iu.has(r)?e.Iu.get(r).push(t):e.Iu.set(r,[t]),u.snapshot}async function hX(e,t,r){let n=e.Tu.get(t),i=e.Iu.get(n.targetId);i.length>1?(e.Iu.set(n.targetId,i.filter(e=>!ab(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await um(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),r&&he(e.remoteStore,n.targetId),h7(e,n.targetId)}).catch(nq)):(h7(e,n.targetId),await um(e.localStore,n.targetId,!0))}async function hZ(e,t){let r=e.Tu.get(t),n=e.Iu.get(r.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),he(e.remoteStore,r.targetId))}async function h0(e,t,r){let n=cm(e);try{var i,s;let e,a,o,l,u,h=await (i=n.localStore,o=nC.now(),l=t.reduce((e,t)=>e.add(t.key),aO()),i.persistence.runTransaction("Locally write mutations","readwrite",r=>{let n=ak,s=aO();return i.xs.getEntries(r,l).next(e=>{(n=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(r,n)).next(n=>{e=n;let s=[];for(let r of t){let t=function(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=aB(n.transform,e||null);null!=i&&(null===r&&(r=sG.empty()),r.set(n.field,i))}return r||null}(r,e.get(r.key).overlayedDocument);null!=t&&s.push(new a5(r.key,t,function e(t){let r=[];return i3(t.fields,(t,n)=>{let i=new nw([t]);if(sV(n)){let t=e(n.mapValue).fields;if(0===t.length)r.push(i);else for(let e of t)r.push(i.child(e))}else r.push(i)}),new sn(r)}(t.value.mapValue),aJ.exists(!0)))}return i.mutationQueue.addMutationBatch(r,o,s,t)}).next(t=>{a=t;let n=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(r,t.batchId,n)})}).then(()=>({batchId:a.batchId,changes:aD(e)})));n.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=n.du[n.currentUser.toKey()])||(u=new i4(nc)),u=u.insert(s,r),n.du[n.currentUser.toKey()]=u,await cr(n,h.changes),await hd(n.remoteStore)}catch(t){let e=hT(t,"Failed to persist write");r.reject(e)}}async function h1(e,t){var r;try{let n,i,s=await (r=e.localStore,n=t.snapshotVersion,i=r.vs,r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.xs.newChangeBuffer({trackRemovals:!0});i=r.vs;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(r.li.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.li.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(ss.EMPTY_BYTE_STRING,nA.min()).withLastLimboFreeSnapshotVersion(nA.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(r.li.updateTargetData(e,h))});let o=ak,l=aO();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(uf(e,s,t.documentUpdates).next(e=>{o=e.Bs,l=e.Ls})),!n.isEqual(nA.min())){let t=r.li.getLastRemoteSnapshotVersion(e).next(t=>r.li.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return nz.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.vs=i,e)));t.targetChanges.forEach((t,r)=>{let n=e.Au.get(r);n&&(r7(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?n.hu=!0:t.modifiedDocuments.size>0?r7(n.hu,14607):t.removedDocuments.size>0&&(r7(n.hu,42227),n.hu=!1))}),await cr(e,s,t)}catch(e){await nq(e)}}function h2(e,t,r){var n;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r,i=[];e.Tu.forEach((e,r)=>{let n=r.view.va(t);n.snapshot&&i.push(n.snapshot)}),(n=e.eventManager).onlineState=t,r=!1,n.queries.forEach((e,n)=>{for(let e of n.ba)e.va(t)&&(r=!0)}),r&&hL(n),i.length&&e.Pu.J_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function h5(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let n=e.Au.get(t),i=n&&n.key;if(i){let r=new i4(nb.comparator);r=r.insert(i,s$.newNoDocument(i,nA.min()));let n=aO().add(i),s=new of(nA.min(),new Map,new i4(nc),r,n);await h1(e,s),e.Ru=e.Ru.remove(i),e.Au.delete(t),ct(e)}else await um(e.localStore,t,!1).then(()=>h7(e,t,r)).catch(nq)}async function h6(e,t){var r;let n=t.batch.batchId;try{let i=await (r=e.localStore,r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n,i,s,a=t.batch.keys(),o=r.xs.newChangeBuffer({trackRemovals:!0});return(i=(n=t.batch).keys(),s=nz.resolve(),i.forEach(r=>{s=s.next(()=>o.getEntry(e,r)).next(e=>{let i=t.docVersions.get(r);r7(null!==i,48541),0>e.version.compareTo(i)&&(n.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>r.mutationQueue.removeMutationBatch(e,n))).next(()=>o.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=aO();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,a))}));h4(e,n,null),h8(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await cr(e,i)}catch(e){await nq(e)}}async function h3(e,t,r){var n;try{let i=await (n=e.localStore,n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(r7(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))}));h4(e,t,r),h8(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await cr(e,i)}catch(e){await nq(e)}}function h8(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function h4(e,t,r){let n=e.du[e.currentUser.toKey()];if(n){let i=n.get(t);i&&(r?i.reject(r):i.resolve(),n=n.remove(t)),e.du[e.currentUser.toKey()]=n}}function h7(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(n),r&&e.Pu.yu(n,r);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach(t=>{e.Vu.containsKey(t)||h9(e,t)})}function h9(e,t){e.Eu.delete(t.path.canonicalString());let r=e.Ru.get(t);null!==r&&(he(e.remoteStore,r),e.Ru=e.Ru.remove(t),e.Au.delete(r),ct(e))}function ce(e,t,r){for(let n of r)n instanceof hj?(e.Vu.addReference(n.key,t),function(e,t){let r=t.key,n=r.path.canonicalString();e.Ru.get(r)||e.Eu.has(n)||(r2(hK,"New document in limbo: "+r),e.Eu.add(n),ct(e))}(e,n)):n instanceof hq?(r2(hK,"Document no longer in limbo: "+n.key),e.Vu.removeReference(n.key,t),e.Vu.containsKey(n.key)||h9(e,n.key)):r8(19791,{wu:n})}function ct(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let r=new nb(ny.fromString(t)),n=e.fu.next();e.Au.set(n,new h$(r)),e.Ru=e.Ru.insert(r,n),u9(e.remoteStore,new oJ(ap(ad(r.path)),n,"TargetPurposeLimboResolution",n6.ce))}}async function cr(e,t,r){let n=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,r).then(t=>{if((t||r)&&e.isPrimaryClient){let n=t?!t.fromCache:r?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(t){n.push(t);let e=ua.Es(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.J_(n),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>nz.forEach(t,t=>nz.forEach(t.Ts,n=>e.persistence.referenceDelegate.addReference(r,t.targetId,n)).next(()=>nz.forEach(t.Is,n=>e.persistence.referenceDelegate.removeReference(r,t.targetId,n)))))}catch(e){if(!nJ(e))throw e;r2(uu,"Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.vs.get(t),n=r.snapshotVersion,i=r.withLastLimboFreeSnapshotVersion(n);e.vs=e.vs.insert(t,i)}}}(e.localStore,i))}async function cn(e,t){if(!e.currentUser.isEqual(t)){r2(hK,"User change. New user:",t.toKey());let r=await uc(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new ne(r9.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await cr(e,r.Ns)}}function ci(e,t){let r=e.Au.get(t);if(r&&r.hu)return aO().add(r.key);{let r=aO(),n=e.Iu.get(t);if(!n)return r;for(let t of n){let n=e.Tu.get(t);r=r.unionWith(n.view.nu)}return r}}async function cs(e,t){let r=await up(e.localStore,t.query,!0),n=t.view.cu(r);return e.isPrimaryClient&&ce(e,t.targetId,n.au),n}async function ca(e,t){return uv(e.localStore,t).then(t=>cr(e,t))}async function co(e,t,r,n){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.Xn(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):nz.resolve(null))));null!==o?("pending"===r?await hd(e.remoteStore):"acknowledged"===r||"rejected"===r?(h4(e,t,n||null),h8(e,t),s=e.localStore,s.mutationQueue.nr(t)):r8(6720,"Unknown batchState",{bu:r}),await cr(e,o)):r2(hK,"Cannot apply mutation batch with id: "+t)}async function cl(e,t){if(cg(e),cm(e),!0===t&&!0!==e.gu){let t=e.sharedClientState.getAllActiveQueryTargets(),r=await cu(e,t.toArray());for(let t of(e.gu=!0,await hb(e.remoteStore,!0),r))u9(e.remoteStore,t)}else if(!1===t&&!1!==e.gu){let t=[],r=Promise.resolve();e.Iu.forEach((n,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):r=r.then(()=>(h7(e,i),um(e.localStore,i,!0))),he(e.remoteStore,i)}),await r,await cu(e,t),e.Au.forEach((t,r)=>{he(e.remoteStore,r)}),e.Vu.zr(),e.Au=new Map,e.Ru=new i4(nb.comparator),e.gu=!1,await hb(e.remoteStore,!1)}}async function cu(e,t,r){let n=[],i=[];for(let r of t){let t,s=e.Iu.get(r);if(s&&0!==s.length)for(let r of(t=await ug(e.localStore,ap(s[0])),s)){let t=e.Tu.get(r),n=await cs(e,t);n.snapshot&&i.push(n.snapshot)}else{let n=await uy(e.localStore,r);t=await ug(e.localStore,n),await hY(e,ch(n),r,!1,t.resumeToken)}n.push(t)}return e.Pu.J_(i),n}function ch(e){var t,r,n,i,s;return t=e.path,r=e.collectionGroup,n=e.orderBy,i=e.filters,s=e.limit,new ac(t,r,n,i,s,"F",e.startAt,e.endAt)}function cc(e){return e.localStore.persistence.hs()}async function cd(e,t,r,n){if(e.gu)return void r2(hK,"Ignoring unexpected query state notification.");let i=e.Iu.get(t);if(i&&i.length>0)switch(r){case"current":case"not-current":{let n=await uv(e.localStore,aT(i[0])),s=of.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,ss.EMPTY_BYTE_STRING);await cr(e,n,s);break}case"rejected":await um(e.localStore,t,!0),h7(e,t,n);break;default:r8(64155,r)}}async function cf(e,t,r){let n=cg(e);if(n.gu){for(let e of t){if(n.Iu.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){r2(hK,"Adding an already active target "+e);continue}let t=await uy(n.localStore,e),r=await ug(n.localStore,t);await hY(n,ch(t),r.targetId,!1,r.resumeToken),u9(n.remoteStore,r)}for(let e of r)n.Iu.has(e)&&await um(n.localStore,e,!1).then(()=>{he(n.remoteStore,e),h7(n,e)}).catch(nq)}}function cg(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=h1.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ci.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=h5.bind(null,e),e.Pu.J_=hR.bind(null,e.eventManager),e.Pu.yu=hO.bind(null,e.eventManager),e}function cm(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=h6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=h3.bind(null,e),e}class cp{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=uJ(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,r;return t=this.persistence,r=new ul,new uh(t,r,e.initialUser,this.serializer)}Cu(e){return new l8(l7.Vi,this.serializer)}Du(e){return new uL}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}cp.provider={build:()=>new cp};class cy extends cp{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return r7(this.persistence.referenceDelegate instanceof l9,46915),new lB(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?lk.withCacheSize(this.cacheSizeBytes):lk.DEFAULT;return new l8(e=>l9.Vi(e,t),this.serializer)}}class cv extends cp{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await cm(this.xu.syncEngine),await hd(this.xu.remoteStore),await this.persistence.zi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,r;return t=this.persistence,r=new ul,new uh(t,r,e.initialUser,this.serializer)}Fu(e,t){return new lB(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let r=new n5(t,this.persistence);return new n2(e.asyncQueue,r)}Cu(e){let t=us(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?lk.withCacheSize(this.cacheSizeBytes):lk.DEFAULT;return new ui(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,uH(),uW(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new uL}}class cw extends cv{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.xu.syncEngine;this.sharedClientState instanceof uO&&(this.sharedClientState.syncEngine={So:co.bind(null,t),Do:cd.bind(null,t),Co:cf.bind(null,t),hs:cc.bind(null,t),bo:ca.bind(null,t)},await this.sharedClientState.start()),await this.persistence.zi(async e=>{await cl(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){let t=uH();if(!uO.v(t))throw new ne(r9.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=us(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new uO(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class cb{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>h2(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=cn.bind(null,this.syncEngine),await hb(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new hA}createDatastore(e){var t;let r=uJ(e.databaseInfo.databaseId),n=new uQ(e.databaseInfo);return t=e.authCredentials,new u5(t,e.appCheckCredentials,n,r)}createRemoteStore(e){var t,r;return t=this.localStore,r=this.datastore,new u8(t,r,e.asyncQueue,e=>h2(this.syncEngine,e,0),uV.v()?new uV:new uP)}createSyncEngine(e,t){var r,n,i,s,a,o;let l;return r=this.localStore,n=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new hQ(r,n,i,s,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){r2(u3,"RemoteStore shutting down."),e.Ea.add(5),await u7(e),e.Aa.shutdown(),e.Va.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}function cx(e,t=10240){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}cb.provider={build:()=>new cb};class cE{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):r5("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class cI{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new nt,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.Ua()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.qa)}`))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.ku()}async ku(){let e=await this.Ku();if(null===e)return null;let t=this.Lu.decode(e),r=Number(t);return isNaN(r)&&this.qu(`length string (${t}) is not valid number`),new hF(JSON.parse(await this.Uu(r)),e.length+r)}$u(){return this.buffer.findIndex(e=>123===e)}async Ku(){for(;0>this.$u()&&!await this.Wu(););if(0===this.buffer.length)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Uu(e){for(;this.buffer.length<e;)await this.Wu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Bu.cancel(),Error(`Invalid bundle format: ${e}`)}async Wu(){let e=await this.Bu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class cT{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.Su();if(!r||!r.Ua())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.qa)}`);this.metadata=r;do null!==(r=this.Su())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}Qu(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.Ku();return new hF(JSON.parse(this.Uu(e)),e)}Uu(e){if(this.cursor+e>this.bundleData.length)throw new ne(r9.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}Ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class cS{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ne(r9.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let r={documents:t.map(t=>oR(e.serializer,t))},n=await e.jo("BatchGetDocuments",e.serializer.databaseId,ny.emptyPath(),r,t.length),i=new Map;n.forEach(t=>{var r;let n,s,a,o,l,u,h=(r=e.serializer,"found"in t?(r7(!!t.found,43571),t.found.name,t.found.updateTime,n=oO(r,t.found.name),s=oA(t.found.updateTime),a=t.found.createTime?oA(t.found.createTime):nA.min(),o=new sG({mapValue:{fields:t.found.fields}}),s$.newFoundDocument(n,s,a,o)):"missing"in t?(r7(!!t.missing,3894),r7(!!t.readTime,22933),l=oO(r,t.missing),u=oA(t.readTime),s$.newNoDocument(l,u)):r8(7234,{result:t}));i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());r7(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new a4(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=nb.fromPath(t);this.mutations.push(new a7(r,this.precondition(r)))}),await async function(e,t){let r={writes:t.map(t=>oj(e.serializer,t))};await e.Wo("Commit",e.serializer.databaseId,ny.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw r8(50498,{Gu:e.constructor.name});t=nA.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new ne(r9.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(nA.min())?aJ.exists(!1):aJ.updateTime(t):aJ.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(nA.min()))throw new ne(r9.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return aJ.updateTime(t)}return aJ.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class c_{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.zu=r.maxAttempts,this.M_=new uY(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Hu()}Hu(){this.M_.p_(async()=>{let e=new cS(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Zu(e)}))}).catch(e=>{this.Zu(e)})})}Ju(e){try{let t=this.updateFunction(e);return!n3(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Zu(e){this.zu>0&&this.Xu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Hu(),Promise.resolve()))):this.deferred.reject(e)}Xu(e){if("FirebaseError"===e?.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!oi(t)}return!1}}let ck="FirestoreClient";class cC{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=n,this.user=rX.UNAUTHENTICATED,this.clientId=nh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{r2(ck,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(r2(ck,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new nt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=hT(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function cA(e,t){e.asyncQueue.verifyOperationInProgress(),r2(ck,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await uc(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function cD(e,t){e.asyncQueue.verifyOperationInProgress();let r=await cN(e);r2(ck,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>hw(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>hw(t.remoteStore,r)),e._onlineComponents=t}async function cN(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){r2(ck,"Using user provided OfflineComponentProvider");try{await cA(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===r9.FAILED_PRECONDITION||t.code===r9.UNIMPLEMENTED:!("u">typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;r6("Error using user provided cache. Falling back to memory cache: "+t),await cA(e,new cp)}}else r2(ck,"Using default OfflineComponentProvider"),await cA(e,new cy(void 0));return e._offlineComponents}async function cM(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(r2(ck,"Using user provided OnlineComponentProvider"),await cD(e,e._uninitializedComponentsProvider._online)):(r2(ck,"Using default OnlineComponentProvider"),await cD(e,new cb))),e._onlineComponents}function cR(e){return cN(e).then(e=>e.localStore)}function cO(e){return cM(e).then(e=>e.syncEngine)}function cL(e){return cM(e).then(e=>e.datastore)}async function cP(e){let t=await cM(e),r=t.eventManager;return r.onListen=hH.bind(null,t.syncEngine),r.onUnlisten=hX.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=hW.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=hZ.bind(null,t.syncEngine),r}function cF(e,t,r={}){let n=new nt;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await cP(e),s=e.asyncQueue,a=new cE({next:e=>{a.Nu(),s.enqueueAndForget(()=>hM(i,o));let l=e.docs.has(t);!l&&e.fromCache?n.reject(new ne(r9.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&r&&"server"===r.source?n.reject(new ne(r9.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):n.resolve(e)},error:e=>n.reject(e)}),hN(i,o=new hP(ad(t.path),a,{includeMetadataChanges:!0,Ka:!0}))}),n.promise}function cV(e,t,r={}){let n=new nt;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await cP(e),s=e.asyncQueue,o=new hP(t,a=new cE({next:e=>{a.Nu(),s.enqueueAndForget(()=>hM(i,o)),e.fromCache&&"server"===r.source?n.reject(new ne(r9.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):n.resolve(e)},error:e=>n.reject(e)}),{includeMetadataChanges:!0,Ka:!0}),hN(i,o)}),n.promise}function cB(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let cU=new Map,cj="firestore.googleapis.com";class cq{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new ne(r9.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=cj,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new ne(r9.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,n){if(!0===t&&!0===n)throw new ne(r9.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=cB(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new ne(r9.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new ne(r9.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new ne(r9.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class cz{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cq({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ne(r9.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new ne(r9.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cq(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new nn;switch(e.type){case"firstParty":return new no(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new ne(r9.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=cU.get(this))&&(r2("ComponentProvider","Removing Datastore"),cU.delete(this),e.terminate()),Promise.resolve()}}class cK{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new cK(this.firestore,e,this._query)}}class cG{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new c$(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new cG(this.firestore,e,this._key)}toJSON(){return{type:cG._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(nk(t,cG._jsonSchema))return new cG(e,r||null,new nb(ny.fromString(t.referencePath)))}}cG._jsonSchemaVersion="firestore/documentReference/1.0",cG._jsonSchema={type:n_("string",cG._jsonSchemaVersion),referencePath:n_("string")};class c$ extends cK{constructor(e,t,r){super(e,t,ad(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new cG(this.firestore,null,new nb(e))}withConverter(e){return new c$(this.firestore,e,this._path)}}function cQ(e,t,...r){if(e=(0,r$.getModularInstance)(e),1==arguments.length&&(t=nh.newId()),function(e,t,r){if(!r)throw new ne(r9.INVALID_ARGUMENT,`Function doc() cannot be called with an empty ${t}.`)}(0,"path",t),e instanceof cz){let n=ny.fromString(t,...r);return nx(n),new cG(e,null,new nb(n))}{if(!(e instanceof cG||e instanceof c$))throw new ne(r9.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(ny.fromString(t,...r));return nx(n),new cG(e.firestore,e instanceof c$?e.converter:null,new nb(n))}}function cH(e,t){return e=(0,r$.getModularInstance)(e),t=(0,r$.getModularInstance)(t),e instanceof cK&&t instanceof cK&&e.firestore===t.firestore&&ab(e._query,t._query)&&e.converter===t.converter}let cW="AsyncQueue";class cJ{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new uY(this,"async_queue_retry"),this._c=()=>{let e=uW();e&&r2(cW,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=uW();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=uW();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new nt;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(0!==this.Yu.length){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!nJ(e))throw e;r2(cW,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,r5("INTERNAL UNHANDLED ERROR: ",cY(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let n=hI.createAndSchedule(this,e,t,r,e=>this.hc(e));return this.tc.push(n),n}uc(){this.nc&&r8(47125,{Pc:cY(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function cY(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class cX{constructor(){this._progressObserver={},this._taskCompletionResolver=new nt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class cZ extends cz{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new cJ,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new cJ(e),this._firestoreClient=void 0,await e}}}function c0(e){if(e._terminated)throw new ne(r9.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,r,n,i,s;let a,o=e._freezeSettings(),l=(t=e._databaseId,r=e._app?.options.appId||"",n=e._persistenceKey,i=e._app?.options.apiKey,new sy(t,r,n,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,cB(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator,i));e._componentsProvider||o.localCache?._offlineComponentProvider&&o.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),e._firestoreClient=new cC(e._authCredentials,e._appCheckCredentials,e._queue,l,e._componentsProvider&&(s=e._componentsProvider,a=s?._online.build(),{_offline:s?._offline.build(a),_online:a}))}(e),e._firestoreClient}function c1(e,t){let r=c0(e=nT(e,cZ)),n=new cX;return function(e,t,r,n){var i;let s=(i=uJ(t),new cI(function(e,t){if(e instanceof Uint8Array)return cx(e,void 0);if(e instanceof ArrayBuffer)return cx(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof r?oo().encode(r):r),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,r){try{var n,i;let s,a=await t.getMetadata();if(await (n=e.localStore,s=oA(a.createTime),n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Pi.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),r._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);r._updateProgress(hU(a));let o=new hB(a,t.serializer),l=await t.Su();for(;l;){let e=await o.Ga(l);e&&r._updateProgress(e),l=await t.Su()}let u=await o.ja(e.localStore);return await cr(e,u.Ja,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Pi.saveBundleMetadata(e,a))),r._completeWith(u.progress),Promise.resolve(u.Ha)}catch(e){return r6(hK,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}})(t=await cO(e),s,n).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(r,e._databaseId,t,n),n}class c2{constructor(e){this._byteString=e}static fromBase64String(e){try{return new c2(ss.fromBase64String(e))}catch(e){throw new ne(r9.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new c2(ss.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:c2._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(nk(e,c2._jsonSchema))return c2.fromBase64String(e.bytes)}}c2._jsonSchemaVersion="firestore/bytes/1.0",c2._jsonSchema={type:n_("string",c2._jsonSchemaVersion),bytes:n_("string")};class c5{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new ne(r9.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new nw(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class c6{constructor(e){this._methodName=e}}class c3{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ne(r9.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ne(r9.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return nc(this._lat,e._lat)||nc(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:c3._jsonSchemaVersion}}static fromJSON(e){if(nk(e,c3._jsonSchema))return new c3(e.latitude,e.longitude)}}c3._jsonSchemaVersion="firestore/geoPoint/1.0",c3._jsonSchema={type:n_("string",c3._jsonSchemaVersion),latitude:n_("number"),longitude:n_("number")};class c8{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:c8._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(nk(e,c8._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new c8(e.vectorValues);throw new ne(r9.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}c8._jsonSchemaVersion="firestore/vectorValue/1.0",c8._jsonSchema={type:n_("string",c8._jsonSchemaVersion),vectorValues:n_("object")};let c4=/^__.*__$/;class c7{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new a5(e,this.data,this.fieldMask,t,this.fieldTransforms):new a2(e,this.data,t,this.fieldTransforms)}}class c9{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new a5(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function de(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw r8(40011,{dataSource:e})}}class dt{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new dt({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return dy(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(de(this.dataSource)&&c4.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class dr{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||uJ(e)}createContext(e,t,r,n=!1){return new dt({dataSource:e,methodName:t,targetDoc:r,path:nw.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function dn(e){let t=e._freezeSettings(),r=uJ(e._databaseId);return new dr(e._databaseId,!!t.ignoreUndefinedProperties,r)}function di(e,t,r,n,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);df("Data must be an object, but it was:",l,n);let u=dc(n,l);if(s.merge)a=new sn(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=dg(t,n,r);if(!l.contains(i))throw new ne(r9.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);dv(e,i)||e.push(i)}a=new sn(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new c7(new sG(u),a,o)}class ds extends c6{_toFieldTransform(e){if(2!==e.dataSource)throw 1===e.dataSource?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ds}}function da(e,t,r,n){let i=e.createContext(1,t,r);df("Data must be an object, but it was:",i,n);let s=[],a=sG.empty();return i3(n,(e,n)=>{let o=dp(t,e,r);n=(0,r$.getModularInstance)(n);let l=i.childContextForFieldPath(o);if(n instanceof ds)s.push(o);else{let e=dh(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new c9(a,new sn(s),i.fieldTransforms)}function dl(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[dg(t,n,r)],l=[i];if(s.length%2!=0)throw new ne(r9.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(dg(t,s[e])),l.push(s[e+1]);let u=[],h=sG.empty();for(let e=o.length-1;e>=0;--e)if(!dv(u,o[e])){let t=o[e],r=l[e];r=(0,r$.getModularInstance)(r);let n=a.childContextForFieldPath(t);if(r instanceof ds)u.push(t);else{let e=dh(r,n);null!=e&&(u.push(t),h.set(t,e))}}return new c9(h,new sn(u),a.fieldTransforms)}function du(e,t,r,n=!1){return dh(r,e.createContext(n?4:3,t))}function dh(e,t){if(dd(e=(0,r$.getModularInstance)(e)))return df("Unsupported field value:",t,e),dc(e,t);if(e instanceof c6)return function(e,t){if(!de(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");let r=[],n=0;for(let i of e){let e=dh(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}return function(e,t){var r,n,i;if(null===(e=(0,r$.getModularInstance)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return r=t.serializer,n4(n=e)?aF(n):aP(r,n);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=nC.fromDate(e);return{timestampValue:ok(t.serializer,r)}}if(e instanceof nC){let r=new nC(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ok(t.serializer,r)}}if(e instanceof c3)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof c2)return{bytesValue:oC(t.serializer,e._byteString)};if(e instanceof cG){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:oD(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof c8)return{mapValue:{fields:{[sb]:{stringValue:sI},[sT]:{arrayValue:{values:((i=e)instanceof c8?i.toArray():i).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return aP(t.serializer,e)})}}}}};if(oW(e))return e._toProto(t.serializer);throw t.createError(`Unsupported field value: ${nI(e)}`)}(e,t)}function dc(e,t){let r={};return i8(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):i3(e,(e,n)=>{let i=dh(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function dd(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof nC||e instanceof c3||e instanceof c2||e instanceof cG||e instanceof c6||e instanceof c8||oW(e))}function df(e,t,r){if(!dd(r)||!nE(r)){let n=nI(r);throw"an object"===n?t.createError(e+" a custom object"):t.createError(e+" "+n)}}function dg(e,t,r){if((t=(0,r$.getModularInstance)(t))instanceof c5)return t._internalPath;if("string"==typeof t)return dp(e,t);throw dy("Field path arguments must be of type string or ",e,!1,void 0,r)}let dm=RegExp("[~\\*/\\[\\]]");function dp(e,t,r){if(t.search(dm)>=0)throw dy(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new c5(...t.split("."))._internalPath}catch(n){throw dy(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function dy(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new ne(r9.INVALID_ARGUMENT,o+e+l)}function dv(e,t){return e.some(e=>e.isEqual(t))}class dw{convertValue(e,t="none"){switch(s_(e)){case 0:return null;case 1:return e.booleanValue;case 2:return sl(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(su(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw r8(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return i3(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new c8(e.fields?.[sT].arrayValue?.values?.map(e=>sl(e.doubleValue)))}convertGeoPoint(e){return new c3(sl(e.latitude),sl(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=sm(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(sp(e));default:return null}}convertTimestamp(e){let t=so(e);return new nC(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ny.fromString(e);r7(oH(r),9688,{name:e});let n=new sw(r.get(1),r.get(3)),i=new nb(r.popFirst(5));return n.isEqual(t)||r5(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class db extends dw{constructor(e){super(),this.firestore=e}convertBytes(e){return new c2(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new cG(this.firestore,null,t)}}let dx="@firebase/firestore",dE="4.10.0";function dI(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class dT{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class dS{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new sG({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class d_{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new cG(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new dk(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(dg("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class dk extends d_{data(){return super.data()}}function dC(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new ne(r9.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class dA{}class dD extends dA{}function dN(e,t,...r){let n=[];for(let i of(t instanceof dA&&n.push(t),function(e){let t=e.filter(e=>e instanceof dO).length,r=e.filter(e=>e instanceof dM).length;if(t>1||t>0&&r>0)throw new ne(r9.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(r)),n))e=i._apply(e);return e}class dM extends dD{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new dM(e,t,r)}_apply(e){let t=this._parse(e);return dY(e._query,t),new cK(e.firestore,e.converter,av(e._query,t))}_parse(e){let t=dn(e.firestore);return function(e,t,r,n,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new ne(r9.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){dJ(a,s);let t=[];for(let r of a)t.push(dW(n,e,r));o={arrayValue:{values:t}}}else o=dW(n,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||dJ(a,s),o=du(r,t,a,"in"===s||"not-in"===s);return sX.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function dR(e,t,r){let n=dg("where",e);return dM._create(n,t,r)}class dO extends dA{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new dO(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:sZ.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;for(let e of t.getFlattenedFilters())dY(r,e),r=av(r,e)}(e._query,t),new cK(e.firestore,e.converter,av(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function dL(...e){return e.forEach(e=>dX("or",e)),dO._create("or",e)}function dP(...e){return e.forEach(e=>dX("and",e)),dO._create("and",e)}class dF extends dD{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new dF(e,t)}_apply(e){var t;let r,n=function(e,t,r){if(null!==e.startAt)throw new ne(r9.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new ne(r9.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new sJ(t,r)}(e._query,this._field,this._direction);return new cK(e.firestore,e.converter,(t=e._query,r=t.explicitOrderBy.concat([n]),new ac(t.path,t.collectionGroup,r,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function dV(e,t="asc"){let r=dg("orderBy",e);return dF._create(r,t)}class dB extends dD{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new dB(e,t,r)}_apply(e){return new cK(e.firestore,e.converter,aw(e._query,this._limit,this._limitType))}}function dU(e){return nS("limit",e),dB._create("limit",e,"F")}function dj(e){return nS("limitToLast",e),dB._create("limitToLast",e,"L")}class dq extends dD{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new dq(e,t,r)}_apply(e){var t;let r=dH(e,this.type,this._docOrFields,this._inclusive);return new cK(e.firestore,e.converter,(t=e._query,new ac(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,r,t.endAt)))}}function dz(...e){return dq._create("startAt",e,!0)}function dK(...e){return dq._create("startAfter",e,!1)}class dG extends dD{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new dG(e,t,r)}_apply(e){var t;let r=dH(e,this.type,this._docOrFields,this._inclusive);return new cK(e.firestore,e.converter,(t=e._query,new ac(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,r)))}}function d$(...e){return dG._create("endBefore",e,!1)}function dQ(...e){return dG._create("endAt",e,!0)}function dH(e,t,r,n){if(r[0]=(0,r$.getModularInstance)(r[0]),r[0]instanceof d_)return function(e,t,r,n,i){if(!n)throw new ne(r9.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of am(e))if(r.field.isKeyField())s.push(sR(t,n.key));else{let e=n.data.field(r.field);if(sg(e))throw new ne(r9.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=r.field.canonicalString();throw new ne(r9.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new sQ(s,i)}(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=dn(e.firestore);return function(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new ne(r9.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new ne(r9.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!ag(e)&&-1!==l.indexOf("/"))throw new ne(r9.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(ny.fromString(l));if(!nb.isDocumentKey(r))throw new ne(r9.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new nb(r);o.push(sR(t,i))}else{let e=du(r,n,l);o.push(e)}}return new sQ(o,s)}(e._query,e.firestore._databaseId,i,t,r,n)}}function dW(e,t,r){if("string"==typeof(r=(0,r$.getModularInstance)(r))){if(""===r)throw new ne(r9.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ag(t)&&-1!==r.indexOf("/"))throw new ne(r9.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(ny.fromString(r));if(!nb.isDocumentKey(n))throw new ne(r9.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return sR(e,new nb(n))}if(r instanceof cG)return sR(e,r._key);throw new ne(r9.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${nI(r)}.`)}function dJ(e,t){if(!Array.isArray(e)||0===e.length)throw new ne(r9.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function dY(e,t){let r=function(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new ne(r9.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new ne(r9.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function dX(e,t){if(!(t instanceof dM||t instanceof dO))throw new ne(r9.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function dZ(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class d0 extends dw{constructor(e){super(),this.firestore=e}convertBytes(e){return new c2(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new cG(this.firestore,null,t)}}function d1(e){return new dT("sum",dg("sum",e))}function d2(e){return new dT("avg",dg("average",e))}function d5(){return new dT("count")}function d6(e,t){return e instanceof dT&&t instanceof dT&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function d3(e,t){return cH(e.query,t.query)&&(0,r$.deepEqual)(e.data(),t.data())}function d8(e){return d4(e,{count:d5()})}function d4(e,t){var r;let n,i=nT(e.firestore,cZ),s=c0(i),a=function(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}(t,(e,t)=>new or(t,e.aggregateType,e._internalFieldPath));return(r=e._query,n=new nt,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await cL(s);n.resolve(async function(e,t,r){let{request:n,gt:i,parent:s}=function(e,t,r,n){let{ft:i,parent:s}=oK(e,t),a={},o=[],l=0;return r.forEach(e=>{let t="aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:o$(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:o$(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},gt:a,parent:s}}(e.serializer,(t.Re||(t.Re=ay(t,t.explicitOrderBy)),t.Re),r);e.connection.Ko||delete n.parent;let a=(await e.jo("RunAggregationQuery",e.serializer.databaseId,s,n,1)).filter(e=>!!e.result);r7(1===a.length,64727);let o=a[0].result?.aggregateFields;return Object.keys(o).reduce((e,t)=>(e[i[t]]=o[t],e),{})}(e,r,a))}catch(e){n.reject(e)}}),n.promise).then(t=>new dS(e,new db(i),t))}class d7{constructor(e){this.kind="memory",this._onlineComponentProvider=cb.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new cy(void 0)}}toJSON(){return{kind:this.kind}}}class d9{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=fl(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class fe{constructor(){this.kind="memoryEager",this._offlineComponentProvider=cp.provider}toJSON(){return{kind:this.kind}}}class ft{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new cy(e)}}toJSON(){return{kind:this.kind}}}function fr(){return new fe}function fn(e){return new ft(e?.cacheSizeBytes)}function fi(e){return new d7(e)}function fs(e){return new d9(e)}class fa{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=cb.provider,this._offlineComponentProvider={build:t=>new cv(t,e?.cacheSizeBytes,this.forceOwnership)}}}class fo{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=cb.provider,this._offlineComponentProvider={build:t=>new cw(t,e?.cacheSizeBytes)}}}function fl(e){return new fa(e?.forceOwnership)}function fu(){return new fo}let fh="NOT SUPPORTED";class fc{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class fd extends d_{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new fg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(dg("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ne(r9.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=fd._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function ff(e,t,r){if(nk(t,fd._jsonSchema)){var n;if(t.bundle===fh)throw new ne(r9.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=uJ(e._databaseId),s=(n=t.bundle,new cT(n,i)),a=s.t(),o=new hB(s.getMetadata(),i);for(let e of a)o.o(e);let l=o.documents;if(1!==l.length)throw new ne(r9.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${l.length} documents.`);let u=oU(i,l[0].document),h=new nb(ny.fromString(t.bundleName));return new fd(e,new d0(e),h,u,new fc(!1,!1),r||null)}}fd._jsonSchemaVersion="firestore/documentSnapshot/1.0",fd._jsonSchema={type:n_("string",fd._jsonSchemaVersion),bundleSource:n_("string","DocumentSnapshot"),bundleName:n_("string"),bundle:n_("string")};class fg extends fd{data(e={}){return super.data(e)}}class fm{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new fc(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new fg(this._firestore,this._userDataWriter,r.key,r,new fc(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ne(r9.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new fg(e._firestore,e._userDataWriter,r.doc.key,r.doc,new fc(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new fg(e._firestore,e._userDataWriter,t.doc.key,t.doc,new fc(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return r8(61501,{type:e})}}(t.type),doc:n,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ne(r9.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=fm._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=nh.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function fp(e,t,r){if(nk(t,fm._jsonSchema)){var n;if(t.bundle===fh)throw new ne(r9.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=uJ(e._databaseId),s=(n=t.bundle,new cT(n,i)),a=s.t(),o=new hB(s.getMetadata(),i);for(let e of a)o.o(e);if(1!==o.queries.length)throw new ne(r9.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let l=o3(o.queries[0].bundledQuery),u=o.documents,h=new hS;u.map(e=>{let t=oU(i,e.document);h=h.add(t)});let c=hk.fromInitialDocuments(l,h,aO(),!1,!1),d=new cK(e,r||null,l);return new fm(e,new d0(e),d,c)}}function fy(e,t){return e instanceof fd&&t instanceof fd?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof fm&&t instanceof fm&&e._firestore===t._firestore&&cH(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}fm._jsonSchemaVersion="firestore/querySnapshot/1.0",fm._jsonSchema={type:n_("string",fm._jsonSchemaVersion),bundleSource:n_("string","QuerySnapshot"),bundleName:n_("string"),bundle:n_("string")};let fv={maxAttempts:5};class fw{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=dn(e)}set(e,t,r){this._verifyNotCommitted();let n=fb(e,this._firestore),i=dZ(n.converter,t,r),s=di(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,aJ.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=fb(e,this._firestore);return i="string"==typeof(t=(0,r$.getModularInstance)(t))||t instanceof c5?dl(this._dataReader,"WriteBatch.update",s._key,t,r,n):da(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,aJ.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=fb(e,this._firestore);return this._mutations=this._mutations.concat(new a4(t._key,aJ.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new ne(r9.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function fb(e,t){if((e=(0,r$.getModularInstance)(e)).firestore!==t)throw new ne(r9.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class fx{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=dn(e)}get(e){let t=fb(e,this._firestore),r=new d0(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return r8(24041);let n=e[0];if(n.isFoundDocument())return new d_(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new d_(this._firestore,r,t._key,null,t.converter);throw r8(18433,{doc:n})})}set(e,t,r){let n=fb(e,this._firestore),i=dZ(n.converter,t,r),s=di(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=fb(e,this._firestore);return i="string"==typeof(t=(0,r$.getModularInstance)(t))||t instanceof c5?dl(this._dataReader,"Transaction.update",s._key,t,r,n):da(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=fb(e,this._firestore);return this._transaction.delete(t._key),this}}class fE extends fx{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=fb(e,this._firestore),r=new db(this._firestore);return super.get(e).then(e=>new fd(this._firestore,r,t._key,e._document,new fc(!1,!1),t.converter))}}function fI(e,t,r){var n,i;let s;e=nT(e,cZ);let a={...fv,...r};if(a.maxAttempts<1)throw new ne(r9.INVALID_ARGUMENT,"Max attempts must be at least 1");return n=c0(e),i=r=>t(new fE(e,r)),s=new nt,n.asyncQueue.enqueueAndForget(async()=>{let e=await cL(n);new c_(n.asyncQueue,e,a,i,s).ju()}),s.promise}function fT(e){e=nT(e,cG);let t=nT(e.firestore,cZ);return cF(c0(t),e._key).then(r=>fV(t,e,r))}function fS(e){var t;let r;e=nT(e,cG);let n=nT(e.firestore,cZ),i=c0(n),s=new db(n);return(t=e._key,r=new nt,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await e.persistence.runTransaction("read document","readonly",r=>e.localDocuments.getDocument(r,t));n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new ne(r9.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=hT(n,`Failed to get document '${t} from cache`);r.reject(e)}})(await cR(i),t,r)),r.promise).then(t=>new fd(n,s,e._key,t,new fc(null!==t&&t.hasLocalMutations,!0),e.converter))}function f_(e){e=nT(e,cG);let t=nT(e.firestore,cZ);return cF(c0(t),e._key,{source:"server"}).then(r=>fV(t,e,r))}function fk(e){e=nT(e,cK);let t=nT(e.firestore,cZ),r=c0(t),n=new db(t);return dC(e._query),cV(r,e._query).then(r=>new fm(t,n,e,r))}function fC(e){var t;let r;e=nT(e,cK);let n=nT(e.firestore,cZ),i=c0(n),s=new db(n);return(t=e._query,r=new nt,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await up(e,t,!0),i=new hz(t,n.ks),s=i.ru(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=hT(n,`Failed to execute query '${t} against cache`);r.reject(e)}})(await cR(i),t,r)),r.promise).then(t=>new fm(n,s,e,t))}function fA(e){e=nT(e,cK);let t=nT(e.firestore,cZ),r=c0(t),n=new db(t);return cV(r,e._query,{source:"server"}).then(r=>new fm(t,n,e,r))}function fD(e,t,r){e=nT(e,cG);let n=nT(e.firestore,cZ),i=dZ(e.converter,t,r),s=dn(n);return fF(n,[di(s,"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,aJ.none())])}function fN(e,t,r,...n){e=nT(e,cG);let i=nT(e.firestore,cZ),s=dn(i);return fF(i,[("string"==typeof(t=(0,r$.getModularInstance)(t))||t instanceof c5?dl(s,"updateDoc",e._key,t,r,n):da(s,"updateDoc",e._key,t)).toMutation(e._key,aJ.exists(!0))])}function fM(e){return fF(nT(e.firestore,cZ),[new a4(e._key,aJ.none())])}function fR(e,t){let r=nT(e.firestore,cZ),n=cQ(e),i=dZ(e.converter,t);return fF(r,[di(dn(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,aJ.exists(!1))]).then(()=>n)}function fO(e,...t){var r;let n,i,s,a,o;e=(0,r$.getModularInstance)(e);let l={includeMetadataChanges:!1,source:"default"},u=0;"object"!=typeof t[0]||dI(t[u])||(l=t[u++]);let h={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(dI(t[u])){let e=t[u];t[u]=e.next?.bind(e),t[u+1]=e.error?.bind(e),t[u+2]=e.complete?.bind(e)}if(e instanceof cG)i=nT(e.firestore,cZ),s=ad(e._key.path),n={next:r=>{t[u]&&t[u](fV(i,e,r))},error:t[u+1],complete:t[u+2]};else{let r=nT(e,cK);i=nT(r.firestore,cZ),s=r._query;let a=new db(i);n={next:e=>{t[u]&&t[u](new fm(i,a,r,e))},error:t[u+1],complete:t[u+2]},dC(e._query)}return r=c0(i),o=new hP(s,a=new cE(n),h),r.asyncQueue.enqueueAndForget(async()=>hN(await cP(r),o)),()=>{a.Nu(),r.asyncQueue.enqueueAndForget(async()=>hM(await cP(r),o))}}function fL(e,t,...r){var n,i,s,a,o,l;let u=(0,r$.getModularInstance)(e),h=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}(t);if(h.error)throw new ne(r9.INVALID_ARGUMENT,h.error);let c,d=0;if("object"!=typeof r[0]||dI(r[d])||(c=r[d++]),"QuerySnapshot"===h.bundleSource){let e,t,a=null;if("object"==typeof r[d]&&dI(r[d])){let e=r[d++];a={next:e.next,error:e.error,complete:e.complete}}else a={next:r[d++],error:r[d++],complete:r[d++]};return n=c,i=a,s=r[d],t=!1,c1(u,h.bundle).then(()=>{var e,t,r;return e=u,t=h.bundleName,(r=c0(e=nT(e,cZ)),r.asyncQueue.enqueue(async()=>{var e;return e=await cR(r),e.persistence.runTransaction("Get named query","readonly",r=>e.Pi.getNamedQuery(r,t))})).then(t=>t?new cK(e,null,t.query):null)}).then(r=>{r&&!t&&(s&&r.withConverter(s),e=fO(r,n||{},i))}).catch(e=>(i.error&&i.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===h.bundleSource){let e,t,n=null;if("object"==typeof r[d]&&dI(r[d])){let e=r[d++];n={next:e.next,error:e.error,complete:e.complete}}else n={next:r[d++],error:r[d++],complete:r[d++]};return a=c,o=n,l=r[d],t=!1,c1(u,h.bundle).then(()=>{t||(e=fO(new cG(u,l||null,nb.fromPath(h.bundleName)),a||{},o))}).catch(e=>(o.error&&o.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new ne(r9.INVALID_ARGUMENT,`unsupported bundle source: ${h.bundleSource}`)}function fP(e,t){let r,n=c0(e=nT(e,cZ));return r=new cE(dI(t)?t:{next:t}),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await cP(n),void(e.Ca.add(r),r.next())}),()=>{r.Nu(),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await cP(n),void e.Ca.delete(r)})}}function fF(e,t){var r;let n;return r=c0(e),n=new nt,r.asyncQueue.enqueueAndForget(async()=>h0(await cO(r),t,n)),n.promise}function fV(e,t,r){let n=r.docs.get(t._key),i=new db(e);return new fd(e,i,t._key,n,new fc(r.hasPendingWrites,r.fromCache),t.converter)}function fB(e){return c0(e=nT(e,cZ)),new fw(e,t=>fF(e,t))}function fU(e,t){let r=c0(e=nT(e,cZ));if(!r._uninitializedComponentsProvider||"memory"===r._uninitializedComponentsProvider._offline.kind)return r6("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new ne(r9.INVALID_ARGUMENT,"Failed to parse JSON: "+e?.message)}}(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=fj(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=dp("setIndexConfiguration",fj(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new nO(e,2)):"ASCENDING"===t.order?n.push(new nO(e,0)):"DESCENDING"===t.order&&n.push(new nO(e,1))}r.push(new nD(nD.UNKNOWN_ID,t,n,nL.empty()))}return r}(t);return r.asyncQueue.enqueue(async()=>(async function(e,t){let r=e.indexManager,n=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>r.getFieldIndexes(e).next(i=>(function(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])})(i,t,nR,t=>{n.push(r.addFieldIndex(e,t))},t=>{n.push(r.deleteFieldIndex(e,t))})).next(()=>nz.waitFor(n)))})(await cR(r),n))}function fj(e,t){if("string"!=typeof e[t])throw new ne(r9.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class fq{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function fz(e){e=nT(e,cZ);let t=fH.get(e);if(t)return t;let r=c0(e);if("persistent"!==r._uninitializedComponentsProvider?._offline.kind)return null;let n=new fq(e);return fH.set(e,n),n}function fK(e){fQ(e,!0)}function fG(e){fQ(e,!1)}function f$(e){var t;(t=c0(e._firestore)).asyncQueue.enqueue(async()=>{var e;let r;return r=(e=await cR(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}).then(e=>r2("deleting all persistent cache indexes succeeded")).catch(e=>r6("deleting all persistent cache indexes failed",e))}function fQ(e,t){var r;(r=c0(e._firestore),r.asyncQueue.enqueue(async()=>{var e;return e=await cR(r),void(e.Cs.As=t)})).then(e=>r2(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>r6(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let fH=new WeakMap;class fW{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return fJ.instance.onExistenceFilterMismatch(e)}}class fJ{constructor(){this.i=new Map}static get instance(){return fY||function(e){if(oa)throw Error("a TestingHooksSpi instance is already set");oa=e}(fY=new fJ),fY}u(e){this.i.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.i;return r.set(t,e),()=>r.delete(t)}}let fY=null;!function(e=!0){rZ=rq.SDK_VERSION,(0,rq._registerComponent)(new rz.Component("firestore",(t,{instanceIdentifier:r,options:n})=>{let i=t.getProvider("app").getImmediate(),s=new cZ(new ns(t.getProvider("auth-internal")),new nu(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new ne(r9.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new sw(e.options.projectId,t)}(i,r),i);return n={useFetchStreams:e,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),(0,rq.registerVersion)(dx,dE,void 0),(0,rq.registerVersion)(dx,dE,"esm2020")}(),e.s(["AggregateField",()=>dT,"AggregateQuerySnapshot",()=>dS,"DocumentSnapshot",()=>fd,"PersistentCacheIndexManager",()=>fq,"QueryCompositeFilterConstraint",()=>dO,"QueryConstraint",()=>dD,"QueryDocumentSnapshot",()=>fg,"QueryEndAtConstraint",()=>dG,"QueryFieldFilterConstraint",()=>dM,"QueryLimitConstraint",()=>dB,"QueryOrderByConstraint",()=>dF,"QuerySnapshot",()=>fm,"QueryStartAtConstraint",()=>dq,"SnapshotMetadata",()=>fc,"Transaction",()=>fE,"WriteBatch",()=>fw,"_TestingHooks",()=>fW,"addDoc",()=>fR,"aggregateFieldEqual",()=>d6,"aggregateQuerySnapshotEqual",()=>d3,"and",()=>dP,"average",()=>d2,"count",()=>d5,"deleteAllPersistentCacheIndexes",()=>f$,"deleteDoc",()=>fM,"disablePersistentCacheIndexAutoCreation",()=>fG,"documentSnapshotFromJSON",()=>ff,"enablePersistentCacheIndexAutoCreation",()=>fK,"endAt",()=>dQ,"endBefore",()=>d$,"executeWrite",()=>fF,"getAggregateFromServer",()=>d4,"getCountFromServer",()=>d8,"getDoc",()=>fT,"getDocFromCache",()=>fS,"getDocFromServer",()=>f_,"getDocs",()=>fk,"getDocsFromCache",()=>fC,"getDocsFromServer",()=>fA,"getPersistentCacheIndexManager",()=>fz,"limit",()=>dU,"limitToLast",()=>dj,"memoryEagerGarbageCollector",()=>fr,"memoryLocalCache",()=>fi,"memoryLruGarbageCollector",()=>fn,"onSnapshot",()=>fO,"onSnapshotResume",()=>fL,"onSnapshotsInSync",()=>fP,"or",()=>dL,"orderBy",()=>dV,"persistentLocalCache",()=>fs,"persistentMultipleTabManager",()=>fu,"persistentSingleTabManager",()=>fl,"query",()=>dN,"querySnapshotFromJSON",()=>fp,"runTransaction",()=>fI,"setDoc",()=>fD,"setIndexConfiguration",()=>fU,"snapshotEqual",()=>fy,"startAfter",()=>dK,"startAt",()=>dz,"sum",()=>d1,"updateDoc",()=>fN,"where",()=>dR,"writeBatch",()=>fB],63802),e.i(63802);let fX=function(e,t){let r="object"==typeof e?e:(0,rq.getApp)(),n=(0,rq._getProvider)(r,"firestore").getImmediate({identifier:"string"==typeof e?e:sv});if(!n._initialized){let e=(0,r$.getDefaultEmulatorHostnameAndPort)("firestore");e&&function(e,t,r,n={}){e=nT(e,cz);let i=(0,r$.isCloudWorkstation)(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&((0,r$.pingServer)(`https://${o}`),(0,r$.updateEmulatorBanner)("Firestore",!0)),s.host!==cj&&s.host!==o&&r6("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!(0,r$.deepEqual)(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=rX.MOCK_USER;else{t=(0,r$.createMockUserToken)(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new ne(r9.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new rX(i)}e._authCredentials=new ni(new nr(t,r))}}(n,...e)}return n}((0,rj.getApps)().length?(0,rj.getApp)():(0,rj.initializeApp)({apiKey:"AIzaSyBcezJRuEx8vsThQKhi8Az_XdL_XSM6u8g",authDomain:"st-mary-somerset.firebaseapp.com",projectId:"st-mary-somerset",storageBucket:"st-mary-somerset.firebasestorage.app",messagingSenderId:"924281338278",appId:"1:924281338278:web:82023a592a670e7d97f767"})),fZ="artifacts/mood-board/floors",f0=async e=>{try{await fD(cQ(fX,fZ,"data"),{floors:e})}catch(e){console.error("Error saving floors:",e)}},f1=async()=>{try{let e=await fT(cQ(fX,fZ,"data"));if(e.exists())return e.data().floors}catch(e){console.error("Error loading floors:",e)}return null};function f2(){var e;let{floors:t,currentFloor:r,addItemToFloor:n,updateItem:i,loadFloors:s}=tk(),[a,o]=(0,F.useState)(null),[l,u]=(0,F.useState)(null),h=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,F.useMemo)(()=>[...t].filter(e=>null!=e),[...t])}((e={activationConstraint:{distance:8}},(0,F.useMemo)(()=>({sensor:eW,options:null!=e?e:{}}),[eW,e])));(0,F.useEffect)(()=>{f1().then(e=>{e&&s(e)})},[]);let c=function(e,t){let[r,n]=(0,F.useState)(e);return(0,F.useEffect)(()=>{let t=setTimeout(()=>{n(e)},2e3);return()=>{clearTimeout(t)}},[e,2e3]),r}(t,0);return(0,F.useEffect)(()=>{Object.keys(c).length>0&&f0(c)},[c]),(0,P.jsx)(th,{sensors:h,onDragStart:e=>{o(e.active.id),u(e.active.data.current)},onDragEnd:e=>{let{active:t,over:s}=e;if(o(null),u(null),!s)return;let a=document.getElementById("canvas-container");if(!a)return;let l=a.getBoundingClientRect(),h=t.rect.current.translated;if(!h)return;let c=h.left-l.left,d=h.top-l.top;t.data.current?.isNew?n(r,{type:t.data.current.type,src:t.data.current.src,x:c,y:d,width:100,height:100,rotation:0,label:t.data.current.label}):t.data.current?.isExisting&&i(r,t.id,{x:c,y:d})},children:(0,P.jsxs)("main",{className:"flex h-screen w-screen bg-midnight overflow-hidden",children:[(0,P.jsx)(rN,{}),(0,P.jsx)("div",{id:"canvas-container",className:"flex-1 h-full relative",children:(0,P.jsx)(rU,{})}),(0,P.jsx)(rL,{}),(0,P.jsx)(tI,{children:l?(0,P.jsx)("div",{className:l.isNew?"w-24 h-24 opacity-80":"opacity-80",style:l.isExisting?{width:l.width,height:l.height}:{},children:l.src?(0,P.jsx)("img",{src:l.src,className:"w-full h-full object-contain"}):(0,P.jsx)("div",{className:"w-full h-full border border-dashed border-bronze bg-surface/50"})}):null})]})})}e.s(["default",()=>f2],52683)}]);