/*! For license information please see main.nodejs.js.LICENSE.txt */
(()=>{var __webpack_modules__={18:(e,t,i)=>{"use strict";var n=i(484),r=i(9714),s=i(1755),o=i(6010),a=i(7434),c=i(483),l=i(2291);function p(e,t,i,n,r,s){const o="block-map"===i.type?a.resolveBlockMap(e,t,i,n,s):"block-seq"===i.type?c.resolveBlockSeq(e,t,i,n,s):l.resolveFlowCollection(e,t,i,n,s),p=o.constructor;return"!"===r||r===p.tagName?(o.tag=p.tagName,o):(r&&(o.tag=r),o)}t.composeCollection=function(e,t,i,a,c){const l=a.tag,d=l?t.directives.tagName(l.source,(e=>c(l,"TAG_RESOLVE_FAILED",e))):null;if("block-seq"===i.type){const{anchor:e,newlineAfterProp:t}=a,i=e&&l?e.offset>l.offset?e:l:e??l;if(i&&(!t||t.offset<i.offset)){c(i,"MISSING_CHAR","Missing newline after block sequence props")}}const u="block-map"===i.type?"map":"block-seq"===i.type?"seq":"{"===i.start.source?"map":"seq";if(!l||!d||"!"===d||d===s.YAMLMap.tagName&&"map"===u||d===o.YAMLSeq.tagName&&"seq"===u)return p(e,t,i,c,d);let m=t.schema.tags.find((e=>e.tag===d&&e.collection===u));if(!m){const n=t.schema.knownTags[d];if(!n||n.collection!==u)return n?.collection?c(l,"BAD_COLLECTION_TYPE",`${n.tag} used for ${u} collection, but expects ${n.collection}`,!0):c(l,"TAG_RESOLVE_FAILED",`Unresolved tag: ${d}`,!0),p(e,t,i,c,d);t.schema.tags.push(Object.assign({},n,{default:!1})),m=n}const f=p(e,t,i,c,d,m),h=m.resolve?.(f,(e=>c(l,"TAG_RESOLVE_FAILED",e)),t.options)??f,g=n.isNode(h)?h:new r.Scalar(h);return g.range=f.range,g.tag=d,m?.format&&(g.format=m.format),g}},65:function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.Script=void 0;const a=o(i(2743)),c=i(5387),l=i(7541),p=i(6593),d=i(8557),{deviceManager:u}=a.default;class m extends a.ScryptedDeviceBase{triggerDeviceDiscover;constructor(e,t){super(e),this.triggerDeviceDiscover=t}async saveScript(e){this.storage.setItem("data",JSON.stringify({"script.ts":e.script})),this.triggerDeviceDiscover?.(this.providedName,this.providedType,this.providedInterfaces)}async loadScripts(){try{return{"script.ts":{name:"Script",script:JSON.parse(this.storage.getItem("data"))["script.ts"],language:"typescript",monacoEvalDefaults:l.monacoEvalDefaults}}}catch(e){return{"script.ts":{name:"Script",script:"",language:"typescript",monacoEvalDefaults:l.monacoEvalDefaults}}}}async postRunScript(e){if(e){let t=e;t.toString().startsWith("class ")&&(t=new t(this.nativeId)),"function"==typeof t&&(t=await t()),this.handle(t)}const t=this.mergeHandler(this);2!==t.length&&await u.onDeviceDiscovered({providerNativeId:d.ScriptCoreNativeId,nativeId:this.nativeId,interfaces:t,type:a.ScryptedDeviceType.Unknown,name:this.providedName})}prepareScript(){Object.assign(this,(0,p.createScriptDevice)([a.ScryptedInterface.Scriptable,a.ScryptedInterface.Program]))}async runInternal(e,t){this.prepareScript();try{JSON.parse(this.storage.getItem("data"));const{value:i,defaultExport:n}=await(0,c.scryptedEval)(this,e,Object.assign({device:this},t));return await this.postRunScript(n),i}catch(e){throw this.console.error("error evaluating script",e),e}}async run(e){const t=JSON.parse(this.storage.getItem("data"));return this.runInternal(t["script.ts"],e)}async eval(e,t){return this.runInternal(e.script,t)}mergeHandler(e){throw new Error("Method not implemented.")}handle(e){throw new Error("Method not implemented.")}handleTypes(...e){throw new Error("Method not implemented.")}}t.Script=m},81:(e,t,i)=>{"use strict";var n=i(484),r=i(3793),s=i(248);function o({comment:e,items:t},i,{blockItemPrefix:o,flowChars:a,itemIndent:l,onChompKeep:p,onComment:d}){const{indent:u,options:{commentString:m}}=i,f=Object.assign({},i,{indent:l,type:null});let h=!1;const g=[];for(let e=0;e<t.length;++e){const a=t[e];let p=null;if(n.isNode(a))!h&&a.spaceBefore&&g.push(""),c(i,g,a.commentBefore,h),a.comment&&(p=a.comment);else if(n.isPair(a)){const e=n.isNode(a.key)?a.key:null;e&&(!h&&e.spaceBefore&&g.push(""),c(i,g,e.commentBefore,h))}h=!1;let d=r.stringify(a,f,(()=>p=null),(()=>h=!0));p&&(d+=s.lineComment(d,l,m(p))),h&&p&&(h=!1),g.push(o+d)}let v;if(0===g.length)v=a.start+a.end;else{v=g[0];for(let e=1;e<g.length;++e){const t=g[e];v+=t?`\n${u}${t}`:"\n"}}return e?(v+="\n"+s.indentComment(m(e),u),d&&d()):h&&p&&p(),v}function a({items:e},t,{flowChars:i,itemIndent:o}){const{indent:a,indentStep:l,flowCollectionPadding:p,options:{commentString:d}}=t;o+=l;const u=Object.assign({},t,{indent:o,inFlow:!0,type:null});let m=!1,f=0;const h=[];for(let i=0;i<e.length;++i){const a=e[i];let l=null;if(n.isNode(a))a.spaceBefore&&h.push(""),c(t,h,a.commentBefore,!1),a.comment&&(l=a.comment);else if(n.isPair(a)){const e=n.isNode(a.key)?a.key:null;e&&(e.spaceBefore&&h.push(""),c(t,h,e.commentBefore,!1),e.comment&&(m=!0));const i=n.isNode(a.value)?a.value:null;i?(i.comment&&(l=i.comment),i.commentBefore&&(m=!0)):null==a.value&&e?.comment&&(l=e.comment)}l&&(m=!0);let p=r.stringify(a,u,(()=>l=null));i<e.length-1&&(p+=","),l&&(p+=s.lineComment(p,o,d(l))),!m&&(h.length>f||p.includes("\n"))&&(m=!0),h.push(p),f=h.length}const{start:g,end:v}=i;if(0===h.length)return g+v;if(!m){const e=h.reduce(((e,t)=>e+t.length+2),2);m=t.options.lineWidth>0&&e>t.options.lineWidth}if(m){let e=g;for(const t of h)e+=t?`\n${l}${a}${t}`:"\n";return`${e}\n${a}${v}`}return`${g}${p}${h.join(" ")}${p}${v}`}function c({indent:e,options:{commentString:t}},i,n,r){if(n&&r&&(n=n.replace(/^\n+/,"")),n){const r=s.indentComment(t(n),e);i.push(r.trimStart())}}t.stringifyCollection=function(e,t,i){return(t.inFlow??e.flow?a:o)(e,t,i)}},166:function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsMixinDeviceBase=void 0;const a=o(i(2743)),{deviceManager:c}=a.default;class l extends a.MixinDeviceBase{constructor(e){super(e),this.settingsGroup=e.group,this.settingsGroupKey=e.groupKey,process.nextTick((()=>c.onMixinEvent(this.id,this,a.ScryptedInterface.Settings,null)))}async getSettings(){const e=this.mixinDeviceInterfaces.includes(a.ScryptedInterface.Settings)?this.mixinDevice.getSettings():void 0,t=this.getMixinSettings(),i=[];try{const t=await e||[];i.push(...t)}catch(e){const t=this.name,n=`${t} Extension settings failed to load.`;this.console.error(n,e),i.push({key:Math.random().toString(),title:t,value:"Settings Error",group:"Errors",description:n,readonly:!0})}try{const e=await t||[];for(const t of e)t.group=t.group||this.settingsGroup,t.key=this.settingsGroupKey+":"+t.key;i.push(...e)}catch(e){const t=c.getDeviceState(this.mixinProviderNativeId).name,n=`${t} Extension settings failed to load.`;this.console.error(n,e),i.push({key:Math.random().toString(),title:t,value:"Settings Error",group:"Errors",description:n,readonly:!0})}return i}async putSetting(e,t){const i=this.settingsGroupKey+":";if(!e?.startsWith(i))return this.mixinDevice.putSetting(e,t);await this.putMixinSetting(e.substring(i.length),t)||c.onMixinEvent(this.id,this,a.ScryptedInterface.Settings,null)}async release(){await c.onMixinEvent(this.id,this,a.ScryptedInterface.Settings,null)}}t.SettingsMixinDeviceBase=l},185:(e,t,i)=>{"use strict";var n=i(8858)("router:route"),r=i(804).B,s=i(2961),o=i(4761),a=Array.prototype.slice,c="function"==typeof setImmediate?setImmediate:function(e){process.nextTick(e.bind.apply(e,arguments))};function l(e){n("new %o",e),this.path=e,this.stack=[],this.methods=Object.create(null)}e.exports=l,l.prototype._handles_method=function(e){if(this.methods._all)return!0;var t="string"==typeof e?e.toLowerCase():e;return"head"!==t||this.methods.head||(t="get"),Boolean(this.methods[t])},l.prototype._methods=function(){var e=Object.keys(this.methods);this.methods.get&&!this.methods.head&&e.push("head");for(var t=0;t<e.length;t++)e[t]=e[t].toUpperCase();return e},l.prototype.dispatch=function(e,t,i){var n=0,r=this.stack,s=0;if(0===r.length)return i();var o="string"==typeof e.method?e.method.toLowerCase():e.method;"head"!==o||this.methods.head||(o="get"),e.route=this,function a(l){if(l&&"route"===l)return i();if(l&&"router"===l)return i(l);if(n>=r.length)return i(l);if(++s>100)return c(a,l);var p,d;for(;!0!==d&&n<r.length;)d=!(p=r[n++]).method||p.method===o;if(!0!==d)return i(l);l?p.handle_error(l,e,t,a):p.handle_request(e,t,a);s=0}()},l.prototype.all=function(e){var t=r(a.call(arguments));if(0===t.length)throw new TypeError("argument handler is required");for(var i=0;i<t.length;i++){var n=t[i];if("function"!=typeof n)throw new TypeError("argument handler must be a function");var o=s("/",{},n);o.method=void 0,this.methods._all=!0,this.stack.push(o)}return this},o.forEach((function(e){l.prototype[e]=function(t){var i=r(a.call(arguments));if(0===i.length)throw new TypeError("argument handler is required");for(var o=0;o<i.length;o++){var c=i[o];if("function"!=typeof c)throw new TypeError("argument handler must be a function");n("%s %s",e,this.path);var l=s("/",{},c);l.method=e,this.methods[e]=!0,this.stack.push(l)}return this}}))},239:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addAccessControlsForInterface=function(e,...t){const i=t.map((e=>n.ScryptedInterfaceDescriptors[e]?.methods||[])).flat(),r=t.map((e=>n.ScryptedInterfaceDescriptors[e]?.properties||[])).flat();return{id:e,methods:i,properties:r,interfaces:t}},t.mergeDeviceAccessControls=function(e,t){return e&&null!==e.devicesAccessControls?(e.devicesAccessControls||(e.devicesAccessControls=[]),e.devicesAccessControls.push(...t),e):e};const n=i(2743)},248:(e,t)=>{"use strict";function i(e,t){return/^\n+$/.test(e)?e.substring(1):t?e.replace(/^(?! *$)/gm,t):e}t.indentComment=i,t.lineComment=(e,t,n)=>e.endsWith("\n")?i(n,t):n.includes("\n")?"\n"+i(n,t):(e.endsWith(" ")?"":" ")+n,t.stringifyComment=e=>e.replace(/^(?!$)(?: $)?/gm,"#")},394:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=394,e.exports=t},431:function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.fork=async function(){return{tsCompile:c.tsCompile,newScript:O.newScript,newTerminalService:D.newTerminalService,checkLxcVersionUpdateNeeded:w.checkLxcVersionUpdateNeeded,checkLxc:async()=>{try{await(0,w.checkLxc)()}finally{await(0,l.sleep)(1e3),process.exit(0)}}}};const c=i(6593),l=i(7724),p=o(i(2743)),d=i(1414),u=i(9896),m=a(i(6928)),f=a(i(8428)),h=a(i(1198)),g=i(1456),v=i(8803),y=i(3074),S=i(926),b=i(4566),x=i(7362),w=i(6967),k=i(925),O=i(8557),D=i(8144),C=i(5957),{deviceManager:T,endpointManager:_}=p.default;class I extends p.ScryptedDeviceBase{router=(0,f.default)();publicRouter=(0,f.default)();mediaCore;scriptCore;clusterCore;aggregateCore;automationCore;users;consoleService;replService;terminalService;localAddresses;storageSettings=new d.StorageSettings(this,{localAddresses:{title:"Scrypted Server Addresses",description:"The IP addresses used by the Scrypted server. Set this to the wired IP address to prevent usage of a wireless address.",combobox:!0,multiple:!0,onGet:async()=>({choices:(0,g.getUsableNetworkAddresses)()}),mapGet:()=>this.localAddresses,onPut:async(e,t)=>{this.localAddresses=t?.length?t:void 0;(await p.default.systemManager.getComponent("addresses")).setLocalAddresses(this.localAddresses)}},releaseChannel:{group:"Advanced",title:"Server Release Channel",description:"The release channel to use for server updates. A specific version or tag can be manually entered as well. Changing this setting will update the image field in /root/.scrypted/docker-compose.yml. Invalid values may prevent the server from properly starting.",defaultValue:"Default",choices:["Default","latest","beta","intel","amd","nvidia",`v${p.default.serverVersion}-noble-full`],combobox:!0,onPut:(e,t)=>{this.updateReleaseChannel(t)},mapGet:()=>{try{const e=h.default.parseDocument((0,c.readFileAsString)("/root/.scrypted/docker-compose.yml")).contents.get("services").get("scrypted").get("image");return e.split(":")[1]||void 0||"Default"}catch(e){return"Default"}}},pullImage:{hide:!0,onPut:()=>{this.setPullImage()}}});indexHtml;constructor(){super(),this.systemDevice={settings:"General"},(0,w.checkLegacyLxc)(),(0,w.checkLxc)(),this.storageSettings.settings.releaseChannel.hide="lxc-docker"!==process.env.SCRYPTED_INSTALL_ENVIRONMENT,this.indexHtml=(0,c.readFileAsString)("dist/index.html"),(async()=>{await T.onDeviceDiscovered({name:"Cluster Manager",nativeId:S.ClusterCoreNativeId,interfaces:[p.ScryptedInterface.Settings,p.ScryptedInterface.Readme,p.ScryptedInterface.ScryptedSettings],type:p.ScryptedDeviceType.Builtin})})(),(async()=>{await T.onDeviceDiscovered({name:"Media Core",nativeId:"mediacore",interfaces:[p.ScryptedInterface.DeviceProvider,p.ScryptedInterface.BufferConverter,p.ScryptedInterface.HttpRequestHandler],type:p.ScryptedDeviceType.Internal})})(),(async()=>{await T.onDeviceDiscovered({name:"Scripts",nativeId:O.ScriptCoreNativeId,interfaces:[p.ScryptedInterface.ScryptedSystemDevice,p.ScryptedInterface.ScryptedDeviceCreator,p.ScryptedInterface.DeviceProvider,p.ScryptedInterface.DeviceCreator,p.ScryptedInterface.Readme],type:p.ScryptedDeviceType.Internal})})(),(async()=>{await T.onDeviceDiscovered({name:"Terminal Service",nativeId:D.TerminalServiceNativeId,interfaces:[p.ScryptedInterface.StreamService,p.ScryptedInterface.TTY,p.ScryptedInterface.ClusterForkInterface],type:p.ScryptedDeviceType.Internal})})(),(async()=>{await T.onDeviceDiscovered({name:"REPL Service",nativeId:k.ReplServiceNativeId,interfaces:[p.ScryptedInterface.StreamService],type:p.ScryptedDeviceType.Internal})})(),(async()=>{await T.onDeviceDiscovered({name:"Console Service",nativeId:k.ConsoleServiceNativeId,interfaces:[p.ScryptedInterface.StreamService],type:p.ScryptedDeviceType.Internal})})(),(async()=>{await T.onDeviceDiscovered({name:"Automations",nativeId:y.AutomationCoreNativeId,interfaces:[p.ScryptedInterface.ScryptedSystemDevice,p.ScryptedInterface.ScryptedDeviceCreator,p.ScryptedInterface.DeviceProvider,p.ScryptedInterface.DeviceCreator,p.ScryptedInterface.Readme],type:p.ScryptedDeviceType.Internal})})(),T.onDeviceDiscovered({name:"Add to Launcher",nativeId:"launcher",interfaces:["@scrypted/launcher-ignore",p.ScryptedInterface.MixinProvider,p.ScryptedInterface.Readme],type:p.ScryptedDeviceType.Internal}),(async()=>{await T.onDeviceDiscovered({name:"Device Groups",nativeId:v.AggregateCoreNativeId,interfaces:[p.ScryptedInterface.ScryptedSystemDevice,p.ScryptedInterface.ScryptedDeviceCreator,p.ScryptedInterface.DeviceProvider,p.ScryptedInterface.DeviceCreator,p.ScryptedInterface.Readme],type:p.ScryptedDeviceType.Builtin})})(),(async()=>{await T.onDeviceDiscovered({name:"Scrypted Users",nativeId:C.UsersNativeId,interfaces:[p.ScryptedInterface.ScryptedSystemDevice,p.ScryptedInterface.ScryptedDeviceCreator,p.ScryptedInterface.DeviceProvider,p.ScryptedInterface.DeviceCreator,p.ScryptedInterface.Readme],type:p.ScryptedDeviceType.Internal})})(),this.updateWorkers(),setInterval((()=>this.updateWorkers()),36e5),setInterval((()=>this.updateWorkerImages()),36e5)}async updateWorkers(){const e=await(p.default.clusterManager?.getClusterWorkers());if(e)for(const[t,i]of Object.entries(e)){const e=p.default.fork({clusterWorkerId:t,runtime:"node"});(async()=>{try{(await e.result).checkLxc()}catch(t){e.worker.terminate()}})()}}async updateWorkerImages(){const e=await(p.default.clusterManager?.getClusterWorkers());if(e)for(const[t,i]of Object.entries(e)){const e=p.default.fork({clusterWorkerId:t,runtime:"node"});(async()=>{try{const t=await e.result;if(!await t.checkLxcVersionUpdateNeeded())return;const n=await p.default.systemManager.getComponent("cluster-fork"),r=await n.getServiceControl(i.id);await r.restart().catch((()=>{}))}catch(e){}finally{await(0,l.sleep)(1e3),e.worker.terminate()}})()}}async getSettings(){try{const e=await p.default.systemManager.getComponent("addresses");this.localAddresses=await e.getLocalAddresses(!0)}catch(e){}return this.storageSettings.getSettings()}async putSetting(e,t){await this.storageSettings.putSetting(e,t)}async getDevice(e){return e===S.ClusterCoreNativeId?this.clusterCore||=new S.ClusterCore(S.ClusterCoreNativeId):"launcher"===e?new b.LauncherMixin("launcher"):"mediacore"===e?this.mediaCore||=new x.MediaCore:e===O.ScriptCoreNativeId?this.scriptCore||=new O.ScriptCore:e===y.AutomationCoreNativeId?this.automationCore||=new y.AutomationCore:e===v.AggregateCoreNativeId?this.aggregateCore||=new v.AggregateCore:e===C.UsersNativeId?this.users||=new C.UsersCore:e===D.TerminalServiceNativeId?this.terminalService||=new D.TerminalService(D.TerminalServiceNativeId,!1):e===k.ReplServiceNativeId?this.replService||=new k.PluginSocketService(k.ReplServiceNativeId,"repl"):e===k.ConsoleServiceNativeId?this.consoleService||=new k.PluginSocketService(k.ConsoleServiceNativeId,"console"):void 0}async releaseDevice(e,t){}async handlePublicFinal(e,t){const i=e.url.split("?")[0];if("/index.html"===e.url)try{const e=await _.getPublicCloudEndpoint(),i=new URL(e),n=this.indexHtml.replace('href="manifest.json"',`href="manifest.json${i.search}"`).replace('href="img/icons/apple-touch-icon-152x152.png"',`href="img/icons/apple-touch-icon-152x152.png${i.search}"`).replace('href="img/icons/safari-pinned-tab.svg"',`href="img/icons/safari-pinned-tab.svg${i.search}"`);t.send(n,{headers:{"Content-Type":"text/html"}})}catch(e){t.sendFile("dist"+i)}else t.sendFile("dist"+i)}async onRequest(e,t){const i=Object.assign({params:{}},e);i.url=i.url.replace(i.rootPath,""),"/"!=i.url&&"/?"!=i.url||(i.url="/index.html"),e.isPublicEndpoint?(await new Promise((e=>this.publicRouter(i,t,e))),await this.handlePublicFinal(i,t)):(await new Promise((e=>this.router(i,t,e))),t.send("Not Found",{code:404}))}setPullImage(){(0,u.writeFileSync)(m.default.join(process.env.SCRYPTED_VOLUME,".pull"),"")}async updateReleaseChannel(e){e=e&&"Default"!==e?`:${e}`:"";const t=h.default.parseDocument((0,c.readFileAsString)("/root/.scrypted/docker-compose.yml"));t.contents.get("services").get("scrypted").set("image",`ghcr.io/koush/scrypted${e}`),(0,u.writeFileSync)("/root/.scrypted/docker-compose.yml",h.default.stringify(t)),this.setPullImage();const i=await p.default.systemManager.getComponent("service-control");await i.exit().catch((()=>{})),await i.restart()}}t.default=I},483:(e,t,i)=>{"use strict";var n=i(6010),r=i(1386),s=i(8644);t.resolveBlockSeq=function({composeNode:e,composeEmptyNode:t},i,o,a,c){const l=new(c?.nodeClass??n.YAMLSeq)(i.schema);i.atRoot&&(i.atRoot=!1);let p=o.offset,d=null;for(const{start:n,value:c}of o.items){const u=r.resolveProps(n,{indicator:"seq-item-ind",next:c,offset:p,onError:a,parentIndent:o.indent,startOnNewline:!0});if(!u.found){if(!(u.anchor||u.tag||c)){d=u.end,u.comment&&(l.comment=u.comment);continue}c&&"block-seq"===c.type?a(u.end,"BAD_INDENT","All sequence items must start at the same column"):a(p,"MISSING_CHAR","Sequence item without - indicator")}const m=c?e(i,c,u,a):t(i,u.end,n,null,u,a);i.schema.compat&&s.flowIndentCheck(o.indent,c,a),p=m.range[2],l.items.push(m)}return l.range=[o.offset,p,d??p],l}},484:(e,t)=>{"use strict";const i=Symbol.for("yaml.alias"),n=Symbol.for("yaml.document"),r=Symbol.for("yaml.map"),s=Symbol.for("yaml.pair"),o=Symbol.for("yaml.scalar"),a=Symbol.for("yaml.seq"),c=Symbol.for("yaml.node.type"),l=e=>!!e&&"object"==typeof e&&e[c]===o;function p(e){if(e&&"object"==typeof e)switch(e[c]){case r:case a:return!0}return!1}t.ALIAS=i,t.DOC=n,t.MAP=r,t.NODE_TYPE=c,t.PAIR=s,t.SCALAR=o,t.SEQ=a,t.hasAnchor=e=>(l(e)||p(e))&&!!e.anchor,t.isAlias=e=>!!e&&"object"==typeof e&&e[c]===i,t.isCollection=p,t.isDocument=e=>!!e&&"object"==typeof e&&e[c]===n,t.isMap=e=>!!e&&"object"==typeof e&&e[c]===r,t.isNode=function(e){if(e&&"object"==typeof e)switch(e[c]){case i:case r:case o:case a:return!0}return!1},t.isPair=e=>!!e&&"object"==typeof e&&e[c]===s,t.isScalar=l,t.isSeq=e=>!!e&&"object"==typeof e&&e[c]===a},541:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});const n='import type { ScriptDevice } from "@scrypted/common/src/eval/monaco/script-device";\nimport type { ScryptedDeviceBase } from "@scrypted/sdk";\n\ndeclare const device: ScryptedDeviceBase & ScriptDevice;\n'},625:(e,t,i)=>{"use strict";var n=i(484),r=i(3334),s=i(1919),o=i(8531),a=i(975);const c=(e,t)=>e.key<t.key?-1:e.key>t.key?1:0;class l{constructor({compat:e,customTags:t,merge:i,resolveKnownTags:l,schema:p,sortMapEntries:d,toStringDefaults:u}){this.compat=Array.isArray(e)?a.getTags(e,"compat"):e?a.getTags(null,e):null,this.merge=!!i,this.name="string"==typeof p&&p||"core",this.knownTags=l?a.coreKnownTags:{},this.tags=a.getTags(t,this.name),this.toStringOptions=u??null,Object.defineProperty(this,n.MAP,{value:r.map}),Object.defineProperty(this,n.SCALAR,{value:o.string}),Object.defineProperty(this,n.SEQ,{value:s.seq}),this.sortMapEntries="function"==typeof d?d:!0===d?c:null}clone(){const e=Object.create(l.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}}t.Schema=l},692:(e,t,i)=>{"use strict";var n=i(484),r=i(3732),s=i(1755),o=i(6010),a=i(8416);class c extends o.YAMLSeq{constructor(){super(),this.add=s.YAMLMap.prototype.add.bind(this),this.delete=s.YAMLMap.prototype.delete.bind(this),this.get=s.YAMLMap.prototype.get.bind(this),this.has=s.YAMLMap.prototype.has.bind(this),this.set=s.YAMLMap.prototype.set.bind(this),this.tag=c.tag}toJSON(e,t){if(!t)return super.toJSON(e);const i=new Map;t?.onCreate&&t.onCreate(i);for(const e of this.items){let s,o;if(n.isPair(e)?(s=r.toJS(e.key,"",t),o=r.toJS(e.value,s,t)):s=r.toJS(e,"",t),i.has(s))throw new Error("Ordered maps must not include duplicate keys");i.set(s,o)}return i}static from(e,t,i){const n=a.createPairs(e,t,i),r=new this;return r.items=n.items,r}}c.tag="tag:yaml.org,2002:omap";const l={collection:"seq",identify:e=>e instanceof Map,nodeClass:c,default:!1,tag:"tag:yaml.org,2002:omap",resolve(e,t){const i=a.resolvePairs(e,t),r=[];for(const{key:e}of i.items)n.isScalar(e)&&(r.includes(e.value)?t(`Ordered maps must not include duplicate keys: ${e.value}`):r.push(e.value));return Object.assign(new c,i)},createNode:(e,t,i)=>c.from(e,t,i)};t.YAMLOMap=c,t.omap=l},774:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updatePluginsData=void 0,t.updatePluginsData={triggers:[{condition:null,id:"scheduler",model:{hour:"03",minute:"15",rpc:{method:"schedule",parameters:[{hour:3,minute:15,clockType:"AM",sunday:!0,monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!0}]},clockType:"AM",sunday:!0,monday:!0,tuesday:!0,saturday:!0,wednesday:!0,thursday:!0,friday:!0}}],actions:[{id:"update-plugins",model:{}}],staticEvents:!1,denoiseEvents:!1,runToCompletion:!1,automationType:"Automation"}},804:(e,t,i)=>{"use strict";function n(e){var t=[];return r(e,t),t}function r(e,t){for(var i=0;i<e.length;i++){var n=e[i];Array.isArray(n)?r(n,t):t.push(n)}}i.d(t,{B:()=>n})},857:e=>{"use strict";e.exports=require("os")},875:function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FileHost=t.RequestMediaObjectHost=t.BufferHost=void 0;const c=o(i(2743)),l=a(i(6982)),p=a(i(6928)),{endpointManager:d}=c.default;function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}class m extends c.ScryptedDeviceBase{secure;hosted=new Map;constructor(e){super(e?"https":"http"),this.secure=e,this.fromMimeType="*/*",this.secure=e,this.toMimeType=e?c.ScryptedMimeTypes.LocalUrl:c.ScryptedMimeTypes.InsecureLocalUrl}async onRequest(e,t){const i=Object.assign({},e);i.url=i.url.replace(i.rootPath,"");const n=i.url.split("?")[0],r=this.hosted.get(n);if(!r)return void t.send("Not Found",{code:404});let s={headers:{"Content-Type":r.fromMimeType}};new URLSearchParams(e.url.split("?")[1]).has("attachment")&&(s.headers["Content-Disposition"]="attachment"),t.send(r.data)}async convert(e,t,n){const r=u(),{default:s}=await Promise.resolve().then(i.bind(i,3238)),o=await(this.secure?d.getPublicLocalEndpoint(this.nativeId):d.getInsecurePublicLocalEndpoint(this.nativeId)),a=s.getExtension(t),c=r+(a?`.${a}`:"");return this.hosted.set(`/${c}`,{data:e,fromMimeType:t,toMimeType:n}),setTimeout((()=>this.hosted.delete(`/${c}`)),6e5),Buffer.from(`${o}${c}`)}}t.BufferHost=m;class f extends c.ScryptedDeviceBase{secureHosted=new Map;insecureHosted=new Map;constructor(){super("rmo-host"),this.fromMimeType=c.ScryptedMimeTypes.RequestMediaObject,this.toMimeType=c.ScryptedMimeTypes.MediaObject}async onRequest(e,t){const i=Object.assign({},e);i.url=i.url.replace(i.rootPath,"");const n=i.url.split("?")[0],r=this.secureHosted.get(n)||this.insecureHosted.get(n);if(!r)return void t.send("Not Found",{code:404});let s={headers:{"Content-Type":r.fromMimeType}};new URLSearchParams(e.url.split("?")[1]).has("attachment")&&(s.headers["Content-Disposition"]="attachment");try{const e=await r.request(),i=await c.default.mediaManager.convertMediaObjectToBuffer(e,e.mimeType);t.send(i)}catch(e){throw this.secureHosted.delete(n),this.insecureHosted.delete(n),e}}async convert(e,t,n){let r;if(n===c.ScryptedMimeTypes.Url||n===c.ScryptedMimeTypes.LocalUrl)r=this.secureHosted,n=c.ScryptedMimeTypes.LocalUrl;else{if(n!==c.ScryptedMimeTypes.InsecureLocalUrl)return e();r=this.insecureHosted}const s=u(),o=await(n===c.ScryptedMimeTypes.LocalUrl?d.getPublicLocalEndpoint(this.nativeId):d.getInsecurePublicLocalEndpoint(this.nativeId));t=(await e()).mimeType;const{default:a}=await Promise.resolve().then(i.bind(i,3238)),l=a.getExtension(t),p=s+(l?`.${l}`:""),m=`/${p}`;r.set(m,{request:e,fromMimeType:t,toMimeType:n}),setTimeout((()=>r.delete(m)),36e5);const f=Buffer.from(`${o}${p}`);return c.default.mediaManager.createMediaObject(f,n)}}t.RequestMediaObjectHost=f;class h extends c.ScryptedDeviceBase{secure;hosted=new Map;constructor(e){super(e?"files":"file"),this.secure=e,this.fromMimeType=c.ScryptedMimeTypes.SchemePrefix+"file",this.secure=e,this.toMimeType=e?c.ScryptedMimeTypes.LocalUrl:c.ScryptedMimeTypes.InsecureLocalUrl}async onRequest(e,t){const i=Object.assign({},e);i.url=i.url.replace(i.rootPath,"");const n=i.url.split("?")[0],r=this.hosted.get(n);let s;new URLSearchParams(e.url.split("?")[1]).has("attachment")&&(s={headers:{"Content-Disposition":"attachment"}}),t.sendFile(r.data,s)}async convert(e,t,i){const{pathname:n}=new URL(e),r=l.default.createHash("sha256").update(n).digest("hex"),s=await(this.secure?d.getPublicLocalEndpoint(this.nativeId):d.getInsecurePublicLocalEndpoint(this.nativeId)),o=p.default.extname(n).substring(1),a=r+(o?`.${o}`:"");return this.hosted.set(`/${a}`,{data:n}),Buffer.from(`${s}${a}`)}}t.FileHost=h},925:function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PluginSocketService=t.ConsoleServiceNativeId=t.ReplServiceNativeId=void 0;const c=i(5597),l=o(i(2743)),p=i(4434),d=a(i(9278));t.ReplServiceNativeId="replservice",t.ConsoleServiceNativeId="consoleservice";class u extends l.ScryptedDeviceBase{serviceName;constructor(e,t){super(e),this.serviceName=t}async connectStream(e,t){const i=t?.pluginId;if(!i)throw new Error("must provide pluginId");const n=await l.default.systemManager.getComponent("plugins"),r=await n.getRemoteServicePort(i,this.serviceName),[s,o]=Array.isArray(r)?r:[r,void 0],a=d.default.connect({port:s,host:o});await(0,p.once)(a,"connect");const u=(0,c.createAsyncQueue)();a.on("close",(()=>u.end())),a.on("end",(()=>u.end()));let m=0;return a.on("data",(async e=>{const t=Buffer.from(e);m+=t.length;const i=u.enqueue(t).then((()=>m-=t.length));m>=64e3&&(a.pause(),await i,m<64e3&&a.resume())})),(async()=>{try{for await(const t of e)if(t){if(!Buffer.isBuffer(t))throw new Error("unexpected control message");a.write(t)}}catch(e){this.console.log(e)}a.destroy()})(),async function*(){try{for(;;){const e=u.clear();e.length?yield Buffer.concat(e):yield await u.dequeue()}}catch(e){}finally{a.destroy()}}()}}t.PluginSocketService=u},926:function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ClusterCore=t.ClusterCoreNativeId=void 0;const a=i(5597),c=o(i(2743));t.ClusterCoreNativeId="clustercore";class l extends c.ScryptedDeviceBase{writeQueue=(0,a.createAsyncQueue)();constructor(e){super(e),(async()=>{for await(const e of this.writeQueue.queue)try{await e()}catch(e){this.console.error("error writing settings",e)}finally{this.onDeviceEvent(c.ScryptedInterface.Settings,void 0)}})()}async getSettings(){const e=c.default.clusterManager?.getClusterMode?.();if(!e)return[];const t=await c.default.clusterManager.getClusterWorkers(),i=[],n=Object.values(t),r=await c.default.systemManager.getComponent("cluster-fork");for(const e of n){const t=`Worker: ${e.name}`,n={key:`${e.id}:name`,group:t,title:"Name",description:"The friendly name of the worker.",value:e.name};i.push(n);const s={key:`${e.id}:mode`,group:t,title:"Mode",description:"The mode of the worker.",value:e.mode,readonly:!0};i.push(s);const o=await r.getEnvControl(e.id),a=await o.getDotEnv().catch((()=>{})),c=(a?.split("\n")||e.labels).map((e=>{const t=e.trim();if(t.startsWith("#"))return{line:e};const[i,...n]=t.split("=");return{key:i,value:n.join("="),line:e}})),l=c.find((e=>"SCRYPTED_CLUSTER_LABELS"===e.key))?.value?.split(",")||[],p=new Set([...l,"storage","compute","compute.preferred","@scrypted/coreml","@scrypted/openvino","@scrypted/onnx","@scrypted/tensorflow-lite"]),d={key:`${e.id}:labels`,group:t,title:"Labels",description:"The labels to apply to this worker. Modifying the labels will restart the worker. Some labels, such as the host OS and architecture, cannot be changed.",multiple:!0,combobox:!0,choices:[...p],value:l};i.push(d)}return i}async putSetting(e,t){await this.writeQueue.enqueue((async()=>{const i=e.split(":"),[n,r]=i,s=(await c.default.clusterManager.getClusterWorkers())[n];if(!s)return;switch(r){case"name":case"labels":break;default:return}const o=await c.default.systemManager.getComponent("cluster-fork"),a=await o.getEnvControl(s.id),l=await a.getDotEnv().catch((()=>{})),p=(l?.split("\n")||s.labels).map((e=>{const t=e.trim();if(t.startsWith("#"))return{line:e};const[i,...n]=t.split("=");return{key:i,value:n.join("="),line:e}})),d=async(e,t)=>{let i=p.find((t=>t.key===e));i||(i={key:e,value:"",line:""},p.push(i)),i.line=`${e}=${t}`,await a.setDotEnv(p.filter((e=>e)).map((e=>e.line)).join("\n"))};"labels"===r?await d("SCRYPTED_CLUSTER_LABELS",t.join(",")):"name"===r&&await d("SCRYPTED_CLUSTER_WORKER_NAME",t),setTimeout((async()=>{const e=await o.getServiceControl(s.id);await e.restart().catch((()=>{}))}),1e4)}))}async getReadmeMarkdown(){return"Manage Scrypted's cluster mode. Run storage devices and compute services on separate servers.\n        \n[Read Documentation](https://docs.scrypted.app/maintenance/cluster.html)."}}t.ClusterCore=l},975:(e,t,i)=>{"use strict";var n=i(3334),r=i(6055),s=i(1919),o=i(8531),a=i(5132),c=i(988),l=i(2891),p=i(8523),d=i(4988),u=i(8080),m=i(692),f=i(8416),h=i(5822),g=i(2557),v=i(5437);const y=new Map([["core",p.schema],["failsafe",[n.map,s.seq,o.string]],["json",d.schema],["yaml11",h.schema],["yaml-1.1",h.schema]]),S={binary:u.binary,bool:a.boolTag,float:c.float,floatExp:c.floatExp,floatNaN:c.floatNaN,floatTime:v.floatTime,int:l.int,intHex:l.intHex,intOct:l.intOct,intTime:v.intTime,map:n.map,null:r.nullTag,omap:m.omap,pairs:f.pairs,seq:s.seq,set:g.set,timestamp:v.timestamp},b={"tag:yaml.org,2002:binary":u.binary,"tag:yaml.org,2002:omap":m.omap,"tag:yaml.org,2002:pairs":f.pairs,"tag:yaml.org,2002:set":g.set,"tag:yaml.org,2002:timestamp":v.timestamp};t.coreKnownTags=b,t.getTags=function(e,t){let i=y.get(t);if(!i){if(!Array.isArray(e)){const e=Array.from(y.keys()).filter((e=>"yaml11"!==e)).map((e=>JSON.stringify(e))).join(", ");throw new Error(`Unknown schema "${t}"; use one of ${e} or define customTags array`)}i=[]}if(Array.isArray(e))for(const t of e)i=i.concat(t);else"function"==typeof e&&(i=e(i.slice()));return i.map((e=>{if("string"!=typeof e)return e;const t=S[e];if(t)return t;const i=Object.keys(S).map((e=>JSON.stringify(e))).join(", ");throw new Error(`Unknown custom tag "${e}"; use one of ${i}`)}))}},988:(e,t,i)=>{"use strict";var n=i(9714),r=i(3144);const s={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:e=>"nan"===e.slice(-3).toLowerCase()?NaN:"-"===e[0]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:r.stringifyNumber},o={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e),stringify(e){const t=Number(e.value);return isFinite(t)?t.toExponential():r.stringifyNumber(e)}},a={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(e){const t=new n.Scalar(parseFloat(e)),i=e.indexOf(".");return-1!==i&&"0"===e[e.length-1]&&(t.minFractionDigits=e.length-i-1),t},stringify:r.stringifyNumber};t.float=a,t.floatExp=o,t.floatNaN=s},1040:(e,t)=>{"use strict";t.emptyScalarPosition=function(e,t,i){if(t){null===i&&(i=t.length);for(let n=i-1;n>=0;--n){let i=t[n];switch(i.type){case"space":case"comment":case"newline":e-=i.source.length;continue}for(i=t[++n];"space"===i?.type;)e+=i.source.length,i=t[++n];break}}return e}},1114:(e,t,i)=>{function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=i(1917)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var i=this.useColors;if(e[0]=(i?"%c":"")+this.namespace+(i?" %c":" ")+e[0]+(i?"%c ":" ")+"+"+t.humanize(this.diff),!i)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var r=0,s=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(s=r))})),e.splice(s,0,n)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())},1198:(e,t,i)=>{"use strict";var n=i(4927),r=i(9046),s=i(625),o=i(4355),a=i(1736),c=i(484),l=i(7902),p=i(9714),d=i(1755),u=i(6010),m=i(9112),f=i(5752),h=i(2864),g=i(6247),v=i(1332),y=i(9125);t.Composer=n.Composer,t.Document=r.Document,t.Schema=s.Schema,t.YAMLError=o.YAMLError,t.YAMLParseError=o.YAMLParseError,t.YAMLWarning=o.YAMLWarning,t.Alias=a.Alias,t.isAlias=c.isAlias,t.isCollection=c.isCollection,t.isDocument=c.isDocument,t.isMap=c.isMap,t.isNode=c.isNode,t.isPair=c.isPair,t.isScalar=c.isScalar,t.isSeq=c.isSeq,t.Pair=l.Pair,t.Scalar=p.Scalar,t.YAMLMap=d.YAMLMap,t.YAMLSeq=u.YAMLSeq,t.CST=m,t.Lexer=f.Lexer,t.LineCounter=h.LineCounter,t.Parser=g.Parser,t.parse=v.parse,t.parseAllDocuments=v.parseAllDocuments,t.parseDocument=v.parseDocument,t.stringify=v.stringify,t.visit=y.visit,t.visitAsync=y.visitAsync},1332:(e,t,i)=>{"use strict";var n=i(4927),r=i(9046),s=i(4355),o=i(7444),a=i(2864),c=i(6247);function l(e){const t=!1!==e.prettyErrors;return{lineCounter:e.lineCounter||t&&new a.LineCounter||null,prettyErrors:t}}function p(e,t={}){const{lineCounter:i,prettyErrors:r}=l(t),o=new c.Parser(i?.addNewLine),a=new n.Composer(t);let p=null;for(const t of a.compose(o.parse(e),!0,e.length))if(p){if("silent"!==p.options.logLevel){p.errors.push(new s.YAMLParseError(t.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}}else p=t;return r&&i&&(p.errors.forEach(s.prettifyError(e,i)),p.warnings.forEach(s.prettifyError(e,i))),p}t.parse=function(e,t,i){let n;"function"==typeof t?n=t:void 0===i&&t&&"object"==typeof t&&(i=t);const r=p(e,i);if(!r)return null;if(r.warnings.forEach((e=>o.warn(r.options.logLevel,e))),r.errors.length>0){if("silent"!==r.options.logLevel)throw r.errors[0];r.errors=[]}return r.toJS(Object.assign({reviver:n},i))},t.parseAllDocuments=function(e,t={}){const{lineCounter:i,prettyErrors:r}=l(t),o=new c.Parser(i?.addNewLine),a=new n.Composer(t),p=Array.from(a.compose(o.parse(e)));if(r&&i)for(const t of p)t.errors.forEach(s.prettifyError(e,i)),t.warnings.forEach(s.prettifyError(e,i));return p.length>0?p:Object.assign([],{empty:!0},a.streamInfo())},t.parseDocument=p,t.stringify=function(e,t,i){let n=null;if("function"==typeof t||Array.isArray(t)?n=t:void 0===i&&t&&(i=t),"string"==typeof i&&(i=i.length),"number"==typeof i){const e=Math.round(i);i=e<1?void 0:e>8?{indent:8}:{indent:e}}if(void 0===e){const{keepUndefined:e}=i??t??{};if(!e)return}return new r.Document(e,n,i).toString(i)}},1386:(e,t)=>{"use strict";t.resolveProps=function(e,{flow:t,indicator:i,next:n,offset:r,onError:s,parentIndent:o,startOnNewline:a}){let c=!1,l=a,p=a,d="",u="",m=!1,f=!1,h=null,g=null,v=null,y=null,S=null,b=null,x=null;for(const r of e)switch(f&&("space"!==r.type&&"newline"!==r.type&&"comma"!==r.type&&s(r.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),f=!1),h&&(l&&"comment"!==r.type&&"newline"!==r.type&&s(h,"TAB_AS_INDENT","Tabs are not allowed as indentation"),h=null),r.type){case"space":t||"doc-start"===i&&"flow-collection"===n?.type||!r.source.includes("\t")||(h=r),p=!0;break;case"comment":{p||s(r,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const e=r.source.substring(1)||" ";d?d+=u+e:d=e,u="",l=!1;break}case"newline":l?d?d+=r.source:c=!0:u+=r.source,l=!0,m=!0,(g||v)&&(y=r),p=!0;break;case"anchor":g&&s(r,"MULTIPLE_ANCHORS","A node can have at most one anchor"),r.source.endsWith(":")&&s(r.offset+r.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),g=r,null===x&&(x=r.offset),l=!1,p=!1,f=!0;break;case"tag":v&&s(r,"MULTIPLE_TAGS","A node can have at most one tag"),v=r,null===x&&(x=r.offset),l=!1,p=!1,f=!0;break;case i:(g||v)&&s(r,"BAD_PROP_ORDER",`Anchors and tags must be after the ${r.source} indicator`),b&&s(r,"UNEXPECTED_TOKEN",`Unexpected ${r.source} in ${t??"collection"}`),b=r,l="seq-item-ind"===i||"explicit-key-ind"===i,p=!1;break;case"comma":if(t){S&&s(r,"UNEXPECTED_TOKEN",`Unexpected , in ${t}`),S=r,l=!1,p=!1;break}default:s(r,"UNEXPECTED_TOKEN",`Unexpected ${r.type} token`),l=!1,p=!1}const w=e[e.length-1],k=w?w.offset+w.source.length:r;return f&&n&&"space"!==n.type&&"newline"!==n.type&&"comma"!==n.type&&("scalar"!==n.type||""!==n.source)&&s(n.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),h&&(l&&h.indent<=o||"block-map"===n?.type||"block-seq"===n?.type)&&s(h,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:S,found:b,spaceBefore:c,comment:d,hasNewline:m,anchor:g,tag:v,newlineAfterProp:y,end:k,start:x??k}}},1414:function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.StorageSettings=void 0;const a=o(i(2743)),{systemManager:c}=a.default;t.StorageSettings=class{constructor(e,t){this.device=e,this.settings=t,this.values={},this.hasValue={};for(const e of Object.keys(t)){const i=t[e],n=()=>this.getItem(e);let r;r="clippath"!==i.type?n:()=>{try{return JSON.parse(n())}catch(e){}},Object.defineProperty(this.values,e,{get:r,set:t=>this.putSetting(e,t),enumerable:!0}),Object.defineProperty(this.hasValue,e,{get:()=>null!=this.device.storage.getItem(e),enumerable:!0})}}get keys(){const e={};for(const t of Object.keys(this.settings))e[t]=t;return e}async getSettings(){const e=await(this.options?.onGet?.()),t=[];for(const[i,n]of Object.entries(this.settings)){let r=Object.assign({},n);e?.[i]&&(r=Object.assign(r,e[i])),r.onGet&&(r=Object.assign(r,await r.onGet())),r.hide||await(this.options?.hide?.[i]?.())||(r.key=i,r.value=this.getItemInternal(i,r,!0),"function"==typeof r.deviceFilter&&(r.deviceFilter=r.deviceFilter.toString()),t.push(r),delete r.onPut,delete r.onGet,delete r.mapPut,delete r.mapGet)}return t}async putSetting(e,t){const i=this.settings[e];let n;return i&&(n=this.getItemInternal(e,i)),this.putSettingInternal(i,n,e,t)}putSettingInternal(e,t,i,n){e?.noStore||(e?.mapPut&&(n=e.mapPut(t,n)),null==n?this.device.storage.removeItem(i):"object"==typeof n?this.device.storage.setItem(i,JSON.stringify(n)):this.device.storage.setItem(i,n?.toString())),e?.onPut?.(t,n),e?.hide||this.device.onDeviceEvent(a.ScryptedInterface.Settings,void 0)}getItemInternal(e,t,i){if(!t)return this.device.storage.getItem(e);const n=function(e,t,i,n){if(null==e)return i();const r=t.multiple?"array":t.type;if("boolean"===r)return"true"===e||"false"!==e&&(i()||!1);if("number"===r){const t=parseFloat(e);return isNaN(t)?i()||0:t}if("integer"===r){const t=parseInt(e);return isNaN(t)?i()||0:t}if("array"===r){if(!e)return i()||[];try{return JSON.parse(e)}catch(e){return i()||[]}}if("device"===r)return n?e:c.getDeviceById(e)||c.getDeviceById(i());if(e&&t.json)try{return JSON.parse(e)}catch(e){return i()}return e||i()}(this.device.storage.getItem(e),t,(()=>null!=t.persistedDefaultValue?(this.putSettingInternal(t,void 0,e,t.persistedDefaultValue),t.persistedDefaultValue):t.defaultValue),i);return t.mapGet?t.mapGet(n):n}getItem(e){return this.getItemInternal(e,this.settings[e])}}},1456:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.loopbackList=void 0,t.isIPv4EmbeddedIPv6=c,t.removeIPv4EmbeddedIPv6=l,t.getUsableNetworkAddresses=function(){const e=r.default.networkInterfaces(),i=i=>Object.values(e).flat().filter((e=>e.family===i)).filter((e=>function(e){if(!e)return!1;try{e=l(e);const i=s.default.isIPv6(e)?"ipv6":"ipv4";return("ipv6"!==i||!a.check(e,i))&&(!o.check(e,i)&&!t.loopbackList.check(e,i))}catch(e){return!1}}(e.address))),n=i("IPv4"),c=i("IPv6"),p=c.filter((e=>e.address.includes("::"))),d=p.map((e=>{const t=new s.default.BlockList,i=parseInt(e.address.split("/")[1])||1;return t.addSubnet(e.address,i,"ipv6"),t})),u=c.filter((e=>{for(const t of d)if(t.check(e.address,"ipv6"))return!1;return!0}));return[...n.map((e=>e.address)),...p.map((e=>e.address)),...u.map((e=>e.address))]};const r=n(i(857)),s=n(i(9278));t.loopbackList=new s.default.BlockList,t.loopbackList.addSubnet("127.0.0.0",8),t.loopbackList.addAddress("::1","ipv6");const o=new s.default.BlockList;o.addSubnet("169.254.0.0",16),o.addSubnet("fe80::",64,"ipv6"),o.addSubnet("100.64.0.0",10),o.addSubnet("192.0.2.0",24),o.addSubnet("198.51.100.0",24),o.addSubnet("203.0.113.0",24),o.addSubnet("0.0.0.0",8),o.addSubnet("240.0.0.0",4),o.addSubnet("198.18.0.0",15);const a=new s.default.BlockList;function c(e){return s.default.isIPv6(e)&&e.startsWith("::ffff:")}function l(e){return c(e)?e.slice(7):e}a.addSubnet("10.0.0.0",8),a.addSubnet("172.16.0.0",12),a.addSubnet("192.168.0.0",16),a.addSubnet("fc00::",7,"ipv6")},1594:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AutomationJavascript=void 0;const n=i(5387);t.AutomationJavascript=class{automation;eventSource;eventDetails;eventData;log;constructor(e,t,i,n){this.automation=e,this.eventSource=t,this.eventDetails=i,this.eventData=n}async run(e){return(await(0,n.scryptedEval)(this.automation,e,{eventDetails:this.eventDetails,eventData:this.eventData,eventSource:this.eventSource})).value}}},1614:(e,t,i)=>{"use strict";var n=i(5219),r=i(484),s=i(8898);function o(e,t,i){let r=i;for(let e=t.length-1;e>=0;--e){const i=t[e];if("number"==typeof i&&Number.isInteger(i)&&i>=0){const e=[];e[i]=r,r=e}else r=new Map([[i,r]])}return n.createNode(r,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:e,sourceObjects:new Map})}const a=e=>null==e||"object"==typeof e&&!!e[Symbol.iterator]().next().done;class c extends s.NodeBase{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){const t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map((t=>r.isNode(t)||r.isPair(t)?t.clone(e):t)),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(a(e))this.add(t);else{const[i,...n]=e,s=this.get(i,!0);if(r.isCollection(s))s.addIn(n,t);else{if(void 0!==s||!this.schema)throw new Error(`Expected YAML collection at ${i}. Remaining path: ${n}`);this.set(i,o(this.schema,n,t))}}}deleteIn(e){const[t,...i]=e;if(0===i.length)return this.delete(t);const n=this.get(t,!0);if(r.isCollection(n))return n.deleteIn(i);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${i}`)}getIn(e,t){const[i,...n]=e,s=this.get(i,!0);return 0===n.length?!t&&r.isScalar(s)?s.value:s:r.isCollection(s)?s.getIn(n,t):void 0}hasAllNullValues(e){return this.items.every((t=>{if(!r.isPair(t))return!1;const i=t.value;return null==i||e&&r.isScalar(i)&&null==i.value&&!i.commentBefore&&!i.comment&&!i.tag}))}hasIn(e){const[t,...i]=e;if(0===i.length)return this.has(t);const n=this.get(t,!0);return!!r.isCollection(n)&&n.hasIn(i)}setIn(e,t){const[i,...n]=e;if(0===n.length)this.set(i,t);else{const e=this.get(i,!0);if(r.isCollection(e))e.setIn(n,t);else{if(void 0!==e||!this.schema)throw new Error(`Expected YAML collection at ${i}. Remaining path: ${n}`);this.set(i,o(this.schema,n,t))}}}}t.Collection=c,t.collectionFromPath=o,t.isEmptyPath=a},1621:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScryptedMimeTypes=t.ScryptedInterface=t.MediaPlayerState=t.SecuritySystemObstruction=t.SecuritySystemMode=t.AirQuality=t.AirPurifierMode=t.AirPurifierStatus=t.ChargeState=t.LockState=t.PanTiltZoomMovement=t.ThermostatMode=t.TemperatureUnit=t.FanMode=t.HumidityMode=t.ScryptedDeviceType=t.ScryptedInterfaceDescriptors=t.ScryptedInterfaceMethod=t.ScryptedInterfaceProperty=t.DeviceBase=t.TYPES_VERSION=void 0,t.TYPES_VERSION="0.5.52";var i,n,r,s,o,a,c,l,p,d,u,m,f,h,g,v,y,S;t.DeviceBase=class{},function(e){e.id="id",e.info="info",e.interfaces="interfaces",e.mixins="mixins",e.name="name",e.nativeId="nativeId",e.pluginId="pluginId",e.providedInterfaces="providedInterfaces",e.providedName="providedName",e.providedRoom="providedRoom",e.providedType="providedType",e.providerId="providerId",e.room="room",e.type="type",e.scryptedRuntimeArguments="scryptedRuntimeArguments",e.on="on",e.brightness="brightness",e.colorTemperature="colorTemperature",e.rgb="rgb",e.hsv="hsv",e.buttons="buttons",e.sensors="sensors",e.running="running",e.paused="paused",e.docked="docked",e.temperatureSetting="temperatureSetting",e.temperature="temperature",e.temperatureUnit="temperatureUnit",e.humidity="humidity",e.resolution="resolution",e.audioVolumes="audioVolumes",e.recordingActive="recordingActive",e.ptzCapabilities="ptzCapabilities",e.lockState="lockState",e.entryOpen="entryOpen",e.batteryLevel="batteryLevel",e.chargeState="chargeState",e.online="online",e.fromMimeType="fromMimeType",e.toMimeType="toMimeType",e.converters="converters",e.binaryState="binaryState",e.tampered="tampered",e.sleeping="sleeping",e.powerDetected="powerDetected",e.audioDetected="audioDetected",e.motionDetected="motionDetected",e.ambientLight="ambientLight",e.occupied="occupied",e.flooded="flooded",e.ultraviolet="ultraviolet",e.luminance="luminance",e.position="position",e.securitySystemState="securitySystemState",e.pm10Density="pm10Density",e.pm25Density="pm25Density",e.vocDensity="vocDensity",e.noxDensity="noxDensity",e.co2ppm="co2ppm",e.airQuality="airQuality",e.airPurifierState="airPurifierState",e.filterChangeIndication="filterChangeIndication",e.filterLifeLevel="filterLifeLevel",e.humiditySetting="humiditySetting",e.fan="fan",e.applicationInfo="applicationInfo",e.chatCompletionCapabilities="chatCompletionCapabilities",e.systemDevice="systemDevice"}(i||(t.ScryptedInterfaceProperty=i={})),function(e){e.listen="listen",e.probe="probe",e.setMixins="setMixins",e.setName="setName",e.setRoom="setRoom",e.setType="setType",e.getPluginJson="getPluginJson",e.turnOff="turnOff",e.turnOn="turnOn",e.setBrightness="setBrightness",e.getTemperatureMaxK="getTemperatureMaxK",e.getTemperatureMinK="getTemperatureMinK",e.setColorTemperature="setColorTemperature",e.setRgb="setRgb",e.setHsv="setHsv",e.pressButton="pressButton",e.sendNotification="sendNotification",e.start="start",e.stop="stop",e.pause="pause",e.resume="resume",e.dock="dock",e.setTemperature="setTemperature",e.setTemperatureUnit="setTemperatureUnit",e.getPictureOptions="getPictureOptions",e.takePicture="takePicture",e.getAudioStream="getAudioStream",e.setAudioVolumes="setAudioVolumes",e.startDisplay="startDisplay",e.stopDisplay="stopDisplay",e.getVideoStream="getVideoStream",e.getVideoStreamOptions="getVideoStreamOptions",e.getPrivacyMasks="getPrivacyMasks",e.setPrivacyMasks="setPrivacyMasks",e.getVideoTextOverlays="getVideoTextOverlays",e.setVideoTextOverlay="setVideoTextOverlay",e.getRecordingStream="getRecordingStream",e.getRecordingStreamCurrentTime="getRecordingStreamCurrentTime",e.getRecordingStreamOptions="getRecordingStreamOptions",e.getRecordingStreamThumbnail="getRecordingStreamThumbnail",e.deleteRecordingStream="deleteRecordingStream",e.setRecordingActive="setRecordingActive",e.ptzCommand="ptzCommand",e.getRecordedEvents="getRecordedEvents",e.getVideoClip="getVideoClip",e.getVideoClips="getVideoClips",e.getVideoClipThumbnail="getVideoClipThumbnail",e.removeVideoClips="removeVideoClips",e.setVideoStreamOptions="setVideoStreamOptions",e.startIntercom="startIntercom",e.stopIntercom="stopIntercom",e.lock="lock",e.unlock="unlock",e.addPassword="addPassword",e.getPasswords="getPasswords",e.removePassword="removePassword",e.activate="activate",e.deactivate="deactivate",e.isReversible="isReversible",e.closeEntry="closeEntry",e.openEntry="openEntry",e.getDevice="getDevice",e.releaseDevice="releaseDevice",e.adoptDevice="adoptDevice",e.discoverDevices="discoverDevices",e.createDevice="createDevice",e.getCreateDeviceSettings="getCreateDeviceSettings",e.reboot="reboot",e.getRefreshFrequency="getRefreshFrequency",e.refresh="refresh",e.getMediaStatus="getMediaStatus",e.load="load",e.seek="seek",e.skipNext="skipNext",e.skipPrevious="skipPrevious",e.convert="convert",e.convertMedia="convertMedia",e.getSettings="getSettings",e.putSetting="putSetting",e.armSecuritySystem="armSecuritySystem",e.disarmSecuritySystem="disarmSecuritySystem",e.setAirPurifierState="setAirPurifierState",e.getReadmeMarkdown="getReadmeMarkdown",e.getOauthUrl="getOauthUrl",e.onOauthCallback="onOauthCallback",e.canMixin="canMixin",e.getMixin="getMixin",e.releaseMixin="releaseMixin",e.onRequest="onRequest",e.onConnection="onConnection",e.onPush="onPush",e.run="run",e.eval="eval",e.loadScripts="loadScripts",e.saveScript="saveScript",e.forkInterface="forkInterface",e.getDetectionInput="getDetectionInput",e.getObjectTypes="getObjectTypes",e.detectObjects="detectObjects",e.generateObjectDetections="generateObjectDetections",e.getDetectionModel="getDetectionModel",e.setHumidity="setHumidity",e.setFan="setFan",e.startRTCSignalingSession="startRTCSignalingSession",e.createRTCSignalingSession="createRTCSignalingSession",e.getScryptedUserAccessControl="getScryptedUserAccessControl",e.generateVideoFrames="generateVideoFrames",e.connectStream="connectStream",e.getTTYSettings="getTTYSettings",e.getChatCompletion="getChatCompletion",e.streamChatCompletion="streamChatCompletion",e.getTextEmbedding="getTextEmbedding",e.getImageEmbedding="getImageEmbedding",e.callLLMTool="callLLMTool",e.getLLMTools="getLLMTools"}(n||(t.ScryptedInterfaceMethod=n={})),t.ScryptedInterfaceDescriptors={ScryptedDevice:{name:"ScryptedDevice",methods:["listen","probe","setMixins","setName","setRoom","setType"],properties:["id","info","interfaces","mixins","name","nativeId","pluginId","providedInterfaces","providedName","providedRoom","providedType","providerId","room","type"]},ScryptedPlugin:{name:"ScryptedPlugin",methods:["getPluginJson"],properties:[]},ScryptedPluginRuntime:{name:"ScryptedPluginRuntime",methods:[],properties:["scryptedRuntimeArguments"]},OnOff:{name:"OnOff",methods:["turnOff","turnOn"],properties:["on"]},Brightness:{name:"Brightness",methods:["setBrightness"],properties:["brightness"]},ColorSettingTemperature:{name:"ColorSettingTemperature",methods:["getTemperatureMaxK","getTemperatureMinK","setColorTemperature"],properties:["colorTemperature"]},ColorSettingRgb:{name:"ColorSettingRgb",methods:["setRgb"],properties:["rgb"]},ColorSettingHsv:{name:"ColorSettingHsv",methods:["setHsv"],properties:["hsv"]},Buttons:{name:"Buttons",methods:[],properties:["buttons"]},PressButtons:{name:"PressButtons",methods:["pressButton"],properties:[]},Sensors:{name:"Sensors",methods:[],properties:["sensors"]},Notifier:{name:"Notifier",methods:["sendNotification"],properties:[]},StartStop:{name:"StartStop",methods:["start","stop"],properties:["running"]},Pause:{name:"Pause",methods:["pause","resume"],properties:["paused"]},Dock:{name:"Dock",methods:["dock"],properties:["docked"]},TemperatureSetting:{name:"TemperatureSetting",methods:["setTemperature"],properties:["temperatureSetting"]},Thermometer:{name:"Thermometer",methods:["setTemperatureUnit"],properties:["temperature","temperatureUnit"]},HumiditySensor:{name:"HumiditySensor",methods:[],properties:["humidity"]},Camera:{name:"Camera",methods:["getPictureOptions","takePicture"],properties:[]},Resolution:{name:"Resolution",methods:[],properties:["resolution"]},Microphone:{name:"Microphone",methods:["getAudioStream"],properties:[]},AudioVolumeControl:{name:"AudioVolumeControl",methods:["setAudioVolumes"],properties:["audioVolumes"]},Display:{name:"Display",methods:["startDisplay","stopDisplay"],properties:[]},VideoCamera:{name:"VideoCamera",methods:["getVideoStream","getVideoStreamOptions"],properties:[]},VideoCameraMask:{name:"VideoCameraMask",methods:["getPrivacyMasks","setPrivacyMasks"],properties:[]},VideoTextOverlays:{name:"VideoTextOverlays",methods:["getVideoTextOverlays","setVideoTextOverlay"],properties:[]},VideoRecorder:{name:"VideoRecorder",methods:["getRecordingStream","getRecordingStreamCurrentTime","getRecordingStreamOptions","getRecordingStreamThumbnail"],properties:["recordingActive"]},VideoRecorderManagement:{name:"VideoRecorderManagement",methods:["deleteRecordingStream","setRecordingActive"],properties:[]},PanTiltZoom:{name:"PanTiltZoom",methods:["ptzCommand"],properties:["ptzCapabilities"]},EventRecorder:{name:"EventRecorder",methods:["getRecordedEvents"],properties:[]},VideoClips:{name:"VideoClips",methods:["getVideoClip","getVideoClips","getVideoClipThumbnail","removeVideoClips"],properties:[]},VideoCameraConfiguration:{name:"VideoCameraConfiguration",methods:["setVideoStreamOptions"],properties:[]},Intercom:{name:"Intercom",methods:["startIntercom","stopIntercom"],properties:[]},Lock:{name:"Lock",methods:["lock","unlock"],properties:["lockState"]},PasswordStore:{name:"PasswordStore",methods:["addPassword","getPasswords","removePassword"],properties:[]},Scene:{name:"Scene",methods:["activate","deactivate","isReversible"],properties:[]},Entry:{name:"Entry",methods:["closeEntry","openEntry"],properties:[]},EntrySensor:{name:"EntrySensor",methods:[],properties:["entryOpen"]},DeviceProvider:{name:"DeviceProvider",methods:["getDevice","releaseDevice"],properties:[]},DeviceDiscovery:{name:"DeviceDiscovery",methods:["adoptDevice","discoverDevices"],properties:[]},DeviceCreator:{name:"DeviceCreator",methods:["createDevice","getCreateDeviceSettings"],properties:[]},Battery:{name:"Battery",methods:[],properties:["batteryLevel"]},Charger:{name:"Charger",methods:[],properties:["chargeState"]},Reboot:{name:"Reboot",methods:["reboot"],properties:[]},Refresh:{name:"Refresh",methods:["getRefreshFrequency","refresh"],properties:[]},MediaPlayer:{name:"MediaPlayer",methods:["getMediaStatus","load","seek","skipNext","skipPrevious"],properties:[]},Online:{name:"Online",methods:[],properties:["online"]},BufferConverter:{name:"BufferConverter",methods:["convert"],properties:["fromMimeType","toMimeType"]},MediaConverter:{name:"MediaConverter",methods:["convertMedia"],properties:["converters"]},Settings:{name:"Settings",methods:["getSettings","putSetting"],properties:[]},BinarySensor:{name:"BinarySensor",methods:[],properties:["binaryState"]},TamperSensor:{name:"TamperSensor",methods:[],properties:["tampered"]},Sleep:{name:"Sleep",methods:[],properties:["sleeping"]},PowerSensor:{name:"PowerSensor",methods:[],properties:["powerDetected"]},AudioSensor:{name:"AudioSensor",methods:[],properties:["audioDetected"]},MotionSensor:{name:"MotionSensor",methods:[],properties:["motionDetected"]},AmbientLightSensor:{name:"AmbientLightSensor",methods:[],properties:["ambientLight"]},OccupancySensor:{name:"OccupancySensor",methods:[],properties:["occupied"]},FloodSensor:{name:"FloodSensor",methods:[],properties:["flooded"]},UltravioletSensor:{name:"UltravioletSensor",methods:[],properties:["ultraviolet"]},LuminanceSensor:{name:"LuminanceSensor",methods:[],properties:["luminance"]},PositionSensor:{name:"PositionSensor",methods:[],properties:["position"]},SecuritySystem:{name:"SecuritySystem",methods:["armSecuritySystem","disarmSecuritySystem"],properties:["securitySystemState"]},PM10Sensor:{name:"PM10Sensor",methods:[],properties:["pm10Density"]},PM25Sensor:{name:"PM25Sensor",methods:[],properties:["pm25Density"]},VOCSensor:{name:"VOCSensor",methods:[],properties:["vocDensity"]},NOXSensor:{name:"NOXSensor",methods:[],properties:["noxDensity"]},CO2Sensor:{name:"CO2Sensor",methods:[],properties:["co2ppm"]},AirQualitySensor:{name:"AirQualitySensor",methods:[],properties:["airQuality"]},AirPurifier:{name:"AirPurifier",methods:["setAirPurifierState"],properties:["airPurifierState"]},FilterMaintenance:{name:"FilterMaintenance",methods:[],properties:["filterChangeIndication","filterLifeLevel"]},Readme:{name:"Readme",methods:["getReadmeMarkdown"],properties:[]},OauthClient:{name:"OauthClient",methods:["getOauthUrl","onOauthCallback"],properties:[]},MixinProvider:{name:"MixinProvider",methods:["canMixin","getMixin","releaseMixin"],properties:[]},HttpRequestHandler:{name:"HttpRequestHandler",methods:["onRequest"],properties:[]},EngineIOHandler:{name:"EngineIOHandler",methods:["onConnection"],properties:[]},PushHandler:{name:"PushHandler",methods:["onPush"],properties:[]},Program:{name:"Program",methods:["run"],properties:[]},Scriptable:{name:"Scriptable",methods:["eval","loadScripts","saveScript"],properties:[]},ClusterForkInterface:{name:"ClusterForkInterface",methods:["forkInterface"],properties:[]},ObjectDetector:{name:"ObjectDetector",methods:["getDetectionInput","getObjectTypes"],properties:[]},ObjectDetection:{name:"ObjectDetection",methods:["detectObjects","generateObjectDetections","getDetectionModel"],properties:[]},ObjectDetectionPreview:{name:"ObjectDetectionPreview",methods:[],properties:[]},ObjectDetectionGenerator:{name:"ObjectDetectionGenerator",methods:[],properties:[]},HumiditySetting:{name:"HumiditySetting",methods:["setHumidity"],properties:["humiditySetting"]},Fan:{name:"Fan",methods:["setFan"],properties:["fan"]},RTCSignalingChannel:{name:"RTCSignalingChannel",methods:["startRTCSignalingSession"],properties:[]},RTCSignalingClient:{name:"RTCSignalingClient",methods:["createRTCSignalingSession"],properties:[]},LauncherApplication:{name:"LauncherApplication",methods:[],properties:["applicationInfo"]},ScryptedUser:{name:"ScryptedUser",methods:["getScryptedUserAccessControl"],properties:[]},VideoFrameGenerator:{name:"VideoFrameGenerator",methods:["generateVideoFrames"],properties:[]},StreamService:{name:"StreamService",methods:["connectStream"],properties:[]},TTY:{name:"TTY",methods:[],properties:[]},TTYSettings:{name:"TTYSettings",methods:["getTTYSettings"],properties:[]},ChatCompletion:{name:"ChatCompletion",methods:["getChatCompletion","streamChatCompletion"],properties:["chatCompletionCapabilities"]},TextEmbedding:{name:"TextEmbedding",methods:["getTextEmbedding"],properties:[]},ImageEmbedding:{name:"ImageEmbedding",methods:["getImageEmbedding"],properties:[]},LLMTools:{name:"LLMTools",methods:["callLLMTool","getLLMTools"],properties:[]},ScryptedSystemDevice:{name:"ScryptedSystemDevice",methods:[],properties:["systemDevice"]},ScryptedDeviceCreator:{name:"ScryptedDeviceCreator",methods:[],properties:[]},ScryptedSettings:{name:"ScryptedSettings",methods:[],properties:[]}},function(e){e.Builtin="Builtin",e.Internal="Internal",e.Camera="Camera",e.Fan="Fan",e.Light="Light",e.Switch="Switch",e.Outlet="Outlet",e.Sensor="Sensor",e.Scene="Scene",e.Program="Program",e.Automation="Automation",e.Vacuum="Vacuum",e.Notifier="Notifier",e.Thermostat="Thermostat",e.Lock="Lock",e.PasswordControl="PasswordControl",e.Display="Display",e.SmartDisplay="SmartDisplay",e.Speaker="Speaker",e.SmartSpeaker="SmartSpeaker",e.RemoteDesktop="RemoteDesktop",e.Event="Event",e.Entry="Entry",e.Garage="Garage",e.DeviceProvider="DeviceProvider",e.DataSource="DataSource",e.API="API",e.Buttons="Buttons",e.Doorbell="Doorbell",e.Irrigation="Irrigation",e.Valve="Valve",e.Person="Person",e.SecuritySystem="SecuritySystem",e.WindowCovering="WindowCovering",e.Siren="Siren",e.AirPurifier="AirPurifier",e.Internet="Internet",e.Network="Network",e.Bridge="Bridge",e.LLM="LLM",e.Unknown="Unknown"}(r||(t.ScryptedDeviceType=r={})),function(e){e.Humidify="Humidify",e.Dehumidify="Dehumidify",e.Auto="Auto",e.Off="Off"}(s||(t.HumidityMode=s={})),function(e){e.Auto="Auto",e.Manual="Manual"}(o||(t.FanMode=o={})),function(e){e.C="C",e.F="F"}(a||(t.TemperatureUnit=a={})),function(e){e.Off="Off",e.Cool="Cool",e.Heat="Heat",e.HeatCool="HeatCool",e.Auto="Auto",e.FanOnly="FanOnly",e.Purifier="Purifier",e.Eco="Eco",e.Dry="Dry",e.On="On"}(c||(t.ThermostatMode=c={})),function(e){e.Absolute="Absolute",e.Relative="Relative",e.Continuous="Continuous",e.Preset="Preset",e.Home="Home"}(l||(t.PanTiltZoomMovement=l={})),function(e){e.Locked="Locked",e.Unlocked="Unlocked",e.Jammed="Jammed"}(p||(t.LockState=p={})),function(e){e.Trickle="trickle",e.Charging="charging",e.NotCharging="not-charging"}(d||(t.ChargeState=d={})),function(e){e.Inactive="Inactive",e.Idle="Idle",e.Active="Active",e.ActiveNightMode="ActiveNightMode"}(u||(t.AirPurifierStatus=u={})),function(e){e.Manual="Manual",e.Automatic="Automatic"}(m||(t.AirPurifierMode=m={})),function(e){e.Unknown="Unknown",e.Excellent="Excellent",e.Good="Good",e.Fair="Fair",e.Inferior="Inferior",e.Poor="Poor"}(f||(t.AirQuality=f={})),function(e){e.Disarmed="Disarmed",e.HomeArmed="HomeArmed",e.AwayArmed="AwayArmed",e.NightArmed="NightArmed"}(h||(t.SecuritySystemMode=h={})),function(e){e.Sensor="Sensor",e.Occupied="Occupied",e.Time="Time",e.Error="Error"}(g||(t.SecuritySystemObstruction=g={})),function(e){e.Idle="Idle",e.Playing="Playing",e.Paused="Paused",e.Buffering="Buffering"}(v||(t.MediaPlayerState=v={})),function(e){e.ScryptedDevice="ScryptedDevice",e.ScryptedPlugin="ScryptedPlugin",e.ScryptedPluginRuntime="ScryptedPluginRuntime",e.OnOff="OnOff",e.Brightness="Brightness",e.ColorSettingTemperature="ColorSettingTemperature",e.ColorSettingRgb="ColorSettingRgb",e.ColorSettingHsv="ColorSettingHsv",e.Buttons="Buttons",e.PressButtons="PressButtons",e.Sensors="Sensors",e.Notifier="Notifier",e.StartStop="StartStop",e.Pause="Pause",e.Dock="Dock",e.TemperatureSetting="TemperatureSetting",e.Thermometer="Thermometer",e.HumiditySensor="HumiditySensor",e.Camera="Camera",e.Resolution="Resolution",e.Microphone="Microphone",e.AudioVolumeControl="AudioVolumeControl",e.Display="Display",e.VideoCamera="VideoCamera",e.VideoCameraMask="VideoCameraMask",e.VideoTextOverlays="VideoTextOverlays",e.VideoRecorder="VideoRecorder",e.VideoRecorderManagement="VideoRecorderManagement",e.PanTiltZoom="PanTiltZoom",e.EventRecorder="EventRecorder",e.VideoClips="VideoClips",e.VideoCameraConfiguration="VideoCameraConfiguration",e.Intercom="Intercom",e.Lock="Lock",e.PasswordStore="PasswordStore",e.Scene="Scene",e.Entry="Entry",e.EntrySensor="EntrySensor",e.DeviceProvider="DeviceProvider",e.DeviceDiscovery="DeviceDiscovery",e.DeviceCreator="DeviceCreator",e.Battery="Battery",e.Charger="Charger",e.Reboot="Reboot",e.Refresh="Refresh",e.MediaPlayer="MediaPlayer",e.Online="Online",e.BufferConverter="BufferConverter",e.MediaConverter="MediaConverter",e.Settings="Settings",e.BinarySensor="BinarySensor",e.TamperSensor="TamperSensor",e.Sleep="Sleep",e.PowerSensor="PowerSensor",e.AudioSensor="AudioSensor",e.MotionSensor="MotionSensor",e.AmbientLightSensor="AmbientLightSensor",e.OccupancySensor="OccupancySensor",e.FloodSensor="FloodSensor",e.UltravioletSensor="UltravioletSensor",e.LuminanceSensor="LuminanceSensor",e.PositionSensor="PositionSensor",e.SecuritySystem="SecuritySystem",e.PM10Sensor="PM10Sensor",e.PM25Sensor="PM25Sensor",e.VOCSensor="VOCSensor",e.NOXSensor="NOXSensor",e.CO2Sensor="CO2Sensor",e.AirQualitySensor="AirQualitySensor",e.AirPurifier="AirPurifier",e.FilterMaintenance="FilterMaintenance",e.Readme="Readme",e.OauthClient="OauthClient",e.MixinProvider="MixinProvider",e.HttpRequestHandler="HttpRequestHandler",e.EngineIOHandler="EngineIOHandler",e.PushHandler="PushHandler",e.Program="Program",e.Scriptable="Scriptable",e.ClusterForkInterface="ClusterForkInterface",e.ObjectDetector="ObjectDetector",e.ObjectDetection="ObjectDetection",e.ObjectDetectionPreview="ObjectDetectionPreview",e.ObjectDetectionGenerator="ObjectDetectionGenerator",e.HumiditySetting="HumiditySetting",e.Fan="Fan",e.RTCSignalingChannel="RTCSignalingChannel",e.RTCSignalingClient="RTCSignalingClient",e.LauncherApplication="LauncherApplication",e.ScryptedUser="ScryptedUser",e.VideoFrameGenerator="VideoFrameGenerator",e.StreamService="StreamService",e.TTY="TTY",e.TTYSettings="TTYSettings",e.ChatCompletion="ChatCompletion",e.TextEmbedding="TextEmbedding",e.ImageEmbedding="ImageEmbedding",e.LLMTools="LLMTools",e.ScryptedSystemDevice="ScryptedSystemDevice",e.ScryptedDeviceCreator="ScryptedDeviceCreator",e.ScryptedSettings="ScryptedSettings"}(y||(t.ScryptedInterface=y={})),function(e){e.Url="text/x-uri",e.InsecureLocalUrl="text/x-insecure-local-uri",e.LocalUrl="text/x-local-uri",e.ServerId="text/x-server-id",e.PushEndpoint="text/x-push-endpoint",e.SchemePrefix="x-scrypted/x-scrypted-scheme-",e.MediaStreamUrl="text/x-media-url",e.MediaObject="x-scrypted/x-scrypted-media-object",e.RequestMediaObject="x-scrypted/x-scrypted-request-media-object",e.RequestMediaStream="x-scrypted/x-scrypted-request-stream",e.MediaStreamFeedback="x-scrypted/x-media-stream-feedback",e.FFmpegInput="x-scrypted/x-ffmpeg-input",e.FFmpegTranscodeStream="x-scrypted/x-ffmpeg-transcode-stream",e.RTCSignalingChannel="x-scrypted/x-scrypted-rtc-signaling-channel",e.RTCSignalingSession="x-scrypted/x-scrypted-rtc-signaling-session",e.RTCConnectionManagement="x-scrypted/x-scrypted-rtc-connection-management",e.Image="x-scrypted/x-scrypted-image"}(S||(t.ScryptedMimeTypes=S={}))},1736:(e,t,i)=>{"use strict";var n=i(6261),r=i(9125),s=i(484),o=i(8898),a=i(3732);class c extends o.NodeBase{constructor(e){super(s.ALIAS),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e){let t;return r.visit(e,{Node:(e,i)=>{if(i===this)return r.visit.BREAK;i.anchor===this.source&&(t=i)}}),t}toJSON(e,t){if(!t)return{source:this.source};const{anchors:i,doc:n,maxAliasCount:r}=t,s=this.resolve(n);if(!s){const e=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(e)}let o=i.get(s);if(o||(a.toJS(s,null,t),o=i.get(s)),!o||void 0===o.res){throw new ReferenceError("This should not happen: Alias anchor was not resolved?")}if(r>=0&&(o.count+=1,0===o.aliasCount&&(o.aliasCount=l(n,s,i)),o.count*o.aliasCount>r)){throw new ReferenceError("Excessive alias count indicates a resource exhaustion attack")}return o.res}toString(e,t,i){const r=`*${this.source}`;if(e){if(n.anchorIsValid(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const e=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(e)}if(e.implicitKey)return`${r} `}return r}}function l(e,t,i){if(s.isAlias(t)){const n=t.resolve(e),r=i&&n&&i.get(n);return r?r.count*r.aliasCount:0}if(s.isCollection(t)){let n=0;for(const r of t.items){const t=l(e,r,i);t>n&&(n=t)}return n}if(s.isPair(t)){const n=l(e,t.key,i),r=l(e,t.value,i);return Math.max(n,r)}return 1}t.Alias=c},1755:(e,t,i)=>{"use strict";var n=i(81),r=i(5139),s=i(1614),o=i(484),a=i(7902),c=i(9714);function l(e,t){const i=o.isScalar(t)?t.value:t;for(const n of e)if(o.isPair(n)){if(n.key===t||n.key===i)return n;if(o.isScalar(n.key)&&n.key.value===i)return n}}class p extends s.Collection{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(o.MAP,e),this.items=[]}static from(e,t,i){const{keepUndefined:n,replacer:r}=i,s=new this(e),o=(e,o)=>{if("function"==typeof r)o=r.call(t,e,o);else if(Array.isArray(r)&&!r.includes(e))return;(void 0!==o||n)&&s.items.push(a.createPair(e,o,i))};if(t instanceof Map)for(const[e,i]of t)o(e,i);else if(t&&"object"==typeof t)for(const e of Object.keys(t))o(e,t[e]);return"function"==typeof e.sortMapEntries&&s.items.sort(e.sortMapEntries),s}add(e,t){let i;i=o.isPair(e)?e:e&&"object"==typeof e&&"key"in e?new a.Pair(e.key,e.value):new a.Pair(e,e?.value);const n=l(this.items,i.key),r=this.schema?.sortMapEntries;if(n){if(!t)throw new Error(`Key ${i.key} already set`);o.isScalar(n.value)&&c.isScalarValue(i.value)?n.value.value=i.value:n.value=i.value}else if(r){const e=this.items.findIndex((e=>r(i,e)<0));-1===e?this.items.push(i):this.items.splice(e,0,i)}else this.items.push(i)}delete(e){const t=l(this.items,e);if(!t)return!1;return this.items.splice(this.items.indexOf(t),1).length>0}get(e,t){const i=l(this.items,e),n=i?.value;return(!t&&o.isScalar(n)?n.value:n)??void 0}has(e){return!!l(this.items,e)}set(e,t){this.add(new a.Pair(e,t),!0)}toJSON(e,t,i){const n=i?new i:t?.mapAsMap?new Map:{};t?.onCreate&&t.onCreate(n);for(const e of this.items)r.addPairToJSMap(t,n,e);return n}toString(e,t,i){if(!e)return JSON.stringify(this);for(const e of this.items)if(!o.isPair(e))throw new Error(`Map items must all be pairs; found ${JSON.stringify(e)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),n.stringifyCollection(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:i,onComment:t})}}t.YAMLMap=p,t.findPair=l},1768:(e,t,i)=>{"use strict";var n=i(484),r=i(3793),s=i(248);t.stringifyDocument=function(e,t){const i=[];let o=!0===t.directives;if(!1!==t.directives&&e.directives){const t=e.directives.toString(e);t?(i.push(t),o=!0):e.directives.docStart&&(o=!0)}o&&i.push("---");const a=r.createStringifyContext(e,t),{commentString:c}=a.options;if(e.commentBefore){1!==i.length&&i.unshift("");const t=c(e.commentBefore);i.unshift(s.indentComment(t,""))}let l=!1,p=null;if(e.contents){if(n.isNode(e.contents)){if(e.contents.spaceBefore&&o&&i.push(""),e.contents.commentBefore){const t=c(e.contents.commentBefore);i.push(s.indentComment(t,""))}a.forceBlockIndent=!!e.comment,p=e.contents.comment}const t=p?void 0:()=>l=!0;let d=r.stringify(e.contents,a,(()=>p=null),t);p&&(d+=s.lineComment(d,"",c(p))),"|"!==d[0]&&">"!==d[0]||"---"!==i[i.length-1]?i.push(d):i[i.length-1]=`--- ${d}`}else i.push(r.stringify(e.contents,a));if(e.directives?.docEnd)if(e.comment){const t=c(e.comment);t.includes("\n")?(i.push("..."),i.push(s.indentComment(t,""))):i.push(`... ${t}`)}else i.push("...");else{let t=e.comment;t&&l&&(t=t.replace(/^\n+/,"")),t&&(l&&!p||""===i[i.length-1]||i.push(""),i.push(s.indentComment(c(t),"")))}return i.join("\n")+"\n"}},1917:(e,t,i)=>{var n;function r(e){function i(){if(i.enabled){var e=i,r=+new Date,s=r-(n||r);e.diff=s,e.prev=n,e.curr=r,n=r;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=t.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var c=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(function(i,n){if("%%"===i)return i;c++;var r=t.formatters[n];if("function"==typeof r){var s=o[c];i=r.call(e,s),o.splice(c,1),c--}return i})),t.formatArgs.call(e,o),(i.log||t.log||console.log.bind(console)).apply(e,o)}}return i.namespace=e,i.enabled=t.enabled(e),i.useColors=t.useColors(),i.color=function(e){var i,n=0;for(i in e)n=(n<<5)-n+e.charCodeAt(i),n|=0;return t.colors[Math.abs(n)%t.colors.length]}(e),"function"==typeof t.init&&t.init(i),i}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var i=("string"==typeof e?e:"").split(/[\s,]+/),n=i.length,r=0;r<n;r++)i[r]&&("-"===(e=i[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var i,n;for(i=0,n=t.skips.length;i<n;i++)if(t.skips[i].test(e))return!1;for(i=0,n=t.names.length;i<n;i++)if(t.names[i].test(e))return!0;return!1},t.humanize=i(3932),t.names=[],t.skips=[],t.formatters={}},1919:(e,t,i)=>{"use strict";var n=i(484),r=i(6010);const s={collection:"seq",default:!0,nodeClass:r.YAMLSeq,tag:"tag:yaml.org,2002:seq",resolve:(e,t)=>(n.isSeq(e)||t("Expected a sequence for this tag"),e),createNode:(e,t,i)=>r.YAMLSeq.from(e,t,i)};t.seq=s},2018:e=>{"use strict";e.exports=require("tty")},2206:(e,t,i)=>{"use strict";var n=i(9046),r=i(2782),s=i(6845),o=i(1386);t.composeDoc=function(e,t,{offset:i,start:a,value:c,end:l},p){const d=Object.assign({_directives:t},e),u=new n.Document(void 0,d),m={atRoot:!0,directives:u.directives,options:u.options,schema:u.schema},f=o.resolveProps(a,{indicator:"doc-start",next:c??l?.[0],offset:i,onError:p,parentIndent:0,startOnNewline:!0});f.found&&(u.directives.docStart=!0,!c||"block-map"!==c.type&&"block-seq"!==c.type||f.hasNewline||p(f.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),u.contents=c?r.composeNode(m,c,f,p):r.composeEmptyNode(m,f.end,a,null,f,p);const h=u.contents.range[2],g=s.resolveEnd(l,h,!1,p);return g.comment&&(u.comment=g.comment),u.range=[i,h,g.offset],u}},2291:(e,t,i)=>{"use strict";var n=i(484),r=i(7902),s=i(1755),o=i(6010),a=i(6845),c=i(1386),l=i(9378),p=i(8334);const d="Block collections are not allowed within flow collections",u=e=>e&&("block-map"===e.type||"block-seq"===e.type);t.resolveFlowCollection=function({composeNode:e,composeEmptyNode:t},i,m,f,h){const g="{"===m.start.source,v=g?"flow map":"flow sequence",y=new(h?.nodeClass??(g?s.YAMLMap:o.YAMLSeq))(i.schema);y.flow=!0;const S=i.atRoot;S&&(i.atRoot=!1);let b=m.offset+m.start.source.length;for(let o=0;o<m.items.length;++o){const a=m.items[o],{start:h,key:S,sep:x,value:w}=a,k=c.resolveProps(h,{flow:v,indicator:"explicit-key-ind",next:S??x?.[0],offset:b,onError:f,parentIndent:m.indent,startOnNewline:!1});if(!k.found){if(!(k.anchor||k.tag||x||w)){0===o&&k.comma?f(k.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${v}`):o<m.items.length-1&&f(k.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${v}`),k.comment&&(y.comment?y.comment+="\n"+k.comment:y.comment=k.comment),b=k.end;continue}!g&&i.options.strict&&l.containsNewline(S)&&f(S,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(0===o)k.comma&&f(k.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${v}`);else if(k.comma||f(k.start,"MISSING_CHAR",`Missing , between ${v} items`),k.comment){let e="";e:for(const t of h)switch(t.type){case"comma":case"space":break;case"comment":e=t.source.substring(1);break e;default:break e}if(e){let t=y.items[y.items.length-1];n.isPair(t)&&(t=t.value??t.key),t.comment?t.comment+="\n"+e:t.comment=e,k.comment=k.comment.substring(e.length+1)}}if(g||x||k.found){const n=k.end,o=S?e(i,S,k,f):t(i,n,h,null,k,f);u(S)&&f(o.range,"BLOCK_IN_FLOW",d);const l=c.resolveProps(x??[],{flow:v,indicator:"map-value-ind",next:w,offset:o.range[2],onError:f,parentIndent:m.indent,startOnNewline:!1});if(l.found){if(!g&&!k.found&&i.options.strict){if(x)for(const e of x){if(e===l.found)break;if("newline"===e.type){f(e,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}k.start<l.found.offset-1024&&f(l.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else w&&("source"in w&&w.source&&":"===w.source[0]?f(w,"MISSING_CHAR",`Missing space after : in ${v}`):f(l.start,"MISSING_CHAR",`Missing , or : between ${v} items`));const O=w?e(i,w,l,f):l.found?t(i,l.end,x,null,l,f):null;O?u(w)&&f(O.range,"BLOCK_IN_FLOW",d):l.comment&&(o.comment?o.comment+="\n"+l.comment:o.comment=l.comment);const D=new r.Pair(o,O);if(i.options.keepSourceTokens&&(D.srcToken=a),g){const e=y;p.mapIncludes(i,e.items,o)&&f(n,"DUPLICATE_KEY","Map keys must be unique"),e.items.push(D)}else{const e=new s.YAMLMap(i.schema);e.flow=!0,e.items.push(D);const t=(O??o).range;e.range=[o.range[0],t[1],t[2]],y.items.push(e)}b=O?O.range[2]:l.end}else{const n=w?e(i,w,k,f):t(i,k.end,x,null,k,f);y.items.push(n),b=n.range[2],u(w)&&f(n.range,"BLOCK_IN_FLOW",d)}}const x=g?"}":"]",[w,...k]=m.end;let O=b;if(w&&w.source===x)O=w.offset+w.source.length;else{const e=v[0].toUpperCase()+v.substring(1);f(b,S?"MISSING_CHAR":"BAD_INDENT",S?`${e} must end with a ${x}`:`${e} in block collection must be sufficiently indented and end with a ${x}`),w&&1!==w.source.length&&k.unshift(w)}if(k.length>0){const e=a.resolveEnd(k,O,i.options.strict,f);e.comment&&(y.comment?y.comment+="\n"+e.comment:y.comment=e.comment),y.range=[m.offset,O,e.offset]}else y.range=[m.offset,O,O];return y}},2531:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.automationActions=void 0;const r=i(2743),s=n(i(2743));function o(e,i,n){t.automationActions.set(e,{settings:i,invoke:n})}t.automationActions=new Map,o(r.ScryptedInterface.OnOff,{on:{title:"Turn On/Off",description:"Enable to turn on the device. Disable to turn off the device.",type:"boolean",immediate:!0}},(async function(e,t){return t.on?e.turnOn():e.turnOff()})),o(r.ScryptedInterface.StartStop,{running:{title:"Start/Stop",description:"Enable to start the device. Disable to stop the device.",type:"boolean",immediate:!0}},(async function(e,t){return e.running,t.running?e.start():e.stop()})),o(r.ScryptedInterface.Lock,{lockState:{title:"Lock/Unlock",choices:[r.LockState.Locked,r.LockState.Unlocked],defaultValue:r.LockState.Locked,immediate:!0}},(async function(e,t){return t.lockState===r.LockState.Unlocked?e.unlock():e.lock()})),o(r.ScryptedInterface.Brightness,{brightness:{title:"Brightness",type:"number"}},(async function(e,t){return e.setBrightness(t.brightness)})),o(r.ScryptedInterface.Program,{},(async function(e,t){return e.run()})),o(r.ScryptedInterface.Notifier,{notificationTitle:{title:"Title",type:"string"},notificationBody:{title:"Body",type:"string"},notificationMediaUrl:{title:"Image",type:"interface",deviceFilter:`deviceInterface === '${r.ScryptedInterface.VideoCamera}' || deviceInterface === '${r.ScryptedInterface.Camera}'`}},(async function(e,t){let{notificationMediaUrl:i}=t;if(i&&!i?.includes("://")){const[e,t]=i.split("#");if(t===r.ScryptedInterface.Camera){const t=s.default.systemManager.getDeviceById(e);i=await t.takePicture({reason:"event"})}else{i=s.default.systemManager.getDeviceById(e).getVideoStream()}}return e.sendNotification(t.notificationTitle,{body:t.notificationBody},i)}))},2557:(e,t,i)=>{"use strict";var n=i(484),r=i(7902),s=i(1755);class o extends s.YAMLMap{constructor(e){super(e),this.tag=o.tag}add(e){let t;t=n.isPair(e)?e:e&&"object"==typeof e&&"key"in e&&"value"in e&&null===e.value?new r.Pair(e.key,null):new r.Pair(e,null);s.findPair(this.items,t.key)||this.items.push(t)}get(e,t){const i=s.findPair(this.items,e);return!t&&n.isPair(i)?n.isScalar(i.key)?i.key.value:i.key:i}set(e,t){if("boolean"!=typeof t)throw new Error("Expected boolean value for set(key, value) in a YAML set, not "+typeof t);const i=s.findPair(this.items,e);i&&!t?this.items.splice(this.items.indexOf(i),1):!i&&t&&this.items.push(new r.Pair(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,i){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,i);throw new Error("Set items must all have null values")}static from(e,t,i){const{replacer:n}=i,s=new this(e);if(t&&Symbol.iterator in Object(t))for(let e of t)"function"==typeof n&&(e=n.call(t,e,e)),s.items.push(r.createPair(e,null,i));return s}}o.tag="tag:yaml.org,2002:set";const a={collection:"map",identify:e=>e instanceof Set,nodeClass:o,default:!1,tag:"tag:yaml.org,2002:set",createNode:(e,t,i)=>o.from(e,t,i),resolve(e,t){if(n.isMap(e)){if(e.hasAllNullValues(!0))return Object.assign(new o,e);t("Set items must all have null values")}else t("Expected a mapping for this tag");return e}};t.YAMLSet=o,t.set=a},2743:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sdk=t.MixinDeviceBase=t.ScryptedDeviceBase=void 0,r(i(9849),t);const o=s(i(9896)),a=i(9849);i(3339);class c extends a.DeviceBase{constructor(e){super(),this.nativeId=e}get storage(){return this._storage||(this._storage=t.sdk.deviceManager.getDeviceStorage(this.nativeId)),this._storage}get log(){return this._log||(this._log=t.sdk.deviceManager.getDeviceLogger(this.nativeId)),this._log}get console(){return this._console||(this._console=t.sdk.deviceManager.getDeviceConsole(this.nativeId)),this._console}async createMediaObject(e,i){return t.sdk.mediaManager.createMediaObject(e,i,{sourceId:this.id})}getMediaObjectConsole(e){return"string"!=typeof e.sourceId?this.console:t.sdk.deviceManager.getMixinConsole(e.sourceId,this.nativeId)}_lazyLoadDeviceState(){this._deviceState||(this.nativeId?this._deviceState=t.sdk.deviceManager.getDeviceState(this.nativeId):this._deviceState=t.sdk.deviceManager.getDeviceState())}onDeviceEvent(e,i){return t.sdk.deviceManager.onDeviceEvent(this.nativeId,e,i)}}t.ScryptedDeviceBase=c;class l extends a.DeviceBase{constructor(e){super(),this._listeners=new Set,this.mixinDevice=e.mixinDevice,this.mixinDeviceInterfaces=e.mixinDeviceInterfaces,this.mixinStorageSuffix=e.mixinStorageSuffix,this._deviceState=e.mixinDeviceState,this.nativeId=t.sdk.systemManager.getDeviceById(this.id).nativeId,this.mixinProviderNativeId=e.mixinProviderNativeId,this._deviceState.__rpcproxy_traps_all_properties&&"string"==typeof this._deviceState.id&&(this._deviceState=t.sdk.deviceManager.createDeviceState(this._deviceState.id,this._deviceState.setState))}get storage(){if(!this._storage){const e=this.mixinStorageSuffix,i=this.id+(e?":"+e:"");this._storage=t.sdk.deviceManager.getMixinStorage(i,this.mixinProviderNativeId)}return this._storage}get console(){return this._console||(t.sdk.deviceManager.getMixinConsole?this._console=t.sdk.deviceManager.getMixinConsole(this.id,this.mixinProviderNativeId):this._console=t.sdk.deviceManager.getDeviceConsole(this.mixinProviderNativeId)),this._console}async createMediaObject(e,i){return t.sdk.mediaManager.createMediaObject(e,i,{sourceId:this.id})}getMediaObjectConsole(e){return"string"!=typeof e.sourceId?this.console:t.sdk.deviceManager.getMixinConsole(e.sourceId,this.mixinProviderNativeId)}onDeviceEvent(e,i){return t.sdk.deviceManager.onMixinEvent(this.id,this,e,i)}_lazyLoadDeviceState(){}manageListener(e){this._listeners.add(e)}release(){for(const e of this._listeners)e.removeListener()}}t.MixinDeviceBase=l,function(){function e(e){return function(){return this._lazyLoadDeviceState(),this._deviceState?.[e]}}function t(e){return function(t){this._lazyLoadDeviceState(),this._deviceState?this._deviceState[e]=t:console.warn("device state is unavailable. the device must be discovered with deviceManager.onDeviceDiscovered or deviceManager.onDevicesChanged before the state can be set.")}}for(const i of Object.values(a.ScryptedInterfaceProperty))i!==a.ScryptedInterfaceProperty.nativeId&&(Object.defineProperty(c.prototype,i,{set:t(i),get:e(i)}),Object.defineProperty(l.prototype,i,{set:t(i),get:e(i)}))}(),t.sdk={};try{let e=!1;try{process.env.SCRYPTED_SDK_ES_MODULE||process.env.SCRYPTED_SDK_MODULE;const n=process.env.SCRYPTED_SDK_CJS_MODULE||process.env.SCRYPTED_SDK_MODULE;if(n)if("undefined"!=typeof require){const i=require(process.env.SCRYPTED_SDK_MODULE);Object.assign(t.sdk,i.getScryptedStatic()),e=!0}else{const r=i(394)(n);Object.assign(t.sdk,r.getScryptedStatic()),e=!0}}catch(e){throw console.warn("failed to load sdk module",e),e}if(!e){let e;try{e=pluginRuntimeAPI}catch(e){}Object.assign(t.sdk,{log:deviceManager.getDeviceLogger(void 0),deviceManager,endpointManager,mediaManager,systemManager,pluginHostAPI,...e})}try{let e={...a.ScryptedInterfaceDescriptors};try{const t=JSON.parse(o.default.readFileSync("../sdk.json").toString()).interfaceDescriptors;t&&(e={...e,...t})}catch(e){console.warn("failed to load custom interface descriptors",e)}t.sdk.systemManager.setScryptedInterfaceDescriptors?.(a.TYPES_VERSION,e)?.catch((()=>{}))}catch(e){}}catch(e){console.error("sdk initialization error, import @scrypted/types or use @scrypted/client instead",e)}t.default=t.sdk},2782:(e,t,i)=>{"use strict";var n=i(1736),r=i(18),s=i(9094),o=i(6845),a=i(1040);const c={composeNode:l,composeEmptyNode:p};function l(e,t,i,a){const{spaceBefore:l,comment:d,anchor:u,tag:m}=i;let f,h=!0;switch(t.type){case"alias":f=function({options:e},{offset:t,source:i,end:r},s){const a=new n.Alias(i.substring(1));""===a.source&&s(t,"BAD_ALIAS","Alias cannot be an empty string");a.source.endsWith(":")&&s(t+i.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const c=t+i.length,l=o.resolveEnd(r,c,e.strict,s);a.range=[t,c,l.offset],l.comment&&(a.comment=l.comment);return a}(e,t,a),(u||m)&&a(t,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":f=s.composeScalar(e,t,m,a),u&&(f.anchor=u.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":f=r.composeCollection(c,e,t,i,a),u&&(f.anchor=u.source.substring(1));break;default:a(t,"UNEXPECTED_TOKEN","error"===t.type?t.message:`Unsupported token (type: ${t.type})`),f=p(e,t.offset,void 0,null,i,a),h=!1}return u&&""===f.anchor&&a(u,"BAD_ALIAS","Anchor cannot be an empty string"),l&&(f.spaceBefore=!0),d&&("scalar"===t.type&&""===t.source?f.comment=d:f.commentBefore=d),e.options.keepSourceTokens&&h&&(f.srcToken=t),f}function p(e,t,i,n,{spaceBefore:r,comment:o,anchor:c,tag:l,end:p},d){const u={type:"scalar",offset:a.emptyScalarPosition(t,i,n),indent:-1,source:""},m=s.composeScalar(e,u,l,d);return c&&(m.anchor=c.source.substring(1),""===m.anchor&&d(c,"BAD_ALIAS","Anchor cannot be an empty string")),r&&(m.spaceBefore=!0),o&&(m.comment=o,m.range[2]=p),m}t.composeEmptyNode=p,t.composeNode=l},2864:(e,t)=>{"use strict";t.LineCounter=class{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,i=this.lineStarts.length;for(;t<i;){const n=t+i>>1;this.lineStarts[n]<e?t=n+1:i=n}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(0===t)return{line:0,col:e};return{line:t,col:e-this.lineStarts[t-1]+1}}}}},2891:(e,t,i)=>{"use strict";var n=i(3144);const r=e=>"bigint"==typeof e||Number.isInteger(e),s=(e,t,i,{intAsBigInt:n})=>n?BigInt(e):parseInt(e.substring(t),i);function o(e,t,i){const{value:s}=e;return r(s)&&s>=0?i+s.toString(t):n.stringifyNumber(e)}const a={identify:e=>r(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(e,t,i)=>s(e,2,8,i),stringify:e=>o(e,8,"0o")},c={identify:r,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(e,t,i)=>s(e,0,10,i),stringify:n.stringifyNumber},l={identify:e=>r(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(e,t,i)=>s(e,2,16,i),stringify:e=>o(e,16,"0x")};t.int=c,t.intHex=l,t.intOct=a},2961:(e,t,i)=>{"use strict";var n=i(5302),r=i(8858)("router:layer"),s=Object.prototype.hasOwnProperty;function o(e,t,i){if(!(this instanceof o))return new o(e,t,i);r("new %o",e);var s=t||{};this.handle=i,this.name=i.name||"<anonymous>",this.params=void 0,this.path=void 0,this.regexp=n(e,this.keys=[],s),this.regexp.fast_star="*"===e,this.regexp.fast_slash="/"===e&&!1===s.end}function a(e){if("string"!=typeof e||0===e.length)return e;try{return decodeURIComponent(e)}catch(t){throw t instanceof URIError&&(t.message="Failed to decode param '"+e+"'",t.status=400),t}}e.exports=o,o.prototype.handle_error=function(e,t,i,n){var r=this.handle;if(4!==r.length)return n(e);try{r(e,t,i,n)}catch(e){n(e)}},o.prototype.handle_request=function(e,t,i){var n=this.handle;if(n.length>3)return i();try{n(e,t,i)}catch(e){i(e)}},o.prototype.match=function(e){var t;if(null!=e){if(this.regexp.fast_slash)return this.params={},this.path="",!0;if(this.regexp.fast_star)return this.params={0:a(e)},this.path=e,!0;t=this.regexp.exec(e)}if(!t)return this.params=void 0,this.path=void 0,!1;this.params={},this.path=t[0];for(var i=this.keys,n=this.params,r=1;r<t.length;r++){var o=i[r-1].name,c=a(t[r]);void 0===c&&s.call(n,o)||(n[o]=c)}return!0}},3074:function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.AutomationCore=t.AutomationCoreNativeId=void 0;const a=o(i(2743)),c=i(6982),l=i(5025),p=i(774),{deviceManager:d}=a.default;t.AutomationCoreNativeId="automationcore";class u extends a.ScryptedDeviceBase{automations=new Map;constructor(){super(t.AutomationCoreNativeId),this.systemDevice={deviceCreator:"Automation"};for(const e of d.getNativeIds())if(e?.startsWith("automation:")){const t=new l.Automation(e);this.automations.set(e,t),this.reportAutomation(e,t.providedName)}(async()=>{const e="automation:update-plugins";let t=this.automations.get(e);t||(await this.reportAutomation(e,"Autoupdate Plugins"),t=new l.Automation(e),t.storage.setItem("data",JSON.stringify(p.updatePluginsData)),t.data=t.storageSettings.values.data,t.bind(),this.automations.set(e,t))})()}async getReadmeMarkdown(){return"Create custom smart home actions that trigger on specific events."}async getCreateDeviceSettings(){return[{key:"name",title:"Name",description:"The name or description of the new automation."}]}async createDevice(e){const{name:t}=e,i="automation:"+(0,c.randomBytes)(8).toString("hex");await this.reportAutomation(i,t?.toString());const n=new l.Automation(i);return this.automations.set(i,n),i}async reportAutomation(e,i){const n={providerNativeId:t.AutomationCoreNativeId,name:i,nativeId:e,type:a.ScryptedDeviceType.Automation,interfaces:[a.ScryptedInterface.OnOff,a.ScryptedInterface.Settings]};await d.onDeviceDiscovered(n)}async getDevice(e){return this.automations.get(e)}async releaseDevice(e,t){}}t.AutomationCore=u},3144:(e,t)=>{"use strict";t.stringifyNumber=function({format:e,minFractionDigits:t,tag:i,value:n}){if("bigint"==typeof n)return String(n);const r="number"==typeof n?n:Number(n);if(!isFinite(r))return isNaN(r)?".nan":r<0?"-.inf":".inf";let s=JSON.stringify(n);if(!e&&t&&(!i||"tag:yaml.org,2002:float"===i)&&/^\d/.test(s)){let e=s.indexOf(".");e<0&&(e=s.length,s+=".");let i=t-(s.length-e-1);for(;i-- >0;)s+="0"}return s}},3189:(e,t,i)=>{"use strict";var n=i(7016),r=n.parse,s=n.Url;function o(e){var t=e.url;if(void 0!==t){var i=e._parsedUrl;return c(t,i)?i:((i=a(t))._raw=t,e._parsedUrl=i)}}function a(e){if("string"!=typeof e||47!==e.charCodeAt(0))return r(e);for(var t=e,i=null,n=null,o=1;o<e.length;o++)switch(e.charCodeAt(o)){case 63:null===n&&(t=e.substring(0,o),i=e.substring(o+1),n=e.substring(o));break;case 9:case 10:case 12:case 13:case 32:case 35:case 160:case 65279:return r(e)}var a=void 0!==s?new s:{};return a.path=e,a.href=e,a.pathname=t,null!==n&&(a.query=i,a.search=n),a}function c(e,t){return"object"==typeof t&&null!==t&&(void 0===s||t instanceof s)&&t._raw===e}e.exports=o,e.exports.original=function(e){var t=e.originalUrl;if("string"!=typeof t)return o(e);var i=e._parsedOriginalUrl;if(c(t,i))return i;return i=a(t),i._raw=t,e._parsedOriginalUrl=i}},3236:e=>{"use strict";e.exports=require("path/posix")},3238:(e,t,i)=>{"use strict";i.d(t,{default:()=>d});const n={"application/prs.cww":["cww"],"application/prs.xsf+xml":["xsf"],"application/vnd.1000minds.decision-model+xml":["1km"],"application/vnd.3gpp.pic-bw-large":["plb"],"application/vnd.3gpp.pic-bw-small":["psb"],"application/vnd.3gpp.pic-bw-var":["pvb"],"application/vnd.3gpp2.tcap":["tcap"],"application/vnd.3m.post-it-notes":["pwn"],"application/vnd.accpac.simply.aso":["aso"],"application/vnd.accpac.simply.imp":["imp"],"application/vnd.acucobol":["acu"],"application/vnd.acucorp":["atc","acutc"],"application/vnd.adobe.air-application-installer-package+zip":["air"],"application/vnd.adobe.formscentral.fcdt":["fcdt"],"application/vnd.adobe.fxp":["fxp","fxpl"],"application/vnd.adobe.xdp+xml":["xdp"],"application/vnd.adobe.xfdf":["*xfdf"],"application/vnd.age":["age"],"application/vnd.ahead.space":["ahead"],"application/vnd.airzip.filesecure.azf":["azf"],"application/vnd.airzip.filesecure.azs":["azs"],"application/vnd.amazon.ebook":["azw"],"application/vnd.americandynamics.acc":["acc"],"application/vnd.amiga.ami":["ami"],"application/vnd.android.package-archive":["apk"],"application/vnd.anser-web-certificate-issue-initiation":["cii"],"application/vnd.anser-web-funds-transfer-initiation":["fti"],"application/vnd.antix.game-component":["atx"],"application/vnd.apple.installer+xml":["mpkg"],"application/vnd.apple.keynote":["key"],"application/vnd.apple.mpegurl":["m3u8"],"application/vnd.apple.numbers":["numbers"],"application/vnd.apple.pages":["pages"],"application/vnd.apple.pkpass":["pkpass"],"application/vnd.aristanetworks.swi":["swi"],"application/vnd.astraea-software.iota":["iota"],"application/vnd.audiograph":["aep"],"application/vnd.balsamiq.bmml+xml":["bmml"],"application/vnd.blueice.multipass":["mpm"],"application/vnd.bmi":["bmi"],"application/vnd.businessobjects":["rep"],"application/vnd.chemdraw+xml":["cdxml"],"application/vnd.chipnuts.karaoke-mmd":["mmd"],"application/vnd.cinderella":["cdy"],"application/vnd.citationstyles.style+xml":["csl"],"application/vnd.claymore":["cla"],"application/vnd.cloanto.rp9":["rp9"],"application/vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"application/vnd.cluetrust.cartomobile-config":["c11amc"],"application/vnd.cluetrust.cartomobile-config-pkg":["c11amz"],"application/vnd.commonspace":["csp"],"application/vnd.contact.cmsg":["cdbcmsg"],"application/vnd.cosmocaller":["cmc"],"application/vnd.crick.clicker":["clkx"],"application/vnd.crick.clicker.keyboard":["clkk"],"application/vnd.crick.clicker.palette":["clkp"],"application/vnd.crick.clicker.template":["clkt"],"application/vnd.crick.clicker.wordbank":["clkw"],"application/vnd.criticaltools.wbs+xml":["wbs"],"application/vnd.ctc-posml":["pml"],"application/vnd.cups-ppd":["ppd"],"application/vnd.curl.car":["car"],"application/vnd.curl.pcurl":["pcurl"],"application/vnd.dart":["dart"],"application/vnd.data-vision.rdz":["rdz"],"application/vnd.dbf":["dbf"],"application/vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"application/vnd.dece.ttml+xml":["uvt","uvvt"],"application/vnd.dece.unspecified":["uvx","uvvx"],"application/vnd.dece.zip":["uvz","uvvz"],"application/vnd.denovo.fcselayout-link":["fe_launch"],"application/vnd.dna":["dna"],"application/vnd.dolby.mlp":["mlp"],"application/vnd.dpgraph":["dpg"],"application/vnd.dreamfactory":["dfac"],"application/vnd.ds-keypoint":["kpxx"],"application/vnd.dvb.ait":["ait"],"application/vnd.dvb.service":["svc"],"application/vnd.dynageo":["geo"],"application/vnd.ecowin.chart":["mag"],"application/vnd.enliven":["nml"],"application/vnd.epson.esf":["esf"],"application/vnd.epson.msf":["msf"],"application/vnd.epson.quickanime":["qam"],"application/vnd.epson.salt":["slt"],"application/vnd.epson.ssf":["ssf"],"application/vnd.eszigno3+xml":["es3","et3"],"application/vnd.ezpix-album":["ez2"],"application/vnd.ezpix-package":["ez3"],"application/vnd.fdf":["*fdf"],"application/vnd.fdsn.mseed":["mseed"],"application/vnd.fdsn.seed":["seed","dataless"],"application/vnd.flographit":["gph"],"application/vnd.fluxtime.clip":["ftc"],"application/vnd.framemaker":["fm","frame","maker","book"],"application/vnd.frogans.fnc":["fnc"],"application/vnd.frogans.ltf":["ltf"],"application/vnd.fsc.weblaunch":["fsc"],"application/vnd.fujitsu.oasys":["oas"],"application/vnd.fujitsu.oasys2":["oa2"],"application/vnd.fujitsu.oasys3":["oa3"],"application/vnd.fujitsu.oasysgp":["fg5"],"application/vnd.fujitsu.oasysprs":["bh2"],"application/vnd.fujixerox.ddd":["ddd"],"application/vnd.fujixerox.docuworks":["xdw"],"application/vnd.fujixerox.docuworks.binder":["xbd"],"application/vnd.fuzzysheet":["fzs"],"application/vnd.genomatix.tuxedo":["txd"],"application/vnd.geogebra.file":["ggb"],"application/vnd.geogebra.tool":["ggt"],"application/vnd.geometry-explorer":["gex","gre"],"application/vnd.geonext":["gxt"],"application/vnd.geoplan":["g2w"],"application/vnd.geospace":["g3w"],"application/vnd.gmx":["gmx"],"application/vnd.google-apps.document":["gdoc"],"application/vnd.google-apps.presentation":["gslides"],"application/vnd.google-apps.spreadsheet":["gsheet"],"application/vnd.google-earth.kml+xml":["kml"],"application/vnd.google-earth.kmz":["kmz"],"application/vnd.grafeq":["gqf","gqs"],"application/vnd.groove-account":["gac"],"application/vnd.groove-help":["ghf"],"application/vnd.groove-identity-message":["gim"],"application/vnd.groove-injector":["grv"],"application/vnd.groove-tool-message":["gtm"],"application/vnd.groove-tool-template":["tpl"],"application/vnd.groove-vcard":["vcg"],"application/vnd.hal+xml":["hal"],"application/vnd.handheld-entertainment+xml":["zmm"],"application/vnd.hbci":["hbci"],"application/vnd.hhe.lesson-player":["les"],"application/vnd.hp-hpgl":["hpgl"],"application/vnd.hp-hpid":["hpid"],"application/vnd.hp-hps":["hps"],"application/vnd.hp-jlyt":["jlt"],"application/vnd.hp-pcl":["pcl"],"application/vnd.hp-pclxl":["pclxl"],"application/vnd.hydrostatix.sof-data":["sfd-hdstx"],"application/vnd.ibm.minipay":["mpy"],"application/vnd.ibm.modcap":["afp","listafp","list3820"],"application/vnd.ibm.rights-management":["irm"],"application/vnd.ibm.secure-container":["sc"],"application/vnd.iccprofile":["icc","icm"],"application/vnd.igloader":["igl"],"application/vnd.immervision-ivp":["ivp"],"application/vnd.immervision-ivu":["ivu"],"application/vnd.insors.igm":["igm"],"application/vnd.intercon.formnet":["xpw","xpx"],"application/vnd.intergeo":["i2g"],"application/vnd.intu.qbo":["qbo"],"application/vnd.intu.qfx":["qfx"],"application/vnd.ipunplugged.rcprofile":["rcprofile"],"application/vnd.irepository.package+xml":["irp"],"application/vnd.is-xpr":["xpr"],"application/vnd.isac.fcs":["fcs"],"application/vnd.jam":["jam"],"application/vnd.jcp.javame.midlet-rms":["rms"],"application/vnd.jisp":["jisp"],"application/vnd.joost.joda-archive":["joda"],"application/vnd.kahootz":["ktz","ktr"],"application/vnd.kde.karbon":["karbon"],"application/vnd.kde.kchart":["chrt"],"application/vnd.kde.kformula":["kfo"],"application/vnd.kde.kivio":["flw"],"application/vnd.kde.kontour":["kon"],"application/vnd.kde.kpresenter":["kpr","kpt"],"application/vnd.kde.kspread":["ksp"],"application/vnd.kde.kword":["kwd","kwt"],"application/vnd.kenameaapp":["htke"],"application/vnd.kidspiration":["kia"],"application/vnd.kinar":["kne","knp"],"application/vnd.koan":["skp","skd","skt","skm"],"application/vnd.kodak-descriptor":["sse"],"application/vnd.las.las+xml":["lasxml"],"application/vnd.llamagraphics.life-balance.desktop":["lbd"],"application/vnd.llamagraphics.life-balance.exchange+xml":["lbe"],"application/vnd.lotus-1-2-3":["123"],"application/vnd.lotus-approach":["apr"],"application/vnd.lotus-freelance":["pre"],"application/vnd.lotus-notes":["nsf"],"application/vnd.lotus-organizer":["org"],"application/vnd.lotus-screencam":["scm"],"application/vnd.lotus-wordpro":["lwp"],"application/vnd.macports.portpkg":["portpkg"],"application/vnd.mapbox-vector-tile":["mvt"],"application/vnd.mcd":["mcd"],"application/vnd.medcalcdata":["mc1"],"application/vnd.mediastation.cdkey":["cdkey"],"application/vnd.mfer":["mwf"],"application/vnd.mfmp":["mfm"],"application/vnd.micrografx.flo":["flo"],"application/vnd.micrografx.igx":["igx"],"application/vnd.mif":["mif"],"application/vnd.mobius.daf":["daf"],"application/vnd.mobius.dis":["dis"],"application/vnd.mobius.mbk":["mbk"],"application/vnd.mobius.mqy":["mqy"],"application/vnd.mobius.msl":["msl"],"application/vnd.mobius.plc":["plc"],"application/vnd.mobius.txf":["txf"],"application/vnd.mophun.application":["mpn"],"application/vnd.mophun.certificate":["mpc"],"application/vnd.mozilla.xul+xml":["xul"],"application/vnd.ms-artgalry":["cil"],"application/vnd.ms-cab-compressed":["cab"],"application/vnd.ms-excel":["xls","xlm","xla","xlc","xlt","xlw"],"application/vnd.ms-excel.addin.macroenabled.12":["xlam"],"application/vnd.ms-excel.sheet.binary.macroenabled.12":["xlsb"],"application/vnd.ms-excel.sheet.macroenabled.12":["xlsm"],"application/vnd.ms-excel.template.macroenabled.12":["xltm"],"application/vnd.ms-fontobject":["eot"],"application/vnd.ms-htmlhelp":["chm"],"application/vnd.ms-ims":["ims"],"application/vnd.ms-lrm":["lrm"],"application/vnd.ms-officetheme":["thmx"],"application/vnd.ms-outlook":["msg"],"application/vnd.ms-pki.seccat":["cat"],"application/vnd.ms-pki.stl":["*stl"],"application/vnd.ms-powerpoint":["ppt","pps","pot"],"application/vnd.ms-powerpoint.addin.macroenabled.12":["ppam"],"application/vnd.ms-powerpoint.presentation.macroenabled.12":["pptm"],"application/vnd.ms-powerpoint.slide.macroenabled.12":["sldm"],"application/vnd.ms-powerpoint.slideshow.macroenabled.12":["ppsm"],"application/vnd.ms-powerpoint.template.macroenabled.12":["potm"],"application/vnd.ms-project":["*mpp","mpt"],"application/vnd.ms-word.document.macroenabled.12":["docm"],"application/vnd.ms-word.template.macroenabled.12":["dotm"],"application/vnd.ms-works":["wps","wks","wcm","wdb"],"application/vnd.ms-wpl":["wpl"],"application/vnd.ms-xpsdocument":["xps"],"application/vnd.mseq":["mseq"],"application/vnd.musician":["mus"],"application/vnd.muvee.style":["msty"],"application/vnd.mynfc":["taglet"],"application/vnd.neurolanguage.nlu":["nlu"],"application/vnd.nitf":["ntf","nitf"],"application/vnd.noblenet-directory":["nnd"],"application/vnd.noblenet-sealer":["nns"],"application/vnd.noblenet-web":["nnw"],"application/vnd.nokia.n-gage.ac+xml":["*ac"],"application/vnd.nokia.n-gage.data":["ngdat"],"application/vnd.nokia.n-gage.symbian.install":["n-gage"],"application/vnd.nokia.radio-preset":["rpst"],"application/vnd.nokia.radio-presets":["rpss"],"application/vnd.novadigm.edm":["edm"],"application/vnd.novadigm.edx":["edx"],"application/vnd.novadigm.ext":["ext"],"application/vnd.oasis.opendocument.chart":["odc"],"application/vnd.oasis.opendocument.chart-template":["otc"],"application/vnd.oasis.opendocument.database":["odb"],"application/vnd.oasis.opendocument.formula":["odf"],"application/vnd.oasis.opendocument.formula-template":["odft"],"application/vnd.oasis.opendocument.graphics":["odg"],"application/vnd.oasis.opendocument.graphics-template":["otg"],"application/vnd.oasis.opendocument.image":["odi"],"application/vnd.oasis.opendocument.image-template":["oti"],"application/vnd.oasis.opendocument.presentation":["odp"],"application/vnd.oasis.opendocument.presentation-template":["otp"],"application/vnd.oasis.opendocument.spreadsheet":["ods"],"application/vnd.oasis.opendocument.spreadsheet-template":["ots"],"application/vnd.oasis.opendocument.text":["odt"],"application/vnd.oasis.opendocument.text-master":["odm"],"application/vnd.oasis.opendocument.text-template":["ott"],"application/vnd.oasis.opendocument.text-web":["oth"],"application/vnd.olpc-sugar":["xo"],"application/vnd.oma.dd2+xml":["dd2"],"application/vnd.openblox.game+xml":["obgx"],"application/vnd.openofficeorg.extension":["oxt"],"application/vnd.openstreetmap.data+xml":["osm"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.openxmlformats-officedocument.presentationml.slide":["sldx"],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":["ppsx"],"application/vnd.openxmlformats-officedocument.presentationml.template":["potx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":["xltx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.template":["dotx"],"application/vnd.osgeo.mapguide.package":["mgp"],"application/vnd.osgi.dp":["dp"],"application/vnd.osgi.subsystem":["esa"],"application/vnd.palm":["pdb","pqa","oprc"],"application/vnd.pawaafile":["paw"],"application/vnd.pg.format":["str"],"application/vnd.pg.osasli":["ei6"],"application/vnd.picsel":["efif"],"application/vnd.pmi.widget":["wg"],"application/vnd.pocketlearn":["plf"],"application/vnd.powerbuilder6":["pbd"],"application/vnd.previewsystems.box":["box"],"application/vnd.proteus.magazine":["mgz"],"application/vnd.publishare-delta-tree":["qps"],"application/vnd.pvi.ptid1":["ptid"],"application/vnd.pwg-xhtml-print+xml":["xhtm"],"application/vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"application/vnd.rar":["rar"],"application/vnd.realvnc.bed":["bed"],"application/vnd.recordare.musicxml":["mxl"],"application/vnd.recordare.musicxml+xml":["musicxml"],"application/vnd.rig.cryptonote":["cryptonote"],"application/vnd.rim.cod":["cod"],"application/vnd.rn-realmedia":["rm"],"application/vnd.rn-realmedia-vbr":["rmvb"],"application/vnd.route66.link66+xml":["link66"],"application/vnd.sailingtracker.track":["st"],"application/vnd.seemail":["see"],"application/vnd.sema":["sema"],"application/vnd.semd":["semd"],"application/vnd.semf":["semf"],"application/vnd.shana.informed.formdata":["ifm"],"application/vnd.shana.informed.formtemplate":["itp"],"application/vnd.shana.informed.interchange":["iif"],"application/vnd.shana.informed.package":["ipk"],"application/vnd.simtech-mindmapper":["twd","twds"],"application/vnd.smaf":["mmf"],"application/vnd.smart.teacher":["teacher"],"application/vnd.software602.filler.form+xml":["fo"],"application/vnd.solent.sdkm+xml":["sdkm","sdkd"],"application/vnd.spotfire.dxp":["dxp"],"application/vnd.spotfire.sfs":["sfs"],"application/vnd.stardivision.calc":["sdc"],"application/vnd.stardivision.draw":["sda"],"application/vnd.stardivision.impress":["sdd"],"application/vnd.stardivision.math":["smf"],"application/vnd.stardivision.writer":["sdw","vor"],"application/vnd.stardivision.writer-global":["sgl"],"application/vnd.stepmania.package":["smzip"],"application/vnd.stepmania.stepchart":["sm"],"application/vnd.sun.wadl+xml":["wadl"],"application/vnd.sun.xml.calc":["sxc"],"application/vnd.sun.xml.calc.template":["stc"],"application/vnd.sun.xml.draw":["sxd"],"application/vnd.sun.xml.draw.template":["std"],"application/vnd.sun.xml.impress":["sxi"],"application/vnd.sun.xml.impress.template":["sti"],"application/vnd.sun.xml.math":["sxm"],"application/vnd.sun.xml.writer":["sxw"],"application/vnd.sun.xml.writer.global":["sxg"],"application/vnd.sun.xml.writer.template":["stw"],"application/vnd.sus-calendar":["sus","susp"],"application/vnd.svd":["svd"],"application/vnd.symbian.install":["sis","sisx"],"application/vnd.syncml+xml":["xsm"],"application/vnd.syncml.dm+wbxml":["bdm"],"application/vnd.syncml.dm+xml":["xdm"],"application/vnd.syncml.dmddf+xml":["ddf"],"application/vnd.tao.intent-module-archive":["tao"],"application/vnd.tcpdump.pcap":["pcap","cap","dmp"],"application/vnd.tmobile-livetv":["tmo"],"application/vnd.trid.tpt":["tpt"],"application/vnd.triscape.mxs":["mxs"],"application/vnd.trueapp":["tra"],"application/vnd.ufdl":["ufd","ufdl"],"application/vnd.uiq.theme":["utz"],"application/vnd.umajin":["umj"],"application/vnd.unity":["unityweb"],"application/vnd.uoml+xml":["uoml","uo"],"application/vnd.vcx":["vcx"],"application/vnd.visio":["vsd","vst","vss","vsw"],"application/vnd.visionary":["vis"],"application/vnd.vsf":["vsf"],"application/vnd.wap.wbxml":["wbxml"],"application/vnd.wap.wmlc":["wmlc"],"application/vnd.wap.wmlscriptc":["wmlsc"],"application/vnd.webturbo":["wtb"],"application/vnd.wolfram.player":["nbp"],"application/vnd.wordperfect":["wpd"],"application/vnd.wqd":["wqd"],"application/vnd.wt.stf":["stf"],"application/vnd.xara":["xar"],"application/vnd.xfdl":["xfdl"],"application/vnd.yamaha.hv-dic":["hvd"],"application/vnd.yamaha.hv-script":["hvs"],"application/vnd.yamaha.hv-voice":["hvp"],"application/vnd.yamaha.openscoreformat":["osf"],"application/vnd.yamaha.openscoreformat.osfpvg+xml":["osfpvg"],"application/vnd.yamaha.smaf-audio":["saf"],"application/vnd.yamaha.smaf-phrase":["spf"],"application/vnd.yellowriver-custom-menu":["cmp"],"application/vnd.zul":["zir","zirz"],"application/vnd.zzazz.deck+xml":["zaz"],"application/x-7z-compressed":["7z"],"application/x-abiword":["abw"],"application/x-ace-compressed":["ace"],"application/x-apple-diskimage":["*dmg"],"application/x-arj":["arj"],"application/x-authorware-bin":["aab","x32","u32","vox"],"application/x-authorware-map":["aam"],"application/x-authorware-seg":["aas"],"application/x-bcpio":["bcpio"],"application/x-bdoc":["*bdoc"],"application/x-bittorrent":["torrent"],"application/x-blorb":["blb","blorb"],"application/x-bzip":["bz"],"application/x-bzip2":["bz2","boz"],"application/x-cbr":["cbr","cba","cbt","cbz","cb7"],"application/x-cdlink":["vcd"],"application/x-cfs-compressed":["cfs"],"application/x-chat":["chat"],"application/x-chess-pgn":["pgn"],"application/x-chrome-extension":["crx"],"application/x-cocoa":["cco"],"application/x-conference":["nsc"],"application/x-cpio":["cpio"],"application/x-csh":["csh"],"application/x-debian-package":["*deb","udeb"],"application/x-dgc-compressed":["dgc"],"application/x-director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"application/x-doom":["wad"],"application/x-dtbncx+xml":["ncx"],"application/x-dtbook+xml":["dtb"],"application/x-dtbresource+xml":["res"],"application/x-dvi":["dvi"],"application/x-envoy":["evy"],"application/x-eva":["eva"],"application/x-font-bdf":["bdf"],"application/x-font-ghostscript":["gsf"],"application/x-font-linux-psf":["psf"],"application/x-font-pcf":["pcf"],"application/x-font-snf":["snf"],"application/x-font-type1":["pfa","pfb","pfm","afm"],"application/x-freearc":["arc"],"application/x-futuresplash":["spl"],"application/x-gca-compressed":["gca"],"application/x-glulx":["ulx"],"application/x-gnumeric":["gnumeric"],"application/x-gramps-xml":["gramps"],"application/x-gtar":["gtar"],"application/x-hdf":["hdf"],"application/x-httpd-php":["php"],"application/x-install-instructions":["install"],"application/x-iso9660-image":["*iso"],"application/x-iwork-keynote-sffkey":["*key"],"application/x-iwork-numbers-sffnumbers":["*numbers"],"application/x-iwork-pages-sffpages":["*pages"],"application/x-java-archive-diff":["jardiff"],"application/x-java-jnlp-file":["jnlp"],"application/x-keepass2":["kdbx"],"application/x-latex":["latex"],"application/x-lua-bytecode":["luac"],"application/x-lzh-compressed":["lzh","lha"],"application/x-makeself":["run"],"application/x-mie":["mie"],"application/x-mobipocket-ebook":["*prc","mobi"],"application/x-ms-application":["application"],"application/x-ms-shortcut":["lnk"],"application/x-ms-wmd":["wmd"],"application/x-ms-wmz":["wmz"],"application/x-ms-xbap":["xbap"],"application/x-msaccess":["mdb"],"application/x-msbinder":["obd"],"application/x-mscardfile":["crd"],"application/x-msclip":["clp"],"application/x-msdos-program":["*exe"],"application/x-msdownload":["*exe","*dll","com","bat","*msi"],"application/x-msmediaview":["mvb","m13","m14"],"application/x-msmetafile":["*wmf","*wmz","*emf","emz"],"application/x-msmoney":["mny"],"application/x-mspublisher":["pub"],"application/x-msschedule":["scd"],"application/x-msterminal":["trm"],"application/x-mswrite":["wri"],"application/x-netcdf":["nc","cdf"],"application/x-ns-proxy-autoconfig":["pac"],"application/x-nzb":["nzb"],"application/x-perl":["pl","pm"],"application/x-pilot":["*prc","*pdb"],"application/x-pkcs12":["p12","pfx"],"application/x-pkcs7-certificates":["p7b","spc"],"application/x-pkcs7-certreqresp":["p7r"],"application/x-rar-compressed":["*rar"],"application/x-redhat-package-manager":["rpm"],"application/x-research-info-systems":["ris"],"application/x-sea":["sea"],"application/x-sh":["sh"],"application/x-shar":["shar"],"application/x-shockwave-flash":["swf"],"application/x-silverlight-app":["xap"],"application/x-sql":["*sql"],"application/x-stuffit":["sit"],"application/x-stuffitx":["sitx"],"application/x-subrip":["srt"],"application/x-sv4cpio":["sv4cpio"],"application/x-sv4crc":["sv4crc"],"application/x-t3vm-image":["t3"],"application/x-tads":["gam"],"application/x-tar":["tar"],"application/x-tcl":["tcl","tk"],"application/x-tex":["tex"],"application/x-tex-tfm":["tfm"],"application/x-texinfo":["texinfo","texi"],"application/x-tgif":["*obj"],"application/x-ustar":["ustar"],"application/x-virtualbox-hdd":["hdd"],"application/x-virtualbox-ova":["ova"],"application/x-virtualbox-ovf":["ovf"],"application/x-virtualbox-vbox":["vbox"],"application/x-virtualbox-vbox-extpack":["vbox-extpack"],"application/x-virtualbox-vdi":["vdi"],"application/x-virtualbox-vhd":["vhd"],"application/x-virtualbox-vmdk":["vmdk"],"application/x-wais-source":["src"],"application/x-web-app-manifest+json":["webapp"],"application/x-x509-ca-cert":["der","crt","pem"],"application/x-xfig":["fig"],"application/x-xliff+xml":["*xlf"],"application/x-xpinstall":["xpi"],"application/x-xz":["xz"],"application/x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"audio/vnd.dece.audio":["uva","uvva"],"audio/vnd.digital-winds":["eol"],"audio/vnd.dra":["dra"],"audio/vnd.dts":["dts"],"audio/vnd.dts.hd":["dtshd"],"audio/vnd.lucent.voice":["lvp"],"audio/vnd.ms-playready.media.pya":["pya"],"audio/vnd.nuera.ecelp4800":["ecelp4800"],"audio/vnd.nuera.ecelp7470":["ecelp7470"],"audio/vnd.nuera.ecelp9600":["ecelp9600"],"audio/vnd.rip":["rip"],"audio/x-aac":["*aac"],"audio/x-aiff":["aif","aiff","aifc"],"audio/x-caf":["caf"],"audio/x-flac":["flac"],"audio/x-m4a":["*m4a"],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/x-ms-wax":["wax"],"audio/x-ms-wma":["wma"],"audio/x-pn-realaudio":["ram","ra"],"audio/x-pn-realaudio-plugin":["rmp"],"audio/x-realaudio":["*ra"],"audio/x-wav":["*wav"],"chemical/x-cdx":["cdx"],"chemical/x-cif":["cif"],"chemical/x-cmdf":["cmdf"],"chemical/x-cml":["cml"],"chemical/x-csml":["csml"],"chemical/x-xyz":["xyz"],"image/prs.btif":["btif","btf"],"image/prs.pti":["pti"],"image/vnd.adobe.photoshop":["psd"],"image/vnd.airzip.accelerator.azv":["azv"],"image/vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"image/vnd.djvu":["djvu","djv"],"image/vnd.dvb.subtitle":["*sub"],"image/vnd.dwg":["dwg"],"image/vnd.dxf":["dxf"],"image/vnd.fastbidsheet":["fbs"],"image/vnd.fpx":["fpx"],"image/vnd.fst":["fst"],"image/vnd.fujixerox.edmics-mmr":["mmr"],"image/vnd.fujixerox.edmics-rlc":["rlc"],"image/vnd.microsoft.icon":["ico"],"image/vnd.ms-dds":["dds"],"image/vnd.ms-modi":["mdi"],"image/vnd.ms-photo":["wdp"],"image/vnd.net-fpx":["npx"],"image/vnd.pco.b16":["b16"],"image/vnd.tencent.tap":["tap"],"image/vnd.valve.source.texture":["vtf"],"image/vnd.wap.wbmp":["wbmp"],"image/vnd.xiff":["xif"],"image/vnd.zbrush.pcx":["pcx"],"image/x-3ds":["3ds"],"image/x-cmu-raster":["ras"],"image/x-cmx":["cmx"],"image/x-freehand":["fh","fhc","fh4","fh5","fh7"],"image/x-icon":["*ico"],"image/x-jng":["jng"],"image/x-mrsid-image":["sid"],"image/x-ms-bmp":["*bmp"],"image/x-pcx":["*pcx"],"image/x-pict":["pic","pct"],"image/x-portable-anymap":["pnm"],"image/x-portable-bitmap":["pbm"],"image/x-portable-graymap":["pgm"],"image/x-portable-pixmap":["ppm"],"image/x-rgb":["rgb"],"image/x-tga":["tga"],"image/x-xbitmap":["xbm"],"image/x-xpixmap":["xpm"],"image/x-xwindowdump":["xwd"],"message/vnd.wfa.wsc":["wsc"],"model/vnd.cld":["cld"],"model/vnd.collada+xml":["dae"],"model/vnd.dwf":["dwf"],"model/vnd.gdl":["gdl"],"model/vnd.gtw":["gtw"],"model/vnd.mts":["mts"],"model/vnd.opengex":["ogex"],"model/vnd.parasolid.transmit.binary":["x_b"],"model/vnd.parasolid.transmit.text":["x_t"],"model/vnd.pytha.pyox":["pyo","pyox"],"model/vnd.sap.vds":["vds"],"model/vnd.usda":["usda"],"model/vnd.usdz+zip":["usdz"],"model/vnd.valve.source.compiled-map":["bsp"],"model/vnd.vtu":["vtu"],"text/prs.lines.tag":["dsc"],"text/vnd.curl":["curl"],"text/vnd.curl.dcurl":["dcurl"],"text/vnd.curl.mcurl":["mcurl"],"text/vnd.curl.scurl":["scurl"],"text/vnd.dvb.subtitle":["sub"],"text/vnd.familysearch.gedcom":["ged"],"text/vnd.fly":["fly"],"text/vnd.fmi.flexstor":["flx"],"text/vnd.graphviz":["gv"],"text/vnd.in3d.3dml":["3dml"],"text/vnd.in3d.spot":["spot"],"text/vnd.sun.j2me.app-descriptor":["jad"],"text/vnd.wap.wml":["wml"],"text/vnd.wap.wmlscript":["wmls"],"text/x-asm":["s","asm"],"text/x-c":["c","cc","cxx","cpp","h","hh","dic"],"text/x-component":["htc"],"text/x-fortran":["f","for","f77","f90"],"text/x-handlebars-template":["hbs"],"text/x-java-source":["java"],"text/x-lua":["lua"],"text/x-markdown":["mkd"],"text/x-nfo":["nfo"],"text/x-opml":["opml"],"text/x-org":["*org"],"text/x-pascal":["p","pas"],"text/x-processing":["pde"],"text/x-sass":["sass"],"text/x-scss":["scss"],"text/x-setext":["etx"],"text/x-sfv":["sfv"],"text/x-suse-ymp":["ymp"],"text/x-uuencode":["uu"],"text/x-vcalendar":["vcs"],"text/x-vcard":["vcf"],"video/vnd.dece.hd":["uvh","uvvh"],"video/vnd.dece.mobile":["uvm","uvvm"],"video/vnd.dece.pd":["uvp","uvvp"],"video/vnd.dece.sd":["uvs","uvvs"],"video/vnd.dece.video":["uvv","uvvv"],"video/vnd.dvb.file":["dvb"],"video/vnd.fvt":["fvt"],"video/vnd.mpegurl":["mxu","m4u"],"video/vnd.ms-playready.media.pyv":["pyv"],"video/vnd.uvvu.mp4":["uvu","uvvu"],"video/vnd.vivo":["viv"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"],"video/x-mng":["mng"],"video/x-ms-asf":["asf","asx"],"video/x-ms-vob":["vob"],"video/x-ms-wm":["wm"],"video/x-ms-wmv":["wmv"],"video/x-ms-wmx":["wmx"],"video/x-ms-wvx":["wvx"],"video/x-msvideo":["avi"],"video/x-sgi-movie":["movie"],"video/x-smv":["smv"],"x-conference/x-cooltalk":["ice"]};Object.freeze(n);const r=n,s={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(s);const o=s;var a,c,l,p=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};a=new WeakMap,c=new WeakMap,l=new WeakMap;const d=new class{constructor(...e){a.set(this,new Map),c.set(this,new Map),l.set(this,new Map);for(const t of e)this.define(t)}define(e,t=!1){for(let[i,n]of Object.entries(e)){i=i.toLowerCase(),n=n.map((e=>e.toLowerCase())),p(this,l,"f").has(i)||p(this,l,"f").set(i,new Set);const e=p(this,l,"f").get(i);let r=!0;for(let s of n){const n=s.startsWith("*");if(s=n?s.slice(1):s,e?.add(s),r&&p(this,c,"f").set(i,s),r=!1,n)continue;const o=p(this,a,"f").get(s);if(o&&o!=i&&!t)throw new Error(`"${i} -> ${s}" conflicts with "${o} -> ${s}". Pass \`force=true\` to override this definition.`);p(this,a,"f").set(s,i)}}return this}getType(e){if("string"!=typeof e)return null;const t=e.replace(/^.*[/\\]/,"").toLowerCase(),i=t.replace(/^.*\./,"").toLowerCase(),n=t.length<e.length;return!(i.length<t.length-1)&&n?null:p(this,a,"f").get(i)??null}getExtension(e){return"string"!=typeof e?null:(e=e?.split?.(";")[0],(e&&p(this,c,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return"string"!=typeof e?null:p(this,l,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of p(this,l,"f").values())Object.freeze(e);return this}_getTestState(){return{types:p(this,a,"f"),extensions:p(this,c,"f")}}}(o,r)._freeze()},3290:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=void 0;class i{finished=!1;resolve;reject;[Symbol.dispose](){this.finished||this.reject(new Error("deferred disposed without being resolved"))}async resolvePromise(e){try{this.resolve(await e)}catch(e){this.reject(e)}}promise=new Promise(((e,t)=>{this.resolve=t=>(this.finished=!0,e(t),this),this.reject=e=>(this.finished=!0,t(e),this)}))}t.Deferred=i},3334:(e,t,i)=>{"use strict";var n=i(484),r=i(1755);const s={collection:"map",default:!0,nodeClass:r.YAMLMap,tag:"tag:yaml.org,2002:map",resolve:(e,t)=>(n.isMap(e)||t("Expected a mapping for this tag"),e),createNode:(e,t,i)=>r.YAMLMap.from(e,t,i)};t.map=s},3335:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFaPrefix=n,t.maybeGetFaPrefix=function(e){if(!e)return;return n(e)},t.setFaPrefix=function(e){i=e};let i="fa-unset";function n(e){if("fa-solid"===i&&e)switch(e){case"fa-puzzle":e="fa-puzzle-piece";break;case"fa-rectangle-terminal":e="fa-terminal";break;case"fa-sun-bright":e="fa-sun";break;case"fa-moon-over-sun":e="fa-circle";break;case"fa-broom-wide":e="fa-trash";break;case"fa-chevrons-down":e="fa-chevron-down";break;case"fa-chevrons-up":e="fa-chevron-up"}return i+(e?` ${e}`:"")}},3339:e=>{"use strict";e.exports=require("module")},3732:(e,t,i)=>{"use strict";var n=i(484);t.toJS=function e(t,i,r){if(Array.isArray(t))return t.map(((t,i)=>e(t,String(i),r)));if(t&&"function"==typeof t.toJSON){if(!r||!n.hasAnchor(t))return t.toJSON(i,r);const e={aliasCount:0,count:1,res:void 0};r.anchors.set(t,e),r.onCreate=t=>{e.res=t,delete r.onCreate};const s=t.toJSON(i,r);return r.onCreate&&r.onCreate(s),s}return"bigint"!=typeof t||r?.keep?t:Number(t)}},3793:(e,t,i)=>{"use strict";var n=i(6261),r=i(484),s=i(248),o=i(7180);t.createStringifyContext=function(e,t){const i=Object.assign({blockQuote:!0,commentString:s.stringifyComment,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},e.schema.toStringOptions,t);let n;switch(i.collectionStyle){case"block":n=!1;break;case"flow":n=!0;break;default:n=null}return{anchors:new Set,doc:e,flowCollectionPadding:i.flowCollectionPadding?" ":"",indent:"",indentStep:"number"==typeof i.indent?" ".repeat(i.indent):"  ",inFlow:n,options:i}},t.stringify=function(e,t,i,s){if(r.isPair(e))return e.toString(t,i,s);if(r.isAlias(e)){if(t.doc.directives)return e.toString(t);if(t.resolvedAliases?.has(e))throw new TypeError("Cannot stringify circular structure without alias nodes");t.resolvedAliases?t.resolvedAliases.add(e):t.resolvedAliases=new Set([e]),e=e.resolve(t.doc)}let a;const c=r.isNode(e)?e:t.doc.createNode(e,{onTagObj:e=>a=e});a||(a=function(e,t){if(t.tag){const i=e.filter((e=>e.tag===t.tag));if(i.length>0)return i.find((e=>e.format===t.format))??i[0]}let i,n;if(r.isScalar(t)){n=t.value;const r=e.filter((e=>e.identify?.(n)));i=r.find((e=>e.format===t.format))??r.find((e=>!e.format))}else n=t,i=e.find((e=>e.nodeClass&&n instanceof e.nodeClass));if(!i)throw new Error(`Tag not resolved for ${n?.constructor?.name??typeof n} value`);return i}(t.doc.schema.tags,c));const l=function(e,t,{anchors:i,doc:s}){if(!s.directives)return"";const o=[],a=(r.isScalar(e)||r.isCollection(e))&&e.anchor;a&&n.anchorIsValid(a)&&(i.add(a),o.push(`&${a}`));const c=e.tag?e.tag:t.default?null:t.tag;return c&&o.push(s.directives.tagString(c)),o.join(" ")}(c,a,t);l.length>0&&(t.indentAtStart=(t.indentAtStart??0)+l.length+1);const p="function"==typeof a.stringify?a.stringify(c,t,i,s):r.isScalar(c)?o.stringifyString(c,t,i,s):c.toString(t,i,s);return l?r.isScalar(c)||"{"===p[0]||"["===p[0]?`${l} ${p}`:`${l}\n${t.indent}${p}`:p}},3932:e=>{var t=1e3,i=60*t,n=60*i,r=24*n,s=365.25*r;function o(e,t,i){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+i:Math.ceil(e/t)+" "+i+"s"}e.exports=function(e,a){a=a||{};var c,l=typeof e;if("string"===l&&e.length>0)return function(e){if((e=String(e)).length>100)return;var o=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!o)return;var a=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*s;case"days":case"day":case"d":return a*r;case"hours":case"hour":case"hrs":case"hr":case"h":return a*n;case"minutes":case"minute":case"mins":case"min":case"m":return a*i;case"seconds":case"second":case"secs":case"sec":case"s":return a*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(e);if("number"===l&&!1===isNaN(e))return a.long?o(c=e,r,"day")||o(c,n,"hour")||o(c,i,"minute")||o(c,t,"second")||c+" ms":function(e){if(e>=r)return Math.round(e/r)+"d";if(e>=n)return Math.round(e/n)+"h";if(e>=i)return Math.round(e/i)+"m";if(e>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},4070:(e,t,i)=>{"use strict";var n=i(9714);t.resolveBlockScalar=function(e,t,i){const r=t.offset,s=function({offset:e,props:t},i,n){if("block-scalar-header"!==t[0].type)return n(t[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:r}=t[0],s=r[0];let o=0,a="",c=-1;for(let t=1;t<r.length;++t){const i=r[t];if(a||"-"!==i&&"+"!==i){const n=Number(i);!o&&n?o=n:-1===c&&(c=e+t)}else a=i}-1!==c&&n(c,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${r}`);let l=!1,p="",d=r.length;for(let e=1;e<t.length;++e){const r=t[e];switch(r.type){case"space":l=!0;case"newline":d+=r.source.length;break;case"comment":if(i&&!l){n(r,"MISSING_CHAR","Comments must be separated from other tokens by white space characters")}d+=r.source.length,p=r.source.substring(1);break;case"error":n(r,"UNEXPECTED_TOKEN",r.message),d+=r.source.length;break;default:{n(r,"UNEXPECTED_TOKEN",`Unexpected token in block scalar header: ${r.type}`);const e=r.source;e&&"string"==typeof e&&(d+=e.length)}}}return{mode:s,indent:o,chomp:a,comment:p,length:d}}(t,e.options.strict,i);if(!s)return{value:"",type:null,comment:"",range:[r,r,r]};const o=">"===s.mode?n.Scalar.BLOCK_FOLDED:n.Scalar.BLOCK_LITERAL,a=t.source?function(e){const t=e.split(/\n( *)/),i=t[0],n=i.match(/^( *)/),r=[n?.[1]?[n[1],i.slice(n[1].length)]:["",i]];for(let e=1;e<t.length;e+=2)r.push([t[e],t[e+1]]);return r}(t.source):[];let c=a.length;for(let e=a.length-1;e>=0;--e){const t=a[e][1];if(""!==t&&"\r"!==t)break;c=e}if(0===c){const e="+"===s.chomp&&a.length>0?"\n".repeat(Math.max(1,a.length-1)):"";let i=r+s.length;return t.source&&(i+=t.source.length),{value:e,type:o,comment:s.comment,range:[r,i,i]}}let l=t.indent+s.indent,p=t.offset+s.length,d=0;for(let t=0;t<c;++t){const[n,r]=a[t];if(""!==r&&"\r"!==r){if(n.length<l){const e="Block scalars with more-indented leading empty lines must use an explicit indentation indicator";i(p+n.length,"MISSING_CHAR",e)}if(0===s.indent&&(l=n.length),d=t,0===l&&!e.atRoot){i(p,"BAD_INDENT","Block scalar values in collections must be indented")}break}0===s.indent&&n.length>l&&(l=n.length),p+=n.length+r.length+1}for(let e=a.length-1;e>=c;--e)a[e][0].length>l&&(c=e+1);let u="",m="",f=!1;for(let e=0;e<d;++e)u+=a[e][0].slice(l)+"\n";for(let e=d;e<c;++e){let[t,r]=a[e];p+=t.length+r.length+1;const c="\r"===r[r.length-1];if(c&&(r=r.slice(0,-1)),r&&t.length<l){const e=`Block scalar lines must not be less indented than their ${s.indent?"explicit indentation indicator":"first line"}`;i(p-r.length-(c?2:1),"BAD_INDENT",e),t=""}o===n.Scalar.BLOCK_LITERAL?(u+=m+t.slice(l)+r,m="\n"):t.length>l||"\t"===r[0]?(" "===m?m="\n":f||"\n"!==m||(m="\n\n"),u+=m+t.slice(l)+r,m="\n",f=!0):""===r?"\n"===m?u+="\n":m="\n":(u+=m+r,m=" ",f=!1)}switch(s.chomp){case"-":break;case"+":for(let e=c;e<a.length;++e)u+="\n"+a[e][0].slice(l);"\n"!==u[u.length-1]&&(u+="\n");break;default:u+="\n"}const h=r+s.length+t.source.length;return{value:u,type:o,comment:s.comment,range:[r,h,h]}}},4355:(e,t)=>{"use strict";class i extends Error{constructor(e,t,i,n){super(),this.name=e,this.code=i,this.message=n,this.pos=t}}t.YAMLError=i,t.YAMLParseError=class extends i{constructor(e,t,i){super("YAMLParseError",e,t,i)}},t.YAMLWarning=class extends i{constructor(e,t,i){super("YAMLWarning",e,t,i)}},t.prettifyError=(e,t)=>i=>{if(-1===i.pos[0])return;i.linePos=i.pos.map((e=>t.linePos(e)));const{line:n,col:r}=i.linePos[0];i.message+=` at line ${n}, column ${r}`;let s=r-1,o=e.substring(t.lineStarts[n-1],t.lineStarts[n]).replace(/[\n\r]+$/,"");if(s>=60&&o.length>80){const e=Math.min(s-39,o.length-79);o=""+o.substring(e),s-=e-1}if(o.length>80&&(o=o.substring(0,79)+""),n>1&&/^ *$/.test(o.substring(0,s))){let i=e.substring(t.lineStarts[n-2],t.lineStarts[n-1]);i.length>80&&(i=i.substring(0,79)+"\n"),o=i+o}if(/[^ ]/.test(o)){let e=1;const t=i.linePos[1];t&&t.line===n&&t.col>r&&(e=Math.max(1,Math.min(t.col-r,80-s)));const a=" ".repeat(s)+"^".repeat(e);i.message+=`:\n\n${o}\n${a}\n`}}},4434:e=>{"use strict";e.exports=require("events")},4566:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LauncherMixin=void 0;const n=i(2743),r=i(6965);class s extends n.ScryptedDeviceBase{async getReadmeMarkdown(){return"Add Scrypted Plugins or Devices to the Scrypted launch screen for quick access."}async canMixin(e,t){if(!t.includes("@scrypted/launcher-ignore")&&e!==n.ScryptedDeviceType.Builtin&&e!==n.ScryptedDeviceType.API)return[n.ScryptedInterface.LauncherApplication]}async getMixin(e,t,i){return i.applicationInfo={icon:"fa "+(0,r.typeToIcon)(i.type),href:"#/device/"+i.id},e}async releaseMixin(e,t){}}t.LauncherMixin=s},4610:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=async function(e){await new Promise((t=>setTimeout(t,e)))}},4761:(e,t,i)=>{"use strict";var n=i(8611);e.exports=n.METHODS&&n.METHODS.map((function(e){return e.toLowerCase()}))||["get","post","put","head","delete","options","trace","copy","lock","mkcol","move","purge","propfind","proppatch","unlock","report","mkactivity","checkout","merge","m-search","notify","subscribe","unsubscribe","patch","search","connect"]},4927:(e,t,i)=>{"use strict";var n=i(8673),r=i(9046),s=i(4355),o=i(484),a=i(2206),c=i(6845);function l(e){if("number"==typeof e)return[e,e+1];if(Array.isArray(e))return 2===e.length?e:[e[0],e[1]];const{offset:t,source:i}=e;return[t,t+("string"==typeof i?i.length:1)]}function p(e){let t="",i=!1,n=!1;for(let r=0;r<e.length;++r){const s=e[r];switch(s[0]){case"#":t+=(""===t?"":n?"\n\n":"\n")+(s.substring(1)||" "),i=!0,n=!1;break;case"%":"#"!==e[r+1]?.[0]&&(r+=1),i=!1;break;default:i||(n=!0),i=!1}}return{comment:t,afterEmptyLine:n}}t.Composer=class{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(e,t,i,n)=>{const r=l(e);n?this.warnings.push(new s.YAMLWarning(r,t,i)):this.errors.push(new s.YAMLParseError(r,t,i))},this.directives=new n.Directives({version:e.version||"1.2"}),this.options=e}decorate(e,t){const{comment:i,afterEmptyLine:n}=p(this.prelude);if(i){const r=e.contents;if(t)e.comment=e.comment?`${e.comment}\n${i}`:i;else if(n||e.directives.docStart||!r)e.commentBefore=i;else if(o.isCollection(r)&&!r.flow&&r.items.length>0){let e=r.items[0];o.isPair(e)&&(e=e.key);const t=e.commentBefore;e.commentBefore=t?`${i}\n${t}`:i}else{const e=r.commentBefore;r.commentBefore=e?`${i}\n${e}`:i}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:p(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,i=-1){for(const t of e)yield*this.next(t);yield*this.end(t,i)}*next(e){switch(process.env.LOG_STREAM&&console.dir(e,{depth:null}),e.type){case"directive":this.directives.add(e.source,((t,i,n)=>{const r=l(e);r[0]+=t,this.onError(r,"BAD_DIRECTIVE",i,n)})),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const t=a.composeDoc(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,i=new s.YAMLParseError(l(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(i):this.doc.errors.push(i);break}case"doc-end":{if(!this.doc){const t="Unexpected doc-end without preceding document";this.errors.push(new s.YAMLParseError(l(e),"UNEXPECTED_TOKEN",t));break}this.doc.directives.docEnd=!0;const t=c.resolveEnd(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){const e=this.doc.comment;this.doc.comment=e?`${e}\n${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new s.YAMLParseError(l(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const e=Object.assign({_directives:this.directives},this.options),i=new r.Document(void 0,e);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),i.range=[0,t,t],this.decorate(i,!1),yield i}}}},4988:(e,t,i)=>{"use strict";var n=i(9714),r=i(3334),s=i(1919);function o(e){return"bigint"==typeof e||Number.isInteger(e)}const a=({value:e})=>JSON.stringify(e),c=[{identify:e=>"string"==typeof e,default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:a},{identify:e=>null==e,createNode:()=>new n.Scalar(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:a},{identify:e=>"boolean"==typeof e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^true|false$/,resolve:e=>"true"===e,stringify:a},{identify:o,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(e,t,{intAsBigInt:i})=>i?BigInt(e):parseInt(e,10),stringify:({value:e})=>o(e)?e.toString():JSON.stringify(e)},{identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:e=>parseFloat(e),stringify:a}],l={default:!0,tag:"",test:/^/,resolve:(e,t)=>(t(`Unresolved plain scalar ${JSON.stringify(e)}`),e)},p=[r.map,s.seq].concat(c,l);t.schema=p},5025:function(__unused_webpack_module,exports,__webpack_require__){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||(ownKeys=function(e){return ownKeys=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},ownKeys(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=ownKeys(e),n=0;n<i.length;n++)"default"!==i[n]&&__createBinding(t,e,i[n]);return __setModuleDefault(t,e),t}),ownKeys;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Automation=void 0;const sdk_1=__importStar(__webpack_require__(2743)),storage_settings_1=__webpack_require__(1414),javascript_1=__webpack_require__(1594),scheduler_1=__webpack_require__(7476),shellscript_1=__webpack_require__(6080),scrypted_eval_1=__webpack_require__(5387),automation_actions_1=__webpack_require__(2531),{systemManager}=sdk_1.default;class Automation extends sdk_1.ScryptedDeviceBase{registers=[];pendings=new Map;actionSettings=[];triggerSettings=[];storageSettings=new storage_settings_1.StorageSettings(this,{denoiseEvents:{title:"Denoise Events",description:"Denoising events will suppress events where the same event data is sent multiple times in a row. For example, if a sensor sent multiple door open events, only the first event will trigger this automation. The automation will fire again once the door sends a close event.",type:"boolean"},runToCompletion:{title:"Run Automations to Completion",description:"By default, automations that are executing will reset if triggered by a new event. Check this box to require an automation to run to completion before it can be triggered again. This setting can be used in conjunction with a timer to prevent an automation from running too often.",type:"boolean"},staticEvents:{title:"Reset Automation on All Events",description:"By default, running Automation timers will be reset if the same device fires the event again. Check this box to reset Automation timers on all of the configured events.",type:"boolean"},data:{json:!0,hide:!0,defaultValue:{}}});data=this.storageSettings.values.data;constructor(e){super(e),this.data.actions||=[],this.data.triggers||=[],void 0===this.on&&(this.on=!0),this.bind()}async getSettings(){return[...(await Promise.all(this.triggerSettings.map((e=>e.getSettings())))).flat(),...(await Promise.all(this.actionSettings.map((e=>e.getSettings())))).flat(),...await this.storageSettings.getSettings()]}async putSetting(e,t){const i=[...this.triggerSettings,...this.actionSettings,this.storageSettings];for(const n of i)if(n.keys[e]){await n.putSetting(e,t);break}this.bind()}async eval(e,t){return(await(0,scrypted_eval_1.scryptedEval)(this,e,t)).value}async turnOff(){this.on=!1,this.bind()}async turnOn(){this.on=!0,this.bind()}abort(e){if(e){const t=this.pendings.get(e);t&&(this.pendings.delete(e),t.aborted=!0)}else{for(const e of this.pendings.values())e.aborted=!0;this.pendings.clear()}}bind(){this.abort();for(const e of this.registers)e.removeListener();if(this.registers=[],this.on){this.log.i("automation is waiting for event trigger.");try{const createTriggerTypeStorageSettings=(e,t)=>{const i=parseInt(e);return new storage_settings_1.StorageSettings(this,{[`trigger-type-${i}`]:{title:"Trigger Type",choices:["Scheduler","Device Event","Remove Trigger"],immediate:!0,mapGet:()=>t,mapPut:(e,t)=>{switch(t){case"Device Event":this.data.triggers[i].id="";break;case"Scheduler":this.data.triggers[i].id="scheduler";break;case"Remove Trigger":this.data.triggers.splice(i,1)}this.storageSettings.values.data=this.data}}})},createActionTypeStorageSettings=(e,t)=>{const i=parseInt(e);return new storage_settings_1.StorageSettings(this,{[`action-type-${i}`]:{title:"Action Type",choices:["Script","Shell Script","Wait","Update Plugins","Device Action","Remove Action"],immediate:!0,mapGet:()=>t,mapPut:(e,t)=>{switch(t){case"Script":this.data.actions[i].id="scriptable";break;case"Shell Script":this.data.actions[i].id="shell-scriptable";break;case"Wait":this.data.actions[i].id="timer";break;case"Update Plugins":this.data.actions[i].id="update-plugins";break;case"Device Action":this.data.actions[i].id="";break;case"Remove Action":this.data.actions.splice(i,1)}this.storageSettings.values.data=this.data}}})};this.actionSettings=[],this.triggerSettings=[];for(const[e,t]of Object.entries(this.data.triggers)){const i=[],n=t.id.split("#"),[r]=n;"scheduler"===r?(i.push(createTriggerTypeStorageSettings(e,"Scheduler")),i.push(new storage_settings_1.StorageSettings(this,{[`trigger-day-${e}`]:{title:"Day",type:"day",multiple:!0,mapGet(){const e=[];return t?.model.sunday&&e.push(0),t?.model.monday&&e.push(1),t?.model.tuesday&&e.push(2),t?.model.wednesday&&e.push(3),t?.model.thursday&&e.push(4),t?.model.friday&&e.push(5),t?.model.saturday&&e.push(6),e},mapPut:(e,i)=>{t.model.sunday=i.includes(0),t.model.monday=i.includes(1),t.model.tuesday=i.includes(2),t.model.wednesday=i.includes(3),t.model.thursday=i.includes(4),t.model.friday=i.includes(5),t.model.saturday=i.includes(6),this.storageSettings.values.data=this.data}}})),i.push(new storage_settings_1.StorageSettings(this,{[`trigger-time-${e}`]:{title:"Time",type:"time",mapGet(){const e=new Date;return e.setHours(t.model.hour),e.setMinutes(t.model.minute),e.getTime()},mapPut:(e,i)=>{const n=new Date(i);t.model.hour=n.getHours(),t.model.minute=n.getMinutes(),this.storageSettings.values.data=this.data}}}))):(i.push(createTriggerTypeStorageSettings(e,"Device Event")),i.push(new storage_settings_1.StorageSettings(this,{[`trigger-${e}`]:{title:"Device Event",description:"The event to trigger the automation.",type:"interface",mapGet:()=>t.id,mapPut:(e,i)=>{t.id=i,this.storageSettings.values.data=this.data}}}))),i.push(new storage_settings_1.StorageSettings(this,{[`trigger-condition-${e}`]:{title:"Trigger Condition (optional)",description:"A JavaScript condition to evaluate before running the automation. If the condition is false, the automation will not run. The eventData variable contains the event payload.",placeholder:"MotionSensor example: eventData === true",mapGet:()=>t.condition,mapPut:(e,i)=>{t.condition=i,this.storageSettings.values.data=this.data}}}));for(const t of i)for(const i of Object.values(t.settings))i.subgroup=`Trigger ${parseInt(e)+1}`;this.triggerSettings.push(...i)}for(const[e,t]of Object.entries(this.data.actions||[])){const i=[],n=t.id.split("#"),[r,s]=n;if("scriptable"===r)i.push(createActionTypeStorageSettings(e,"Script")),i.push(new storage_settings_1.StorageSettings(this,{[`action-${e}`]:{title:"Script",description:"The script to run when the automation is triggered.",type:"script",mapGet:()=>t.model["script.ts"],mapPut:(e,i)=>{t.model["script.ts"]=i,this.storageSettings.values.data=this.data}}}));else if("shell-scriptable"===r)i.push(createActionTypeStorageSettings(e,"Shell Script")),i.push(new storage_settings_1.StorageSettings(this,{[`action-${e}`]:{title:"Shell Script",description:"The shell script to run when the automation is triggered.",type:"textarea",mapGet:()=>t.model["script.sh"],mapPut:(e,i)=>{t.model["script.sh"]=i,this.storageSettings.values.data=this.data}}}));else if("timer"===r)i.push(createActionTypeStorageSettings(e,"Wait")),i.push(new storage_settings_1.StorageSettings(this,{[`action-${e}`]:{title:"Seconds",description:"The number of seconds to wait before running the next action.",type:"number",mapGet:()=>t.model.seconds,mapPut:(e,i)=>{t.model.seconds=i,this.storageSettings.values.data=this.data}}}));else if("update-plugins"===r)i.push(createActionTypeStorageSettings(e,"Update Plugins"));else{const n=[...automation_actions_1.automationActions.keys()],r=`${JSON.stringify(n)}.includes(deviceInterface)`;i.push(createActionTypeStorageSettings(e,"Device Action")),i.push(new storage_settings_1.StorageSettings(this,{[`action-${e}`]:{title:"Device",description:"The device to control when the automation is triggered.",type:"interface",deviceFilter:r,immediate:!0,mapGet:()=>t.id,mapPut:(e,i)=>{t.id=i,this.storageSettings.values.data=this.data}}}));let o=automation_actions_1.automationActions.get(s)?.settings;if(o){const n=JSON.parse(JSON.stringify(o));o={};for(const i of Object.keys(n)){const r=n[i];o[`action-${e}-${i}`]=r,r.mapPut=(e,n)=>{t.model[i]=n,this.storageSettings.values.data=this.data},r.mapGet=()=>t.model[i]}i.push(new storage_settings_1.StorageSettings(this,o))}}for(const t of i)for(const i of Object.values(t.settings))i.subgroup=`Action ${parseInt(e)+1}`;this.actionSettings.push(...i)}this.triggerSettings.push(new storage_settings_1.StorageSettings(this,{addTrigger:{subgroup:`Trigger ${this.data.triggers.length+1}`,title:"Add Trigger",description:"Add a new trigger to the automation.",type:"button",mapPut:()=>{this.data.triggers.push({id:"",model:{}}),this.storageSettings.values.data=this.data}}})),this.actionSettings.push(new storage_settings_1.StorageSettings(this,{addAction:{subgroup:`Action ${this.data.actions.length+1}`,title:"Add Action",description:"Add a new action to the automation.",type:"button",mapPut:()=>{this.data.actions.push({id:"",model:{}}),this.storageSettings.values.data=this.data}}}));for(const e of this.actionSettings)for(const t of Object.values(e.settings))t.group="Actions";for(const e of this.triggerSettings)for(const t of Object.values(e.settings))t.group="Triggers";const{denoiseEvents,runToCompletion,staticEvents}=this.storageSettings.values,runActions=async(e,t,i)=>{const n=staticEvents?void 0:e.id+":"+t.eventInterface,r=this.pendings.get(n);if(this.console.log("automation trigger key",n),runToCompletion&&r)return void this.console.info("automation already in progress, trigger ignored",n);r&&(r.aborted=!0);const s={aborted:!1};this.pendings.set(n,s);try{for(const r of this.data.actions){if(s.aborted)return void this.console.log("automation aborted",n);const o=r.id.split("#"),[a,c]=o;if("scriptable"===a){const n=new javascript_1.AutomationJavascript(this,e,t,i);await n.run(r.model["script.ts"])}else if("shell-scriptable"===a){const n=new shellscript_1.AutomationShellScript(this,e,t,i);await n.run(r.model["script.sh"])}else if("timer"===a)await new Promise((e=>setTimeout(e,1e3*r.model.seconds)));else if("update-plugins"===a){const e=await systemManager.getComponent("plugins");await e.updatePlugins()}else{const e=systemManager.getDeviceById(a);if(!e)throw new Error(`unknown device ${a}`);const t=automation_actions_1.automationActions.get(c);if(!t)throw new Error(`unknown action ${c}`);t.invoke(e,r.model).catch((e=>this.console.error("automation aciton failed",r.model,e)))}}}finally{s.aborted||this.pendings.delete(n)}};for(const trigger of this.data.triggers){const parts=trigger.id.split("#"),id=parts[0],event=parts[1],{condition}=trigger;let register,listen;if(event){const e=systemManager.getDeviceById(id);listen=e}else{let e;if("scheduler"!==id)throw new Error(`unknown action ${trigger.id}`);e=new scheduler_1.Scheduler,listen=e.schedule(trigger.model)}register=listen.listen({denoise:denoiseEvents,event},((eventSource,eventDetails,eventData)=>{if(this.log.i(`automation triggered by ${eventSource.name}`),condition){const f=eval(`(function(eventSource, eventDetails, eventData) {\n                            return ${condition};\n                        })`);if(!f(eventSource,eventDetails,eventData))return void this.log.i("condition check false, not starting automation")}console.log("starting automation"),runActions(eventSource,eventDetails,eventData)}),this),this.registers.push(register)}}catch(e){console.error("automation load error",e)}}else this.log.i("automation is turned off, and will not be scheduled.")}}exports.Automation=Automation},5132:(e,t,i)=>{"use strict";var n=i(9714);const r={identify:e=>"boolean"==typeof e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:e=>new n.Scalar("t"===e[0]||"T"===e[0]),stringify({source:e,value:t},i){if(e&&r.test.test(e)){if(t===("t"===e[0]||"T"===e[0]))return e}return t?i.options.trueStr:i.options.falseStr}};t.boolTag=r},5139:(e,t,i)=>{"use strict";var n=i(7444),r=i(3793),s=i(484),o=i(9714),a=i(3732);const c=e=>"<<"===e||s.isScalar(e)&&"<<"===e.value&&(!e.type||e.type===o.Scalar.PLAIN);function l(e,t,i){const n=e&&s.isAlias(i)?i.resolve(e.doc):i;if(!s.isMap(n))throw new Error("Merge sources must be maps or map aliases");const r=n.toJSON(null,e,Map);for(const[e,i]of r)t instanceof Map?t.has(e)||t.set(e,i):t instanceof Set?t.add(e):Object.prototype.hasOwnProperty.call(t,e)||Object.defineProperty(t,e,{value:i,writable:!0,enumerable:!0,configurable:!0});return t}t.addPairToJSMap=function(e,t,{key:i,value:o}){if(e?.doc.schema.merge&&c(i))if(o=s.isAlias(o)?o.resolve(e.doc):o,s.isSeq(o))for(const i of o.items)l(e,t,i);else if(Array.isArray(o))for(const i of o)l(e,t,i);else l(e,t,o);else{const c=a.toJS(i,"",e);if(t instanceof Map)t.set(c,a.toJS(o,c,e));else if(t instanceof Set)t.add(c);else{const l=function(e,t,i){if(null===t)return"";if("object"!=typeof t)return String(t);if(s.isNode(e)&&i?.doc){const t=r.createStringifyContext(i.doc,{});t.anchors=new Set;for(const e of i.anchors.keys())t.anchors.add(e.anchor);t.inFlow=!0,t.inStringifyKey=!0;const s=e.toString(t);if(!i.mapKeyWarned){let e=JSON.stringify(s);e.length>40&&(e=e.substring(0,36)+'..."'),n.warn(i.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${e}. Set mapAsMap: true to use object keys.`),i.mapKeyWarned=!0}return s}return JSON.stringify(t)}(i,c,e),p=a.toJS(o,l,e);l in t?Object.defineProperty(t,l,{value:p,writable:!0,enumerable:!0,configurable:!0}):t[l]=p}}return t}},5141:(e,t,i)=>{"use strict";var n=i(4070),r=i(7571),s=i(4355),o=i(7180);function a(e,t){if(t)for(const i of t)switch(i.type){case"space":case"comment":e.push(i);break;case"newline":return e.push(i),!0}return!1}function c(e,t,i){switch(e.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":e.type=i,e.source=t;break;case"block-scalar":{const n=e.props.slice(1);let r=t.length;"block-scalar-header"===e.props[0].type&&(r-=e.props[0].source.length);for(const e of n)e.offset+=r;delete e.props,Object.assign(e,{type:i,source:t,end:n});break}case"block-map":case"block-seq":{const n={type:"newline",offset:e.offset+t.length,indent:e.indent,source:"\n"};delete e.items,Object.assign(e,{type:i,source:t,end:[n]});break}default:{const n="indent"in e?e.indent:-1,r="end"in e&&Array.isArray(e.end)?e.end.filter((e=>"space"===e.type||"comment"===e.type||"newline"===e.type)):[];for(const t of Object.keys(e))"type"!==t&&"offset"!==t&&delete e[t];Object.assign(e,{type:i,indent:n,source:t,end:r})}}}t.createScalarToken=function(e,t){const{implicitKey:i=!1,indent:n,inFlow:r=!1,offset:s=-1,type:c="PLAIN"}=t,l=o.stringifyString({type:c,value:e},{implicitKey:i,indent:n>0?" ".repeat(n):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}}),p=t.end??[{type:"newline",offset:-1,indent:n,source:"\n"}];switch(l[0]){case"|":case">":{const e=l.indexOf("\n"),t=l.substring(0,e),i=l.substring(e+1)+"\n",r=[{type:"block-scalar-header",offset:s,indent:n,source:t}];return a(r,p)||r.push({type:"newline",offset:-1,indent:n,source:"\n"}),{type:"block-scalar",offset:s,indent:n,props:r,source:i}}case'"':return{type:"double-quoted-scalar",offset:s,indent:n,source:l,end:p};case"'":return{type:"single-quoted-scalar",offset:s,indent:n,source:l,end:p};default:return{type:"scalar",offset:s,indent:n,source:l,end:p}}},t.resolveAsScalar=function(e,t=!0,i){if(e){const o=(e,t,n)=>{const r="number"==typeof e?e:Array.isArray(e)?e[0]:e.offset;if(!i)throw new s.YAMLParseError([r,r+1],t,n);i(r,t,n)};switch(e.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return r.resolveFlowScalar(e,t,o);case"block-scalar":return n.resolveBlockScalar({options:{strict:t}},e,o)}}return null},t.setScalarValue=function(e,t,i={}){let{afterKey:n=!1,implicitKey:r=!1,inFlow:s=!1,type:l}=i,p="indent"in e?e.indent:null;if(n&&"number"==typeof p&&(p+=2),!l)switch(e.type){case"single-quoted-scalar":l="QUOTE_SINGLE";break;case"double-quoted-scalar":l="QUOTE_DOUBLE";break;case"block-scalar":{const t=e.props[0];if("block-scalar-header"!==t.type)throw new Error("Invalid block scalar header");l=">"===t.source[0]?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:l="PLAIN"}const d=o.stringifyString({type:l,value:t},{implicitKey:r||null===p,indent:null!==p&&p>0?" ".repeat(p):"",inFlow:s,options:{blockQuote:!0,lineWidth:-1}});switch(d[0]){case"|":case">":!function(e,t){const i=t.indexOf("\n"),n=t.substring(0,i),r=t.substring(i+1)+"\n";if("block-scalar"===e.type){const t=e.props[0];if("block-scalar-header"!==t.type)throw new Error("Invalid block scalar header");t.source=n,e.source=r}else{const{offset:t}=e,i="indent"in e?e.indent:-1,s=[{type:"block-scalar-header",offset:t,indent:i,source:n}];a(s,"end"in e?e.end:void 0)||s.push({type:"newline",offset:-1,indent:i,source:"\n"});for(const t of Object.keys(e))"type"!==t&&"offset"!==t&&delete e[t];Object.assign(e,{type:"block-scalar",indent:i,props:s,source:r})}}(e,d);break;case'"':c(e,d,"double-quoted-scalar");break;case"'":c(e,d,"single-quoted-scalar");break;default:c(e,d,"scalar")}}},5219:(e,t,i)=>{"use strict";var n=i(1736),r=i(484),s=i(9714);t.createNode=function(e,t,i){if(r.isDocument(e)&&(e=e.contents),r.isNode(e))return e;if(r.isPair(e)){const t=i.schema[r.MAP].createNode?.(i.schema,null,i);return t.items.push(e),t}(e instanceof String||e instanceof Number||e instanceof Boolean||"undefined"!=typeof BigInt&&e instanceof BigInt)&&(e=e.valueOf());const{aliasDuplicateObjects:o,onAnchor:a,onTagObj:c,schema:l,sourceObjects:p}=i;let d;if(o&&e&&"object"==typeof e){if(d=p.get(e),d)return d.anchor||(d.anchor=a(e)),new n.Alias(d.anchor);d={anchor:null,node:null},p.set(e,d)}t?.startsWith("!!")&&(t="tag:yaml.org,2002:"+t.slice(2));let u=function(e,t,i){if(t){const e=i.filter((e=>e.tag===t)),n=e.find((e=>!e.format))??e[0];if(!n)throw new Error(`Tag ${t} not found`);return n}return i.find((t=>t.identify?.(e)&&!t.format))}(e,t,l.tags);if(!u){if(e&&"function"==typeof e.toJSON&&(e=e.toJSON()),!e||"object"!=typeof e){const t=new s.Scalar(e);return d&&(d.node=t),t}u=e instanceof Map?l[r.MAP]:Symbol.iterator in Object(e)?l[r.SEQ]:l[r.MAP]}c&&(c(u),delete i.onTagObj);const m=u?.createNode?u.createNode(i.schema,e,i):"function"==typeof u?.nodeClass?.from?u.nodeClass.from(i.schema,e,i):new s.Scalar(e);return t?m.tag=t:u.default||(m.tag=u.tag),d&&(d.node=m),m}},5302:e=>{e.exports=function e(i,n,r){n=n||[];var s,o=(r=r||{}).strict,a=!1!==r.end,c=r.sensitive?"":"i",l=0,p=n.length,d=0,u=0;if(i instanceof RegExp){for(;s=t.exec(i.source);)n.push({name:u++,optional:!1,offset:s.index});return i}if(Array.isArray(i))return i=i.map((function(t){return e(t,n,r).source})),new RegExp("(?:"+i.join("|")+")",c);i=("^"+i+(o?"":"/"===i[i.length-1]?"?":"/?")).replace(/\/\(/g,"/(?:").replace(/([\/\.])/g,"\\$1").replace(/(\\\/)?(\\\.)?:(\w+)(\(.*?\))?(\*)?(\?)?/g,(function(e,t,i,r,s,o,a,c){t=t||"",i=i||"",s=s||"([^\\/"+i+"]+?)",a=a||"",n.push({name:r,optional:!!a,offset:c+l});var p=(a?"":t)+"(?:"+i+(a?t:"")+s+(o?"((?:[\\/"+i+"].+?)?)":"")+")"+a;return l+=p.length-e.length,p})).replace(/\*/g,(function(e,t){for(var i=n.length;i-- >p&&n[i].offset>t;)n[i].offset+=3;return"(.*)"}));for(;s=t.exec(i);){for(var m=0,f=s.index;"\\"===i.charAt(--f);)m++;m%2!=1&&((p+d===n.length||n[p+d].offset>s.index)&&n.splice(p+d,0,{name:u++,optional:!1,offset:s.index}),d++)}return i+=a?"$":"/"===i[i.length-1]?"":"(?=\\/|$)",new RegExp(i,c)};var t=/\((?!\?)/g},5317:e=>{"use strict";e.exports=require("child_process")},5387:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scryptedEval=async function(e,t,i){return(0,n.scryptedEval)(e,t,{},i)};const n=i(6593)},5437:(e,t,i)=>{"use strict";var n=i(3144);function r(e,t){const i=e[0],n="-"===i||"+"===i?e.substring(1):e,r=e=>t?BigInt(e):Number(e),s=n.replace(/_/g,"").split(":").reduce(((e,t)=>e*r(60)+r(t)),r(0));return"-"===i?r(-1)*s:s}function s(e){let{value:t}=e,i=e=>e;if("bigint"==typeof t)i=e=>BigInt(e);else if(isNaN(t)||!isFinite(t))return n.stringifyNumber(e);let r="";t<0&&(r="-",t*=i(-1));const s=i(60),o=[t%s];return t<60?o.unshift(0):(t=(t-o[0])/s,o.unshift(t%s),t>=60&&(t=(t-o[0])/s,o.unshift(t))),r+o.map((e=>String(e).padStart(2,"0"))).join(":").replace(/000000\d*$/,"")}const o={identify:e=>"bigint"==typeof e||Number.isInteger(e),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(e,t,{intAsBigInt:i})=>r(e,i),stringify:s},a={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:e=>r(e,!1),stringify:s},c={identify:e=>e instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(e){const t=e.match(c.test);if(!t)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,i,n,s,o,a,l]=t.map(Number),p=t[7]?Number((t[7]+"00").substr(1,3)):0;let d=Date.UTC(i,n-1,s,o||0,a||0,l||0,p);const u=t[8];if(u&&"Z"!==u){let e=r(u,!1);Math.abs(e)<30&&(e*=60),d-=6e4*e}return new Date(d)},stringify:({value:e})=>e.toISOString().replace(/((T00:00)?:00)?\.000Z$/,"")};t.floatTime=a,t.intTime=o,t.timestamp=c},5597:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createAsyncQueue=s,t.createAsyncQueueFromGenerator=function(e){const t=s();return(async()=>{try{for await(const i of e)await t.enqueue(i)}catch(e){t.end(e)}t.end()})(),t};const n=i(3290);class r extends Error{}function s(){let e;const t=new n.Deferred,i=[],s=[],o=async()=>{if(s.length){const{item:e,dequeued:t}=s.shift();return t?.resolve(),e}if(e)throw e;const t=new n.Deferred;return i.push(t),t.promise},a=(t,r,o)=>{if(e)return!1;if(i.length){const e=i.shift();return r?.resolve(),e.resolve(t),!0}o&&(r||=new n.Deferred);const a={item:t,dequeued:r};if(s.push(a),!o)return!0;const c=()=>{const e=s.indexOf(a);-1!==e&&(s.splice(e,1),r?.reject(new Error("abort")))};return r?.promise.catch((()=>{})).finally((()=>o.removeEventListener("abort",c))),o.addEventListener("abort",c),!0};function c(n){if(e)return!1;for(e=n||new r,t.resolve();i.length;)i.shift().reject(e);return!0}function l(){return async function*(){try{for(;;)try{const e=await o();yield e}catch(e){if(c(e),e instanceof r)return;throw e}}finally{c()}}()}return{[Symbol.dispose](){c(new Error("async queue disposed"))},get ended(){return e},endPromise:t.promise,take:()=>{if(s.length){const{item:e,dequeued:t}=s.shift();return t?.resolve(),e}if(e)throw e},clear:()=>function(e){const t=[],i=s.splice(0,s.length);for(const n of i)e?n.dequeued?.reject(e):n.dequeued?.resolve(void 0),t.push(n.item);return t}(),queued:s,async pipe(e){for await(const t of l())e(t)},submit:(e,t)=>a(e,void 0,t),end:c,async enqueue(e,t){const i=new n.Deferred;return!!a(e,i,t)&&(await i.promise,!0)},dequeue:o,get queue(){return l()},wait:async e=>{const t=s[e];if(t)return t.dequeued||(t.dequeued=new n.Deferred),t.dequeued.promise}}}},5752:(e,t,i)=>{"use strict";var n=i(9112);function r(e){switch(e){case void 0:case" ":case"\n":case"\r":case"\t":return!0;default:return!1}}const s=new Set("0123456789ABCDEFabcdef"),o=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),a=new Set(",[]{}"),c=new Set(" ,[]{}\n\r\t"),l=e=>!e||c.has(e);t.Lexer=class{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){if(e){if("string"!=typeof e)throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!t;let i=this.next??"stream";for(;i&&(t||this.hasChars(1));)i=yield*this.parseNext(i)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;" "===t||"\t"===t;)t=this.buffer[++e];return!t||"#"===t||"\n"===t||"\r"===t&&"\n"===this.buffer[e+1]}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let i=0;for(;" "===t;)t=this.buffer[++i+e];if("\r"===t){const t=this.buffer[i+e+1];if("\n"===t||!t&&!this.atEnd)return e+i+1}return"\n"===t||i>=this.indentNext||!t&&!this.atEnd?e+i:-1}if("-"===t||"."===t){const t=this.buffer.substr(e,3);if(("---"===t||"..."===t)&&r(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return("number"!=typeof e||-1!==e&&e<this.pos)&&(e=this.buffer.indexOf("\n",this.pos),this.lineEndPos=e),-1===e?this.atEnd?this.buffer.substring(this.pos):null:("\r"===this.buffer[e-1]&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(null===e)return this.setNext("stream");if(e[0]===n.BOM&&(yield*this.pushCount(1),e=e.substring(1)),"%"===e[0]){let t=e.length,i=e.indexOf("#");for(;-1!==i;){const n=e[i-1];if(" "===n||"\t"===n){t=i-1;break}i=e.indexOf("#",i+1)}for(;;){const i=e[t-1];if(" "!==i&&"\t"!==i)break;t-=1}const n=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-n),this.pushNewline(),"stream"}if(this.atLineEnd()){const t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield n.DOCUMENT,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if("-"===e||"."===e){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const e=this.peek(3);if(("---"===e||"..."===e)&&r(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,"---"===e?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!r(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if(("-"===e||"?"===e||":"===e)&&r(t)){const e=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=e,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(null===e)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(l),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=(yield*this.parseBlockScalarHeader()),t+=(yield*this.pushSpaces(!0)),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,i=-1;do{e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=i=t):t=0,t+=(yield*this.pushSpaces(!0))}while(e+t>0);const s=this.getLine();if(null===s)return this.setNext("flow");if(-1!==i&&i<this.indentNext&&"#"!==s[0]||0===i&&(s.startsWith("---")||s.startsWith("..."))&&r(s[3])){if(!(i===this.indentNext-1&&1===this.flowLevel&&("]"===s[0]||"}"===s[0])))return this.flowLevel=0,yield n.FLOW_END,yield*this.parseLineStart()}let o=0;for(;","===s[o];)o+=(yield*this.pushCount(1)),o+=(yield*this.pushSpaces(!0)),this.flowKey=!1;switch(o+=(yield*this.pushIndicators()),s[o]){case void 0:return"flow";case"#":return yield*this.pushCount(s.length-o),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(l),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const e=this.charAt(1);if(this.flowKey||r(e)||","===e)return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let t=this.buffer.indexOf(e,this.pos+1);if("'"===e)for(;-1!==t&&"'"===this.buffer[t+1];)t=this.buffer.indexOf("'",t+2);else for(;-1!==t;){let e=0;for(;"\\"===this.buffer[t-1-e];)e+=1;if(e%2==0)break;t=this.buffer.indexOf('"',t+1)}const i=this.buffer.substring(0,t);let n=i.indexOf("\n",this.pos);if(-1!==n){for(;-1!==n;){const e=this.continueScalar(n+1);if(-1===e)break;n=i.indexOf("\n",e)}-1!==n&&(t=n-("\r"===i[n-1]?2:1))}if(-1===t){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const t=this.buffer[++e];if("+"===t)this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if("-"!==t)break}return yield*this.pushUntil((e=>r(e)||"#"===e))}*parseBlockScalar(){let e,t=this.pos-1,i=0;e:for(let n=this.pos;e=this.buffer[n];++n)switch(e){case" ":i+=1;break;case"\n":t=n,i=0;break;case"\r":{const e=this.buffer[n+1];if(!e&&!this.atEnd)return this.setNext("block-scalar");if("\n"===e)break}default:break e}if(!e&&!this.atEnd)return this.setNext("block-scalar");if(i>=this.indentNext){-1===this.blockScalarIndent?this.indentNext=i:this.indentNext=this.blockScalarIndent+(0===this.indentNext?1:this.indentNext);do{const e=this.continueScalar(t+1);if(-1===e)break;t=this.buffer.indexOf("\n",e)}while(-1!==t);if(-1===t){if(!this.atEnd)return this.setNext("block-scalar");t=this.buffer.length}}let r=t+1;for(e=this.buffer[r];" "===e;)e=this.buffer[++r];if("\t"===e){for(;"\t"===e||" "===e||"\r"===e||"\n"===e;)e=this.buffer[++r];t=r-1}else if(!this.blockScalarKeep)for(;;){let e=t-1,n=this.buffer[e];"\r"===n&&(n=this.buffer[--e]);const r=e;for(;" "===n;)n=this.buffer[--e];if(!("\n"===n&&e>=this.pos&&e+1+i>r))break;t=e}return yield n.SCALAR,yield*this.pushToIndex(t+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let t,i=this.pos-1,s=this.pos-1;for(;t=this.buffer[++s];)if(":"===t){const t=this.buffer[s+1];if(r(t)||e&&a.has(t))break;i=s}else if(r(t)){let n=this.buffer[s+1];if("\r"===t&&("\n"===n?(s+=1,t="\n",n=this.buffer[s+1]):i=s),"#"===n||e&&a.has(n))break;if("\n"===t){const e=this.continueScalar(s+1);if(-1===e)break;s=Math.max(s,e-2)}}else{if(e&&a.has(t))break;i=s}return t||this.atEnd?(yield n.SCALAR,yield*this.pushToIndex(i+1,!0),e?"flow":"doc"):this.setNext("plain-scalar")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){const i=this.buffer.slice(this.pos,e);return i?(yield i,this.pos+=i.length,i.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(l))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,t=this.charAt(1);if(r(t)||e&&a.has(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if("<"===this.charAt(1)){let e=this.pos+2,t=this.buffer[e];for(;!r(t)&&">"!==t;)t=this.buffer[++e];return yield*this.pushToIndex(">"===t?e+1:e,!1)}{let e=this.pos+1,t=this.buffer[e];for(;t;)if(o.has(t))t=this.buffer[++e];else{if("%"!==t||!s.has(this.buffer[e+1])||!s.has(this.buffer[e+2]))break;t=this.buffer[e+=3]}return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return"\n"===e?yield*this.pushCount(1):"\r"===e&&"\n"===this.charAt(1)?yield*this.pushCount(2):0}*pushSpaces(e){let t,i=this.pos-1;do{t=this.buffer[++i]}while(" "===t||e&&"\t"===t);const n=i-this.pos;return n>0&&(yield this.buffer.substr(this.pos,n),this.pos=i),n}*pushUntil(e){let t=this.pos,i=this.buffer[t];for(;!e(i);)i=this.buffer[++t];return yield*this.pushToIndex(t,!1)}}},5822:(e,t,i)=>{"use strict";var n=i(3334),r=i(6055),s=i(1919),o=i(8531),a=i(8080),c=i(7969),l=i(7191),p=i(6936),d=i(692),u=i(8416),m=i(2557),f=i(5437);const h=[n.map,s.seq,o.string,r.nullTag,c.trueTag,c.falseTag,p.intBin,p.intOct,p.int,p.intHex,l.floatNaN,l.floatExp,l.float,a.binary,d.omap,u.pairs,m.set,f.intTime,f.floatTime,f.timestamp];t.schema=h},5957:function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.UsersCore=t.User=t.UsersNativeId=void 0;const a=o(i(2743)),c=i(239),l=i(1414);t.UsersNativeId="users";class p extends a.ScryptedDeviceBase{storageSettings=new l.StorageSettings(this,{defaultAccess:{title:"Default Access",description:"Grant access to @scrypted/core and @scrypted/webrtc",defaultValue:!0,type:"boolean"},admin:{title:"Administrator",mapGet:()=>'<div style="font-size: .8rem; margin-bottom: 16px; margin-left: 8px;">This user has administrator access.</div>',type:"html",hide:!0},interfaces:{title:"Interfaces",description:"The interfaces this user can access. Admin users can access all interfaces on all devices. Scrypted NVR users should use NVR Permissions to grant access to the NVR and associated cameras.",type:"interface",multiple:!0,defaultValue:[]}});_admin;async getAdmin(){if(void 0!==this._admin)return this._admin;const e=await a.default.systemManager.getComponent("users"),t=(await e.getAllUsers()).find((e=>e.username===this.username));if(!t)throw new Error("user not found");return this._admin=!!t.admin,this._admin&&(this.storageSettings.settings.defaultAccess.hide=!0,this.storageSettings.settings.interfaces.hide=!0,this.storageSettings.settings.admin.hide=!1),this._admin}async getScryptedUserAccessControl(){if(await this.getAdmin())return;const e=a.default.deviceManager.getDeviceState(this.nativeId);return{devicesAccessControls:[...this.storageSettings.values.defaultAccess?[(0,c.addAccessControlsForInterface)(e.id,a.ScryptedInterface.ScryptedDevice),(0,c.addAccessControlsForInterface)(a.default.systemManager.getDeviceByName("@scrypted/webrtc").id,a.ScryptedInterface.ScryptedDevice,a.ScryptedInterface.EngineIOHandler),(0,c.addAccessControlsForInterface)(a.default.systemManager.getDeviceByName("@scrypted/core").id,a.ScryptedInterface.ScryptedDevice,a.ScryptedInterface.EngineIOHandler)]:[],...this.storageSettings.values.interfaces.map((e=>{const[t,i]=e.split("#");return(0,c.addAccessControlsForInterface)(t,a.ScryptedInterface.ScryptedDevice,i)}))]}}get username(){return this.nativeId.substring(5)}async getSettings(){return await this.getAdmin(),[{key:"username",title:"User Name",readonly:!0,value:this.username},{key:"password",title:"Password",description:"Change the password.",type:"password"},...await this.storageSettings.getSettings()]}async putSetting(e,i){if("password"!==e)return this.storageSettings.putSetting(e,i);const n=await a.default.systemManager.getComponent("users"),r=(await n.getAllUsers()).find((e=>e.username===this.username));if(!r)return;const{username:s,admin:o}=r,c=`user:${s}`,l=await a.default.deviceManager.onDeviceDiscovered({providerNativeId:t.UsersNativeId,name:s.toString(),nativeId:c,interfaces:[a.ScryptedInterface.ScryptedUser,a.ScryptedInterface.Settings],type:a.ScryptedDeviceType.Person});await n.addUser(r.username,i.toString(),o?void 0:l)}}t.User=p;class d extends a.ScryptedDeviceBase{constructor(){super(t.UsersNativeId),this.systemDevice={deviceCreator:"Scrypted User"},this.syncUsers().then((e=>{e||(this.console.log("no users found, looping for first user"),setInterval((()=>this.syncUsers()),6e4))}))}async getDevice(e){return new p(e)}async releaseDevice(e,t){const i=t.substring(5),n=await a.default.systemManager.getComponent("users");await n.removeUser(i)}async getCreateDeviceSettings(){return[{key:"username",title:"User name"},{key:"password",type:"password",title:"Password"},{key:"admin",type:"boolean",title:"Admin",description:"Grant this user administrator privileges."}]}async createDevice(e){const{username:t,password:i,admin:n}=e,r=await a.default.systemManager.getComponent("users"),s=`user:${t}`,o=await a.default.deviceManager.onDeviceDiscovered({providerNativeId:this.nativeId,name:t.toString(),nativeId:s,interfaces:[a.ScryptedInterface.ScryptedUser,a.ScryptedInterface.Settings],type:a.ScryptedDeviceType.Person});return await r.addUser(t,i,n?void 0:o),await this.syncUsers(),s}async getReadmeMarkdown(){return"Create and Manage the users that can log into Scrypted."}async syncUsers(){const e=await a.default.systemManager.getComponent("users"),t=await e.getAllUsers(),i={providerNativeId:this.nativeId,devices:t.map((e=>({name:e.username,nativeId:`user:${e.username}`,interfaces:[a.ScryptedInterface.ScryptedUser,a.ScryptedInterface.Settings],type:a.ScryptedDeviceType.Person})))},n=new Set(i.devices.map((e=>e.nativeId)));for(const e of a.default.deviceManager.getNativeIds())n.delete(e);return n.size&&await a.default.deviceManager.onDevicesChanged(i),i.devices.length}}t.UsersCore=d},5970:(e,t)=>{"use strict";const i=Symbol("break visit"),n=Symbol("skip children"),r=Symbol("remove item");function s(e,t){"type"in e&&"document"===e.type&&(e={start:e.start,value:e.value}),o(Object.freeze([]),e,t)}function o(e,t,n){let s=n(t,e);if("symbol"==typeof s)return s;for(const a of["key","value"]){const c=t[a];if(c&&"items"in c){for(let t=0;t<c.items.length;++t){const s=o(Object.freeze(e.concat([[a,t]])),c.items[t],n);if("number"==typeof s)t=s-1;else{if(s===i)return i;s===r&&(c.items.splice(t,1),t-=1)}}"function"==typeof s&&"key"===a&&(s=s(t,e))}}return"function"==typeof s?s(t,e):s}s.BREAK=i,s.SKIP=n,s.REMOVE=r,s.itemAtPath=(e,t)=>{let i=e;for(const[e,n]of t){const t=i?.[e];if(!t||!("items"in t))return;i=t.items[n]}return i},s.parentCollection=(e,t)=>{const i=s.itemAtPath(e,t.slice(0,-1)),n=t[t.length-1][0],r=i?.[n];if(r&&"items"in r)return r;throw new Error("Parent collection not found")},t.visit=s},6010:(e,t,i)=>{"use strict";var n=i(5219),r=i(81),s=i(1614),o=i(484),a=i(9714),c=i(3732);class l extends s.Collection{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(o.SEQ,e),this.items=[]}add(e){this.items.push(e)}delete(e){const t=p(e);if("number"!=typeof t)return!1;return this.items.splice(t,1).length>0}get(e,t){const i=p(e);if("number"!=typeof i)return;const n=this.items[i];return!t&&o.isScalar(n)?n.value:n}has(e){const t=p(e);return"number"==typeof t&&t<this.items.length}set(e,t){const i=p(e);if("number"!=typeof i)throw new Error(`Expected a valid index, not ${e}.`);const n=this.items[i];o.isScalar(n)&&a.isScalarValue(t)?n.value=t:this.items[i]=t}toJSON(e,t){const i=[];t?.onCreate&&t.onCreate(i);let n=0;for(const e of this.items)i.push(c.toJS(e,String(n++),t));return i}toString(e,t,i){return e?r.stringifyCollection(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:i,onComment:t}):JSON.stringify(this)}static from(e,t,i){const{replacer:r}=i,s=new this(e);if(t&&Symbol.iterator in Object(t)){let e=0;for(let o of t){if("function"==typeof r){const i=t instanceof Set?o:String(e++);o=r.call(t,i,o)}s.items.push(n.createNode(o,void 0,i))}}return s}}function p(e){let t=o.isScalar(e)?e.value:e;return t&&"string"==typeof t&&(t=Number(t)),"number"==typeof t&&Number.isInteger(t)&&t>=0?t:null}t.YAMLSeq=l},6055:(e,t,i)=>{"use strict";var n=i(9714);const r={identify:e=>null==e,createNode:()=>new n.Scalar(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new n.Scalar(null),stringify:({source:e},t)=>"string"==typeof e&&r.test.test(e)?e:t.options.nullStr};t.nullTag=r},6080:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AutomationShellScript=void 0;const r=n(i(5317));t.AutomationShellScript=class{automation;eventSource;eventDetails;eventData;log;constructor(e,t,i,n){this.automation=e,this.eventSource=t,this.eventDetails=i,this.eventData=n}async run(e){const t=r.default.spawn("sh",{env:{EVENT_DATA:this.eventData?.toString()}});t.stdin.write(e),t.stdin.end(),t.stdout.on("data",(e=>this.automation.console.log(e.toString()))),t.stderr.on("data",(e=>this.automation.console.log(e.toString()))),t.on("exit",(()=>this.automation.console.log("shell exited")))}}},6170:(e,t)=>{"use strict";const i="block",n="quoted";function r(e,t,i){let n=t,r=t+1,s=e[r];for(;" "===s||"\t"===s;)if(t<r+i)s=e[++t];else{do{s=e[++t]}while(s&&"\n"!==s);n=t,r=t+1,s=e[r]}return n}t.FOLD_BLOCK=i,t.FOLD_FLOW="flow",t.FOLD_QUOTED=n,t.foldFlowLines=function(e,t,s="flow",{indentAtStart:o,lineWidth:a=80,minContentWidth:c=20,onFold:l,onOverflow:p}={}){if(!a||a<0)return e;a<c&&(c=0);const d=Math.max(1+c,1+a-t.length);if(e.length<=d)return e;const u=[],m={};let f,h,g=a-t.length;"number"==typeof o&&(o>a-Math.max(2,c)?u.push(0):g=a-o);let v=!1,y=-1,S=-1,b=-1;s===i&&(y=r(e,y,t.length),-1!==y&&(g=y+d));for(let o;o=e[y+=1];){if(s===n&&"\\"===o){switch(S=y,e[y+1]){case"x":y+=3;break;case"u":y+=5;break;case"U":y+=9;break;default:y+=1}b=y}if("\n"===o)s===i&&(y=r(e,y,t.length)),g=y+t.length+d,f=void 0;else{if(" "===o&&h&&" "!==h&&"\n"!==h&&"\t"!==h){const t=e[y+1];t&&" "!==t&&"\n"!==t&&"\t"!==t&&(f=y)}if(y>=g)if(f)u.push(f),g=f+d,f=void 0;else if(s===n){for(;" "===h||"\t"===h;)h=o,o=e[y+=1],v=!0;const t=y>b+1?y-2:S-1;if(m[t])return e;u.push(t),m[t]=!0,g=t+d,f=void 0}else v=!0}h=o}if(v&&p&&p(),0===u.length)return e;l&&l();let x=e.slice(0,u[0]);for(let i=0;i<u.length;++i){const r=u[i],o=u[i+1]||e.length;0===r?x=`\n${t}${e.slice(0,o)}`:(s===n&&m[r]&&(x+=`${e[r]}\\`),x+=`\n${t}${e.slice(r+1,o)}`)}return x}},6247:(e,t,i)=>{"use strict";var n=i(9112),r=i(5752);function s(e,t){for(let i=0;i<e.length;++i)if(e[i].type===t)return!0;return!1}function o(e){for(let t=0;t<e.length;++t)switch(e[t].type){case"space":case"comment":case"newline":break;default:return t}return-1}function a(e){switch(e?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function c(e){switch(e.type){case"document":return e.start;case"block-map":{const t=e.items[e.items.length-1];return t.sep??t.start}case"block-seq":return e.items[e.items.length-1].start;default:return[]}}function l(e){if(0===e.length)return[];let t=e.length;e:for(;--t>=0;)switch(e[t].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;"space"===e[++t]?.type;);return e.splice(t,e.length)}function p(e){if("flow-seq-start"===e.start.type)for(const t of e.items)!t.sep||t.value||s(t.start,"explicit-key-ind")||s(t.sep,"map-value-ind")||(t.key&&(t.value=t.key),delete t.key,a(t.value)?t.value.end?Array.prototype.push.apply(t.value.end,t.sep):t.value.end=t.sep:Array.prototype.push.apply(t.start,t.sep),delete t.sep)}t.Parser=class{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new r.Lexer,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&0===this.offset&&this.onNewLine(0);for(const i of this.lexer.lex(e,t))yield*this.next(i);t||(yield*this.end())}*next(e){if(this.source=e,process.env.LOG_TOKENS&&console.log("|",n.prettyToken(e)),this.atScalar)return this.atScalar=!1,yield*this.step(),void(this.offset+=e.length);const t=n.tokenType(e);if(t)if("scalar"===t)this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&" "===e[0]&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const t=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:t,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if("doc-end"!==this.type||e&&"doc-end"===e.type){if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}else{for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source})}}peek(e){return this.stack[this.stack.length-e]}*pop(e){const t=e??this.stack.pop();if(t)if(0===this.stack.length)yield t;else{const e=this.peek(1);switch("block-scalar"===t.type?t.indent="indent"in e?e.indent:0:"flow-collection"===t.type&&"document"===e.type&&(t.indent=0),"flow-collection"===t.type&&p(t),e.type){case"document":e.value=t;break;case"block-scalar":e.props.push(t);break;case"block-map":{const i=e.items[e.items.length-1];if(i.value)return e.items.push({start:[],key:t,sep:[]}),void(this.onKeyLine=!0);if(!i.sep)return Object.assign(i,{key:t,sep:[]}),void(this.onKeyLine=!i.explicitKey);i.value=t;break}case"block-seq":{const i=e.items[e.items.length-1];i.value?e.items.push({start:[],value:t}):i.value=t;break}case"flow-collection":{const i=e.items[e.items.length-1];return void(!i||i.value?e.items.push({start:[],key:t,sep:[]}):i.sep?i.value=t:Object.assign(i,{key:t,sep:[]}))}default:yield*this.pop(),yield*this.pop(t)}if(!("document"!==e.type&&"block-map"!==e.type&&"block-seq"!==e.type||"block-map"!==t.type&&"block-seq"!==t.type)){const i=t.items[t.items.length-1];i&&!i.sep&&!i.value&&i.start.length>0&&-1===o(i.start)&&(0===t.indent||i.start.every((e=>"comment"!==e.type||e.indent<t.indent)))&&("document"===e.type?e.end=i.start:e.items.push({start:i.start}),t.items.splice(-1,1))}}else{const e="Tried to pop an empty stack";yield{type:"error",offset:this.offset,source:"",message:e}}}*stream(){switch(this.type){case"directive-line":return void(yield{type:"directive",offset:this.offset,source:this.source});case"byte-order-mark":case"space":case"comment":case"newline":return void(yield this.sourceToken);case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};return"doc-start"===this.type&&e.start.push(this.sourceToken),void this.stack.push(e)}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":return void(-1!==o(e.start)?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken));case"anchor":case"tag":case"space":case"comment":case"newline":return void e.start.push(this.sourceToken)}const t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if("map-value-ind"===this.type){const t=l(c(this.peek(2)));let i;e.end?(i=e.end,i.push(this.sourceToken),delete e.end):i=[this.sourceToken];const n={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:t,key:e,sep:i}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=n}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":return void e.props.push(this.sourceToken);case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let e=this.source.indexOf("\n")+1;for(;0!==e;)this.onNewLine(this.offset+e),e=this.source.indexOf("\n",e)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){const t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){const i="end"in t.value?t.value.end:void 0,n=Array.isArray(i)?i[i.length-1]:void 0;"comment"===n?.type?i?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){const i=e.items[e.items.length-2],n=i?.value?.end;if(Array.isArray(n))return Array.prototype.push.apply(n,t.start),n.push(this.sourceToken),void e.items.pop()}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const i=!this.onKeyLine&&this.indent===e.indent,n=i&&(t.sep||t.explicitKey)&&"seq-item-ind"!==this.type;let r=[];if(n&&t.sep&&!t.value){const i=[];for(let n=0;n<t.sep.length;++n){const r=t.sep[n];switch(r.type){case"newline":i.push(n);break;case"space":break;case"comment":r.indent>e.indent&&(i.length=0);break;default:i.length=0}}i.length>=2&&(r=t.sep.splice(i[1]))}switch(this.type){case"anchor":case"tag":return void(n||t.value?(r.push(this.sourceToken),e.items.push({start:r}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken));case"explicit-key-ind":return t.sep||t.explicitKey?n||t.value?(r.push(this.sourceToken),e.items.push({start:r,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}):(t.start.push(this.sourceToken),t.explicitKey=!0),void(this.onKeyLine=!0);case"map-value-ind":if(t.explicitKey)if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(s(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:r,key:null,sep:[this.sourceToken]}]});else if(a(t.key)&&!s(t.sep,"newline")){const e=l(t.start),i=t.key,n=t.sep;n.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:e,key:i,sep:n}]})}else r.length>0?t.sep=t.sep.concat(r,this.sourceToken):t.sep.push(this.sourceToken);else if(s(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{const e=l(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:e,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||n?e.items.push({start:r,key:null,sep:[this.sourceToken]}):s(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return void(this.onKeyLine=!0);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const i=this.flowScalar(this.type);return void(n||t.value?(e.items.push({start:r,key:i,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(i):(Object.assign(t,{key:i,sep:[]}),this.onKeyLine=!0))}default:{const t=this.startBlockValue(e);if(t)return i&&"block-seq"!==t.type&&e.items.push({start:r}),void this.stack.push(t)}}}yield*this.pop(),yield*this.step()}*blockSequence(e){const t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){const i="end"in t.value?t.value.end:void 0,n=Array.isArray(i)?i[i.length-1]:void 0;"comment"===n?.type?i?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){const i=e.items[e.items.length-2],n=i?.value?.end;if(Array.isArray(n))return Array.prototype.push.apply(n,t.start),n.push(this.sourceToken),void e.items.pop()}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;return void t.start.push(this.sourceToken);case"seq-item-ind":if(this.indent!==e.indent)break;return void(t.value||s(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken))}if(this.indent>e.indent){const t=this.startBlockValue(e);if(t)return void this.stack.push(t)}yield*this.pop(),yield*this.step()}*flowCollection(e){const t=e.items[e.items.length-1];if("flow-error-end"===this.type){let e;do{yield*this.pop(),e=this.peek(1)}while(e&&"flow-collection"===e.type)}else if(0===e.end.length){switch(this.type){case"comma":case"explicit-key-ind":return void(!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken));case"map-value-ind":return void(!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]}));case"space":case"comment":case"newline":case"anchor":case"tag":return void(!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken));case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const i=this.flowScalar(this.type);return void(!t||t.value?e.items.push({start:[],key:i,sep:[]}):t.sep?this.stack.push(i):Object.assign(t,{key:i,sep:[]}))}case"flow-map-end":case"flow-seq-end":return void e.end.push(this.sourceToken)}const i=this.startBlockValue(e);i?this.stack.push(i):(yield*this.pop(),yield*this.step())}else{const t=this.peek(2);if("block-map"===t.type&&("map-value-ind"===this.type&&t.indent===e.indent||"newline"===this.type&&!t.items[t.items.length-1].sep))yield*this.pop(),yield*this.step();else if("map-value-ind"===this.type&&"flow-collection"!==t.type){const i=l(c(t));p(e);const n=e.end.splice(1,e.end.length);n.push(this.sourceToken);const r={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:i,key:e,sep:n}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=r}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let e=this.source.indexOf("\n")+1;for(;0!==e;)this.onNewLine(this.offset+e),e=this.source.indexOf("\n",e)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const t=l(c(e));return t.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:t,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const t=l(c(e));return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:t,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return"comment"===this.type&&(!(this.indent<=t)&&e.every((e=>"newline"===e.type||"space"===e.type)))}*documentEnd(e){"doc-mode"!==this.type&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],"newline"===this.type&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],"newline"===this.type&&(yield*this.pop())}}}},6261:(e,t,i)=>{"use strict";var n=i(484),r=i(9125);function s(e){const t=new Set;return r.visit(e,{Value(e,i){i.anchor&&t.add(i.anchor)}}),t}function o(e,t){for(let i=1;;++i){const n=`${e}${i}`;if(!t.has(n))return n}}t.anchorIsValid=function(e){if(/[\x00-\x19\s,[\]{}]/.test(e)){const t=JSON.stringify(e);throw new Error(`Anchor must not contain whitespace or control characters: ${t}`)}return!0},t.anchorNames=s,t.createNodeAnchors=function(e,t){const i=[],r=new Map;let a=null;return{onAnchor:n=>{i.push(n),a||(a=s(e));const r=o(t,a);return a.add(r),r},setAnchors:()=>{for(const e of i){const t=r.get(e);if("object"!=typeof t||!t.anchor||!n.isScalar(t.node)&&!n.isCollection(t.node)){const t=new Error("Failed to resolve repeated object (this should not happen)");throw t.source=e,t}t.node.anchor=t.anchor}},sourceObjects:r}},t.findNewAnchor=o},6593:function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.tsCompile=async function(e,t=null){const n=i(7826),{ScriptTarget:r}=n;null===t&&(t={compilerOptions:{target:r.ESNext,module:n.ModuleKind.CommonJS}});return n.transpileModule(e,t).outputText},t.readFileAsString=y,t.scryptedEval=async function(e,t,i,n){const r=Object.assign({types:S()["@types/sdk/types.d.ts"]},i),s=Object.values(r).join("\n").toString()+t;let o;const a=c.default.fork();a.worker.on("error",(()=>{}));try{const e=await a.result;o=await e.tsCompile(s)}catch(t){throw e.log.e("Error compiling typescript."),e.console.error(t),t}finally{a.worker.terminate()}const d=Object.assign({},n,{sdk:c.default,ScryptedDeviceBase:c.ScryptedDeviceBase,MixinDeviceBase:c.MixinDeviceBase,StorageSettings:p.StorageSettings,systemManager:f,deviceManager:h,endpointManager:v,mediaManager:g,log:e.log,console:e.console,localStorage:e.storage,device:e,exports:{},PanTiltZoomMovement:c.PanTiltZoomMovement,SettingsMixinDeviceBase:l.SettingsMixinDeviceBase,ScryptedMimeTypes:c.ScryptedMimeTypes,ScryptedInterface:c.ScryptedInterface,ScryptedDeviceType:c.ScryptedDeviceType,require}),m=`return (async function() {\n${o}\n})`;let y;try{y=u.default.compileFunction(m,Object.keys(d),{filename:"script.js"})(...Object.values(d))}catch(t){throw e.log.e("Error evaluating javascript."),e.console.error(t),t}try{const e=await y();return{value:e,defaultExport:d.exports.default}}catch(t){throw e.log.e("Error running script."),e.console.error(t),t}},t.createMonacoEvalDefaults=function(e){const t={"@types/node/globals.d.ts":y("@types/node/globals.d.ts"),"@types/node/module.d.ts":y("@types/node/module.d.ts"),"@types/node/buffer.d.ts":y("@types/node/buffer.d.ts"),"@types/node/process.d.ts":y("@types/node/process.d.ts"),"@types/node/events.d.ts":y("@types/node/events.d.ts"),"@types/node/stream.d.ts":y("@types/node/stream.d.ts"),"@types/node/fs.d.ts":y("@types/node/fs.d.ts"),"@types/node/net.d.ts":y("@types/node/net.d.ts"),"@types/node/child_process.d.ts":y("@types/node/child_process.d.ts")};return(0,m.createMonacoEvalDefaultsWithLibs)(t,S(),e)},t.createScriptDevice=function(e){let t;const i=e.slice();return{handle:e=>{t=e},handleTypes:(...e)=>{i.push(...e)},mergeHandler:e=>{const n=t||{};let r;r=n.constructor===Object?Object.keys(n):Object.getOwnPropertyNames(n.__proto__);for(const t of r){const r=b.get(t);r&&(i.push(r),e[t]=n[t].bind(n))}return i}}};const c=o(i(2743)),l=i(166),p=i(1414),d=a(i(9896)),u=a(i(9154)),m=i(8472),{systemManager:f,deviceManager:h,mediaManager:g,endpointManager:v}=c.default;function y(e){return d.default.readFileSync(e).toString()}function S(){return{"@types/sdk/index.d.ts":y("@types/sdk/index.d.ts"),"@types/sdk/settings-mixin.d.ts":y("@types/sdk/settings-mixin.d.ts"),"@types/sdk/storage-settings.d.ts":y("@types/sdk/storage-settings.d.ts"),"@types/sdk/types.d.ts":y("@types/sdk/types.d.ts")}}const b=new Map;for(const e of Object.values(c.ScryptedInterfaceDescriptors))for(const t of e.methods)b.set(t,e.name)},6845:(e,t)=>{"use strict";t.resolveEnd=function(e,t,i,n){let r="";if(e){let s=!1,o="";for(const a of e){const{source:e,type:c}=a;switch(c){case"space":s=!0;break;case"comment":{i&&!s&&n(a,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const t=e.substring(1)||" ";r?r+=o+t:r=t,o="";break}case"newline":r&&(o+=e),s=!0;break;default:n(a,"UNEXPECTED_TOKEN",`Unexpected ${c} at node end`)}t+=e.length}}return{comment:r,offset:t}}},6906:(e,t)=>{"use strict";t.applyReviver=function e(t,i,n,r){if(r&&"object"==typeof r)if(Array.isArray(r))for(let i=0,n=r.length;i<n;++i){const n=r[i],s=e(t,r,String(i),n);void 0===s?delete r[i]:s!==n&&(r[i]=s)}else if(r instanceof Map)for(const i of Array.from(r.keys())){const n=r.get(i),s=e(t,r,i,n);void 0===s?r.delete(i):s!==n&&r.set(i,s)}else if(r instanceof Set)for(const i of Array.from(r)){const n=e(t,r,i,i);void 0===n?r.delete(i):n!==i&&(r.delete(i),r.add(n))}else for(const[i,n]of Object.entries(r)){const s=e(t,r,i,n);void 0===s?delete r[i]:s!==n&&(r[i]=s)}return t.call(i,n,r)}},6928:e=>{"use strict";e.exports=require("path")},6936:(e,t,i)=>{"use strict";var n=i(3144);const r=e=>"bigint"==typeof e||Number.isInteger(e);function s(e,t,i,{intAsBigInt:n}){const r=e[0];if("-"!==r&&"+"!==r||(t+=1),e=e.substring(t).replace(/_/g,""),n){switch(i){case 2:e=`0b${e}`;break;case 8:e=`0o${e}`;break;case 16:e=`0x${e}`}const t=BigInt(e);return"-"===r?BigInt(-1)*t:t}const s=parseInt(e,i);return"-"===r?-1*s:s}function o(e,t,i){const{value:s}=e;if(r(s)){const e=s.toString(t);return s<0?"-"+i+e.substr(1):i+e}return n.stringifyNumber(e)}const a={identify:r,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(e,t,i)=>s(e,2,2,i),stringify:e=>o(e,2,"0b")},c={identify:r,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(e,t,i)=>s(e,1,8,i),stringify:e=>o(e,8,"0")},l={identify:r,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(e,t,i)=>s(e,0,10,i),stringify:n.stringifyNumber},p={identify:r,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(e,t,i)=>s(e,2,16,i),stringify:e=>o(e,16,"0x")};t.int=l,t.intBin=a,t.intHex=p,t.intOct=c},6965:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFaPrefix=void 0,t.typeToIcon=function(e){return`${(0,r.getFaPrefix)(function(e){switch(e){case n.ScryptedDeviceType.Camera:return"fa-video";case n.ScryptedDeviceType.Doorbell:return"fa-bell";case n.ScryptedDeviceType.Fan:return"fa-fan";case n.ScryptedDeviceType.Light:return"fa-lightbulb";case n.ScryptedDeviceType.Switch:return"fa-toggle-on";case n.ScryptedDeviceType.Outlet:return"fa-plug";case n.ScryptedDeviceType.Sensor:return"fa-exclamation-triangle";case n.ScryptedDeviceType.Scene:return"fa-sun";case n.ScryptedDeviceType.Program:return"fa-code";case n.ScryptedDeviceType.Automation:return"fa-bolt";case n.ScryptedDeviceType.Event:return"fa-exclamation";case n.ScryptedDeviceType.Vacuum:return"fa-trash";case n.ScryptedDeviceType.Notifier:return"fa-bell";case n.ScryptedDeviceType.Lock:return"fa-unlock-alt";case n.ScryptedDeviceType.Thermostat:return"fa-thermometer-three-quarters";case n.ScryptedDeviceType.PasswordControl:return"fa-key";case n.ScryptedDeviceType.Display:return"fa-tv";case n.ScryptedDeviceType.Speaker:return"fa-volume-up";case n.ScryptedDeviceType.Entry:case n.ScryptedDeviceType.Garage:return"fa-warehouse";case n.ScryptedDeviceType.API:return"fa-cloud";case n.ScryptedDeviceType.DataSource:return"fa-chart-area";case n.ScryptedDeviceType.DeviceProvider:return"fa-server";case n.ScryptedDeviceType.Unknown:return"fa-question-circle";case n.ScryptedDeviceType.Valve:case n.ScryptedDeviceType.Irrigation:return"fa-faucet";case n.ScryptedDeviceType.Person:return"fa-user";case n.ScryptedDeviceType.SecuritySystem:return"fa-shield-alt";case n.ScryptedDeviceType.Builtin:return"fa-server";case n.ScryptedDeviceType.Siren:return"fa-siren";case n.ScryptedDeviceType.Internet:return"fa-globe";case n.ScryptedDeviceType.Bridge:return"fa-chart-network";case n.ScryptedDeviceType.Network:return"fa-network-wired"}return"fa-toggle-on"}(e))}`},t.hasFixedPhysicalLocation=function(e){if(!e)return!1;switch(e){case n.ScryptedDeviceType.Builtin:case n.ScryptedDeviceType.Internal:case n.ScryptedDeviceType.Program:case n.ScryptedDeviceType.Automation:case n.ScryptedDeviceType.API:case n.ScryptedDeviceType.Scene:case n.ScryptedDeviceType.Event:case n.ScryptedDeviceType.DeviceProvider:case n.ScryptedDeviceType.DataSource:case n.ScryptedDeviceType.Notifier:case n.ScryptedDeviceType.Person:case n.ScryptedDeviceType.Unknown:return!1}return!0};const n=i(1621),r=i(3335);var s=i(3335);Object.defineProperty(t,"getFaPrefix",{enumerable:!0,get:function(){return s.getFaPrefix}})},6967:function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SCRYPTED_INSTALL_ENVIRONMENT_LXC_DOCKER=t.SCRYPTED_INSTALL_ENVIRONMENT_LXC=void 0,t.checkLegacyLxc=async function(){if(process.env.SCRYPTED_INSTALL_ENVIRONMENT!==t.SCRYPTED_INSTALL_ENVIRONMENT_LXC)return;p.default.log.a("This system is currently running the legacy LXC installation method and must be migrated to the new LXC manually: https://docs.scrypted.app/install/proxmox-ve.html#proxmox-ve-container-reset")},t.checkLxc=async function(){if(process.env.SCRYPTED_INSTALL_ENVIRONMENT!==t.SCRYPTED_INSTALL_ENVIRONMENT_LXC_DOCKER)return;await async function(){const e=m.default.parseDocument((0,l.readFileAsString)("/root/.scrypted/docker-compose.yml")),t=e.contents.get("services").get("watchtower");if(t.get("profiles"))return;t.set("profiles",["disabled"]),(0,d.writeFileSync)("/root/.scrypted/docker-compose.yml",m.default.stringify(e))}(),await async function(){const e=await d.default.promises.readFile(f,"utf8"),t=await d.default.promises.readFile(h,"utf8");if(e===t){if(73&(await d.default.promises.stat(f)).mode)return;return void await d.default.promises.chmod(f,493)}await d.default.promises.copyFile(h,f),await d.default.promises.chmod(f,493)}()},t.checkLxcVersionUpdateNeeded=async function(){if(process.env.SCRYPTED_INSTALL_ENVIRONMENT!==t.SCRYPTED_INSTALL_ENVIRONMENT_LXC_DOCKER)return;const e=m.default.parseDocument((0,l.readFileAsString)("/root/.scrypted/docker-compose.yml")),i=e.contents.get("services").get("scrypted").get("image").split(":")[1]||"latest";await async function(e){return g({method:"POST",path:`/v1.41/images/create?fromImage=ghcr.io%2Fkoush%2Fscrypted&tag=${e}`})}(i);const n=await async function(e){const t=await g({method:"GET",path:"/v1.41/images/json"}),i=JSON.parse(t).find((t=>t.RepoTags&&t.RepoTags.some((t=>t===`ghcr.io/koush/scrypted:${e}`))));if(!i)throw new Error("Image not found");return i.Id}(i),r=await async function(){const e=await g({method:"GET",path:'/v1.41/containers/json?filters={"name":["scrypted"],"status":["running"]}'}),t=JSON.parse(e);if(!t.length)throw new Error('No running container named "scrypted" found');return t[0].ImageID}();return console.warn("LXC Scrypted latest image ID:",n),console.warn("LXC Scrypted running image ID:",r),r!==n};const c=i(3290),l=i(6593),p=a(i(2743)),d=o(i(9896)),u=a(i(8611)),m=a(i(1198));t.SCRYPTED_INSTALL_ENVIRONMENT_LXC="lxc",t.SCRYPTED_INSTALL_ENVIRONMENT_LXC_DOCKER="lxc-docker";const f="/root/.scrypted/docker-compose.sh",h="lxc/docker-compose.sh";async function g(e,t){const i=new c.Deferred,n=u.default.request({socketPath:"/var/run/docker.sock",method:e.method,path:e.path,headers:{Host:"localhost",...e.headers}});return n.on("response",(e=>{let t="";e.on("data",(e=>{t+=e})),e.on("end",(()=>{i.resolve(t)}))})),n.on("error",(e=>{i.reject(e)})),t&&n.write(t),n.end(),i.promise}},6982:e=>{"use strict";e.exports=require("crypto")},7016:e=>{"use strict";e.exports=require("url")},7180:(e,t,i)=>{"use strict";var n=i(9714),r=i(6170);const s=(e,t)=>({indentAtStart:t?e.indent.length:e.indentAtStart,lineWidth:e.options.lineWidth,minContentWidth:e.options.minContentWidth}),o=e=>/^(%|---|\.\.\.)/m.test(e);function a(e,t){const i=JSON.stringify(e);if(t.options.doubleQuotedAsJSON)return i;const{implicitKey:n}=t,a=t.options.doubleQuotedMinMultiLineLength,c=t.indent||(o(e)?"  ":"");let l="",p=0;for(let e=0,t=i[e];t;t=i[++e])if(" "===t&&"\\"===i[e+1]&&"n"===i[e+2]&&(l+=i.slice(p,e)+"\\ ",e+=1,p=e,t="\\"),"\\"===t)switch(i[e+1]){case"u":{l+=i.slice(p,e);const t=i.substr(e+2,4);switch(t){case"0000":l+="\\0";break;case"0007":l+="\\a";break;case"000b":l+="\\v";break;case"001b":l+="\\e";break;case"0085":l+="\\N";break;case"00a0":l+="\\_";break;case"2028":l+="\\L";break;case"2029":l+="\\P";break;default:"00"===t.substr(0,2)?l+="\\x"+t.substr(2):l+=i.substr(e,6)}e+=5,p=e+1}break;case"n":if(n||'"'===i[e+2]||i.length<a)e+=1;else{for(l+=i.slice(p,e)+"\n\n";"\\"===i[e+2]&&"n"===i[e+3]&&'"'!==i[e+4];)l+="\n",e+=2;l+=c," "===i[e+2]&&(l+="\\"),e+=1,p=e+1}break;default:e+=1}return l=p?l+i.slice(p):i,n?l:r.foldFlowLines(l,c,r.FOLD_QUOTED,s(t,!1))}function c(e,t){if(!1===t.options.singleQuote||t.implicitKey&&e.includes("\n")||/[ \t]\n|\n[ \t]/.test(e))return a(e,t);const i=t.indent||(o(e)?"  ":""),n="'"+e.replace(/'/g,"''").replace(/\n+/g,`$&\n${i}`)+"'";return t.implicitKey?n:r.foldFlowLines(n,i,r.FOLD_FLOW,s(t,!1))}function l(e,t){const{singleQuote:i}=t.options;let n;if(!1===i)n=a;else{const t=e.includes('"'),r=e.includes("'");n=t&&!r?c:r&&!t?a:i?c:a}return n(e,t)}let p;try{p=new RegExp("(^|(?<!\n))\n+(?!\n|$)","g")}catch{p=/\n+(?!\n|$)/g}function d({comment:e,type:t,value:i},a,c,d){const{blockQuote:u,commentString:m,lineWidth:f}=a.options;if(!u||/\n[\t ]+$/.test(i)||/^\s*$/.test(i))return l(i,a);const h=a.indent||(a.forceBlockIndent||o(i)?"  ":""),g="literal"===u||"folded"!==u&&t!==n.Scalar.BLOCK_FOLDED&&(t===n.Scalar.BLOCK_LITERAL||!function(e,t,i){if(!t||t<0)return!1;const n=t-i,r=e.length;if(r<=n)return!1;for(let t=0,i=0;t<r;++t)if("\n"===e[t]){if(t-i>n)return!0;if(i=t+1,r-i<=n)return!1}return!0}(i,f,h.length));if(!i)return g?"|\n":">\n";let v,y;for(y=i.length;y>0;--y){const e=i[y-1];if("\n"!==e&&"\t"!==e&&" "!==e)break}let S=i.substring(y);const b=S.indexOf("\n");-1===b?v="-":i===S||b!==S.length-1?(v="+",d&&d()):v="",S&&(i=i.slice(0,-S.length),"\n"===S[S.length-1]&&(S=S.slice(0,-1)),S=S.replace(p,`$&${h}`));let x,w=!1,k=-1;for(x=0;x<i.length;++x){const e=i[x];if(" "===e)w=!0;else{if("\n"!==e)break;k=x}}let O=i.substring(0,k<x?k+1:x);O&&(i=i.substring(O.length),O=O.replace(/\n+/g,`$&${h}`));let D=(g?"|":">")+(w?h?"2":"1":"")+v;if(e&&(D+=" "+m(e.replace(/ ?[\r\n]+/g," ")),c&&c()),g)return`${D}\n${h}${O}${i=i.replace(/\n+/g,`$&${h}`)}${S}`;i=i.replace(/\n+/g,"\n$&").replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${h}`);return`${D}\n${h}${r.foldFlowLines(`${O}${i}${S}`,h,r.FOLD_BLOCK,s(a,!0))}`}t.stringifyString=function(e,t,i,p){const{implicitKey:u,inFlow:m}=t,f="string"==typeof e.value?e:Object.assign({},e,{value:String(e.value)});let{type:h}=e;h!==n.Scalar.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(f.value)&&(h=n.Scalar.QUOTE_DOUBLE);const g=e=>{switch(e){case n.Scalar.BLOCK_FOLDED:case n.Scalar.BLOCK_LITERAL:return u||m?l(f.value,t):d(f,t,i,p);case n.Scalar.QUOTE_DOUBLE:return a(f.value,t);case n.Scalar.QUOTE_SINGLE:return c(f.value,t);case n.Scalar.PLAIN:return function(e,t,i,a){const{type:c,value:p}=e,{actualString:u,implicitKey:m,indent:f,indentStep:h,inFlow:g}=t;if(m&&p.includes("\n")||g&&/[[\]{},]/.test(p))return l(p,t);if(!p||/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(p))return m||g||!p.includes("\n")?l(p,t):d(e,t,i,a);if(!m&&!g&&c!==n.Scalar.PLAIN&&p.includes("\n"))return d(e,t,i,a);if(o(p)){if(""===f)return t.forceBlockIndent=!0,d(e,t,i,a);if(m&&f===h)return l(p,t)}const v=p.replace(/\n+/g,`$&\n${f}`);if(u){const e=e=>e.default&&"tag:yaml.org,2002:str"!==e.tag&&e.test?.test(v),{compat:i,tags:n}=t.doc.schema;if(n.some(e)||i?.some(e))return l(p,t)}return m?v:r.foldFlowLines(v,f,r.FOLD_FLOW,s(t,!1))}(f,t,i,p);default:return null}};let v=g(h);if(null===v){const{defaultKeyType:e,defaultStringType:i}=t.options,n=u&&e||i;if(v=g(n),null===v)throw new Error(`Unsupported default string type ${n}`)}return v}},7191:(e,t,i)=>{"use strict";var n=i(9714),r=i(3144);const s={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:e=>"nan"===e.slice(-3).toLowerCase()?NaN:"-"===e[0]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:r.stringifyNumber},o={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e.replace(/_/g,"")),stringify(e){const t=Number(e.value);return isFinite(t)?t.toExponential():r.stringifyNumber(e)}},a={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(e){const t=new n.Scalar(parseFloat(e.replace(/_/g,""))),i=e.indexOf(".");if(-1!==i){const n=e.substring(i+1).replace(/_/g,"");"0"===n[n.length-1]&&(t.minFractionDigits=n.length)}return t},stringify:r.stringifyNumber};t.float=a,t.floatExp=o,t.floatNaN=s},7270:e=>{"use strict";e.exports=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){return e.__proto__=t,e}:function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=t[i]);return e})},7360:e=>{const t=require("@scrypted/node-pty");e.exports=t},7362:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MediaCore=t.MediaCoreNativeId=void 0;const r=n(i(6928)),s=i(2743),o=n(i(2743)),{systemManager:a,deviceManager:c,mediaManager:l,endpointManager:p}=o.default,d=i(875),u=n(i(7016));t.MediaCoreNativeId="mediacore";class m extends s.ScryptedDeviceBase{httpHost;httpsHost;rmoHost;fileHost;filesHost;constructor(){super(t.MediaCoreNativeId),this.fromMimeType=s.ScryptedMimeTypes.SchemePrefix+"scrypted-media;converter-weight=2",this.toMimeType=s.ScryptedMimeTypes.MediaObject,(async()=>{await c.onDevicesChanged({providerNativeId:this.nativeId,devices:[{name:"HTTP Buffer Host",nativeId:"http",interfaces:[s.ScryptedInterface.BufferConverter,s.ScryptedInterface.HttpRequestHandler],type:s.ScryptedDeviceType.API},{providerNativeId:this.nativeId,name:"HTTPS Buffer Host",nativeId:"https",interfaces:[s.ScryptedInterface.BufferConverter,s.ScryptedInterface.HttpRequestHandler],type:s.ScryptedDeviceType.API},{name:"RequestMediaObject Host",nativeId:"rmo-host",interfaces:[s.ScryptedInterface.BufferConverter,s.ScryptedInterface.HttpRequestHandler],type:s.ScryptedDeviceType.API},{name:"HTTP File Host",nativeId:"file",interfaces:[s.ScryptedInterface.BufferConverter,s.ScryptedInterface.HttpRequestHandler],type:s.ScryptedDeviceType.API},{providerNativeId:this.nativeId,name:"HTTPS File Host",nativeId:"files",interfaces:[s.ScryptedInterface.BufferConverter,s.ScryptedInterface.HttpRequestHandler],type:s.ScryptedDeviceType.API}]}),this.httpHost=new d.BufferHost(!1),this.httpsHost=new d.BufferHost(!0),this.rmoHost=new d.RequestMediaObjectHost,this.fileHost=new d.FileHost(!1),this.filesHost=new d.FileHost(!0)})()}async onRequest(e,t){if(e.isPublicEndpoint)return void t.send("",{code:404});const i=e.url.substring(e.rootPath.length),[n,r,o]=i.split("/");try{if(o!==s.ScryptedInterface.Camera)throw new Error;const e=new URLSearchParams(i.split("?")[1]),n=await a.getDeviceById(r).takePicture({picture:{width:parseInt(e.get("width"))||void 0,height:parseInt(e.get("height"))||void 0}}),c=await l.convertMediaObjectToBuffer(n,"image/jpeg");t.send(c,{headers:{"Content-Type":"image/jpeg","Cache-Control":"max-age=10"}})}catch(e){t.send("",{code:500})}}async getLocalSnapshot(e,t,i){const n=await p.getAuthenticatedPath(this.nativeId),o=u.default.resolve(r.default.join(n,e,t,`${Date.now()}.jpg`)+`${i}`,"");return l.createMediaObject(Buffer.from(o),s.ScryptedMimeTypes.LocalUrl)}async convert(e,t,i){const n=new URL(e.toString()),r=n.hostname,o=n.pathname.split("/")[1];if(o===s.ScryptedInterface.Camera){if(i===s.ScryptedMimeTypes.LocalUrl)return this.getLocalSnapshot(r,o,n.search);const e=async()=>a.getDeviceById(r).takePicture();return l.createMediaObject(e,s.ScryptedMimeTypes.RequestMediaObject)}if(o===s.ScryptedInterface.VideoCamera){const e=async()=>a.getDeviceById(r).getVideoStream();return l.createMediaObject(e,s.ScryptedMimeTypes.RequestMediaObject)}throw new Error("Unrecognized Scrypted Media interface.")}async getDevice(e){return"http"===e?this.httpHost:"https"===e?this.httpsHost:"rmo-host"===e?this.rmoHost:"file"===e?this.fileHost:"files"===e?this.filesHost:void 0}async releaseDevice(e,t){}}t.MediaCore=m},7434:(e,t,i)=>{"use strict";var n=i(7902),r=i(1755),s=i(1386),o=i(9378),a=i(8644),c=i(8334);const l="All mapping items must start at the same column";t.resolveBlockMap=function({composeNode:e,composeEmptyNode:t},i,p,d,u){const m=new(u?.nodeClass??r.YAMLMap)(i.schema);i.atRoot&&(i.atRoot=!1);let f=p.offset,h=null;for(const r of p.items){const{start:u,key:g,sep:v,value:y}=r,S=s.resolveProps(u,{indicator:"explicit-key-ind",next:g??v?.[0],offset:f,onError:d,parentIndent:p.indent,startOnNewline:!0}),b=!S.found;if(b){if(g&&("block-seq"===g.type?d(f,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in g&&g.indent!==p.indent&&d(f,"BAD_INDENT",l)),!S.anchor&&!S.tag&&!v){h=S.end,S.comment&&(m.comment?m.comment+="\n"+S.comment:m.comment=S.comment);continue}(S.newlineAfterProp||o.containsNewline(g))&&d(g??u[u.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else S.found?.indent!==p.indent&&d(f,"BAD_INDENT",l);const x=S.end,w=g?e(i,g,S,d):t(i,x,u,null,S,d);i.schema.compat&&a.flowIndentCheck(p.indent,g,d),c.mapIncludes(i,m.items,w)&&d(x,"DUPLICATE_KEY","Map keys must be unique");const k=s.resolveProps(v??[],{indicator:"map-value-ind",next:y,offset:w.range[2],onError:d,parentIndent:p.indent,startOnNewline:!g||"block-scalar"===g.type});if(f=k.end,k.found){b&&("block-map"!==y?.type||k.hasNewline||d(f,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),i.options.strict&&S.start<k.found.offset-1024&&d(w.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const s=y?e(i,y,k,d):t(i,f,v,null,k,d);i.schema.compat&&a.flowIndentCheck(p.indent,y,d),f=s.range[2];const o=new n.Pair(w,s);i.options.keepSourceTokens&&(o.srcToken=r),m.items.push(o)}else{b&&d(w.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),k.comment&&(w.comment?w.comment+="\n"+k.comment:w.comment=k.comment);const e=new n.Pair(w);i.options.keepSourceTokens&&(e.srcToken=r),m.items.push(e)}}return h&&h<f&&d(h,"IMPOSSIBLE","Map comment with trailing content"),m.range=[p.offset,f,h??f],m}},7444:(e,t)=>{"use strict";t.debug=function(e,...t){"debug"===e&&console.log(...t)},t.warn=function(e,t){"debug"!==e&&"warn"!==e||("undefined"!=typeof process&&process.emitWarning?process.emitWarning(t):console.warn(t))}},7476:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Scheduler=void 0;t.Scheduler=class{schedule(e){const t=[e.sunday,e.monday,e.tuesday,e.wednesday,e.thursday,e.friday,e.saturday],i={async setName(){},async setType(){},async setRoom(){},async setMixins(){},probe:async()=>!0,listen(n,r,s){let o=null,a=null;function c(){o=null;const e=a;l(),r(i,{eventId:void 0,eventInterface:"Scheduler",eventTime:Date.now()},e)}function l(){if(a=function(){const i=new Date;i.setHours(e.hour),i.setMinutes(e.minute);const n=Date.now();for(let e=0;e<8;e++){const r=new Date(i.getTime()+24*e*60*60*1e3);if(r.getTime()<=n+1e4)continue;const o=r.getDay();if(t[o])return s.log.i(`event will fire at ${r.toLocaleString()}`),r}s.log.w("event will never fire")}(),a){const e=a.getTime()-Date.now();s.log.i(`event will fire in ${Math.round(e/60/1e3)} minutes.`),o=setTimeout(c,e)}}return l(),{removeListener(){o&&clearTimeout(o),o=null,a=null}}},id:"",pluginId:"",interfaces:[],mixins:[],providedInterfaces:[],name:"Scheduler"};return i}}},7541:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.monacoEvalDefaults=void 0;const n=i(6593),r={script:i(7778).A,util:i(541).A};t.monacoEvalDefaults=(0,n.createMonacoEvalDefaults)(r)},7571:(e,t,i)=>{"use strict";var n=i(9714),r=i(6845);function s(e){let t,i;try{t=new RegExp("(.*?)(?<![ \t])[ \t]*\r?\n","sy"),i=new RegExp("[ \t]*(.*?)(?:(?<![ \t])[ \t]*)?\r?\n","sy")}catch{t=/(.*?)[ \t]*\r?\n/sy,i=/[ \t]*(.*?)[ \t]*\r?\n/sy}let n=t.exec(e);if(!n)return e;let r=n[1],s=" ",o=t.lastIndex;for(i.lastIndex=o;n=i.exec(e);)""===n[1]?"\n"===s?r+=s:s="\n":(r+=s+n[1],s=" "),o=i.lastIndex;const a=/[ \t]*(.*)/sy;return a.lastIndex=o,n=a.exec(e),r+s+(n?.[1]??"")}function o(e,t){let i="",n=e[t+1];for(;!(" "!==n&&"\t"!==n&&"\n"!==n&&"\r"!==n||"\r"===n&&"\n"!==e[t+2]);)"\n"===n&&(i+="\n"),n=e[(t+=1)+1];return i||(i=" "),{fold:i,offset:t}}const a={0:"\0",a:"",b:"\b",e:"",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v",N:"",_:"",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","\t":"\t"};function c(e,t,i,n){const r=e.substr(t,i),s=r.length===i&&/^[0-9a-fA-F]+$/.test(r)?parseInt(r,16):NaN;if(isNaN(s)){const r=e.substr(t-2,i+2);return n(t-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${r}`),r}return String.fromCodePoint(s)}t.resolveFlowScalar=function(e,t,i){const{offset:l,type:p,source:d,end:u}=e;let m,f;const h=(e,t,n)=>i(l+e,t,n);switch(p){case"scalar":m=n.Scalar.PLAIN,f=function(e,t){let i="";switch(e[0]){case"\t":i="a tab character";break;case",":i="flow indicator character ,";break;case"%":i="directive indicator character %";break;case"|":case">":i=`block scalar indicator ${e[0]}`;break;case"@":case"`":i=`reserved character ${e[0]}`}i&&t(0,"BAD_SCALAR_START",`Plain value cannot start with ${i}`);return s(e)}(d,h);break;case"single-quoted-scalar":m=n.Scalar.QUOTE_SINGLE,f=function(e,t){"'"===e[e.length-1]&&1!==e.length||t(e.length,"MISSING_CHAR","Missing closing 'quote");return s(e.slice(1,-1)).replace(/''/g,"'")}(d,h);break;case"double-quoted-scalar":m=n.Scalar.QUOTE_DOUBLE,f=function(e,t){let i="";for(let n=1;n<e.length-1;++n){const r=e[n];if("\r"!==r||"\n"!==e[n+1])if("\n"===r){const{fold:t,offset:r}=o(e,n);i+=t,n=r}else if("\\"===r){let r=e[++n];const s=a[r];if(s)i+=s;else if("\n"===r)for(r=e[n+1];" "===r||"\t"===r;)r=e[1+ ++n];else if("\r"===r&&"\n"===e[n+1])for(r=e[1+ ++n];" "===r||"\t"===r;)r=e[1+ ++n];else if("x"===r||"u"===r||"U"===r){const s={x:2,u:4,U:8}[r];i+=c(e,n+1,s,t),n+=s}else{const r=e.substr(n-1,2);t(n-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${r}`),i+=r}}else if(" "===r||"\t"===r){const t=n;let s=e[n+1];for(;" "===s||"\t"===s;)s=e[1+ ++n];"\n"===s||"\r"===s&&"\n"===e[n+2]||(i+=n>t?e.slice(t,n+1):r)}else i+=r}'"'===e[e.length-1]&&1!==e.length||t(e.length,"MISSING_CHAR",'Missing closing "quote');return i}(d,h);break;default:return i(e,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${p}`),{value:"",type:null,comment:"",range:[l,l+d.length,l+d.length]}}const g=l+d.length,v=r.resolveEnd(u,g,t,i);return{value:f,type:m,comment:v.comment,range:[l,g,v.offset]}}},7724:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=void 0;var n=i(4610);Object.defineProperty(t,"sleep",{enumerable:!0,get:function(){return n.sleep}})},7778:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});const n='import type { ScryptedDeviceBase } from "@scrypted/sdk";\n\nexport interface ScriptDevice {\n    /**\n     * @deprecated Use the default export to specify the device handler.\n     * @param handler \n     */\n    handle<T>(handler?: T & object): void;\n    handleTypes(...interfaces: string[]): void;\n}\n\nexport declare const device: ScryptedDeviceBase & ScriptDevice;\n'},7808:(e,t)=>{"use strict";function i(e){switch(e.type){case"block-scalar":{let t="";for(const n of e.props)t+=i(n);return t+e.source}case"block-map":case"block-seq":{let t="";for(const i of e.items)t+=n(i);return t}case"flow-collection":{let t=e.start.source;for(const i of e.items)t+=n(i);for(const i of e.end)t+=i.source;return t}case"document":{let t=n(e);if(e.end)for(const i of e.end)t+=i.source;return t}default:{let t=e.source;if("end"in e&&e.end)for(const i of e.end)t+=i.source;return t}}}function n({start:e,key:t,sep:n,value:r}){let s="";for(const t of e)s+=t.source;if(t&&(s+=i(t)),n)for(const e of n)s+=e.source;return r&&(s+=i(r)),s}t.stringify=e=>"type"in e?i(e):n(e)},7826:e=>{const t=require("typescript");e.exports=t},7902:(e,t,i)=>{"use strict";var n=i(5219),r=i(8017),s=i(5139),o=i(484);class a{constructor(e,t=null){Object.defineProperty(this,o.NODE_TYPE,{value:o.PAIR}),this.key=e,this.value=t}clone(e){let{key:t,value:i}=this;return o.isNode(t)&&(t=t.clone(e)),o.isNode(i)&&(i=i.clone(e)),new a(t,i)}toJSON(e,t){const i=t?.mapAsMap?new Map:{};return s.addPairToJSMap(t,i,this)}toString(e,t,i){return e?.doc?r.stringifyPair(this,e,t,i):JSON.stringify(this)}}t.Pair=a,t.createPair=function(e,t,i){const r=n.createNode(e,void 0,i),s=n.createNode(t,void 0,i);return new a(r,s)}},7969:(e,t,i)=>{"use strict";var n=i(9714);function r({value:e,source:t},i){return t&&(e?s:o).test.test(t)?t:e?i.options.trueStr:i.options.falseStr}const s={identify:e=>!0===e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new n.Scalar(!0),stringify:r},o={identify:e=>!1===e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new n.Scalar(!1),stringify:r};t.falseTag=o,t.trueTag=s},8017:(e,t,i)=>{"use strict";var n=i(484),r=i(9714),s=i(3793),o=i(248);t.stringifyPair=function({key:e,value:t},i,a,c){const{allNullValues:l,doc:p,indent:d,indentStep:u,options:{commentString:m,indentSeq:f,simpleKeys:h}}=i;let g=n.isNode(e)&&e.comment||null;if(h){if(g)throw new Error("With simple keys, key nodes cannot have comments");if(n.isCollection(e)||!n.isNode(e)&&"object"==typeof e){throw new Error("With simple keys, collection cannot be used as a key value")}}let v=!h&&(!e||g&&null==t&&!i.inFlow||n.isCollection(e)||(n.isScalar(e)?e.type===r.Scalar.BLOCK_FOLDED||e.type===r.Scalar.BLOCK_LITERAL:"object"==typeof e));i=Object.assign({},i,{allNullValues:!1,implicitKey:!v&&(h||!l),indent:d+u});let y,S,b,x=!1,w=!1,k=s.stringify(e,i,(()=>x=!0),(()=>w=!0));if(!v&&!i.inFlow&&k.length>1024){if(h)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");v=!0}if(i.inFlow){if(l||null==t)return x&&a&&a(),""===k?"?":v?`? ${k}`:k}else if(l&&!h||null==t&&v)return k=`? ${k}`,g&&!x?k+=o.lineComment(k,i.indent,m(g)):w&&c&&c(),k;x&&(g=null),v?(g&&(k+=o.lineComment(k,i.indent,m(g))),k=`? ${k}\n${d}:`):(k=`${k}:`,g&&(k+=o.lineComment(k,i.indent,m(g)))),n.isNode(t)?(y=!!t.spaceBefore,S=t.commentBefore,b=t.comment):(y=!1,S=null,b=null,t&&"object"==typeof t&&(t=p.createNode(t))),i.implicitKey=!1,v||g||!n.isScalar(t)||(i.indentAtStart=k.length+1),w=!1,f||!(u.length>=2)||i.inFlow||v||!n.isSeq(t)||t.flow||t.tag||t.anchor||(i.indent=i.indent.substring(2));let O=!1;const D=s.stringify(t,i,(()=>O=!0),(()=>w=!0));let C=" ";if(g||y||S){if(C=y?"\n":"",S){const e=m(S);C+=`\n${o.indentComment(e,i.indent)}`}""!==D||i.inFlow?C+=`\n${i.indent}`:"\n"===C&&(C="\n\n")}else if(!v&&n.isCollection(t)){const e=D[0],n=D.indexOf("\n"),r=-1!==n,s=i.inFlow??t.flow??0===t.items.length;if(r||!s){let t=!1;if(r&&("&"===e||"!"===e)){let i=D.indexOf(" ");"&"===e&&-1!==i&&i<n&&"!"===D[i+1]&&(i=D.indexOf(" ",i+1)),(-1===i||n<i)&&(t=!0)}t||(C=`\n${i.indent}`)}}else""!==D&&"\n"!==D[0]||(C="");return k+=C+D,i.inFlow?O&&a&&a():b&&!O?k+=o.lineComment(k,i.indent,m(b)):w&&c&&c(),k}},8080:(e,t,i)=>{"use strict";var n=i(9714),r=i(7180);const s={identify:e=>e instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(e,t){if("function"==typeof Buffer)return Buffer.from(e,"base64");if("function"==typeof atob){const t=atob(e.replace(/[\n\r]/g,"")),i=new Uint8Array(t.length);for(let e=0;e<t.length;++e)i[e]=t.charCodeAt(e);return i}return t("This environment does not support reading binary tags; either Buffer or atob is required"),e},stringify({comment:e,type:t,value:i},s,o,a){const c=i;let l;if("function"==typeof Buffer)l=c instanceof Buffer?c.toString("base64"):Buffer.from(c.buffer).toString("base64");else{if("function"!=typeof btoa)throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");{let e="";for(let t=0;t<c.length;++t)e+=String.fromCharCode(c[t]);l=btoa(e)}}if(t||(t=n.Scalar.BLOCK_LITERAL),t!==n.Scalar.QUOTE_DOUBLE){const e=Math.max(s.options.lineWidth-s.indent.length,s.options.minContentWidth),i=Math.ceil(l.length/e),r=new Array(i);for(let t=0,n=0;t<i;++t,n+=e)r[t]=l.substr(n,e);l=r.join(t===n.Scalar.BLOCK_LITERAL?"\n":" ")}return r.stringifyString({comment:e,type:t,value:l},s,o,a)}};t.binary=s},8127:(e,t)=>{e.exports=function(e,t){if(e&&t)for(var i in t)e[i]=t[i];return e}},8144:function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TerminalService=t.TerminalServiceNativeId=void 0,t.newTerminalService=async function(){return new g(t.TerminalServiceNativeId,!0)};const c=o(i(2743)),l=i(5597),p=i(5317),d=a(i(6928));t.TerminalServiceNativeId="terminalservice";const{systemManager:u}=c.default;function m(e){const t=process.env.PATH,i=e.join(d.default.delimiter);return t&&i?`${i}${d.default.delimiter}${t}`:i||t}class f{cp;constructor(e,t,i){const n=m(t);this.cp=e?.length?i(e[0],e.slice(1),{env:{...process.env,PATH:n}}):i(process.env.SHELL,[],{env:{...process.env,PATH:n}})}onExit(e){this.cp.onExit(e)}onData(e){this.cp.onData(e)}pause(){this.cp.pause()}resume(){this.cp.resume()}write(e){this.cp.write(e.toString())}sendEOF(){}kill(e){this.cp.kill(e)}resize(e,t){e>0&&t>0&&this.cp.resize(e,t)}}class h{cp;constructor(e,t){const i=m(t);this.cp=e?.length?(0,p.spawn)(e[0],e.slice(1),{env:{...process.env,PATH:i}}):(0,p.spawn)(process.env.SHELL,{env:{...process.env,PATH:i}})}onExit(e){return this.cp.on("close",e)}onData(e){this.cp.stdout.on("data",e),this.cp.stderr.on("data",e)}pause(){this.cp.stdout.pause(),this.cp.stderr.pause()}resume(){this.cp.stdout.resume(),this.cp.stderr.resume()}write(e){this.cp.stdin.write(e)}sendEOF(){this.cp.stdin.end()}kill(e){this.cp.kill(e)}resize(e,t){}}class g extends c.ScryptedDeviceBase{isFork;forks={};forkClients;constructor(e,t=!1){super(e),this.isFork=t}async getExtraPaths(){let e=[];const t=u.getSystemState();for(const i in t){const t=u.getDeviceById(i);if(t.interfaces.includes(c.ScryptedInterface.TTYSettings))try{const i=await t.getTTYSettings();e=e.concat(i.paths||[])}catch(e){this.console.log(e)}}return e}async forkInterface(e,t){if(e!==c.ScryptedInterface.StreamService)throw new Error("can only fork StreamService");if(!t?.clusterWorkerId)throw new Error("clusterWorkerId required");if(this.isFork)throw new Error("cannot fork a fork");const i=t.clusterWorkerId;if(this.forks[i])return this.forks[i];const n=c.default.fork({clusterWorkerId:i});try{const e=await n.result,t=await e.newTerminalService();return this.forks[i]=t,n.worker.on("exit",(()=>{delete this.forks[i]})),t}catch(e){throw n.worker.terminate(),e}}async connectStream(e,t){let n=null;const r=(0,l.createAsyncQueue)(),s=await this.getExtraPaths();function o(){n.onExit((()=>r.end()));let e=0;n.onData((async t=>{const i=Buffer.from(t);e+=i.length;const s=r.enqueue(i).then((()=>e-=i.length));e>=64e3&&(n.pause(),await s,e<64e3&&n.resume())}))}return this.isFork&&this.forkClients++,r.endPromise.then((()=>{this.isFork&&(this.forkClients--,0===this.forkClients&&process.exit())})),(async()=>{try{for await(const a of e)if(a)if(Buffer.isBuffer(a))n?.write(a);else try{const e=JSON.parse(a.toString());if(e.dim)n?.resize(e.dim.cols,e.dim.rows);else if(e.eof)n?.sendEOF();else if("interactive"in e&&!n){const a=e.cmd||t?.cmd;if(e.interactive){let e;try{e=i(7360).spawn,n=new f(a,s,e)}catch(e){return this.console.error("Error starting pty",e),void r.end(e)}}else n=new h(a,s);o()}}catch{n?.write(Buffer.from(a))}}catch(e){this.console.log(e)}finally{n?.kill()}})(),async function*(){try{for(;;){const e=r.clear();e.length?yield Buffer.concat(e):yield await r.dequeue()}}finally{n?.kill()}}()}}t.TerminalService=g},8334:(e,t,i)=>{"use strict";var n=i(484);t.mapIncludes=function(e,t,i){const{uniqueKeys:r}=e.options;if(!1===r)return!1;const s="function"==typeof r?r:(t,i)=>t===i||n.isScalar(t)&&n.isScalar(i)&&t.value===i.value&&!("<<"===t.value&&e.schema.merge);return t.some((e=>s(e.key,i)))}},8416:(e,t,i)=>{"use strict";var n=i(484),r=i(7902),s=i(9714),o=i(6010);function a(e,t){if(n.isSeq(e))for(let i=0;i<e.items.length;++i){let o=e.items[i];if(!n.isPair(o)){if(n.isMap(o)){o.items.length>1&&t("Each pair must have its own sequence indicator");const e=o.items[0]||new r.Pair(new s.Scalar(null));if(o.commentBefore&&(e.key.commentBefore=e.key.commentBefore?`${o.commentBefore}\n${e.key.commentBefore}`:o.commentBefore),o.comment){const t=e.value??e.key;t.comment=t.comment?`${o.comment}\n${t.comment}`:o.comment}o=e}e.items[i]=n.isPair(o)?o:new r.Pair(o)}}else t("Expected a sequence for this tag");return e}function c(e,t,i){const{replacer:n}=i,s=new o.YAMLSeq(e);s.tag="tag:yaml.org,2002:pairs";let a=0;if(t&&Symbol.iterator in Object(t))for(let e of t){let o,c;if("function"==typeof n&&(e=n.call(t,String(a++),e)),Array.isArray(e)){if(2!==e.length)throw new TypeError(`Expected [key, value] tuple: ${e}`);o=e[0],c=e[1]}else if(e&&e instanceof Object){const t=Object.keys(e);if(1!==t.length)throw new TypeError(`Expected tuple with one key, not ${t.length} keys`);o=t[0],c=e[o]}else o=e;s.items.push(r.createPair(o,c,i))}return s}const l={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:a,createNode:c};t.createPairs=c,t.pairs=l,t.resolvePairs=a},8428:(e,t,i)=>{"use strict";var n=i(8858)("router"),r=i(804).B,s=i(2961),o=i(4761),a=i(8127),c=i(3189),l=i(185),p=i(7270),d=Array.prototype.slice,u="function"==typeof setImmediate?setImmediate:function(e){process.nextTick(e.bind.apply(e,arguments))};function m(e){if(!(this instanceof m))return new m(e);var t=e||{};function i(e,t,n){i.handle(e,t,n)}return p(i,this),i.caseSensitive=t.caseSensitive,i.mergeParams=t.mergeParams,i.params={},i.strict=t.strict,i.stack=[],i}function f(e,t){try{return e.match(t)}catch(e){return e}}e.exports=m,e.exports.Route=l,m.prototype=function(){},m.prototype.param=function(e,t){if(!e)throw new TypeError("argument name is required");if("string"!=typeof e)throw new TypeError("argument name must be a string");if(!t)throw new TypeError("argument fn is required");if("function"!=typeof t)throw new TypeError("argument fn must be a function");var i=this.params[e];return i||(i=this.params[e]=[]),i.push(t),this},m.prototype.handle=function(e,t,i){if(!i)throw new TypeError("argument callback is required");n("dispatching %s %s",e.method,e.url);var r,s,o,l=0,p=function(e){if("string"!=typeof e||0===e.length||"/"===e[0])return;var t=e.indexOf("?"),i=-1!==t?t:e.length,n=e.substring(0,i).indexOf("://");return-1!==n?e.substring(0,e.indexOf("/",3+n)):void 0}(e.url)||"",d="",m=this,h=!1,g=0,v={},y=this.stack,S=e.params,b=e.baseUrl||"",x=function(e,t){for(var i=new Array(arguments.length-2),n=new Array(arguments.length-2),r=0;r<i.length;r++)i[r]=arguments[r+2],n[r]=t[i[r]];return function(){for(var r=0;r<i.length;r++)t[i[r]]=n[r];return e.apply(this,arguments)}}(i,e,"baseUrl","next","params");function w(i){var s="route"===i?null:i;if(h&&(e.url=e.url.slice(1),h=!1),0!==d.length&&(e.baseUrl=b,e.url=p+d+e.url.slice(p.length),d=""),"router"!==s)if(l>=y.length)u(x,s);else{if(++g>100)return u(w,i);var o,k,O,D=function(e){try{return c(e).pathname}catch(e){return}}(e);if(null==D)return x(s);for(;!0!==k&&l<y.length;)if(k=f(o=y[l++],D),O=o.route,"boolean"!=typeof k&&(s=s||k),!0===k&&O)if(s)k=!1;else{var C=e.method,T=O._handles_method(C);!T&&"OPTIONS"===C&&r&&r.push.apply(r,O._methods()),T||"HEAD"===C||(k=!1)}if(!0!==k)return x(s);O&&(e.route=O),e.params=m.mergeParams?function(e,t){if("object"!=typeof t||!t)return e;var i=a({},t);if(!(0 in e)||!(0 in t))return a(i,e);var n=0,r=0;for(;n in e;)n++;for(;r in t;)r++;for(n--;n>=0;n--)e[n+r]=e[n],n<r&&delete e[n];return a(i,e)}(o.params,S):o.params;var _=o.path;m.process_params(o,v,e,t,(function(i){i?w(s||i):O?o.handle_request(e,t,w):function(i,r,s,o){if(0!==s.length){if(s!==o.substring(0,s.length))return void w(r);var a=o[s.length];if(a&&"/"!==a)return void w(r);n("trim prefix (%s) from url %s",s,e.url),d=s,e.url=p+e.url.slice(p.length+d.length),p||"/"===e.url[0]||(e.url="/"+e.url,h=!0),e.baseUrl=b+("/"===d[d.length-1]?d.substring(0,d.length-1):d)}n("%s %s : %s",i.name,s,e.originalUrl),r?i.handle_error(r,e,t,w):i.handle_request(e,t,w)}(o,s,_,D),g=0}))}else u(x,null)}e.next=w,"OPTIONS"===e.method&&(s=x,o=function(e,t){return function(i,n){if(n||0===t.length)return i(n);!function(e,t,i){try{!function(e,t){for(var i=Object.create(null),n=0;n<t.length;n++)i[t[n]]=!0;var r=Object.keys(i).sort().join(", ");e.setHeader("Allow",r),e.setHeader("Content-Length",Buffer.byteLength(r)),e.setHeader("Content-Type","text/plain"),e.setHeader("X-Content-Type-Options","nosniff"),e.end(r)}(e,t)}catch(e){i(e)}}(e,t,i)}}(t,r=[]),x=function(){var e=new Array(arguments.length+1);e[0]=s;for(var t=0,i=arguments.length;t<i;t++)e[t+1]=arguments[t];o.apply(this,e)}),e.baseUrl=b,e.originalUrl=e.originalUrl||e.url,w()},m.prototype.process_params=function(e,t,i,n,r){var s=this.params,o=e.keys;if(!o||0===o.length)return r();var a,c,l,p,d,u=0,m=0;function f(e){return e?r(e):u>=o.length?r():(m=0,c=o[u++],a=c.name,l=i.params[a],p=s[a],d=t[a],void 0!==l&&p?d&&(d.match===l||d.error&&"route"!==d.error)?(i.params[a]=d.value,f(d.error)):(t[a]=d={error:null,match:l,value:l},void h()):f())}function h(e){var t=p[m++];if(d.value=i.params[c.name],e)return d.error=e,void f(e);if(!t)return f();try{t(i,n,h,l,c.name)}catch(e){h(e)}}f()},m.prototype.use=function(e){var t=0,i="/";if("function"!=typeof e){for(var o=e;Array.isArray(o)&&0!==o.length;)o=o[0];"function"!=typeof o&&(t=1,i=e)}var a=r(d.call(arguments,t));if(0===a.length)throw new TypeError("argument handler is required");for(var c=0;c<a.length;c++){var l=a[c];if("function"!=typeof l)throw new TypeError("argument handler must be a function");n("use %o %s",i,l.name||"<anonymous>");var p=new s(i,{sensitive:this.caseSensitive,strict:!1,end:!1},l);p.route=void 0,this.stack.push(p)}return this},m.prototype.route=function(e){var t=new l(e),i=new s(e,{sensitive:this.caseSensitive,strict:this.strict,end:!0},(function(e,i,n){t.dispatch(e,i,n)}));return i.route=t,this.stack.push(i),t},o.concat("all").forEach((function(e){m.prototype[e]=function(t){var i=this.route(t);return i[e].apply(i,d.call(arguments,1)),this}}))},8472:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createMonacoEvalDefaultsWithLibs=function(e,t,i){return`(function() {\n    const standardLibs = ${JSON.stringify(e)};\n    const scryptedLibs = ${JSON.stringify(t)};\n    const extraLibs = ${JSON.stringify(i)};\n\n    return (monaco) => {\n        (${function(e,t,i,n){e.languages.typescript.typescriptDefaults.setDiagnosticsOptions(Object.assign({},e.languages.typescript.typescriptDefaults.getDiagnosticsOptions(),{diagnosticCodesToIgnore:[1108,1375,1378]})),e.languages.typescript.typescriptDefaults.setCompilerOptions(Object.assign({},e.languages.typescript.typescriptDefaults.getCompilerOptions(),{moduleResolution:e.languages.typescript.ModuleResolutionKind.NodeJs}));const r={...i,...n},s=Object.values(r).join("\n"),o=Object.keys(r).map((e=>r[e])).map((e=>e.toString().replace(/export /g,"").replace(/import.*?/g,""))).join("\n");e.languages.typescript.typescriptDefaults.addExtraLib(`\n        ${s}\n\n        declare global {\n            ${o}\n\n            const log: Logger;\n\n            const deviceManager: DeviceManager;\n            const endpointManager: EndpointManager;\n            const mediaManager: MediaManager;\n            const systemManager: SystemManager;\n\n            const eventSource: ScryptedDevice;\n            const eventDetails: EventDetails;\n            const eventData: any;\n        }\n        `,"node_modules/@types/scrypted__sdk/types/index.d.ts");for(const i of Object.keys(t))e.languages.typescript.typescriptDefaults.addExtraLib(t[i],i)}})(monaco, standardLibs, scryptedLibs, extraLibs);\n    }\n    })();\n    `}},8523:(e,t,i)=>{"use strict";var n=i(3334),r=i(6055),s=i(1919),o=i(8531),a=i(5132),c=i(988),l=i(2891);const p=[n.map,s.seq,o.string,r.nullTag,a.boolTag,l.intOct,l.int,l.intHex,c.floatNaN,c.floatExp,c.float];t.schema=p},8531:(e,t,i)=>{"use strict";var n=i(7180);const r={identify:e=>"string"==typeof e,default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:(e,t,i,r)=>(t=Object.assign({actualString:!0},t),n.stringifyString(e,t,i,r))};t.string=r},8557:function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ScriptCore=t.ScriptCoreNativeId=void 0,t.newScript=async function(e,t){const i=new u.Script(e,t);return await i.run(),i};const c=o(i(2743)),l=i(6982),p=a(i(9896)),d=a(i(3236)),u=i(65),{deviceManager:m}=c.default;t.ScriptCoreNativeId="scriptcore";class f extends c.ScryptedDeviceBase{scripts=new Map;constructor(){super(t.ScriptCoreNativeId),this.systemDevice={deviceCreator:"Script"}}async getCreateDeviceSettings(){return[{key:"name",title:"Name",description:"The name or description of the new script."},{key:"template",title:"Template",description:"The script template to use as a starting point.",choices:p.default.readdirSync("examples").filter((e=>p.default.statSync("examples/"+e).isFile())).map((e=>d.default.basename(e)))}]}async createDevice(e){const{name:t,template:i}=e,n="script:"+(0,l.randomBytes)(8).toString("hex");await this.reportScript(n,t?.toString());const r=new u.Script(n);if(this.scripts.set(n,{script:r,worker:void 0}),i)try{await r.saveScript({script:p.default.readFileSync("examples/"+i).toString().split("\n").filter((e=>!e.includes("SCRYPTED_FILTER_EXAMPLE_LINE"))).join("\n").trim()}),await r.run()}catch(e){}return n}async getReadmeMarkdown(){return"Create powerful reusable scripts that can run complex actions or create custom devices."}async reportScript(e,t){const i={providerNativeId:this.nativeId,name:t,nativeId:e,type:c.ScryptedDeviceType.Program,interfaces:[c.ScryptedInterface.Scriptable,c.ScryptedInterface.Program]};return await m.onDeviceDiscovered(i)}async getDevice(e){const t=this.scripts.get(e);if(t){if(t.script)return t.script;t.worker?.terminate(),this.scripts.delete(e)}let i,n=new u.Script(e);const r=async(t,i,r)=>{const s=this.scripts.get(e);s?.script==n&&(s.script=void 0);const o={providerNativeId:this.nativeId,name:t,nativeId:e,type:i,interfaces:r,refresh:!0};return await m.onDeviceDiscovered(o)};if(n.providedInterfaces.length>2){const s=c.default.fork();i=s.worker;try{n=await(await s.result).newScript(e,r)}catch(t){i.terminate()}}return i?.on("exit",(()=>{if(this.scripts.get(e)?.worker===i&&(this.scripts.delete(e),m.getNativeIds().includes(e))){const t=new u.Script(e);r(t.providedName,t.providedType,t.providedInterfaces)}})),this.scripts.set(e,{script:n,worker:i}),n}async releaseDevice(e,t){const i=this.scripts.get(t)?.worker;this.scripts.delete(t),i?.terminate()}}t.ScriptCore=f},8611:e=>{"use strict";e.exports=require("http")},8644:(e,t,i)=>{"use strict";var n=i(9378);t.flowIndentCheck=function(e,t,i){if("flow-collection"===t?.type){const r=t.end[0];if(r.indent===e&&("]"===r.source||"}"===r.source)&&n.containsNewline(t)){i(r,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}}},8673:(e,t,i)=>{"use strict";var n=i(484),r=i(9125);const s={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"};class o{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},o.defaultYaml,e),this.tags=Object.assign({},o.defaultTags,t)}clone(){const e=new o(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new o(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:o.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},o.defaultTags)}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:o.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},o.defaultTags),this.atNextDocument=!1);const i=e.trim().split(/[ \t]+/),n=i.shift();switch(n){case"%TAG":{if(2!==i.length&&(t(0,"%TAG directive should contain exactly two parts"),i.length<2))return!1;const[e,n]=i;return this.tags[e]=n,!0}case"%YAML":{if(this.yaml.explicit=!0,1!==i.length)return t(0,"%YAML directive should contain exactly one part"),!1;const[e]=i;if("1.1"===e||"1.2"===e)return this.yaml.version=e,!0;return t(6,`Unsupported YAML version ${e}`,/^\d+\.\d+$/.test(e)),!1}default:return t(0,`Unknown directive ${n}`,!0),!1}}tagName(e,t){if("!"===e)return"!";if("!"!==e[0])return t(`Not a valid tag: ${e}`),null;if("<"===e[1]){const i=e.slice(2,-1);return"!"===i||"!!"===i?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(">"!==e[e.length-1]&&t("Verbatim tags must end with a >"),i)}const[,i,n]=e.match(/^(.*!)([^!]*)$/s);n||t(`The ${e} tag has no suffix`);const r=this.tags[i];if(r)try{return r+decodeURIComponent(n)}catch(e){return t(String(e)),null}return"!"===i?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[t,i]of Object.entries(this.tags))if(e.startsWith(i))return t+e.substring(i.length).replace(/[!,[\]{}]/g,(e=>s[e]));return"!"===e[0]?e:`!<${e}>`}toString(e){const t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],i=Object.entries(this.tags);let s;if(e&&i.length>0&&n.isNode(e.contents)){const t={};r.visit(e.contents,((e,i)=>{n.isNode(i)&&i.tag&&(t[i.tag]=!0)})),s=Object.keys(t)}else s=[];for(const[n,r]of i)"!!"===n&&"tag:yaml.org,2002:"===r||e&&!s.some((e=>e.startsWith(r)))||t.push(`%TAG ${n} ${r}`);return t.join("\n")}}o.defaultYaml={explicit:!1,version:"1.2"},o.defaultTags={"!!":"tag:yaml.org,2002:"},t.Directives=o},8803:function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.AggregateCore=t.AggregateCoreNativeId=void 0;const a=o(i(2743)),c=i(9775),{deviceManager:l}=a.default;t.AggregateCoreNativeId="aggregatecore";class p extends a.ScryptedDeviceBase{aggregate=new Map;constructor(){super(t.AggregateCoreNativeId),this.systemDevice={deviceCreator:"Device Group"}}async getReadmeMarkdown(){return"Combine multiple devices into a single virtual device. Commands sent to the device group will be sent to all the devices in that group."}async getCreateDeviceSettings(){return[{key:"name",title:"Name",description:"The name or description of the new device group."}]}async createDevice(e){const{name:t}=e,i=`aggregate:${Math.random()}`;await this.reportAggregate(i,[],t?.toString());const n=new c.AggregateDevice(this,i);return n.computeInterfaces(),this.aggregate.set(i,n),i}async reportAggregate(e,i,n){const r={providerNativeId:t.AggregateCoreNativeId,name:n,nativeId:e,type:a.ScryptedDeviceType.Unknown,interfaces:[a.ScryptedInterface.Settings,...i]};await l.onDeviceDiscovered(r)}async getDevice(e){let t=this.aggregate.get(e);return t||(t=new c.AggregateDevice(this,e),t.computeInterfaces(),this.aggregate.set(e,t),t)}async releaseDevice(e,t){const i=this.aggregate.get(t);i?.release()}}t.AggregateCore=p},8858:(e,t,i)=>{"undefined"!=typeof process&&"renderer"===process.type?e.exports=i(1114):e.exports=i(9408)},8898:(e,t,i)=>{"use strict";var n=i(6906),r=i(484),s=i(3732);t.NodeBase=class{constructor(e){Object.defineProperty(this,r.NODE_TYPE,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:i,onAnchor:o,reviver:a}={}){if(!r.isDocument(e))throw new TypeError("A document argument is required");const c={anchors:new Map,doc:e,keep:!0,mapAsMap:!0===t,mapKeyWarned:!1,maxAliasCount:"number"==typeof i?i:100},l=s.toJS(this,"",c);if("function"==typeof o)for(const{count:e,res:t}of c.anchors.values())o(t,e);return"function"==typeof a?n.applyReviver(a,{"":l},"",l):l}}},9023:e=>{"use strict";e.exports=require("util")},9046:(e,t,i)=>{"use strict";var n=i(1736),r=i(1614),s=i(484),o=i(7902),a=i(3732),c=i(625),l=i(1768),p=i(6261),d=i(6906),u=i(5219),m=i(8673);class f{constructor(e,t,i){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,s.NODE_TYPE,{value:s.DOC});let n=null;"function"==typeof t||Array.isArray(t)?n=t:void 0===i&&t&&(i=t,t=void 0);const r=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,uniqueKeys:!0,version:"1.2"},i);this.options=r;let{version:o}=r;i?._directives?(this.directives=i._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new m.Directives({version:o}),this.setSchema(o,i),this.contents=void 0===e?null:this.createNode(e,n,i)}clone(){const e=Object.create(f.prototype,{[s.NODE_TYPE]:{value:s.DOC}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=s.isNode(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){h(this.contents)&&this.contents.add(e)}addIn(e,t){h(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){const i=p.anchorNames(this);e.anchor=!t||i.has(t)?p.findNewAnchor(t||"a",i):t}return new n.Alias(e.anchor)}createNode(e,t,i){let n;if("function"==typeof t)e=t.call({"":e},"",e),n=t;else if(Array.isArray(t)){const e=e=>"number"==typeof e||e instanceof String||e instanceof Number,i=t.filter(e).map(String);i.length>0&&(t=t.concat(i)),n=t}else void 0===i&&t&&(i=t,t=void 0);const{aliasDuplicateObjects:r,anchorPrefix:o,flow:a,keepUndefined:c,onTagObj:l,tag:d}=i??{},{onAnchor:m,setAnchors:f,sourceObjects:h}=p.createNodeAnchors(this,o||"a"),g={aliasDuplicateObjects:r??!0,keepUndefined:c??!1,onAnchor:m,onTagObj:l,replacer:n,schema:this.schema,sourceObjects:h},v=u.createNode(e,d,g);return a&&s.isCollection(v)&&(v.flow=!0),f(),v}createPair(e,t,i={}){const n=this.createNode(e,null,i),r=this.createNode(t,null,i);return new o.Pair(n,r)}delete(e){return!!h(this.contents)&&this.contents.delete(e)}deleteIn(e){return r.isEmptyPath(e)?null!=this.contents&&(this.contents=null,!0):!!h(this.contents)&&this.contents.deleteIn(e)}get(e,t){return s.isCollection(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return r.isEmptyPath(e)?!t&&s.isScalar(this.contents)?this.contents.value:this.contents:s.isCollection(this.contents)?this.contents.getIn(e,t):void 0}has(e){return!!s.isCollection(this.contents)&&this.contents.has(e)}hasIn(e){return r.isEmptyPath(e)?void 0!==this.contents:!!s.isCollection(this.contents)&&this.contents.hasIn(e)}set(e,t){null==this.contents?this.contents=r.collectionFromPath(this.schema,[e],t):h(this.contents)&&this.contents.set(e,t)}setIn(e,t){r.isEmptyPath(e)?this.contents=t:null==this.contents?this.contents=r.collectionFromPath(this.schema,Array.from(e),t):h(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){let i;switch("number"==typeof e&&(e=String(e)),e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new m.Directives({version:"1.1"}),i={merge:!0,resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new m.Directives({version:e}),i={merge:!1,resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,i=null;break;default:{const t=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${t}`)}}if(t.schema instanceof Object)this.schema=t.schema;else{if(!i)throw new Error("With a null YAML version, the { schema: Schema } option is required");this.schema=new c.Schema(Object.assign(i,t))}}toJS({json:e,jsonArg:t,mapAsMap:i,maxAliasCount:n,onAnchor:r,reviver:s}={}){const o={anchors:new Map,doc:this,keep:!e,mapAsMap:!0===i,mapKeyWarned:!1,maxAliasCount:"number"==typeof n?n:100},c=a.toJS(this.contents,t??"",o);if("function"==typeof r)for(const{count:e,res:t}of o.anchors.values())r(t,e);return"function"==typeof s?d.applyReviver(s,{"":c},"",c):c}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return l.stringifyDocument(this,e)}}function h(e){if(s.isCollection(e))return!0;throw new Error("Expected a YAML collection as document contents")}t.Document=f},9094:(e,t,i)=>{"use strict";var n=i(484),r=i(9714),s=i(4070),o=i(7571);t.composeScalar=function(e,t,i,a){const{value:c,type:l,comment:p,range:d}="block-scalar"===t.type?s.resolveBlockScalar(e,t,a):o.resolveFlowScalar(t,e.options.strict,a),u=i?e.directives.tagName(i.source,(e=>a(i,"TAG_RESOLVE_FAILED",e))):null,m=i&&u?function(e,t,i,r,s){if("!"===i)return e[n.SCALAR];const o=[];for(const t of e.tags)if(!t.collection&&t.tag===i){if(!t.default||!t.test)return t;o.push(t)}for(const e of o)if(e.test?.test(t))return e;const a=e.knownTags[i];if(a&&!a.collection)return e.tags.push(Object.assign({},a,{default:!1,test:void 0})),a;return s(r,"TAG_RESOLVE_FAILED",`Unresolved tag: ${i}`,"tag:yaml.org,2002:str"!==i),e[n.SCALAR]}(e.schema,c,u,i,a):"scalar"===t.type?function({directives:e,schema:t},i,r,s){const o=t.tags.find((e=>e.default&&e.test?.test(i)))||t[n.SCALAR];if(t.compat){const a=t.compat.find((e=>e.default&&e.test?.test(i)))??t[n.SCALAR];if(o.tag!==a.tag){s(r,"TAG_RESOLVE_FAILED",`Value may be parsed as either ${e.tagString(o.tag)} or ${e.tagString(a.tag)}`,!0)}}return o}(e,c,t,a):e.schema[n.SCALAR];let f;try{const s=m.resolve(c,(e=>a(i??t,"TAG_RESOLVE_FAILED",e)),e.options);f=n.isScalar(s)?s:new r.Scalar(s)}catch(e){const n=e instanceof Error?e.message:String(e);a(i??t,"TAG_RESOLVE_FAILED",n),f=new r.Scalar(c)}return f.range=d,f.source=c,l&&(f.type=l),u&&(f.tag=u),m.format&&(f.format=m.format),p&&(f.comment=p),f}},9112:(e,t,i)=>{"use strict";var n=i(5141),r=i(7808),s=i(5970);t.createScalarToken=n.createScalarToken,t.resolveAsScalar=n.resolveAsScalar,t.setScalarValue=n.setScalarValue,t.stringify=r.stringify,t.visit=s.visit,t.BOM="\ufeff",t.DOCUMENT="",t.FLOW_END="",t.SCALAR="",t.isCollection=e=>!!e&&"items"in e,t.isScalar=e=>!!e&&("scalar"===e.type||"single-quoted-scalar"===e.type||"double-quoted-scalar"===e.type||"block-scalar"===e.type),t.prettyToken=function(e){switch(e){case"\ufeff":return"<BOM>";case"":return"<DOC>";case"":return"<FLOW_END>";case"":return"<SCALAR>";default:return JSON.stringify(e)}},t.tokenType=function(e){switch(e){case"\ufeff":return"byte-order-mark";case"":return"doc-mode";case"":return"flow-error-end";case"":return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case"\n":case"\r\n":return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(e[0]){case" ":case"\t":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}},9125:(e,t,i)=>{"use strict";var n=i(484);const r=Symbol("break visit"),s=Symbol("skip children"),o=Symbol("remove node");function a(e,t){const i=d(t);if(n.isDocument(e)){c(null,e.contents,i,Object.freeze([e]))===o&&(e.contents=null)}else c(null,e,i,Object.freeze([]))}function c(e,t,i,s){const a=u(e,t,i,s);if(n.isNode(a)||n.isPair(a))return m(e,s,a),c(e,a,i,s);if("symbol"!=typeof a)if(n.isCollection(t)){s=Object.freeze(s.concat(t));for(let e=0;e<t.items.length;++e){const n=c(e,t.items[e],i,s);if("number"==typeof n)e=n-1;else{if(n===r)return r;n===o&&(t.items.splice(e,1),e-=1)}}}else if(n.isPair(t)){s=Object.freeze(s.concat(t));const e=c("key",t.key,i,s);if(e===r)return r;e===o&&(t.key=null);const n=c("value",t.value,i,s);if(n===r)return r;n===o&&(t.value=null)}return a}async function l(e,t){const i=d(t);if(n.isDocument(e)){await p(null,e.contents,i,Object.freeze([e]))===o&&(e.contents=null)}else await p(null,e,i,Object.freeze([]))}async function p(e,t,i,s){const a=await u(e,t,i,s);if(n.isNode(a)||n.isPair(a))return m(e,s,a),p(e,a,i,s);if("symbol"!=typeof a)if(n.isCollection(t)){s=Object.freeze(s.concat(t));for(let e=0;e<t.items.length;++e){const n=await p(e,t.items[e],i,s);if("number"==typeof n)e=n-1;else{if(n===r)return r;n===o&&(t.items.splice(e,1),e-=1)}}}else if(n.isPair(t)){s=Object.freeze(s.concat(t));const e=await p("key",t.key,i,s);if(e===r)return r;e===o&&(t.key=null);const n=await p("value",t.value,i,s);if(n===r)return r;n===o&&(t.value=null)}return a}function d(e){return"object"==typeof e&&(e.Collection||e.Node||e.Value)?Object.assign({Alias:e.Node,Map:e.Node,Scalar:e.Node,Seq:e.Node},e.Value&&{Map:e.Value,Scalar:e.Value,Seq:e.Value},e.Collection&&{Map:e.Collection,Seq:e.Collection},e):e}function u(e,t,i,r){return"function"==typeof i?i(e,t,r):n.isMap(t)?i.Map?.(e,t,r):n.isSeq(t)?i.Seq?.(e,t,r):n.isPair(t)?i.Pair?.(e,t,r):n.isScalar(t)?i.Scalar?.(e,t,r):n.isAlias(t)?i.Alias?.(e,t,r):void 0}function m(e,t,i){const r=t[t.length-1];if(n.isCollection(r))r.items[e]=i;else if(n.isPair(r))"key"===e?r.key=i:r.value=i;else{if(!n.isDocument(r)){const e=n.isAlias(r)?"alias":"scalar";throw new Error(`Cannot replace node with ${e} parent`)}r.contents=i}}a.BREAK=r,a.SKIP=s,a.REMOVE=o,l.BREAK=r,l.SKIP=s,l.REMOVE=o,t.visit=a,t.visitAsync=l},9154:e=>{"use strict";e.exports=require("vm")},9278:e=>{"use strict";e.exports=require("net")},9378:(e,t)=>{"use strict";t.containsNewline=function e(t){if(!t)return null;switch(t.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(t.source.includes("\n"))return!0;if(t.end)for(const e of t.end)if("newline"===e.type)return!0;return!1;case"flow-collection":for(const i of t.items){for(const e of i.start)if("newline"===e.type)return!0;if(i.sep)for(const e of i.sep)if("newline"===e.type)return!0;if(e(i.key)||e(i.value))return!0}return!1;default:return!0}}},9408:(e,t,i)=>{var n=i(2018),r=i(9023);(t=e.exports=i(1917)).init=function(e){e.inspectOpts={};for(var i=Object.keys(t.inspectOpts),n=0;n<i.length;n++)e.inspectOpts[i[n]]=t.inspectOpts[i[n]]},t.log=function(){return o.write(r.format.apply(r,arguments)+"\n")},t.formatArgs=function(e){var i=this.namespace,n=this.useColors;if(n){var r=this.color,s="  [3"+r+";1m"+i+" [0m";e[0]=s+e[0].split("\n").join("\n"+s),e.push("[3"+r+"m+"+t.humanize(this.diff)+"[0m")}else e[0]=(new Date).toUTCString()+" "+i+" "+e[0]},t.save=function(e){null==e?delete process.env.DEBUG:process.env.DEBUG=e},t.load=a,t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):n.isatty(s)},t.colors=[6,2,3,4,5,1],t.inspectOpts=Object.keys(process.env).filter((function(e){return/^debug_/i.test(e)})).reduce((function(e,t){var i=t.substring(6).toLowerCase().replace(/_([a-z])/g,(function(e,t){return t.toUpperCase()})),n=process.env[t];return n=!!/^(yes|on|true|enabled)$/i.test(n)||!/^(no|off|false|disabled)$/i.test(n)&&("null"===n?null:Number(n)),e[i]=n,e}),{});var s=parseInt(process.env.DEBUG_FD,10)||2;1!==s&&2!==s&&r.deprecate((function(){}),"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var o=1===s?process.stdout:2===s?process.stderr:function(e){var t;switch(process.binding("tty_wrap").guessHandleType(e)){case"TTY":(t=new n.WriteStream(e))._type="tty",t._handle&&t._handle.unref&&t._handle.unref();break;case"FILE":(t=new(i(9896).SyncWriteStream)(e,{autoClose:!1}))._type="fs";break;case"PIPE":case"TCP":(t=new(i(9278).Socket)({fd:e,readable:!1,writable:!0})).readable=!1,t.read=null,t._type="pipe",t._handle&&t._handle.unref&&t._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return t.fd=e,t._isStdio=!0,t}(s);function a(){return process.env.DEBUG}t.formatters.o=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts).split("\n").map((function(e){return e.trim()})).join(" ")},t.formatters.O=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts)},t.enable(a())},9714:(e,t,i)=>{"use strict";var n=i(484),r=i(8898),s=i(3732);class o extends r.NodeBase{constructor(e){super(n.SCALAR),this.value=e}toJSON(e,t){return t?.keep?this.value:s.toJS(this.value,e,t)}toString(){return String(this.value)}}o.BLOCK_FOLDED="BLOCK_FOLDED",o.BLOCK_LITERAL="BLOCK_LITERAL",o.PLAIN="PLAIN",o.QUOTE_DOUBLE="QUOTE_DOUBLE",o.QUOTE_SINGLE="QUOTE_SINGLE",t.Scalar=o,t.isScalarValue=e=>!e||"function"!=typeof e&&"object"!=typeof e},9775:function(e,t,i){"use strict";var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.AggregateDevice=void 0;const a=o(i(2743)),c=i(1414),{systemManager:l,mediaManager:p,deviceManager:d}=a.default,u=new Map,m=e=>e.reduce(((e,t)=>e+(t||0)),0)/(e.length||0),f=e=>e.reduce(((e,t)=>e||t),!1),h=e=>e.reduce(((e,t)=>e&&t),!0);function g(e,t){const i=async()=>1===e.length?e[0].getVideoStreamOptions():[{id:"default",name:"Default",container:"ffmpeg",video:{},audio:null}];return{getVideoStreamOptions:async()=>i(),async getVideoStream(t){if(1===e.length)return e[0].getVideoStream(t);const n=await async function(){const t=e.length>4?"low-resolution":"medium-resolution",n=(await Promise.allSettled(e.map((async e=>{const i=await e.getVideoStream({destination:t}),n=await p.convertMediaObjectToBuffer(i,a.ScryptedMimeTypes.FFmpegInput);return JSON.parse(n.toString())})))).map((e=>e.value)).filter((e=>!!e));if(!n.length)throw new Error("no inputs");let r=1;for(;r*r<n.length;)r++;const s=1920/r,o=1080/r,c=["nullsrc=size=1920x1080 [base];"],l={url:void 0,container:"rawvideo",mediaStreamOptions:(await i())?.[0],inputArguments:[]};for(let e=0;e<n.length;e++)l.inputArguments.push(...n[e].inputArguments),c.push(`[${e}:v] scale=(iw*sar)*min(${s}/(iw*sar)\\,${o}/ih):ih*min(${s}/(iw*sar)\\,${o}/ih),pad=${s}:${o}:(${s}-iw*min(${s}/iw\\,${o}/ih))/2:(${o}-ih*min(${s}/iw\\,${o}/ih))/2 [pos${e}];`);for(let e=n.length;e<r*r;e++)l.inputArguments.push("-f","lavfi","-i",`color=black:s=${s}x${o}`),c.push(`[${e}:v] scale=${s}x${o} [pos${e}];`);let d="base",u=0,m=0;for(let e=0;e<r*r-1;e++){let t=`tmp${e}`;m=Math.floor(e/r)*o,c.push(`[${d}][pos${e}] overlay=shortest=1:x=${u%1920}:y=${m%1080} [${t}];`),d=t,u+=s}let f=r*r-1;return c.push(`[${d}][pos${f}] overlay=shortest=1:x=${u%1920}:y=${m%1080}`),l.inputArguments.push("-filter_complex",c.join(" ")),l}();return p.createFFmpegMediaObject(n)}}}u.set(a.ScryptedInterface.Online,h),u.set(a.ScryptedInterface.StartStop,h),u.set(a.ScryptedInterface.Pause,f),u.set(a.ScryptedInterface.OnOff,f),u.set(a.ScryptedInterface.Brightness,m),u.set(a.ScryptedInterface.Battery,m),u.set(a.ScryptedInterface.MotionSensor,m),u.set(a.ScryptedInterface.HumiditySensor,m),u.set(a.ScryptedInterface.Thermometer,m),u.set(a.ScryptedInterface.BinarySensor,f),u.set(a.ScryptedInterface.TamperSensor,f),u.set(a.ScryptedInterface.PowerSensor,f),u.set(a.ScryptedInterface.MotionSensor,f),u.set(a.ScryptedInterface.AudioSensor,f),u.set(a.ScryptedInterface.LuminanceSensor,m),u.set(a.ScryptedInterface.UltravioletSensor,m),u.set(a.ScryptedInterface.CO2Sensor,m),u.set(a.ScryptedInterface.PM25Sensor,m),u.set(a.ScryptedInterface.PM10Sensor,m),u.set(a.ScryptedInterface.NOXSensor,m),u.set(a.ScryptedInterface.FloodSensor,f),u.set(a.ScryptedInterface.Lock,(e=>e.reduce(((e,t)=>t===a.LockState.Unlocked?t:e),a.LockState.Locked)));class v extends a.ScryptedDeviceBase{core;listeners=[];storageSettings=new c.StorageSettings(this,{deviceInterfaces:{title:"Selected Device Interfaces",description:"The components of other devices to combine into this device group.",type:"interface",multiple:!0,deviceFilter:`id !== '${this.id}' && deviceInterface !== '${a.ScryptedInterface.Settings}'`,onPut:()=>{this.core.reportAggregate(this.nativeId,this.computeInterfaces(),this.providedName)}}});constructor(e,t){super(t),this.core=e;try{const e=this.storage.getItem("data");if(e){const{deviceInterfaces:t}=JSON.parse(e);this.storageSettings.values.deviceInterfaces=t}}catch(e){}this.storage.removeItem("data")}getSettings(){return this.storageSettings.getSettings()}putSetting(e,t){return this.storageSettings.putSetting(e,t)}makeListener(e,t){const i=u.get(e);if(!i){const i=d.getDeviceState(this.nativeId);for(const n of t){const t=n.listen({event:e,watch:!0},((e,t,n)=>{t.property&&(i[t.property]=n)}));this.listeners.push(t)}return}const n=a.ScryptedInterfaceDescriptors[e]?.properties?.[0];if(!n)return void this.console.warn("aggregating interface with no property?",e);const r=()=>{const e=t.map((e=>e[n]));this[n]=i(e)},s=()=>r();for(const i of t){const t=i.listen({event:e,watch:!0},s);this.listeners.push(t)}return r}release(){this.listeners.forEach((e=>e.removeListener())),this.listeners=[]}computeInterfaces(){this.release();try{const e=new Map;for(const t of this.storageSettings.values.deviceInterfaces){const i=t.split("#"),n=i[0],r=i[1];e.has(r)||e.set(r,[]),e.get(r).push(n)}for(const[t,i]of e.entries()){const e=i.map((e=>l.getDeviceById(e))),n=this.makeListener(t,e);n?.()}for(const[t,i]of e.entries()){const e=i.map((e=>l.getDeviceById(e))),n=a.ScryptedInterfaceDescriptors[t];if(n)if(t!==a.ScryptedInterface.VideoCamera)for(const t of n.methods)this[t]=async function(...i){const n=[];for(const r of e)n.push(r[t](...i));return(await Promise.all(n))[0]};else{const t=g(e,this.console);for(const e of n.methods)this[e]=(...i)=>t[e](...i)}else this.console.warn(`descriptor not found for ${t}, skipping method generation`)}return[...e.keys()]}catch(e){return[]}}}t.AggregateDevice=v},9849:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScryptedMimeTypes=t.ScryptedInterface=t.MediaPlayerState=t.SecuritySystemObstruction=t.SecuritySystemMode=t.AirQuality=t.AirPurifierMode=t.AirPurifierStatus=t.ChargeState=t.LockState=t.PanTiltZoomMovement=t.ThermostatMode=t.TemperatureUnit=t.FanMode=t.HumidityMode=t.ScryptedDeviceType=t.ScryptedInterfaceDescriptors=t.ScryptedInterfaceMethod=t.ScryptedInterfaceProperty=t.DeviceBase=t.TYPES_VERSION=void 0,t.TYPES_VERSION="0.5.51";var i,n,r,s,o,a,c,l,p,d,u,m,f,h,g,v,y,S;t.DeviceBase=class{},function(e){e.id="id",e.info="info",e.interfaces="interfaces",e.mixins="mixins",e.name="name",e.nativeId="nativeId",e.pluginId="pluginId",e.providedInterfaces="providedInterfaces",e.providedName="providedName",e.providedRoom="providedRoom",e.providedType="providedType",e.providerId="providerId",e.room="room",e.type="type",e.scryptedRuntimeArguments="scryptedRuntimeArguments",e.on="on",e.brightness="brightness",e.colorTemperature="colorTemperature",e.rgb="rgb",e.hsv="hsv",e.buttons="buttons",e.sensors="sensors",e.running="running",e.paused="paused",e.docked="docked",e.temperatureSetting="temperatureSetting",e.temperature="temperature",e.temperatureUnit="temperatureUnit",e.humidity="humidity",e.resolution="resolution",e.audioVolumes="audioVolumes",e.recordingActive="recordingActive",e.ptzCapabilities="ptzCapabilities",e.lockState="lockState",e.entryOpen="entryOpen",e.batteryLevel="batteryLevel",e.chargeState="chargeState",e.online="online",e.fromMimeType="fromMimeType",e.toMimeType="toMimeType",e.converters="converters",e.binaryState="binaryState",e.tampered="tampered",e.sleeping="sleeping",e.powerDetected="powerDetected",e.audioDetected="audioDetected",e.motionDetected="motionDetected",e.ambientLight="ambientLight",e.occupied="occupied",e.flooded="flooded",e.ultraviolet="ultraviolet",e.luminance="luminance",e.position="position",e.securitySystemState="securitySystemState",e.pm10Density="pm10Density",e.pm25Density="pm25Density",e.vocDensity="vocDensity",e.noxDensity="noxDensity",e.co2ppm="co2ppm",e.airQuality="airQuality",e.airPurifierState="airPurifierState",e.filterChangeIndication="filterChangeIndication",e.filterLifeLevel="filterLifeLevel",e.humiditySetting="humiditySetting",e.fan="fan",e.applicationInfo="applicationInfo",e.chatCompletionCapabilities="chatCompletionCapabilities",e.systemDevice="systemDevice"}(i||(t.ScryptedInterfaceProperty=i={})),function(e){e.listen="listen",e.probe="probe",e.setMixins="setMixins",e.setName="setName",e.setRoom="setRoom",e.setType="setType",e.getPluginJson="getPluginJson",e.turnOff="turnOff",e.turnOn="turnOn",e.setBrightness="setBrightness",e.getTemperatureMaxK="getTemperatureMaxK",e.getTemperatureMinK="getTemperatureMinK",e.setColorTemperature="setColorTemperature",e.setRgb="setRgb",e.setHsv="setHsv",e.pressButton="pressButton",e.sendNotification="sendNotification",e.start="start",e.stop="stop",e.pause="pause",e.resume="resume",e.dock="dock",e.setTemperature="setTemperature",e.setTemperatureUnit="setTemperatureUnit",e.getPictureOptions="getPictureOptions",e.takePicture="takePicture",e.getAudioStream="getAudioStream",e.setAudioVolumes="setAudioVolumes",e.startDisplay="startDisplay",e.stopDisplay="stopDisplay",e.getVideoStream="getVideoStream",e.getVideoStreamOptions="getVideoStreamOptions",e.getPrivacyMasks="getPrivacyMasks",e.setPrivacyMasks="setPrivacyMasks",e.getVideoTextOverlays="getVideoTextOverlays",e.setVideoTextOverlay="setVideoTextOverlay",e.getRecordingStream="getRecordingStream",e.getRecordingStreamCurrentTime="getRecordingStreamCurrentTime",e.getRecordingStreamOptions="getRecordingStreamOptions",e.getRecordingStreamThumbnail="getRecordingStreamThumbnail",e.deleteRecordingStream="deleteRecordingStream",e.setRecordingActive="setRecordingActive",e.ptzCommand="ptzCommand",e.getRecordedEvents="getRecordedEvents",e.getVideoClip="getVideoClip",e.getVideoClips="getVideoClips",e.getVideoClipThumbnail="getVideoClipThumbnail",e.removeVideoClips="removeVideoClips",e.setVideoStreamOptions="setVideoStreamOptions",e.startIntercom="startIntercom",e.stopIntercom="stopIntercom",e.lock="lock",e.unlock="unlock",e.addPassword="addPassword",e.getPasswords="getPasswords",e.removePassword="removePassword",e.activate="activate",e.deactivate="deactivate",e.isReversible="isReversible",e.closeEntry="closeEntry",e.openEntry="openEntry",e.getDevice="getDevice",e.releaseDevice="releaseDevice",e.adoptDevice="adoptDevice",e.discoverDevices="discoverDevices",e.createDevice="createDevice",e.getCreateDeviceSettings="getCreateDeviceSettings",e.reboot="reboot",e.getRefreshFrequency="getRefreshFrequency",e.refresh="refresh",e.getMediaStatus="getMediaStatus",e.load="load",e.seek="seek",e.skipNext="skipNext",e.skipPrevious="skipPrevious",e.convert="convert",e.convertMedia="convertMedia",e.getSettings="getSettings",e.putSetting="putSetting",e.armSecuritySystem="armSecuritySystem",e.disarmSecuritySystem="disarmSecuritySystem",e.setAirPurifierState="setAirPurifierState",e.getReadmeMarkdown="getReadmeMarkdown",e.getOauthUrl="getOauthUrl",e.onOauthCallback="onOauthCallback",e.canMixin="canMixin",e.getMixin="getMixin",e.releaseMixin="releaseMixin",e.onRequest="onRequest",e.onConnection="onConnection",e.onPush="onPush",e.run="run",e.eval="eval",e.loadScripts="loadScripts",e.saveScript="saveScript",e.forkInterface="forkInterface",e.getDetectionInput="getDetectionInput",e.getObjectTypes="getObjectTypes",e.detectObjects="detectObjects",e.generateObjectDetections="generateObjectDetections",e.getDetectionModel="getDetectionModel",e.setHumidity="setHumidity",e.setFan="setFan",e.startRTCSignalingSession="startRTCSignalingSession",e.createRTCSignalingSession="createRTCSignalingSession",e.getScryptedUserAccessControl="getScryptedUserAccessControl",e.generateVideoFrames="generateVideoFrames",e.connectStream="connectStream",e.getTTYSettings="getTTYSettings",e.getChatCompletion="getChatCompletion",e.streamChatCompletion="streamChatCompletion",e.getTextEmbedding="getTextEmbedding",e.getImageEmbedding="getImageEmbedding",e.callLLMTool="callLLMTool",e.getLLMTools="getLLMTools"}(n||(t.ScryptedInterfaceMethod=n={})),t.ScryptedInterfaceDescriptors={ScryptedDevice:{name:"ScryptedDevice",methods:["listen","probe","setMixins","setName","setRoom","setType"],properties:["id","info","interfaces","mixins","name","nativeId","pluginId","providedInterfaces","providedName","providedRoom","providedType","providerId","room","type"]},ScryptedPlugin:{name:"ScryptedPlugin",methods:["getPluginJson"],properties:[]},ScryptedPluginRuntime:{name:"ScryptedPluginRuntime",methods:[],properties:["scryptedRuntimeArguments"]},OnOff:{name:"OnOff",methods:["turnOff","turnOn"],properties:["on"]},Brightness:{name:"Brightness",methods:["setBrightness"],properties:["brightness"]},ColorSettingTemperature:{name:"ColorSettingTemperature",methods:["getTemperatureMaxK","getTemperatureMinK","setColorTemperature"],properties:["colorTemperature"]},ColorSettingRgb:{name:"ColorSettingRgb",methods:["setRgb"],properties:["rgb"]},ColorSettingHsv:{name:"ColorSettingHsv",methods:["setHsv"],properties:["hsv"]},Buttons:{name:"Buttons",methods:[],properties:["buttons"]},PressButtons:{name:"PressButtons",methods:["pressButton"],properties:[]},Sensors:{name:"Sensors",methods:[],properties:["sensors"]},Notifier:{name:"Notifier",methods:["sendNotification"],properties:[]},StartStop:{name:"StartStop",methods:["start","stop"],properties:["running"]},Pause:{name:"Pause",methods:["pause","resume"],properties:["paused"]},Dock:{name:"Dock",methods:["dock"],properties:["docked"]},TemperatureSetting:{name:"TemperatureSetting",methods:["setTemperature"],properties:["temperatureSetting"]},Thermometer:{name:"Thermometer",methods:["setTemperatureUnit"],properties:["temperature","temperatureUnit"]},HumiditySensor:{name:"HumiditySensor",methods:[],properties:["humidity"]},Camera:{name:"Camera",methods:["getPictureOptions","takePicture"],properties:[]},Resolution:{name:"Resolution",methods:[],properties:["resolution"]},Microphone:{name:"Microphone",methods:["getAudioStream"],properties:[]},AudioVolumeControl:{name:"AudioVolumeControl",methods:["setAudioVolumes"],properties:["audioVolumes"]},Display:{name:"Display",methods:["startDisplay","stopDisplay"],properties:[]},VideoCamera:{name:"VideoCamera",methods:["getVideoStream","getVideoStreamOptions"],properties:[]},VideoCameraMask:{name:"VideoCameraMask",methods:["getPrivacyMasks","setPrivacyMasks"],properties:[]},VideoTextOverlays:{name:"VideoTextOverlays",methods:["getVideoTextOverlays","setVideoTextOverlay"],properties:[]},VideoRecorder:{name:"VideoRecorder",methods:["getRecordingStream","getRecordingStreamCurrentTime","getRecordingStreamOptions","getRecordingStreamThumbnail"],properties:["recordingActive"]},VideoRecorderManagement:{name:"VideoRecorderManagement",methods:["deleteRecordingStream","setRecordingActive"],properties:[]},PanTiltZoom:{name:"PanTiltZoom",methods:["ptzCommand"],properties:["ptzCapabilities"]},EventRecorder:{name:"EventRecorder",methods:["getRecordedEvents"],properties:[]},VideoClips:{name:"VideoClips",methods:["getVideoClip","getVideoClips","getVideoClipThumbnail","removeVideoClips"],properties:[]},VideoCameraConfiguration:{name:"VideoCameraConfiguration",methods:["setVideoStreamOptions"],properties:[]},Intercom:{name:"Intercom",methods:["startIntercom","stopIntercom"],properties:[]},Lock:{name:"Lock",methods:["lock","unlock"],properties:["lockState"]},PasswordStore:{name:"PasswordStore",methods:["addPassword","getPasswords","removePassword"],properties:[]},Scene:{name:"Scene",methods:["activate","deactivate","isReversible"],properties:[]},Entry:{name:"Entry",methods:["closeEntry","openEntry"],properties:[]},EntrySensor:{name:"EntrySensor",methods:[],properties:["entryOpen"]},DeviceProvider:{name:"DeviceProvider",methods:["getDevice","releaseDevice"],properties:[]},DeviceDiscovery:{name:"DeviceDiscovery",methods:["adoptDevice","discoverDevices"],properties:[]},DeviceCreator:{name:"DeviceCreator",methods:["createDevice","getCreateDeviceSettings"],properties:[]},Battery:{name:"Battery",methods:[],properties:["batteryLevel"]},Charger:{name:"Charger",methods:[],properties:["chargeState"]},Reboot:{name:"Reboot",methods:["reboot"],properties:[]},Refresh:{name:"Refresh",methods:["getRefreshFrequency","refresh"],properties:[]},MediaPlayer:{name:"MediaPlayer",methods:["getMediaStatus","load","seek","skipNext","skipPrevious"],properties:[]},Online:{name:"Online",methods:[],properties:["online"]},BufferConverter:{name:"BufferConverter",methods:["convert"],properties:["fromMimeType","toMimeType"]},MediaConverter:{name:"MediaConverter",methods:["convertMedia"],properties:["converters"]},Settings:{name:"Settings",methods:["getSettings","putSetting"],properties:[]},BinarySensor:{name:"BinarySensor",methods:[],properties:["binaryState"]},TamperSensor:{name:"TamperSensor",methods:[],properties:["tampered"]},Sleep:{name:"Sleep",methods:[],properties:["sleeping"]},PowerSensor:{name:"PowerSensor",methods:[],properties:["powerDetected"]},AudioSensor:{name:"AudioSensor",methods:[],properties:["audioDetected"]},MotionSensor:{name:"MotionSensor",methods:[],properties:["motionDetected"]},AmbientLightSensor:{name:"AmbientLightSensor",methods:[],properties:["ambientLight"]},OccupancySensor:{name:"OccupancySensor",methods:[],properties:["occupied"]},FloodSensor:{name:"FloodSensor",methods:[],properties:["flooded"]},UltravioletSensor:{name:"UltravioletSensor",methods:[],properties:["ultraviolet"]},LuminanceSensor:{name:"LuminanceSensor",methods:[],properties:["luminance"]},PositionSensor:{name:"PositionSensor",methods:[],properties:["position"]},SecuritySystem:{name:"SecuritySystem",methods:["armSecuritySystem","disarmSecuritySystem"],properties:["securitySystemState"]},PM10Sensor:{name:"PM10Sensor",methods:[],properties:["pm10Density"]},PM25Sensor:{name:"PM25Sensor",methods:[],properties:["pm25Density"]},VOCSensor:{name:"VOCSensor",methods:[],properties:["vocDensity"]},NOXSensor:{name:"NOXSensor",methods:[],properties:["noxDensity"]},CO2Sensor:{name:"CO2Sensor",methods:[],properties:["co2ppm"]},AirQualitySensor:{name:"AirQualitySensor",methods:[],properties:["airQuality"]},AirPurifier:{name:"AirPurifier",methods:["setAirPurifierState"],properties:["airPurifierState"]},FilterMaintenance:{name:"FilterMaintenance",methods:[],properties:["filterChangeIndication","filterLifeLevel"]},Readme:{name:"Readme",methods:["getReadmeMarkdown"],properties:[]},OauthClient:{name:"OauthClient",methods:["getOauthUrl","onOauthCallback"],properties:[]},MixinProvider:{name:"MixinProvider",methods:["canMixin","getMixin","releaseMixin"],properties:[]},HttpRequestHandler:{name:"HttpRequestHandler",methods:["onRequest"],properties:[]},EngineIOHandler:{name:"EngineIOHandler",methods:["onConnection"],properties:[]},PushHandler:{name:"PushHandler",methods:["onPush"],properties:[]},Program:{name:"Program",methods:["run"],properties:[]},Scriptable:{name:"Scriptable",methods:["eval","loadScripts","saveScript"],properties:[]},ClusterForkInterface:{name:"ClusterForkInterface",methods:["forkInterface"],properties:[]},ObjectDetector:{name:"ObjectDetector",methods:["getDetectionInput","getObjectTypes"],properties:[]},ObjectDetection:{name:"ObjectDetection",methods:["detectObjects","generateObjectDetections","getDetectionModel"],properties:[]},ObjectDetectionPreview:{name:"ObjectDetectionPreview",methods:[],properties:[]},ObjectDetectionGenerator:{name:"ObjectDetectionGenerator",methods:[],properties:[]},HumiditySetting:{name:"HumiditySetting",methods:["setHumidity"],properties:["humiditySetting"]},Fan:{name:"Fan",methods:["setFan"],properties:["fan"]},RTCSignalingChannel:{name:"RTCSignalingChannel",methods:["startRTCSignalingSession"],properties:[]},RTCSignalingClient:{name:"RTCSignalingClient",methods:["createRTCSignalingSession"],properties:[]},LauncherApplication:{name:"LauncherApplication",methods:[],properties:["applicationInfo"]},ScryptedUser:{name:"ScryptedUser",methods:["getScryptedUserAccessControl"],properties:[]},VideoFrameGenerator:{name:"VideoFrameGenerator",methods:["generateVideoFrames"],properties:[]},StreamService:{name:"StreamService",methods:["connectStream"],properties:[]},TTY:{name:"TTY",methods:[],properties:[]},TTYSettings:{name:"TTYSettings",methods:["getTTYSettings"],properties:[]},ChatCompletion:{name:"ChatCompletion",methods:["getChatCompletion","streamChatCompletion"],properties:["chatCompletionCapabilities"]},TextEmbedding:{name:"TextEmbedding",methods:["getTextEmbedding"],properties:[]},ImageEmbedding:{name:"ImageEmbedding",methods:["getImageEmbedding"],properties:[]},LLMTools:{name:"LLMTools",methods:["callLLMTool","getLLMTools"],properties:[]},ScryptedSystemDevice:{name:"ScryptedSystemDevice",methods:[],properties:["systemDevice"]},ScryptedDeviceCreator:{name:"ScryptedDeviceCreator",methods:[],properties:[]},ScryptedSettings:{name:"ScryptedSettings",methods:[],properties:[]}},function(e){e.Builtin="Builtin",e.Internal="Internal",e.Camera="Camera",e.Fan="Fan",e.Light="Light",e.Switch="Switch",e.Outlet="Outlet",e.Sensor="Sensor",e.Scene="Scene",e.Program="Program",e.Automation="Automation",e.Vacuum="Vacuum",e.Notifier="Notifier",e.Thermostat="Thermostat",e.Lock="Lock",e.PasswordControl="PasswordControl",e.Display="Display",e.SmartDisplay="SmartDisplay",e.Speaker="Speaker",e.SmartSpeaker="SmartSpeaker",e.RemoteDesktop="RemoteDesktop",e.Event="Event",e.Entry="Entry",e.Garage="Garage",e.DeviceProvider="DeviceProvider",e.DataSource="DataSource",e.API="API",e.Buttons="Buttons",e.Doorbell="Doorbell",e.Irrigation="Irrigation",e.Valve="Valve",e.Person="Person",e.SecuritySystem="SecuritySystem",e.WindowCovering="WindowCovering",e.Siren="Siren",e.AirPurifier="AirPurifier",e.Internet="Internet",e.Network="Network",e.Bridge="Bridge",e.LLM="LLM",e.Unknown="Unknown"}(r||(t.ScryptedDeviceType=r={})),function(e){e.Humidify="Humidify",e.Dehumidify="Dehumidify",e.Auto="Auto",e.Off="Off"}(s||(t.HumidityMode=s={})),function(e){e.Auto="Auto",e.Manual="Manual"}(o||(t.FanMode=o={})),function(e){e.C="C",e.F="F"}(a||(t.TemperatureUnit=a={})),function(e){e.Off="Off",e.Cool="Cool",e.Heat="Heat",e.HeatCool="HeatCool",e.Auto="Auto",e.FanOnly="FanOnly",e.Purifier="Purifier",e.Eco="Eco",e.Dry="Dry",e.On="On"}(c||(t.ThermostatMode=c={})),function(e){e.Absolute="Absolute",e.Relative="Relative",e.Continuous="Continuous",e.Preset="Preset",e.Home="Home"}(l||(t.PanTiltZoomMovement=l={})),function(e){e.Locked="Locked",e.Unlocked="Unlocked",e.Jammed="Jammed"}(p||(t.LockState=p={})),function(e){e.Trickle="trickle",e.Charging="charging",e.NotCharging="not-charging"}(d||(t.ChargeState=d={})),function(e){e.Inactive="Inactive",e.Idle="Idle",e.Active="Active",e.ActiveNightMode="ActiveNightMode"}(u||(t.AirPurifierStatus=u={})),function(e){e.Manual="Manual",e.Automatic="Automatic"}(m||(t.AirPurifierMode=m={})),function(e){e.Unknown="Unknown",e.Excellent="Excellent",e.Good="Good",e.Fair="Fair",e.Inferior="Inferior",e.Poor="Poor"}(f||(t.AirQuality=f={})),function(e){e.Disarmed="Disarmed",e.HomeArmed="HomeArmed",e.AwayArmed="AwayArmed",e.NightArmed="NightArmed"}(h||(t.SecuritySystemMode=h={})),function(e){e.Sensor="Sensor",e.Occupied="Occupied",e.Time="Time",e.Error="Error"}(g||(t.SecuritySystemObstruction=g={})),function(e){e.Idle="Idle",e.Playing="Playing",e.Paused="Paused",e.Buffering="Buffering"}(v||(t.MediaPlayerState=v={})),function(e){e.ScryptedDevice="ScryptedDevice",e.ScryptedPlugin="ScryptedPlugin",e.ScryptedPluginRuntime="ScryptedPluginRuntime",e.OnOff="OnOff",e.Brightness="Brightness",e.ColorSettingTemperature="ColorSettingTemperature",e.ColorSettingRgb="ColorSettingRgb",e.ColorSettingHsv="ColorSettingHsv",e.Buttons="Buttons",e.PressButtons="PressButtons",e.Sensors="Sensors",e.Notifier="Notifier",e.StartStop="StartStop",e.Pause="Pause",e.Dock="Dock",e.TemperatureSetting="TemperatureSetting",e.Thermometer="Thermometer",e.HumiditySensor="HumiditySensor",e.Camera="Camera",e.Resolution="Resolution",e.Microphone="Microphone",e.AudioVolumeControl="AudioVolumeControl",e.Display="Display",e.VideoCamera="VideoCamera",e.VideoCameraMask="VideoCameraMask",e.VideoTextOverlays="VideoTextOverlays",e.VideoRecorder="VideoRecorder",e.VideoRecorderManagement="VideoRecorderManagement",e.PanTiltZoom="PanTiltZoom",e.EventRecorder="EventRecorder",e.VideoClips="VideoClips",e.VideoCameraConfiguration="VideoCameraConfiguration",e.Intercom="Intercom",e.Lock="Lock",e.PasswordStore="PasswordStore",e.Scene="Scene",e.Entry="Entry",e.EntrySensor="EntrySensor",e.DeviceProvider="DeviceProvider",e.DeviceDiscovery="DeviceDiscovery",e.DeviceCreator="DeviceCreator",e.Battery="Battery",e.Charger="Charger",e.Reboot="Reboot",e.Refresh="Refresh",e.MediaPlayer="MediaPlayer",e.Online="Online",e.BufferConverter="BufferConverter",e.MediaConverter="MediaConverter",e.Settings="Settings",e.BinarySensor="BinarySensor",e.TamperSensor="TamperSensor",e.Sleep="Sleep",e.PowerSensor="PowerSensor",e.AudioSensor="AudioSensor",e.MotionSensor="MotionSensor",e.AmbientLightSensor="AmbientLightSensor",e.OccupancySensor="OccupancySensor",e.FloodSensor="FloodSensor",e.UltravioletSensor="UltravioletSensor",e.LuminanceSensor="LuminanceSensor",e.PositionSensor="PositionSensor",e.SecuritySystem="SecuritySystem",e.PM10Sensor="PM10Sensor",e.PM25Sensor="PM25Sensor",e.VOCSensor="VOCSensor",e.NOXSensor="NOXSensor",e.CO2Sensor="CO2Sensor",e.AirQualitySensor="AirQualitySensor",e.AirPurifier="AirPurifier",e.FilterMaintenance="FilterMaintenance",e.Readme="Readme",e.OauthClient="OauthClient",e.MixinProvider="MixinProvider",e.HttpRequestHandler="HttpRequestHandler",e.EngineIOHandler="EngineIOHandler",e.PushHandler="PushHandler",e.Program="Program",e.Scriptable="Scriptable",e.ClusterForkInterface="ClusterForkInterface",e.ObjectDetector="ObjectDetector",e.ObjectDetection="ObjectDetection",e.ObjectDetectionPreview="ObjectDetectionPreview",e.ObjectDetectionGenerator="ObjectDetectionGenerator",e.HumiditySetting="HumiditySetting",e.Fan="Fan",e.RTCSignalingChannel="RTCSignalingChannel",e.RTCSignalingClient="RTCSignalingClient",e.LauncherApplication="LauncherApplication",e.ScryptedUser="ScryptedUser",e.VideoFrameGenerator="VideoFrameGenerator",e.StreamService="StreamService",e.TTY="TTY",e.TTYSettings="TTYSettings",e.ChatCompletion="ChatCompletion",e.TextEmbedding="TextEmbedding",e.ImageEmbedding="ImageEmbedding",e.LLMTools="LLMTools",e.ScryptedSystemDevice="ScryptedSystemDevice",e.ScryptedDeviceCreator="ScryptedDeviceCreator",e.ScryptedSettings="ScryptedSettings"}(y||(t.ScryptedInterface=y={})),function(e){e.Url="text/x-uri",e.InsecureLocalUrl="text/x-insecure-local-uri",e.LocalUrl="text/x-local-uri",e.ServerId="text/x-server-id",e.PushEndpoint="text/x-push-endpoint",e.SchemePrefix="x-scrypted/x-scrypted-scheme-",e.MediaStreamUrl="text/x-media-url",e.MediaObject="x-scrypted/x-scrypted-media-object",e.RequestMediaObject="x-scrypted/x-scrypted-request-media-object",e.RequestMediaStream="x-scrypted/x-scrypted-request-stream",e.MediaStreamFeedback="x-scrypted/x-media-stream-feedback",e.FFmpegInput="x-scrypted/x-ffmpeg-input",e.FFmpegTranscodeStream="x-scrypted/x-ffmpeg-transcode-stream",e.RTCSignalingChannel="x-scrypted/x-scrypted-rtc-signaling-channel",e.RTCSignalingSession="x-scrypted/x-scrypted-rtc-signaling-session",e.RTCConnectionManagement="x-scrypted/x-scrypted-rtc-connection-management",e.Image="x-scrypted/x-scrypted-image"}(S||(t.ScryptedMimeTypes=S={}))},9896:e=>{"use strict";e.exports=require("fs")}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__),i.exports}__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__=__webpack_require__(431),__webpack_export_target__=exports="undefined"==typeof exports?{}:exports;for(var __webpack_i__ in __webpack_exports__)__webpack_export_target__[__webpack_i__]=__webpack_exports__[__webpack_i__];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0})})();
//# sourceMappingURL=main.nodejs.js.map