{"version":3,"file":"main.nodejs.js","mappings":"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","sources":["../../../server/node_modules/debug/src/node.js","../src/parse-dims.ts","../../../sdk/dist/src|sync","../src/main.ts","../../../server/src/promise-utils.ts","../external node-commonjs \"os\"","../external node-commonjs \"process\"","../../../common/src/http-auth-fetch.ts","../../../common/src/ffmpeg-helpers.ts","../../../sdk/dist/src/storage-settings.js","../../../server/node_modules/debug/src/index.js","../../../common/src/settings-mixin.ts","../src/image-converter.ts","../external node-commonjs \"tty\"","../external node-commonjs \"stream\"","../../../packages/auth-fetch/node_modules/yerror/dist/index.js","../../../packages/auth-fetch/node_modules/http-auth-utils/dist/utils.js","../../../packages/auth-fetch/node_modules/http-auth-utils/dist/mechanisms/basic.js","../external node-commonjs \"crypto\"","../../../packages/auth-fetch/node_modules/http-auth-utils/dist/mechanisms/digest.js","../../../packages/auth-fetch/node_modules/http-auth-utils/dist/mechanisms/bearer.js","../../../packages/auth-fetch/node_modules/http-auth-utils/dist/index.js","../external node-commonjs \"assert\"","../node_modules/whatwg-mimetype/lib/utils.js","../../../sdk/dist/src/index.js","../../../common/src/autoenable-mixin-provider.ts","../../../server/src/media-helpers.ts","../external node-commonjs \"module\"","../../../common/src/media-helpers.ts","../src/ffmpeg-image-filter.ts","../../../packages/auth-fetch/src/auth-fetch.ts","../../../sdk/polyfill/sharp.js","../node_modules/whatwg-mimetype/lib/serializer.js","../../../server/node_modules/follow-redirects/index.js","../../objectdetector/src/polygon.ts","../external node-commonjs \"console\"","../external node-commonjs \"events\"","../../../server/src/sleep.ts","../node_modules/whatwg-mimetype/lib/mime-type.js","../external node-commonjs \"child_process\"","../../../server/node_modules/ms/index.js","../external node-commonjs \"https\"","../../../server/node_modules/debug/src/common.js","../node_modules/whatwg-mimetype/lib/parser.js","../src/image-writer.ts","../src/image-reader.ts","../external node-commonjs \"path\"","../src/pipe2jpeg.ts","../external node-commonjs \"url\"","../../../server/node_modules/follow-redirects/debug.js","../../../common/src/sleep.ts","../node_modules/whatwg-mimetype/lib/mime-type-parameters.js","../external node-commonjs \"http\"","../external node-commonjs \"util\"","../../../server/src/fetch/http-fetch.ts","../../../server/src/fetch/index.ts","../../../server/node_modules/debug/src/browser.js","../../../sdk/dist/types/gen/index.js","../external node-commonjs \"fs\"","../webpack/bootstrap","../webpack/runtime/define property getters","../webpack/runtime/hasOwnProperty shorthand","../webpack/startup"],"sourcesContent":["/**\n * Module dependencies.\n */\n\nconst tty = require('tty');\nconst util = require('util');\n\n/**\n * This is the Node.js implementation of `debug()`.\n */\n\nexports.init = init;\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.destroy = util.deprecate(\n\t() => {},\n\t'Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.'\n);\n\n/**\n * Colors.\n */\n\nexports.colors = [6, 2, 3, 4, 5, 1];\n\ntry {\n\t// Optional dependency (as in, doesn't need to be installed, NOT like optionalDependencies in package.json)\n\t// eslint-disable-next-line import/no-extraneous-dependencies\n\tconst supportsColor = require('supports-color');\n\n\tif (supportsColor && (supportsColor.stderr || supportsColor).level >= 2) {\n\t\texports.colors = [\n\t\t\t20,\n\t\t\t21,\n\t\t\t26,\n\t\t\t27,\n\t\t\t32,\n\t\t\t33,\n\t\t\t38,\n\t\t\t39,\n\t\t\t40,\n\t\t\t41,\n\t\t\t42,\n\t\t\t43,\n\t\t\t44,\n\t\t\t45,\n\t\t\t56,\n\t\t\t57,\n\t\t\t62,\n\t\t\t63,\n\t\t\t68,\n\t\t\t69,\n\t\t\t74,\n\t\t\t75,\n\t\t\t76,\n\t\t\t77,\n\t\t\t78,\n\t\t\t79,\n\t\t\t80,\n\t\t\t81,\n\t\t\t92,\n\t\t\t93,\n\t\t\t98,\n\t\t\t99,\n\t\t\t112,\n\t\t\t113,\n\t\t\t128,\n\t\t\t129,\n\t\t\t134,\n\t\t\t135,\n\t\t\t148,\n\t\t\t149,\n\t\t\t160,\n\t\t\t161,\n\t\t\t162,\n\t\t\t163,\n\t\t\t164,\n\t\t\t165,\n\t\t\t166,\n\t\t\t167,\n\t\t\t168,\n\t\t\t169,\n\t\t\t170,\n\t\t\t171,\n\t\t\t172,\n\t\t\t173,\n\t\t\t178,\n\t\t\t179,\n\t\t\t184,\n\t\t\t185,\n\t\t\t196,\n\t\t\t197,\n\t\t\t198,\n\t\t\t199,\n\t\t\t200,\n\t\t\t201,\n\t\t\t202,\n\t\t\t203,\n\t\t\t204,\n\t\t\t205,\n\t\t\t206,\n\t\t\t207,\n\t\t\t208,\n\t\t\t209,\n\t\t\t214,\n\t\t\t215,\n\t\t\t220,\n\t\t\t221\n\t\t];\n\t}\n} catch (error) {\n\t// Swallow - we only care if `supports-color` is available; it doesn't have to be.\n}\n\n/**\n * Build up the default `inspectOpts` object from the environment variables.\n *\n *   $ DEBUG_COLORS=no DEBUG_DEPTH=10 DEBUG_SHOW_HIDDEN=enabled node script.js\n */\n\nexports.inspectOpts = Object.keys(process.env).filter(key => {\n\treturn /^debug_/i.test(key);\n}).reduce((obj, key) => {\n\t// Camel-case\n\tconst prop = key\n\t\t.substring(6)\n\t\t.toLowerCase()\n\t\t.replace(/_([a-z])/g, (_, k) => {\n\t\t\treturn k.toUpperCase();\n\t\t});\n\n\t// Coerce string value into JS value\n\tlet val = process.env[key];\n\tif (/^(yes|on|true|enabled)$/i.test(val)) {\n\t\tval = true;\n\t} else if (/^(no|off|false|disabled)$/i.test(val)) {\n\t\tval = false;\n\t} else if (val === 'null') {\n\t\tval = null;\n\t} else {\n\t\tval = Number(val);\n\t}\n\n\tobj[prop] = val;\n\treturn obj;\n}, {});\n\n/**\n * Is stdout a TTY? Colored output is enabled when `true`.\n */\n\nfunction useColors() {\n\treturn 'colors' in exports.inspectOpts ?\n\t\tBoolean(exports.inspectOpts.colors) :\n\t\ttty.isatty(process.stderr.fd);\n}\n\n/**\n * Adds ANSI color escape codes if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\tconst {namespace: name, useColors} = this;\n\n\tif (useColors) {\n\t\tconst c = this.color;\n\t\tconst colorCode = '\\u001B[3' + (c < 8 ? c : '8;5;' + c);\n\t\tconst prefix = `  ${colorCode};1m${name} \\u001B[0m`;\n\n\t\targs[0] = prefix + args[0].split('\\n').join('\\n' + prefix);\n\t\targs.push(colorCode + 'm+' + module.exports.humanize(this.diff) + '\\u001B[0m');\n\t} else {\n\t\targs[0] = getDate() + name + ' ' + args[0];\n\t}\n}\n\nfunction getDate() {\n\tif (exports.inspectOpts.hideDate) {\n\t\treturn '';\n\t}\n\treturn new Date().toISOString() + ' ';\n}\n\n/**\n * Invokes `util.format()` with the specified arguments and writes to stderr.\n */\n\nfunction log(...args) {\n\treturn process.stderr.write(util.format(...args) + '\\n');\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\tif (namespaces) {\n\t\tprocess.env.DEBUG = namespaces;\n\t} else {\n\t\t// If you set a process.env field to null or undefined, it gets cast to the\n\t\t// string 'null' or 'undefined'. Just delete instead.\n\t\tdelete process.env.DEBUG;\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\n\nfunction load() {\n\treturn process.env.DEBUG;\n}\n\n/**\n * Init logic for `debug` instances.\n *\n * Create a new `inspectOpts` object in case `useColors` is set\n * differently for a particular `debug` instance.\n */\n\nfunction init(debug) {\n\tdebug.inspectOpts = {};\n\n\tconst keys = Object.keys(exports.inspectOpts);\n\tfor (let i = 0; i < keys.length; i++) {\n\t\tdebug.inspectOpts[keys[i]] = exports.inspectOpts[keys[i]];\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %o to `util.inspect()`, all on a single line.\n */\n\nformatters.o = function (v) {\n\tthis.inspectOpts.colors = this.useColors;\n\treturn util.inspect(v, this.inspectOpts)\n\t\t.split('\\n')\n\t\t.map(str => str.trim())\n\t\t.join(' ');\n};\n\n/**\n * Map %O to `util.inspect()`, allowing multiple lines if needed.\n */\n\nformatters.O = function (v) {\n\tthis.inspectOpts.colors = this.useColors;\n\treturn util.inspect(v, this.inspectOpts);\n};\n","import sdk, { FFmpegInput, RecordingStreamThumbnailOptions } from '@scrypted/sdk';\nimport { Console } from 'console';\nimport { PassThrough } from 'stream';\nimport url from 'url';\nimport type { MIMETypeParameters } from 'whatwg-mimetype';\nimport { FFmpegImageFilterOptions, ffmpegFilterImage, ffmpegFilterImageBuffer } from './ffmpeg-image-filter';\nimport { loadSharp, loadVipsImage } from './image-reader';\n\nexport type DimDict<T extends string> = {\n    [key in T]: string;\n};\n\nexport function parseDims<T extends string>(dict: DimDict<T>) {\n    const ret: {\n        [key in T]?: number;\n    } & {\n        fractional?: boolean;\n    } = {\n    };\n\n    for (const t of Object.keys(dict)) {\n        const val = dict[t as T];\n        if (val?.endsWith('%')) {\n            ret.fractional = true;\n            ret[t] = parseFloat(val?.substring(0, val?.length - 1)) / 100;\n        }\n        else {\n            ret[t] = val ? parseFloat(val) : undefined;\n        }\n    }\n    return ret;\n}\n\nexport interface ImageOp {\n    resize?: ReturnType<typeof parseDims<'width' | 'height'>>;\n    crop?: ReturnType<typeof parseDims<'left' | 'top' | 'right' | 'bottom'>>;\n}\n\nexport function parseImageOp(parameters: MIMETypeParameters | URLSearchParams): ImageOp {\n    return {\n        resize: parseDims({\n            width: parameters.get('width'),\n            height: parameters.get('height'),\n        }),\n        crop: parseDims({\n            left: parameters.get('left'),\n            top: parameters.get('top'),\n            right: parameters.get('right'),\n            bottom: parameters.get('bottom'),\n        }),\n    };\n}\n\nexport function toImageOp(options: RecordingStreamThumbnailOptions) {\n    const ret: ImageOp = {};\n    const { resize, crop } = options || {};\n    if (resize) {\n        ret.resize = {\n            width: resize.width,\n            height: resize.height,\n            fractional: resize.percent,\n        };\n    }\n    if (crop) {\n        ret.crop = {\n            left: crop.left,\n            top: crop.top,\n            right: crop.left + crop.width,\n            bottom: crop.top + crop.height,\n            fractional: crop.percent,\n        }\n    }\n    return ret;\n}\n\nexport async function processImageOp(input: string | FFmpegInput | Buffer, op: ImageOp, time: number, sourceId: string, debug?: boolean): Promise<Buffer> {\n    const { crop, resize } = op;\n    const { width, height, fractional } = resize || {};\n    const { left, top, right, bottom, fractional: cropFractional } = crop || {};\n\n    const filenameOrBuffer = typeof input === 'string' || Buffer.isBuffer(input) ? input : input.url?.startsWith('file:') && url.fileURLToPath(input.url);\n\n    if (filenameOrBuffer && loadSharp()) {\n        const vips = await loadVipsImage(filenameOrBuffer, sourceId);\n\n        const resize = (width != null || height != null) && {\n            width,\n            height,\n        };\n\n        if (fractional) {\n            if (resize.width)\n                resize.width *= vips.width;\n            if (resize.height)\n                resize.height *= vips.height;\n        }\n\n        const crop = left != null && {\n            left,\n            top,\n            width: right - left,\n            height: bottom - top,\n        };\n\n        if (cropFractional) {\n            crop.left *= vips.width;\n            crop.top *= vips.height;\n            crop.width *= vips.width;\n            crop.height *= vips.height;\n        }\n\n        try {\n            const ret = await vips.toBuffer({\n                resize,\n                crop,\n                format: 'jpg',\n            });\n            return ret;\n        }\n        finally {\n            vips.close();\n        }\n    }\n\n    const out = new PassThrough();\n    let console = new Console(out, out);\n    const printConsole = () => {\n        if (!console)\n            return;\n        console = undefined;\n        const data = out.read().toString();\n        const deviceConsole = sdk.deviceManager.getMixinConsole(sourceId);\n        deviceConsole.log(data);\n    }\n\n    const ffmpegOpts: FFmpegImageFilterOptions = {\n        console,\n        ffmpegPath: await sdk.mediaManager.getFFmpegPath(),\n        resize: width === undefined && height === undefined\n            ? undefined\n            : {\n                width,\n                height,\n                fractional,\n            },\n        crop: left === undefined || right === undefined || top === undefined || bottom === undefined\n            ? undefined\n            : {\n                left,\n                top,\n                width: right - left,\n                height: bottom - top,\n                fractional: cropFractional,\n            },\n        timeout: 10000,\n        time,\n    };\n\n    try {\n        if (Buffer.isBuffer(input)) {\n            return await ffmpegFilterImageBuffer(input, ffmpegOpts);\n        }\n\n        const ffmpegInput: FFmpegInput = typeof input !== 'string'\n            ? input\n            : {\n                inputArguments: [\n                    '-i', input,\n                ]\n            };\n\n        const args = [\n            ...ffmpegInput.inputArguments,\n            ...(ffmpegInput.h264EncoderArguments || []),\n        ];\n\n        return await ffmpegFilterImage(args, ffmpegOpts);\n    }\n    catch (e) {\n        printConsole();\n        throw e;\n    }\n    finally {\n        if (debug)\n            printConsole();\n    }\n}\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 394;\nmodule.exports = webpackEmptyContext;","import { AutoenableMixinProvider } from \"@scrypted/common/src/autoenable-mixin-provider\";\nimport { AuthFetchCredentialState, authHttpFetch } from '@scrypted/common/src/http-auth-fetch';\nimport { RefreshPromise, TimeoutError, createMapPromiseDebouncer, singletonPromise, timeoutPromise } from \"@scrypted/common/src/promise-utils\";\nimport { SettingsMixinDeviceBase, SettingsMixinDeviceOptions } from \"@scrypted/common/src/settings-mixin\";\nimport sdk, { BufferConverter, Camera, DeviceManifest, DeviceProvider, FFmpegInput, HttpRequest, HttpRequestHandler, HttpResponse, MediaObject, MediaObjectOptions, MixinProvider, RequestMediaStreamOptions, RequestPictureOptions, Resolution, ResponsePictureOptions, ScryptedDevice, ScryptedDeviceType, ScryptedInterface, ScryptedMimeTypes, Setting, SettingValue, Settings, Sleep, VideoCamera, WritableDeviceState } from \"@scrypted/sdk\";\nimport { StorageSettings } from \"@scrypted/sdk/storage-settings\";\nimport fs from 'fs';\nimport https from 'https';\nimport os from 'os';\nimport path from 'path';\nimport url from 'url';\nimport { fixLegacyClipPath } from '../../objectdetector/src/polygon';\nimport { ffmpegFilterImage, ffmpegFilterImageBuffer } from './ffmpeg-image-filter';\nimport { ImageConverter, ImageConverterNativeId } from './image-converter';\nimport { ImageReader, ImageReaderNativeId, loadSharp, loadVipsImage } from './image-reader';\nimport { ImageWriter, ImageWriterNativeId } from './image-writer';\n\nconst { mediaManager, systemManager } = sdk;\nif (os.cpus().find(cpu => cpu.model?.toLowerCase().includes('qemu'))) {\n    sdk.log.a('QEMU CPU detected. Set your CPU model to host.');\n}\n\nconst httpsAgent = new https.Agent({\n    rejectUnauthorized: false\n});\n\nclass NeverWaitError extends Error {\n\n}\n\nclass PrebufferUnavailableError extends Error {\n\n}\n\nfunction calculateConstrainedDimensions(originalWidth: number, originalHeight: number, targetAspectRatio: number) {\n    const imageAspectRatio = originalWidth / originalHeight;\n\n    if (imageAspectRatio > targetAspectRatio) {\n        // Image is wider than target aspect ratio, constrain by height\n        return {\n            width: Math.round(originalHeight * targetAspectRatio),\n            height: originalHeight\n        };\n    } else {\n        // Image is taller than target aspect ratio, constrain by width\n        return {\n            width: originalWidth,\n            height: Math.round(originalWidth / targetAspectRatio)\n        };\n    }\n}\n\n\nclass SnapshotMixin extends SettingsMixinDeviceBase<Camera> implements Camera, Resolution {\n    storageSettings = new StorageSettings(this, {\n        defaultSnapshotChannel: {\n            title: 'Default Snapshot Channel',\n            description: 'The default channel to use for snapshots.',\n            defaultValue: 'Camera Default',\n            hide: !this.mixinDeviceInterfaces.includes(ScryptedInterface.Camera),\n            onGet: async () => {\n                if (!this.mixinDeviceInterfaces.includes(ScryptedInterface.Camera)) {\n                    return {\n                        hide: true,\n                    };\n                }\n\n                let psos: ResponsePictureOptions[];\n                try {\n                    psos = await this.mixinDevice.getPictureOptions();\n                }\n                catch (e) {\n                }\n\n                if (!psos?.length) {\n                    return {\n                        hide: true,\n                    };\n                }\n\n                return {\n                    hide: false,\n                    choices: [\n                        'Camera Default',\n                        ...psos.map(pso => pso.name),\n                    ],\n                };\n            }\n        },\n        snapshotUrl: {\n            title: this.mixinDeviceInterfaces.includes(ScryptedInterface.Camera)\n                ? 'Override Snapshot URL'\n                : 'Snapshot URL',\n            description: (this.mixinDeviceInterfaces.includes(ScryptedInterface.Camera)\n                ? 'Optional: '\n                : '')\n                + 'The http(s) URL that retrieves a jpeg image from your camera.',\n            placeholder: 'https://ip:1234/cgi-bin/snapshot.jpg',\n        },\n        snapshotsFromPrebuffer: {\n            title: 'Snapshots from Prebuffer',\n            description: 'Prefer snapshots from the Rebroadcast Plugin prebuffer when available. This setting uses considerable CPU to convert a video stream into a snapshot. The Default setting will use the camera snapshot and fall back to prebuffer on failure.',\n            choices: [\n                'Default',\n                'Enabled',\n                'Disabled',\n            ],\n            defaultValue: 'Default',\n        },\n        snapshotResolution: {\n            title: 'Snapshot Resolution',\n            description: 'Set resolution of the snapshots requested from the camera.',\n            choices: [\n                'Default',\n                'Full Resolution',\n                'Requested Resolution',\n            ],\n            defaultValue: 'Default',\n            hide: !this.mixinDeviceInterfaces.includes(ScryptedInterface.Camera),\n        },\n        snapshotCropScale: {\n            title: 'Crop and Scale',\n            description: 'Set the approximate region to crop and scale to 16:9 snapshots.',\n            type: 'clippath',\n        },\n        snapshotAspectRatio: {\n            title: 'Snapshot Aspect Ratio',\n            description: 'Override the aspect ratio for snapshots (e.g., 1.777 for 16:9). Images from the camera will be resized to this aspect ratio.',\n            type: 'number',\n            placeholder: '1.777',\n        },\n        privacyMode: {\n            group: 'Privacy',\n            title: 'Disable Snapshot',\n            description: 'Disable this camera\\'s snapshot to all services provided by Scrypted.',\n            type: 'boolean',\n        },\n    });\n    snapshotDebouncer = createMapPromiseDebouncer<{\n        picture: Buffer;\n        pictureTime: number;\n    }>();\n    errorPicture: RefreshPromise<Buffer>;\n    timeoutPicture: RefreshPromise<Buffer>;\n    progressPicture: RefreshPromise<Buffer>;\n    prebufferUnavailablePicture: RefreshPromise<Buffer>;\n    currentPicture: Buffer;\n    currentPictureTime = 0;\n    lastErrorImagesClear = 0;\n    static lastGeneratedErrorImageTime = 0;\n    lastAvailablePicture: Buffer;\n    psos: ResponsePictureOptions[];\n\n    constructor(public plugin: SnapshotPlugin, options: SettingsMixinDeviceOptions<Camera>) {\n        super(options);\n    }\n\n    get debugConsole() {\n        if (this.plugin.debugConsole)\n            return this.console;\n    }\n\n    async takePictureInternal(id: string, eventSnapshot: boolean): Promise<Buffer> {\n        this.debugConsole?.log(\"Picture requested from camera\", { id, eventSnapshot });\n        if (this.storageSettings.values.privacyMode) {\n            return await fs.promises.readFile('camera-slash.jpg');\n        }\n\n        const { snapshotsFromPrebuffer } = this.storageSettings.values;\n        let usePrebufferSnapshots: boolean;\n        switch (snapshotsFromPrebuffer) {\n            case 'true':\n            case 'Enabled':\n                usePrebufferSnapshots = true;\n                break;\n            case 'Disabled':\n                usePrebufferSnapshots = false;\n                break;\n            default:\n                // default behavior is to use a prebuffer snapshot if there's no camera interface and\n                // no explicit snapshot url.\n                if (!this.mixinDeviceInterfaces.includes(ScryptedInterface.Camera) && !this.storageSettings.values.snapshotUrl)\n                    usePrebufferSnapshots = true;\n                break;\n        }\n\n        // unifi cameras send stale snapshots which are unusable for events,\n        // so force a prebuffer snapshot in this instance.\n        // if prebuffer is not available, it will fall back.\n        if (eventSnapshot && usePrebufferSnapshots !== false) {\n            try {\n                const psos = await this.getPictureOptions();\n                if (psos?.[0]?.staleDuration) {\n                    usePrebufferSnapshots = true;\n                }\n            }\n            catch (e) {\n            }\n        }\n\n        const realDevice = systemManager.getDeviceById<VideoCamera & Sleep>(this.id);\n\n        let takePrebufferPicture: () => Promise<Buffer>;\n        const preparePrebufferSnapshot = async () => {\n            if (takePrebufferPicture)\n                return takePrebufferPicture;\n            const msos = await realDevice.getVideoStreamOptions();\n            let prebufferChannel = msos?.find(mso => mso.prebuffer);\n            if (prebufferChannel || !this.lastAvailablePicture) {\n                prebufferChannel = prebufferChannel || {\n                    id: undefined,\n                };\n\n                const request = prebufferChannel as RequestMediaStreamOptions;\n                request.audio = null;\n                // specify the prebuffer based on the usage. events shouldn't request\n                // lengthy prebuffers as it may not contain the image it needs.\n                request.prebuffer = eventSnapshot ? 1000 : 6000;\n                if (this.lastAvailablePicture)\n                    request.refresh = false;\n                takePrebufferPicture = async () => {\n                    // this.console.log('snapshotting active prebuffer');\n                    const ffmpegInput = await sdk.mediaManager.convertMediaObjectToJSON<FFmpegInput>(await realDevice.getVideoStream(request), ScryptedMimeTypes.FFmpegInput);\n                    return ffmpegFilterImage(ffmpegInput.inputArguments, {\n                        console: this.debugConsole,\n                        ffmpegPath: await mediaManager.getFFmpegPath(),\n                        timeout: 10000,\n                    });\n                };\n                return takePrebufferPicture;\n            }\n        }\n\n        if (usePrebufferSnapshots) {\n            const takePicture = await preparePrebufferSnapshot()\n            if (!takePicture) {\n                this.debugConsole?.warn('Prebuffer snapshot was requested but prebuffer is unavailable.');\n                throw new PrebufferUnavailableError();\n            }\n            return takePicture();\n        }\n\n        const retryWithPrebuffer = async (e: Error) => {\n            if (usePrebufferSnapshots === false)\n                throw e;\n            const takePicture = await preparePrebufferSnapshot()\n            if (!takePicture)\n                throw e;\n            this.console.error('Snapshot failed, falling back to prebuffer', e);\n            return takePicture();\n        }\n\n        if (this.storageSettings.values.snapshotUrl) {\n            let username: string;\n            let password: string;\n\n            if (this.mixinDeviceInterfaces.includes(ScryptedInterface.Settings)) {\n                const settings = await this.mixinDevice.getSettings();\n                username = settings?.find(setting => setting.key === 'username')?.value?.toString();\n                password = settings?.find(setting => setting.key === 'password')?.value?.toString();\n            }\n\n            let credential: AuthFetchCredentialState;\n            if (username && password) {\n                credential = {\n                    username,\n                    password,\n                };\n            }\n\n            try {\n                const response = await authHttpFetch({\n                    rejectUnauthorized: false,\n                    url: this.storageSettings.values.snapshotUrl,\n                    credential,\n                    timeout: 60000,\n                    headers: {\n                        'Accept': 'image/*',\n                    },\n                });\n\n                return response.body;\n            }\n            catch (e) {\n                return retryWithPrebuffer(e);\n            }\n        }\n\n        if (this.mixinDeviceInterfaces.includes(ScryptedInterface.Camera)) {\n            let takePictureOptions: RequestPictureOptions;\n            if (!id && this.storageSettings.values.defaultSnapshotChannel !== 'Camera Default') {\n                try {\n                    const psos = await this.getPictureOptions();\n                    const pso = psos.find(pso => pso.name === this.storageSettings.values.defaultSnapshotChannel);\n                    takePictureOptions = {\n                        id: pso?.id,\n                    };\n                }\n                catch (e) {\n                }\n            }\n            try {\n                // consider waking the camera if \n                if (!eventSnapshot && this.mixinDeviceInterfaces.includes(ScryptedInterface.Sleep) && realDevice.sleeping) {\n                    this.console.log('Not waking sleeping camera for periodic snapshot.');\n                    return this.lastAvailablePicture;\n                }\n\n                return await this.mixinDevice.takePicture(takePictureOptions).then(mo => mediaManager.convertMediaObjectToBuffer(mo, 'image/jpeg'))\n            }\n            catch (e) {\n                return retryWithPrebuffer(e);\n            }\n        }\n\n        throw new Error('Snapshot Unavailable (Snapshot URL empty)');\n    }\n\n    async takePictureRaw(options?: RequestPictureOptions): Promise<Buffer> {\n        const eventSnapshot = options?.reason === 'event';\n        const periodicSnapshot = options?.reason === 'periodic';\n        const hoursDuration = this.mixinDeviceInterfaces.includes(ScryptedInterface.Sleep) ? 5 : 1;\n\n        // clear out snapshots that are too old.\n        if (this.currentPictureTime < Date.now() - hoursDuration * 60 * 60 * 1000)\n            this.currentPicture = undefined;\n\n        // always grab/debounce a snapshot\n        // event snapshot are special and should immediately expire.\n        // other snapshots may be debounced for 4s.\n        const debounced = this.snapshotDebouncer({\n            id: options?.id,\n            type: 'source',\n            event: options?.reason === 'event',\n        }, eventSnapshot ? 0 : 4000, async () => {\n            const snapshotTimer = Date.now();\n            let picture = await this.takePictureInternal(undefined, eventSnapshot);\n            picture = await this.cropAndScale(picture);\n            this.clearCachedPictures();\n            const pictureTime = Date.now();\n            this.currentPicture = picture;\n            this.currentPictureTime = pictureTime;\n            this.lastAvailablePicture = picture;\n            this.debugConsole?.debug(`Periodic snapshot took ${(this.currentPictureTime - snapshotTimer) / 1000} seconds to retrieve.`)\n            return {\n                picture,\n                pictureTime,\n            };\n        });\n        debounced.catch(() => { });\n\n        // prevent this from expiring\n        let availablePicture = this.currentPicture;\n        let availablePictureTime = this.currentPictureTime;\n\n        let rawPicture: Awaited<typeof debounced>;\n        try {\n            let pictureTimeout = options?.timeout;\n            if (!pictureTimeout) {\n                // determine a fetch timeout based on the reason and staleness\n                const allowedSnapshotStaleness = eventSnapshot ? 0 : periodicSnapshot ? 20000 : 10000;\n                if (!availablePicture) {\n                    // none available so wait a while\n                    pictureTimeout = 10000;\n                }\n                else {\n                    if (availablePictureTime > Date.now() - 3000) {\n                        // very recent, don't wait for too long\n                        pictureTimeout = 1000;\n                    }\n                    else if (availablePictureTime > Date.now() - allowedSnapshotStaleness) {\n                        // fairly recent so give it little time to get a fresh one\n                        // idr interval is typically 4000 for reference\n                        pictureTimeout = 3000;\n                    }\n                    else {\n                        // stale so wait a while\n                        pictureTimeout = 10000;\n                    }\n                }\n            }\n            rawPicture = await timeoutPromise(pictureTimeout, debounced);\n        }\n        catch (e) {\n            // a best effort was made to get a recent snapshot from cache or from a camera request,\n            // the cache request will never fail, but if the camera request fails,\n            // it may be ok to use a somewhat stale snapshot depending on reason.\n\n            // event snapshot requests must not use cache since they're for realtime processing by homekit and nvr.\n            if (eventSnapshot)\n                throw e;\n\n            if (this.currentPicture) {\n                // use the current picture if it is still available as it may be newer.\n                availablePicture = this.currentPicture;\n                availablePictureTime = this.currentPictureTime;\n            }\n\n            if (!availablePicture)\n                return this.createErrorImage(e);\n\n            this.console.warn('Snapshot failed, but recovered from cache', e);\n            rawPicture = {\n                picture: availablePicture,\n                pictureTime: availablePictureTime,\n            };\n\n            // gc\n            availablePicture = undefined;\n        }\n\n        const aspectRatio = this.storageSettings.values.snapshotAspectRatio;\n        const needSoftwareResize = (!!(options?.picture?.width || options?.picture?.height) && this.storageSettings.values.snapshotResolution !== 'Full Resolution')\n            || aspectRatio;\n\n        if (!needSoftwareResize)\n            return rawPicture.picture;\n\n        try {\n            const key = {\n                type: 'resize',\n                pictureTime: rawPicture.pictureTime,\n                needSoftwareResize: true,\n                picture: options.picture,\n            };\n            const ret = await this.snapshotDebouncer(key, 10000, async () => {\n                this.debugConsole?.log(\"Resizing picture from camera\", key);\n\n                if (loadSharp()) {\n                    const vips = await loadVipsImage(rawPicture.picture, this.id);\n\n                    let resolutionWidth = vips.width;\n                    let resolutionHeight = vips.height;\n                    if (aspectRatio) {\n                        const constrained = calculateConstrainedDimensions(vips.width, vips.height, aspectRatio);\n                        resolutionWidth = constrained.width;\n                        resolutionHeight = constrained.height;\n                    }\n                    if (this.resolution?.[0] !== resolutionWidth || this.resolution?.[1] !== resolutionHeight)\n                        this.resolution = [resolutionWidth, resolutionHeight];\n\n                    let resizeOptions = options?.picture;\n                    if (aspectRatio) {\n                        resizeOptions ||= {};\n                        const { width, height } = resizeOptions;\n\n                        if (!width && !height) {\n                            resizeOptions = {\n                                ...resizeOptions,\n                                width: resolutionWidth,\n                                height: resolutionHeight,\n                            };\n                        }\n                        else if (!width) {\n                            resizeOptions = {\n                                ...resizeOptions,\n                                width: Math.round(resizeOptions.height * aspectRatio)\n                            };\n                        }\n                        else if (!height) {\n                            resizeOptions = {\n                                ...resizeOptions,\n                                height: Math.round(resizeOptions.width / aspectRatio)\n                            };\n                        }\n                    }\n\n                    try {\n                        const ret = await vips.toBuffer({\n                            resize: resizeOptions,\n                            format: 'jpg',\n                        });\n                        return {\n                            picture: ret,\n                            pictureTime: rawPicture.pictureTime,\n                        };\n                    }\n                    finally {\n                        vips.close();\n                    }\n                }\n\n                const ret = await ffmpegFilterImageBuffer(rawPicture.picture, {\n                    console: this.debugConsole,\n                    ffmpegPath: await mediaManager.getFFmpegPath(),\n                    resize: options?.picture,\n                    timeout: 10000,\n                });\n                return {\n                    picture: ret,\n                    pictureTime: rawPicture.pictureTime,\n                };\n            });\n\n            return ret.picture;\n        }\n        catch (e) {\n            if (eventSnapshot)\n                throw e;\n            return this.createErrorImage(e);\n        }\n    }\n\n    async takePicture(options?: RequestPictureOptions): Promise<MediaObject> {\n        return this.createMediaObject(await this.takePictureRaw(options), 'image/jpeg');\n    }\n\n    async cropAndScale(picture: Buffer) {\n        if (!this.storageSettings.values.snapshotCropScale?.length)\n            return picture;\n\n        const clipPath = fixLegacyClipPath(this.storageSettings.values.snapshotCropScale);\n        const xmin = Math.min(...clipPath.map(([x, y]) => x));\n        const ymin = Math.min(...clipPath.map(([x, y]) => y));\n        const xmax = Math.max(...clipPath.map(([x, y]) => x));\n        const ymax = Math.max(...clipPath.map(([x, y]) => y));\n\n        if (loadSharp()) {\n            const vips = await loadVipsImage(picture, this.id);\n            try {\n                const ret = await vips.toBuffer({\n                    crop: {\n                        left: xmin * vips.width,\n                        top: ymin * vips.height,\n                        width: (xmax - xmin) * vips.width,\n                        height: (ymax - ymin) * vips.height,\n                    },\n                    format: 'jpg',\n                });\n                return ret;\n            }\n            finally {\n                vips.close();\n            }\n        }\n\n        return ffmpegFilterImageBuffer(picture, {\n            console: this.debugConsole,\n            ffmpegPath: await mediaManager.getFFmpegPath(),\n            crop: {\n                fractional: true,\n                left: xmin,\n                top: ymin,\n                width: xmax - xmin,\n                height: ymax - ymin,\n            },\n            timeout: 10000,\n        });\n    }\n\n    clearErrorImages() {\n        this.errorPicture = undefined;\n        this.timeoutPicture = undefined;\n        this.progressPicture = undefined;\n        this.prebufferUnavailablePicture = undefined;\n    }\n\n    clearCachedPictures() {\n        // if previous error pictures were generated with the black background,\n        // clear it out to force a real blurred image.\n        if (!this.lastAvailablePicture)\n            this.clearErrorImages();\n        this.currentPicture = undefined;\n    }\n\n    maybeClearErrorImages() {\n        const now = Date.now();\n\n        // only clear the error images if they are at least an hour old\n        if (now - this.lastErrorImagesClear > 1 * 60 * 60 * 1000)\n            return;\n\n        // only clear error images generated once a per minute across all cameras\n        if (now - SnapshotMixin.lastGeneratedErrorImageTime < 60 * 1000)\n            return;\n\n        SnapshotMixin.lastGeneratedErrorImageTime = now;\n        this.lastErrorImagesClear = now;\n        this.clearErrorImages();\n    }\n\n    async createErrorImage(e: any) {\n        this.maybeClearErrorImages();\n\n        if (e instanceof TimeoutError) {\n            this.timeoutPicture = singletonPromise(this.timeoutPicture,\n                () => this.createTextErrorImage('Snapshot Timed Out'));\n            return this.timeoutPicture.promise;\n        }\n        else if (e instanceof PrebufferUnavailableError) {\n            this.prebufferUnavailablePicture = singletonPromise(this.prebufferUnavailablePicture,\n                () => this.createTextErrorImage('Snapshot Unavailable'));\n            return this.prebufferUnavailablePicture.promise;\n        }\n        else if (e instanceof NeverWaitError) {\n            this.progressPicture = singletonPromise(this.progressPicture,\n                () => this.createTextErrorImage('Snapshot In Progress'));\n            return this.progressPicture.promise;\n        }\n        else {\n            this.console.error('Snapshot failed', e);\n            this.errorPicture = singletonPromise(this.errorPicture,\n                () => this.createTextErrorImage('Snapshot Failed'));\n            return this.errorPicture.promise;\n        }\n    }\n\n    async createTextErrorImage(text: string) {\n        const errorBackground = this.currentPicture || this.lastAvailablePicture;\n        this.console.log('creating error image with background', text, !!errorBackground);\n\n        const pluginVolume = process.env.SCRYPTED_PLUGIN_VOLUME;\n        const unzippedFs = path.join(pluginVolume, 'zip/unzipped/fs');\n        const fontFile = path.join(unzippedFs, 'Lato-Bold.ttf');\n\n        if (!errorBackground) {\n            return ffmpegFilterImage([\n                '-f', 'lavfi',\n                '-i', 'color=black:size=1920x1080',\n            ], {\n                console: this.debugConsole,\n                ffmpegPath: await mediaManager.getFFmpegPath(),\n                text: {\n                    fontFile,\n                    text,\n                },\n                timeout: 10000,\n            })\n        }\n        else {\n            return ffmpegFilterImageBuffer(errorBackground, {\n                console: this.debugConsole,\n                ffmpegPath: await mediaManager.getFFmpegPath(),\n                blur: true,\n                brightness: -.2,\n                text: {\n                    fontFile,\n                    text,\n                },\n                timeout: 10000,\n            });\n        }\n    }\n\n    async getPictureOptions() {\n        if (!this.psos)\n            this.psos = await this.mixinDevice.getPictureOptions();\n        return this.psos;\n    }\n\n    getMixinSettings(): Promise<Setting[]> {\n        return this.storageSettings.getSettings();\n    }\n\n    putMixinSetting(key: string, value: SettingValue) {\n        return this.storageSettings.putSetting(key, value);\n    }\n}\n\nexport class SnapshotPlugin extends AutoenableMixinProvider implements MixinProvider, BufferConverter, Settings, DeviceProvider, HttpRequestHandler {\n    storageSettings = new StorageSettings(this, {\n        debugLogging: {\n            title: 'Debug Logging',\n            description: 'Debug logging for all cameras will be shown in the Snapshot Plugin Console.',\n            type: 'boolean',\n        },\n    });\n    mixinDevices = new Map<string, SnapshotMixin>();\n    authenticatedPath = sdk.endpointManager.getAuthenticatedPath(this.nativeId)\n\n    constructor(nativeId?: string) {\n        super(nativeId);\n\n        this.fromMimeType = ScryptedMimeTypes.SchemePrefix + 'scrypted-media' + ';converter-weight=0';\n        this.toMimeType = ScryptedMimeTypes.LocalUrl;\n\n        const manifest: DeviceManifest = {\n            devices: [\n                {\n                    name: 'Image Writer',\n                    interfaces: [\n                        ScryptedInterface.BufferConverter,\n                    ],\n                    type: ScryptedDeviceType.Internal,\n                    nativeId: ImageWriterNativeId,\n                },\n                {\n                    name: 'Image Converter',\n                    interfaces: [\n                        ScryptedInterface.BufferConverter,\n                    ],\n                    type: ScryptedDeviceType.Internal,\n                    nativeId: ImageConverterNativeId,\n                }\n            ],\n        };\n\n        if (loadSharp()) {\n            manifest.devices.push(\n                {\n                    name: 'Image Reader',\n                    interfaces: [\n                        ScryptedInterface.BufferConverter,\n                    ],\n                    type: ScryptedDeviceType.Internal,\n                    nativeId: ImageReaderNativeId,\n                }\n            );\n        }\n\n        process.nextTick(() => {\n            sdk.deviceManager.onDevicesChanged(manifest)\n        });\n    }\n\n    async getDevice(nativeId: string): Promise<any> {\n        if (nativeId === ImageConverterNativeId)\n            return new ImageConverter(this, ImageConverterNativeId);\n        if (nativeId === ImageWriterNativeId)\n            return new ImageWriter(ImageWriterNativeId);\n        if (nativeId === ImageReaderNativeId)\n            return new ImageReader(ImageReaderNativeId);\n    }\n\n    async releaseDevice(id: string, nativeId: string): Promise<void> {\n    }\n\n    getSettings(): Promise<Setting[]> {\n        return this.storageSettings.getSettings();\n    }\n\n    putSetting(key: string, value: SettingValue): Promise<void> {\n        return this.storageSettings.putSetting(key, value);\n    }\n\n    get debugConsole() {\n        if (this.storageSettings.values.debugLogging)\n            return this.console;\n    }\n\n    async getLocalSnapshot(id: string, iface: string, search: string) {\n        const endpoint = await this.authenticatedPath;\n        const ret = url.resolve(path.join(endpoint, 'hotlink-ok', id, iface, `${Date.now()}.jpg`) + `${search}`, '');\n        return Buffer.from(ret);\n    }\n\n    async convert(data: any, fromMimeType: string, toMimeType: string, options?: MediaObjectOptions): Promise<any> {\n        const url = new URL(data.toString());\n        const id = url.hostname;\n        const path = url.pathname.split('/')[1];\n\n        if (path === ScryptedInterface.Camera) {\n            return this.getLocalSnapshot(id, path, url.search);\n        }\n        if (path === ScryptedInterface.VideoCamera) {\n            return this.getLocalSnapshot(id, path, url.search);\n        }\n        else {\n            throw new Error('Unrecognized Scrypted Media interface.')\n        }\n    }\n\n    async onRequest(request: HttpRequest, response: HttpResponse): Promise<void> {\n        if (request.isPublicEndpoint) {\n            response.send('', {\n                code: 404,\n            });\n            return;\n        }\n\n        let pathname = request.url.substring(request.rootPath.length);\n        if (pathname.startsWith('/hotlink-ok'))\n            pathname = pathname.substring('/hotlink-ok'.length);\n\n        const [_, id, iface] = pathname.split('/');\n        try {\n            if (iface !== ScryptedInterface.Camera && iface !== ScryptedInterface.VideoCamera)\n                throw new Error();\n\n            const search = new URLSearchParams(pathname.split('?')[1]);\n            const mixin = this.mixinDevices.get(id);\n            let buffer: Buffer;\n            let timeout = parseInt(search.get('timeout'));\n            // make web requests timeout after 5 seconds by default.\n            if (isNaN(timeout))\n                timeout = 5000;\n            const rpo: RequestPictureOptions = {\n                reason: search.get('reason') as 'event' | 'periodic',\n                timeout,\n                picture: {\n                    width: parseInt(search.get('width')) || undefined,\n                    height: parseInt(search.get('height')) || undefined,\n                }\n            };\n\n            if (mixin?.storageSettings.values.snapshotResolution === 'Full Resolution')\n                delete rpo.picture;\n\n            if (mixin && iface === ScryptedInterface.Camera) {\n                buffer = await mixin.takePictureRaw(rpo)\n            }\n            else {\n                const device = systemManager.getDeviceById<Camera & VideoCamera>(id);\n                const picture = iface === ScryptedInterface.Camera ? await device.takePicture(rpo) : await device.getVideoStream();\n                buffer = await mediaManager.convertMediaObjectToBuffer(picture, 'image/jpeg');\n            }\n\n            response.send(buffer, {\n                headers: {\n                    'Content-Type': 'image/jpeg',\n                    'Cache-Control': 'max-age=10',\n                }\n            });\n        }\n        catch (e) {\n            this.debugConsole?.error('snapshot http request failed', e);\n            response.send('', {\n                code: 500,\n            });\n        }\n    }\n\n    async canMixin(type: ScryptedDeviceType, interfaces: string[]): Promise<string[]> {\n        if ((type === ScryptedDeviceType.Camera || type === ScryptedDeviceType.Doorbell) && interfaces.includes(ScryptedInterface.VideoCamera))\n            return [ScryptedInterface.Camera, ScryptedInterface.Settings, ScryptedInterface.Resolution];\n        return undefined;\n    }\n\n    async getMixin(mixinDevice: any, mixinDeviceInterfaces: ScryptedInterface[], mixinDeviceState: WritableDeviceState): Promise<any> {\n        const ret = new SnapshotMixin(this, {\n            mixinDevice,\n            mixinDeviceInterfaces,\n            mixinDeviceState,\n            mixinProviderNativeId: this.nativeId,\n            group: 'Snapshot',\n            groupKey: 'snapshot',\n        });\n        this.mixinDevices.set(ret.id, ret);\n        return ret;\n    }\n\n    async shouldEnableMixin(device: ScryptedDevice) {\n        const { type, interfaces } = device;\n        // auto enable this on VideoCameras that do not have snapshot capability.\n        if ((type === ScryptedDeviceType.Camera || type === ScryptedDeviceType.Doorbell)\n            && interfaces.includes(ScryptedInterface.VideoCamera))\n            return true;\n        return false;\n    }\n\n    async releaseMixin(id: string, mixinDevice: any): Promise<void> {\n        if (this.mixinDevices.get(id) === mixinDevice)\n            this.mixinDevices.delete(id);\n        await mixinDevice.release()\n    }\n}\n\nexport default SnapshotPlugin;\n","export interface RefreshPromise<T> {\n    promise: Promise<T>;\n    cacheDuration: number;\n}\n\nexport function singletonPromise<T>(rp: undefined | RefreshPromise<T>, method: () => Promise<T>, cacheDuration = 0) {\n    if (rp?.promise)\n        return rp;\n\n    const promise = method();\n    if (!rp) {\n        rp = {\n            promise,\n            cacheDuration,\n        }\n    }\n    else {\n        rp.promise = promise;\n    }\n    promise.finally(() => setTimeout(() => rp.promise = undefined, rp.cacheDuration));\n    return rp;\n}\n\nexport class TimeoutError<T> extends Error {\n    constructor(public promise: Promise<T>) {\n        super('Operation Timed Out');\n    }\n}\n\nexport function timeoutPromise<T>(timeout: number, promise: Promise<T>): Promise<T> {\n    return new Promise<T>((resolve, reject) => {\n        const t = setTimeout(() => reject(new TimeoutError(promise)), timeout);\n\n        promise\n            .then(v => {\n                clearTimeout(t);\n                resolve(v);\n            })\n            .catch(e => {\n                clearTimeout(t);\n                reject(e);\n            });\n    })\n}\n\nexport function timeoutFunction<T>(timeout: number, f: (isTimedOut: () => boolean) => Promise<T>): Promise<T> {\n    return new Promise<T>((resolve, reject) => {\n        let isTimedOut = false;\n        const promise = f(() => isTimedOut);\n\n        const t = setTimeout(() => {\n            isTimedOut = true;\n            reject(new TimeoutError(promise));\n        }, timeout);\n\n        promise\n            .then(v => {\n                clearTimeout(t);\n                resolve(v);\n            })\n            .catch(e => {\n                clearTimeout(t);\n                reject(e);\n            });\n    })\n}\n\nexport function createPromiseDebouncer<T>() {\n    let current: Promise<T>;\n\n    return (func: () => Promise<T>): Promise<T> => {\n        if (!current)\n            current = func().finally(() => current = undefined);\n        return current;\n    }\n}\n\nexport function createMapPromiseDebouncer<T>() {\n    const map = new Map<string, Promise<T>>();\n\n    return (key: any, debounce: number, func: () => Promise<T>): Promise<T> => {\n        const keyStr = JSON.stringify(key);\n        let value = map.get(keyStr);\n        if (!value) {\n            value = func().finally(() => {\n                if (!debounce) {\n                    map.delete(keyStr);\n                    return;\n                }\n                setTimeout(() => map.delete(keyStr), debounce);\n            });\n            map.set(keyStr, value);\n        }\n        return value;\n    }\n}\n","module.exports = require(\"os\");","module.exports = require(\"process\");","import { httpFetch, httpFetchParseIncomingMessage } from '../../server/src/fetch/http-fetch';\nimport type { IncomingMessage } from 'http';\nimport type { Readable } from 'stream';\nimport { createAuthFetch } from '../../packages/auth-fetch/src/auth-fetch';\n\nexport type { HttpFetchOptions, HttpFetchResponseType } from '../../server/src/fetch/http-fetch';\nexport type { AuthFetchCredentialState, AuthFetchOptions } from '../../packages/auth-fetch/src/auth-fetch';\n\nexport const authHttpFetch = createAuthFetch<Readable, IncomingMessage>(httpFetch, httpFetchParseIncomingMessage);\n\nfunction ensureType<T>(v: T) {\n}\n\nasync function test() {\n    const a = await authHttpFetch({\n        credential: undefined,\n        url: 'http://example.com',\n    });\n\n    ensureType<Buffer>(a.body);\n\n    const b = await authHttpFetch({\n        credential: undefined,\n        url: 'http://example.com',\n        responseType: 'json',\n    });\n    ensureType<any>(b.body);\n\n    const c = await authHttpFetch({\n        credential: undefined,\n        url: 'http://example.com',\n        responseType: 'readable',\n    });\n    ensureType<IncomingMessage>(c.body);\n\n    const d = await authHttpFetch({\n        credential: undefined,\n        url: 'http://example.com',\n        responseType: 'buffer',\n    });\n    ensureType<Buffer>(d.body);\n\n    const e = await authHttpFetch({\n        credential: undefined,\n        url: 'http://example.com',\n        responseType: 'text',\n    });\n    ensureType<string>(e.body);\n}\n\n","export function addVideoFilterArguments(videoArgs: string[], videoFilter: string, filterName = 'unfilteredRecording') {\n    const filterIndex = videoArgs.findIndex(f => f === '-filter_complex');\n    if (filterIndex !== undefined && filterIndex !== -1)\n        videoArgs[filterIndex + 1] = videoArgs[filterIndex + 1] + `[${filterName}] ; [${filterName}] ${videoFilter}`;\n    else\n        videoArgs.push('-filter_complex', videoFilter);\n}\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.StorageSettings = void 0;\nconst _1 = __importStar(require(\".\"));\nconst { systemManager } = _1.default;\nfunction parseValue(value, setting, readDefaultValue, rawDevice) {\n    if (value === null || value === undefined) {\n        return readDefaultValue();\n    }\n    const type = setting.multiple ? 'array' : setting.type;\n    if (type === 'boolean') {\n        if (value === 'true')\n            return true;\n        if (value === 'false')\n            return false;\n        return readDefaultValue() || false;\n    }\n    if (type === 'number') {\n        const n = parseFloat(value);\n        if (!isNaN(n))\n            return n;\n        return readDefaultValue() || 0;\n    }\n    if (type === 'integer') {\n        const n = parseInt(value);\n        if (!isNaN(n))\n            return n;\n        return readDefaultValue() || 0;\n    }\n    if (type === 'array') {\n        if (!value)\n            return readDefaultValue() || [];\n        try {\n            return JSON.parse(value);\n        }\n        catch (e) {\n            return readDefaultValue() || [];\n        }\n    }\n    if (type === 'device') {\n        if (rawDevice)\n            return value;\n        return systemManager.getDeviceById(value) || systemManager.getDeviceById(readDefaultValue());\n    }\n    // string type, so check if it is json.\n    if (value && setting.json) {\n        try {\n            return JSON.parse(value);\n        }\n        catch (e) {\n            return readDefaultValue();\n        }\n    }\n    return value || readDefaultValue();\n}\nclass StorageSettings {\n    constructor(device, settings) {\n        this.device = device;\n        this.settings = settings;\n        this.values = {};\n        this.hasValue = {};\n        for (const key of Object.keys(settings)) {\n            const setting = settings[key];\n            const rawGet = () => this.getItem(key);\n            let get;\n            if (setting.type !== 'clippath') {\n                get = rawGet;\n            }\n            else {\n                // maybe need a mapPut. clippath is the only complex type at the moment.\n                get = () => {\n                    try {\n                        return JSON.parse(rawGet());\n                    }\n                    catch (e) {\n                    }\n                };\n            }\n            Object.defineProperty(this.values, key, {\n                get,\n                set: value => this.putSetting(key, value),\n                enumerable: true,\n            });\n            Object.defineProperty(this.hasValue, key, {\n                get: () => this.device.storage.getItem(key) != null,\n                enumerable: true,\n            });\n        }\n    }\n    get keys() {\n        const ret = {};\n        for (const key of Object.keys(this.settings)) {\n            ret[key] = key;\n        }\n        return ret;\n    }\n    async getSettings() {\n        const onGet = await this.options?.onGet?.();\n        const ret = [];\n        for (const [key, setting] of Object.entries(this.settings)) {\n            let s = Object.assign({}, setting);\n            if (onGet?.[key])\n                s = Object.assign(s, onGet[key]);\n            if (s.onGet)\n                s = Object.assign(s, await s.onGet());\n            if (s.hide || await this.options?.hide?.[key]?.())\n                continue;\n            s.key = key;\n            s.value = this.getItemInternal(key, s, true);\n            if (typeof s.deviceFilter === 'function')\n                s.deviceFilter = s.deviceFilter.toString();\n            ret.push(s);\n            delete s.onPut;\n            delete s.onGet;\n            delete s.mapPut;\n            delete s.mapGet;\n        }\n        return ret;\n    }\n    async putSetting(key, value) {\n        const setting = this.settings[key];\n        let oldValue;\n        if (setting)\n            oldValue = this.getItemInternal(key, setting);\n        return this.putSettingInternal(setting, oldValue, key, value);\n    }\n    putSettingInternal(setting, oldValue, key, value) {\n        if (!setting?.noStore) {\n            if (setting?.mapPut)\n                value = setting.mapPut(oldValue, value);\n            // nullish values should be removed, since Storage can't persist them correctly.\n            if (value == null)\n                this.device.storage.removeItem(key);\n            else if (typeof value === 'object')\n                this.device.storage.setItem(key, JSON.stringify(value));\n            else\n                this.device.storage.setItem(key, value?.toString());\n        }\n        setting?.onPut?.(oldValue, value);\n        if (!setting?.hide)\n            this.device.onDeviceEvent(_1.ScryptedInterface.Settings, undefined);\n    }\n    getItemInternal(key, setting, rawDevice) {\n        if (!setting)\n            return this.device.storage.getItem(key);\n        const readDefaultValue = () => {\n            if (setting.persistedDefaultValue != null) {\n                this.putSettingInternal(setting, undefined, key, setting.persistedDefaultValue);\n                return setting.persistedDefaultValue;\n            }\n            return setting.defaultValue;\n        };\n        const ret = parseValue(this.device.storage.getItem(key), setting, readDefaultValue, rawDevice);\n        return setting.mapGet ? setting.mapGet(ret) : ret;\n    }\n    getItem(key) {\n        return this.getItemInternal(key, this.settings[key]);\n    }\n}\nexports.StorageSettings = StorageSettings;\n//# sourceMappingURL=storage-settings.js.map","/**\n * Detect Electron renderer / nwjs process, which is node, but we should\n * treat as a browser.\n */\n\nif (typeof process === 'undefined' || process.type === 'renderer' || process.browser === true || process.__nwjs) {\n\tmodule.exports = require('./browser.js');\n} else {\n\tmodule.exports = require('./node.js');\n}\n","import { Settings, Setting, MixinDeviceBase, ScryptedInterface, SettingValue, MixinDeviceOptions } from \"@scrypted/sdk\";\nimport sdk from \"@scrypted/sdk\";\n\nconst { deviceManager } = sdk;\n\nexport interface SettingsMixinDeviceOptions<T> extends MixinDeviceOptions<T & Settings> {\n    group: string;\n    groupKey: string;\n}\n\nexport abstract class SettingsMixinDeviceBase<T> extends MixinDeviceBase<T & Settings> implements Settings {\n    settingsGroup: string;\n    settingsGroupKey: string;\n\n    constructor(options: SettingsMixinDeviceOptions<T>) {\n        super(options);\n\n        this.settingsGroup = options.group;\n        this.settingsGroupKey = options.groupKey;\n        process.nextTick(() => deviceManager.onMixinEvent(this.id, this, ScryptedInterface.Settings, null));\n    }\n\n    abstract getMixinSettings(): Promise<Setting[]>;\n    abstract putMixinSetting(key: string, value: SettingValue): Promise<boolean|void>;\n\n    async getSettings(): Promise<Setting[]> {\n        const settingsPromise = this.mixinDeviceInterfaces.includes(ScryptedInterface.Settings) ? this.mixinDevice.getSettings() : undefined;\n        const mixinSettingsPromise = this.getMixinSettings();\n        const allSettings: Setting[] = [];\n\n        try {\n            const settings = (await settingsPromise) || [];\n            allSettings.push(...settings);\n        }\n        catch (e) {\n            const name = this.name;\n            const description = `${name} Extension settings failed to load.`;\n            this.console.error(description, e)\n            allSettings.push({\n                key: Math.random().toString(),\n                title: name,\n                value: 'Settings Error',\n                group: 'Errors',\n                description,\n                readonly: true,\n            });\n        }\n\n        try {\n            const mixinSettings = (await mixinSettingsPromise) || [];\n            for (const setting of mixinSettings) {\n                setting.group = setting.group || this.settingsGroup;\n                setting.key = this.settingsGroupKey + ':' + setting.key;\n            }\n            allSettings.push(...mixinSettings);\n        }\n        catch (e) {\n            const name = deviceManager.getDeviceState(this.mixinProviderNativeId).name;\n            const description = `${name} Extension settings failed to load.`;\n            this.console.error(description, e)\n            allSettings.push({\n                key: Math.random().toString(),\n                title: name,\n                value: 'Settings Error',\n                group: 'Errors',\n                description,\n                readonly: true,\n            });\n        }\n\n        return allSettings;\n    }\n\n    async putSetting(key: string, value: SettingValue) {\n        const prefix = this.settingsGroupKey + ':';\n        if (!key?.startsWith(prefix)) {\n            return this.mixinDevice.putSetting(key, value);\n        }\n\n        if (!await this.putMixinSetting(key.substring(prefix.length), value))\n            deviceManager.onMixinEvent(this.id, this, ScryptedInterface.Settings, null);\n    }\n\n    async release() {\n        await deviceManager.onMixinEvent(this.id, this, ScryptedInterface.Settings, null);\n    }\n}\n","import { BufferConverter, FFmpegInput, MediaObjectOptions, ScryptedDeviceBase, ScryptedMimeTypes, ScryptedNativeId } from '@scrypted/sdk';\nimport MIMEType from 'whatwg-mimetype';\nimport type { SnapshotPlugin } from './main';\nimport { parseImageOp, processImageOp } from './parse-dims';\n\nexport const ImageConverterNativeId = 'imageconverter';\n\nexport class ImageConverter extends ScryptedDeviceBase implements BufferConverter {\n    constructor(public plugin: SnapshotPlugin, nativeId: ScryptedNativeId) {\n        super(nativeId);\n\n        this.fromMimeType = ScryptedMimeTypes.FFmpegInput;\n        this.toMimeType = 'image/jpeg';\n    }\n\n    async convert(data: any, fromMimeType: string, toMimeType: string, options?: MediaObjectOptions): Promise<any> {\n        const mime = new MIMEType(toMimeType);\n\n        const op = parseImageOp(mime.parameters);\n        const ffmpegInput = JSON.parse(data.toString()) as FFmpegInput;\n\n        return processImageOp(ffmpegInput, op, parseFloat(mime.parameters.get('time')), options?.sourceId, !!this.plugin.debugConsole);\n    }\n}\n","module.exports = require(\"tty\");","module.exports = require(\"stream\");","import os from 'os';\n/**\n * A YError class able to contain some params and\n *  print better stack traces\n * @extends Error\n */\nclass YError extends Error {\n    code;\n    params;\n    wrappedErrors;\n    constructor(wrappedErrors, errorCode, ...params) {\n        // Detecting if wrappedErrors are passed\n        if (!(wrappedErrors instanceof Array)) {\n            params = ('undefined' === typeof errorCode ? [] : [errorCode]).concat(params);\n            errorCode = wrappedErrors;\n            wrappedErrors = [];\n        }\n        // Call the parent constructor\n        super(errorCode);\n        // Filling error\n        this.code = errorCode || 'E_UNEXPECTED';\n        this.params = params;\n        this.wrappedErrors = wrappedErrors;\n        this.name = this.toString();\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, this.constructor);\n        }\n    }\n    /**\n     * Wraps any error and output a YError with an error\n     *  code and some params as debug values.\n     * @param {Error} err\n     * The error to wrap\n     * @param {string} [errorCode = 'E_UNEXPECTED']\n     * The error code corresponding to the actual error\n     * @param {...YErrorParams} [params]\n     * Some additional debugging values\n     * @return {YError}\n     * The wrapped error\n     */\n    static wrap(err, errorCode, ...params) {\n        const wrappedErrorIsACode = _looksLikeAYErrorCode(err.message);\n        const wrappedErrors = ('wrappedErrors' in err ? err.wrappedErrors : []).concat(err);\n        if (!errorCode) {\n            if (wrappedErrorIsACode) {\n                errorCode = err.message;\n            }\n            else {\n                errorCode = 'E_UNEXPECTED';\n            }\n        }\n        if (err.message && !wrappedErrorIsACode) {\n            params.push(err.message);\n        }\n        return new YError(wrappedErrors, errorCode, ...params);\n    }\n    /**\n     * Return a YError as is or wraps any other error and output\n     *  a YError with a code and some params as debug values.\n     * @param {Error} err\n     * The error to cast\n     * @param {string} [errorCode = 'E_UNEXPECTED']\n     * The error code corresponding to the actual error\n     * @param {...YErrorParams} [params]\n     * Some additional debugging values\n     * @return {YError}\n     * The wrapped error\n     */\n    static cast(err, errorCode, ...params) {\n        if (_looksLikeAYError(err)) {\n            return err;\n        }\n        return YError.wrap(err, errorCode, ...params);\n    }\n    /**\n     * Same than `YError.wrap()` but preserves the code\n     *  and the debug values of the error if it is\n     *  already an instance of the YError constructor.\n     * @param {Error} err\n     * The error to bump\n     * @param {string} [errorCode = 'E_UNEXPECTED']\n     * The error code corresponding to the actual error\n     * @param {...YErrorParams} [params]\n     * Some additional debugging values\n     * @return {YError}\n     * The wrapped error\n     */\n    static bump(err, errorCode, ...params) {\n        if (_looksLikeAYError(err)) {\n            return YError.wrap(err, err.code, ...err.params);\n        }\n        return YError.wrap(err, errorCode, ...params);\n    }\n    toString() {\n        return ((this.wrappedErrors.length\n            ? // eslint-disable-next-line\n                this.wrappedErrors[this.wrappedErrors.length - 1].stack + os.EOL\n            : '') +\n            this.constructor.name +\n            ': ' +\n            this.code +\n            ' (' +\n            this.params.join(', ') +\n            ')');\n    }\n}\n/**\n * Allow to print a stack from anything (especially catched\n *  errors that may or may not contain errors ).\n * @param {Error} err\n * The error to print\n * @return {string}\n * The stack trace if any\n */\nexport function printStackTrace(err) {\n    return typeof err === 'object' && typeof err.stack === 'string'\n        ? err.stack\n        : `[no_stack_trace]: error is ${err != null && typeof err.toString === 'function'\n            ? err.toString()\n            : typeof err}`;\n}\n// In order to keep compatibility through major versions\n// we have to make kind of an cross major version instanceof\nfunction _looksLikeAYError(err) {\n    return (!!(err instanceof YError) ||\n        !!(err.constructor &&\n            err.constructor.name &&\n            err.constructor.name.endsWith('Error') &&\n            'code' in err &&\n            'string' === typeof err.code &&\n            _looksLikeAYErrorCode(err.code) &&\n            'params' in err &&\n            err.params &&\n            err.params instanceof Array));\n}\nfunction _looksLikeAYErrorCode(str) {\n    return /^([A-Z0-9_]+)$/.test(str);\n}\nexport { YError };\n//# sourceMappingURL=index.js.map","import { YError } from 'yerror';\nconst QUOTE = '\"';\nconst EQUAL = '=';\nconst SEPARATOR = ', ';\n/*\n * Regular expression for matching the key-value pairs\n * \\w+     = The key\n * =       = The equal sign\n * \".*?\"   = Value option 1: A double-quoted value (using the non-greedy *? to stop at the first doublequote)\n * [^\",]+  = Value option 2: A string without commas or double-quotes\n * (?=,|$) = Zero-width (as in not captured) positive lookahead assertion.\n *           The previous match will only be valid if it's followed by a \" literal\n *           or the end of the string\n */\nconst KEYVALUE_REGEXP = /\\w+=(\".*?\"|[^\",]+)(?=,|$)/g;\n// FIXME: Create a real parser\nexport function parseHTTPHeadersQuotedKeyValueSet(contents, authorizedKeys, requiredKeys = [], valuesToNormalize = []) {\n    const matches = contents.trim().match(KEYVALUE_REGEXP);\n    if (!matches)\n        throw new YError('E_MALFORMED_QUOTEDKEYVALUE', contents);\n    const data = matches\n        .map((part, partPosition) => {\n        const [key, ...rest] = part.split(EQUAL);\n        const value = rest.join(EQUAL);\n        if (0 === rest.length) {\n            throw new YError('E_MALFORMED_QUOTEDKEYVALUE', partPosition, part);\n        }\n        return [key, value];\n    })\n        .reduce(function (parsedValues, [name, value], valuePosition) {\n        const normalizedName = name.toLowerCase();\n        if (-1 === authorizedKeys.indexOf(normalizedName)) {\n            throw new YError('E_UNAUTHORIZED_KEY', valuePosition, normalizedName);\n        }\n        /*\n         * Regular expression for stripping paired starting and ending double quotes off the value:\n         * ^      = The beginning of the string\n         * \"      = The first double quote\n         * .+     = One or more characters of any kind\n         * (?=\"$) = Zero-width (as in not captured) positive lookahead assertion.\n         *          The previous match will only be valid if it's followed by a \" literal\n         *          or the end of the string\n         * \"      = The ending double quote\n         * $      = The end of the string\n         */\n        const strippedValue = value.replace(/^\"(.+(?=\"$))\"$/, '$1');\n        parsedValues[normalizedName] = valuesToNormalize.includes(normalizedName)\n            ? strippedValue.toLowerCase()\n            : strippedValue;\n        return parsedValues;\n    }, {});\n    _checkRequiredKeys(requiredKeys, data);\n    return data;\n}\nexport function buildHTTPHeadersQuotedKeyValueSet(data, authorizedKeys, requiredKeys = []) {\n    _checkRequiredKeys(requiredKeys, data);\n    return authorizedKeys.reduce(function (contents, key) {\n        if (data[key]) {\n            return (contents +\n                (contents ? SEPARATOR : '') +\n                key +\n                EQUAL +\n                QUOTE +\n                data[key] +\n                QUOTE);\n        }\n        return contents;\n    }, '');\n}\nfunction _checkRequiredKeys(requiredKeys, data) {\n    requiredKeys.forEach((name) => {\n        if ('undefined' === typeof data[name]) {\n            throw new YError('E_REQUIRED_KEY', name);\n        }\n    });\n}\n//# sourceMappingURL=utils.js.map","/**\n * @module http-auth-utils/mechanisms/basic\n */\nimport { YError } from 'yerror';\nimport { parseHTTPHeadersQuotedKeyValueSet, buildHTTPHeadersQuotedKeyValueSet, } from '../utils.js';\nconst REQUIRED_WWW_AUTHENTICATE_KEYS = ['realm'];\nconst AUTHORIZED_WWW_AUTHENTICATE_KEYS = REQUIRED_WWW_AUTHENTICATE_KEYS;\n/* Architecture Note #1.2: Basic mechanism\n\nSee the following [RFC](https://tools.ietf.org/html/rfc7617).\n\n*/\n/**\n * Basic authentication mechanism.\n * @type {Object}\n * @see http://tools.ietf.org/html/rfc2617#section-2\n */\nconst BASIC = {\n    /**\n     * The Basic auth mechanism prefix.\n     * @type {String}\n     */\n    type: 'Basic',\n    /**\n     * Parse the WWW Authenticate header rest.\n     * @param  {String} rest The header rest (string after the authentication mechanism prefix).\n     * @return {Object}      Object representing the result of the parse operation.\n     * @example\n     * assert.deepEqual(\n     *   BASIC.parseWWWAuthenticateRest('realm=\"perlinpinpin\"'), {\n     *     realm: 'perlinpinpin'\n     *   }\n     * );\n     * @api public\n     */\n    parseWWWAuthenticateRest: function parseWWWAuthenticateRest(rest) {\n        return parseHTTPHeadersQuotedKeyValueSet(rest, AUTHORIZED_WWW_AUTHENTICATE_KEYS, REQUIRED_WWW_AUTHENTICATE_KEYS);\n    },\n    /**\n     * Build the WWW Authenticate header rest.\n     * @param  {Object} data The content from wich to build the rest.\n     * @return {String}         The built rest.\n     * @example\n     * assert.equal(\n     *   BASIC.buildWWWAuthenticateRest({\n     *     realm: 'perlinpinpin'\n     *   }),\n     *   'realm=\"perlinpinpin\"'\n     * );\n     * @api public\n     */\n    buildWWWAuthenticateRest: function buildWWWAuthenticateRest(data) {\n        return buildHTTPHeadersQuotedKeyValueSet(data, AUTHORIZED_WWW_AUTHENTICATE_KEYS, REQUIRED_WWW_AUTHENTICATE_KEYS);\n    },\n    /**\n     * Parse the Authorization header rest.\n     * @param  {String} rest The header rest (string after the authentication mechanism prefix).)\n     * @return {Object}      Object representing the result of the parse operation {hash}.\n     * @example\n     * assert.deepEqual(\n     *   BASIC.parseAuthorizationRest('QWxpIEJhYmE6b3BlbiBzZXNhbWU='), {\n     *     hash: 'QWxpIEJhYmE6b3BlbiBzZXNhbWU=',\n     *     username: 'Ali Baba',\n     *     password: 'open sesame'\n     *   }\n     * );\n     * @api public\n     */\n    parseAuthorizationRest: function parseAuthorizationRest(rest) {\n        if (!rest) {\n            throw new YError('E_EMPTY_AUTH');\n        }\n        const { username, password } = BASIC.decodeHash(rest);\n        return {\n            hash: rest,\n            username,\n            password,\n        };\n    },\n    /**\n     * Build the Authorization header rest.\n     * @param  {Object} content The content from wich to build the rest.\n     * @return {String}         The rest built.\n     * @example\n     * assert.equal(\n     *   BASIC.buildAuthorizationRest({\n     *     hash: 'QWxpIEJhYmE6b3BlbiBzZXNhbWU='\n     *   }),\n     *   'QWxpIEJhYmE6b3BlbiBzZXNhbWU='\n     * );\n     * @api public\n     */\n    buildAuthorizationRest: function buildAuthorizationRest({ hash, username, password, }) {\n        if (username && password) {\n            return BASIC.computeHash({\n                username,\n                password,\n            });\n        }\n        if (!hash) {\n            throw new YError('E_NO_HASH');\n        }\n        return hash;\n    },\n    /**\n     * Compute the Basic authentication hash from the given credentials.\n     * @param  {Object} credentials The credentials to encode {username, password}.\n     * @return {String}             The hash representing the credentials.\n     * @example\n     * assert.equal(\n     *   BASIC.computeHash({\n     *     username: 'Ali Baba',\n     *     password: 'open sesame'\n     *   }),\n     *   'QWxpIEJhYmE6b3BlbiBzZXNhbWU='\n     * );\n     * @api public\n     */\n    computeHash: function computeHash({ username, password, }) {\n        return Buffer.from(username + ':' + password).toString('base64');\n    },\n    /**\n     * Decode the Basic hash and return the corresponding credentials.\n     * @param  {String} hash The hash.\n     * @return {Object}      Object representing the credentials {username, password}.\n     * @example\n     * assert.deepEqual(\n     *   BASIC.decodeHash('QWxpIEJhYmE6b3BlbiBzZXNhbWU='), {\n     *     username: 'Ali Baba',\n     *     password: 'open sesame'\n     *   }\n     * );\n     * @api public\n     */\n    decodeHash: function decodeHash(hash) {\n        const [username, ...passwordParts] = Buffer.from(hash, 'base64')\n            .toString()\n            .split(':');\n        return {\n            username,\n            password: passwordParts.join(':'),\n        };\n    },\n};\nexport default BASIC;\n//# sourceMappingURL=basic.js.map","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"crypto\");","/**\n * @module http-auth-utils/mechanisms/digest\n */\nimport { parseHTTPHeadersQuotedKeyValueSet, buildHTTPHeadersQuotedKeyValueSet, } from '../utils.js';\nimport crypto from 'crypto';\nconst REQUIRED_WWW_AUTHENTICATE_KEYS = ['realm', 'nonce'];\nconst AUTHORIZED_WWW_AUTHENTICATE_KEYS = [\n    ...REQUIRED_WWW_AUTHENTICATE_KEYS,\n    'domain',\n    'opaque',\n    'stale',\n    'algorithm',\n    'qop',\n];\nconst CASE_INSENSITIVE_WWW_AUTHENTICATE_VALUES = ['stale'];\nconst REQUIRED_AUTHORIZATION_KEYS = [\n    'username',\n    'realm',\n    'nonce',\n    'uri',\n    'response',\n];\nconst AUTHORIZED_AUTHORIZATION_KEYS = [\n    ...REQUIRED_AUTHORIZATION_KEYS,\n    'algorithm',\n    'cnonce',\n    'opaque',\n    'qop',\n    'nc',\n];\n/* Architecture Note #1.3: Digest mechanism\n\nSee the following [RFC](https://tools.ietf.org/html/rfc2617).\n\n*/\n/**\n * Digest authentication mechanism.\n * @type {Object}\n * @see http://tools.ietf.org/html/rfc2617#section-3\n * @see http://tools.ietf.org/html/rfc2069#section-2\n */\nconst DIGEST = {\n    /**\n     * The Digest auth mechanism prefix.\n     * @type {String}\n     */\n    type: 'Digest',\n    /**\n     * Parse the WWW Authenticate header rest.\n     * @param  {String} rest The header rest (string after the authentication mechanism prefix).\n     * @return {Object}      Object representing the result of the parse operation.\n     * @example\n     * assert.deepEqual(\n     *   DIGEST.parseWWWAuthenticateRest(\n     *     'realm=\"testrealm@host.com\", ' +\n     *     'qop=\"auth, auth-int\", ' +\n     *     'nonce=\"dcd98b7102dd2f0e8b11d0f600bfb0c093\", ' +\n     *     'opaque=\"5ccc069c403ebaf9f0171e9517f40e41\"'\n     *   ), {\n     *     realm: 'testrealm@host.com',\n     *     qop: 'auth, auth-int',\n     *     nonce: 'dcd98b7102dd2f0e8b11d0f600bfb0c093',\n     *     opaque: '5ccc069c403ebaf9f0171e9517f40e41'\n     *   }\n     * );\n     * @api public\n     */\n    parseWWWAuthenticateRest: function parseWWWAuthenticateRest(rest) {\n        return parseHTTPHeadersQuotedKeyValueSet(rest, AUTHORIZED_WWW_AUTHENTICATE_KEYS, REQUIRED_WWW_AUTHENTICATE_KEYS, CASE_INSENSITIVE_WWW_AUTHENTICATE_VALUES);\n    },\n    /**\n     * Build the WWW Authenticate header rest.\n     * @param  {Object} data The content from which to build the rest.\n     * @return {String}         The built rest.\n     * @example\n     * assert.equal(\n     *   DIGEST.buildWWWAuthenticateRest({\n     *     realm: 'testrealm@host.com',\n     *     qop: 'auth, auth-int',\n     *     nonce: 'dcd98b7102dd2f0e8b11d0f600bfb0c093',\n     *     opaque: '5ccc069c403ebaf9f0171e9517f40e41'\n     *   }),\n     *   'realm=\"testrealm@host.com\", ' +\n     *   'qop=\"auth, auth-int\", ' +\n     *   'nonce=\"dcd98b7102dd2f0e8b11d0f600bfb0c093\", ' +\n     *   'opaque=\"5ccc069c403ebaf9f0171e9517f40e41\"'\n     * );\n     * @api public\n     */\n    buildWWWAuthenticateRest: function buildWWWAuthenticateRest(data) {\n        return buildHTTPHeadersQuotedKeyValueSet(data, AUTHORIZED_WWW_AUTHENTICATE_KEYS, REQUIRED_WWW_AUTHENTICATE_KEYS);\n    },\n    /**\n     * Parse the Authorization header rest.\n     * @param  {String} rest The header rest (string after the authentication mechanism prefix).)\n     * @return {Object}      Object representing the result of the parse operation {hash}.\n     * @example\n     * assert.deepEqual(\n     *   DIGEST.parseAuthorizationRest(\n     *     'username=\"Mufasa\",' +\n     *     'realm=\"testrealm@host.com\",' +\n     *     'nonce=\"dcd98b7102dd2f0e8b11d0f600bfb0c093\",' +\n     *     'uri=\"/dir/index.html\",' +\n     *     'qop=\"auth\",' +\n     *     'nc=\"00000001\",' +\n     *     'cnonce=\"0a4f113b\",' +\n     *     'response=\"6629fae49393a05397450978507c4ef1\",' +\n     *     'opaque=\"5ccc069c403ebaf9f0171e9517f40e41\"'\n     *   ), {\n     *     username: \"Mufasa\",\n     *     realm: 'testrealm@host.com',\n     *     nonce: \"dcd98b7102dd2f0e8b11d0f600bfb0c093\",\n     *     uri: \"/dir/index.html\",\n     *     qop: 'auth',\n     *     nc: '00000001',\n     *     cnonce: \"0a4f113b\",\n     *     response: \"6629fae49393a05397450978507c4ef1\",\n     *     opaque: \"5ccc069c403ebaf9f0171e9517f40e41\"\n     *   }\n     * );\n     * @api public\n     */\n    parseAuthorizationRest: function parseAuthorizationRest(rest) {\n        return parseHTTPHeadersQuotedKeyValueSet(rest, AUTHORIZED_AUTHORIZATION_KEYS, REQUIRED_AUTHORIZATION_KEYS);\n    },\n    /**\n     * Build the Authorization header rest.\n     * @param  {Object} data The content from which to build the rest.\n     * @return {String}         The rest built.\n     * @example\n     * assert.equal(\n     *   DIGEST.buildAuthorizationRest({\n     *     username: \"Mufasa\",\n     *     realm: 'testrealm@host.com',\n     *     nonce: \"dcd98b7102dd2f0e8b11d0f600bfb0c093\",\n     *     uri: \"/dir/index.html\",\n     *     qop: 'auth',\n     *     nc: '00000001',\n     *     cnonce: \"0a4f113b\",\n     *     response: \"6629fae49393a05397450978507c4ef1\",\n     *     opaque: \"5ccc069c403ebaf9f0171e9517f40e41\"\n     *   }),\n     *   'username=\"Mufasa\", ' +\n     *   'realm=\"testrealm@host.com\", ' +\n     *   'nonce=\"dcd98b7102dd2f0e8b11d0f600bfb0c093\", ' +\n     *   'uri=\"/dir/index.html\", ' +\n     *   'response=\"6629fae49393a05397450978507c4ef1\", ' +\n     *   'cnonce=\"0a4f113b\", ' +\n     *   'opaque=\"5ccc069c403ebaf9f0171e9517f40e41\", ' +\n     *   'qop=\"auth\", ' +\n     *   'nc=\"00000001\"'\n     * );\n     * @api public\n     */\n    buildAuthorizationRest: function buildAuthorizationRest(data) {\n        return buildHTTPHeadersQuotedKeyValueSet(data, AUTHORIZED_AUTHORIZATION_KEYS, REQUIRED_AUTHORIZATION_KEYS);\n    },\n    /**\n     * Compute the Digest authentication hash from the given credentials.\n     * @param  {Object} data The credentials to encode and other encoding details.\n     * @return {String}             The hash representing the credentials.\n     * @example\n     * assert.equal(\n     *   DIGEST.computeHash({\n     *     username: 'Mufasa',\n     *     realm: 'testrealm@host.com',\n     *     password: 'Circle Of Life',\n     *     method: 'GET',\n     *     uri: '/dir/index.html',\n     *     nonce: 'dcd98b7102dd2f0e8b11d0f600bfb0c093',\n     *     nc: '00000001',\n     *     cnonce: '0a4f113b',\n     *     qop: 'auth',\n     *     algorithm: 'md5'\n     *   }),\n     *   '6629fae49393a05397450978507c4ef1'\n     * );\n     * @api public\n     */\n    computeHash: function computeHash(data) {\n        const ha1 = data.ha1 ||\n            _computeHash(data.algorithm, [data.username, data.realm, data.password].join(':'));\n        const ha2 = _computeHash(data.algorithm, [data.method, data.uri].join(':'));\n        return _computeHash(data.algorithm, [ha1, data.nonce, data.nc, data.cnonce, data.qop, ha2].join(':'));\n    },\n};\nfunction _computeHash(algorithm, str) {\n    const hashsum = crypto.createHash(algorithm);\n    hashsum.update(str);\n    return hashsum.digest('hex');\n}\nexport default DIGEST;\n//# sourceMappingURL=digest.js.map","/**\n * @module http-auth-utils/mechanisms/bearer\n */\nimport { YError } from 'yerror';\nimport { parseHTTPHeadersQuotedKeyValueSet, buildHTTPHeadersQuotedKeyValueSet, } from '../utils.js';\nconst AUTHORIZED_ERROR_CODES = [\n    'invalid_request',\n    'invalid_token',\n    'insufficient_scope',\n];\nconst REQUIRED_WWW_AUTHENTICATE_KEYS = ['realm'];\nconst AUTHORIZED_WWW_AUTHENTICATE_KEYS = [\n    ...REQUIRED_WWW_AUTHENTICATE_KEYS,\n    'scope',\n    'error',\n    'error_description',\n];\n/* Architecture Note #1.1: Bearer mechanism\n\nSee the following [RFC](https://tools.ietf.org/html/rfc6750).\n\n*/\n/**\n * Bearer authentication mechanism.\n * @type {Object}\n * @see https://tools.ietf.org/html/rfc6750#section-3\n */\nconst BEARER = {\n    /**\n     * The Bearer auth mechanism prefix.\n     * @type {String}\n     */\n    type: 'Bearer',\n    /**\n     * Parse the WWW Authenticate header rest.\n     * @param  {String} rest The header rest (string after the authentication mechanism prefix).\n     * @return {Object}      Object representing the result of the parse operation.\n     * @example\n     * assert.deepEqual(\n     *   BEARER.parseWWWAuthenticateRest(\n     *     'realm=\"testrealm@host.com\", ' +\n     *     'scope=\"openid profile email\"'\n     *   ), {\n     *     realm: 'testrealm@host.com',\n     *     scope: 'openid profile email',\n     *   }\n     * );\n     * @api public\n     */\n    parseWWWAuthenticateRest: function parseWWWAuthenticateRest(rest) {\n        return parseHTTPHeadersQuotedKeyValueSet(rest, AUTHORIZED_WWW_AUTHENTICATE_KEYS, []);\n    },\n    /**\n     * Build the WWW Authenticate header rest.\n     * @param  {Object} data The content from wich to build the rest.\n     * @return {String}         The built rest.\n     * @example\n     * assert.equal(\n     *   BEARER.buildWWWAuthenticateRest({\n     *     realm: 'testrealm@host.com',\n     *     error: 'invalid_request',\n     *     error_description: 'The access token expired',\n     *   }),\n     *   'realm=\"testrealm@host.com\", ' +\n     *   'error=\"invalid_request\", ' +\n     *   'error_description=\"The access token expired\"'\n     * );\n     * @api public\n     */\n    buildWWWAuthenticateRest: function buildWWWAuthenticateRest(data) {\n        if (data.error &&\n            -1 ===\n                AUTHORIZED_ERROR_CODES.indexOf(data.error)) {\n            throw new YError('E_INVALID_ERROR', data.error, AUTHORIZED_ERROR_CODES);\n        }\n        return buildHTTPHeadersQuotedKeyValueSet(data, AUTHORIZED_WWW_AUTHENTICATE_KEYS, []);\n    },\n    /**\n     * Parse the Authorization header rest.\n     * @param  {String} rest The header rest (string after the authentication mechanism prefix).)\n     * @return {Object}      Object representing the result of the parse operation {hash}.\n     * @example\n     * assert.deepEqual(\n     *   BEARER.parseAuthorizationRest('mF_9.B5f-4.1JqM'), {\n     *     hash: 'mF_9.B5f-4.1JqM',\n     *   }\n     * );\n     * @api public\n     */\n    parseAuthorizationRest: function parseAuthorizationRest(rest) {\n        if (!rest) {\n            throw new YError('E_EMPTY_AUTH');\n        }\n        return {\n            hash: rest,\n        };\n    },\n    /**\n     * Build the Authorization header rest.\n     * @param  {Object} content The content from wich to build the rest.\n     * @return {String}         The rest built.\n     * @example\n     * assert.equal(\n     *   BEARER.buildAuthorizationRest({\n     *     hash: 'mF_9.B5f-4.1JqM'\n     *   }),\n     *   'mF_9.B5f-4.1JqM=='\n     * );\n     * @api public\n     */\n    buildAuthorizationRest: function buildAuthorizationRest({ hash, }) {\n        if (!hash) {\n            throw new YError('E_NO_HASH');\n        }\n        return hash;\n    },\n};\nexport default BEARER;\n//# sourceMappingURL=bearer.js.map","import { YError } from 'yerror';\nimport BASIC from './mechanisms/basic.js';\nimport DIGEST from './mechanisms/digest.js';\nimport BEARER from './mechanisms/bearer.js';\n/**\n * @module http-auth-utils\n */\n/**\n * Natively supported authentication mechanisms.\n * @type {Array}\n */\nconst mechanisms = [BASIC, DIGEST, BEARER];\n/**\n * Basic authentication mechanism.\n * @type {Object}\n * @see  {@link module:http-auth-utils/mechanisms/basic}\n */\nBASIC;\n/**\n * Digest authentication mechanism.\n * @type {Object}\n * @see  {@link module:http-auth-utils/mechanisms/digest}\n */\nDIGEST;\n/**\n * Bearer authentication mechanism.\n * @type {Object}\n * @see  {@link module:http-auth-utils/mechanisms/digest}\n */\nBEARER;\nexport { BASIC, DIGEST, BEARER, mechanisms };\n/**\n * Parse HTTP WWW-Authenticate header contents.\n * @type {Function}\n * @param {string} header\n * The WWW-Authenticate header contents\n * @param {Array} [authMechanisms=[BASIC, DIGEST, BEARER]]\n * Allow providing custom authentication mechanisms.\n * @param {Object} [options]\n * Parsing options\n * @param {boolean} [options.strict=true]\n * Strictly detect the mechanism type (case sensitive)\n * @return {Object} Result of the contents parse.\n * @api public\n * @example\n * assert.deepEqual(\n *   parseWWWAuthenticateHeader('Basic realm=\"test\"'), {\n *     type: 'Basic',\n *     data: {\n *       realm: 'test'\n *     }\n *   }\n * );\n */\nexport function parseWWWAuthenticateHeader(header, authMechanisms = mechanisms, { strict = true } = { strict: true }) {\n    let result = null;\n    authMechanisms.some((authMechanism) => {\n        if (0 === header.indexOf(authMechanism.type + ' ') ||\n            (!strict && 0 === header.indexOf(authMechanism.type.toLowerCase() + ' '))) {\n            result = {\n                type: authMechanism.type,\n                data: authMechanism.parseWWWAuthenticateRest(header.substr(authMechanism.type.length + 1)),\n            };\n            return true;\n        }\n        return false;\n    });\n    if (!result) {\n        throw new YError('E_UNKNOWN_AUTH_MECHANISM', header);\n    }\n    return result;\n}\n/**\n * Parse HTTP Authorization header contents.\n * @type {Function}\n * @param {string} header The Authorization header contents\n * @param {Array} [authMechanisms=[BASIC, DIGEST, BEARER]]\n * Allow custom authentication mechanisms.\n * @param {Object} [options]\n * Parsing options\n * @param {boolean} [options.strict=true]\n * Strictly detect the mechanism type (case sensitive)\n * @return {Object} Result of the contents parse.\n * @api public\n * @example\n * assert.deepEqual(\n *   parseAuthorizationHeader('Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ=='), {\n *     type: 'Basic',\n *     data: {\n *       hash: 'QWxhZGRpbjpvcGVuIHNlc2FtZQ=='\n *     }\n *   }\n * );\n */\nexport function parseAuthorizationHeader(header, authMechanisms = mechanisms, { strict = true } = { strict: true }) {\n    let result = null;\n    authMechanisms.some(function (authMechanism) {\n        if (0 === header.indexOf(authMechanism.type + ' ') ||\n            (!strict && 0 === header.indexOf(authMechanism.type.toLowerCase() + ' '))) {\n            result = {\n                type: authMechanism.type,\n                data: authMechanism.parseAuthorizationRest(header.substr(authMechanism.type.length + 1)),\n            };\n            return true;\n        }\n        return false;\n    });\n    if (result) {\n        return result;\n    }\n    throw new YError('E_UNKNOWN_AUTH_MECHANISM', header);\n}\n/**\n * Build HTTP WWW-Authenticate header value.\n * @type {Function}\n * @param {Object} authMechanism The mechanism to use\n * @param {Object}\n * The WWW-Authenticate header contents to base the value on.\n * @return {string} The header value.\n * @api public\n * @example\n * assert.deepEqual(\n *   buildWWWAuthenticateHeader(BASIC, {\n *     realm: 'test'\n *   }),\n *   'Basic realm=\"test\"'\n * );\n */\nexport function buildWWWAuthenticateHeader(authMechanism, data) {\n    return `${authMechanism.type} ${authMechanism.buildWWWAuthenticateRest(data)}`;\n}\n/**\n * Build HTTP Authorization header value.\n * @type {Function}\n * @param {Object} authMechanism The mechanism to use\n * @param {Object}\n * The Authorization header contents to base the value on.\n * @return {string} The header value.\n * @api public\n * @example\n * assert.deepEqual(\n *   buildAuthorizationHeader(BASIC, {\n *     realm: 'test'\n *   }),\n *   'Basic realm=\"test\"'\n * );\n */\nexport function buildAuthorizationHeader(authMechanism, data) {\n    return `${authMechanism.type} ${authMechanism.buildAuthorizationRest(data)}`;\n}\n//# sourceMappingURL=index.js.map","module.exports = require(\"assert\");","\"use strict\";\n\nexports.removeLeadingAndTrailingHTTPWhitespace = string => {\n  return string.replace(/^[ \\t\\n\\r]+/u, \"\").replace(/[ \\t\\n\\r]+$/u, \"\");\n};\n\nexports.removeTrailingHTTPWhitespace = string => {\n  return string.replace(/[ \\t\\n\\r]+$/u, \"\");\n};\n\nexports.isHTTPWhitespaceChar = char => {\n  return char === \" \" || char === \"\\t\" || char === \"\\n\" || char === \"\\r\";\n};\n\nexports.solelyContainsHTTPTokenCodePoints = string => {\n  return /^[-!#$%&'*+.^_`|~A-Za-z0-9]*$/u.test(string);\n};\n\nexports.soleyContainsHTTPQuotedStringTokenCodePoints = string => {\n  return /^[\\t\\u0020-\\u007E\\u0080-\\u00FF]*$/u.test(string);\n};\n\nexports.asciiLowercase = string => {\n  return string.replace(/[A-Z]/ug, l => l.toLowerCase());\n};\n\n// This variant only implements it with the extract-value flag set.\nexports.collectAnHTTPQuotedString = (input, position) => {\n  let value = \"\";\n\n  position++;\n\n  while (true) {\n    while (position < input.length && input[position] !== \"\\\"\" && input[position] !== \"\\\\\") {\n      value += input[position];\n      ++position;\n    }\n\n    if (position >= input.length) {\n      break;\n    }\n\n    const quoteOrBackslash = input[position];\n    ++position;\n\n    if (quoteOrBackslash === \"\\\\\") {\n      if (position >= input.length) {\n        value += \"\\\\\";\n        break;\n      }\n\n      value += input[position];\n      ++position;\n    } else {\n      break;\n    }\n  }\n\n  return [value, position];\n};\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.sdk = exports.MixinDeviceBase = exports.ScryptedDeviceBase = void 0;\n__exportStar(require(\"../types/gen/index\"), exports);\nconst fs_1 = __importDefault(require(\"fs\"));\nconst index_1 = require(\"../types/gen/index\");\nconst module_1 = require(\"module\");\n/**\n * @category Core Reference\n */\nclass ScryptedDeviceBase extends index_1.DeviceBase {\n    constructor(nativeId) {\n        super();\n        this.nativeId = nativeId;\n    }\n    get storage() {\n        if (!this._storage) {\n            this._storage = exports.sdk.deviceManager.getDeviceStorage(this.nativeId);\n        }\n        return this._storage;\n    }\n    get log() {\n        if (!this._log) {\n            this._log = exports.sdk.deviceManager.getDeviceLogger(this.nativeId);\n        }\n        return this._log;\n    }\n    get console() {\n        if (!this._console) {\n            this._console = exports.sdk.deviceManager.getDeviceConsole(this.nativeId);\n        }\n        return this._console;\n    }\n    async createMediaObject(data, mimeType) {\n        return exports.sdk.mediaManager.createMediaObject(data, mimeType, {\n            sourceId: this.id,\n        });\n    }\n    getMediaObjectConsole(mediaObject) {\n        if (typeof mediaObject.sourceId !== 'string')\n            return this.console;\n        return exports.sdk.deviceManager.getMixinConsole(mediaObject.sourceId, this.nativeId);\n    }\n    _lazyLoadDeviceState() {\n        if (!this._deviceState) {\n            if (this.nativeId) {\n                this._deviceState = exports.sdk.deviceManager.getDeviceState(this.nativeId);\n            }\n            else {\n                this._deviceState = exports.sdk.deviceManager.getDeviceState();\n            }\n        }\n    }\n    /**\n     * Fire an event for this device.\n     */\n    onDeviceEvent(eventInterface, eventData) {\n        return exports.sdk.deviceManager.onDeviceEvent(this.nativeId, eventInterface, eventData);\n    }\n}\nexports.ScryptedDeviceBase = ScryptedDeviceBase;\n/**\n * @category Mixin Reference\n */\nclass MixinDeviceBase extends index_1.DeviceBase {\n    constructor(options) {\n        super();\n        this._listeners = new Set();\n        this.mixinDevice = options.mixinDevice;\n        this.mixinDeviceInterfaces = options.mixinDeviceInterfaces;\n        this.mixinStorageSuffix = options.mixinStorageSuffix;\n        this._deviceState = options.mixinDeviceState;\n        this.nativeId = exports.sdk.systemManager.getDeviceById(this.id).nativeId;\n        this.mixinProviderNativeId = options.mixinProviderNativeId;\n        // RpcProxy will trap all properties, and the following check/hack will determine\n        // if the device state came from another node worker thread.\n        // This should ultimately be discouraged and warned at some point in the future.\n        if (this._deviceState.__rpcproxy_traps_all_properties && typeof this._deviceState.id === 'string') {\n            this._deviceState = exports.sdk.deviceManager.createDeviceState(this._deviceState.id, this._deviceState.setState);\n        }\n    }\n    get storage() {\n        if (!this._storage) {\n            const mixinStorageSuffix = this.mixinStorageSuffix;\n            const mixinStorageKey = this.id + (mixinStorageSuffix ? ':' + mixinStorageSuffix : '');\n            this._storage = exports.sdk.deviceManager.getMixinStorage(mixinStorageKey, this.mixinProviderNativeId);\n        }\n        return this._storage;\n    }\n    get console() {\n        if (!this._console) {\n            if (exports.sdk.deviceManager.getMixinConsole)\n                this._console = exports.sdk.deviceManager.getMixinConsole(this.id, this.mixinProviderNativeId);\n            else\n                this._console = exports.sdk.deviceManager.getDeviceConsole(this.mixinProviderNativeId);\n        }\n        return this._console;\n    }\n    async createMediaObject(data, mimeType) {\n        return exports.sdk.mediaManager.createMediaObject(data, mimeType, {\n            sourceId: this.id,\n        });\n    }\n    getMediaObjectConsole(mediaObject) {\n        if (typeof mediaObject.sourceId !== 'string')\n            return this.console;\n        return exports.sdk.deviceManager.getMixinConsole(mediaObject.sourceId, this.mixinProviderNativeId);\n    }\n    /**\n     * Fire an event for this device.\n     */\n    onDeviceEvent(eventInterface, eventData) {\n        return exports.sdk.deviceManager.onMixinEvent(this.id, this, eventInterface, eventData);\n    }\n    _lazyLoadDeviceState() {\n    }\n    manageListener(listener) {\n        this._listeners.add(listener);\n    }\n    release() {\n        for (const l of this._listeners) {\n            l.removeListener();\n        }\n    }\n}\nexports.MixinDeviceBase = MixinDeviceBase;\n(function () {\n    function _createGetState(state) {\n        return function () {\n            this._lazyLoadDeviceState();\n            // @ts-ignore: accessing private property\n            return this._deviceState?.[state];\n        };\n    }\n    function _createSetState(state) {\n        return function (value) {\n            this._lazyLoadDeviceState();\n            // @ts-ignore: accessing private property\n            if (!this._deviceState) {\n                console.warn('device state is unavailable. the device must be discovered with deviceManager.onDeviceDiscovered or deviceManager.onDevicesChanged before the state can be set.');\n            }\n            else {\n                // @ts-ignore: accessing private property\n                this._deviceState[state] = value;\n            }\n        };\n    }\n    for (const field of Object.values(index_1.ScryptedInterfaceProperty)) {\n        if (field === index_1.ScryptedInterfaceProperty.nativeId)\n            continue;\n        Object.defineProperty(ScryptedDeviceBase.prototype, field, {\n            set: _createSetState(field),\n            get: _createGetState(field),\n        });\n        Object.defineProperty(MixinDeviceBase.prototype, field, {\n            set: _createSetState(field),\n            get: _createGetState(field),\n        });\n    }\n})();\nexports.sdk = {};\ntry {\n    let loaded = false;\n    try {\n        // todo: remove usage of process.env.SCRYPTED_SDK_MODULE, only existed in prerelease builds.\n        // import.meta is not a reliable way to detect es module support in webpack since webpack\n        // evaluates that to true at runtime.\n        const esModule = process.env.SCRYPTED_SDK_ES_MODULE || process.env.SCRYPTED_SDK_MODULE;\n        const cjsModule = process.env.SCRYPTED_SDK_CJS_MODULE || process.env.SCRYPTED_SDK_MODULE;\n        // @ts-expect-error\n        if (esModule && typeof import.meta !== 'undefined') {\n            // @ts-expect-error\n            const require = (0, module_1.createRequire)(import.meta.url);\n            const sdkModule = require(esModule);\n            Object.assign(exports.sdk, sdkModule.getScryptedStatic());\n            loaded = true;\n        }\n        else if (cjsModule) {\n            // @ts-expect-error\n            if (typeof __non_webpack_require__ !== 'undefined') {\n                // @ts-expect-error\n                const sdkModule = __non_webpack_require__(process.env.SCRYPTED_SDK_MODULE);\n                Object.assign(exports.sdk, sdkModule.getScryptedStatic());\n                loaded = true;\n            }\n            else {\n                const sdkModule = require(cjsModule);\n                Object.assign(exports.sdk, sdkModule.getScryptedStatic());\n                loaded = true;\n            }\n        }\n    }\n    catch (e) {\n        console.warn(\"failed to load sdk module\", e);\n        throw e;\n    }\n    if (!loaded) {\n        let runtimeAPI;\n        try {\n            runtimeAPI = pluginRuntimeAPI;\n        }\n        catch (e) {\n        }\n        Object.assign(exports.sdk, {\n            log: deviceManager.getDeviceLogger(undefined),\n            deviceManager,\n            endpointManager,\n            mediaManager,\n            systemManager,\n            pluginHostAPI,\n            ...runtimeAPI,\n        });\n    }\n    try {\n        let descriptors = {\n            ...index_1.ScryptedInterfaceDescriptors,\n        };\n        try {\n            const sdkJson = JSON.parse(fs_1.default.readFileSync('../sdk.json').toString());\n            const customDescriptors = sdkJson.interfaceDescriptors;\n            if (customDescriptors) {\n                descriptors = {\n                    ...descriptors,\n                    ...customDescriptors,\n                };\n            }\n        }\n        catch (e) {\n            console.warn('failed to load custom interface descriptors', e);\n        }\n        exports.sdk.systemManager.setScryptedInterfaceDescriptors?.(index_1.TYPES_VERSION, descriptors)?.catch(() => { });\n    }\n    catch (e) {\n    }\n}\ncatch (e) {\n    console.error('sdk initialization error, import @scrypted/types or use @scrypted/client instead', e);\n}\nexports.default = exports.sdk;\n//# sourceMappingURL=index.js.map","import { ScryptedDevice, ScryptedDeviceBase, ScryptedDeviceType, ScryptedInterface } from \"@scrypted/sdk\";\nimport sdk from \"@scrypted/sdk\";\n\nconst { systemManager } = sdk;\n\n\nexport abstract class AutoenableMixinProvider extends ScryptedDeviceBase {\n    hasEnabledMixin: { [id: string]: string } = {};\n    pluginsComponent: Promise<any>;\n\n    constructor(nativeId?: string, public autoIncludeToken = 'v4') {\n        super(nativeId);\n\n        try {\n            this.hasEnabledMixin = JSON.parse(this.storage.getItem('hasEnabledMixin'));\n        }\n        catch (e) {\n            this.hasEnabledMixin = {};\n        }\n\n        this.pluginsComponent = systemManager.getComponent('plugins');\n\n        // watch for descriptor changes.\n        systemManager.listen(async (eventSource, eventDetails, eventData) => {\n            if (eventDetails.eventInterface !== ScryptedInterface.ScryptedDevice || eventDetails.property)\n                return;\n\n            this.maybeEnableMixin(eventSource);\n        });\n\n        process.nextTick(() => {\n            for (const id of Object.keys(systemManager.getSystemState())) {\n                const device = systemManager.getDeviceById(id);\n                this.maybeEnableMixin(device);\n            }\n        });\n    }\n\n    async shouldEnableMixin(device: ScryptedDevice) {\n        return true;\n    }\n\n    checkHasEnabledMixin(device: ScryptedDevice) {\n        return this.hasEnabledMixin[device.id] === this.autoIncludeToken;\n    }\n\n    shouldUnshiftMixin(device: ScryptedDevice) {\n        return false;\n    }\n\n    async maybeEnableMixin(device: ScryptedDevice) {\n        if (!device || device.mixins?.includes(this.id))\n            return;\n\n        if (this.checkHasEnabledMixin(device))\n            return;\n\n        const match = await this.canMixin(device.type, device.interfaces);\n        if (!match)\n            return;\n\n        if (!await this.shouldEnableMixin(device))\n            return;\n\n        this.log.i('auto enabling mixin for ' + device.name)\n        const mixins = (device.mixins || []).slice();\n        if (this.shouldUnshiftMixin(device))\n            mixins.unshift(this.id);\n        else\n            mixins.push(this.id);\n        const plugins = await this.pluginsComponent;\n        await plugins.setMixins(device.id, mixins);\n        this.setHasEnabledMixin(device.id);\n    }\n\n    setHasEnabledMixin(id: string) {\n        if (this.hasEnabledMixin[id] === this.autoIncludeToken)\n            return;\n        this.hasEnabledMixin[id] = this.autoIncludeToken;\n        this.storage.setItem('hasEnabledMixin', JSON.stringify(this.hasEnabledMixin));\n    }\n\n    abstract canMixin(type: ScryptedDeviceType | string, interfaces: string[]): Promise<string[] | null | undefined | void>;\n}\n","import { ChildProcess } from \"child_process\";\nimport process from 'process';\nimport { sleep } from \"./sleep\";\n\nconst filtered = [\n    'decode_slice_header error',\n    'no frame!',\n    'non-existing PPS',\n];\n\nexport async function safeKillFFmpeg(cp: ChildProcess) {\n    if (!cp)\n        return;\n    if (cp.exitCode != null)\n        return;\n    await new Promise(async resolve => {\n        cp.on('exit', resolve);\n        // this will allow ffmpeg to send rtsp TEARDOWN etc\n        try {\n            cp.stdin!.on('error', () => { });\n            cp.stdin!.write('q\\n');\n        }\n        catch (e) {\n        }\n\n        await sleep(2000);\n        for (const f of cp.stdio) {\n            try {\n                f?.destroy();\n            }\n            catch (e) {\n            }\n        }\n        cp.kill();\n        await sleep(2000);\n        cp.kill('SIGKILL');\n    });\n}\n\nexport function ffmpegLogInitialOutput(console: Console, cp: ChildProcess, forever?: boolean, storage?: Storage) {\n    if (!console)\n        return;\n\n    const SCRYPTED_FFMPEG_NOISY = !!process.env.SCRYPTED_FFMPEG_NOISY || !!storage?.getItem('SCRYPTED_FFMPEG_NOISY');\n\n    function logger(log: (str: string) => void): (buffer: Buffer) => void {\n        const ret = (buffer: Buffer) => {\n            const str = buffer.toString();\n\n            for (const filter of filtered) {\n                if (str.indexOf(filter) !== -1)\n                    return;\n            }\n\n            if (!SCRYPTED_FFMPEG_NOISY && !forever && (str.indexOf('frame=') !== -1 || str.indexOf('size=') !== -1)) {\n                log(str);\n                log('video/audio detected, discarding further input');\n                cp.stdout!.removeListener('data', ret);\n                cp.stderr!.removeListener('data', ret);\n                return;\n            }\n\n            log(str);\n        }\n\n        return ret;\n    };\n    cp.stdout?.on('data', logger(console.log));\n    cp.stderr?.on('data', logger(console.error));\n    cp.on('exit', () => console.log('ffmpeg exited'));\n}\n\nexport function safePrintFFmpegArguments(console: Console, args: string[]) {\n    if (!console)\n        return;\n    const ret = [];\n    let redactNext = false;\n    for (const arg of args) {\n        try {\n            if (redactNext) {\n                const url = new URL(arg);\n                ret.push(`${url.protocol}[REDACTED]`)\n            }\n            else {\n                ret.push(arg);\n            }\n        }\n        catch (e) {\n            ret.push(arg);\n        }\n\n        // input arguments may contain passwords.\n        redactNext = arg === '-i';\n    }\n\n    console.log(ret.join(' '));\n}\n","module.exports = require(\"module\");","export { safeKillFFmpeg, ffmpegLogInitialOutput, safePrintFFmpegArguments } from '../../server/src/media-helpers';\n","import { addVideoFilterArguments } from '@scrypted/common/src/ffmpeg-helpers';\nimport { ffmpegLogInitialOutput, safeKillFFmpeg, safePrintFFmpegArguments } from '@scrypted/common/src/media-helpers';\nimport { timeoutFunction } from '@scrypted/common/src/promise-utils';\nimport { sleep } from '@scrypted/common/src/sleep';\nimport child_process, { ChildProcess } from 'child_process';\nimport { once } from 'events';\nimport { Writable } from 'stream';\nimport { Pipe2Jpeg } from './pipe2jpeg';\n\nconst defaultFfmpegImageArgs = [\n    '-hide_banner',\n    '-hwaccel', 'none',\n    '-err_detect', 'aggressive',\n    '-fflags', 'discardcorrupt',\n    '-y',\n];\n\nexport interface FFmpegImageFilterOptions {\n    console?: Console,\n    blur?: boolean;\n    brightness?: number;\n    ffmpegPath?: string;\n    text?: {\n        text: string;\n        fontFile: string;\n    };\n    timeout?: number;\n\n    resize?: {\n        fractional?: boolean;\n        width?: number;\n        height?: number;\n    };\n\n    crop?: {\n        fractional?: boolean;\n        left: number;\n        top: number;\n        width: number;\n        height: number;\n    };\n\n    time?: number;\n}\n\nfunction ffmpegCreateOutputArguments(inputArguments: string[], options: FFmpegImageFilterOptions) {\n    if (options.crop) {\n        const { crop } = options;\n\n        const left = crop.fractional ? `iw*${crop.left}` : crop.left;\n        const top = crop.fractional ? `ih*${crop.top}` : crop.top;\n        const width = crop.fractional ? `iw*${crop.width}` : crop.width;\n        const height = crop.fractional ? `ih*${crop.height}` : crop.height;\n\n        const filter = `crop=${width}:${height}:${left}:${top}`;\n        addVideoFilterArguments(inputArguments, filter, 'snapshotCrop');\n    }\n\n    // favor height, and always respect aspect ratio.\n    if (options.resize?.width || options.resize?.height) {\n        const { resize } = options;\n        let width: string | number;\n        let height: string | number;\n\n        if (!resize.height) {\n            height = -2;\n            width = resize.fractional ? `iw*${resize.width}` : `'min(${resize.width},iw)'`;\n        }\n        else {\n            width = -2;\n            height = resize.fractional ? `ih*${resize.height}` : `'min(${resize.height},ih)'`;\n        }\n\n        const filter = `scale=${width}:${height}`;\n        addVideoFilterArguments(inputArguments, filter, 'snapshotResize');\n    }\n\n    if (options.brightness) {\n        addVideoFilterArguments(inputArguments, `eq=brightness=${options.brightness}`, 'snapshotEq');\n    }\n\n    if (options.blur) {\n        addVideoFilterArguments(inputArguments, 'gblur=sigma=25', 'snapshotBlur');\n    }\n\n    if (options.text) {\n        const { text } = options;\n        addVideoFilterArguments(inputArguments,\n            `drawtext=fontfile=${text.fontFile}:text='${text.text}':fontcolor=white:fontsize=h/8:x=(w-text_w)/2:y=(h-text_h)/2`,\n            'snapshotText');\n    }\n\n    // if (options)\n    //     console.log('input arguments', inputArguments);\n}\n\nexport function ffmpegFilterImageBuffer(inputJpeg: Buffer, options: FFmpegImageFilterOptions) {\n    const inputArguments = [\n        '-f', 'image2pipe',\n        '-i', 'pipe:4',\n    ];\n\n    ffmpegCreateOutputArguments(inputArguments, options);\n    const outputArguments = [\n        '-frames:v', '1',\n        '-f', 'image2',\n        'pipe:3',\n    ];\n    const args: string[] = [\n        ...defaultFfmpegImageArgs,\n\n        ...inputArguments,\n\n        ...outputArguments,\n    ];\n\n    safePrintFFmpegArguments(options.console, args);\n    const cp = child_process.spawn(options.ffmpegPath || 'ffmpeg',\n        args, {\n        stdio: ['pipe', 'pipe', 'pipe', 'pipe', 'pipe'],\n    });\n    ffmpegLogInitialOutput(options.console, cp);\n\n    const input = cp.stdio[4] as Writable;\n    input.write(inputJpeg);\n    input.end();\n\n    return ffmpegFilterImageInternal(cp, options);\n}\n\nexport function ffmpegFilterImage(inputArguments: string[], options: FFmpegImageFilterOptions) {\n    ffmpegCreateOutputArguments(inputArguments, options);\n\n    let outputArguments: string[];\n    if (options.time) {\n        outputArguments = [\n            '-vsync', '0',\n            '-f', 'image2pipe',\n            'pipe:3',\n        ];\n    }\n    else {\n        outputArguments = [\n            // ensure it is an iframe. decoding h265 can result in corrupt p frames being decoded.\n            // which is weird, why doesnt ffmpeg skip it?\n            '-vf', \"select='eq(pict_type\\,I)'\",\n            '-frames:v', '1',\n            '-f', 'image2',\n            'pipe:3',\n        ];\n    }\n\n    const args: string[] = [\n        ...defaultFfmpegImageArgs,\n\n        ...inputArguments,\n\n        ...outputArguments,\n    ];\n\n    // console.log(args);\n\n    safePrintFFmpegArguments(options.console, args);\n    const cp = child_process.spawn(options.ffmpegPath || 'ffmpeg',\n        args, {\n        stdio: ['pipe', 'pipe', 'pipe', 'pipe'],\n    });\n    ffmpegLogInitialOutput(options.console, cp);\n\n    if (options.time)\n        return ffmpegFilterImageStream(cp, options);\n    else\n        return ffmpegFilterImageInternal(cp, options);\n}\n\nexport async function ffmpegFilterImageInternal(cp: ChildProcess, options: FFmpegImageFilterOptions) {\n    const buffers: Buffer[] = [];\n    cp.stdio[3].on('data', data => buffers.push(data));\n\n    try {\n        await timeoutFunction(options.timeout || 10000, async () => {\n            const exit = once(cp, 'exit');\n            await once(cp.stdio[3], 'end').catch(() => { });\n            const [exitCode] = await exit;\n            if (exitCode)\n                throw new Error(`ffmpeg input to image conversion failed with exit code: ${exitCode}, ${cp.spawnargs.join(' ')}`);\n        });\n    }\n    catch (e) {\n        if (!buffers.length)\n            throw e;\n    }\n    finally {\n        safeKillFFmpeg(cp);\n    }\n\n    return Buffer.concat(buffers);\n}\n\nexport async function ffmpegFilterImageStream(cp: ChildProcess, options: FFmpegImageFilterOptions) {\n    try {\n        return await timeoutFunction(options.timeout || 10000, async () => {\n            const pipe = cp.stdio[3].pipe(new Pipe2Jpeg());\n            let last: Buffer;\n            let count = 0;\n            pipe.on('jpeg', jpeg => {\n                ++count;\n                last = jpeg;\n            });\n\n            await once(pipe, 'jpeg');\n            await Promise.any([once(cp, 'exit'), sleep(options.time)]).catch(() => {});\n            if (!last)\n                throw new Error(`ffmpeg stream to image conversion failed with exit code: ${cp.exitCode}, ${cp.spawnargs.join(' ')}`);\n            return last;\n        });\n    }\n    finally {\n        safeKillFFmpeg(cp);\n    }\n}\n","import { HttpFetchOptions, HttpFetchResponseType, checkStatus, createHeadersArray, fetcher, getFetchMethod, hasHeader, setDefaultHttpFetchAccept, setHeader } from '../../../server/src/fetch';\n\nexport interface AuthFetchCredentialState {\n    username: string;\n    password: string;\n}\n\nexport interface AuthFetchOptions {\n    credential?: AuthFetchCredentialState;\n}\n\nasync function getAuth(options: AuthFetchOptions, url: string | URL, method: string) {\n    if (!options.credential)\n        return;\n\n    const { BASIC, DIGEST, parseWWWAuthenticateHeader } = await import('http-auth-utils');\n\n    const credential = options.credential as AuthFetchCredentialState & {\n        count?: number;\n        digest?: ReturnType<typeof parseWWWAuthenticateHeader<typeof DIGEST>>;\n        basic?: ReturnType<typeof parseWWWAuthenticateHeader<typeof BASIC>>;\n    };\n    const { digest, basic } = credential;\n\n    if (digest) {\n        credential.count ||= 0;\n        ++credential.count;\n        const nc = ('00000000' + credential.count).slice(-8);\n        const cnonce = [...Array(24)].map(() => Math.floor(Math.random() * 16).toString(16)).join('');\n        const parsedURL = new URL(url);\n        const uri = parsedURL.pathname + parsedURL.search;\n\n        const { DIGEST, buildAuthorizationHeader } = await import('http-auth-utils');\n\n        const response = DIGEST.computeHash({\n            username: options.credential.username,\n            password: options.credential.password,\n            method,\n            uri,\n            nc,\n            cnonce,\n            algorithm: 'MD5',\n            qop: digest.data.qop!,\n            ...digest.data,\n        });\n\n        const header = buildAuthorizationHeader(DIGEST, {\n            username: options.credential.username,\n            uri,\n            nc,\n            cnonce,\n            algorithm: digest.data.algorithm!,\n            qop: digest.data.qop!,\n            response,\n            ...digest.data,\n        });\n\n        return header;\n    }\n    else if (basic) {\n        const { BASIC, buildAuthorizationHeader } = await import('http-auth-utils');\n\n        const header = buildAuthorizationHeader(BASIC, {\n            username: options.credential.username,\n            password: options.credential.password,\n        });\n\n        return header;\n    }\n}\n\nexport function createAuthFetch<B, M>(\n    h: fetcher<B, M>,\n    parser: (body: M, responseType: HttpFetchResponseType | undefined) => Promise<any>\n) {\n    const authHttpFetch = async <T extends HttpFetchOptions<B>>(options: T & AuthFetchOptions): ReturnType<typeof h<T>> => {\n        const method = getFetchMethod(options);\n        const headers = createHeadersArray(options.headers);\n        options.headers = headers;\n        setDefaultHttpFetchAccept(headers, options.responseType);\n\n        const initialHeader = await getAuth(options, options.url, method);\n        // try to provide an authorization if a session exists, but don't override Authorization if provided already.\n        // 401 will trigger a proper auth.\n        if (initialHeader && !hasHeader(headers, 'Authorization'))\n            setHeader(headers, 'Authorization', initialHeader);\n\n\n        const controller = new AbortController();\n        options.signal?.addEventListener('abort', () => controller.abort(options.signal?.reason));\n\n        const initialResponse = await h({\n            ...options,\n            signal: controller.signal,\n            // need to intercept the status code to check for 401.\n            // all other status codes will be handled according to the initial request options.\n            checkStatusCode(statusCode) {\n                // can handle a 401 if an credential is provided.\n                // however, not providing a credential is also valid, and should\n                // fall through to the normal response handling which may be interested\n                // in the 401 response.\n                if (statusCode === 401 && options.credential)\n                    return true;\n                if (options?.checkStatusCode === undefined || options?.checkStatusCode) {\n                    const checker = typeof options?.checkStatusCode === 'function' ? options.checkStatusCode : checkStatus;\n                    return checker(statusCode);\n                }\n                return true;\n            },\n            responseType: 'readable',\n        });\n\n        // if it's not a 401, just return the response.\n        if (initialResponse.statusCode !== 401) {\n            return {\n                ...initialResponse,\n                body: await parser(initialResponse.body, options.responseType),\n            };\n        }\n\n        let authenticateHeaders: string | string[] | null = initialResponse.headers.get('www-authenticate');\n        if (!authenticateHeaders)\n            throw new Error('Did not find WWW-Authenticate header.');\n\n\n        if (typeof authenticateHeaders === 'string')\n            authenticateHeaders = [authenticateHeaders];\n\n        const { BASIC, DIGEST, parseWWWAuthenticateHeader } = await import('http-auth-utils');\n        const parsedHeaders = authenticateHeaders.map(h => parseWWWAuthenticateHeader(h));\n\n        const digest = parsedHeaders.find(p => p.type === 'Digest') as ReturnType<typeof parseWWWAuthenticateHeader<typeof DIGEST>>;\n        const basic = parsedHeaders.find(p => p.type === 'Basic') as ReturnType<typeof parseWWWAuthenticateHeader<typeof BASIC>>;\n        const credential = options.credential as AuthFetchCredentialState & {\n            count?: number;\n            digest?: ReturnType<typeof parseWWWAuthenticateHeader<typeof DIGEST>>;\n            basic?: ReturnType<typeof parseWWWAuthenticateHeader<typeof BASIC>>;\n        };\n\n        credential.digest = digest;\n        credential.basic = basic;\n\n        if (!digest && !basic)\n            throw new Error(`Unknown WWW-Authenticate type: ${parsedHeaders[0]?.type}`);\n\n        const header = await getAuth(options, options.url, method);\n        if (header)\n            setHeader(headers, 'Authorization', header);\n\n        return h(options);\n    }\n\n    return authHttpFetch;\n}\n","const sharp = __non_webpack_require__('sharp'); module.exports = sharp;","\"use strict\";\nconst { solelyContainsHTTPTokenCodePoints } = require(\"./utils.js\");\n\nmodule.exports = mimeType => {\n  let serialization = `${mimeType.type}/${mimeType.subtype}`;\n\n  if (mimeType.parameters.size === 0) {\n    return serialization;\n  }\n\n  for (let [name, value] of mimeType.parameters) {\n    serialization += \";\";\n    serialization += name;\n    serialization += \"=\";\n\n    if (!solelyContainsHTTPTokenCodePoints(value) || value.length === 0) {\n      value = value.replace(/([\"\\\\])/ug, \"\\\\$1\");\n      value = `\"${value}\"`;\n    }\n\n    serialization += value;\n  }\n\n  return serialization;\n};\n","var url = require(\"url\");\nvar URL = url.URL;\nvar http = require(\"http\");\nvar https = require(\"https\");\nvar Writable = require(\"stream\").Writable;\nvar assert = require(\"assert\");\nvar debug = require(\"./debug\");\n\n// Preventive platform detection\n// istanbul ignore next\n(function detectUnsupportedEnvironment() {\n  var looksLikeNode = typeof process !== \"undefined\";\n  var looksLikeBrowser = typeof window !== \"undefined\" && typeof document !== \"undefined\";\n  var looksLikeV8 = isFunction(Error.captureStackTrace);\n  if (!looksLikeNode && (looksLikeBrowser || !looksLikeV8)) {\n    console.warn(\"The follow-redirects package should be excluded from browser builds.\");\n  }\n}());\n\n// Whether to use the native URL object or the legacy url module\nvar useNativeURL = false;\ntry {\n  assert(new URL(\"\"));\n}\ncatch (error) {\n  useNativeURL = error.code === \"ERR_INVALID_URL\";\n}\n\n// URL fields to preserve in copy operations\nvar preservedUrlFields = [\n  \"auth\",\n  \"host\",\n  \"hostname\",\n  \"href\",\n  \"path\",\n  \"pathname\",\n  \"port\",\n  \"protocol\",\n  \"query\",\n  \"search\",\n  \"hash\",\n];\n\n// Create handlers that pass events from native requests\nvar events = [\"abort\", \"aborted\", \"connect\", \"error\", \"socket\", \"timeout\"];\nvar eventHandlers = Object.create(null);\nevents.forEach(function (event) {\n  eventHandlers[event] = function (arg1, arg2, arg3) {\n    this._redirectable.emit(event, arg1, arg2, arg3);\n  };\n});\n\n// Error types with codes\nvar InvalidUrlError = createErrorType(\n  \"ERR_INVALID_URL\",\n  \"Invalid URL\",\n  TypeError\n);\nvar RedirectionError = createErrorType(\n  \"ERR_FR_REDIRECTION_FAILURE\",\n  \"Redirected request failed\"\n);\nvar TooManyRedirectsError = createErrorType(\n  \"ERR_FR_TOO_MANY_REDIRECTS\",\n  \"Maximum number of redirects exceeded\",\n  RedirectionError\n);\nvar MaxBodyLengthExceededError = createErrorType(\n  \"ERR_FR_MAX_BODY_LENGTH_EXCEEDED\",\n  \"Request body larger than maxBodyLength limit\"\n);\nvar WriteAfterEndError = createErrorType(\n  \"ERR_STREAM_WRITE_AFTER_END\",\n  \"write after end\"\n);\n\n// istanbul ignore next\nvar destroy = Writable.prototype.destroy || noop;\n\n// An HTTP(S) request that can be redirected\nfunction RedirectableRequest(options, responseCallback) {\n  // Initialize the request\n  Writable.call(this);\n  this._sanitizeOptions(options);\n  this._options = options;\n  this._ended = false;\n  this._ending = false;\n  this._redirectCount = 0;\n  this._redirects = [];\n  this._requestBodyLength = 0;\n  this._requestBodyBuffers = [];\n\n  // Attach a callback if passed\n  if (responseCallback) {\n    this.on(\"response\", responseCallback);\n  }\n\n  // React to responses of native requests\n  var self = this;\n  this._onNativeResponse = function (response) {\n    try {\n      self._processResponse(response);\n    }\n    catch (cause) {\n      self.emit(\"error\", cause instanceof RedirectionError ?\n        cause : new RedirectionError({ cause: cause }));\n    }\n  };\n\n  // Perform the first request\n  this._performRequest();\n}\nRedirectableRequest.prototype = Object.create(Writable.prototype);\n\nRedirectableRequest.prototype.abort = function () {\n  destroyRequest(this._currentRequest);\n  this._currentRequest.abort();\n  this.emit(\"abort\");\n};\n\nRedirectableRequest.prototype.destroy = function (error) {\n  destroyRequest(this._currentRequest, error);\n  destroy.call(this, error);\n  return this;\n};\n\n// Writes buffered data to the current native request\nRedirectableRequest.prototype.write = function (data, encoding, callback) {\n  // Writing is not allowed if end has been called\n  if (this._ending) {\n    throw new WriteAfterEndError();\n  }\n\n  // Validate input and shift parameters if necessary\n  if (!isString(data) && !isBuffer(data)) {\n    throw new TypeError(\"data should be a string, Buffer or Uint8Array\");\n  }\n  if (isFunction(encoding)) {\n    callback = encoding;\n    encoding = null;\n  }\n\n  // Ignore empty buffers, since writing them doesn't invoke the callback\n  // https://github.com/nodejs/node/issues/22066\n  if (data.length === 0) {\n    if (callback) {\n      callback();\n    }\n    return;\n  }\n  // Only write when we don't exceed the maximum body length\n  if (this._requestBodyLength + data.length <= this._options.maxBodyLength) {\n    this._requestBodyLength += data.length;\n    this._requestBodyBuffers.push({ data: data, encoding: encoding });\n    this._currentRequest.write(data, encoding, callback);\n  }\n  // Error when we exceed the maximum body length\n  else {\n    this.emit(\"error\", new MaxBodyLengthExceededError());\n    this.abort();\n  }\n};\n\n// Ends the current native request\nRedirectableRequest.prototype.end = function (data, encoding, callback) {\n  // Shift parameters if necessary\n  if (isFunction(data)) {\n    callback = data;\n    data = encoding = null;\n  }\n  else if (isFunction(encoding)) {\n    callback = encoding;\n    encoding = null;\n  }\n\n  // Write data if needed and end\n  if (!data) {\n    this._ended = this._ending = true;\n    this._currentRequest.end(null, null, callback);\n  }\n  else {\n    var self = this;\n    var currentRequest = this._currentRequest;\n    this.write(data, encoding, function () {\n      self._ended = true;\n      currentRequest.end(null, null, callback);\n    });\n    this._ending = true;\n  }\n};\n\n// Sets a header value on the current native request\nRedirectableRequest.prototype.setHeader = function (name, value) {\n  this._options.headers[name] = value;\n  this._currentRequest.setHeader(name, value);\n};\n\n// Clears a header value on the current native request\nRedirectableRequest.prototype.removeHeader = function (name) {\n  delete this._options.headers[name];\n  this._currentRequest.removeHeader(name);\n};\n\n// Global timeout for all underlying requests\nRedirectableRequest.prototype.setTimeout = function (msecs, callback) {\n  var self = this;\n\n  // Destroys the socket on timeout\n  function destroyOnTimeout(socket) {\n    socket.setTimeout(msecs);\n    socket.removeListener(\"timeout\", socket.destroy);\n    socket.addListener(\"timeout\", socket.destroy);\n  }\n\n  // Sets up a timer to trigger a timeout event\n  function startTimer(socket) {\n    if (self._timeout) {\n      clearTimeout(self._timeout);\n    }\n    self._timeout = setTimeout(function () {\n      self.emit(\"timeout\");\n      clearTimer();\n    }, msecs);\n    destroyOnTimeout(socket);\n  }\n\n  // Stops a timeout from triggering\n  function clearTimer() {\n    // Clear the timeout\n    if (self._timeout) {\n      clearTimeout(self._timeout);\n      self._timeout = null;\n    }\n\n    // Clean up all attached listeners\n    self.removeListener(\"abort\", clearTimer);\n    self.removeListener(\"error\", clearTimer);\n    self.removeListener(\"response\", clearTimer);\n    self.removeListener(\"close\", clearTimer);\n    if (callback) {\n      self.removeListener(\"timeout\", callback);\n    }\n    if (!self.socket) {\n      self._currentRequest.removeListener(\"socket\", startTimer);\n    }\n  }\n\n  // Attach callback if passed\n  if (callback) {\n    this.on(\"timeout\", callback);\n  }\n\n  // Start the timer if or when the socket is opened\n  if (this.socket) {\n    startTimer(this.socket);\n  }\n  else {\n    this._currentRequest.once(\"socket\", startTimer);\n  }\n\n  // Clean up on events\n  this.on(\"socket\", destroyOnTimeout);\n  this.on(\"abort\", clearTimer);\n  this.on(\"error\", clearTimer);\n  this.on(\"response\", clearTimer);\n  this.on(\"close\", clearTimer);\n\n  return this;\n};\n\n// Proxy all other public ClientRequest methods\n[\n  \"flushHeaders\", \"getHeader\",\n  \"setNoDelay\", \"setSocketKeepAlive\",\n].forEach(function (method) {\n  RedirectableRequest.prototype[method] = function (a, b) {\n    return this._currentRequest[method](a, b);\n  };\n});\n\n// Proxy all public ClientRequest properties\n[\"aborted\", \"connection\", \"socket\"].forEach(function (property) {\n  Object.defineProperty(RedirectableRequest.prototype, property, {\n    get: function () { return this._currentRequest[property]; },\n  });\n});\n\nRedirectableRequest.prototype._sanitizeOptions = function (options) {\n  // Ensure headers are always present\n  if (!options.headers) {\n    options.headers = {};\n  }\n\n  // Since http.request treats host as an alias of hostname,\n  // but the url module interprets host as hostname plus port,\n  // eliminate the host property to avoid confusion.\n  if (options.host) {\n    // Use hostname if set, because it has precedence\n    if (!options.hostname) {\n      options.hostname = options.host;\n    }\n    delete options.host;\n  }\n\n  // Complete the URL object when necessary\n  if (!options.pathname && options.path) {\n    var searchPos = options.path.indexOf(\"?\");\n    if (searchPos < 0) {\n      options.pathname = options.path;\n    }\n    else {\n      options.pathname = options.path.substring(0, searchPos);\n      options.search = options.path.substring(searchPos);\n    }\n  }\n};\n\n\n// Executes the next native request (initial or redirect)\nRedirectableRequest.prototype._performRequest = function () {\n  // Load the native protocol\n  var protocol = this._options.protocol;\n  var nativeProtocol = this._options.nativeProtocols[protocol];\n  if (!nativeProtocol) {\n    throw new TypeError(\"Unsupported protocol \" + protocol);\n  }\n\n  // If specified, use the agent corresponding to the protocol\n  // (HTTP and HTTPS use different types of agents)\n  if (this._options.agents) {\n    var scheme = protocol.slice(0, -1);\n    this._options.agent = this._options.agents[scheme];\n  }\n\n  // Create the native request and set up its event handlers\n  var request = this._currentRequest =\n        nativeProtocol.request(this._options, this._onNativeResponse);\n  request._redirectable = this;\n  for (var event of events) {\n    request.on(event, eventHandlers[event]);\n  }\n\n  // RFC72305.3.1: When making a request directly to an origin server, []\n  // a client MUST send only the absolute path [] as the request-target.\n  this._currentUrl = /^\\//.test(this._options.path) ?\n    url.format(this._options) :\n    // When making a request to a proxy, []\n    // a client MUST send the target URI in absolute-form [].\n    this._options.path;\n\n  // End a redirected request\n  // (The first request must be ended explicitly with RedirectableRequest#end)\n  if (this._isRedirect) {\n    // Write the request entity and end\n    var i = 0;\n    var self = this;\n    var buffers = this._requestBodyBuffers;\n    (function writeNext(error) {\n      // Only write if this request has not been redirected yet\n      // istanbul ignore else\n      if (request === self._currentRequest) {\n        // Report any write errors\n        // istanbul ignore if\n        if (error) {\n          self.emit(\"error\", error);\n        }\n        // Write the next buffer if there are still left\n        else if (i < buffers.length) {\n          var buffer = buffers[i++];\n          // istanbul ignore else\n          if (!request.finished) {\n            request.write(buffer.data, buffer.encoding, writeNext);\n          }\n        }\n        // End the request if `end` has been called on us\n        else if (self._ended) {\n          request.end();\n        }\n      }\n    }());\n  }\n};\n\n// Processes a response from the current native request\nRedirectableRequest.prototype._processResponse = function (response) {\n  // Store the redirected response\n  var statusCode = response.statusCode;\n  if (this._options.trackRedirects) {\n    this._redirects.push({\n      url: this._currentUrl,\n      headers: response.headers,\n      statusCode: statusCode,\n    });\n  }\n\n  // RFC72316.4: The 3xx (Redirection) class of status code indicates\n  // that further action needs to be taken by the user agent in order to\n  // fulfill the request. If a Location header field is provided,\n  // the user agent MAY automatically redirect its request to the URI\n  // referenced by the Location field value,\n  // even if the specific status code is not understood.\n\n  // If the response is not a redirect; return it as-is\n  var location = response.headers.location;\n  if (!location || this._options.followRedirects === false ||\n      statusCode < 300 || statusCode >= 400) {\n    response.responseUrl = this._currentUrl;\n    response.redirects = this._redirects;\n    this.emit(\"response\", response);\n\n    // Clean up\n    this._requestBodyBuffers = [];\n    return;\n  }\n\n  // The response is a redirect, so abort the current request\n  destroyRequest(this._currentRequest);\n  // Discard the remainder of the response to avoid waiting for data\n  response.destroy();\n\n  // RFC72316.4: A client SHOULD detect and intervene\n  // in cyclical redirections (i.e., \"infinite\" redirection loops).\n  if (++this._redirectCount > this._options.maxRedirects) {\n    throw new TooManyRedirectsError();\n  }\n\n  // Store the request headers if applicable\n  var requestHeaders;\n  var beforeRedirect = this._options.beforeRedirect;\n  if (beforeRedirect) {\n    requestHeaders = Object.assign({\n      // The Host header was set by nativeProtocol.request\n      Host: response.req.getHeader(\"host\"),\n    }, this._options.headers);\n  }\n\n  // RFC72316.4: Automatic redirection needs to done with\n  // care for methods not known to be safe, []\n  // RFC72316.4.23: For historical reasons, a user agent MAY change\n  // the request method from POST to GET for the subsequent request.\n  var method = this._options.method;\n  if ((statusCode === 301 || statusCode === 302) && this._options.method === \"POST\" ||\n      // RFC72316.4.4: The 303 (See Other) status code indicates that\n      // the server is redirecting the user agent to a different resource []\n      // A user agent can perform a retrieval request targeting that URI\n      // (a GET or HEAD request if using HTTP) []\n      (statusCode === 303) && !/^(?:GET|HEAD)$/.test(this._options.method)) {\n    this._options.method = \"GET\";\n    // Drop a possible entity and headers related to it\n    this._requestBodyBuffers = [];\n    removeMatchingHeaders(/^content-/i, this._options.headers);\n  }\n\n  // Drop the Host header, as the redirect might lead to a different host\n  var currentHostHeader = removeMatchingHeaders(/^host$/i, this._options.headers);\n\n  // If the redirect is relative, carry over the host of the last request\n  var currentUrlParts = parseUrl(this._currentUrl);\n  var currentHost = currentHostHeader || currentUrlParts.host;\n  var currentUrl = /^\\w+:/.test(location) ? this._currentUrl :\n    url.format(Object.assign(currentUrlParts, { host: currentHost }));\n\n  // Create the redirected request\n  var redirectUrl = resolveUrl(location, currentUrl);\n  debug(\"redirecting to\", redirectUrl.href);\n  this._isRedirect = true;\n  spreadUrlObject(redirectUrl, this._options);\n\n  // Drop confidential headers when redirecting to a less secure protocol\n  // or to a different domain that is not a superdomain\n  if (redirectUrl.protocol !== currentUrlParts.protocol &&\n     redirectUrl.protocol !== \"https:\" ||\n     redirectUrl.host !== currentHost &&\n     !isSubdomain(redirectUrl.host, currentHost)) {\n    removeMatchingHeaders(/^(?:(?:proxy-)?authorization|cookie)$/i, this._options.headers);\n  }\n\n  // Evaluate the beforeRedirect callback\n  if (isFunction(beforeRedirect)) {\n    var responseDetails = {\n      headers: response.headers,\n      statusCode: statusCode,\n    };\n    var requestDetails = {\n      url: currentUrl,\n      method: method,\n      headers: requestHeaders,\n    };\n    beforeRedirect(this._options, responseDetails, requestDetails);\n    this._sanitizeOptions(this._options);\n  }\n\n  // Perform the redirected request\n  this._performRequest();\n};\n\n// Wraps the key/value object of protocols with redirect functionality\nfunction wrap(protocols) {\n  // Default settings\n  var exports = {\n    maxRedirects: 21,\n    maxBodyLength: 10 * 1024 * 1024,\n  };\n\n  // Wrap each protocol\n  var nativeProtocols = {};\n  Object.keys(protocols).forEach(function (scheme) {\n    var protocol = scheme + \":\";\n    var nativeProtocol = nativeProtocols[protocol] = protocols[scheme];\n    var wrappedProtocol = exports[scheme] = Object.create(nativeProtocol);\n\n    // Executes a request, following redirects\n    function request(input, options, callback) {\n      // Parse parameters, ensuring that input is an object\n      if (isURL(input)) {\n        input = spreadUrlObject(input);\n      }\n      else if (isString(input)) {\n        input = spreadUrlObject(parseUrl(input));\n      }\n      else {\n        callback = options;\n        options = validateUrl(input);\n        input = { protocol: protocol };\n      }\n      if (isFunction(options)) {\n        callback = options;\n        options = null;\n      }\n\n      // Set defaults\n      options = Object.assign({\n        maxRedirects: exports.maxRedirects,\n        maxBodyLength: exports.maxBodyLength,\n      }, input, options);\n      options.nativeProtocols = nativeProtocols;\n      if (!isString(options.host) && !isString(options.hostname)) {\n        options.hostname = \"::1\";\n      }\n\n      assert.equal(options.protocol, protocol, \"protocol mismatch\");\n      debug(\"options\", options);\n      return new RedirectableRequest(options, callback);\n    }\n\n    // Executes a GET request, following redirects\n    function get(input, options, callback) {\n      var wrappedRequest = wrappedProtocol.request(input, options, callback);\n      wrappedRequest.end();\n      return wrappedRequest;\n    }\n\n    // Expose the properties on the wrapped protocol\n    Object.defineProperties(wrappedProtocol, {\n      request: { value: request, configurable: true, enumerable: true, writable: true },\n      get: { value: get, configurable: true, enumerable: true, writable: true },\n    });\n  });\n  return exports;\n}\n\nfunction noop() { /* empty */ }\n\nfunction parseUrl(input) {\n  var parsed;\n  // istanbul ignore else\n  if (useNativeURL) {\n    parsed = new URL(input);\n  }\n  else {\n    // Ensure the URL is valid and absolute\n    parsed = validateUrl(url.parse(input));\n    if (!isString(parsed.protocol)) {\n      throw new InvalidUrlError({ input });\n    }\n  }\n  return parsed;\n}\n\nfunction resolveUrl(relative, base) {\n  // istanbul ignore next\n  return useNativeURL ? new URL(relative, base) : parseUrl(url.resolve(base, relative));\n}\n\nfunction validateUrl(input) {\n  if (/^\\[/.test(input.hostname) && !/^\\[[:0-9a-f]+\\]$/i.test(input.hostname)) {\n    throw new InvalidUrlError({ input: input.href || input });\n  }\n  if (/^\\[/.test(input.host) && !/^\\[[:0-9a-f]+\\](:\\d+)?$/i.test(input.host)) {\n    throw new InvalidUrlError({ input: input.href || input });\n  }\n  return input;\n}\n\nfunction spreadUrlObject(urlObject, target) {\n  var spread = target || {};\n  for (var key of preservedUrlFields) {\n    spread[key] = urlObject[key];\n  }\n\n  // Fix IPv6 hostname\n  if (spread.hostname.startsWith(\"[\")) {\n    spread.hostname = spread.hostname.slice(1, -1);\n  }\n  // Ensure port is a number\n  if (spread.port !== \"\") {\n    spread.port = Number(spread.port);\n  }\n  // Concatenate path\n  spread.path = spread.search ? spread.pathname + spread.search : spread.pathname;\n\n  return spread;\n}\n\nfunction removeMatchingHeaders(regex, headers) {\n  var lastValue;\n  for (var header in headers) {\n    if (regex.test(header)) {\n      lastValue = headers[header];\n      delete headers[header];\n    }\n  }\n  return (lastValue === null || typeof lastValue === \"undefined\") ?\n    undefined : String(lastValue).trim();\n}\n\nfunction createErrorType(code, message, baseClass) {\n  // Create constructor\n  function CustomError(properties) {\n    // istanbul ignore else\n    if (isFunction(Error.captureStackTrace)) {\n      Error.captureStackTrace(this, this.constructor);\n    }\n    Object.assign(this, properties || {});\n    this.code = code;\n    this.message = this.cause ? message + \": \" + this.cause.message : message;\n  }\n\n  // Attach constructor and set default properties\n  CustomError.prototype = new (baseClass || Error)();\n  Object.defineProperties(CustomError.prototype, {\n    constructor: {\n      value: CustomError,\n      enumerable: false,\n    },\n    name: {\n      value: \"Error [\" + code + \"]\",\n      enumerable: false,\n    },\n  });\n  return CustomError;\n}\n\nfunction destroyRequest(request, error) {\n  for (var event of events) {\n    request.removeListener(event, eventHandlers[event]);\n  }\n  request.on(\"error\", noop);\n  request.destroy(error);\n}\n\nfunction isSubdomain(subdomain, domain) {\n  assert(isString(subdomain) && isString(domain));\n  var dot = subdomain.length - domain.length - 1;\n  return dot > 0 && subdomain[dot] === \".\" && subdomain.endsWith(domain);\n}\n\nfunction isString(value) {\n  return typeof value === \"string\" || value instanceof String;\n}\n\nfunction isFunction(value) {\n  return typeof value === \"function\";\n}\n\nfunction isBuffer(value) {\n  return typeof value === \"object\" && (\"length\" in value);\n}\n\nfunction isURL(value) {\n  return URL && value instanceof URL;\n}\n\n// Exports\nmodule.exports = wrap({ http: http, https: https });\nmodule.exports.wrap = wrap;\n","import type { ClipPath, Point } from '@scrypted/sdk';\n\n// x y w h\nexport type BoundingBox = [number, number, number, number];\n/**\n * Checks if a line segment intersects with another line segment\n */\nfunction lineIntersects(\n    [x1, y1]: Point,\n    [x2, y2]: Point,\n    [x3, y3]: Point,\n    [x4, y4]: Point\n): boolean {\n    // Calculate the denominators for intersection check\n    const denom = (y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1);\n    if (denom === 0) return false; // Lines are parallel\n\n    const ua = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) / denom;\n    const ub = ((x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3)) / denom;\n\n    // Check if intersection point lies within both line segments\n    return ua >= 0 && ua <= 1 && ub >= 0 && ub <= 1;\n}\n\n/**\n * Checks if a point is inside a polygon using ray casting algorithm\n */\nfunction pointInPolygon([x, y]: Point, polygon: ClipPath): boolean {\n    let inside = false;\n    for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\n        const [xi, yi] = polygon[i];\n        const [xj, yj] = polygon[j];\n\n        const intersect = ((yi > y) !== (yj > y)) &&\n            (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n\n        if (intersect) inside = !inside;\n    }\n    return inside;\n}\n\n/**\n * Converts a bounding box to an array of its corner points\n */\nfunction boundingBoxToPoints([x, y, w, h]: BoundingBox): Point[] {\n    return [\n        [x, y],         // top-left\n        [x + w, y],     // top-right\n        [x + w, y + h], // bottom-right\n        [x, y + h]      // bottom-left\n    ];\n}\n\n/**\n * Checks if a polygon intersects with a bounding box\n */\nexport function polygonIntersectsBoundingBox(polygon: ClipPath, boundingBox: BoundingBox): boolean {\n    // Get bounding box corners\n    const boxPoints = boundingBoxToPoints(boundingBox);\n\n    // Check if any polygon edge intersects with any bounding box edge\n    for (let i = 0; i < polygon.length; i++) {\n        const nextI = (i + 1) % polygon.length;\n        const polygonPoint1 = polygon[i];\n        const polygonPoint2 = polygon[nextI];\n\n        // Check against all bounding box edges\n        for (let j = 0; j < boxPoints.length; j++) {\n            const nextJ = (j + 1) % boxPoints.length;\n            const boxPoint1 = boxPoints[j];\n            const boxPoint2 = boxPoints[nextJ];\n\n            if (lineIntersects(polygonPoint1, polygonPoint2, boxPoint1, boxPoint2)) {\n                return true;\n            }\n        }\n    }\n\n    // If no edges intersect, check if either shape contains a point from the other\n    if (pointInPolygon(polygon[0], boxPoints) || pointInPolygon(boxPoints[0], polygon))\n        return true;\n    return false;\n}\n\n/**\n * Checks if a polygon completely contains a bounding box\n */\nexport function polygonContainsBoundingBox(polygon: ClipPath, boundingBox: BoundingBox): boolean {\n    // Check if all corners of the bounding box are inside the polygon\n    const boxPoints = boundingBoxToPoints(boundingBox);\n    return boxPoints.every(point => pointInPolygon(point, polygon));\n}\n\n\nexport function normalizeBox(box: BoundingBox, dims: Point): BoundingBox {\n    return [box[0] / dims[0], box[1] / dims[1], box[2] / dims[0], box[3] / dims[1]];\n}\n\nexport function fixLegacyClipPath(clipPath: ClipPath): ClipPath {\n    if (!clipPath)\n        return;\n\n    // if any value is over abs 2, then divide by 100.\n    // this is a workaround for the old scrypted bug where the path was not normalized.\n    // this is a temporary workaround until the path is normalized in the UI.\n    let needNormalize = false;\n    for (const p of clipPath) {\n        for (const c of p) {\n            if (Math.abs(c) >= 2)\n                needNormalize = true;\n        }\n    }\n\n    if (!needNormalize)\n        return clipPath;\n\n    return clipPath.map(p => p.map(c => c / 100)) as ClipPath;\n}\n","module.exports = require(\"console\");","module.exports = require(\"events\");","export async function sleep(ms: number) {\n    await new Promise(resolve => setTimeout(resolve, ms));\n}\n","\"use strict\";\nconst MIMETypeParameters = require(\"./mime-type-parameters.js\");\nconst parse = require(\"./parser.js\");\nconst serialize = require(\"./serializer.js\");\nconst {\n  asciiLowercase,\n  solelyContainsHTTPTokenCodePoints\n} = require(\"./utils.js\");\n\nmodule.exports = class MIMEType {\n  constructor(string) {\n    string = String(string);\n    const result = parse(string);\n    if (result === null) {\n      throw new Error(`Could not parse MIME type string \"${string}\"`);\n    }\n\n    this._type = result.type;\n    this._subtype = result.subtype;\n    this._parameters = new MIMETypeParameters(result.parameters);\n  }\n\n  static parse(string) {\n    try {\n      return new this(string);\n    } catch (e) {\n      return null;\n    }\n  }\n\n  get essence() {\n    return `${this.type}/${this.subtype}`;\n  }\n\n  get type() {\n    return this._type;\n  }\n\n  set type(value) {\n    value = asciiLowercase(String(value));\n\n    if (value.length === 0) {\n      throw new Error(\"Invalid type: must be a non-empty string\");\n    }\n    if (!solelyContainsHTTPTokenCodePoints(value)) {\n      throw new Error(`Invalid type ${value}: must contain only HTTP token code points`);\n    }\n\n    this._type = value;\n  }\n\n  get subtype() {\n    return this._subtype;\n  }\n\n  set subtype(value) {\n    value = asciiLowercase(String(value));\n\n    if (value.length === 0) {\n      throw new Error(\"Invalid subtype: must be a non-empty string\");\n    }\n    if (!solelyContainsHTTPTokenCodePoints(value)) {\n      throw new Error(`Invalid subtype ${value}: must contain only HTTP token code points`);\n    }\n\n    this._subtype = value;\n  }\n\n  get parameters() {\n    return this._parameters;\n  }\n\n  toString() {\n    // The serialize function works on both \"MIME type records\" (i.e. the results of parse) and on this class, since\n    // this class's interface is identical.\n    return serialize(this);\n  }\n\n  isJavaScript({ prohibitParameters = false } = {}) {\n    switch (this._type) {\n      case \"text\": {\n        switch (this._subtype) {\n          case \"ecmascript\":\n          case \"javascript\":\n          case \"javascript1.0\":\n          case \"javascript1.1\":\n          case \"javascript1.2\":\n          case \"javascript1.3\":\n          case \"javascript1.4\":\n          case \"javascript1.5\":\n          case \"jscript\":\n          case \"livescript\":\n          case \"x-ecmascript\":\n          case \"x-javascript\": {\n            return !prohibitParameters || this._parameters.size === 0;\n          }\n          default: {\n            return false;\n          }\n        }\n      }\n      case \"application\": {\n        switch (this._subtype) {\n          case \"ecmascript\":\n          case \"javascript\":\n          case \"x-ecmascript\":\n          case \"x-javascript\": {\n            return !prohibitParameters || this._parameters.size === 0;\n          }\n          default: {\n            return false;\n          }\n        }\n      }\n      default: {\n        return false;\n      }\n    }\n  }\n  isXML() {\n    return (this._subtype === \"xml\" && (this._type === \"text\" || this._type === \"application\")) ||\n           this._subtype.endsWith(\"+xml\");\n  }\n  isHTML() {\n    return this._subtype === \"html\" && this._type === \"text\";\n  }\n};\n","module.exports = require(\"child_process\");","/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar w = d * 7;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isFinite(val)) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'weeks':\n    case 'week':\n    case 'w':\n      return n * w;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (msAbs >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (msAbs >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (msAbs >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return plural(ms, msAbs, d, 'day');\n  }\n  if (msAbs >= h) {\n    return plural(ms, msAbs, h, 'hour');\n  }\n  if (msAbs >= m) {\n    return plural(ms, msAbs, m, 'minute');\n  }\n  if (msAbs >= s) {\n    return plural(ms, msAbs, s, 'second');\n  }\n  return ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, msAbs, n, name) {\n  var isPlural = msAbs >= n * 1.5;\n  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '');\n}\n","module.exports = require(\"https\");","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n */\n\nfunction setup(env) {\n\tcreateDebug.debug = createDebug;\n\tcreateDebug.default = createDebug;\n\tcreateDebug.coerce = coerce;\n\tcreateDebug.disable = disable;\n\tcreateDebug.enable = enable;\n\tcreateDebug.enabled = enabled;\n\tcreateDebug.humanize = require('ms');\n\tcreateDebug.destroy = destroy;\n\n\tObject.keys(env).forEach(key => {\n\t\tcreateDebug[key] = env[key];\n\t});\n\n\t/**\n\t* The currently active debug mode names, and names to skip.\n\t*/\n\n\tcreateDebug.names = [];\n\tcreateDebug.skips = [];\n\n\t/**\n\t* Map of special \"%n\" handling functions, for the debug \"format\" argument.\n\t*\n\t* Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n\t*/\n\tcreateDebug.formatters = {};\n\n\t/**\n\t* Selects a color for a debug namespace\n\t* @param {String} namespace The namespace string for the debug instance to be colored\n\t* @return {Number|String} An ANSI color code for the given namespace\n\t* @api private\n\t*/\n\tfunction selectColor(namespace) {\n\t\tlet hash = 0;\n\n\t\tfor (let i = 0; i < namespace.length; i++) {\n\t\t\thash = ((hash << 5) - hash) + namespace.charCodeAt(i);\n\t\t\thash |= 0; // Convert to 32bit integer\n\t\t}\n\n\t\treturn createDebug.colors[Math.abs(hash) % createDebug.colors.length];\n\t}\n\tcreateDebug.selectColor = selectColor;\n\n\t/**\n\t* Create a debugger with the given `namespace`.\n\t*\n\t* @param {String} namespace\n\t* @return {Function}\n\t* @api public\n\t*/\n\tfunction createDebug(namespace) {\n\t\tlet prevTime;\n\t\tlet enableOverride = null;\n\t\tlet namespacesCache;\n\t\tlet enabledCache;\n\n\t\tfunction debug(...args) {\n\t\t\t// Disabled?\n\t\t\tif (!debug.enabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst self = debug;\n\n\t\t\t// Set `diff` timestamp\n\t\t\tconst curr = Number(new Date());\n\t\t\tconst ms = curr - (prevTime || curr);\n\t\t\tself.diff = ms;\n\t\t\tself.prev = prevTime;\n\t\t\tself.curr = curr;\n\t\t\tprevTime = curr;\n\n\t\t\targs[0] = createDebug.coerce(args[0]);\n\n\t\t\tif (typeof args[0] !== 'string') {\n\t\t\t\t// Anything else let's inspect with %O\n\t\t\t\targs.unshift('%O');\n\t\t\t}\n\n\t\t\t// Apply any `formatters` transformations\n\t\t\tlet index = 0;\n\t\t\targs[0] = args[0].replace(/%([a-zA-Z%])/g, (match, format) => {\n\t\t\t\t// If we encounter an escaped % then don't increase the array index\n\t\t\t\tif (match === '%%') {\n\t\t\t\t\treturn '%';\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tconst formatter = createDebug.formatters[format];\n\t\t\t\tif (typeof formatter === 'function') {\n\t\t\t\t\tconst val = args[index];\n\t\t\t\t\tmatch = formatter.call(self, val);\n\n\t\t\t\t\t// Now we need to remove `args[index]` since it's inlined in the `format`\n\t\t\t\t\targs.splice(index, 1);\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\t\t\t\treturn match;\n\t\t\t});\n\n\t\t\t// Apply env-specific formatting (colors, etc.)\n\t\t\tcreateDebug.formatArgs.call(self, args);\n\n\t\t\tconst logFn = self.log || createDebug.log;\n\t\t\tlogFn.apply(self, args);\n\t\t}\n\n\t\tdebug.namespace = namespace;\n\t\tdebug.useColors = createDebug.useColors();\n\t\tdebug.color = createDebug.selectColor(namespace);\n\t\tdebug.extend = extend;\n\t\tdebug.destroy = createDebug.destroy; // XXX Temporary. Will be removed in the next major release.\n\n\t\tObject.defineProperty(debug, 'enabled', {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: false,\n\t\t\tget: () => {\n\t\t\t\tif (enableOverride !== null) {\n\t\t\t\t\treturn enableOverride;\n\t\t\t\t}\n\t\t\t\tif (namespacesCache !== createDebug.namespaces) {\n\t\t\t\t\tnamespacesCache = createDebug.namespaces;\n\t\t\t\t\tenabledCache = createDebug.enabled(namespace);\n\t\t\t\t}\n\n\t\t\t\treturn enabledCache;\n\t\t\t},\n\t\t\tset: v => {\n\t\t\t\tenableOverride = v;\n\t\t\t}\n\t\t});\n\n\t\t// Env-specific initialization logic for debug instances\n\t\tif (typeof createDebug.init === 'function') {\n\t\t\tcreateDebug.init(debug);\n\t\t}\n\n\t\treturn debug;\n\t}\n\n\tfunction extend(namespace, delimiter) {\n\t\tconst newDebug = createDebug(this.namespace + (typeof delimiter === 'undefined' ? ':' : delimiter) + namespace);\n\t\tnewDebug.log = this.log;\n\t\treturn newDebug;\n\t}\n\n\t/**\n\t* Enables a debug mode by namespaces. This can include modes\n\t* separated by a colon and wildcards.\n\t*\n\t* @param {String} namespaces\n\t* @api public\n\t*/\n\tfunction enable(namespaces) {\n\t\tcreateDebug.save(namespaces);\n\t\tcreateDebug.namespaces = namespaces;\n\n\t\tcreateDebug.names = [];\n\t\tcreateDebug.skips = [];\n\n\t\tlet i;\n\t\tconst split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n\t\tconst len = split.length;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (!split[i]) {\n\t\t\t\t// ignore empty strings\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tnamespaces = split[i].replace(/\\*/g, '.*?');\n\n\t\t\tif (namespaces[0] === '-') {\n\t\t\t\tcreateDebug.skips.push(new RegExp('^' + namespaces.slice(1) + '$'));\n\t\t\t} else {\n\t\t\t\tcreateDebug.names.push(new RegExp('^' + namespaces + '$'));\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t* Disable debug output.\n\t*\n\t* @return {String} namespaces\n\t* @api public\n\t*/\n\tfunction disable() {\n\t\tconst namespaces = [\n\t\t\t...createDebug.names.map(toNamespace),\n\t\t\t...createDebug.skips.map(toNamespace).map(namespace => '-' + namespace)\n\t\t].join(',');\n\t\tcreateDebug.enable('');\n\t\treturn namespaces;\n\t}\n\n\t/**\n\t* Returns true if the given mode name is enabled, false otherwise.\n\t*\n\t* @param {String} name\n\t* @return {Boolean}\n\t* @api public\n\t*/\n\tfunction enabled(name) {\n\t\tif (name[name.length - 1] === '*') {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet i;\n\t\tlet len;\n\n\t\tfor (i = 0, len = createDebug.skips.length; i < len; i++) {\n\t\t\tif (createDebug.skips[i].test(name)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0, len = createDebug.names.length; i < len; i++) {\n\t\t\tif (createDebug.names[i].test(name)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t* Convert regexp to namespace\n\t*\n\t* @param {RegExp} regxep\n\t* @return {String} namespace\n\t* @api private\n\t*/\n\tfunction toNamespace(regexp) {\n\t\treturn regexp.toString()\n\t\t\t.substring(2, regexp.toString().length - 2)\n\t\t\t.replace(/\\.\\*\\?$/, '*');\n\t}\n\n\t/**\n\t* Coerce `val`.\n\t*\n\t* @param {Mixed} val\n\t* @return {Mixed}\n\t* @api private\n\t*/\n\tfunction coerce(val) {\n\t\tif (val instanceof Error) {\n\t\t\treturn val.stack || val.message;\n\t\t}\n\t\treturn val;\n\t}\n\n\t/**\n\t* XXX DO NOT USE. This is a temporary stub function.\n\t* XXX It WILL be removed in the next major release.\n\t*/\n\tfunction destroy() {\n\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t}\n\n\tcreateDebug.enable(createDebug.load());\n\n\treturn createDebug;\n}\n\nmodule.exports = setup;\n","\"use strict\";\nconst {\n  removeLeadingAndTrailingHTTPWhitespace,\n  removeTrailingHTTPWhitespace,\n  isHTTPWhitespaceChar,\n  solelyContainsHTTPTokenCodePoints,\n  soleyContainsHTTPQuotedStringTokenCodePoints,\n  asciiLowercase,\n  collectAnHTTPQuotedString\n} = require(\"./utils.js\");\n\nmodule.exports = input => {\n  input = removeLeadingAndTrailingHTTPWhitespace(input);\n\n  let position = 0;\n  let type = \"\";\n  while (position < input.length && input[position] !== \"/\") {\n    type += input[position];\n    ++position;\n  }\n\n  if (type.length === 0 || !solelyContainsHTTPTokenCodePoints(type)) {\n    return null;\n  }\n\n  if (position >= input.length) {\n    return null;\n  }\n\n  // Skips past \"/\"\n  ++position;\n\n  let subtype = \"\";\n  while (position < input.length && input[position] !== \";\") {\n    subtype += input[position];\n    ++position;\n  }\n\n  subtype = removeTrailingHTTPWhitespace(subtype);\n\n  if (subtype.length === 0 || !solelyContainsHTTPTokenCodePoints(subtype)) {\n    return null;\n  }\n\n  const mimeType = {\n    type: asciiLowercase(type),\n    subtype: asciiLowercase(subtype),\n    parameters: new Map()\n  };\n\n  while (position < input.length) {\n    // Skip past \";\"\n    ++position;\n\n    while (isHTTPWhitespaceChar(input[position])) {\n      ++position;\n    }\n\n    let parameterName = \"\";\n    while (position < input.length && input[position] !== \";\" && input[position] !== \"=\") {\n      parameterName += input[position];\n      ++position;\n    }\n    parameterName = asciiLowercase(parameterName);\n\n    if (position < input.length) {\n      if (input[position] === \";\") {\n        continue;\n      }\n\n      // Skip past \"=\"\n      ++position;\n    }\n\n    let parameterValue = null;\n    if (input[position] === \"\\\"\") {\n      [parameterValue, position] = collectAnHTTPQuotedString(input, position);\n\n      while (position < input.length && input[position] !== \";\") {\n        ++position;\n      }\n    } else {\n      parameterValue = \"\";\n      while (position < input.length && input[position] !== \";\") {\n        parameterValue += input[position];\n        ++position;\n      }\n\n      parameterValue = removeTrailingHTTPWhitespace(parameterValue);\n\n      if (parameterValue === \"\") {\n        continue;\n      }\n    }\n\n    if (parameterName.length > 0 &&\n        solelyContainsHTTPTokenCodePoints(parameterName) &&\n        soleyContainsHTTPQuotedStringTokenCodePoints(parameterValue) &&\n        !mimeType.parameters.has(parameterName)) {\n      mimeType.parameters.set(parameterName, parameterValue);\n    }\n  }\n\n  return mimeType;\n};\n","import { BufferConverter, Image, MediaObjectOptions, ScryptedDeviceBase, ScryptedMimeTypes, ScryptedNativeId } from \"@scrypted/sdk\";\n\nexport const ImageWriterNativeId = 'imagewriter';\nexport class ImageWriter extends ScryptedDeviceBase implements BufferConverter {\n    constructor(nativeId: ScryptedNativeId) {\n        super(nativeId)\n\n        this.fromMimeType = ScryptedMimeTypes.Image;\n        this.toMimeType = 'image/*';\n    }\n\n    async convert(data: any, fromMimeType: string, toMimeType: string, options?: MediaObjectOptions): Promise<any> {\n        const image = data as Image;\n        return image.toBuffer({\n            format: 'jpg',\n        });\n    }\n}\n","import sdk, { BufferConverter, Image, ImageOptions, MediaObject, MediaObjectOptions, ScryptedDeviceBase, ScryptedMimeTypes } from \"@scrypted/sdk\";\nimport type sharp from 'sharp';\nimport type { KernelEnum } from \"sharp\";\n\nlet hasLoadedSharp = false;\nlet sharpInstance: typeof sharp;\nexport function loadSharp() {\n    if (!hasLoadedSharp) {\n        hasLoadedSharp = true;\n        try {\n            sharpInstance = require('sharp');\n            console.log('sharp loaded');\n        }\n        catch (e) {\n            console.warn('sharp failed to load, scrypted server may be out of date', e);\n        }\n    }\n    return !!sharpInstance;\n}\n\nexport const ImageReaderNativeId = 'imagereader';\n\nexport async function createVipsMediaObject(image: VipsImage): Promise<Image & MediaObject> {\n    const ret: Image & MediaObject = await sdk.mediaManager.createMediaObject(image, ScryptedMimeTypes.Image, {\n        sourceId: image.sourceId,\n        width: image.width,\n        height: image.height,\n        format: null,\n        toBuffer: (options: ImageOptions) => image.toBuffer(options),\n        toImage: async (options: ImageOptions) => {\n            const newImage = await image.toVipsImage(options);\n            return createVipsMediaObject(newImage);\n        },\n        close: () => image.close(),\n    });\n\n    return ret;\n}\n\nexport class VipsImage implements Image {\n    constructor(public image: sharp.Sharp, public metadata: sharp.Metadata, public sourceId: string) {\n    }\n\n    get width() {\n        return this.metadata.width;\n    }\n    get height() {\n        return this.metadata.height;\n    }\n\n    toImageInternal(options: ImageOptions) {\n        const transformed = this.image.clone();\n        if (options?.crop) {\n            transformed.extract({\n                left: Math.floor(options.crop.left),\n                top: Math.floor(options.crop.top),\n                width: Math.floor(options.crop.width),\n                height: Math.floor(options.crop.height),\n            });\n        }\n        if (options?.resize) {\n            let kernel: keyof KernelEnum;\n            switch (options?.resize.filter) {\n                case 'lanczos':\n                    kernel = 'lanczos2';\n                    break;\n                case 'mitchell':\n                    kernel = 'mitchell';\n                    break;\n                case 'nearest':\n                    kernel = 'nearest';\n                    break;\n                default:\n                    kernel = 'cubic';\n                    break\n            }\n            transformed.resize(typeof options.resize.width === 'number' ? Math.floor(options.resize.width) : undefined, typeof options.resize.height === 'number' ? Math.floor(options.resize.height) : undefined, {\n                // haven't decided if these are the correct defaults.\n                fit: options.resize.width && options.resize.height ? 'fill' : 'cover',\n                kernel: kernel,\n            });\n        }\n\n        return transformed;\n    }\n\n    async toBuffer(options: ImageOptions) {\n        const transformed = this.toImageInternal(options);\n        if (options?.format === 'rgb') {\n            transformed.removeAlpha().toFormat('raw');\n        }\n        else if (options?.format === 'rgba') {\n            transformed.ensureAlpha().toFormat('raw');\n        }\n        else if (options?.format === 'gray') {\n            transformed.toFormat('raw').grayscale();\n        }\n        else if (options?.format === 'jpg') {\n            transformed.toFormat('jpg');\n        }\n        return transformed.toBuffer();\n    }\n\n    async toVipsImage(options: ImageOptions) {\n        const transformed = this.toImageInternal(options);\n        const { info, data } = await transformed.raw().toBuffer({\n            resolveWithObject: true,\n        });\n\n        const newImage = sharpInstance(data, {\n            raw: info,\n        });\n\n        const newMetadata = await newImage.metadata();\n        const newVipsImage = new VipsImage(newImage, newMetadata, this.sourceId);\n        return newVipsImage;\n    }\n\n    async toImage(options: ImageOptions) {\n        if (options?.format)\n            throw new Error('format can only be used with toBuffer');\n        const newVipsImage = await this.toVipsImage(options);\n        return createVipsMediaObject(newVipsImage);\n    }\n\n    async close() {\n        this.image?.destroy();\n        this.image = undefined;\n    }\n}\n\nexport async function loadVipsMetadata(data: Buffer | string) {\n    const image = sharpInstance(data, {\n        failOn: 'none'\n    });\n    const metadata = await image.metadata();\n    return {\n        image,\n        metadata,\n    }\n}\n\nexport async function loadVipsImage(data: Buffer | string, sourceId: string) {\n    loadSharp();\n\n    const { image, metadata } = await loadVipsMetadata(data);\n    const vipsImage = new VipsImage(image, metadata, sourceId);\n    return vipsImage;\n}\n\nexport class ImageReader extends ScryptedDeviceBase implements BufferConverter {\n    constructor(nativeId: string) {\n        super(nativeId);\n\n        this.fromMimeType = 'image/*';\n        this.toMimeType = ScryptedMimeTypes.Image;\n    }\n\n    async convert(data: Buffer, fromMimeType: string, toMimeType: string, options?: MediaObjectOptions): Promise<Image> {\n        const vipsImage = await loadVipsImage(data, options?.sourceId);\n        return createVipsMediaObject(vipsImage);\n    }\n}\n","module.exports = require(\"path\");","// https://github.com/kevinGodell/pipe2jpeg/blob/master/index.js\n\nimport { Transform, TransformCallback } from 'stream';\n\nconst _SOI = Buffer.from([0xff, 0xd8]); // jpeg start of image ff08\nconst _EOI = Buffer.from([0xff, 0xd9]); // jpeg end of image ff09\n\nexport class Pipe2Jpeg extends Transform {\n  _chunks: Buffer[] = [];\n  _size: number = 0;\n  _jpeg: Buffer;\n\n  get jpeg() {\n    return this._jpeg;\n  }\n\n  _sendJpeg() {\n    this.emit('jpeg', this._jpeg);\n  }\n\n  _transform(chunk: Buffer, encoding: BufferEncoding, callback: TransformCallback) {\n    const chunkLength = chunk.length;\n    let pos = 0;\n    while (true) {\n      if (this._size) {\n        const eoi = chunk.indexOf(_EOI);\n        if (eoi === -1) {\n          this._chunks.push(chunk);\n          this._size += chunkLength;\n          break;\n        } else {\n          pos = eoi + 2;\n          const sliced = chunk.slice(0, pos);\n          this._chunks.push(sliced);\n          this._size += sliced.length;\n          this._jpeg = Buffer.concat(this._chunks, this._size);\n          this._chunks = [];\n          this._size = 0;\n          this._sendJpeg();\n          if (pos === chunkLength) {\n            break;\n          }\n        }\n      } else {\n        const soi = chunk.indexOf(_SOI, pos);\n        if (soi === -1) {\n          break;\n        } else {\n          // todo might add option or take sample average / 2 to jump position for small gain\n          pos = soi + 500;\n        }\n        const eoi = chunk.indexOf(_EOI, pos);\n        if (eoi === -1) {\n          const sliced = chunk.slice(soi);\n          this._chunks = [sliced];\n          this._size = sliced.length;\n          break;\n        } else {\n          pos = eoi + 2;\n          this._jpeg = chunk.slice(soi, pos);\n          this._sendJpeg();\n          if (pos === chunkLength) {\n            break;\n          }\n        }\n      }\n    }\n    callback();\n  }\n}\n","module.exports = require(\"url\");","var debug;\n\nmodule.exports = function () {\n  if (!debug) {\n    try {\n      /* eslint global-require: off */\n      debug = require(\"debug\")(\"follow-redirects\");\n    }\n    catch (error) { /* */ }\n    if (typeof debug !== \"function\") {\n      debug = function () { /* */ };\n    }\n  }\n  debug.apply(null, arguments);\n};\n","export { sleep } from \"../../server/src/sleep\";\n","\"use strict\";\nconst {\n  asciiLowercase,\n  solelyContainsHTTPTokenCodePoints,\n  soleyContainsHTTPQuotedStringTokenCodePoints\n} = require(\"./utils.js\");\n\nmodule.exports = class MIMETypeParameters {\n  constructor(map) {\n    this._map = map;\n  }\n\n  get size() {\n    return this._map.size;\n  }\n\n  get(name) {\n    name = asciiLowercase(String(name));\n    return this._map.get(name);\n  }\n\n  has(name) {\n    name = asciiLowercase(String(name));\n    return this._map.has(name);\n  }\n\n  set(name, value) {\n    name = asciiLowercase(String(name));\n    value = String(value);\n\n    if (!solelyContainsHTTPTokenCodePoints(name)) {\n      throw new Error(`Invalid MIME type parameter name \"${name}\": only HTTP token code points are valid.`);\n    }\n    if (!soleyContainsHTTPQuotedStringTokenCodePoints(value)) {\n      throw new Error(`Invalid MIME type parameter value \"${value}\": only HTTP quoted-string token code points are ` +\n                      `valid.`);\n    }\n\n    return this._map.set(name, value);\n  }\n\n  clear() {\n    this._map.clear();\n  }\n\n  delete(name) {\n    name = asciiLowercase(String(name));\n    return this._map.delete(name);\n  }\n\n  forEach(callbackFn, thisArg) {\n    this._map.forEach(callbackFn, thisArg);\n  }\n\n  keys() {\n    return this._map.keys();\n  }\n\n  values() {\n    return this._map.values();\n  }\n\n  entries() {\n    return this._map.entries();\n  }\n\n  [Symbol.iterator]() {\n    return this._map[Symbol.iterator]();\n  }\n};\n","module.exports = require(\"http\");","module.exports = require(\"util\");","import type events from 'events';\nimport type followRedirects from 'follow-redirects';\nimport type { IncomingMessage } from 'http';\nimport type stream from 'stream';\nimport type { Readable } from 'stream';\nimport { HttpFetchBufferOptions, HttpFetchJsonOptions, HttpFetchOptions, HttpFetchReadableOptions, HttpFetchResponse, HttpFetchResponseType, HttpFetchTextOptions, checkStatus, createHeadersArray, createStringOrBufferBody, getFetchMethod, setDefaultHttpFetchAccept } from '.';\nexport type { HttpFetchBufferOptions, HttpFetchJsonOptions, HttpFetchOptions, HttpFetchReadableOptions, HttpFetchResponse, HttpFetchResponseType, HttpFetchTextOptions, checkStatus, setDefaultHttpFetchAccept } from '.';\n\nasync function readMessageBuffer(response: IncomingMessage) {\n    const buffers: Buffer[] = [];\n    response.on('data', buffer => buffers.push(buffer));\n    const { once } = require('events') as typeof events;\n    await once(response, 'end');\n    return Buffer.concat(buffers);\n}\n\nexport interface FetchParser<T> {\n    parse(message: IncomingMessage): Promise<T>;\n}\n\nconst TextParser: FetchParser<string> = {\n    async parse(message: IncomingMessage) {\n        return (await readMessageBuffer(message)).toString();\n    }\n}\nconst JSONParser: FetchParser<any> = {\n    async parse(message: IncomingMessage) {\n        return JSON.parse((await readMessageBuffer(message)).toString());\n    }\n}\n\nconst BufferParser: FetchParser<Buffer> = {\n    async parse(message: IncomingMessage) {\n        return readMessageBuffer(message);\n    }\n}\n\nconst StreamParser: FetchParser<IncomingMessage> = {\n    async parse(message: IncomingMessage) {\n        return message;\n    }\n}\n\nexport function getHttpFetchParser(responseType: HttpFetchResponseType | undefined) {\n    switch (responseType) {\n        case 'json':\n            return JSONParser;\n        case 'text':\n            return TextParser;\n        case 'readable':\n            return StreamParser;\n    }\n    return BufferParser;\n}\n\nexport function httpFetchParseIncomingMessage(readable: IncomingMessage, responseType: HttpFetchResponseType | undefined) {\n    return getHttpFetchParser(responseType).parse(readable);\n}\n\nexport async function httpFetch<T extends HttpFetchOptions<Readable>>(options: T): Promise<HttpFetchResponse<\n    // first one serves as default.\n    T extends HttpFetchBufferOptions<Readable> ? Buffer\n    : T extends HttpFetchTextOptions<Readable> ? string\n    : T extends HttpFetchReadableOptions<Readable> ? IncomingMessage\n    : T extends HttpFetchJsonOptions<Readable> ? any : Buffer\n>> {\n    const headers = createHeadersArray(options.headers);\n    setDefaultHttpFetchAccept(headers, options.responseType);\n\n    const { once } = require('events') as typeof events;\n    const { PassThrough, Readable } = require('stream') as typeof stream;\n    const { http, https } = require('follow-redirects') as typeof followRedirects;\n\n    const { url } = options;\n    const isSecure = url.toString().startsWith('https:');\n    const proto = isSecure ? https : http;\n\n    let { body } = options;\n    if (body && !(body instanceof Readable)) {\n        const newBody = new PassThrough();\n        newBody.write(Buffer.from(createStringOrBufferBody(headers, body)));\n        newBody.end();\n        body = newBody;\n    }\n\n    let controller: AbortController | undefined;\n    let timeout: NodeJS.Timeout;\n    if (options.timeout) {\n        controller = new AbortController();\n        timeout = setTimeout(() => controller!.abort(), options.timeout);\n\n        options.signal?.addEventListener('abort', () => controller!.abort(options.signal?.reason));\n    }\n\n    const signal = controller?.signal || options.signal;\n    signal?.addEventListener('abort', () => request.destroy(new Error(options.signal?.reason || 'abort')));\n\n    const nodeHeaders: Record<string, string[]> = {};\n    for (const [k, v] of headers) {\n        if (nodeHeaders[k]) {\n            nodeHeaders[k].push(v);\n        }\n        else {\n            nodeHeaders[k] = [v];\n        }\n    }\n\n    const request = proto.request(url, {\n        method: getFetchMethod(options),\n        rejectUnauthorized: options.rejectUnauthorized,\n        family: options.family,\n        headers: nodeHeaders,\n        signal,\n        timeout: options.timeout,\n    });\n\n    if (body)\n        body.pipe(request);\n    else\n        request.end();\n\n    try {\n        const [response] = await once(request, 'response') as [IncomingMessage];\n\n\n        if (options?.checkStatusCode === undefined || options?.checkStatusCode) {\n            try {\n                const checker = typeof options?.checkStatusCode === 'function' ? options.checkStatusCode : checkStatus;\n                if (!response.statusCode || !checker(response.statusCode))\n                    throw new Error(`http response statusCode ${response.statusCode}`);\n            }\n            catch (e) {\n                readMessageBuffer(response).catch(() => { });\n                throw e;\n            }\n        }\n\n        const incomingHeaders = new Headers();\n        for (const [k, v] of Object.entries(response.headers)) {\n            for (const vv of (typeof v === 'string' ? [v] : v!)) {\n                incomingHeaders.append(k, vv)\n            }\n        }\n\n        return {\n            statusCode: response.statusCode!,\n            headers: incomingHeaders,\n            body: await httpFetchParseIncomingMessage(response, options.responseType),\n        };\n    }\n    finally {\n        clearTimeout(timeout!);\n    }\n}\n\n","export type HttpFetchResponseType = 'json' | 'text' | 'buffer' | 'readable';\nexport interface HttpFetchOptionsBase<B> {\n    url: string | URL;\n    family?: 4 | 6;\n    method?: string;\n    headers?: HeadersInit;\n    signal?: AbortSignal,\n    timeout?: number;\n    rejectUnauthorized?: boolean;\n    /**\n     * Checks the status code. Defaults to true.\n     */\n    checkStatusCode?: boolean | ((statusCode: number) => boolean);\n    body?: B | string | ArrayBufferView | any;\n    withCredentials?: boolean;\n}\n\nexport interface HttpFetchJsonOptions<B> extends HttpFetchOptionsBase<B> {\n    responseType: 'json';\n}\n\nexport interface HttpFetchBufferOptions<B> extends HttpFetchOptionsBase<B> {\n    responseType: 'buffer';\n}\n\nexport interface HttpFetchDefaultOptions<B> extends HttpFetchOptionsBase<B> {\n    responseType?: undefined;\n}\n\nexport interface HttpFetchTextOptions<B> extends HttpFetchOptionsBase<B> {\n    responseType: 'text';\n}\nexport interface HttpFetchReadableOptions<B> extends HttpFetchOptionsBase<B> {\n    responseType: 'readable';\n}\n\nexport type HttpFetchOptions<B> = HttpFetchJsonOptions<B> | HttpFetchBufferOptions<B> | HttpFetchDefaultOptions<B> | HttpFetchTextOptions<B> | HttpFetchReadableOptions<B>;\n\nexport function fetchStatusCodeOk(statusCode: number) {\n    return statusCode >= 200 && statusCode <= 299;\n}\n\nexport function checkStatus(statusCode: number) {\n    if (!fetchStatusCodeOk(statusCode))\n        throw new Error(`http response statusCode ${statusCode}`);\n    return true;\n}\n\nexport function getFetchMethod(options: HttpFetchOptions<any>) {\n    const method = options.method || (options.body ? 'POST' : 'GET');\n    return method;\n}\n\nexport interface HttpFetchResponse<T> {\n    statusCode: number;\n    headers: Headers;\n    body: T;\n}\n\nexport type fetcher<B, M> = <T extends HttpFetchOptions<B>>(options: T) => Promise<HttpFetchResponse<\n    // first one serves as default.\n    T extends HttpFetchBufferOptions<B> ? Buffer\n    : T extends HttpFetchTextOptions<B> ? string\n    : T extends HttpFetchReadableOptions<B> ? M\n    : T extends HttpFetchJsonOptions<B> ? any : Buffer\n>>;\n\n\nexport function getHttpFetchAccept(responseType: HttpFetchResponseType | undefined) {\n    switch (responseType) {\n        case 'json':\n            return 'application/json';\n        case 'text':\n            return 'text/plain';\n    }\n    return;\n}\n\nexport function hasHeader(headers: [string, string][], key: string) {\n    key = key.toLowerCase();\n    return headers.find(([k]) => k.toLowerCase() === key);\n}\n\nexport function removeHeader(headers: [string, string][], key: string) {\n    key = key.toLowerCase();\n    const filteredHeaders = headers.filter(([headerKey, _]) => headerKey.toLowerCase() !== key);\n    headers.length = 0;\n    filteredHeaders.forEach(header => headers.push(header));\n}\n\nexport function setHeader(headers: [string, string][], key: string, value: string) {\n    removeHeader(headers, key);\n    headers.push([key, value]);\n}\n\nexport function setDefaultHttpFetchAccept(headers: [string, string][], responseType: HttpFetchResponseType | undefined) {\n    if (hasHeader(headers, 'Accept'))\n        return;\n    const accept = getHttpFetchAccept(responseType);\n    if (accept)\n        setHeader(headers, 'Accept', accept);\n}\n\nexport function createHeadersArray(headers: HeadersInit | undefined): [string, string][] {\n    const headersArray: [string, string][] = [];\n    if (!headers)\n        return headersArray;\n    if (headers instanceof Headers) {\n        for (const [k, v] of headers.entries()) {\n            headersArray.push([k, v]);\n        }\n        return headersArray;\n    }\n\n    if (headers instanceof Array) {\n        for (const [k, v] of headers) {\n            headersArray.push([k, v]);\n        }\n        return headersArray;\n    }\n\n    for (const k of Object.keys(headers)) {\n        const v = headers[k];\n        headersArray.push([k, v]);\n    }\n\n    return headersArray;\n}\n\n/**\n *\n * @param headers\n * @param body\n * @returns Returns the body and Content-Type header that was set.\n */\nexport function createStringOrBufferBody(headers: [string, string][], body: any) {\n    let contentType: string | undefined;\n    if (typeof body === 'object') {\n        body = JSON.stringify(body);\n        contentType = 'application/json';\n    }\n    else if (typeof body === 'string') {\n        contentType = 'text/plain';\n    }\n\n    if (contentType && !hasHeader(headers, 'Content-Type'))\n        setHeader(headers, 'Content-Type', contentType);\n\n    if (!hasHeader(headers, 'Content-Length')) {\n        body = Buffer.from(body);\n        setHeader(headers, 'Content-Length', body.length.toString());\n    }\n    return body;\n}\n\nexport async function domFetchParseIncomingMessage(response: Response, responseType: HttpFetchResponseType | undefined) {\n    switch (responseType) {\n        case 'json':\n            return response.json();\n        case 'text':\n            return response.text();\n        case 'readable':\n            return response;\n    }\n    return new Uint8Array(await response.arrayBuffer());\n}\n\nexport async function domFetch<T extends HttpFetchOptions<BodyInit>>(options: T): Promise<HttpFetchResponse<\n    // first one serves as default.\n    T extends HttpFetchBufferOptions<BodyInit> ? Buffer\n    : T extends HttpFetchTextOptions<BodyInit> ? string\n    : T extends HttpFetchReadableOptions<BodyInit> ? Response\n    : T extends HttpFetchJsonOptions<BodyInit> ? any : Buffer\n>> {\n    const headers = createHeadersArray(options.headers);\n    setDefaultHttpFetchAccept(headers, options.responseType);\n\n    let { body } = options;\n    if (body && !(body instanceof ReadableStream)) {\n        body = createStringOrBufferBody(headers, body);\n    }\n\n    let controller: AbortController | undefined;\n    let timeout: NodeJS.Timeout;\n    if (options.timeout) {\n        controller = new AbortController();\n        timeout = setTimeout(() => controller!.abort(), options.timeout);\n\n        options.signal?.addEventListener('abort', () => controller!.abort(options.signal?.reason));\n    }\n\n    try {\n        const { url } = options;\n        const response = await fetch(url, {\n            method: getFetchMethod(options),\n            credentials: options.withCredentials ? 'include' : undefined,\n            headers,\n            signal: controller?.signal || options.signal,\n            body,\n        });\n\n        if (options?.checkStatusCode === undefined || options?.checkStatusCode) {\n            try {\n                const checker = typeof options?.checkStatusCode === 'function' ? options.checkStatusCode : checkStatus;\n                if (!checker(response.status))\n                    throw new Error(`http response statusCode ${response.status}`);\n            }\n            catch (e) {\n                response.arrayBuffer().catch(() => { });\n                throw e;\n            }\n        }\n\n        return {\n            statusCode: response.status,\n            headers: response.headers,\n            body: await domFetchParseIncomingMessage(response, options.responseType),\n        };\n    }\n    finally {\n        clearTimeout(timeout!);\n    }\n}\n","/* eslint-env browser */\n\n/**\n * This is the web browser implementation of `debug()`.\n */\n\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = localstorage();\nexports.destroy = (() => {\n\tlet warned = false;\n\n\treturn () => {\n\t\tif (!warned) {\n\t\t\twarned = true;\n\t\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t\t}\n\t};\n})();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n\t'#0000CC',\n\t'#0000FF',\n\t'#0033CC',\n\t'#0033FF',\n\t'#0066CC',\n\t'#0066FF',\n\t'#0099CC',\n\t'#0099FF',\n\t'#00CC00',\n\t'#00CC33',\n\t'#00CC66',\n\t'#00CC99',\n\t'#00CCCC',\n\t'#00CCFF',\n\t'#3300CC',\n\t'#3300FF',\n\t'#3333CC',\n\t'#3333FF',\n\t'#3366CC',\n\t'#3366FF',\n\t'#3399CC',\n\t'#3399FF',\n\t'#33CC00',\n\t'#33CC33',\n\t'#33CC66',\n\t'#33CC99',\n\t'#33CCCC',\n\t'#33CCFF',\n\t'#6600CC',\n\t'#6600FF',\n\t'#6633CC',\n\t'#6633FF',\n\t'#66CC00',\n\t'#66CC33',\n\t'#9900CC',\n\t'#9900FF',\n\t'#9933CC',\n\t'#9933FF',\n\t'#99CC00',\n\t'#99CC33',\n\t'#CC0000',\n\t'#CC0033',\n\t'#CC0066',\n\t'#CC0099',\n\t'#CC00CC',\n\t'#CC00FF',\n\t'#CC3300',\n\t'#CC3333',\n\t'#CC3366',\n\t'#CC3399',\n\t'#CC33CC',\n\t'#CC33FF',\n\t'#CC6600',\n\t'#CC6633',\n\t'#CC9900',\n\t'#CC9933',\n\t'#CCCC00',\n\t'#CCCC33',\n\t'#FF0000',\n\t'#FF0033',\n\t'#FF0066',\n\t'#FF0099',\n\t'#FF00CC',\n\t'#FF00FF',\n\t'#FF3300',\n\t'#FF3333',\n\t'#FF3366',\n\t'#FF3399',\n\t'#FF33CC',\n\t'#FF33FF',\n\t'#FF6600',\n\t'#FF6633',\n\t'#FF9900',\n\t'#FF9933',\n\t'#FFCC00',\n\t'#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\n// eslint-disable-next-line complexity\nfunction useColors() {\n\t// NB: In an Electron preload script, document will be defined but not fully\n\t// initialized. Since we know we're in Chrome, we'll just detect this case\n\t// explicitly\n\tif (typeof window !== 'undefined' && window.process && (window.process.type === 'renderer' || window.process.__nwjs)) {\n\t\treturn true;\n\t}\n\n\t// Internet Explorer and Edge do not support colors.\n\tif (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n\t\treturn false;\n\t}\n\n\t// Is webkit? http://stackoverflow.com/a/16459606/376773\n\t// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n\treturn (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n\t\t// Is firebug? http://stackoverflow.com/a/398120/376773\n\t\t(typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n\t\t// Is firefox >= v31?\n\t\t// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31) ||\n\t\t// Double check webkit in userAgent just in case we are in a worker\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\targs[0] = (this.useColors ? '%c' : '') +\n\t\tthis.namespace +\n\t\t(this.useColors ? ' %c' : ' ') +\n\t\targs[0] +\n\t\t(this.useColors ? '%c ' : ' ') +\n\t\t'+' + module.exports.humanize(this.diff);\n\n\tif (!this.useColors) {\n\t\treturn;\n\t}\n\n\tconst c = 'color: ' + this.color;\n\targs.splice(1, 0, c, 'color: inherit');\n\n\t// The final \"%c\" is somewhat tricky, because there could be other\n\t// arguments passed either before or after the %c, so we need to\n\t// figure out the correct index to insert the CSS into\n\tlet index = 0;\n\tlet lastC = 0;\n\targs[0].replace(/%[a-zA-Z%]/g, match => {\n\t\tif (match === '%%') {\n\t\t\treturn;\n\t\t}\n\t\tindex++;\n\t\tif (match === '%c') {\n\t\t\t// We only are interested in the *last* %c\n\t\t\t// (the user may have provided their own)\n\t\t\tlastC = index;\n\t\t}\n\t});\n\n\targs.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.debug()` when available.\n * No-op when `console.debug` is not a \"function\".\n * If `console.debug` is not available, falls back\n * to `console.log`.\n *\n * @api public\n */\nexports.log = console.debug || console.log || (() => {});\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\ttry {\n\t\tif (namespaces) {\n\t\t\texports.storage.setItem('debug', namespaces);\n\t\t} else {\n\t\t\texports.storage.removeItem('debug');\n\t\t}\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\nfunction load() {\n\tlet r;\n\ttry {\n\t\tr = exports.storage.getItem('debug');\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n\n\t// If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n\tif (!r && typeof process !== 'undefined' && 'env' in process) {\n\t\tr = process.env.DEBUG;\n\t}\n\n\treturn r;\n}\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n\ttry {\n\t\t// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context\n\t\t// The Browser also has localStorage in the global context.\n\t\treturn localStorage;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nformatters.j = function (v) {\n\ttry {\n\t\treturn JSON.stringify(v);\n\t} catch (error) {\n\t\treturn '[UnexpectedJSONParseError]: ' + error.message;\n\t}\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ScryptedMimeTypes = exports.ScryptedInterface = exports.MediaPlayerState = exports.SecuritySystemObstruction = exports.SecuritySystemMode = exports.AirQuality = exports.AirPurifierMode = exports.AirPurifierStatus = exports.ChargeState = exports.LockState = exports.PanTiltZoomMovement = exports.ThermostatMode = exports.TemperatureUnit = exports.FanMode = exports.HumidityMode = exports.ScryptedDeviceType = exports.ScryptedInterfaceDescriptors = exports.ScryptedInterfaceMethod = exports.ScryptedInterfaceProperty = exports.DeviceBase = exports.TYPES_VERSION = void 0;\nexports.TYPES_VERSION = \"0.5.51\";\nclass DeviceBase {\n}\nexports.DeviceBase = DeviceBase;\nvar ScryptedInterfaceProperty;\n(function (ScryptedInterfaceProperty) {\n    ScryptedInterfaceProperty[\"id\"] = \"id\";\n    ScryptedInterfaceProperty[\"info\"] = \"info\";\n    ScryptedInterfaceProperty[\"interfaces\"] = \"interfaces\";\n    ScryptedInterfaceProperty[\"mixins\"] = \"mixins\";\n    ScryptedInterfaceProperty[\"name\"] = \"name\";\n    ScryptedInterfaceProperty[\"nativeId\"] = \"nativeId\";\n    ScryptedInterfaceProperty[\"pluginId\"] = \"pluginId\";\n    ScryptedInterfaceProperty[\"providedInterfaces\"] = \"providedInterfaces\";\n    ScryptedInterfaceProperty[\"providedName\"] = \"providedName\";\n    ScryptedInterfaceProperty[\"providedRoom\"] = \"providedRoom\";\n    ScryptedInterfaceProperty[\"providedType\"] = \"providedType\";\n    ScryptedInterfaceProperty[\"providerId\"] = \"providerId\";\n    ScryptedInterfaceProperty[\"room\"] = \"room\";\n    ScryptedInterfaceProperty[\"type\"] = \"type\";\n    ScryptedInterfaceProperty[\"scryptedRuntimeArguments\"] = \"scryptedRuntimeArguments\";\n    ScryptedInterfaceProperty[\"on\"] = \"on\";\n    ScryptedInterfaceProperty[\"brightness\"] = \"brightness\";\n    ScryptedInterfaceProperty[\"colorTemperature\"] = \"colorTemperature\";\n    ScryptedInterfaceProperty[\"rgb\"] = \"rgb\";\n    ScryptedInterfaceProperty[\"hsv\"] = \"hsv\";\n    ScryptedInterfaceProperty[\"buttons\"] = \"buttons\";\n    ScryptedInterfaceProperty[\"sensors\"] = \"sensors\";\n    ScryptedInterfaceProperty[\"running\"] = \"running\";\n    ScryptedInterfaceProperty[\"paused\"] = \"paused\";\n    ScryptedInterfaceProperty[\"docked\"] = \"docked\";\n    ScryptedInterfaceProperty[\"temperatureSetting\"] = \"temperatureSetting\";\n    ScryptedInterfaceProperty[\"temperature\"] = \"temperature\";\n    ScryptedInterfaceProperty[\"temperatureUnit\"] = \"temperatureUnit\";\n    ScryptedInterfaceProperty[\"humidity\"] = \"humidity\";\n    ScryptedInterfaceProperty[\"resolution\"] = \"resolution\";\n    ScryptedInterfaceProperty[\"audioVolumes\"] = \"audioVolumes\";\n    ScryptedInterfaceProperty[\"recordingActive\"] = \"recordingActive\";\n    ScryptedInterfaceProperty[\"ptzCapabilities\"] = \"ptzCapabilities\";\n    ScryptedInterfaceProperty[\"lockState\"] = \"lockState\";\n    ScryptedInterfaceProperty[\"entryOpen\"] = \"entryOpen\";\n    ScryptedInterfaceProperty[\"batteryLevel\"] = \"batteryLevel\";\n    ScryptedInterfaceProperty[\"chargeState\"] = \"chargeState\";\n    ScryptedInterfaceProperty[\"online\"] = \"online\";\n    ScryptedInterfaceProperty[\"fromMimeType\"] = \"fromMimeType\";\n    ScryptedInterfaceProperty[\"toMimeType\"] = \"toMimeType\";\n    ScryptedInterfaceProperty[\"converters\"] = \"converters\";\n    ScryptedInterfaceProperty[\"binaryState\"] = \"binaryState\";\n    ScryptedInterfaceProperty[\"tampered\"] = \"tampered\";\n    ScryptedInterfaceProperty[\"sleeping\"] = \"sleeping\";\n    ScryptedInterfaceProperty[\"powerDetected\"] = \"powerDetected\";\n    ScryptedInterfaceProperty[\"audioDetected\"] = \"audioDetected\";\n    ScryptedInterfaceProperty[\"motionDetected\"] = \"motionDetected\";\n    ScryptedInterfaceProperty[\"ambientLight\"] = \"ambientLight\";\n    ScryptedInterfaceProperty[\"occupied\"] = \"occupied\";\n    ScryptedInterfaceProperty[\"flooded\"] = \"flooded\";\n    ScryptedInterfaceProperty[\"ultraviolet\"] = \"ultraviolet\";\n    ScryptedInterfaceProperty[\"luminance\"] = \"luminance\";\n    ScryptedInterfaceProperty[\"position\"] = \"position\";\n    ScryptedInterfaceProperty[\"securitySystemState\"] = \"securitySystemState\";\n    ScryptedInterfaceProperty[\"pm10Density\"] = \"pm10Density\";\n    ScryptedInterfaceProperty[\"pm25Density\"] = \"pm25Density\";\n    ScryptedInterfaceProperty[\"vocDensity\"] = \"vocDensity\";\n    ScryptedInterfaceProperty[\"noxDensity\"] = \"noxDensity\";\n    ScryptedInterfaceProperty[\"co2ppm\"] = \"co2ppm\";\n    ScryptedInterfaceProperty[\"airQuality\"] = \"airQuality\";\n    ScryptedInterfaceProperty[\"airPurifierState\"] = \"airPurifierState\";\n    ScryptedInterfaceProperty[\"filterChangeIndication\"] = \"filterChangeIndication\";\n    ScryptedInterfaceProperty[\"filterLifeLevel\"] = \"filterLifeLevel\";\n    ScryptedInterfaceProperty[\"humiditySetting\"] = \"humiditySetting\";\n    ScryptedInterfaceProperty[\"fan\"] = \"fan\";\n    ScryptedInterfaceProperty[\"applicationInfo\"] = \"applicationInfo\";\n    ScryptedInterfaceProperty[\"chatCompletionCapabilities\"] = \"chatCompletionCapabilities\";\n    ScryptedInterfaceProperty[\"systemDevice\"] = \"systemDevice\";\n})(ScryptedInterfaceProperty || (exports.ScryptedInterfaceProperty = ScryptedInterfaceProperty = {}));\nvar ScryptedInterfaceMethod;\n(function (ScryptedInterfaceMethod) {\n    ScryptedInterfaceMethod[\"listen\"] = \"listen\";\n    ScryptedInterfaceMethod[\"probe\"] = \"probe\";\n    ScryptedInterfaceMethod[\"setMixins\"] = \"setMixins\";\n    ScryptedInterfaceMethod[\"setName\"] = \"setName\";\n    ScryptedInterfaceMethod[\"setRoom\"] = \"setRoom\";\n    ScryptedInterfaceMethod[\"setType\"] = \"setType\";\n    ScryptedInterfaceMethod[\"getPluginJson\"] = \"getPluginJson\";\n    ScryptedInterfaceMethod[\"turnOff\"] = \"turnOff\";\n    ScryptedInterfaceMethod[\"turnOn\"] = \"turnOn\";\n    ScryptedInterfaceMethod[\"setBrightness\"] = \"setBrightness\";\n    ScryptedInterfaceMethod[\"getTemperatureMaxK\"] = \"getTemperatureMaxK\";\n    ScryptedInterfaceMethod[\"getTemperatureMinK\"] = \"getTemperatureMinK\";\n    ScryptedInterfaceMethod[\"setColorTemperature\"] = \"setColorTemperature\";\n    ScryptedInterfaceMethod[\"setRgb\"] = \"setRgb\";\n    ScryptedInterfaceMethod[\"setHsv\"] = \"setHsv\";\n    ScryptedInterfaceMethod[\"pressButton\"] = \"pressButton\";\n    ScryptedInterfaceMethod[\"sendNotification\"] = \"sendNotification\";\n    ScryptedInterfaceMethod[\"start\"] = \"start\";\n    ScryptedInterfaceMethod[\"stop\"] = \"stop\";\n    ScryptedInterfaceMethod[\"pause\"] = \"pause\";\n    ScryptedInterfaceMethod[\"resume\"] = \"resume\";\n    ScryptedInterfaceMethod[\"dock\"] = \"dock\";\n    ScryptedInterfaceMethod[\"setTemperature\"] = \"setTemperature\";\n    ScryptedInterfaceMethod[\"setTemperatureUnit\"] = \"setTemperatureUnit\";\n    ScryptedInterfaceMethod[\"getPictureOptions\"] = \"getPictureOptions\";\n    ScryptedInterfaceMethod[\"takePicture\"] = \"takePicture\";\n    ScryptedInterfaceMethod[\"getAudioStream\"] = \"getAudioStream\";\n    ScryptedInterfaceMethod[\"setAudioVolumes\"] = \"setAudioVolumes\";\n    ScryptedInterfaceMethod[\"startDisplay\"] = \"startDisplay\";\n    ScryptedInterfaceMethod[\"stopDisplay\"] = \"stopDisplay\";\n    ScryptedInterfaceMethod[\"getVideoStream\"] = \"getVideoStream\";\n    ScryptedInterfaceMethod[\"getVideoStreamOptions\"] = \"getVideoStreamOptions\";\n    ScryptedInterfaceMethod[\"getPrivacyMasks\"] = \"getPrivacyMasks\";\n    ScryptedInterfaceMethod[\"setPrivacyMasks\"] = \"setPrivacyMasks\";\n    ScryptedInterfaceMethod[\"getVideoTextOverlays\"] = \"getVideoTextOverlays\";\n    ScryptedInterfaceMethod[\"setVideoTextOverlay\"] = \"setVideoTextOverlay\";\n    ScryptedInterfaceMethod[\"getRecordingStream\"] = \"getRecordingStream\";\n    ScryptedInterfaceMethod[\"getRecordingStreamCurrentTime\"] = \"getRecordingStreamCurrentTime\";\n    ScryptedInterfaceMethod[\"getRecordingStreamOptions\"] = \"getRecordingStreamOptions\";\n    ScryptedInterfaceMethod[\"getRecordingStreamThumbnail\"] = \"getRecordingStreamThumbnail\";\n    ScryptedInterfaceMethod[\"deleteRecordingStream\"] = \"deleteRecordingStream\";\n    ScryptedInterfaceMethod[\"setRecordingActive\"] = \"setRecordingActive\";\n    ScryptedInterfaceMethod[\"ptzCommand\"] = \"ptzCommand\";\n    ScryptedInterfaceMethod[\"getRecordedEvents\"] = \"getRecordedEvents\";\n    ScryptedInterfaceMethod[\"getVideoClip\"] = \"getVideoClip\";\n    ScryptedInterfaceMethod[\"getVideoClips\"] = \"getVideoClips\";\n    ScryptedInterfaceMethod[\"getVideoClipThumbnail\"] = \"getVideoClipThumbnail\";\n    ScryptedInterfaceMethod[\"removeVideoClips\"] = \"removeVideoClips\";\n    ScryptedInterfaceMethod[\"setVideoStreamOptions\"] = \"setVideoStreamOptions\";\n    ScryptedInterfaceMethod[\"startIntercom\"] = \"startIntercom\";\n    ScryptedInterfaceMethod[\"stopIntercom\"] = \"stopIntercom\";\n    ScryptedInterfaceMethod[\"lock\"] = \"lock\";\n    ScryptedInterfaceMethod[\"unlock\"] = \"unlock\";\n    ScryptedInterfaceMethod[\"addPassword\"] = \"addPassword\";\n    ScryptedInterfaceMethod[\"getPasswords\"] = \"getPasswords\";\n    ScryptedInterfaceMethod[\"removePassword\"] = \"removePassword\";\n    ScryptedInterfaceMethod[\"activate\"] = \"activate\";\n    ScryptedInterfaceMethod[\"deactivate\"] = \"deactivate\";\n    ScryptedInterfaceMethod[\"isReversible\"] = \"isReversible\";\n    ScryptedInterfaceMethod[\"closeEntry\"] = \"closeEntry\";\n    ScryptedInterfaceMethod[\"openEntry\"] = \"openEntry\";\n    ScryptedInterfaceMethod[\"getDevice\"] = \"getDevice\";\n    ScryptedInterfaceMethod[\"releaseDevice\"] = \"releaseDevice\";\n    ScryptedInterfaceMethod[\"adoptDevice\"] = \"adoptDevice\";\n    ScryptedInterfaceMethod[\"discoverDevices\"] = \"discoverDevices\";\n    ScryptedInterfaceMethod[\"createDevice\"] = \"createDevice\";\n    ScryptedInterfaceMethod[\"getCreateDeviceSettings\"] = \"getCreateDeviceSettings\";\n    ScryptedInterfaceMethod[\"reboot\"] = \"reboot\";\n    ScryptedInterfaceMethod[\"getRefreshFrequency\"] = \"getRefreshFrequency\";\n    ScryptedInterfaceMethod[\"refresh\"] = \"refresh\";\n    ScryptedInterfaceMethod[\"getMediaStatus\"] = \"getMediaStatus\";\n    ScryptedInterfaceMethod[\"load\"] = \"load\";\n    ScryptedInterfaceMethod[\"seek\"] = \"seek\";\n    ScryptedInterfaceMethod[\"skipNext\"] = \"skipNext\";\n    ScryptedInterfaceMethod[\"skipPrevious\"] = \"skipPrevious\";\n    ScryptedInterfaceMethod[\"convert\"] = \"convert\";\n    ScryptedInterfaceMethod[\"convertMedia\"] = \"convertMedia\";\n    ScryptedInterfaceMethod[\"getSettings\"] = \"getSettings\";\n    ScryptedInterfaceMethod[\"putSetting\"] = \"putSetting\";\n    ScryptedInterfaceMethod[\"armSecuritySystem\"] = \"armSecuritySystem\";\n    ScryptedInterfaceMethod[\"disarmSecuritySystem\"] = \"disarmSecuritySystem\";\n    ScryptedInterfaceMethod[\"setAirPurifierState\"] = \"setAirPurifierState\";\n    ScryptedInterfaceMethod[\"getReadmeMarkdown\"] = \"getReadmeMarkdown\";\n    ScryptedInterfaceMethod[\"getOauthUrl\"] = \"getOauthUrl\";\n    ScryptedInterfaceMethod[\"onOauthCallback\"] = \"onOauthCallback\";\n    ScryptedInterfaceMethod[\"canMixin\"] = \"canMixin\";\n    ScryptedInterfaceMethod[\"getMixin\"] = \"getMixin\";\n    ScryptedInterfaceMethod[\"releaseMixin\"] = \"releaseMixin\";\n    ScryptedInterfaceMethod[\"onRequest\"] = \"onRequest\";\n    ScryptedInterfaceMethod[\"onConnection\"] = \"onConnection\";\n    ScryptedInterfaceMethod[\"onPush\"] = \"onPush\";\n    ScryptedInterfaceMethod[\"run\"] = \"run\";\n    ScryptedInterfaceMethod[\"eval\"] = \"eval\";\n    ScryptedInterfaceMethod[\"loadScripts\"] = \"loadScripts\";\n    ScryptedInterfaceMethod[\"saveScript\"] = \"saveScript\";\n    ScryptedInterfaceMethod[\"forkInterface\"] = \"forkInterface\";\n    ScryptedInterfaceMethod[\"getDetectionInput\"] = \"getDetectionInput\";\n    ScryptedInterfaceMethod[\"getObjectTypes\"] = \"getObjectTypes\";\n    ScryptedInterfaceMethod[\"detectObjects\"] = \"detectObjects\";\n    ScryptedInterfaceMethod[\"generateObjectDetections\"] = \"generateObjectDetections\";\n    ScryptedInterfaceMethod[\"getDetectionModel\"] = \"getDetectionModel\";\n    ScryptedInterfaceMethod[\"setHumidity\"] = \"setHumidity\";\n    ScryptedInterfaceMethod[\"setFan\"] = \"setFan\";\n    ScryptedInterfaceMethod[\"startRTCSignalingSession\"] = \"startRTCSignalingSession\";\n    ScryptedInterfaceMethod[\"createRTCSignalingSession\"] = \"createRTCSignalingSession\";\n    ScryptedInterfaceMethod[\"getScryptedUserAccessControl\"] = \"getScryptedUserAccessControl\";\n    ScryptedInterfaceMethod[\"generateVideoFrames\"] = \"generateVideoFrames\";\n    ScryptedInterfaceMethod[\"connectStream\"] = \"connectStream\";\n    ScryptedInterfaceMethod[\"getTTYSettings\"] = \"getTTYSettings\";\n    ScryptedInterfaceMethod[\"getChatCompletion\"] = \"getChatCompletion\";\n    ScryptedInterfaceMethod[\"streamChatCompletion\"] = \"streamChatCompletion\";\n    ScryptedInterfaceMethod[\"getTextEmbedding\"] = \"getTextEmbedding\";\n    ScryptedInterfaceMethod[\"getImageEmbedding\"] = \"getImageEmbedding\";\n    ScryptedInterfaceMethod[\"callLLMTool\"] = \"callLLMTool\";\n    ScryptedInterfaceMethod[\"getLLMTools\"] = \"getLLMTools\";\n})(ScryptedInterfaceMethod || (exports.ScryptedInterfaceMethod = ScryptedInterfaceMethod = {}));\nexports.ScryptedInterfaceDescriptors = {\n    \"ScryptedDevice\": {\n        \"name\": \"ScryptedDevice\",\n        \"methods\": [\n            \"listen\",\n            \"probe\",\n            \"setMixins\",\n            \"setName\",\n            \"setRoom\",\n            \"setType\"\n        ],\n        \"properties\": [\n            \"id\",\n            \"info\",\n            \"interfaces\",\n            \"mixins\",\n            \"name\",\n            \"nativeId\",\n            \"pluginId\",\n            \"providedInterfaces\",\n            \"providedName\",\n            \"providedRoom\",\n            \"providedType\",\n            \"providerId\",\n            \"room\",\n            \"type\"\n        ]\n    },\n    \"ScryptedPlugin\": {\n        \"name\": \"ScryptedPlugin\",\n        \"methods\": [\n            \"getPluginJson\"\n        ],\n        \"properties\": []\n    },\n    \"ScryptedPluginRuntime\": {\n        \"name\": \"ScryptedPluginRuntime\",\n        \"methods\": [],\n        \"properties\": [\n            \"scryptedRuntimeArguments\"\n        ]\n    },\n    \"OnOff\": {\n        \"name\": \"OnOff\",\n        \"methods\": [\n            \"turnOff\",\n            \"turnOn\"\n        ],\n        \"properties\": [\n            \"on\"\n        ]\n    },\n    \"Brightness\": {\n        \"name\": \"Brightness\",\n        \"methods\": [\n            \"setBrightness\"\n        ],\n        \"properties\": [\n            \"brightness\"\n        ]\n    },\n    \"ColorSettingTemperature\": {\n        \"name\": \"ColorSettingTemperature\",\n        \"methods\": [\n            \"getTemperatureMaxK\",\n            \"getTemperatureMinK\",\n            \"setColorTemperature\"\n        ],\n        \"properties\": [\n            \"colorTemperature\"\n        ]\n    },\n    \"ColorSettingRgb\": {\n        \"name\": \"ColorSettingRgb\",\n        \"methods\": [\n            \"setRgb\"\n        ],\n        \"properties\": [\n            \"rgb\"\n        ]\n    },\n    \"ColorSettingHsv\": {\n        \"name\": \"ColorSettingHsv\",\n        \"methods\": [\n            \"setHsv\"\n        ],\n        \"properties\": [\n            \"hsv\"\n        ]\n    },\n    \"Buttons\": {\n        \"name\": \"Buttons\",\n        \"methods\": [],\n        \"properties\": [\n            \"buttons\"\n        ]\n    },\n    \"PressButtons\": {\n        \"name\": \"PressButtons\",\n        \"methods\": [\n            \"pressButton\"\n        ],\n        \"properties\": []\n    },\n    \"Sensors\": {\n        \"name\": \"Sensors\",\n        \"methods\": [],\n        \"properties\": [\n            \"sensors\"\n        ]\n    },\n    \"Notifier\": {\n        \"name\": \"Notifier\",\n        \"methods\": [\n            \"sendNotification\"\n        ],\n        \"properties\": []\n    },\n    \"StartStop\": {\n        \"name\": \"StartStop\",\n        \"methods\": [\n            \"start\",\n            \"stop\"\n        ],\n        \"properties\": [\n            \"running\"\n        ]\n    },\n    \"Pause\": {\n        \"name\": \"Pause\",\n        \"methods\": [\n            \"pause\",\n            \"resume\"\n        ],\n        \"properties\": [\n            \"paused\"\n        ]\n    },\n    \"Dock\": {\n        \"name\": \"Dock\",\n        \"methods\": [\n            \"dock\"\n        ],\n        \"properties\": [\n            \"docked\"\n        ]\n    },\n    \"TemperatureSetting\": {\n        \"name\": \"TemperatureSetting\",\n        \"methods\": [\n            \"setTemperature\"\n        ],\n        \"properties\": [\n            \"temperatureSetting\"\n        ]\n    },\n    \"Thermometer\": {\n        \"name\": \"Thermometer\",\n        \"methods\": [\n            \"setTemperatureUnit\"\n        ],\n        \"properties\": [\n            \"temperature\",\n            \"temperatureUnit\"\n        ]\n    },\n    \"HumiditySensor\": {\n        \"name\": \"HumiditySensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"humidity\"\n        ]\n    },\n    \"Camera\": {\n        \"name\": \"Camera\",\n        \"methods\": [\n            \"getPictureOptions\",\n            \"takePicture\"\n        ],\n        \"properties\": []\n    },\n    \"Resolution\": {\n        \"name\": \"Resolution\",\n        \"methods\": [],\n        \"properties\": [\n            \"resolution\"\n        ]\n    },\n    \"Microphone\": {\n        \"name\": \"Microphone\",\n        \"methods\": [\n            \"getAudioStream\"\n        ],\n        \"properties\": []\n    },\n    \"AudioVolumeControl\": {\n        \"name\": \"AudioVolumeControl\",\n        \"methods\": [\n            \"setAudioVolumes\"\n        ],\n        \"properties\": [\n            \"audioVolumes\"\n        ]\n    },\n    \"Display\": {\n        \"name\": \"Display\",\n        \"methods\": [\n            \"startDisplay\",\n            \"stopDisplay\"\n        ],\n        \"properties\": []\n    },\n    \"VideoCamera\": {\n        \"name\": \"VideoCamera\",\n        \"methods\": [\n            \"getVideoStream\",\n            \"getVideoStreamOptions\"\n        ],\n        \"properties\": []\n    },\n    \"VideoCameraMask\": {\n        \"name\": \"VideoCameraMask\",\n        \"methods\": [\n            \"getPrivacyMasks\",\n            \"setPrivacyMasks\"\n        ],\n        \"properties\": []\n    },\n    \"VideoTextOverlays\": {\n        \"name\": \"VideoTextOverlays\",\n        \"methods\": [\n            \"getVideoTextOverlays\",\n            \"setVideoTextOverlay\"\n        ],\n        \"properties\": []\n    },\n    \"VideoRecorder\": {\n        \"name\": \"VideoRecorder\",\n        \"methods\": [\n            \"getRecordingStream\",\n            \"getRecordingStreamCurrentTime\",\n            \"getRecordingStreamOptions\",\n            \"getRecordingStreamThumbnail\"\n        ],\n        \"properties\": [\n            \"recordingActive\"\n        ]\n    },\n    \"VideoRecorderManagement\": {\n        \"name\": \"VideoRecorderManagement\",\n        \"methods\": [\n            \"deleteRecordingStream\",\n            \"setRecordingActive\"\n        ],\n        \"properties\": []\n    },\n    \"PanTiltZoom\": {\n        \"name\": \"PanTiltZoom\",\n        \"methods\": [\n            \"ptzCommand\"\n        ],\n        \"properties\": [\n            \"ptzCapabilities\"\n        ]\n    },\n    \"EventRecorder\": {\n        \"name\": \"EventRecorder\",\n        \"methods\": [\n            \"getRecordedEvents\"\n        ],\n        \"properties\": []\n    },\n    \"VideoClips\": {\n        \"name\": \"VideoClips\",\n        \"methods\": [\n            \"getVideoClip\",\n            \"getVideoClips\",\n            \"getVideoClipThumbnail\",\n            \"removeVideoClips\"\n        ],\n        \"properties\": []\n    },\n    \"VideoCameraConfiguration\": {\n        \"name\": \"VideoCameraConfiguration\",\n        \"methods\": [\n            \"setVideoStreamOptions\"\n        ],\n        \"properties\": []\n    },\n    \"Intercom\": {\n        \"name\": \"Intercom\",\n        \"methods\": [\n            \"startIntercom\",\n            \"stopIntercom\"\n        ],\n        \"properties\": []\n    },\n    \"Lock\": {\n        \"name\": \"Lock\",\n        \"methods\": [\n            \"lock\",\n            \"unlock\"\n        ],\n        \"properties\": [\n            \"lockState\"\n        ]\n    },\n    \"PasswordStore\": {\n        \"name\": \"PasswordStore\",\n        \"methods\": [\n            \"addPassword\",\n            \"getPasswords\",\n            \"removePassword\"\n        ],\n        \"properties\": []\n    },\n    \"Scene\": {\n        \"name\": \"Scene\",\n        \"methods\": [\n            \"activate\",\n            \"deactivate\",\n            \"isReversible\"\n        ],\n        \"properties\": []\n    },\n    \"Entry\": {\n        \"name\": \"Entry\",\n        \"methods\": [\n            \"closeEntry\",\n            \"openEntry\"\n        ],\n        \"properties\": []\n    },\n    \"EntrySensor\": {\n        \"name\": \"EntrySensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"entryOpen\"\n        ]\n    },\n    \"DeviceProvider\": {\n        \"name\": \"DeviceProvider\",\n        \"methods\": [\n            \"getDevice\",\n            \"releaseDevice\"\n        ],\n        \"properties\": []\n    },\n    \"DeviceDiscovery\": {\n        \"name\": \"DeviceDiscovery\",\n        \"methods\": [\n            \"adoptDevice\",\n            \"discoverDevices\"\n        ],\n        \"properties\": []\n    },\n    \"DeviceCreator\": {\n        \"name\": \"DeviceCreator\",\n        \"methods\": [\n            \"createDevice\",\n            \"getCreateDeviceSettings\"\n        ],\n        \"properties\": []\n    },\n    \"Battery\": {\n        \"name\": \"Battery\",\n        \"methods\": [],\n        \"properties\": [\n            \"batteryLevel\"\n        ]\n    },\n    \"Charger\": {\n        \"name\": \"Charger\",\n        \"methods\": [],\n        \"properties\": [\n            \"chargeState\"\n        ]\n    },\n    \"Reboot\": {\n        \"name\": \"Reboot\",\n        \"methods\": [\n            \"reboot\"\n        ],\n        \"properties\": []\n    },\n    \"Refresh\": {\n        \"name\": \"Refresh\",\n        \"methods\": [\n            \"getRefreshFrequency\",\n            \"refresh\"\n        ],\n        \"properties\": []\n    },\n    \"MediaPlayer\": {\n        \"name\": \"MediaPlayer\",\n        \"methods\": [\n            \"getMediaStatus\",\n            \"load\",\n            \"seek\",\n            \"skipNext\",\n            \"skipPrevious\"\n        ],\n        \"properties\": []\n    },\n    \"Online\": {\n        \"name\": \"Online\",\n        \"methods\": [],\n        \"properties\": [\n            \"online\"\n        ]\n    },\n    \"BufferConverter\": {\n        \"name\": \"BufferConverter\",\n        \"methods\": [\n            \"convert\"\n        ],\n        \"properties\": [\n            \"fromMimeType\",\n            \"toMimeType\"\n        ]\n    },\n    \"MediaConverter\": {\n        \"name\": \"MediaConverter\",\n        \"methods\": [\n            \"convertMedia\"\n        ],\n        \"properties\": [\n            \"converters\"\n        ]\n    },\n    \"Settings\": {\n        \"name\": \"Settings\",\n        \"methods\": [\n            \"getSettings\",\n            \"putSetting\"\n        ],\n        \"properties\": []\n    },\n    \"BinarySensor\": {\n        \"name\": \"BinarySensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"binaryState\"\n        ]\n    },\n    \"TamperSensor\": {\n        \"name\": \"TamperSensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"tampered\"\n        ]\n    },\n    \"Sleep\": {\n        \"name\": \"Sleep\",\n        \"methods\": [],\n        \"properties\": [\n            \"sleeping\"\n        ]\n    },\n    \"PowerSensor\": {\n        \"name\": \"PowerSensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"powerDetected\"\n        ]\n    },\n    \"AudioSensor\": {\n        \"name\": \"AudioSensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"audioDetected\"\n        ]\n    },\n    \"MotionSensor\": {\n        \"name\": \"MotionSensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"motionDetected\"\n        ]\n    },\n    \"AmbientLightSensor\": {\n        \"name\": \"AmbientLightSensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"ambientLight\"\n        ]\n    },\n    \"OccupancySensor\": {\n        \"name\": \"OccupancySensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"occupied\"\n        ]\n    },\n    \"FloodSensor\": {\n        \"name\": \"FloodSensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"flooded\"\n        ]\n    },\n    \"UltravioletSensor\": {\n        \"name\": \"UltravioletSensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"ultraviolet\"\n        ]\n    },\n    \"LuminanceSensor\": {\n        \"name\": \"LuminanceSensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"luminance\"\n        ]\n    },\n    \"PositionSensor\": {\n        \"name\": \"PositionSensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"position\"\n        ]\n    },\n    \"SecuritySystem\": {\n        \"name\": \"SecuritySystem\",\n        \"methods\": [\n            \"armSecuritySystem\",\n            \"disarmSecuritySystem\"\n        ],\n        \"properties\": [\n            \"securitySystemState\"\n        ]\n    },\n    \"PM10Sensor\": {\n        \"name\": \"PM10Sensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"pm10Density\"\n        ]\n    },\n    \"PM25Sensor\": {\n        \"name\": \"PM25Sensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"pm25Density\"\n        ]\n    },\n    \"VOCSensor\": {\n        \"name\": \"VOCSensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"vocDensity\"\n        ]\n    },\n    \"NOXSensor\": {\n        \"name\": \"NOXSensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"noxDensity\"\n        ]\n    },\n    \"CO2Sensor\": {\n        \"name\": \"CO2Sensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"co2ppm\"\n        ]\n    },\n    \"AirQualitySensor\": {\n        \"name\": \"AirQualitySensor\",\n        \"methods\": [],\n        \"properties\": [\n            \"airQuality\"\n        ]\n    },\n    \"AirPurifier\": {\n        \"name\": \"AirPurifier\",\n        \"methods\": [\n            \"setAirPurifierState\"\n        ],\n        \"properties\": [\n            \"airPurifierState\"\n        ]\n    },\n    \"FilterMaintenance\": {\n        \"name\": \"FilterMaintenance\",\n        \"methods\": [],\n        \"properties\": [\n            \"filterChangeIndication\",\n            \"filterLifeLevel\"\n        ]\n    },\n    \"Readme\": {\n        \"name\": \"Readme\",\n        \"methods\": [\n            \"getReadmeMarkdown\"\n        ],\n        \"properties\": []\n    },\n    \"OauthClient\": {\n        \"name\": \"OauthClient\",\n        \"methods\": [\n            \"getOauthUrl\",\n            \"onOauthCallback\"\n        ],\n        \"properties\": []\n    },\n    \"MixinProvider\": {\n        \"name\": \"MixinProvider\",\n        \"methods\": [\n            \"canMixin\",\n            \"getMixin\",\n            \"releaseMixin\"\n        ],\n        \"properties\": []\n    },\n    \"HttpRequestHandler\": {\n        \"name\": \"HttpRequestHandler\",\n        \"methods\": [\n            \"onRequest\"\n        ],\n        \"properties\": []\n    },\n    \"EngineIOHandler\": {\n        \"name\": \"EngineIOHandler\",\n        \"methods\": [\n            \"onConnection\"\n        ],\n        \"properties\": []\n    },\n    \"PushHandler\": {\n        \"name\": \"PushHandler\",\n        \"methods\": [\n            \"onPush\"\n        ],\n        \"properties\": []\n    },\n    \"Program\": {\n        \"name\": \"Program\",\n        \"methods\": [\n            \"run\"\n        ],\n        \"properties\": []\n    },\n    \"Scriptable\": {\n        \"name\": \"Scriptable\",\n        \"methods\": [\n            \"eval\",\n            \"loadScripts\",\n            \"saveScript\"\n        ],\n        \"properties\": []\n    },\n    \"ClusterForkInterface\": {\n        \"name\": \"ClusterForkInterface\",\n        \"methods\": [\n            \"forkInterface\"\n        ],\n        \"properties\": []\n    },\n    \"ObjectDetector\": {\n        \"name\": \"ObjectDetector\",\n        \"methods\": [\n            \"getDetectionInput\",\n            \"getObjectTypes\"\n        ],\n        \"properties\": []\n    },\n    \"ObjectDetection\": {\n        \"name\": \"ObjectDetection\",\n        \"methods\": [\n            \"detectObjects\",\n            \"generateObjectDetections\",\n            \"getDetectionModel\"\n        ],\n        \"properties\": []\n    },\n    \"ObjectDetectionPreview\": {\n        \"name\": \"ObjectDetectionPreview\",\n        \"methods\": [],\n        \"properties\": []\n    },\n    \"ObjectDetectionGenerator\": {\n        \"name\": \"ObjectDetectionGenerator\",\n        \"methods\": [],\n        \"properties\": []\n    },\n    \"HumiditySetting\": {\n        \"name\": \"HumiditySetting\",\n        \"methods\": [\n            \"setHumidity\"\n        ],\n        \"properties\": [\n            \"humiditySetting\"\n        ]\n    },\n    \"Fan\": {\n        \"name\": \"Fan\",\n        \"methods\": [\n            \"setFan\"\n        ],\n        \"properties\": [\n            \"fan\"\n        ]\n    },\n    \"RTCSignalingChannel\": {\n        \"name\": \"RTCSignalingChannel\",\n        \"methods\": [\n            \"startRTCSignalingSession\"\n        ],\n        \"properties\": []\n    },\n    \"RTCSignalingClient\": {\n        \"name\": \"RTCSignalingClient\",\n        \"methods\": [\n            \"createRTCSignalingSession\"\n        ],\n        \"properties\": []\n    },\n    \"LauncherApplication\": {\n        \"name\": \"LauncherApplication\",\n        \"methods\": [],\n        \"properties\": [\n            \"applicationInfo\"\n        ]\n    },\n    \"ScryptedUser\": {\n        \"name\": \"ScryptedUser\",\n        \"methods\": [\n            \"getScryptedUserAccessControl\"\n        ],\n        \"properties\": []\n    },\n    \"VideoFrameGenerator\": {\n        \"name\": \"VideoFrameGenerator\",\n        \"methods\": [\n            \"generateVideoFrames\"\n        ],\n        \"properties\": []\n    },\n    \"StreamService\": {\n        \"name\": \"StreamService\",\n        \"methods\": [\n            \"connectStream\"\n        ],\n        \"properties\": []\n    },\n    \"TTY\": {\n        \"name\": \"TTY\",\n        \"methods\": [],\n        \"properties\": []\n    },\n    \"TTYSettings\": {\n        \"name\": \"TTYSettings\",\n        \"methods\": [\n            \"getTTYSettings\"\n        ],\n        \"properties\": []\n    },\n    \"ChatCompletion\": {\n        \"name\": \"ChatCompletion\",\n        \"methods\": [\n            \"getChatCompletion\",\n            \"streamChatCompletion\"\n        ],\n        \"properties\": [\n            \"chatCompletionCapabilities\"\n        ]\n    },\n    \"TextEmbedding\": {\n        \"name\": \"TextEmbedding\",\n        \"methods\": [\n            \"getTextEmbedding\"\n        ],\n        \"properties\": []\n    },\n    \"ImageEmbedding\": {\n        \"name\": \"ImageEmbedding\",\n        \"methods\": [\n            \"getImageEmbedding\"\n        ],\n        \"properties\": []\n    },\n    \"LLMTools\": {\n        \"name\": \"LLMTools\",\n        \"methods\": [\n            \"callLLMTool\",\n            \"getLLMTools\"\n        ],\n        \"properties\": []\n    },\n    \"ScryptedSystemDevice\": {\n        \"name\": \"ScryptedSystemDevice\",\n        \"methods\": [],\n        \"properties\": [\n            \"systemDevice\"\n        ]\n    },\n    \"ScryptedDeviceCreator\": {\n        \"name\": \"ScryptedDeviceCreator\",\n        \"methods\": [],\n        \"properties\": []\n    },\n    \"ScryptedSettings\": {\n        \"name\": \"ScryptedSettings\",\n        \"methods\": [],\n        \"properties\": []\n    }\n};\n/**\n * @category Core Reference\n */\nvar ScryptedDeviceType;\n(function (ScryptedDeviceType) {\n    /**\n     * @deprecated\n     */\n    ScryptedDeviceType[\"Builtin\"] = \"Builtin\";\n    /**\n     * Internal devices will not show up in device lists unless explicitly searched.\n     */\n    ScryptedDeviceType[\"Internal\"] = \"Internal\";\n    ScryptedDeviceType[\"Camera\"] = \"Camera\";\n    ScryptedDeviceType[\"Fan\"] = \"Fan\";\n    ScryptedDeviceType[\"Light\"] = \"Light\";\n    ScryptedDeviceType[\"Switch\"] = \"Switch\";\n    ScryptedDeviceType[\"Outlet\"] = \"Outlet\";\n    ScryptedDeviceType[\"Sensor\"] = \"Sensor\";\n    ScryptedDeviceType[\"Scene\"] = \"Scene\";\n    ScryptedDeviceType[\"Program\"] = \"Program\";\n    ScryptedDeviceType[\"Automation\"] = \"Automation\";\n    ScryptedDeviceType[\"Vacuum\"] = \"Vacuum\";\n    ScryptedDeviceType[\"Notifier\"] = \"Notifier\";\n    ScryptedDeviceType[\"Thermostat\"] = \"Thermostat\";\n    ScryptedDeviceType[\"Lock\"] = \"Lock\";\n    ScryptedDeviceType[\"PasswordControl\"] = \"PasswordControl\";\n    /**\n     * Displays have audio and video output.\n     */\n    ScryptedDeviceType[\"Display\"] = \"Display\";\n    /**\n     * Smart Displays have two way audio and video.\n     */\n    ScryptedDeviceType[\"SmartDisplay\"] = \"SmartDisplay\";\n    ScryptedDeviceType[\"Speaker\"] = \"Speaker\";\n    /**\n     * Smart Speakers have two way audio.\n     */\n    ScryptedDeviceType[\"SmartSpeaker\"] = \"SmartSpeaker\";\n    ScryptedDeviceType[\"RemoteDesktop\"] = \"RemoteDesktop\";\n    ScryptedDeviceType[\"Event\"] = \"Event\";\n    ScryptedDeviceType[\"Entry\"] = \"Entry\";\n    ScryptedDeviceType[\"Garage\"] = \"Garage\";\n    ScryptedDeviceType[\"DeviceProvider\"] = \"DeviceProvider\";\n    ScryptedDeviceType[\"DataSource\"] = \"DataSource\";\n    ScryptedDeviceType[\"API\"] = \"API\";\n    ScryptedDeviceType[\"Buttons\"] = \"Buttons\";\n    ScryptedDeviceType[\"Doorbell\"] = \"Doorbell\";\n    ScryptedDeviceType[\"Irrigation\"] = \"Irrigation\";\n    ScryptedDeviceType[\"Valve\"] = \"Valve\";\n    ScryptedDeviceType[\"Person\"] = \"Person\";\n    ScryptedDeviceType[\"SecuritySystem\"] = \"SecuritySystem\";\n    ScryptedDeviceType[\"WindowCovering\"] = \"WindowCovering\";\n    ScryptedDeviceType[\"Siren\"] = \"Siren\";\n    ScryptedDeviceType[\"AirPurifier\"] = \"AirPurifier\";\n    ScryptedDeviceType[\"Internet\"] = \"Internet\";\n    ScryptedDeviceType[\"Network\"] = \"Network\";\n    ScryptedDeviceType[\"Bridge\"] = \"Bridge\";\n    ScryptedDeviceType[\"LLM\"] = \"LLM\";\n    ScryptedDeviceType[\"Unknown\"] = \"Unknown\";\n})(ScryptedDeviceType || (exports.ScryptedDeviceType = ScryptedDeviceType = {}));\nvar HumidityMode;\n(function (HumidityMode) {\n    HumidityMode[\"Humidify\"] = \"Humidify\";\n    HumidityMode[\"Dehumidify\"] = \"Dehumidify\";\n    HumidityMode[\"Auto\"] = \"Auto\";\n    HumidityMode[\"Off\"] = \"Off\";\n})(HumidityMode || (exports.HumidityMode = HumidityMode = {}));\nvar FanMode;\n(function (FanMode) {\n    FanMode[\"Auto\"] = \"Auto\";\n    FanMode[\"Manual\"] = \"Manual\";\n})(FanMode || (exports.FanMode = FanMode = {}));\nvar TemperatureUnit;\n(function (TemperatureUnit) {\n    TemperatureUnit[\"C\"] = \"C\";\n    TemperatureUnit[\"F\"] = \"F\";\n})(TemperatureUnit || (exports.TemperatureUnit = TemperatureUnit = {}));\nvar ThermostatMode;\n(function (ThermostatMode) {\n    ThermostatMode[\"Off\"] = \"Off\";\n    ThermostatMode[\"Cool\"] = \"Cool\";\n    ThermostatMode[\"Heat\"] = \"Heat\";\n    ThermostatMode[\"HeatCool\"] = \"HeatCool\";\n    ThermostatMode[\"Auto\"] = \"Auto\";\n    ThermostatMode[\"FanOnly\"] = \"FanOnly\";\n    ThermostatMode[\"Purifier\"] = \"Purifier\";\n    ThermostatMode[\"Eco\"] = \"Eco\";\n    ThermostatMode[\"Dry\"] = \"Dry\";\n    ThermostatMode[\"On\"] = \"On\";\n})(ThermostatMode || (exports.ThermostatMode = ThermostatMode = {}));\nvar PanTiltZoomMovement;\n(function (PanTiltZoomMovement) {\n    PanTiltZoomMovement[\"Absolute\"] = \"Absolute\";\n    PanTiltZoomMovement[\"Relative\"] = \"Relative\";\n    PanTiltZoomMovement[\"Continuous\"] = \"Continuous\";\n    PanTiltZoomMovement[\"Preset\"] = \"Preset\";\n    PanTiltZoomMovement[\"Home\"] = \"Home\";\n})(PanTiltZoomMovement || (exports.PanTiltZoomMovement = PanTiltZoomMovement = {}));\nvar LockState;\n(function (LockState) {\n    LockState[\"Locked\"] = \"Locked\";\n    LockState[\"Unlocked\"] = \"Unlocked\";\n    LockState[\"Jammed\"] = \"Jammed\";\n})(LockState || (exports.LockState = LockState = {}));\nvar ChargeState;\n(function (ChargeState) {\n    ChargeState[\"Trickle\"] = \"trickle\";\n    ChargeState[\"Charging\"] = \"charging\";\n    ChargeState[\"NotCharging\"] = \"not-charging\";\n})(ChargeState || (exports.ChargeState = ChargeState = {}));\nvar AirPurifierStatus;\n(function (AirPurifierStatus) {\n    AirPurifierStatus[\"Inactive\"] = \"Inactive\";\n    AirPurifierStatus[\"Idle\"] = \"Idle\";\n    AirPurifierStatus[\"Active\"] = \"Active\";\n    AirPurifierStatus[\"ActiveNightMode\"] = \"ActiveNightMode\";\n})(AirPurifierStatus || (exports.AirPurifierStatus = AirPurifierStatus = {}));\nvar AirPurifierMode;\n(function (AirPurifierMode) {\n    AirPurifierMode[\"Manual\"] = \"Manual\";\n    AirPurifierMode[\"Automatic\"] = \"Automatic\";\n})(AirPurifierMode || (exports.AirPurifierMode = AirPurifierMode = {}));\nvar AirQuality;\n(function (AirQuality) {\n    AirQuality[\"Unknown\"] = \"Unknown\";\n    AirQuality[\"Excellent\"] = \"Excellent\";\n    AirQuality[\"Good\"] = \"Good\";\n    AirQuality[\"Fair\"] = \"Fair\";\n    AirQuality[\"Inferior\"] = \"Inferior\";\n    AirQuality[\"Poor\"] = \"Poor\";\n})(AirQuality || (exports.AirQuality = AirQuality = {}));\nvar SecuritySystemMode;\n(function (SecuritySystemMode) {\n    SecuritySystemMode[\"Disarmed\"] = \"Disarmed\";\n    SecuritySystemMode[\"HomeArmed\"] = \"HomeArmed\";\n    SecuritySystemMode[\"AwayArmed\"] = \"AwayArmed\";\n    SecuritySystemMode[\"NightArmed\"] = \"NightArmed\";\n})(SecuritySystemMode || (exports.SecuritySystemMode = SecuritySystemMode = {}));\nvar SecuritySystemObstruction;\n(function (SecuritySystemObstruction) {\n    SecuritySystemObstruction[\"Sensor\"] = \"Sensor\";\n    SecuritySystemObstruction[\"Occupied\"] = \"Occupied\";\n    SecuritySystemObstruction[\"Time\"] = \"Time\";\n    SecuritySystemObstruction[\"Error\"] = \"Error\";\n})(SecuritySystemObstruction || (exports.SecuritySystemObstruction = SecuritySystemObstruction = {}));\nvar MediaPlayerState;\n(function (MediaPlayerState) {\n    MediaPlayerState[\"Idle\"] = \"Idle\";\n    MediaPlayerState[\"Playing\"] = \"Playing\";\n    MediaPlayerState[\"Paused\"] = \"Paused\";\n    MediaPlayerState[\"Buffering\"] = \"Buffering\";\n})(MediaPlayerState || (exports.MediaPlayerState = MediaPlayerState = {}));\nvar ScryptedInterface;\n(function (ScryptedInterface) {\n    ScryptedInterface[\"ScryptedDevice\"] = \"ScryptedDevice\";\n    ScryptedInterface[\"ScryptedPlugin\"] = \"ScryptedPlugin\";\n    ScryptedInterface[\"ScryptedPluginRuntime\"] = \"ScryptedPluginRuntime\";\n    ScryptedInterface[\"OnOff\"] = \"OnOff\";\n    ScryptedInterface[\"Brightness\"] = \"Brightness\";\n    ScryptedInterface[\"ColorSettingTemperature\"] = \"ColorSettingTemperature\";\n    ScryptedInterface[\"ColorSettingRgb\"] = \"ColorSettingRgb\";\n    ScryptedInterface[\"ColorSettingHsv\"] = \"ColorSettingHsv\";\n    ScryptedInterface[\"Buttons\"] = \"Buttons\";\n    ScryptedInterface[\"PressButtons\"] = \"PressButtons\";\n    ScryptedInterface[\"Sensors\"] = \"Sensors\";\n    ScryptedInterface[\"Notifier\"] = \"Notifier\";\n    ScryptedInterface[\"StartStop\"] = \"StartStop\";\n    ScryptedInterface[\"Pause\"] = \"Pause\";\n    ScryptedInterface[\"Dock\"] = \"Dock\";\n    ScryptedInterface[\"TemperatureSetting\"] = \"TemperatureSetting\";\n    ScryptedInterface[\"Thermometer\"] = \"Thermometer\";\n    ScryptedInterface[\"HumiditySensor\"] = \"HumiditySensor\";\n    ScryptedInterface[\"Camera\"] = \"Camera\";\n    ScryptedInterface[\"Resolution\"] = \"Resolution\";\n    ScryptedInterface[\"Microphone\"] = \"Microphone\";\n    ScryptedInterface[\"AudioVolumeControl\"] = \"AudioVolumeControl\";\n    ScryptedInterface[\"Display\"] = \"Display\";\n    ScryptedInterface[\"VideoCamera\"] = \"VideoCamera\";\n    ScryptedInterface[\"VideoCameraMask\"] = \"VideoCameraMask\";\n    ScryptedInterface[\"VideoTextOverlays\"] = \"VideoTextOverlays\";\n    ScryptedInterface[\"VideoRecorder\"] = \"VideoRecorder\";\n    ScryptedInterface[\"VideoRecorderManagement\"] = \"VideoRecorderManagement\";\n    ScryptedInterface[\"PanTiltZoom\"] = \"PanTiltZoom\";\n    ScryptedInterface[\"EventRecorder\"] = \"EventRecorder\";\n    ScryptedInterface[\"VideoClips\"] = \"VideoClips\";\n    ScryptedInterface[\"VideoCameraConfiguration\"] = \"VideoCameraConfiguration\";\n    ScryptedInterface[\"Intercom\"] = \"Intercom\";\n    ScryptedInterface[\"Lock\"] = \"Lock\";\n    ScryptedInterface[\"PasswordStore\"] = \"PasswordStore\";\n    ScryptedInterface[\"Scene\"] = \"Scene\";\n    ScryptedInterface[\"Entry\"] = \"Entry\";\n    ScryptedInterface[\"EntrySensor\"] = \"EntrySensor\";\n    ScryptedInterface[\"DeviceProvider\"] = \"DeviceProvider\";\n    ScryptedInterface[\"DeviceDiscovery\"] = \"DeviceDiscovery\";\n    ScryptedInterface[\"DeviceCreator\"] = \"DeviceCreator\";\n    ScryptedInterface[\"Battery\"] = \"Battery\";\n    ScryptedInterface[\"Charger\"] = \"Charger\";\n    ScryptedInterface[\"Reboot\"] = \"Reboot\";\n    ScryptedInterface[\"Refresh\"] = \"Refresh\";\n    ScryptedInterface[\"MediaPlayer\"] = \"MediaPlayer\";\n    ScryptedInterface[\"Online\"] = \"Online\";\n    ScryptedInterface[\"BufferConverter\"] = \"BufferConverter\";\n    ScryptedInterface[\"MediaConverter\"] = \"MediaConverter\";\n    ScryptedInterface[\"Settings\"] = \"Settings\";\n    ScryptedInterface[\"BinarySensor\"] = \"BinarySensor\";\n    ScryptedInterface[\"TamperSensor\"] = \"TamperSensor\";\n    ScryptedInterface[\"Sleep\"] = \"Sleep\";\n    ScryptedInterface[\"PowerSensor\"] = \"PowerSensor\";\n    ScryptedInterface[\"AudioSensor\"] = \"AudioSensor\";\n    ScryptedInterface[\"MotionSensor\"] = \"MotionSensor\";\n    ScryptedInterface[\"AmbientLightSensor\"] = \"AmbientLightSensor\";\n    ScryptedInterface[\"OccupancySensor\"] = \"OccupancySensor\";\n    ScryptedInterface[\"FloodSensor\"] = \"FloodSensor\";\n    ScryptedInterface[\"UltravioletSensor\"] = \"UltravioletSensor\";\n    ScryptedInterface[\"LuminanceSensor\"] = \"LuminanceSensor\";\n    ScryptedInterface[\"PositionSensor\"] = \"PositionSensor\";\n    ScryptedInterface[\"SecuritySystem\"] = \"SecuritySystem\";\n    ScryptedInterface[\"PM10Sensor\"] = \"PM10Sensor\";\n    ScryptedInterface[\"PM25Sensor\"] = \"PM25Sensor\";\n    ScryptedInterface[\"VOCSensor\"] = \"VOCSensor\";\n    ScryptedInterface[\"NOXSensor\"] = \"NOXSensor\";\n    ScryptedInterface[\"CO2Sensor\"] = \"CO2Sensor\";\n    ScryptedInterface[\"AirQualitySensor\"] = \"AirQualitySensor\";\n    ScryptedInterface[\"AirPurifier\"] = \"AirPurifier\";\n    ScryptedInterface[\"FilterMaintenance\"] = \"FilterMaintenance\";\n    ScryptedInterface[\"Readme\"] = \"Readme\";\n    ScryptedInterface[\"OauthClient\"] = \"OauthClient\";\n    ScryptedInterface[\"MixinProvider\"] = \"MixinProvider\";\n    ScryptedInterface[\"HttpRequestHandler\"] = \"HttpRequestHandler\";\n    ScryptedInterface[\"EngineIOHandler\"] = \"EngineIOHandler\";\n    ScryptedInterface[\"PushHandler\"] = \"PushHandler\";\n    ScryptedInterface[\"Program\"] = \"Program\";\n    ScryptedInterface[\"Scriptable\"] = \"Scriptable\";\n    ScryptedInterface[\"ClusterForkInterface\"] = \"ClusterForkInterface\";\n    ScryptedInterface[\"ObjectDetector\"] = \"ObjectDetector\";\n    ScryptedInterface[\"ObjectDetection\"] = \"ObjectDetection\";\n    ScryptedInterface[\"ObjectDetectionPreview\"] = \"ObjectDetectionPreview\";\n    ScryptedInterface[\"ObjectDetectionGenerator\"] = \"ObjectDetectionGenerator\";\n    ScryptedInterface[\"HumiditySetting\"] = \"HumiditySetting\";\n    ScryptedInterface[\"Fan\"] = \"Fan\";\n    ScryptedInterface[\"RTCSignalingChannel\"] = \"RTCSignalingChannel\";\n    ScryptedInterface[\"RTCSignalingClient\"] = \"RTCSignalingClient\";\n    ScryptedInterface[\"LauncherApplication\"] = \"LauncherApplication\";\n    ScryptedInterface[\"ScryptedUser\"] = \"ScryptedUser\";\n    ScryptedInterface[\"VideoFrameGenerator\"] = \"VideoFrameGenerator\";\n    ScryptedInterface[\"StreamService\"] = \"StreamService\";\n    ScryptedInterface[\"TTY\"] = \"TTY\";\n    ScryptedInterface[\"TTYSettings\"] = \"TTYSettings\";\n    ScryptedInterface[\"ChatCompletion\"] = \"ChatCompletion\";\n    ScryptedInterface[\"TextEmbedding\"] = \"TextEmbedding\";\n    ScryptedInterface[\"ImageEmbedding\"] = \"ImageEmbedding\";\n    ScryptedInterface[\"LLMTools\"] = \"LLMTools\";\n    ScryptedInterface[\"ScryptedSystemDevice\"] = \"ScryptedSystemDevice\";\n    ScryptedInterface[\"ScryptedDeviceCreator\"] = \"ScryptedDeviceCreator\";\n    ScryptedInterface[\"ScryptedSettings\"] = \"ScryptedSettings\";\n})(ScryptedInterface || (exports.ScryptedInterface = ScryptedInterface = {}));\nvar ScryptedMimeTypes;\n(function (ScryptedMimeTypes) {\n    ScryptedMimeTypes[\"Url\"] = \"text/x-uri\";\n    ScryptedMimeTypes[\"InsecureLocalUrl\"] = \"text/x-insecure-local-uri\";\n    ScryptedMimeTypes[\"LocalUrl\"] = \"text/x-local-uri\";\n    ScryptedMimeTypes[\"ServerId\"] = \"text/x-server-id\";\n    ScryptedMimeTypes[\"PushEndpoint\"] = \"text/x-push-endpoint\";\n    ScryptedMimeTypes[\"SchemePrefix\"] = \"x-scrypted/x-scrypted-scheme-\";\n    ScryptedMimeTypes[\"MediaStreamUrl\"] = \"text/x-media-url\";\n    ScryptedMimeTypes[\"MediaObject\"] = \"x-scrypted/x-scrypted-media-object\";\n    ScryptedMimeTypes[\"RequestMediaObject\"] = \"x-scrypted/x-scrypted-request-media-object\";\n    ScryptedMimeTypes[\"RequestMediaStream\"] = \"x-scrypted/x-scrypted-request-stream\";\n    ScryptedMimeTypes[\"MediaStreamFeedback\"] = \"x-scrypted/x-media-stream-feedback\";\n    ScryptedMimeTypes[\"FFmpegInput\"] = \"x-scrypted/x-ffmpeg-input\";\n    ScryptedMimeTypes[\"FFmpegTranscodeStream\"] = \"x-scrypted/x-ffmpeg-transcode-stream\";\n    ScryptedMimeTypes[\"RTCSignalingChannel\"] = \"x-scrypted/x-scrypted-rtc-signaling-channel\";\n    ScryptedMimeTypes[\"RTCSignalingSession\"] = \"x-scrypted/x-scrypted-rtc-signaling-session\";\n    ScryptedMimeTypes[\"RTCConnectionManagement\"] = \"x-scrypted/x-scrypted-rtc-connection-management\";\n    ScryptedMimeTypes[\"Image\"] = \"x-scrypted/x-scrypted-image\";\n})(ScryptedMimeTypes || (exports.ScryptedMimeTypes = ScryptedMimeTypes = {}));\n//# sourceMappingURL=index.js.map","module.exports = require(\"fs\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(431);\n"],"names":["tty","util","exports","init","debug","inspectOpts","keys","Object","i","length","log","args","process","stderr","write","format","formatArgs","namespace","name","useColors","this","c","color","colorCode","prefix","split","join","push","module","humanize","diff","hideDate","Date","toISOString","getDate","save","namespaces","env","DEBUG","load","Boolean","colors","isatty","fd","destroy","deprecate","supportsColor","level","error","filter","key","test","reduce","obj","prop","substring","toLowerCase","replace","_","k","toUpperCase","val","Number","formatters","o","v","inspect","map","str","trim","O","parameters","resize","parseDims","width","get","height","crop","left","top","right","bottom","options","ret","fractional","percent","async","input","op","time","sourceId","cropFractional","filenameOrBuffer","Buffer","isBuffer","url","startsWith","fileURLToPath","loadSharp","vips","loadVipsImage","toBuffer","close","out","PassThrough","console","Console","printConsole","undefined","data","read","toString","deviceManager","getMixinConsole","ffmpegOpts","ffmpegPath","mediaManager","getFFmpegPath","timeout","ffmpegFilterImageBuffer","ffmpegInput","inputArguments","h264EncoderArguments","ffmpegFilterImage","e","dict","t","endsWith","parseFloat","webpackEmptyContext","req","Error","code","resolve","id","systemManager","cpus","find","cpu","model","includes","a","Agent","rejectUnauthorized","NeverWaitError","PrebufferUnavailableError","SnapshotMixin","SettingsMixinDeviceBase","plugin","storageSettings","StorageSettings","defaultSnapshotChannel","title","description","defaultValue","hide","mixinDeviceInterfaces","ScryptedInterface","Camera","onGet","psos","mixinDevice","getPictureOptions","choices","pso","snapshotUrl","placeholder","snapshotsFromPrebuffer","snapshotResolution","snapshotCropScale","type","snapshotAspectRatio","privacyMode","group","snapshotDebouncer","createMapPromiseDebouncer","errorPicture","timeoutPicture","progressPicture","prebufferUnavailablePicture","currentPicture","currentPictureTime","lastErrorImagesClear","static","lastAvailablePicture","constructor","super","debugConsole","takePictureInternal","eventSnapshot","values","promises","readFile","usePrebufferSnapshots","staleDuration","realDevice","getDeviceById","takePrebufferPicture","preparePrebufferSnapshot","msos","getVideoStreamOptions","prebufferChannel","mso","prebuffer","request","audio","refresh","convertMediaObjectToJSON","getVideoStream","ScryptedMimeTypes","FFmpegInput","takePicture","warn","retryWithPrebuffer","username","password","credential","Settings","settings","getSettings","setting","value","authHttpFetch","headers","body","takePictureOptions","Sleep","sleeping","then","mo","convertMediaObjectToBuffer","takePictureRaw","reason","periodicSnapshot","hoursDuration","now","debounced","event","snapshotTimer","picture","cropAndScale","clearCachedPictures","pictureTime","catch","rawPicture","availablePicture","availablePictureTime","pictureTimeout","allowedSnapshotStaleness","timeoutPromise","createErrorImage","aspectRatio","needSoftwareResize","resolutionWidth","resolutionHeight","constrained","originalWidth","originalHeight","targetAspectRatio","Math","round","resolution","resizeOptions","createMediaObject","clipPath","fixLegacyClipPath","xmin","min","x","y","ymin","xmax","max","ymax","clearErrorImages","maybeClearErrorImages","lastGeneratedErrorImageTime","TimeoutError","singletonPromise","createTextErrorImage","promise","text","errorBackground","pluginVolume","SCRYPTED_PLUGIN_VOLUME","unzippedFs","fontFile","blur","brightness","getMixinSettings","putMixinSetting","putSetting","SnapshotPlugin","AutoenableMixinProvider","debugLogging","mixinDevices","Map","authenticatedPath","endpointManager","getAuthenticatedPath","nativeId","fromMimeType","SchemePrefix","toMimeType","LocalUrl","manifest","devices","interfaces","BufferConverter","ScryptedDeviceType","Internal","ImageWriterNativeId","ImageConverterNativeId","ImageReaderNativeId","nextTick","onDevicesChanged","getDevice","ImageConverter","ImageWriter","ImageReader","releaseDevice","getLocalSnapshot","iface","search","endpoint","from","convert","URL","hostname","path","pathname","VideoCamera","onRequest","response","isPublicEndpoint","send","rootPath","URLSearchParams","mixin","buffer","parseInt","isNaN","rpo","device","canMixin","Doorbell","Resolution","getMixin","mixinDeviceState","mixinProviderNativeId","groupKey","set","shouldEnableMixin","releaseMixin","delete","release","rp","method","cacheDuration","finally","setTimeout","Promise","reject","clearTimeout","f","isTimedOut","current","func","debounce","keyStr","JSON","stringify","require","createAuthFetch","httpFetch","httpFetchParseIncomingMessage","videoArgs","videoFilter","filterName","filterIndex","findIndex","ownKeys","__createBinding","create","m","k2","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","defineProperty","__setModuleDefault","__importStar","getOwnPropertyNames","ar","prototype","hasOwnProperty","call","mod","result","_1","default","hasValue","rawGet","getItem","parse","storage","entries","s","assign","getItemInternal","deviceFilter","onPut","mapPut","mapGet","oldValue","putSettingInternal","noStore","removeItem","setItem","onDeviceEvent","rawDevice","readDefaultValue","multiple","n","json","parseValue","persistedDefaultValue","browser","__nwjs","MixinDeviceBase","settingsGroup","settingsGroupKey","onMixinEvent","settingsPromise","mixinSettingsPromise","allSettings","random","readonly","mixinSettings","getDeviceState","ScryptedDeviceBase","mime","parseImageOp","processImageOp","params","wrappedErrors","errorCode","Array","concat","captureStackTrace","wrap","err","wrappedErrorIsACode","_looksLikeAYErrorCode","message","cast","_looksLikeAYError","bump","stack","KEYVALUE_REGEXP","parseHTTPHeadersQuotedKeyValueSet","contents","authorizedKeys","requiredKeys","valuesToNormalize","matches","match","part","partPosition","rest","parsedValues","valuePosition","normalizedName","indexOf","strippedValue","_checkRequiredKeys","buildHTTPHeadersQuotedKeyValueSet","forEach","REQUIRED_WWW_AUTHENTICATE_KEYS","AUTHORIZED_WWW_AUTHENTICATE_KEYS","BASIC","parseWWWAuthenticateRest","buildWWWAuthenticateRest","parseAuthorizationRest","decodeHash","hash","buildAuthorizationRest","computeHash","passwordParts","CASE_INSENSITIVE_WWW_AUTHENTICATE_VALUES","REQUIRED_AUTHORIZATION_KEYS","AUTHORIZED_AUTHORIZATION_KEYS","DIGEST","ha1","_computeHash","algorithm","realm","ha2","uri","nonce","nc","cnonce","qop","hashsum","update","digest","AUTHORIZED_ERROR_CODES","BEARER","mechanisms","parseWWWAuthenticateHeader","header","authMechanisms","strict","some","authMechanism","substr","buildAuthorizationHeader","removeLeadingAndTrailingHTTPWhitespace","string","removeTrailingHTTPWhitespace","isHTTPWhitespaceChar","char","solelyContainsHTTPTokenCodePoints","soleyContainsHTTPQuotedStringTokenCodePoints","asciiLowercase","l","collectAnHTTPQuotedString","position","quoteOrBackslash","__exportStar","p","__importDefault","sdk","fs_1","index_1","DeviceBase","_storage","getDeviceStorage","_log","getDeviceLogger","_console","getDeviceConsole","mimeType","getMediaObjectConsole","mediaObject","_lazyLoadDeviceState","_deviceState","eventInterface","eventData","_listeners","Set","mixinStorageSuffix","__rpcproxy_traps_all_properties","createDeviceState","setState","mixinStorageKey","getMixinStorage","manageListener","listener","add","removeListener","_createGetState","state","_createSetState","field","ScryptedInterfaceProperty","loaded","SCRYPTED_SDK_ES_MODULE","SCRYPTED_SDK_MODULE","cjsModule","SCRYPTED_SDK_CJS_MODULE","sdkModule","getScryptedStatic","runtimeAPI","pluginRuntimeAPI","pluginHostAPI","descriptors","ScryptedInterfaceDescriptors","customDescriptors","readFileSync","interfaceDescriptors","setScryptedInterfaceDescriptors","TYPES_VERSION","autoIncludeToken","hasEnabledMixin","pluginsComponent","getComponent","listen","eventSource","eventDetails","ScryptedDevice","property","maybeEnableMixin","getSystemState","checkHasEnabledMixin","shouldUnshiftMixin","mixins","slice","unshift","plugins","setMixins","setHasEnabledMixin","cp","exitCode","on","stdin","sleep","stdio","kill","forever","SCRYPTED_FFMPEG_NOISY","logger","filtered","stdout","redactNext","arg","protocol","safeKillFFmpeg","ffmpegLogInitialOutput","safePrintFFmpegArguments","inputJpeg","ffmpegCreateOutputArguments","defaultFfmpegImageArgs","spawn","end","ffmpegFilterImageInternal","outputArguments","ffmpegFilterImageStream","addVideoFilterArguments","buffers","timeoutFunction","exit","once","spawnargs","pipe","Pipe2Jpeg","last","jpeg","any","h","parser","getFetchMethod","createHeadersArray","setDefaultHttpFetchAccept","responseType","initialHeader","getAuth","hasHeader","setHeader","controller","AbortController","signal","addEventListener","abort","initialResponse","checkStatusCode","statusCode","checkStatus","authenticateHeaders","parsedHeaders","basic","count","floor","parsedURL","sharp","serialization","subtype","size","looksLikeNode","looksLikeBrowser","looksLikeV8","http","https","Writable","assert","window","document","isFunction","useNativeURL","preservedUrlFields","events","eventHandlers","arg1","arg2","arg3","_redirectable","emit","InvalidUrlError","createErrorType","TypeError","RedirectionError","TooManyRedirectsError","MaxBodyLengthExceededError","WriteAfterEndError","noop","RedirectableRequest","responseCallback","_sanitizeOptions","_options","_ended","_ending","_redirectCount","_redirects","_requestBodyLength","_requestBodyBuffers","self","_onNativeResponse","_processResponse","cause","_performRequest","protocols","maxRedirects","maxBodyLength","nativeProtocols","scheme","nativeProtocol","wrappedProtocol","defineProperties","callback","spreadUrlObject","isString","parseUrl","validateUrl","host","equal","wrappedRequest","parsed","href","urlObject","target","spread","port","removeMatchingHeaders","regex","lastValue","String","baseClass","CustomError","properties","destroyRequest","_currentRequest","encoding","currentRequest","removeHeader","msecs","destroyOnTimeout","socket","addListener","startTimer","_timeout","clearTimer","b","searchPos","agents","agent","_currentUrl","_isRedirect","writeNext","finished","trackRedirects","requestHeaders","location","followRedirects","responseUrl","redirects","beforeRedirect","Host","getHeader","relative","base","currentHostHeader","currentUrlParts","currentHost","currentUrl","redirectUrl","subdomain","domain","dot","isSubdomain","responseDetails","requestDetails","lineIntersects","x1","y1","x2","y2","x3","y3","x4","y4","denom","ua","ub","pointInPolygon","polygon","inside","j","xi","yi","xj","yj","boundingBoxToPoints","w","boundingBox","boxPoints","nextI","polygonPoint1","polygonPoint2","nextJ","every","point","box","dims","needNormalize","abs","ms","MIMETypeParameters","serialize","_type","_subtype","_parameters","essence","isJavaScript","prohibitParameters","isXML","isHTML","d","plural","msAbs","isPlural","exec","isFinite","long","fmtLong","fmtShort","createDebug","prevTime","namespacesCache","enabledCache","enableOverride","enabled","curr","prev","coerce","index","formatter","splice","apply","selectColor","extend","delimiter","newDebug","toNamespace","regexp","disable","names","skips","enable","len","RegExp","charCodeAt","parameterName","parameterValue","has","Image","sharpInstance","hasLoadedSharp","createVipsMediaObject","image","toImage","toVipsImage","VipsImage","metadata","toImageInternal","transformed","clone","extract","kernel","fit","removeAlpha","toFormat","ensureAlpha","grayscale","info","raw","resolveWithObject","newImage","newMetadata","loadVipsMetadata","failOn","_SOI","_EOI","Transform","_chunks","_size","_jpeg","_sendJpeg","_transform","chunk","chunkLength","pos","eoi","sliced","soi","arguments","_map","clear","callbackFn","thisArg","Symbol","iterator","Readable","proto","newBody","createStringOrBufferBody","nodeHeaders","family","checker","readMessageBuffer","incomingHeaders","Headers","vv","append","TextParser","JSONParser","BufferParser","StreamParser","getHttpFetchParser","readable","fetchStatusCodeOk","getHttpFetchAccept","filteredHeaders","headerKey","accept","headersArray","contentType","domFetchParseIncomingMessage","Uint8Array","arrayBuffer","ReadableStream","fetch","credentials","withCredentials","status","lastC","r","navigator","userAgent","documentElement","style","WebkitAppearance","firebug","exception","table","$1","localStorage","localstorage","warned","MediaPlayerState","SecuritySystemObstruction","SecuritySystemMode","AirQuality","AirPurifierMode","AirPurifierStatus","ChargeState","LockState","PanTiltZoomMovement","ThermostatMode","TemperatureUnit","FanMode","HumidityMode","ScryptedInterfaceMethod","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","definition","__webpack_exports__"],"sourceRoot":""}