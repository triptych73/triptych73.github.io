(()=>{var e={148:(e,t,r)=>{const i=r(2018),n=r(9023);t.init=function(e){e.inspectOpts={};const r=Object.keys(t.inspectOpts);for(let i=0;i<r.length;i++)e.inspectOpts[r[i]]=t.inspectOpts[r[i]]},t.log=function(...e){return process.stderr.write(n.format(...e)+"\n")},t.formatArgs=function(r){const{namespace:i,useColors:n}=this;if(n){const t=this.color,n="[3"+(t<8?t:"8;5;"+t),s=`  ${n};1m${i} [0m`;r[0]=s+r[0].split("\n").join("\n"+s),r.push(n+"m+"+e.exports.humanize(this.diff)+"[0m")}else r[0]=function(){if(t.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+i+" "+r[0]},t.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},t.load=function(){return process.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):i.isatty(process.stderr.fd)},t.destroy=n.deprecate((()=>{}),"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{const e=r(Object(function(){var e=new Error("Cannot find module 'supports-color'");throw e.code="MODULE_NOT_FOUND",e}()));e&&(e.stderr||e).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}t.inspectOpts=Object.keys(process.env).filter((e=>/^debug_/i.test(e))).reduce(((e,t)=>{const r=t.substring(6).toLowerCase().replace(/_([a-z])/g,((e,t)=>t.toUpperCase()));let i=process.env[t];return i=!!/^(yes|on|true|enabled)$/i.test(i)||!/^(no|off|false|disabled)$/i.test(i)&&("null"===i?null:Number(i)),e[r]=i,e}),{}),e.exports=r(5729)(t);const{formatters:s}=e.exports;s.o=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts).split("\n").map((e=>e.trim())).join(" ")},s.O=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts)}},167:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parseDims=d,t.parseImageOp=function(e){return{resize:d({width:e.get("width"),height:e.get("height")}),crop:d({left:e.get("left"),top:e.get("top"),right:e.get("right"),bottom:e.get("bottom")})}},t.toImageOp=function(e){const t={},{resize:r,crop:i}=e||{};r&&(t.resize={width:r.width,height:r.height,fractional:r.percent});i&&(t.crop={left:i.left,top:i.top,right:i.left+i.width,bottom:i.top+i.height,fractional:i.percent});return t},t.processImageOp=async function(e,t,r,i,d){const{crop:p,resize:l}=t,{width:h,height:m,fractional:g}=l||{},{left:f,top:y,right:v,bottom:S,fractional:b}=p||{},C="string"==typeof e||Buffer.isBuffer(e)?e:e.url?.startsWith("file:")&&a.default.fileURLToPath(e.url);if(C&&(0,u.loadSharp)()){const e=await(0,u.loadVipsImage)(C,i),t=(null!=h||null!=m)&&{width:h,height:m};g&&(t.width&&(t.width*=e.width),t.height&&(t.height*=e.height));const r=null!=f&&{left:f,top:y,width:v-f,height:S-y};b&&(r.left*=e.width,r.top*=e.height,r.width*=e.width,r.height*=e.height);try{return await e.toBuffer({resize:t,crop:r,format:"jpg"})}finally{e.close()}}const w=new o.PassThrough;let P=new s.Console(w,w);const _=()=>{if(!P)return;P=void 0;const e=w.read().toString();n.default.deviceManager.getMixinConsole(i).log(e)},I={console:P,ffmpegPath:await n.default.mediaManager.getFFmpegPath(),resize:void 0===h&&void 0===m?void 0:{width:h,height:m,fractional:g},crop:void 0===f||void 0===v||void 0===y||void 0===S?void 0:{left:f,top:y,width:v-f,height:S-y,fractional:b},timeout:1e4,time:r};try{if(Buffer.isBuffer(e))return await(0,c.ffmpegFilterImageBuffer)(e,I);const t="string"!=typeof e?e:{inputArguments:["-i",e]},r=[...t.inputArguments,...t.h264EncoderArguments||[]];return await(0,c.ffmpegFilterImage)(r,I)}catch(e){throw _(),e}finally{d&&_()}};const n=i(r(2743)),s=r(4236),o=r(2203),a=i(r(7016)),c=r(3674),u=r(6893);function d(e){const t={};for(const r of Object.keys(e)){const i=e[r];i?.endsWith("%")?(t.fractional=!0,t[r]=parseFloat(i?.substring(0,i?.length-1))/100):t[r]=i?parseFloat(i):void 0}return t}},394:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=394,e.exports=t},431:function(e,t,r){"use strict";var i,n=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},i(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=i(e),o=0;o<r.length;o++)"default"!==r[o]&&n(t,e,r[o]);return s(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SnapshotPlugin=void 0;const c=r(2889),u=r(1251),d=r(488),p=r(1854),l=o(r(2743)),h=r(1414),m=a(r(9896)),g=a(r(5692)),f=a(r(857)),y=a(r(6928)),v=a(r(7016)),S=r(4204),b=r(3674),C=r(1952),w=r(6893),P=r(6605),{mediaManager:_,systemManager:I}=l.default;f.default.cpus().find((e=>e.model?.toLowerCase().includes("qemu")))&&l.default.log.a("QEMU CPU detected. Set your CPU model to host.");new g.default.Agent({rejectUnauthorized:!1});class M extends Error{}class T extends Error{}class x extends p.SettingsMixinDeviceBase{plugin;storageSettings=new h.StorageSettings(this,{defaultSnapshotChannel:{title:"Default Snapshot Channel",description:"The default channel to use for snapshots.",defaultValue:"Camera Default",hide:!this.mixinDeviceInterfaces.includes(l.ScryptedInterface.Camera),onGet:async()=>{if(!this.mixinDeviceInterfaces.includes(l.ScryptedInterface.Camera))return{hide:!0};let e;try{e=await this.mixinDevice.getPictureOptions()}catch(e){}return e?.length?{hide:!1,choices:["Camera Default",...e.map((e=>e.name))]}:{hide:!0}}},snapshotUrl:{title:this.mixinDeviceInterfaces.includes(l.ScryptedInterface.Camera)?"Override Snapshot URL":"Snapshot URL",description:(this.mixinDeviceInterfaces.includes(l.ScryptedInterface.Camera)?"Optional: ":"")+"The http(s) URL that retrieves a jpeg image from your camera.",placeholder:"https://ip:1234/cgi-bin/snapshot.jpg"},snapshotsFromPrebuffer:{title:"Snapshots from Prebuffer",description:"Prefer snapshots from the Rebroadcast Plugin prebuffer when available. This setting uses considerable CPU to convert a video stream into a snapshot. The Default setting will use the camera snapshot and fall back to prebuffer on failure.",choices:["Default","Enabled","Disabled"],defaultValue:"Default"},snapshotResolution:{title:"Snapshot Resolution",description:"Set resolution of the snapshots requested from the camera.",choices:["Default","Full Resolution","Requested Resolution"],defaultValue:"Default",hide:!this.mixinDeviceInterfaces.includes(l.ScryptedInterface.Camera)},snapshotCropScale:{title:"Crop and Scale",description:"Set the approximate region to crop and scale to 16:9 snapshots.",type:"clippath"},snapshotAspectRatio:{title:"Snapshot Aspect Ratio",description:"Override the aspect ratio for snapshots (e.g., 1.777 for 16:9). Images from the camera will be resized to this aspect ratio.",type:"number",placeholder:"1.777"},privacyMode:{group:"Privacy",title:"Disable Snapshot",description:"Disable this camera's snapshot to all services provided by Scrypted.",type:"boolean"}});snapshotDebouncer=(0,d.createMapPromiseDebouncer)();errorPicture;timeoutPicture;progressPicture;prebufferUnavailablePicture;currentPicture;currentPictureTime=0;lastErrorImagesClear=0;static lastGeneratedErrorImageTime=0;lastAvailablePicture;psos;constructor(e,t){super(t),this.plugin=e}get debugConsole(){if(this.plugin.debugConsole)return this.console}async takePictureInternal(e,t){if(this.debugConsole?.log("Picture requested from camera",{id:e,eventSnapshot:t}),this.storageSettings.values.privacyMode)return await m.default.promises.readFile("camera-slash.jpg");const{snapshotsFromPrebuffer:r}=this.storageSettings.values;let i;switch(r){case"true":case"Enabled":i=!0;break;case"Disabled":i=!1;break;default:this.mixinDeviceInterfaces.includes(l.ScryptedInterface.Camera)||this.storageSettings.values.snapshotUrl||(i=!0)}if(t&&!1!==i)try{const e=await this.getPictureOptions();e?.[0]?.staleDuration&&(i=!0)}catch(e){}const n=I.getDeviceById(this.id);let s;const o=async()=>{if(s)return s;const e=await n.getVideoStreamOptions();let r=e?.find((e=>e.prebuffer));if(r||!this.lastAvailablePicture){r=r||{id:void 0};const e=r;return e.audio=null,e.prebuffer=t?1e3:6e3,this.lastAvailablePicture&&(e.refresh=!1),s=async()=>{const t=await l.default.mediaManager.convertMediaObjectToJSON(await n.getVideoStream(e),l.ScryptedMimeTypes.FFmpegInput);return(0,b.ffmpegFilterImage)(t.inputArguments,{console:this.debugConsole,ffmpegPath:await _.getFFmpegPath(),timeout:1e4})},s}};if(i){const e=await o();if(!e)throw this.debugConsole?.warn("Prebuffer snapshot was requested but prebuffer is unavailable."),new T;return e()}const a=async e=>{if(!1===i)throw e;const t=await o();if(!t)throw e;return this.console.error("Snapshot failed, falling back to prebuffer",e),t()};if(this.storageSettings.values.snapshotUrl){let e,t,r;if(this.mixinDeviceInterfaces.includes(l.ScryptedInterface.Settings)){const r=await this.mixinDevice.getSettings();e=r?.find((e=>"username"===e.key))?.value?.toString(),t=r?.find((e=>"password"===e.key))?.value?.toString()}e&&t&&(r={username:e,password:t});try{return(await(0,u.authHttpFetch)({rejectUnauthorized:!1,url:this.storageSettings.values.snapshotUrl,credential:r,timeout:6e4,headers:{Accept:"image/*"}})).body}catch(e){return a(e)}}if(this.mixinDeviceInterfaces.includes(l.ScryptedInterface.Camera)){let r;if(!e&&"Camera Default"!==this.storageSettings.values.defaultSnapshotChannel)try{const e=(await this.getPictureOptions()).find((e=>e.name===this.storageSettings.values.defaultSnapshotChannel));r={id:e?.id}}catch(e){}try{return!t&&this.mixinDeviceInterfaces.includes(l.ScryptedInterface.Sleep)&&n.sleeping?(this.console.log("Not waking sleeping camera for periodic snapshot."),this.lastAvailablePicture):await this.mixinDevice.takePicture(r).then((e=>_.convertMediaObjectToBuffer(e,"image/jpeg")))}catch(e){return a(e)}}throw new Error("Snapshot Unavailable (Snapshot URL empty)")}async takePictureRaw(e){const t="event"===e?.reason,r="periodic"===e?.reason,i=this.mixinDeviceInterfaces.includes(l.ScryptedInterface.Sleep)?5:1;this.currentPictureTime<Date.now()-60*i*60*1e3&&(this.currentPicture=void 0);const n=this.snapshotDebouncer({id:e?.id,type:"source",event:"event"===e?.reason},t?0:4e3,(async()=>{const e=Date.now();let r=await this.takePictureInternal(void 0,t);r=await this.cropAndScale(r),this.clearCachedPictures();const i=Date.now();return this.currentPicture=r,this.currentPictureTime=i,this.lastAvailablePicture=r,this.debugConsole?.debug(`Periodic snapshot took ${(this.currentPictureTime-e)/1e3} seconds to retrieve.`),{picture:r,pictureTime:i}}));n.catch((()=>{}));let s,o=this.currentPicture,a=this.currentPictureTime;try{let i=e?.timeout;if(!i){const e=t?0:r?2e4:1e4;i=o?a>Date.now()-3e3?1e3:a>Date.now()-e?3e3:1e4:1e4}s=await(0,d.timeoutPromise)(i,n)}catch(e){if(t)throw e;if(this.currentPicture&&(o=this.currentPicture,a=this.currentPictureTime),!o)return this.createErrorImage(e);this.console.warn("Snapshot failed, but recovered from cache",e),s={picture:o,pictureTime:a},o=void 0}const c=this.storageSettings.values.snapshotAspectRatio;if(!(!(!e?.picture?.width&&!e?.picture?.height)&&"Full Resolution"!==this.storageSettings.values.snapshotResolution||c))return s.picture;try{const t={type:"resize",pictureTime:s.pictureTime,needSoftwareResize:!0,picture:e.picture};return(await this.snapshotDebouncer(t,1e4,(async()=>{if(this.debugConsole?.log("Resizing picture from camera",t),(0,w.loadSharp)()){const t=await(0,w.loadVipsImage)(s.picture,this.id);let o=t.width,a=t.height;if(c){const e=(r=t.width,i=t.height,r/i>(n=c)?{width:Math.round(i*n),height:i}:{width:r,height:Math.round(r/n)});o=e.width,a=e.height}this.resolution?.[0]===o&&this.resolution?.[1]===a||(this.resolution=[o,a]);let u=e?.picture;if(c){u||={};const{width:e,height:t}=u;e||t?e?t||(u={...u,height:Math.round(u.width/c)}):u={...u,width:Math.round(u.height*c)}:u={...u,width:o,height:a}}try{return{picture:await t.toBuffer({resize:u,format:"jpg"}),pictureTime:s.pictureTime}}finally{t.close()}}var r,i,n;return{picture:await(0,b.ffmpegFilterImageBuffer)(s.picture,{console:this.debugConsole,ffmpegPath:await _.getFFmpegPath(),resize:e?.picture,timeout:1e4}),pictureTime:s.pictureTime}}))).picture}catch(e){if(t)throw e;return this.createErrorImage(e)}}async takePicture(e){return this.createMediaObject(await this.takePictureRaw(e),"image/jpeg")}async cropAndScale(e){if(!this.storageSettings.values.snapshotCropScale?.length)return e;const t=(0,S.fixLegacyClipPath)(this.storageSettings.values.snapshotCropScale),r=Math.min(...t.map((([e,t])=>e))),i=Math.min(...t.map((([e,t])=>t))),n=Math.max(...t.map((([e,t])=>e))),s=Math.max(...t.map((([e,t])=>t)));if((0,w.loadSharp)()){const t=await(0,w.loadVipsImage)(e,this.id);try{return await t.toBuffer({crop:{left:r*t.width,top:i*t.height,width:(n-r)*t.width,height:(s-i)*t.height},format:"jpg"})}finally{t.close()}}return(0,b.ffmpegFilterImageBuffer)(e,{console:this.debugConsole,ffmpegPath:await _.getFFmpegPath(),crop:{fractional:!0,left:r,top:i,width:n-r,height:s-i},timeout:1e4})}clearErrorImages(){this.errorPicture=void 0,this.timeoutPicture=void 0,this.progressPicture=void 0,this.prebufferUnavailablePicture=void 0}clearCachedPictures(){this.lastAvailablePicture||this.clearErrorImages(),this.currentPicture=void 0}maybeClearErrorImages(){const e=Date.now();e-this.lastErrorImagesClear>36e5||e-x.lastGeneratedErrorImageTime<6e4||(x.lastGeneratedErrorImageTime=e,this.lastErrorImagesClear=e,this.clearErrorImages())}async createErrorImage(e){return this.maybeClearErrorImages(),e instanceof d.TimeoutError?(this.timeoutPicture=(0,d.singletonPromise)(this.timeoutPicture,(()=>this.createTextErrorImage("Snapshot Timed Out"))),this.timeoutPicture.promise):e instanceof T?(this.prebufferUnavailablePicture=(0,d.singletonPromise)(this.prebufferUnavailablePicture,(()=>this.createTextErrorImage("Snapshot Unavailable"))),this.prebufferUnavailablePicture.promise):e instanceof M?(this.progressPicture=(0,d.singletonPromise)(this.progressPicture,(()=>this.createTextErrorImage("Snapshot In Progress"))),this.progressPicture.promise):(this.console.error("Snapshot failed",e),this.errorPicture=(0,d.singletonPromise)(this.errorPicture,(()=>this.createTextErrorImage("Snapshot Failed"))),this.errorPicture.promise)}async createTextErrorImage(e){const t=this.currentPicture||this.lastAvailablePicture;this.console.log("creating error image with background",e,!!t);const r=process.env.SCRYPTED_PLUGIN_VOLUME,i=y.default.join(r,"zip/unzipped/fs"),n=y.default.join(i,"Lato-Bold.ttf");return t?(0,b.ffmpegFilterImageBuffer)(t,{console:this.debugConsole,ffmpegPath:await _.getFFmpegPath(),blur:!0,brightness:-.2,text:{fontFile:n,text:e},timeout:1e4}):(0,b.ffmpegFilterImage)(["-f","lavfi","-i","color=black:size=1920x1080"],{console:this.debugConsole,ffmpegPath:await _.getFFmpegPath(),text:{fontFile:n,text:e},timeout:1e4})}async getPictureOptions(){return this.psos||(this.psos=await this.mixinDevice.getPictureOptions()),this.psos}getMixinSettings(){return this.storageSettings.getSettings()}putMixinSetting(e,t){return this.storageSettings.putSetting(e,t)}}class O extends c.AutoenableMixinProvider{storageSettings=new h.StorageSettings(this,{debugLogging:{title:"Debug Logging",description:"Debug logging for all cameras will be shown in the Snapshot Plugin Console.",type:"boolean"}});mixinDevices=new Map;authenticatedPath=l.default.endpointManager.getAuthenticatedPath(this.nativeId);constructor(e){super(e),this.fromMimeType=l.ScryptedMimeTypes.SchemePrefix+"scrypted-media;converter-weight=0",this.toMimeType=l.ScryptedMimeTypes.LocalUrl;const t={devices:[{name:"Image Writer",interfaces:[l.ScryptedInterface.BufferConverter],type:l.ScryptedDeviceType.Internal,nativeId:P.ImageWriterNativeId},{name:"Image Converter",interfaces:[l.ScryptedInterface.BufferConverter],type:l.ScryptedDeviceType.Internal,nativeId:C.ImageConverterNativeId}]};(0,w.loadSharp)()&&t.devices.push({name:"Image Reader",interfaces:[l.ScryptedInterface.BufferConverter],type:l.ScryptedDeviceType.Internal,nativeId:w.ImageReaderNativeId}),process.nextTick((()=>{l.default.deviceManager.onDevicesChanged(t)}))}async getDevice(e){return e===C.ImageConverterNativeId?new C.ImageConverter(this,C.ImageConverterNativeId):e===P.ImageWriterNativeId?new P.ImageWriter(P.ImageWriterNativeId):e===w.ImageReaderNativeId?new w.ImageReader(w.ImageReaderNativeId):void 0}async releaseDevice(e,t){}getSettings(){return this.storageSettings.getSettings()}putSetting(e,t){return this.storageSettings.putSetting(e,t)}get debugConsole(){if(this.storageSettings.values.debugLogging)return this.console}async getLocalSnapshot(e,t,r){const i=await this.authenticatedPath,n=v.default.resolve(y.default.join(i,"hotlink-ok",e,t,`${Date.now()}.jpg`)+`${r}`,"");return Buffer.from(n)}async convert(e,t,r,i){const n=new URL(e.toString()),s=n.hostname,o=n.pathname.split("/")[1];if(o===l.ScryptedInterface.Camera)return this.getLocalSnapshot(s,o,n.search);if(o===l.ScryptedInterface.VideoCamera)return this.getLocalSnapshot(s,o,n.search);throw new Error("Unrecognized Scrypted Media interface.")}async onRequest(e,t){if(e.isPublicEndpoint)return void t.send("",{code:404});let r=e.url.substring(e.rootPath.length);r.startsWith("/hotlink-ok")&&(r=r.substring(11));const[i,n,s]=r.split("/");try{if(s!==l.ScryptedInterface.Camera&&s!==l.ScryptedInterface.VideoCamera)throw new Error;const e=new URLSearchParams(r.split("?")[1]),i=this.mixinDevices.get(n);let o,a=parseInt(e.get("timeout"));isNaN(a)&&(a=5e3);const c={reason:e.get("reason"),timeout:a,picture:{width:parseInt(e.get("width"))||void 0,height:parseInt(e.get("height"))||void 0}};if("Full Resolution"===i?.storageSettings.values.snapshotResolution&&delete c.picture,i&&s===l.ScryptedInterface.Camera)o=await i.takePictureRaw(c);else{const e=I.getDeviceById(n),t=s===l.ScryptedInterface.Camera?await e.takePicture(c):await e.getVideoStream();o=await _.convertMediaObjectToBuffer(t,"image/jpeg")}t.send(o,{headers:{"Content-Type":"image/jpeg","Cache-Control":"max-age=10"}})}catch(e){this.debugConsole?.error("snapshot http request failed",e),t.send("",{code:500})}}async canMixin(e,t){if((e===l.ScryptedDeviceType.Camera||e===l.ScryptedDeviceType.Doorbell)&&t.includes(l.ScryptedInterface.VideoCamera))return[l.ScryptedInterface.Camera,l.ScryptedInterface.Settings,l.ScryptedInterface.Resolution]}async getMixin(e,t,r){const i=new x(this,{mixinDevice:e,mixinDeviceInterfaces:t,mixinDeviceState:r,mixinProviderNativeId:this.nativeId,group:"Snapshot",groupKey:"snapshot"});return this.mixinDevices.set(i.id,i),i}async shouldEnableMixin(e){const{type:t,interfaces:r}=e;return!(t!==l.ScryptedDeviceType.Camera&&t!==l.ScryptedDeviceType.Doorbell||!r.includes(l.ScryptedInterface.VideoCamera))}async releaseMixin(e,t){this.mixinDevices.get(e)===t&&this.mixinDevices.delete(e),await t.release()}}t.SnapshotPlugin=O,t.default=O},488:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeoutError=void 0,t.singletonPromise=function(e,t,r=0){if(e?.promise)return e;const i=t();e?e.promise=i:e={promise:i,cacheDuration:r};return i.finally((()=>setTimeout((()=>e.promise=void 0),e.cacheDuration))),e},t.timeoutPromise=function(e,t){return new Promise(((i,n)=>{const s=setTimeout((()=>n(new r(t))),e);t.then((e=>{clearTimeout(s),i(e)})).catch((e=>{clearTimeout(s),n(e)}))}))},t.timeoutFunction=function(e,t){return new Promise(((i,n)=>{let s=!1;const o=t((()=>s)),a=setTimeout((()=>{s=!0,n(new r(o))}),e);o.then((e=>{clearTimeout(a),i(e)})).catch((e=>{clearTimeout(a),n(e)}))}))},t.createPromiseDebouncer=function(){let e;return t=>(e||(e=t().finally((()=>e=void 0))),e)},t.createMapPromiseDebouncer=function(){const e=new Map;return(t,r,i)=>{const n=JSON.stringify(t);let s=e.get(n);return s||(s=i().finally((()=>{r?setTimeout((()=>e.delete(n)),r):e.delete(n)})),e.set(n,s)),s}};class r extends Error{promise;constructor(e){super("Operation Timed Out"),this.promise=e}}t.TimeoutError=r},857:e=>{"use strict";e.exports=require("os")},932:e=>{"use strict";e.exports=require("process")},1251:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.authHttpFetch=void 0;const i=r(9049),n=r(3750);t.authHttpFetch=(0,n.createAuthFetch)(i.httpFetch,i.httpFetchParseIncomingMessage)},1362:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addVideoFilterArguments=function(e,t,r="unfilteredRecording"){const i=e.findIndex((e=>"-filter_complex"===e));void 0!==i&&-1!==i?e[i+1]=e[i+1]+`[${r}] ; [${r}] ${t}`:e.push("-filter_complex",t)}},1414:function(e,t,r){"use strict";var i,n=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},i(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=i(e),o=0;o<r.length;o++)"default"!==r[o]&&n(t,e,r[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.StorageSettings=void 0;const a=o(r(2743)),{systemManager:c}=a.default;t.StorageSettings=class{constructor(e,t){this.device=e,this.settings=t,this.values={},this.hasValue={};for(const e of Object.keys(t)){const r=t[e],i=()=>this.getItem(e);let n;n="clippath"!==r.type?i:()=>{try{return JSON.parse(i())}catch(e){}},Object.defineProperty(this.values,e,{get:n,set:t=>this.putSetting(e,t),enumerable:!0}),Object.defineProperty(this.hasValue,e,{get:()=>null!=this.device.storage.getItem(e),enumerable:!0})}}get keys(){const e={};for(const t of Object.keys(this.settings))e[t]=t;return e}async getSettings(){const e=await(this.options?.onGet?.()),t=[];for(const[r,i]of Object.entries(this.settings)){let n=Object.assign({},i);e?.[r]&&(n=Object.assign(n,e[r])),n.onGet&&(n=Object.assign(n,await n.onGet())),n.hide||await(this.options?.hide?.[r]?.())||(n.key=r,n.value=this.getItemInternal(r,n,!0),"function"==typeof n.deviceFilter&&(n.deviceFilter=n.deviceFilter.toString()),t.push(n),delete n.onPut,delete n.onGet,delete n.mapPut,delete n.mapGet)}return t}async putSetting(e,t){const r=this.settings[e];let i;return r&&(i=this.getItemInternal(e,r)),this.putSettingInternal(r,i,e,t)}putSettingInternal(e,t,r,i){e?.noStore||(e?.mapPut&&(i=e.mapPut(t,i)),null==i?this.device.storage.removeItem(r):"object"==typeof i?this.device.storage.setItem(r,JSON.stringify(i)):this.device.storage.setItem(r,i?.toString())),e?.onPut?.(t,i),e?.hide||this.device.onDeviceEvent(a.ScryptedInterface.Settings,void 0)}getItemInternal(e,t,r){if(!t)return this.device.storage.getItem(e);const i=function(e,t,r,i){if(null==e)return r();const n=t.multiple?"array":t.type;if("boolean"===n)return"true"===e||"false"!==e&&(r()||!1);if("number"===n){const t=parseFloat(e);return isNaN(t)?r()||0:t}if("integer"===n){const t=parseInt(e);return isNaN(t)?r()||0:t}if("array"===n){if(!e)return r()||[];try{return JSON.parse(e)}catch(e){return r()||[]}}if("device"===n)return i?e:c.getDeviceById(e)||c.getDeviceById(r());if(e&&t.json)try{return JSON.parse(e)}catch(e){return r()}return e||r()}(this.device.storage.getItem(e),t,(()=>null!=t.persistedDefaultValue?(this.putSettingInternal(t,void 0,e,t.persistedDefaultValue),t.persistedDefaultValue):t.defaultValue),r);return t.mapGet?t.mapGet(i):i}getItem(e){return this.getItemInternal(e,this.settings[e])}}},1470:(e,t,r)=>{"undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?e.exports=r(9710):e.exports=r(148)},1854:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsMixinDeviceBase=void 0;const n=r(2743),s=i(r(2743)),{deviceManager:o}=s.default;class a extends n.MixinDeviceBase{settingsGroup;settingsGroupKey;constructor(e){super(e),this.settingsGroup=e.group,this.settingsGroupKey=e.groupKey,process.nextTick((()=>o.onMixinEvent(this.id,this,n.ScryptedInterface.Settings,null)))}async getSettings(){const e=this.mixinDeviceInterfaces.includes(n.ScryptedInterface.Settings)?this.mixinDevice.getSettings():void 0,t=this.getMixinSettings(),r=[];try{const t=await e||[];r.push(...t)}catch(e){const t=this.name,i=`${t} Extension settings failed to load.`;this.console.error(i,e),r.push({key:Math.random().toString(),title:t,value:"Settings Error",group:"Errors",description:i,readonly:!0})}try{const e=await t||[];for(const t of e)t.group=t.group||this.settingsGroup,t.key=this.settingsGroupKey+":"+t.key;r.push(...e)}catch(e){const t=o.getDeviceState(this.mixinProviderNativeId).name,i=`${t} Extension settings failed to load.`;this.console.error(i,e),r.push({key:Math.random().toString(),title:t,value:"Settings Error",group:"Errors",description:i,readonly:!0})}return r}async putSetting(e,t){const r=this.settingsGroupKey+":";if(!e?.startsWith(r))return this.mixinDevice.putSetting(e,t);await this.putMixinSetting(e.substring(r.length),t)||o.onMixinEvent(this.id,this,n.ScryptedInterface.Settings,null)}async release(){await o.onMixinEvent(this.id,this,n.ScryptedInterface.Settings,null)}}t.SettingsMixinDeviceBase=a},1952:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageConverter=t.ImageConverterNativeId=void 0;const n=r(2743),s=i(r(4851)),o=r(167);t.ImageConverterNativeId="imageconverter";class a extends n.ScryptedDeviceBase{plugin;constructor(e,t){super(t),this.plugin=e,this.fromMimeType=n.ScryptedMimeTypes.FFmpegInput,this.toMimeType="image/jpeg"}async convert(e,t,r,i){const n=new s.default(r),a=(0,o.parseImageOp)(n.parameters),c=JSON.parse(e.toString());return(0,o.processImageOp)(c,a,parseFloat(n.parameters.get("time")),i?.sourceId,!!this.plugin.debugConsole)}}t.ImageConverter=a},2018:e=>{"use strict";e.exports=require("tty")},2203:e=>{"use strict";e.exports=require("stream")},2204:(e,t,r)=>{"use strict";r.d(t,{BASIC:()=>m,DIGEST:()=>P,buildAuthorizationHeader:()=>O,parseWWWAuthenticateHeader:()=>x});var i=r(857);class n extends Error{code;params;wrappedErrors;constructor(e,t,...r){e instanceof Array||(r=("undefined"==typeof t?[]:[t]).concat(r),t=e,e=[]),super(t),this.code=t||"E_UNEXPECTED",this.params=r,this.wrappedErrors=e,this.name=this.toString(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}static wrap(e,t,...r){const i=o(e.message),s=("wrappedErrors"in e?e.wrappedErrors:[]).concat(e);return t||(t=i?e.message:"E_UNEXPECTED"),e.message&&!i&&r.push(e.message),new n(s,t,...r)}static cast(e,t,...r){return s(e)?e:n.wrap(e,t,...r)}static bump(e,t,...r){return s(e)?n.wrap(e,e.code,...e.params):n.wrap(e,t,...r)}toString(){return(this.wrappedErrors.length?this.wrappedErrors[this.wrappedErrors.length-1].stack+i.EOL:"")+this.constructor.name+": "+this.code+" ("+this.params.join(", ")+")"}}function s(e){return!!(e instanceof n)||!!(e.constructor&&e.constructor.name&&e.constructor.name.endsWith("Error")&&"code"in e&&"string"==typeof e.code&&o(e.code)&&"params"in e&&e.params&&e.params instanceof Array)}function o(e){return/^([A-Z0-9_]+)$/.test(e)}const a=/\w+=(".*?"|[^",]+)(?=,|$)/g;function c(e,t,r=[],i=[]){const s=e.trim().match(a);if(!s)throw new n("E_MALFORMED_QUOTEDKEYVALUE",e);const o=s.map(((e,t)=>{const[r,...i]=e.split("="),s=i.join("=");if(0===i.length)throw new n("E_MALFORMED_QUOTEDKEYVALUE",t,e);return[r,s]})).reduce((function(e,[r,s],o){const a=r.toLowerCase();if(-1===t.indexOf(a))throw new n("E_UNAUTHORIZED_KEY",o,a);const c=s.replace(/^"(.+(?="$))"$/,"$1");return e[a]=i.includes(a)?c.toLowerCase():c,e}),{});return d(r,o),o}function u(e,t,r=[]){return d(r,e),t.reduce((function(t,r){return e[r]?t+(t?", ":"")+r+'="'+e[r]+'"':t}),"")}function d(e,t){e.forEach((e=>{if("undefined"==typeof t[e])throw new n("E_REQUIRED_KEY",e)}))}const p=["realm"],l=p,h={type:"Basic",parseWWWAuthenticateRest:function(e){return c(e,l,p)},buildWWWAuthenticateRest:function(e){return u(e,l,p)},parseAuthorizationRest:function(e){if(!e)throw new n("E_EMPTY_AUTH");const{username:t,password:r}=h.decodeHash(e);return{hash:e,username:t,password:r}},buildAuthorizationRest:function({hash:e,username:t,password:r}){if(t&&r)return h.computeHash({username:t,password:r});if(!e)throw new n("E_NO_HASH");return e},computeHash:function({username:e,password:t}){return Buffer.from(e+":"+t).toString("base64")},decodeHash:function(e){const[t,...r]=Buffer.from(e,"base64").toString().split(":");return{username:t,password:r.join(":")}}},m=h,g=require("crypto"),f=["realm","nonce"],y=[...f,"domain","opaque","stale","algorithm","qop"],v=["stale"],S=["username","realm","nonce","uri","response"],b=[...S,"algorithm","cnonce","opaque","qop","nc"],C={type:"Digest",parseWWWAuthenticateRest:function(e){return c(e,y,f,v)},buildWWWAuthenticateRest:function(e){return u(e,y,f)},parseAuthorizationRest:function(e){return c(e,b,S)},buildAuthorizationRest:function(e){return u(e,b,S)},computeHash:function(e){const t=e.ha1||w(e.algorithm,[e.username,e.realm,e.password].join(":")),r=w(e.algorithm,[e.method,e.uri].join(":"));return w(e.algorithm,[t,e.nonce,e.nc,e.cnonce,e.qop,r].join(":"))}};function w(e,t){const r=g.createHash(e);return r.update(t),r.digest("hex")}const P=C,_=["invalid_request","invalid_token","insufficient_scope"],I=["realm","scope","error","error_description"],M={type:"Bearer",parseWWWAuthenticateRest:function(e){return c(e,I,[])},buildWWWAuthenticateRest:function(e){if(e.error&&-1===_.indexOf(e.error))throw new n("E_INVALID_ERROR",e.error,_);return u(e,I,[])},parseAuthorizationRest:function(e){if(!e)throw new n("E_EMPTY_AUTH");return{hash:e}},buildAuthorizationRest:function({hash:e}){if(!e)throw new n("E_NO_HASH");return e}},T=[m,C,M];function x(e,t=T,{strict:r=!0}={strict:!0}){let i=null;if(t.some((t=>(0===e.indexOf(t.type+" ")||!r&&0===e.indexOf(t.type.toLowerCase()+" "))&&(i={type:t.type,data:t.parseWWWAuthenticateRest(e.substr(t.type.length+1))},!0))),!i)throw new n("E_UNKNOWN_AUTH_MECHANISM",e);return i}function O(e,t){return`${e.type} ${e.buildAuthorizationRest(t)}`}},2613:e=>{"use strict";e.exports=require("assert")},2661:(e,t)=>{"use strict";t.removeLeadingAndTrailingHTTPWhitespace=e=>e.replace(/^[ \t\n\r]+/u,"").replace(/[ \t\n\r]+$/u,""),t.removeTrailingHTTPWhitespace=e=>e.replace(/[ \t\n\r]+$/u,""),t.isHTTPWhitespaceChar=e=>" "===e||"\t"===e||"\n"===e||"\r"===e,t.solelyContainsHTTPTokenCodePoints=e=>/^[-!#$%&'*+.^_`|~A-Za-z0-9]*$/u.test(e),t.soleyContainsHTTPQuotedStringTokenCodePoints=e=>/^[\t\u0020-\u007E\u0080-\u00FF]*$/u.test(e),t.asciiLowercase=e=>e.replace(/[A-Z]/gu,(e=>e.toLowerCase())),t.collectAnHTTPQuotedString=(e,t)=>{let r="";for(t++;;){for(;t<e.length&&'"'!==e[t]&&"\\"!==e[t];)r+=e[t],++t;if(t>=e.length)break;const i=e[t];if(++t,"\\"!==i)break;if(t>=e.length){r+="\\";break}r+=e[t],++t}return[r,t]}},2743:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sdk=t.MixinDeviceBase=t.ScryptedDeviceBase=void 0,n(r(9849),t);const o=s(r(9896)),a=r(9849);r(3339);class c extends a.DeviceBase{constructor(e){super(),this.nativeId=e}get storage(){return this._storage||(this._storage=t.sdk.deviceManager.getDeviceStorage(this.nativeId)),this._storage}get log(){return this._log||(this._log=t.sdk.deviceManager.getDeviceLogger(this.nativeId)),this._log}get console(){return this._console||(this._console=t.sdk.deviceManager.getDeviceConsole(this.nativeId)),this._console}async createMediaObject(e,r){return t.sdk.mediaManager.createMediaObject(e,r,{sourceId:this.id})}getMediaObjectConsole(e){return"string"!=typeof e.sourceId?this.console:t.sdk.deviceManager.getMixinConsole(e.sourceId,this.nativeId)}_lazyLoadDeviceState(){this._deviceState||(this.nativeId?this._deviceState=t.sdk.deviceManager.getDeviceState(this.nativeId):this._deviceState=t.sdk.deviceManager.getDeviceState())}onDeviceEvent(e,r){return t.sdk.deviceManager.onDeviceEvent(this.nativeId,e,r)}}t.ScryptedDeviceBase=c;class u extends a.DeviceBase{constructor(e){super(),this._listeners=new Set,this.mixinDevice=e.mixinDevice,this.mixinDeviceInterfaces=e.mixinDeviceInterfaces,this.mixinStorageSuffix=e.mixinStorageSuffix,this._deviceState=e.mixinDeviceState,this.nativeId=t.sdk.systemManager.getDeviceById(this.id).nativeId,this.mixinProviderNativeId=e.mixinProviderNativeId,this._deviceState.__rpcproxy_traps_all_properties&&"string"==typeof this._deviceState.id&&(this._deviceState=t.sdk.deviceManager.createDeviceState(this._deviceState.id,this._deviceState.setState))}get storage(){if(!this._storage){const e=this.mixinStorageSuffix,r=this.id+(e?":"+e:"");this._storage=t.sdk.deviceManager.getMixinStorage(r,this.mixinProviderNativeId)}return this._storage}get console(){return this._console||(t.sdk.deviceManager.getMixinConsole?this._console=t.sdk.deviceManager.getMixinConsole(this.id,this.mixinProviderNativeId):this._console=t.sdk.deviceManager.getDeviceConsole(this.mixinProviderNativeId)),this._console}async createMediaObject(e,r){return t.sdk.mediaManager.createMediaObject(e,r,{sourceId:this.id})}getMediaObjectConsole(e){return"string"!=typeof e.sourceId?this.console:t.sdk.deviceManager.getMixinConsole(e.sourceId,this.mixinProviderNativeId)}onDeviceEvent(e,r){return t.sdk.deviceManager.onMixinEvent(this.id,this,e,r)}_lazyLoadDeviceState(){}manageListener(e){this._listeners.add(e)}release(){for(const e of this._listeners)e.removeListener()}}t.MixinDeviceBase=u,function(){function e(e){return function(){return this._lazyLoadDeviceState(),this._deviceState?.[e]}}function t(e){return function(t){this._lazyLoadDeviceState(),this._deviceState?this._deviceState[e]=t:console.warn("device state is unavailable. the device must be discovered with deviceManager.onDeviceDiscovered or deviceManager.onDevicesChanged before the state can be set.")}}for(const r of Object.values(a.ScryptedInterfaceProperty))r!==a.ScryptedInterfaceProperty.nativeId&&(Object.defineProperty(c.prototype,r,{set:t(r),get:e(r)}),Object.defineProperty(u.prototype,r,{set:t(r),get:e(r)}))}(),t.sdk={};try{let e=!1;try{process.env.SCRYPTED_SDK_ES_MODULE||process.env.SCRYPTED_SDK_MODULE;const i=process.env.SCRYPTED_SDK_CJS_MODULE||process.env.SCRYPTED_SDK_MODULE;if(i)if("undefined"!=typeof require){const r=require(process.env.SCRYPTED_SDK_MODULE);Object.assign(t.sdk,r.getScryptedStatic()),e=!0}else{const n=r(394)(i);Object.assign(t.sdk,n.getScryptedStatic()),e=!0}}catch(e){throw console.warn("failed to load sdk module",e),e}if(!e){let e;try{e=pluginRuntimeAPI}catch(e){}Object.assign(t.sdk,{log:deviceManager.getDeviceLogger(void 0),deviceManager,endpointManager,mediaManager,systemManager,pluginHostAPI,...e})}try{let e={...a.ScryptedInterfaceDescriptors};try{const t=JSON.parse(o.default.readFileSync("../sdk.json").toString()).interfaceDescriptors;t&&(e={...e,...t})}catch(e){console.warn("failed to load custom interface descriptors",e)}t.sdk.systemManager.setScryptedInterfaceDescriptors?.(a.TYPES_VERSION,e)?.catch((()=>{}))}catch(e){}}catch(e){console.error("sdk initialization error, import @scrypted/types or use @scrypted/client instead",e)}t.default=t.sdk},2889:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AutoenableMixinProvider=void 0;const n=r(2743),s=i(r(2743)),{systemManager:o}=s.default;class a extends n.ScryptedDeviceBase{autoIncludeToken;hasEnabledMixin={};pluginsComponent;constructor(e,t="v4"){super(e),this.autoIncludeToken=t;try{this.hasEnabledMixin=JSON.parse(this.storage.getItem("hasEnabledMixin"))}catch(e){this.hasEnabledMixin={}}this.pluginsComponent=o.getComponent("plugins"),o.listen((async(e,t,r)=>{t.eventInterface!==n.ScryptedInterface.ScryptedDevice||t.property||this.maybeEnableMixin(e)})),process.nextTick((()=>{for(const e of Object.keys(o.getSystemState())){const t=o.getDeviceById(e);this.maybeEnableMixin(t)}}))}async shouldEnableMixin(e){return!0}checkHasEnabledMixin(e){return this.hasEnabledMixin[e.id]===this.autoIncludeToken}shouldUnshiftMixin(e){return!1}async maybeEnableMixin(e){if(!e||e.mixins?.includes(this.id))return;if(this.checkHasEnabledMixin(e))return;if(!await this.canMixin(e.type,e.interfaces))return;if(!await this.shouldEnableMixin(e))return;this.log.i("auto enabling mixin for "+e.name);const t=(e.mixins||[]).slice();this.shouldUnshiftMixin(e)?t.unshift(this.id):t.push(this.id);const r=await this.pluginsComponent;await r.setMixins(e.id,t),this.setHasEnabledMixin(e.id)}setHasEnabledMixin(e){this.hasEnabledMixin[e]!==this.autoIncludeToken&&(this.hasEnabledMixin[e]=this.autoIncludeToken,this.storage.setItem("hasEnabledMixin",JSON.stringify(this.hasEnabledMixin)))}}t.AutoenableMixinProvider=a},2989:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.safeKillFFmpeg=async function(e){if(!e)return;if(null!=e.exitCode)return;await new Promise((async t=>{e.on("exit",t);try{e.stdin.on("error",(()=>{})),e.stdin.write("q\n")}catch(e){}await(0,s.sleep)(2e3);for(const t of e.stdio)try{t?.destroy()}catch(e){}e.kill(),await(0,s.sleep)(2e3),e.kill("SIGKILL")}))},t.ffmpegLogInitialOutput=function(e,t,r,i){if(!e)return;const s=!!n.default.env.SCRYPTED_FFMPEG_NOISY||!!i?.getItem("SCRYPTED_FFMPEG_NOISY");function a(e){const i=n=>{const a=n.toString();for(const e of o)if(-1!==a.indexOf(e))return;if(!(s||r||-1===a.indexOf("frame=")&&-1===a.indexOf("size=")))return e(a),e("video/audio detected, discarding further input"),t.stdout.removeListener("data",i),void t.stderr.removeListener("data",i);e(a)};return i}t.stdout?.on("data",a(e.log)),t.stderr?.on("data",a(e.error)),t.on("exit",(()=>e.log("ffmpeg exited")))},t.safePrintFFmpegArguments=function(e,t){if(!e)return;const r=[];let i=!1;for(const e of t){try{if(i){const t=new URL(e);r.push(`${t.protocol}[REDACTED]`)}else r.push(e)}catch(t){r.push(e)}i="-i"===e}e.log(r.join(" "))};const n=i(r(932)),s=r(4610),o=["decode_slice_header error","no frame!","non-existing PPS"]},3339:e=>{"use strict";e.exports=require("module")},3643:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.safePrintFFmpegArguments=t.ffmpegLogInitialOutput=t.safeKillFFmpeg=void 0;var i=r(2989);Object.defineProperty(t,"safeKillFFmpeg",{enumerable:!0,get:function(){return i.safeKillFFmpeg}}),Object.defineProperty(t,"ffmpegLogInitialOutput",{enumerable:!0,get:function(){return i.ffmpegLogInitialOutput}}),Object.defineProperty(t,"safePrintFFmpegArguments",{enumerable:!0,get:function(){return i.safePrintFFmpegArguments}})},3674:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ffmpegFilterImageBuffer=function(e,t){const r=["-f","image2pipe","-i","pipe:4"];l(r,t);const i=[...p,...r,"-frames:v","1","-f","image2","pipe:3"];(0,s.safePrintFFmpegArguments)(t.console,i);const n=c.default.spawn(t.ffmpegPath||"ffmpeg",i,{stdio:["pipe","pipe","pipe","pipe","pipe"]});(0,s.ffmpegLogInitialOutput)(t.console,n);const o=n.stdio[4];return o.write(e),o.end(),h(n,t)},t.ffmpegFilterImage=function(e,t){let r;l(e,t),r=t.time?["-vsync","0","-f","image2pipe","pipe:3"]:["-vf","select='eq(pict_type,I)'","-frames:v","1","-f","image2","pipe:3"];const i=[...p,...e,...r];(0,s.safePrintFFmpegArguments)(t.console,i);const n=c.default.spawn(t.ffmpegPath||"ffmpeg",i,{stdio:["pipe","pipe","pipe","pipe"]});return(0,s.ffmpegLogInitialOutput)(t.console,n),t.time?m(n,t):h(n,t)},t.ffmpegFilterImageInternal=h,t.ffmpegFilterImageStream=m;const n=r(1362),s=r(3643),o=r(488),a=r(7724),c=i(r(5317)),u=r(4434),d=r(6976),p=["-hide_banner","-hwaccel","none","-err_detect","aggressive","-fflags","discardcorrupt","-y"];function l(e,t){if(t.crop){const{crop:r}=t,i=r.fractional?`iw*${r.left}`:r.left,s=r.fractional?`ih*${r.top}`:r.top,o=`crop=${r.fractional?`iw*${r.width}`:r.width}:${r.fractional?`ih*${r.height}`:r.height}:${i}:${s}`;(0,n.addVideoFilterArguments)(e,o,"snapshotCrop")}if(t.resize?.width||t.resize?.height){const{resize:r}=t;let i,s;r.height?(i=-2,s=r.fractional?`ih*${r.height}`:`'min(${r.height},ih)'`):(s=-2,i=r.fractional?`iw*${r.width}`:`'min(${r.width},iw)'`);const o=`scale=${i}:${s}`;(0,n.addVideoFilterArguments)(e,o,"snapshotResize")}if(t.brightness&&(0,n.addVideoFilterArguments)(e,`eq=brightness=${t.brightness}`,"snapshotEq"),t.blur&&(0,n.addVideoFilterArguments)(e,"gblur=sigma=25","snapshotBlur"),t.text){const{text:r}=t;(0,n.addVideoFilterArguments)(e,`drawtext=fontfile=${r.fontFile}:text='${r.text}':fontcolor=white:fontsize=h/8:x=(w-text_w)/2:y=(h-text_h)/2`,"snapshotText")}}async function h(e,t){const r=[];e.stdio[3].on("data",(e=>r.push(e)));try{await(0,o.timeoutFunction)(t.timeout||1e4,(async()=>{const t=(0,u.once)(e,"exit");await(0,u.once)(e.stdio[3],"end").catch((()=>{}));const[r]=await t;if(r)throw new Error(`ffmpeg input to image conversion failed with exit code: ${r}, ${e.spawnargs.join(" ")}`)}))}catch(e){if(!r.length)throw e}finally{(0,s.safeKillFFmpeg)(e)}return Buffer.concat(r)}async function m(e,t){try{return await(0,o.timeoutFunction)(t.timeout||1e4,(async()=>{const r=e.stdio[3].pipe(new d.Pipe2Jpeg);let i;if(r.on("jpeg",(e=>{i=e})),await(0,u.once)(r,"jpeg"),await Promise.any([(0,u.once)(e,"exit"),(0,a.sleep)(t.time)]).catch((()=>{})),!i)throw new Error(`ffmpeg stream to image conversion failed with exit code: ${e.exitCode}, ${e.spawnargs.join(" ")}`);return i}))}finally{(0,s.safeKillFFmpeg)(e)}}},3750:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createAuthFetch=function(e,t){return async s=>{const o=(0,i.getFetchMethod)(s),a=(0,i.createHeadersArray)(s.headers);s.headers=a,(0,i.setDefaultHttpFetchAccept)(a,s.responseType);const c=await n(s,s.url,o);c&&!(0,i.hasHeader)(a,"Authorization")&&(0,i.setHeader)(a,"Authorization",c);const u=new AbortController;s.signal?.addEventListener("abort",(()=>u.abort(s.signal?.reason)));const d=await e({...s,signal:u.signal,checkStatusCode(e){if(401===e&&s.credential)return!0;if(void 0===s?.checkStatusCode||s?.checkStatusCode){return("function"==typeof s?.checkStatusCode?s.checkStatusCode:i.checkStatus)(e)}return!0},responseType:"readable"});if(401!==d.statusCode)return{...d,body:await t(d.body,s.responseType)};let p=d.headers.get("www-authenticate");if(!p)throw new Error("Did not find WWW-Authenticate header.");"string"==typeof p&&(p=[p]);const{BASIC:l,DIGEST:h,parseWWWAuthenticateHeader:m}=await Promise.resolve().then(r.bind(r,2204)),g=p.map((e=>m(e))),f=g.find((e=>"Digest"===e.type)),y=g.find((e=>"Basic"===e.type)),v=s.credential;if(v.digest=f,v.basic=y,!f&&!y)throw new Error(`Unknown WWW-Authenticate type: ${g[0]?.type}`);const S=await n(s,s.url,o);return S&&(0,i.setHeader)(a,"Authorization",S),e(s)}};const i=r(9258);async function n(e,t,i){if(!e.credential)return;const{BASIC:n,DIGEST:s,parseWWWAuthenticateHeader:o}=await Promise.resolve().then(r.bind(r,2204)),a=e.credential,{digest:c,basic:u}=a;if(c){a.count||=0,++a.count;const n=("00000000"+a.count).slice(-8),s=[...Array(24)].map((()=>Math.floor(16*Math.random()).toString(16))).join(""),o=new URL(t),u=o.pathname+o.search,{DIGEST:d,buildAuthorizationHeader:p}=await Promise.resolve().then(r.bind(r,2204)),l=d.computeHash({username:e.credential.username,password:e.credential.password,method:i,uri:u,nc:n,cnonce:s,algorithm:"MD5",qop:c.data.qop,...c.data});return p(d,{username:e.credential.username,uri:u,nc:n,cnonce:s,algorithm:c.data.algorithm,qop:c.data.qop,response:l,...c.data})}if(u){const{BASIC:t,buildAuthorizationHeader:i}=await Promise.resolve().then(r.bind(r,2204));return i(t,{username:e.credential.username,password:e.credential.password})}}},3893:e=>{const t=require("sharp");e.exports=t},4126:(e,t,r)=>{"use strict";const{solelyContainsHTTPTokenCodePoints:i}=r(2661);e.exports=e=>{let t=`${e.type}/${e.subtype}`;if(0===e.parameters.size)return t;for(let[r,n]of e.parameters)t+=";",t+=r,t+="=",i(n)&&0!==n.length||(n=n.replace(/(["\\])/gu,"\\$1"),n=`"${n}"`),t+=n;return t}},4165:(e,t,r)=>{var i,n,s,o=r(7016),a=o.URL,c=r(8611),u=r(5692),d=r(2203).Writable,p=r(2613),l=r(7370);i="undefined"!=typeof process,n="undefined"!=typeof window&&"undefined"!=typeof document,s=k(Error.captureStackTrace),i||!n&&s||console.warn("The follow-redirects package should be excluded from browser builds.");var h=!1;try{p(new a(""))}catch(e){h="ERR_INVALID_URL"===e.code}var m=["auth","host","hostname","href","path","pathname","port","protocol","query","search","hash"],g=["abort","aborted","connect","error","socket","timeout"],f=Object.create(null);g.forEach((function(e){f[e]=function(t,r,i){this._redirectable.emit(e,t,r,i)}}));var y=D("ERR_INVALID_URL","Invalid URL",TypeError),v=D("ERR_FR_REDIRECTION_FAILURE","Redirected request failed"),S=D("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded",v),b=D("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),C=D("ERR_STREAM_WRITE_AFTER_END","write after end"),w=d.prototype.destroy||I;function P(e,t){d.call(this),this._sanitizeOptions(e),this._options=e,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],t&&this.on("response",t);var r=this;this._onNativeResponse=function(e){try{r._processResponse(e)}catch(e){r.emit("error",e instanceof v?e:new v({cause:e}))}},this._performRequest()}function _(e){var t={maxRedirects:21,maxBodyLength:10485760},r={};return Object.keys(e).forEach((function(i){var n=i+":",s=r[n]=e[i],o=t[i]=Object.create(s);Object.defineProperties(o,{request:{value:function(e,i,s){var o;return o=e,a&&o instanceof a?e=x(e):R(e)?e=x(M(e)):(s=i,i=T(e),e={protocol:n}),k(i)&&(s=i,i=null),(i=Object.assign({maxRedirects:t.maxRedirects,maxBodyLength:t.maxBodyLength},e,i)).nativeProtocols=r,R(i.host)||R(i.hostname)||(i.hostname="::1"),p.equal(i.protocol,n,"protocol mismatch"),l("options",i),new P(i,s)},configurable:!0,enumerable:!0,writable:!0},get:{value:function(e,t,r){var i=o.request(e,t,r);return i.end(),i},configurable:!0,enumerable:!0,writable:!0}})})),t}function I(){}function M(e){var t;if(h)t=new a(e);else if(!R((t=T(o.parse(e))).protocol))throw new y({input:e});return t}function T(e){if(/^\[/.test(e.hostname)&&!/^\[[:0-9a-f]+\]$/i.test(e.hostname))throw new y({input:e.href||e});if(/^\[/.test(e.host)&&!/^\[[:0-9a-f]+\](:\d+)?$/i.test(e.host))throw new y({input:e.href||e});return e}function x(e,t){var r=t||{};for(var i of m)r[i]=e[i];return r.hostname.startsWith("[")&&(r.hostname=r.hostname.slice(1,-1)),""!==r.port&&(r.port=Number(r.port)),r.path=r.search?r.pathname+r.search:r.pathname,r}function O(e,t){var r;for(var i in t)e.test(i)&&(r=t[i],delete t[i]);return null===r||"undefined"==typeof r?void 0:String(r).trim()}function D(e,t,r){function i(r){k(Error.captureStackTrace)&&Error.captureStackTrace(this,this.constructor),Object.assign(this,r||{}),this.code=e,this.message=this.cause?t+": "+this.cause.message:t}return i.prototype=new(r||Error),Object.defineProperties(i.prototype,{constructor:{value:i,enumerable:!1},name:{value:"Error ["+e+"]",enumerable:!1}}),i}function E(e,t){for(var r of g)e.removeListener(r,f[r]);e.on("error",I),e.destroy(t)}function R(e){return"string"==typeof e||e instanceof String}function k(e){return"function"==typeof e}P.prototype=Object.create(d.prototype),P.prototype.abort=function(){E(this._currentRequest),this._currentRequest.abort(),this.emit("abort")},P.prototype.destroy=function(e){return E(this._currentRequest,e),w.call(this,e),this},P.prototype.write=function(e,t,r){if(this._ending)throw new C;if(!R(e)&&("object"!=typeof(i=e)||!("length"in i)))throw new TypeError("data should be a string, Buffer or Uint8Array");var i;k(t)&&(r=t,t=null),0!==e.length?this._requestBodyLength+e.length<=this._options.maxBodyLength?(this._requestBodyLength+=e.length,this._requestBodyBuffers.push({data:e,encoding:t}),this._currentRequest.write(e,t,r)):(this.emit("error",new b),this.abort()):r&&r()},P.prototype.end=function(e,t,r){if(k(e)?(r=e,e=t=null):k(t)&&(r=t,t=null),e){var i=this,n=this._currentRequest;this.write(e,t,(function(){i._ended=!0,n.end(null,null,r)})),this._ending=!0}else this._ended=this._ending=!0,this._currentRequest.end(null,null,r)},P.prototype.setHeader=function(e,t){this._options.headers[e]=t,this._currentRequest.setHeader(e,t)},P.prototype.removeHeader=function(e){delete this._options.headers[e],this._currentRequest.removeHeader(e)},P.prototype.setTimeout=function(e,t){var r=this;function i(t){t.setTimeout(e),t.removeListener("timeout",t.destroy),t.addListener("timeout",t.destroy)}function n(t){r._timeout&&clearTimeout(r._timeout),r._timeout=setTimeout((function(){r.emit("timeout"),s()}),e),i(t)}function s(){r._timeout&&(clearTimeout(r._timeout),r._timeout=null),r.removeListener("abort",s),r.removeListener("error",s),r.removeListener("response",s),r.removeListener("close",s),t&&r.removeListener("timeout",t),r.socket||r._currentRequest.removeListener("socket",n)}return t&&this.on("timeout",t),this.socket?n(this.socket):this._currentRequest.once("socket",n),this.on("socket",i),this.on("abort",s),this.on("error",s),this.on("response",s),this.on("close",s),this},["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach((function(e){P.prototype[e]=function(t,r){return this._currentRequest[e](t,r)}})),["aborted","connection","socket"].forEach((function(e){Object.defineProperty(P.prototype,e,{get:function(){return this._currentRequest[e]}})})),P.prototype._sanitizeOptions=function(e){if(e.headers||(e.headers={}),e.host&&(e.hostname||(e.hostname=e.host),delete e.host),!e.pathname&&e.path){var t=e.path.indexOf("?");t<0?e.pathname=e.path:(e.pathname=e.path.substring(0,t),e.search=e.path.substring(t))}},P.prototype._performRequest=function(){var e=this._options.protocol,t=this._options.nativeProtocols[e];if(!t)throw new TypeError("Unsupported protocol "+e);if(this._options.agents){var r=e.slice(0,-1);this._options.agent=this._options.agents[r]}var i=this._currentRequest=t.request(this._options,this._onNativeResponse);for(var n of(i._redirectable=this,g))i.on(n,f[n]);if(this._currentUrl=/^\//.test(this._options.path)?o.format(this._options):this._options.path,this._isRedirect){var s=0,a=this,c=this._requestBodyBuffers;!function e(t){if(i===a._currentRequest)if(t)a.emit("error",t);else if(s<c.length){var r=c[s++];i.finished||i.write(r.data,r.encoding,e)}else a._ended&&i.end()}()}},P.prototype._processResponse=function(e){var t=e.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:e.headers,statusCode:t});var r,i=e.headers.location;if(!i||!1===this._options.followRedirects||t<300||t>=400)return e.responseUrl=this._currentUrl,e.redirects=this._redirects,this.emit("response",e),void(this._requestBodyBuffers=[]);if(E(this._currentRequest),e.destroy(),++this._redirectCount>this._options.maxRedirects)throw new S;var n=this._options.beforeRedirect;n&&(r=Object.assign({Host:e.req.getHeader("host")},this._options.headers));var s=this._options.method;((301===t||302===t)&&"POST"===this._options.method||303===t&&!/^(?:GET|HEAD)$/.test(this._options.method))&&(this._options.method="GET",this._requestBodyBuffers=[],O(/^content-/i,this._options.headers));var c,u,d=O(/^host$/i,this._options.headers),m=M(this._currentUrl),g=d||m.host,f=/^\w+:/.test(i)?this._currentUrl:o.format(Object.assign(m,{host:g})),y=(c=i,u=f,h?new a(c,u):M(o.resolve(u,c)));if(l("redirecting to",y.href),this._isRedirect=!0,x(y,this._options),(y.protocol!==m.protocol&&"https:"!==y.protocol||y.host!==g&&!function(e,t){p(R(e)&&R(t));var r=e.length-t.length-1;return r>0&&"."===e[r]&&e.endsWith(t)}(y.host,g))&&O(/^(?:(?:proxy-)?authorization|cookie)$/i,this._options.headers),k(n)){var v={headers:e.headers,statusCode:t},b={url:f,method:s,headers:r};n(this._options,v,b),this._sanitizeOptions(this._options)}this._performRequest()},e.exports=_({http:c,https:u}),e.exports.wrap=_},4204:(e,t)=>{"use strict";function r([e,t],[r,i],[n,s],[o,a]){const c=(a-s)*(r-e)-(o-n)*(i-t);if(0===c)return!1;const u=((o-n)*(t-s)-(a-s)*(e-n))/c,d=((r-e)*(t-s)-(i-t)*(e-n))/c;return u>=0&&u<=1&&d>=0&&d<=1}function i([e,t],r){let i=!1;for(let n=0,s=r.length-1;n<r.length;s=n++){const[o,a]=r[n],[c,u]=r[s];a>t!=u>t&&e<(c-o)*(t-a)/(u-a)+o&&(i=!i)}return i}function n([e,t,r,i]){return[[e,t],[e+r,t],[e+r,t+i],[e,t+i]]}Object.defineProperty(t,"__esModule",{value:!0}),t.polygonIntersectsBoundingBox=function(e,t){const s=n(t);for(let t=0;t<e.length;t++){const i=(t+1)%e.length,n=e[t],o=e[i];for(let e=0;e<s.length;e++){const t=(e+1)%s.length;if(r(n,o,s[e],s[t]))return!0}}return!(!i(e[0],s)&&!i(s[0],e))},t.polygonContainsBoundingBox=function(e,t){return n(t).every((t=>i(t,e)))},t.normalizeBox=function(e,t){return[e[0]/t[0],e[1]/t[1],e[2]/t[0],e[3]/t[1]]},t.fixLegacyClipPath=function(e){if(!e)return;let t=!1;for(const r of e)for(const e of r)Math.abs(e)>=2&&(t=!0);return t?e.map((e=>e.map((e=>e/100)))):e}},4236:e=>{"use strict";e.exports=require("console")},4434:e=>{"use strict";e.exports=require("events")},4610:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=async function(e){await new Promise((t=>setTimeout(t,e)))}},4851:(e,t,r)=>{"use strict";const i=r(8560),n=r(5817),s=r(4126),{asciiLowercase:o,solelyContainsHTTPTokenCodePoints:a}=r(2661);e.exports=class{constructor(e){e=String(e);const t=n(e);if(null===t)throw new Error(`Could not parse MIME type string "${e}"`);this._type=t.type,this._subtype=t.subtype,this._parameters=new i(t.parameters)}static parse(e){try{return new this(e)}catch(e){return null}}get essence(){return`${this.type}/${this.subtype}`}get type(){return this._type}set type(e){if(0===(e=o(String(e))).length)throw new Error("Invalid type: must be a non-empty string");if(!a(e))throw new Error(`Invalid type ${e}: must contain only HTTP token code points`);this._type=e}get subtype(){return this._subtype}set subtype(e){if(0===(e=o(String(e))).length)throw new Error("Invalid subtype: must be a non-empty string");if(!a(e))throw new Error(`Invalid subtype ${e}: must contain only HTTP token code points`);this._subtype=e}get parameters(){return this._parameters}toString(){return s(this)}isJavaScript({prohibitParameters:e=!1}={}){switch(this._type){case"text":switch(this._subtype){case"ecmascript":case"javascript":case"javascript1.0":case"javascript1.1":case"javascript1.2":case"javascript1.3":case"javascript1.4":case"javascript1.5":case"jscript":case"livescript":case"x-ecmascript":case"x-javascript":return!e||0===this._parameters.size;default:return!1}case"application":switch(this._subtype){case"ecmascript":case"javascript":case"x-ecmascript":case"x-javascript":return!e||0===this._parameters.size;default:return!1}default:return!1}}isXML(){return"xml"===this._subtype&&("text"===this._type||"application"===this._type)||this._subtype.endsWith("+xml")}isHTML(){return"html"===this._subtype&&"text"===this._type}}},5317:e=>{"use strict";e.exports=require("child_process")},5368:e=>{var t=1e3,r=60*t,i=60*r,n=24*i,s=7*n,o=365.25*n;function a(e,t,r,i){var n=t>=1.5*r;return Math.round(e/r)+" "+i+(n?"s":"")}e.exports=function(e,c){c=c||{};var u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*s;case"days":case"day":case"d":return c*n;case"hours":case"hour":case"hrs":case"hr":case"h":return c*i;case"minutes":case"minute":case"mins":case"min":case"m":return c*r;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===u&&isFinite(e))return c.long?function(e){var s=Math.abs(e);if(s>=n)return a(e,s,n,"day");if(s>=i)return a(e,s,i,"hour");if(s>=r)return a(e,s,r,"minute");if(s>=t)return a(e,s,t,"second");return e+" ms"}(e):function(e){var s=Math.abs(e);if(s>=n)return Math.round(e/n)+"d";if(s>=i)return Math.round(e/i)+"h";if(s>=r)return Math.round(e/r)+"m";if(s>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},5692:e=>{"use strict";e.exports=require("https")},5729:(e,t,r)=>{e.exports=function(e){function t(e){let r,n,s,o=null;function a(...e){if(!a.enabled)return;const i=a,n=Number(new Date),s=n-(r||n);i.diff=s,i.prev=r,i.curr=n,r=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,n)=>{if("%%"===r)return"%";o++;const s=t.formatters[n];if("function"==typeof s){const t=e[o];r=s.call(i,t),e.splice(o,1),o--}return r})),t.formatArgs.call(i,e);(i.log||t.log).apply(i,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=i,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(n!==t.namespaces&&(n=t.namespaces,s=t.enabled(e)),s),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function i(e,r){const i=t(this.namespace+("undefined"==typeof r?":":r)+e);return i.log=this.log,i}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const i=("string"==typeof e?e:"").split(/[\s,]+/),n=i.length;for(r=0;r<n;r++)i[r]&&("-"===(e=i[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,i;for(r=0,i=t.skips.length;r<i;r++)if(t.skips[r].test(e))return!1;for(r=0,i=t.names.length;r<i;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(5368),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},5817:(e,t,r)=>{"use strict";const{removeLeadingAndTrailingHTTPWhitespace:i,removeTrailingHTTPWhitespace:n,isHTTPWhitespaceChar:s,solelyContainsHTTPTokenCodePoints:o,soleyContainsHTTPQuotedStringTokenCodePoints:a,asciiLowercase:c,collectAnHTTPQuotedString:u}=r(2661);e.exports=e=>{e=i(e);let t=0,r="";for(;t<e.length&&"/"!==e[t];)r+=e[t],++t;if(0===r.length||!o(r))return null;if(t>=e.length)return null;++t;let d="";for(;t<e.length&&";"!==e[t];)d+=e[t],++t;if(d=n(d),0===d.length||!o(d))return null;const p={type:c(r),subtype:c(d),parameters:new Map};for(;t<e.length;){for(++t;s(e[t]);)++t;let r="";for(;t<e.length&&";"!==e[t]&&"="!==e[t];)r+=e[t],++t;if(r=c(r),t<e.length){if(";"===e[t])continue;++t}let i=null;if('"'===e[t])for([i,t]=u(e,t);t<e.length&&";"!==e[t];)++t;else{for(i="";t<e.length&&";"!==e[t];)i+=e[t],++t;if(i=n(i),""===i)continue}r.length>0&&o(r)&&a(i)&&!p.parameters.has(r)&&p.parameters.set(r,i)}return p}},6605:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageWriter=t.ImageWriterNativeId=void 0;const i=r(2743);t.ImageWriterNativeId="imagewriter";class n extends i.ScryptedDeviceBase{constructor(e){super(e),this.fromMimeType=i.ScryptedMimeTypes.Image,this.toMimeType="image/*"}async convert(e,t,r,i){return e.toBuffer({format:"jpg"})}}t.ImageWriter=n},6893:function(e,t,r){"use strict";var i,n=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},i(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=i(e),o=0;o<r.length;o++)"default"!==r[o]&&n(t,e,r[o]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ImageReader=t.VipsImage=t.ImageReaderNativeId=void 0,t.loadSharp=d,t.createVipsMediaObject=p,t.loadVipsMetadata=h,t.loadVipsImage=m;const a=o(r(2743));let c,u=!1;function d(){if(!u){u=!0;try{c=r(3893),console.log("sharp loaded")}catch(e){console.warn("sharp failed to load, scrypted server may be out of date",e)}}return!!c}async function p(e){return await a.default.mediaManager.createMediaObject(e,a.ScryptedMimeTypes.Image,{sourceId:e.sourceId,width:e.width,height:e.height,format:null,toBuffer:t=>e.toBuffer(t),toImage:async t=>p(await e.toVipsImage(t)),close:()=>e.close()})}t.ImageReaderNativeId="imagereader";class l{image;metadata;sourceId;constructor(e,t,r){this.image=e,this.metadata=t,this.sourceId=r}get width(){return this.metadata.width}get height(){return this.metadata.height}toImageInternal(e){const t=this.image.clone();if(e?.crop&&t.extract({left:Math.floor(e.crop.left),top:Math.floor(e.crop.top),width:Math.floor(e.crop.width),height:Math.floor(e.crop.height)}),e?.resize){let r;switch(e?.resize.filter){case"lanczos":r="lanczos2";break;case"mitchell":r="mitchell";break;case"nearest":r="nearest";break;default:r="cubic"}t.resize("number"==typeof e.resize.width?Math.floor(e.resize.width):void 0,"number"==typeof e.resize.height?Math.floor(e.resize.height):void 0,{fit:e.resize.width&&e.resize.height?"fill":"cover",kernel:r})}return t}async toBuffer(e){const t=this.toImageInternal(e);return"rgb"===e?.format?t.removeAlpha().toFormat("raw"):"rgba"===e?.format?t.ensureAlpha().toFormat("raw"):"gray"===e?.format?t.toFormat("raw").grayscale():"jpg"===e?.format&&t.toFormat("jpg"),t.toBuffer()}async toVipsImage(e){const t=this.toImageInternal(e),{info:r,data:i}=await t.raw().toBuffer({resolveWithObject:!0}),n=c(i,{raw:r}),s=await n.metadata();return new l(n,s,this.sourceId)}async toImage(e){if(e?.format)throw new Error("format can only be used with toBuffer");return p(await this.toVipsImage(e))}async close(){this.image?.destroy(),this.image=void 0}}async function h(e){const t=c(e,{failOn:"none"}),r=await t.metadata();return{image:t,metadata:r}}async function m(e,t){d();const{image:r,metadata:i}=await h(e);return new l(r,i,t)}t.VipsImage=l;class g extends a.ScryptedDeviceBase{constructor(e){super(e),this.fromMimeType="image/*",this.toMimeType=a.ScryptedMimeTypes.Image}async convert(e,t,r,i){return p(await m(e,i?.sourceId))}}t.ImageReader=g},6928:e=>{"use strict";e.exports=require("path")},6976:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pipe2Jpeg=void 0;const i=r(2203),n=Buffer.from([255,216]),s=Buffer.from([255,217]);class o extends i.Transform{_chunks=[];_size=0;_jpeg;get jpeg(){return this._jpeg}_sendJpeg(){this.emit("jpeg",this._jpeg)}_transform(e,t,r){const i=e.length;let o=0;for(;;)if(this._size){const t=e.indexOf(s);if(-1===t){this._chunks.push(e),this._size+=i;break}{o=t+2;const r=e.slice(0,o);if(this._chunks.push(r),this._size+=r.length,this._jpeg=Buffer.concat(this._chunks,this._size),this._chunks=[],this._size=0,this._sendJpeg(),o===i)break}}else{const t=e.indexOf(n,o);if(-1===t)break;o=t+500;const r=e.indexOf(s,o);if(-1===r){const r=e.slice(t);this._chunks=[r],this._size=r.length;break}if(o=r+2,this._jpeg=e.slice(t,o),this._sendJpeg(),o===i)break}r()}}t.Pipe2Jpeg=o},7016:e=>{"use strict";e.exports=require("url")},7370:(e,t,r)=>{var i;e.exports=function(){if(!i){try{i=r(1470)("follow-redirects")}catch(e){}"function"!=typeof i&&(i=function(){})}i.apply(null,arguments)}},7724:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=void 0;var i=r(4610);Object.defineProperty(t,"sleep",{enumerable:!0,get:function(){return i.sleep}})},8560:(e,t,r)=>{"use strict";const{asciiLowercase:i,solelyContainsHTTPTokenCodePoints:n,soleyContainsHTTPQuotedStringTokenCodePoints:s}=r(2661);e.exports=class{constructor(e){this._map=e}get size(){return this._map.size}get(e){return e=i(String(e)),this._map.get(e)}has(e){return e=i(String(e)),this._map.has(e)}set(e,t){if(e=i(String(e)),t=String(t),!n(e))throw new Error(`Invalid MIME type parameter name "${e}": only HTTP token code points are valid.`);if(!s(t))throw new Error(`Invalid MIME type parameter value "${t}": only HTTP quoted-string token code points are valid.`);return this._map.set(e,t)}clear(){this._map.clear()}delete(e){return e=i(String(e)),this._map.delete(e)}forEach(e,t){this._map.forEach(e,t)}keys(){return this._map.keys()}values(){return this._map.values()}entries(){return this._map.entries()}[Symbol.iterator](){return this._map[Symbol.iterator]()}}},8611:e=>{"use strict";e.exports=require("http")},9023:e=>{"use strict";e.exports=require("util")},9049:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHttpFetchParser=u,t.httpFetchParseIncomingMessage=d,t.httpFetch=async function(e){const t=(0,i.createHeadersArray)(e.headers);(0,i.setDefaultHttpFetchAccept)(t,e.responseType);const{once:s}=r(4434),{PassThrough:o,Readable:a}=r(2203),{http:c,https:u}=r(4165),{url:p}=e,l=p.toString().startsWith("https:")?u:c;let h,m,{body:g}=e;if(g&&!(g instanceof a)){const e=new o;e.write(Buffer.from((0,i.createStringOrBufferBody)(t,g))),e.end(),g=e}e.timeout&&(h=new AbortController,m=setTimeout((()=>h.abort()),e.timeout),e.signal?.addEventListener("abort",(()=>h.abort(e.signal?.reason))));const f=h?.signal||e.signal;f?.addEventListener("abort",(()=>v.destroy(new Error(e.signal?.reason||"abort"))));const y={};for(const[e,r]of t)y[e]?y[e].push(r):y[e]=[r];const v=l.request(p,{method:(0,i.getFetchMethod)(e),rejectUnauthorized:e.rejectUnauthorized,family:e.family,headers:y,signal:f,timeout:e.timeout});g?g.pipe(v):v.end();try{const[t]=await s(v,"response");if(void 0===e?.checkStatusCode||e?.checkStatusCode)try{const r="function"==typeof e?.checkStatusCode?e.checkStatusCode:i.checkStatus;if(!t.statusCode||!r(t.statusCode))throw new Error(`http response statusCode ${t.statusCode}`)}catch(e){throw n(t).catch((()=>{})),e}const r=new Headers;for(const[e,i]of Object.entries(t.headers))for(const t of"string"==typeof i?[i]:i)r.append(e,t);return{statusCode:t.statusCode,headers:r,body:await d(t,e.responseType)}}finally{clearTimeout(m)}};const i=r(9258);async function n(e){const t=[];e.on("data",(e=>t.push(e)));const{once:i}=r(4434);return await i(e,"end"),Buffer.concat(t)}const s={parse:async e=>(await n(e)).toString()},o={parse:async e=>JSON.parse((await n(e)).toString())},a={parse:async e=>n(e)},c={parse:async e=>e};function u(e){switch(e){case"json":return o;case"text":return s;case"readable":return c}return a}function d(e,t){return u(t).parse(e)}},9258:(e,t)=>{"use strict";function r(e){return e>=200&&e<=299}function i(e){if(!r(e))throw new Error(`http response statusCode ${e}`);return!0}function n(e){return e.method||(e.body?"POST":"GET")}function s(e){switch(e){case"json":return"application/json";case"text":return"text/plain"}}function o(e,t){return t=t.toLowerCase(),e.find((([e])=>e.toLowerCase()===t))}function a(e,t){t=t.toLowerCase();const r=e.filter((([e,r])=>e.toLowerCase()!==t));e.length=0,r.forEach((t=>e.push(t)))}function c(e,t,r){a(e,t),e.push([t,r])}function u(e,t){if(o(e,"Accept"))return;const r=s(t);r&&c(e,"Accept",r)}function d(e){const t=[];if(!e)return t;if(e instanceof Headers){for(const[r,i]of e.entries())t.push([r,i]);return t}if(e instanceof Array){for(const[r,i]of e)t.push([r,i]);return t}for(const r of Object.keys(e)){const i=e[r];t.push([r,i])}return t}function p(e,t){let r;return"object"==typeof t?(t=JSON.stringify(t),r="application/json"):"string"==typeof t&&(r="text/plain"),r&&!o(e,"Content-Type")&&c(e,"Content-Type",r),o(e,"Content-Length")||c(e,"Content-Length",(t=Buffer.from(t)).length.toString()),t}async function l(e,t){switch(t){case"json":return e.json();case"text":return e.text();case"readable":return e}return new Uint8Array(await e.arrayBuffer())}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchStatusCodeOk=r,t.checkStatus=i,t.getFetchMethod=n,t.getHttpFetchAccept=s,t.hasHeader=o,t.removeHeader=a,t.setHeader=c,t.setDefaultHttpFetchAccept=u,t.createHeadersArray=d,t.createStringOrBufferBody=p,t.domFetchParseIncomingMessage=l,t.domFetch=async function(e){const t=d(e.headers);u(t,e.responseType);let r,s,{body:o}=e;!o||o instanceof ReadableStream||(o=p(t,o));e.timeout&&(r=new AbortController,s=setTimeout((()=>r.abort()),e.timeout),e.signal?.addEventListener("abort",(()=>r.abort(e.signal?.reason))));try{const{url:s}=e,a=await fetch(s,{method:n(e),credentials:e.withCredentials?"include":void 0,headers:t,signal:r?.signal||e.signal,body:o});if(void 0===e?.checkStatusCode||e?.checkStatusCode)try{if(!("function"==typeof e?.checkStatusCode?e.checkStatusCode:i)(a.status))throw new Error(`http response statusCode ${a.status}`)}catch(e){throw a.arrayBuffer().catch((()=>{})),e}return{statusCode:a.status,headers:a.headers,body:await l(a,e.responseType)}}finally{clearTimeout(s)}}},9710:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let i=0,n=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(n=i))})),t.splice(n,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(5729)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},9849:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScryptedMimeTypes=t.ScryptedInterface=t.MediaPlayerState=t.SecuritySystemObstruction=t.SecuritySystemMode=t.AirQuality=t.AirPurifierMode=t.AirPurifierStatus=t.ChargeState=t.LockState=t.PanTiltZoomMovement=t.ThermostatMode=t.TemperatureUnit=t.FanMode=t.HumidityMode=t.ScryptedDeviceType=t.ScryptedInterfaceDescriptors=t.ScryptedInterfaceMethod=t.ScryptedInterfaceProperty=t.DeviceBase=t.TYPES_VERSION=void 0,t.TYPES_VERSION="0.5.51";var r,i,n,s,o,a,c,u,d,p,l,h,m,g,f,y,v,S;t.DeviceBase=class{},function(e){e.id="id",e.info="info",e.interfaces="interfaces",e.mixins="mixins",e.name="name",e.nativeId="nativeId",e.pluginId="pluginId",e.providedInterfaces="providedInterfaces",e.providedName="providedName",e.providedRoom="providedRoom",e.providedType="providedType",e.providerId="providerId",e.room="room",e.type="type",e.scryptedRuntimeArguments="scryptedRuntimeArguments",e.on="on",e.brightness="brightness",e.colorTemperature="colorTemperature",e.rgb="rgb",e.hsv="hsv",e.buttons="buttons",e.sensors="sensors",e.running="running",e.paused="paused",e.docked="docked",e.temperatureSetting="temperatureSetting",e.temperature="temperature",e.temperatureUnit="temperatureUnit",e.humidity="humidity",e.resolution="resolution",e.audioVolumes="audioVolumes",e.recordingActive="recordingActive",e.ptzCapabilities="ptzCapabilities",e.lockState="lockState",e.entryOpen="entryOpen",e.batteryLevel="batteryLevel",e.chargeState="chargeState",e.online="online",e.fromMimeType="fromMimeType",e.toMimeType="toMimeType",e.converters="converters",e.binaryState="binaryState",e.tampered="tampered",e.sleeping="sleeping",e.powerDetected="powerDetected",e.audioDetected="audioDetected",e.motionDetected="motionDetected",e.ambientLight="ambientLight",e.occupied="occupied",e.flooded="flooded",e.ultraviolet="ultraviolet",e.luminance="luminance",e.position="position",e.securitySystemState="securitySystemState",e.pm10Density="pm10Density",e.pm25Density="pm25Density",e.vocDensity="vocDensity",e.noxDensity="noxDensity",e.co2ppm="co2ppm",e.airQuality="airQuality",e.airPurifierState="airPurifierState",e.filterChangeIndication="filterChangeIndication",e.filterLifeLevel="filterLifeLevel",e.humiditySetting="humiditySetting",e.fan="fan",e.applicationInfo="applicationInfo",e.chatCompletionCapabilities="chatCompletionCapabilities",e.systemDevice="systemDevice"}(r||(t.ScryptedInterfaceProperty=r={})),function(e){e.listen="listen",e.probe="probe",e.setMixins="setMixins",e.setName="setName",e.setRoom="setRoom",e.setType="setType",e.getPluginJson="getPluginJson",e.turnOff="turnOff",e.turnOn="turnOn",e.setBrightness="setBrightness",e.getTemperatureMaxK="getTemperatureMaxK",e.getTemperatureMinK="getTemperatureMinK",e.setColorTemperature="setColorTemperature",e.setRgb="setRgb",e.setHsv="setHsv",e.pressButton="pressButton",e.sendNotification="sendNotification",e.start="start",e.stop="stop",e.pause="pause",e.resume="resume",e.dock="dock",e.setTemperature="setTemperature",e.setTemperatureUnit="setTemperatureUnit",e.getPictureOptions="getPictureOptions",e.takePicture="takePicture",e.getAudioStream="getAudioStream",e.setAudioVolumes="setAudioVolumes",e.startDisplay="startDisplay",e.stopDisplay="stopDisplay",e.getVideoStream="getVideoStream",e.getVideoStreamOptions="getVideoStreamOptions",e.getPrivacyMasks="getPrivacyMasks",e.setPrivacyMasks="setPrivacyMasks",e.getVideoTextOverlays="getVideoTextOverlays",e.setVideoTextOverlay="setVideoTextOverlay",e.getRecordingStream="getRecordingStream",e.getRecordingStreamCurrentTime="getRecordingStreamCurrentTime",e.getRecordingStreamOptions="getRecordingStreamOptions",e.getRecordingStreamThumbnail="getRecordingStreamThumbnail",e.deleteRecordingStream="deleteRecordingStream",e.setRecordingActive="setRecordingActive",e.ptzCommand="ptzCommand",e.getRecordedEvents="getRecordedEvents",e.getVideoClip="getVideoClip",e.getVideoClips="getVideoClips",e.getVideoClipThumbnail="getVideoClipThumbnail",e.removeVideoClips="removeVideoClips",e.setVideoStreamOptions="setVideoStreamOptions",e.startIntercom="startIntercom",e.stopIntercom="stopIntercom",e.lock="lock",e.unlock="unlock",e.addPassword="addPassword",e.getPasswords="getPasswords",e.removePassword="removePassword",e.activate="activate",e.deactivate="deactivate",e.isReversible="isReversible",e.closeEntry="closeEntry",e.openEntry="openEntry",e.getDevice="getDevice",e.releaseDevice="releaseDevice",e.adoptDevice="adoptDevice",e.discoverDevices="discoverDevices",e.createDevice="createDevice",e.getCreateDeviceSettings="getCreateDeviceSettings",e.reboot="reboot",e.getRefreshFrequency="getRefreshFrequency",e.refresh="refresh",e.getMediaStatus="getMediaStatus",e.load="load",e.seek="seek",e.skipNext="skipNext",e.skipPrevious="skipPrevious",e.convert="convert",e.convertMedia="convertMedia",e.getSettings="getSettings",e.putSetting="putSetting",e.armSecuritySystem="armSecuritySystem",e.disarmSecuritySystem="disarmSecuritySystem",e.setAirPurifierState="setAirPurifierState",e.getReadmeMarkdown="getReadmeMarkdown",e.getOauthUrl="getOauthUrl",e.onOauthCallback="onOauthCallback",e.canMixin="canMixin",e.getMixin="getMixin",e.releaseMixin="releaseMixin",e.onRequest="onRequest",e.onConnection="onConnection",e.onPush="onPush",e.run="run",e.eval="eval",e.loadScripts="loadScripts",e.saveScript="saveScript",e.forkInterface="forkInterface",e.getDetectionInput="getDetectionInput",e.getObjectTypes="getObjectTypes",e.detectObjects="detectObjects",e.generateObjectDetections="generateObjectDetections",e.getDetectionModel="getDetectionModel",e.setHumidity="setHumidity",e.setFan="setFan",e.startRTCSignalingSession="startRTCSignalingSession",e.createRTCSignalingSession="createRTCSignalingSession",e.getScryptedUserAccessControl="getScryptedUserAccessControl",e.generateVideoFrames="generateVideoFrames",e.connectStream="connectStream",e.getTTYSettings="getTTYSettings",e.getChatCompletion="getChatCompletion",e.streamChatCompletion="streamChatCompletion",e.getTextEmbedding="getTextEmbedding",e.getImageEmbedding="getImageEmbedding",e.callLLMTool="callLLMTool",e.getLLMTools="getLLMTools"}(i||(t.ScryptedInterfaceMethod=i={})),t.ScryptedInterfaceDescriptors={ScryptedDevice:{name:"ScryptedDevice",methods:["listen","probe","setMixins","setName","setRoom","setType"],properties:["id","info","interfaces","mixins","name","nativeId","pluginId","providedInterfaces","providedName","providedRoom","providedType","providerId","room","type"]},ScryptedPlugin:{name:"ScryptedPlugin",methods:["getPluginJson"],properties:[]},ScryptedPluginRuntime:{name:"ScryptedPluginRuntime",methods:[],properties:["scryptedRuntimeArguments"]},OnOff:{name:"OnOff",methods:["turnOff","turnOn"],properties:["on"]},Brightness:{name:"Brightness",methods:["setBrightness"],properties:["brightness"]},ColorSettingTemperature:{name:"ColorSettingTemperature",methods:["getTemperatureMaxK","getTemperatureMinK","setColorTemperature"],properties:["colorTemperature"]},ColorSettingRgb:{name:"ColorSettingRgb",methods:["setRgb"],properties:["rgb"]},ColorSettingHsv:{name:"ColorSettingHsv",methods:["setHsv"],properties:["hsv"]},Buttons:{name:"Buttons",methods:[],properties:["buttons"]},PressButtons:{name:"PressButtons",methods:["pressButton"],properties:[]},Sensors:{name:"Sensors",methods:[],properties:["sensors"]},Notifier:{name:"Notifier",methods:["sendNotification"],properties:[]},StartStop:{name:"StartStop",methods:["start","stop"],properties:["running"]},Pause:{name:"Pause",methods:["pause","resume"],properties:["paused"]},Dock:{name:"Dock",methods:["dock"],properties:["docked"]},TemperatureSetting:{name:"TemperatureSetting",methods:["setTemperature"],properties:["temperatureSetting"]},Thermometer:{name:"Thermometer",methods:["setTemperatureUnit"],properties:["temperature","temperatureUnit"]},HumiditySensor:{name:"HumiditySensor",methods:[],properties:["humidity"]},Camera:{name:"Camera",methods:["getPictureOptions","takePicture"],properties:[]},Resolution:{name:"Resolution",methods:[],properties:["resolution"]},Microphone:{name:"Microphone",methods:["getAudioStream"],properties:[]},AudioVolumeControl:{name:"AudioVolumeControl",methods:["setAudioVolumes"],properties:["audioVolumes"]},Display:{name:"Display",methods:["startDisplay","stopDisplay"],properties:[]},VideoCamera:{name:"VideoCamera",methods:["getVideoStream","getVideoStreamOptions"],properties:[]},VideoCameraMask:{name:"VideoCameraMask",methods:["getPrivacyMasks","setPrivacyMasks"],properties:[]},VideoTextOverlays:{name:"VideoTextOverlays",methods:["getVideoTextOverlays","setVideoTextOverlay"],properties:[]},VideoRecorder:{name:"VideoRecorder",methods:["getRecordingStream","getRecordingStreamCurrentTime","getRecordingStreamOptions","getRecordingStreamThumbnail"],properties:["recordingActive"]},VideoRecorderManagement:{name:"VideoRecorderManagement",methods:["deleteRecordingStream","setRecordingActive"],properties:[]},PanTiltZoom:{name:"PanTiltZoom",methods:["ptzCommand"],properties:["ptzCapabilities"]},EventRecorder:{name:"EventRecorder",methods:["getRecordedEvents"],properties:[]},VideoClips:{name:"VideoClips",methods:["getVideoClip","getVideoClips","getVideoClipThumbnail","removeVideoClips"],properties:[]},VideoCameraConfiguration:{name:"VideoCameraConfiguration",methods:["setVideoStreamOptions"],properties:[]},Intercom:{name:"Intercom",methods:["startIntercom","stopIntercom"],properties:[]},Lock:{name:"Lock",methods:["lock","unlock"],properties:["lockState"]},PasswordStore:{name:"PasswordStore",methods:["addPassword","getPasswords","removePassword"],properties:[]},Scene:{name:"Scene",methods:["activate","deactivate","isReversible"],properties:[]},Entry:{name:"Entry",methods:["closeEntry","openEntry"],properties:[]},EntrySensor:{name:"EntrySensor",methods:[],properties:["entryOpen"]},DeviceProvider:{name:"DeviceProvider",methods:["getDevice","releaseDevice"],properties:[]},DeviceDiscovery:{name:"DeviceDiscovery",methods:["adoptDevice","discoverDevices"],properties:[]},DeviceCreator:{name:"DeviceCreator",methods:["createDevice","getCreateDeviceSettings"],properties:[]},Battery:{name:"Battery",methods:[],properties:["batteryLevel"]},Charger:{name:"Charger",methods:[],properties:["chargeState"]},Reboot:{name:"Reboot",methods:["reboot"],properties:[]},Refresh:{name:"Refresh",methods:["getRefreshFrequency","refresh"],properties:[]},MediaPlayer:{name:"MediaPlayer",methods:["getMediaStatus","load","seek","skipNext","skipPrevious"],properties:[]},Online:{name:"Online",methods:[],properties:["online"]},BufferConverter:{name:"BufferConverter",methods:["convert"],properties:["fromMimeType","toMimeType"]},MediaConverter:{name:"MediaConverter",methods:["convertMedia"],properties:["converters"]},Settings:{name:"Settings",methods:["getSettings","putSetting"],properties:[]},BinarySensor:{name:"BinarySensor",methods:[],properties:["binaryState"]},TamperSensor:{name:"TamperSensor",methods:[],properties:["tampered"]},Sleep:{name:"Sleep",methods:[],properties:["sleeping"]},PowerSensor:{name:"PowerSensor",methods:[],properties:["powerDetected"]},AudioSensor:{name:"AudioSensor",methods:[],properties:["audioDetected"]},MotionSensor:{name:"MotionSensor",methods:[],properties:["motionDetected"]},AmbientLightSensor:{name:"AmbientLightSensor",methods:[],properties:["ambientLight"]},OccupancySensor:{name:"OccupancySensor",methods:[],properties:["occupied"]},FloodSensor:{name:"FloodSensor",methods:[],properties:["flooded"]},UltravioletSensor:{name:"UltravioletSensor",methods:[],properties:["ultraviolet"]},LuminanceSensor:{name:"LuminanceSensor",methods:[],properties:["luminance"]},PositionSensor:{name:"PositionSensor",methods:[],properties:["position"]},SecuritySystem:{name:"SecuritySystem",methods:["armSecuritySystem","disarmSecuritySystem"],properties:["securitySystemState"]},PM10Sensor:{name:"PM10Sensor",methods:[],properties:["pm10Density"]},PM25Sensor:{name:"PM25Sensor",methods:[],properties:["pm25Density"]},VOCSensor:{name:"VOCSensor",methods:[],properties:["vocDensity"]},NOXSensor:{name:"NOXSensor",methods:[],properties:["noxDensity"]},CO2Sensor:{name:"CO2Sensor",methods:[],properties:["co2ppm"]},AirQualitySensor:{name:"AirQualitySensor",methods:[],properties:["airQuality"]},AirPurifier:{name:"AirPurifier",methods:["setAirPurifierState"],properties:["airPurifierState"]},FilterMaintenance:{name:"FilterMaintenance",methods:[],properties:["filterChangeIndication","filterLifeLevel"]},Readme:{name:"Readme",methods:["getReadmeMarkdown"],properties:[]},OauthClient:{name:"OauthClient",methods:["getOauthUrl","onOauthCallback"],properties:[]},MixinProvider:{name:"MixinProvider",methods:["canMixin","getMixin","releaseMixin"],properties:[]},HttpRequestHandler:{name:"HttpRequestHandler",methods:["onRequest"],properties:[]},EngineIOHandler:{name:"EngineIOHandler",methods:["onConnection"],properties:[]},PushHandler:{name:"PushHandler",methods:["onPush"],properties:[]},Program:{name:"Program",methods:["run"],properties:[]},Scriptable:{name:"Scriptable",methods:["eval","loadScripts","saveScript"],properties:[]},ClusterForkInterface:{name:"ClusterForkInterface",methods:["forkInterface"],properties:[]},ObjectDetector:{name:"ObjectDetector",methods:["getDetectionInput","getObjectTypes"],properties:[]},ObjectDetection:{name:"ObjectDetection",methods:["detectObjects","generateObjectDetections","getDetectionModel"],properties:[]},ObjectDetectionPreview:{name:"ObjectDetectionPreview",methods:[],properties:[]},ObjectDetectionGenerator:{name:"ObjectDetectionGenerator",methods:[],properties:[]},HumiditySetting:{name:"HumiditySetting",methods:["setHumidity"],properties:["humiditySetting"]},Fan:{name:"Fan",methods:["setFan"],properties:["fan"]},RTCSignalingChannel:{name:"RTCSignalingChannel",methods:["startRTCSignalingSession"],properties:[]},RTCSignalingClient:{name:"RTCSignalingClient",methods:["createRTCSignalingSession"],properties:[]},LauncherApplication:{name:"LauncherApplication",methods:[],properties:["applicationInfo"]},ScryptedUser:{name:"ScryptedUser",methods:["getScryptedUserAccessControl"],properties:[]},VideoFrameGenerator:{name:"VideoFrameGenerator",methods:["generateVideoFrames"],properties:[]},StreamService:{name:"StreamService",methods:["connectStream"],properties:[]},TTY:{name:"TTY",methods:[],properties:[]},TTYSettings:{name:"TTYSettings",methods:["getTTYSettings"],properties:[]},ChatCompletion:{name:"ChatCompletion",methods:["getChatCompletion","streamChatCompletion"],properties:["chatCompletionCapabilities"]},TextEmbedding:{name:"TextEmbedding",methods:["getTextEmbedding"],properties:[]},ImageEmbedding:{name:"ImageEmbedding",methods:["getImageEmbedding"],properties:[]},LLMTools:{name:"LLMTools",methods:["callLLMTool","getLLMTools"],properties:[]},ScryptedSystemDevice:{name:"ScryptedSystemDevice",methods:[],properties:["systemDevice"]},ScryptedDeviceCreator:{name:"ScryptedDeviceCreator",methods:[],properties:[]},ScryptedSettings:{name:"ScryptedSettings",methods:[],properties:[]}},function(e){e.Builtin="Builtin",e.Internal="Internal",e.Camera="Camera",e.Fan="Fan",e.Light="Light",e.Switch="Switch",e.Outlet="Outlet",e.Sensor="Sensor",e.Scene="Scene",e.Program="Program",e.Automation="Automation",e.Vacuum="Vacuum",e.Notifier="Notifier",e.Thermostat="Thermostat",e.Lock="Lock",e.PasswordControl="PasswordControl",e.Display="Display",e.SmartDisplay="SmartDisplay",e.Speaker="Speaker",e.SmartSpeaker="SmartSpeaker",e.RemoteDesktop="RemoteDesktop",e.Event="Event",e.Entry="Entry",e.Garage="Garage",e.DeviceProvider="DeviceProvider",e.DataSource="DataSource",e.API="API",e.Buttons="Buttons",e.Doorbell="Doorbell",e.Irrigation="Irrigation",e.Valve="Valve",e.Person="Person",e.SecuritySystem="SecuritySystem",e.WindowCovering="WindowCovering",e.Siren="Siren",e.AirPurifier="AirPurifier",e.Internet="Internet",e.Network="Network",e.Bridge="Bridge",e.LLM="LLM",e.Unknown="Unknown"}(n||(t.ScryptedDeviceType=n={})),function(e){e.Humidify="Humidify",e.Dehumidify="Dehumidify",e.Auto="Auto",e.Off="Off"}(s||(t.HumidityMode=s={})),function(e){e.Auto="Auto",e.Manual="Manual"}(o||(t.FanMode=o={})),function(e){e.C="C",e.F="F"}(a||(t.TemperatureUnit=a={})),function(e){e.Off="Off",e.Cool="Cool",e.Heat="Heat",e.HeatCool="HeatCool",e.Auto="Auto",e.FanOnly="FanOnly",e.Purifier="Purifier",e.Eco="Eco",e.Dry="Dry",e.On="On"}(c||(t.ThermostatMode=c={})),function(e){e.Absolute="Absolute",e.Relative="Relative",e.Continuous="Continuous",e.Preset="Preset",e.Home="Home"}(u||(t.PanTiltZoomMovement=u={})),function(e){e.Locked="Locked",e.Unlocked="Unlocked",e.Jammed="Jammed"}(d||(t.LockState=d={})),function(e){e.Trickle="trickle",e.Charging="charging",e.NotCharging="not-charging"}(p||(t.ChargeState=p={})),function(e){e.Inactive="Inactive",e.Idle="Idle",e.Active="Active",e.ActiveNightMode="ActiveNightMode"}(l||(t.AirPurifierStatus=l={})),function(e){e.Manual="Manual",e.Automatic="Automatic"}(h||(t.AirPurifierMode=h={})),function(e){e.Unknown="Unknown",e.Excellent="Excellent",e.Good="Good",e.Fair="Fair",e.Inferior="Inferior",e.Poor="Poor"}(m||(t.AirQuality=m={})),function(e){e.Disarmed="Disarmed",e.HomeArmed="HomeArmed",e.AwayArmed="AwayArmed",e.NightArmed="NightArmed"}(g||(t.SecuritySystemMode=g={})),function(e){e.Sensor="Sensor",e.Occupied="Occupied",e.Time="Time",e.Error="Error"}(f||(t.SecuritySystemObstruction=f={})),function(e){e.Idle="Idle",e.Playing="Playing",e.Paused="Paused",e.Buffering="Buffering"}(y||(t.MediaPlayerState=y={})),function(e){e.ScryptedDevice="ScryptedDevice",e.ScryptedPlugin="ScryptedPlugin",e.ScryptedPluginRuntime="ScryptedPluginRuntime",e.OnOff="OnOff",e.Brightness="Brightness",e.ColorSettingTemperature="ColorSettingTemperature",e.ColorSettingRgb="ColorSettingRgb",e.ColorSettingHsv="ColorSettingHsv",e.Buttons="Buttons",e.PressButtons="PressButtons",e.Sensors="Sensors",e.Notifier="Notifier",e.StartStop="StartStop",e.Pause="Pause",e.Dock="Dock",e.TemperatureSetting="TemperatureSetting",e.Thermometer="Thermometer",e.HumiditySensor="HumiditySensor",e.Camera="Camera",e.Resolution="Resolution",e.Microphone="Microphone",e.AudioVolumeControl="AudioVolumeControl",e.Display="Display",e.VideoCamera="VideoCamera",e.VideoCameraMask="VideoCameraMask",e.VideoTextOverlays="VideoTextOverlays",e.VideoRecorder="VideoRecorder",e.VideoRecorderManagement="VideoRecorderManagement",e.PanTiltZoom="PanTiltZoom",e.EventRecorder="EventRecorder",e.VideoClips="VideoClips",e.VideoCameraConfiguration="VideoCameraConfiguration",e.Intercom="Intercom",e.Lock="Lock",e.PasswordStore="PasswordStore",e.Scene="Scene",e.Entry="Entry",e.EntrySensor="EntrySensor",e.DeviceProvider="DeviceProvider",e.DeviceDiscovery="DeviceDiscovery",e.DeviceCreator="DeviceCreator",e.Battery="Battery",e.Charger="Charger",e.Reboot="Reboot",e.Refresh="Refresh",e.MediaPlayer="MediaPlayer",e.Online="Online",e.BufferConverter="BufferConverter",e.MediaConverter="MediaConverter",e.Settings="Settings",e.BinarySensor="BinarySensor",e.TamperSensor="TamperSensor",e.Sleep="Sleep",e.PowerSensor="PowerSensor",e.AudioSensor="AudioSensor",e.MotionSensor="MotionSensor",e.AmbientLightSensor="AmbientLightSensor",e.OccupancySensor="OccupancySensor",e.FloodSensor="FloodSensor",e.UltravioletSensor="UltravioletSensor",e.LuminanceSensor="LuminanceSensor",e.PositionSensor="PositionSensor",e.SecuritySystem="SecuritySystem",e.PM10Sensor="PM10Sensor",e.PM25Sensor="PM25Sensor",e.VOCSensor="VOCSensor",e.NOXSensor="NOXSensor",e.CO2Sensor="CO2Sensor",e.AirQualitySensor="AirQualitySensor",e.AirPurifier="AirPurifier",e.FilterMaintenance="FilterMaintenance",e.Readme="Readme",e.OauthClient="OauthClient",e.MixinProvider="MixinProvider",e.HttpRequestHandler="HttpRequestHandler",e.EngineIOHandler="EngineIOHandler",e.PushHandler="PushHandler",e.Program="Program",e.Scriptable="Scriptable",e.ClusterForkInterface="ClusterForkInterface",e.ObjectDetector="ObjectDetector",e.ObjectDetection="ObjectDetection",e.ObjectDetectionPreview="ObjectDetectionPreview",e.ObjectDetectionGenerator="ObjectDetectionGenerator",e.HumiditySetting="HumiditySetting",e.Fan="Fan",e.RTCSignalingChannel="RTCSignalingChannel",e.RTCSignalingClient="RTCSignalingClient",e.LauncherApplication="LauncherApplication",e.ScryptedUser="ScryptedUser",e.VideoFrameGenerator="VideoFrameGenerator",e.StreamService="StreamService",e.TTY="TTY",e.TTYSettings="TTYSettings",e.ChatCompletion="ChatCompletion",e.TextEmbedding="TextEmbedding",e.ImageEmbedding="ImageEmbedding",e.LLMTools="LLMTools",e.ScryptedSystemDevice="ScryptedSystemDevice",e.ScryptedDeviceCreator="ScryptedDeviceCreator",e.ScryptedSettings="ScryptedSettings"}(v||(t.ScryptedInterface=v={})),function(e){e.Url="text/x-uri",e.InsecureLocalUrl="text/x-insecure-local-uri",e.LocalUrl="text/x-local-uri",e.ServerId="text/x-server-id",e.PushEndpoint="text/x-push-endpoint",e.SchemePrefix="x-scrypted/x-scrypted-scheme-",e.MediaStreamUrl="text/x-media-url",e.MediaObject="x-scrypted/x-scrypted-media-object",e.RequestMediaObject="x-scrypted/x-scrypted-request-media-object",e.RequestMediaStream="x-scrypted/x-scrypted-request-stream",e.MediaStreamFeedback="x-scrypted/x-media-stream-feedback",e.FFmpegInput="x-scrypted/x-ffmpeg-input",e.FFmpegTranscodeStream="x-scrypted/x-ffmpeg-transcode-stream",e.RTCSignalingChannel="x-scrypted/x-scrypted-rtc-signaling-channel",e.RTCSignalingSession="x-scrypted/x-scrypted-rtc-signaling-session",e.RTCConnectionManagement="x-scrypted/x-scrypted-rtc-connection-management",e.Image="x-scrypted/x-scrypted-image"}(S||(t.ScryptedMimeTypes=S={}))},9896:e=>{"use strict";e.exports=require("fs")}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,r),s.exports}r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i=r(431),n=exports="undefined"==typeof exports?{}:exports;for(var s in i)n[s]=i[s];i.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();
//# sourceMappingURL=main.nodejs.js.map