/*! For license information please see main.nodejs.js.LICENSE.txt */
(()=>{var e={2:(e,t,r)=>{"use strict";const s=r(1641);function n(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}e.exports={isType:function(e){return i(e)&&n(e.encode)&&n(e.decode)},isUserType:s,isFunction:n,isDecodeType:function(e){return i(e)&&n(e.decode)},isEncodeType:function(e){return i(e)&&n(e.encode)}}},59:(e,t,r)=>{"use strict";const s=r(6101);e.exports=class e{constructor(){this[s.bytes]=0,this.node=void 0,this.current=void 0}get bytes(){return this[s.bytes]}static clone(t){const r=new e;return t instanceof e&&(r.node=t.node,r.current=t.current),r}static clean(t){t instanceof e&&(t.node=void 0,t.current=void 0)}}},66:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BitStream=t.dumpBuffer=t.BufferChain=t.BitWriter2=t.BitWriter=void 0,t.random16=function(){return n.jspack.Unpack("!H",(0,s.randomBytes)(2))[0]},t.random32=function(){return n.jspack.Unpack("!L",(0,s.randomBytes)(4))[0]},t.bufferXor=function(e,t){if(e.length!==t.length)throw new TypeError("[webrtc-stun] You can not XOR buffers which length are different");const r=e.length,s=Buffer.allocUnsafe(r);for(let n=0;n<r;n++)s[n]=e[n]^t[n];return s},t.bufferArrayXor=function(e){const t=[...e].sort(((e,t)=>e.length-t.length)).reverse()[0].length,r=Buffer.allocUnsafe(t);for(let s=0;s<t;s++)r[s]=0,e.forEach((e=>{r[s]^=e[s]??0}));return r},t.getBit=function(e,t,r=1){let s=e.toString(2).split("");s=[...Array(8-s.length).fill("0"),...s];const n=s.slice(t,t+r).join("");return Number.parseInt(n,2)},t.paddingByte=function(e){const t=e.toString(2).split("");return[...[...Array(8-t.length)].map((()=>"0")),...t].join("")},t.paddingBits=function(e,t){const r=e.toString(2);return[...[...Array(t-r.length)].map((()=>"0")),...r].join("")},t.bufferWriter=function(e,t){return i(e)(t)},t.createBufferWriter=i,t.bufferWriterLE=function(e,t){const r=e.reduce(((e,t)=>e+t),0),s=Buffer.alloc(r);let n=0;return t.forEach(((t,r)=>{const i=e[r];8===i?s.writeBigUInt64LE(t,n):s.writeUIntLE(t,n,i),n+=i})),s},t.bufferReader=function(e,t){let r=0;return t.map((t=>{let s;return s=8===t?e.readBigUInt64BE(r):e.readUIntBE(r,t),r+=t,s}))},t.buffer2ArrayBuffer=function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)};const s=r(6982),n=r(4694);t.BitWriter=class{constructor(e){this.bitLength=e,this.value=0}set(e,t,r){return r&=(1<<e)-1,this.value|=r<<this.bitLength-e-t,this}get buffer(){const e=Math.ceil(this.bitLength/8),t=Buffer.alloc(e);return t.writeUIntBE(this.value,0,e),t}};function i(e,t){const r=e.reduce(((e,t)=>e+t),0),s=t?Buffer.alloc(r):void 0;return t=>{const n=s||Buffer.alloc(r);let i=0;return t.forEach(((t,r)=>{const s=e[r];8===s?n.writeBigUInt64BE(t,i):n.writeUIntBE(t,i,s),i+=s})),n}}t.BitWriter2=class{constructor(e){if(this.bitLength=e,this._value=0n,this.offset=0n,e>32)throw new Error}set(e,t=1){let r=BigInt(e);const s=BigInt(t);return r&=(1n<<s)-1n,this._value|=r<<BigInt(this.bitLength)-s-this.offset,this.offset+=s,this}get value(){return Number(this._value)}get buffer(){const e=Math.ceil(this.bitLength/8),t=Buffer.alloc(e);return t.writeUIntBE(this.value,0,e),t}};t.BufferChain=class{constructor(e){this.buffer=Buffer.alloc(e)}writeInt16BE(e,t){return this.buffer.writeInt16BE(e,t),this}writeUInt8(e,t){return this.buffer.writeUInt8(e,t),this}};t.dumpBuffer=e=>"0x"+e.toString("hex").replace(/(.)(.)/g,"$1$2 ").split(" ").filter((e=>null!=e&&e.length>0)).join(",0x");t.BitStream=class{constructor(e){this.uint8Array=e,this.position=0,this.bitsPending=0}writeBits(e,t){if(0==e)return this;let r;return t&=4294967295>>>32-e,this.bitsPending>0?this.bitsPending>e?(this.uint8Array[this.position-1]|=t<<this.bitsPending-e,r=e,this.bitsPending-=e):this.bitsPending==e?(this.uint8Array[this.position-1]|=t,r=e,this.bitsPending=0):(this.uint8Array[this.position-1]|=t>>e-this.bitsPending,r=this.bitsPending,this.bitsPending=0):(r=Math.min(8,e),this.bitsPending=8-r,this.uint8Array[this.position++]=t>>e-r<<this.bitsPending),(e-=r)>0&&this.writeBits(e,t),this}readBits(e){return this._readBits(e)}_readBits(e,t){if("undefined"==typeof t&&(t=0),0==e)return t;let r,s;if(this.bitsPending>0){const t=this.uint8Array[this.position-1]&255>>8-this.bitsPending;s=Math.min(this.bitsPending,e),this.bitsPending-=s,r=t>>this.bitsPending}else s=Math.min(8,e),this.bitsPending=8-s,r=this.uint8Array[this.position++]>>this.bitsPending;return t=t<<s|r,(e-=s)>0?this._readBits(e,t):t}seekTo(e){this.position=e/8|0,this.bitsPending=e%8,this.bitsPending>0&&(this.bitsPending=8-this.bitsPending,this.position++)}}},91:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.prfPreMasterSecret=function(e,t,r){switch(r){case a.NamedCurveAlgorithm.secp256r1_23:return(0,c.p256PreMasterSecret)({publicKey:e,privateKey:t});case a.NamedCurveAlgorithm.x25519_29:return Buffer.from(o.default.scalarMult(t,e));default:throw new Error}},t.hmac=u,t.prfPHash=l,t.prfMasterSecret=function(e,t,r){const s=Buffer.concat([Buffer.from("master secret"),t,r]);return l(e,s,48)},t.prfExtendedMasterSecret=function(e,t){const r=d("sha256",t);return l(e,Buffer.concat([Buffer.from("extended master secret"),r]),48)},t.exportKeyingMaterial=function(e,t,r,s,n,i){const o=i?s:n,a=i?n:s,c=Buffer.concat([Buffer.from(e),o,a]);return l(r,c,t)},t.hash=d,t.prfVerifyData=h,t.prfVerifyDataClient=function(e,t){return h(e,t,"client finished")},t.prfVerifyDataServer=function(e,t){return h(e,t,"server finished")},t.prfEncryptionKeys=function(e,t,r,s,n,o,a="sha256"){const c=2*s+2*n,u=e,d=Buffer.concat([r,t]),h=l(u,Buffer.concat([Buffer.from("key expansion"),d]),c,a),p=(0,i.createDecode)(h),f=p.readBuffer(s),g=p.readBuffer(s),m=p.readBuffer(n),y=p.readBuffer(n),b=Buffer.alloc(o,0),v=Buffer.alloc(o,0);return m.copy(b,0),y.copy(v,0),{clientWriteKey:f,serverWriteKey:g,clientNonce:b,serverNonce:v}};const n=r(6982),i=r(6353),o=s(r(4522)),a=r(4148),c=r(1447);function u(e,t,r){const s=(0,n.createHmac)(e,t);return s.update(r),s.digest()}function l(e,t,r,s="sha256"){const n=r,i=[];let o=t;do{o=u(s,e,o);const n=u(s,e,Buffer.concat([o,t]));i.push(n),r-=n.length}while(r>0);return Buffer.concat(i,n)}function d(e,t){return(0,n.createHash)(e).update(t).digest()}function h(e,t,r,s=12){const n=d("sha256",t);return l(e,Buffer.concat([Buffer.from(r),n]),s)}},145:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unwrapRtx=function(e,t,r){return new n.RtpPacket(new n.RtpHeader({payloadType:t,marker:e.header.marker,sequenceNumber:s.jspack.Unpack("!H",e.payload.subarray(0,2))[0],timestamp:e.header.timestamp,ssrc:r}),e.payload.subarray(2))},t.wrapRtx=function(e,t,r,i){return new n.RtpPacket(new n.RtpHeader({payloadType:t,marker:e.header.marker,sequenceNumber:r,timestamp:e.header.timestamp,ssrc:i,csrc:e.header.csrc,extensions:e.header.extensions}),Buffer.concat([Buffer.from(s.jspack.Pack("!H",[e.header.sequenceNumber])),e.payload]))};const s=r(4694),n=r(1193)},169:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;const n=r(6982),i=s(r(7019)),o=r(9447),a=r(1133),c=r(6157);t.Context=class{constructor(e,t,r){this.masterKey=e,this.masterSalt=t,this.profile=r,this.srtpSSRCStates={},this.srtcpSSRCStates={};{const e=14-t.length;e>0&&(this.masterSalt=Buffer.concat([t,Buffer.alloc(e)]))}switch(this.srtpSessionKey=this.generateSessionKey(0),this.srtpSessionSalt=this.generateSessionSalt(2),this.srtpSessionAuthTag=this.generateSessionAuthTag(1),this.srtpSessionAuth=(0,n.createHmac)("sha1",this.srtpSessionAuthTag),this.srtcpSessionKey=this.generateSessionKey(3),this.srtcpSessionSalt=this.generateSessionSalt(5),this.srtcpSessionAuthTag=this.generateSessionAuthTag(4),this.srtcpSessionAuth=(0,n.createHmac)("sha1",this.srtcpSessionAuthTag),r){case c.ProtectionProfileAes128CmHmacSha1_80:this.cipher=new o.CipherAesCtr(this.srtpSessionKey,this.srtpSessionSalt,this.srtcpSessionKey,this.srtcpSessionSalt,this.srtpSessionAuthTag,this.srtcpSessionAuthTag);break;case c.ProtectionProfileAeadAes128Gcm:this.cipher=new a.CipherAesGcm(this.srtpSessionKey,this.srtpSessionSalt,this.srtcpSessionKey,this.srtcpSessionSalt)}}generateSessionKey(e){let t=Buffer.from(this.masterSalt);const r=Buffer.from([e,0,0,0,0,0,0]);for(let e=r.length-1,s=t.length-1;e>=0;e--,s--)t[s]=t[s]^r[e];t=Buffer.concat([t,Buffer.from([0,0])]);const s=new i.default.AES(this.masterKey);return Buffer.from(s.encrypt(t))}generateSessionSalt(e){let t=Buffer.from(this.masterSalt);const r=Buffer.from([e,0,0,0,0,0,0]);for(let e=r.length-1,s=t.length-1;e>=0;e--,s--)t[s]=t[s]^r[e];t=Buffer.concat([t,Buffer.from([0,0])]);const s=new i.default.AES(this.masterKey);return t=Buffer.from(s.encrypt(t)),t.subarray(0,14)}generateSessionAuthTag(e){const t=Buffer.from(this.masterSalt),r=Buffer.from([e,0,0,0,0,0,0]);for(let e=r.length-1,s=t.length-1;e>=0;e--,s--)t[s]=t[s]^r[e];let s=Buffer.concat([t,Buffer.from([0,0])]),n=Buffer.concat([t,Buffer.from([0,1])]);const o=new i.default.AES(this.masterKey);return s=Buffer.from(o.encrypt(s)),n=Buffer.from(o.encrypt(n)),Buffer.concat([s,n.subarray(0,4)])}getSrtpSsrcState(e){let t=this.srtpSSRCStates[e];return t||(t={ssrc:e,rolloverCounter:0,lastSequenceNumber:0},this.srtpSSRCStates[e]=t,t)}getSrtcpSsrcState(e){let t=this.srtcpSSRCStates[e];return t||(t={srtcpIndex:0,ssrc:e},this.srtcpSSRCStates[e]=t,t)}updateRolloverCount(e,t){t.rolloverHasProcessed?0===e?t.lastSequenceNumber>u&&t.rolloverCounter++:t.lastSequenceNumber<u&&e>l-u?t.rolloverCounter>0&&t.rolloverCounter--:e<u&&t.lastSequenceNumber>l-u&&t.rolloverCounter++:t.rolloverHasProcessed=!0,t.lastSequenceNumber=e}generateSrtpAuthTag(e,t){this.srtpSessionAuth=(0,n.createHmac)("sha1",this.srtpSessionAuthTag);const r=Buffer.alloc(4);return r.writeUInt32BE(t),this.srtpSessionAuth.update(e).update(r).digest().slice(0,10)}index(e){const t=this.srtcpSSRCStates[e];return t?t.srtcpIndex:0}setIndex(e,t){this.getSrtcpSsrcState(e).srtcpIndex=t%2147483647}};const u=100,l=65535},181:e=>{"use strict";e.exports=require("buffer")},188:e=>{"use strict";e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var s,n,i;if(Array.isArray(t)){if((s=t.length)!=r.length)return!1;for(n=s;0!==n--;)if(!e(t[n],r[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((s=(i=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(n=s;0!==n--;)if(!Object.prototype.hasOwnProperty.call(r,i[n]))return!1;for(n=s;0!==n--;){var o=i[n];if(!e(t[o],r[o]))return!1}return!0}return t!=t&&r!=r}},228:(e,t,r)=>{"use strict";const{isType:s,isFunction:n,isUserType:i}=r(2),o=r(6101),{decodeCommon:a}=r(7868),{encodeCommon:c}=r(1620),{encodingLengthCommon:u}=r(1236),l=r(59);e.exports=function(e,t){if(!s(t)&&!i(t))throw new TypeError("Argument #2 should be a valid type.");const r={encode:function s(i,a){const u=l.clone(this);s.bytes=0;const d=n(e)?Boolean(e(u)):Boolean(e);if(r[o.skip]=!d,!d)return void l.clean(u);c(i,a,t,u),s.bytes=u.bytes,l.clean(u)},decode:function s(i){const c=l.clone(this);s.bytes=0;const u=n(e)?Boolean(e(c)):Boolean(e);if(r[o.skip]=!u,!u)return void l.clean(c);const d=a(i,t,c);return s.bytes=c.bytes,l.clean(c),d},encodingLength:function(r){const s=l.clone(this);(n(e)?Boolean(e(s)):Boolean(e))&&u(r,t,s);return l.clean(s),s.bytes},[o.skip]:!1};return r}},256:(e,t,r)=>{"use strict";const s=r(6736);function n(e,t,r){const n=s(),i=s();return n(`\n    function decode_${r}(rstream) {\n      decode_${r}.bytes = ${n.formats.d(e)};\n      return rstream.${r}()\n    }\n  `),i(`\n    function encode_${t}(value, wstream) {\n      wstream.${t}(value);\n      encode_${t}.bytes = ${n.formats.d(e)};\n    }\n  `),{encodingLength:()=>e,encode:i.toFunction(),decode:n.toFunction()}}function i(e,t,r){const n=s(),i=s();return n(`\n    function decode_${r}(rstream) {\n      decode_${r}.bytes = ${n.formats.d(e)};\n      return rstream.${r}(${n.formats.d(e)})\n    }\n  `),i(`\n    function encode_${t}(value, wstream) {\n      wstream.${t}(value, ${n.formats.d(e)});\n      encode_${t}.bytes = ${n.formats.d(e)};\n    }\n  `),{encodingLength:()=>e,encode:i.toFunction(),decode:n.toFunction()}}e.exports={doublebe:n(8,"writeDoubleBE","readDoubleBE"),doublele:n(8,"writeDoubleLE","readDoubleLE"),floatbe:n(4,"writeFloatBE","readFloatBE"),floatle:n(4,"writeFloatLE","readFloatLE"),int8:n(1,"writeInt8","readInt8"),uint8:n(1,"writeUInt8","readUInt8"),int16be:n(2,"writeInt16BE","readInt16BE"),uint16be:n(2,"writeUInt16BE","readUInt16BE"),int16le:n(2,"writeInt16LE","readInt16LE"),uint16le:n(2,"writeUInt16LE","readUInt16LE"),int32be:n(4,"writeInt32BE","readInt32BE"),uint32be:n(4,"writeUInt32BE","readUInt32BE"),int32le:n(4,"writeInt32LE","readInt32LE"),uint32le:n(4,"writeUInt32LE","readUInt32LE"),int24be:i(3,"writeIntBE","readIntBE"),uint24be:i(3,"writeUIntBE","readUIntBE"),int24le:i(3,"writeIntLE","readIntLE"),uint24le:i(3,"writeUIntLE","readUIntLE"),int40be:i(5,"writeIntBE","readIntBE"),uint40be:i(5,"writeUIntBE","readUIntBE"),int40le:i(5,"writeIntLE","readIntLE"),uint40le:i(5,"writeUIntLE","readUIntLE"),int48be:i(6,"writeIntBE","readIntBE"),uint48be:i(6,"writeUIntBE","readUIntBE"),int48le:i(6,"writeIntLE","readIntLE"),uint48le:i(6,"writeUIntLE","readUIntLE")}},269:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Flight1=void 0;const s=r(4148),n=r(4953),i=r(9750),o=r(3254);class a extends o.Flight{constructor(e,t,r){super(e,t,1,3),this.cipher=r}async exec(e){if(1===this.dtls.flight)throw new Error;this.dtls.flight=1;const t=new n.ClientHello({major:254,minor:253},new i.DtlsRandom,Buffer.from([]),Buffer.from([]),s.CipherSuiteList,[0],e);this.dtls.version=t.clientVersion,this.cipher.localRandom=i.DtlsRandom.from(t.random);const r=this.createPacket([t]),o=Buffer.concat(r.map((e=>e.serialize())));await this.transmit([o])}}t.Flight1=a},314:(e,t,r)=>{const s=r(2018),n=r(9023);t.init=function(e){e.inspectOpts={};const r=Object.keys(t.inspectOpts);for(let s=0;s<r.length;s++)e.inspectOpts[r[s]]=t.inspectOpts[r[s]]},t.log=function(...e){return process.stderr.write(n.formatWithOptions(t.inspectOpts,...e)+"\n")},t.formatArgs=function(r){const{namespace:s,useColors:n}=this;if(n){const t=this.color,n="[3"+(t<8?t:"8;5;"+t),i=`  ${n};1m${s} [0m`;r[0]=i+r[0].split("\n").join("\n"+i),r.push(n+"m+"+e.exports.humanize(this.diff)+"[0m")}else r[0]=function(){if(t.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+s+" "+r[0]},t.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},t.load=function(){return process.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):s.isatty(process.stderr.fd)},t.destroy=n.deprecate((()=>{}),"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{const e=r(8551);e&&(e.stderr||e).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}t.inspectOpts=Object.keys(process.env).filter((e=>/^debug_/i.test(e))).reduce(((e,t)=>{const r=t.substring(6).toLowerCase().replace(/_([a-z])/g,((e,t)=>t.toUpperCase()));let s=process.env[t];return s=!!/^(yes|on|true|enabled)$/i.test(s)||!/^(no|off|false|disabled)$/i.test(s)&&("null"===s?null:Number(s)),e[r]=s,e}),{}),e.exports=r(2887)(t);const{formatters:i}=e.exports;i.o=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts).split("\n").map((e=>e.trim())).join(" ")},i.O=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts)}},336:function(e,t,r){"use strict";var s,n=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=s(e),o=0;o<r.length;o++)"default"!==r[o]&&n(t,e,r[o]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RtspServer=t.RtspClient=t.RtspBase=t.RtspStatusError=t.H265_NAL_TYPE_SEI_SUFFIX=t.H265_NAL_TYPE_SEI_PREFIX=t.H265_NAL_TYPE_FU=t.H265_NAL_TYPE_CRA_NUT=t.H265_NAL_TYPE_IDR_N_LP=t.H265_NAL_TYPE_IDR_W_RADL=t.H265_NAL_TYPE_BLA_N_LP=t.H265_NAL_TYPE_BLA_W_RADL=t.H265_NAL_TYPE_BLA_W_LP=t.H265_NAL_TYPE_PPS=t.H265_NAL_TYPE_SPS=t.H265_NAL_TYPE_VPS=t.H265_NAL_TYPE_AGG=t.H264_NAL_TYPE_MTAP32=t.H264_NAL_TYPE_MTAP16=t.H264_NAL_TYPE_FU_B=t.H264_NAL_TYPE_FU_A=t.H264_NAL_TYPE_STAP_B=t.H264_NAL_TYPE_STAP_A=t.H264_NAL_TYPE_PPS=t.H264_NAL_TYPE_SPS=t.H264_NAL_TYPE_SEI=t.H264_NAL_TYPE_IDR=t.H264_NAL_TYPE_RESERVED31=t.H264_NAL_TYPE_RESERVED30=t.H264_NAL_TYPE_RESERVED0=t.RTSP_FRAME_MAGIC=void 0,t.readMessage=S,t.readBody=w,t.writeMessage=E,t.findH264NaluType=function(e,t){if("h264"!==e.type)return;return T(e.chunks[e.chunks.length-1].subarray(12),t)},t.findH265NaluType=function(e,t){if("h265"!==e.type)return;return _(e.chunks[e.chunks.length-1].subarray(12),t)},t.parseH264NaluType=C,t.findH264NaluTypeInNalu=T,t.findH265NaluTypeInNalu=_,t.getStartedH264NaluTypes=A,t.getNaluTypesInNalu=R,t.getStartedH265NaluTypes=P,t.getNaluTypesInH265Nalu=k,t.isH265KeyFrameRelatedInSet=B,t.createRtspParser=function(e){let r;return{container:"rtsp",tcpProtocol:"rtsp://127.0.0.1/"+(0,c.randomBytes)(8).toString("hex"),inputArguments:["-rtsp_transport","tcp"],outputArguments:["-rtsp_transport","tcp",...e?.vcodec||[],...e?.acodec||[],"-pkt_size","32000","-f","rtsp"],findSyncFrame(e){for(let r=0;r<e.length;r++){const s=e[r];if("h264"===s.type){const n=A(s);if(n.has(t.H264_NAL_TYPE_SPS)||n.has(t.H264_NAL_TYPE_IDR))return e.slice(r)}else if("h265"===s.type){if(B(P(s)))return e.slice(r)}}},sdp:new Promise((e=>r=e)),async*parse(e,t,s){const n=new M(e);await n.handleSetup(),r(n.sdp);for await(const{type:e,rtcp:r,header:i,packet:o}of n.handleRecord())yield{chunks:[i,o],type:`${r?"rtcp-":""}${e}`,width:t,height:s}}}},t.parseHeaders=O,t.getFirstAuthenticateHeader=x,t.parseSemicolonDelimited=N,t.listenSingleRtspClient=async function(e){const t=e?.pathToken||c.default.randomBytes(8).toString("hex");let{url:r,clientPromise:s,server:n}=await(0,f.listenZeroSingleClient)(e?.hostname);const i="/"+t;r=r.replace("tcp:","rtsp:")+i;const o=s.then((t=>{const r=(e?.createServer||(e=>new M(e)))(t);return r.checkRequest=async(e,t,s,n)=>{r.checkRequest=void 0;return new h.URL(t).pathname===i},r}));return{url:r,rtspServerPromise:o,server:n}};const c=o(r(6982)),u=r(4434),l=a(r(9278)),d=a(r(4756)),h=r(7016),p=r(3290),f=r(3515),g=r(488),m=r(8460),y=r(4890),b=r(7724),v=["realm","nonce"];async function S(e){let t=[];for(;;){let r=await(0,m.readLine)(e);if(r=r.trim(),!r)return t;t.push(r)}}async function w(e,t){const r=parseInt(t["content-length"]);if(r)return(0,m.readLength)(e,r)}function E(e,t,r,s,n){let i=void 0!==t?`${t}\r\n`:"";r&&(s["Content-Length"]=r.length.toString());for(const[e,t]of Object.entries(s))i+=`${e}: ${t}\r\n`;i+="\r\n",e.write(i),n?.log("rtsp outgoing message\n",i),n?.log(),r&&e.write(r)}function C(e){return 31&e}function T(e,r){const s=C(e[0]);if(s===t.H264_NAL_TYPE_STAP_A){let t=1;for(;t<e.length;){const s=e.readUInt16BE(t);t+=2;if(C(e[t])===r)return e.subarray(t,t+s);t+=s}}else if(s===t.H264_NAL_TYPE_FU_A){const t=C(e[1]),s=!!(128&e[1]);if(t===r&&s)return e.subarray(1)}else if(s===r)return e}function I(e){return(126&e)>>1}function _(e,r){const s=I(e[0]);if(s===t.H265_NAL_TYPE_AGG){let t=1;for(;t<e.length;){const s=e.readUInt16BE(t);t+=2;if(I(e[t])===r)return e.subarray(t,t+s);t+=s}}else if(s===r)return e}function A(e){return"h264"!==e.type?new Set:R(e.chunks[e.chunks.length-1].subarray(12),!0)}function R(e,r=!1,s=!1){const n=new Set,i=C(e[0]);if(i===t.H264_NAL_TYPE_STAP_A){n.add(t.H264_NAL_TYPE_STAP_A);let r=1;for(;r<e.length;){const t=e.readUInt16BE(r);r+=2;const s=C(e[r]);n.add(s),r+=t}}else if(i===t.H264_NAL_TYPE_FU_A){n.add(t.H264_NAL_TYPE_FU_A);const i=C(e[1]);if(r){!!(128&e[1])&&n.add(i)}else if(s){!!(64&e[1])&&n.add(i)}else n.add(i)}else n.add(i);return n}function P(e){return"h265"!==e.type?new Set:k(e.chunks[e.chunks.length-1].subarray(12),!0)}function k(e,r=!1,s=!1){const n=new Set,i=I(e[0]);if(i===t.H265_NAL_TYPE_AGG){n.add(t.H265_NAL_TYPE_AGG);let r=2;for(;r<e.length;){const t=e.readUInt16BE(r);r+=2;const s=I(e[r]);n.add(s),r+=t}}else if(i===t.H265_NAL_TYPE_FU){n.add(t.H265_NAL_TYPE_FU);const i=63&e[2];if(r){!!(128&e[2])&&n.add(i)}else if(s){!!(64&e[2])&&n.add(i)}else n.add(i)}else n.add(i);return n}function B(e,r=!0){return!!(e.has(t.H265_NAL_TYPE_IDR_N_LP)||e.has(t.H265_NAL_TYPE_IDR_W_RADL)||e.has(t.H265_NAL_TYPE_CRA_NUT)||e.has(t.H265_NAL_TYPE_BLA_N_LP)||e.has(t.H265_NAL_TYPE_BLA_W_LP)||e.has(t.H265_NAL_TYPE_BLA_W_RADL))||!(!r||!(e.has(t.H265_NAL_TYPE_VPS)||e.has(t.H265_NAL_TYPE_SPS)||e.has(t.H265_NAL_TYPE_PPS)))}function O(e){const t={};for(const r of e.slice(1)){const e=r.indexOf(":");let s="";-1!==e&&(s=r.substring(e+1).trim());t[r.substring(0,e).toLowerCase()]=s}return t}function x(e){for(const t of e.slice(1)){const e=t.indexOf(":");let r="";-1!==e&&(r=t.substring(e+1).trim());if("www-authenticate"===t.substring(0,e).toLowerCase())return r}}function N(e){const t={};for(const r of e.split(";")){const[e,s]=r.split("=",2);t[e]=s}return t}t.RTSP_FRAME_MAGIC=36,t.H264_NAL_TYPE_RESERVED0=0,t.H264_NAL_TYPE_RESERVED30=30,t.H264_NAL_TYPE_RESERVED31=31,t.H264_NAL_TYPE_IDR=5,t.H264_NAL_TYPE_SEI=6,t.H264_NAL_TYPE_SPS=7,t.H264_NAL_TYPE_PPS=8,t.H264_NAL_TYPE_STAP_A=24,t.H264_NAL_TYPE_STAP_B=25,t.H264_NAL_TYPE_FU_A=28,t.H264_NAL_TYPE_FU_B=29,t.H264_NAL_TYPE_MTAP16=26,t.H264_NAL_TYPE_MTAP32=27,t.H265_NAL_TYPE_AGG=48,t.H265_NAL_TYPE_VPS=32,t.H265_NAL_TYPE_SPS=33,t.H265_NAL_TYPE_PPS=34,t.H265_NAL_TYPE_BLA_W_LP=16,t.H265_NAL_TYPE_BLA_W_RADL=17,t.H265_NAL_TYPE_BLA_N_LP=18,t.H265_NAL_TYPE_IDR_W_RADL=19,t.H265_NAL_TYPE_IDR_N_LP=20,t.H265_NAL_TYPE_CRA_NUT=21,t.H265_NAL_TYPE_FU=49,t.H265_NAL_TYPE_SEI_PREFIX=39,t.H265_NAL_TYPE_SEI_SUFFIX=40;class D extends Error{constructor(e){super(`RTSP Error: ${e.line}`),this.status=e}}t.RtspStatusError=D;class L{constructor(){}write(e,t,r){E(this.client,e,r,t,this.console)}async readMessage(){const e=await S(this.client);return this.console?.log("rtsp incoming message\n",e.join("\n")),this.console?.log(),e}}t.RtspBase=L;t.RtspClient=class extends L{constructor(e){super(),this.url=e,this.cseq=0,this.needKeepAlive=!1,this.setupOptions=new Map,this.issuedTeardown=!1,this.hasGetParameter=!0;const t=new h.URL(e),r=parseInt(t.port)||554;e.startsWith("rtsps")?this.client=d.default.connect({rejectUnauthorized:!1,port:r,host:t.hostname}):this.client=l.default.connect(r,t.hostname),this.client.on("error",(e=>{this.console?.log("client error",e)}))}async safeTeardown(){if(!this.issuedTeardown){this.issuedTeardown=!0;try{this.writeTeardown(),await(0,b.sleep)(500)}catch(e){}finally{this.client.destroy()}}}async writeRequest(e,t,r,s){let n;t=t||{},r?r.includes("rtsp://")||r.includes("rtsps://")||"*"===r?n=r:(n=this.contentBase||this.url,n+=(n.endsWith("/")?"":"/")+r):n=this.url;const i=new h.URL(n);i.username="",i.password="";const o=`${e} ${i} RTSP/1.0`,a=this.cseq++;t.CSeq=a.toString(),t["User-Agent"]="Scrypted",this.wwwAuthenticate&&(t.Authorization=await this.createAuthorizationHeader(e,new h.URL(n))),this.session&&(t.Session=this.session),this.write(o,t,s)}async handleDataPayload(e){if(e[0]!==t.RTSP_FRAME_MAGIC)throw new Error("RTSP Client received invalid frame magic. This may be a bug in your camera firmware. If this error persists, switch your RTSP Parser to FFmpeg or Scrypted (UDP): "+e.toString());const r=e.readUInt8(1),s=e.readUInt16BE(2),n=await(0,m.readLength)(this.client,s),i=this.setupOptions.get(r);i?.onRtp?.(e,n)}async readDataPayload(){const e=await(0,m.readLength)(this.client,4);return this.handleDataPayload(e)}createBadHeader(e){return new Error("RTSP Client received invalid frame magic. This may be a bug in your camera firmware. If this error persists, switch your RTSP Parser to FFmpeg or Scrypted (UDP): "+e.toString())}async readLoopLegacy(){try{for(;;)this.needKeepAlive&&(this.needKeepAlive=!1,this.hasGetParameter?await this.getParameter():await this.options()),await this.readDataPayload()}catch(e){throw this.client.destroy(e),e}}async*handleStream(){for(;;){const e=await(0,m.readLength)(this.client,4);if(e[0]!==t.RTSP_FRAME_MAGIC){if("RTSP"!==e.toString())throw this.createBadHeader(e);this.client.unshift(e);const t=await super.readMessage();await this.readBody(O(t));continue}const r=e.readUInt16BE(2),s=await(0,m.readLength)(this.client,r),n=e.readUInt8(1);yield{channel:n,rtcp:n%2==1,header:e,packet:s}}}async readLoop(){const e=new p.Deferred;let r,s,n;const i=async()=>{this.needKeepAlive&&(this.needKeepAlive=!1,this.hasGetParameter?this.writeGetParameter():this.writeOptions());try{for(;;){if(!r){if(r=this.client.read(4),!r)return;if(r[0]!==t.RTSP_FRAME_MAGIC){if("RTSP"!==r.toString())throw this.createBadHeader(r);this.client.unshift(r),r=void 0,this.client.removeListener("readable",i);const e=await super.readMessage();await this.readBody(O(e));this.client.on("readable",i);continue}s=r.readUInt8(1),n=r.readUInt16BE(2)}const e=this.client.read(n);if(!e)return;const o=r;r=void 0;const a=this.setupOptions.get(s);a?.onRtp?.(o,e)}}catch(t){e.finished||e.reject(t),this.client.destroy()}};i(),this.client.on("readable",i),await Promise.all([(0,u.once)(this.client,"end")])}async readMessage(){for(;;){const e=await(0,m.readLength)(this.client,4);if(e[0]!==t.RTSP_FRAME_MAGIC){if("RTSP"===e.toString()){this.client.unshift(e);return await super.readMessage()}throw this.createBadHeader(e)}await this.handleDataPayload(e)}}async createAuthorizationHeader(e,t){if(!this.wwwAuthenticate)throw new Error("no WWW-Authenticate found");const{BASIC:s}=await Promise.resolve().then(r.bind(r,7284)),{parseHTTPHeadersQuotedKeyValueSet:n}=await Promise.resolve().then(r.bind(r,2238)),i=new h.URL(this.url),o=decodeURIComponent(i.username),a=decodeURIComponent(i.password);if(this.wwwAuthenticate.includes("Basic")){return`Basic ${s.computeHash({username:o,password:a})}`}const u=n(this.wwwAuthenticate,{indexOf:()=>0},v),l=new h.URL(t.toString());l.username="",l.password="";const d=c.default.createHash("md5").update(`${o}:${u.realm}:${a}`).digest("hex"),p=c.default.createHash("md5").update(`${e}:${l}`).digest("hex"),f=c.default.createHash("md5").update(`${d}:${u.nonce}:${p}`).digest("hex"),g={username:o,realm:u.realm,nonce:u.nonce,uri:l.toString(),algorithm:"MD5",response:f};return`Digest ${Object.entries(g).map((([e,t])=>{return`${e}=${t&&(r=t,`"${r.replace(/"/g,'\\"')}"`)}`;var r})).join(", ")}`}async readBody(e){return w(this.client,e)}async request(e,t,r,s,n){await this.writeRequest(e,t,r,s);const i=this.requestTimeout?await(0,g.timeoutPromise)(this.requestTimeout,this.readMessage()):await this.readMessage(),o=i[0],[a,c,u]=o.split(" ",3),l=parseInt(c),d=O(i),h={line:o,code:l,version:a,reason:u};if(200!==l&&!d["www-authenticate"])throw new D(h);const p=x(i)||d["www-authenticate"];if(p){if(n)throw new Error("auth failed");return this.wwwAuthenticate=p,this.request(e,t,r,s,!0)}return{headers:d,body:await this.readBody(d),status:h}}async options(){const e=await this.request("OPTIONS",{}),t=e.headers.public;return t&&(this.hasGetParameter=t.toLowerCase().includes("get_parameter")),e}writeOptions(){return this.writeRequest("OPTIONS")}async getParameter(){return this.request("GET_PARAMETER")}writeGetParameter(){return this.writeRequest("GET_PARAMETER")}async describe(e){const t=await this.request("DESCRIBE",{...e||{},Accept:"application/sdp"});return this.contentBase=t.headers["content-base"]||t.headers["content-location"],this.contentBase&&(this.contentBase=new h.URL(this.contentBase,this.url).toString()),t}async setup(e,t){const r="udp"===e.type?"":"/TCP",s="udp"===e.type?"client_port":"interleaved";let n;if("tcp"===e.type)n=e.port;else{if(!e.dgram){const t=await(0,f.createBindZero)();e.dgram=t.server,this.client.on("close",(()=>(0,f.closeQuiet)(t.server)))}n=e.dgram.address().port,e.dgram.on("message",(t=>e.onRtp(void 0,t)))}t=Object.assign({Transport:`RTP/AVP${r};unicast;${s}=${n}-${n+1}`},t);const i=await this.request("SETUP",t,e.path);let o;if(i.headers.session){const e=N(i.headers.session);let t=parseInt(e.timeout);if(t){let e=setInterval((()=>this.needKeepAlive=!0),1e3*(t-5));this.client.once("close",(()=>clearInterval(e)))}this.session=i.headers.session.split(";")[0]}if(i.headers.transport){const e=i.headers.transport.match(/.*?interleaved=([0-9]+)-([0-9]+)/);if(e){const[t,r,s]=e;r&&s&&(o={begin:parseInt(r),end:parseInt(s)})}}return"tcp"===e.type&&this.setupOptions.set(o?o.begin:n,e),Object.assign({interleaved:o,options:e},i)}async play(e={},t="0.000"){return e.Range=`npt=${t}-`,this.request("PLAY",e)}writePlay(e="0.000"){const t={Range:`npt=${e}-`};return this.writeRequest("PLAY",t)}writeRtpPayload(e,t){return this.client.write(e),this.client.write(Buffer.from(t))}send(e,r){const s=Buffer.alloc(4);return s.writeUInt8(t.RTSP_FRAME_MAGIC,0),s.writeUInt8(r,1),s.writeUInt16BE(e.length,2),this.writeRtpPayload(s,e)}async pause(){return this.request("PAUSE")}async teardown(){try{return await this.request("TEARDOWN")}finally{this.client.destroy()}}writeTeardown(){this.writeRequest("TEARDOWN")}};class M{constructor(e,t,r,s){this.client=e,this.sdp=t,this.udp=r,this.checkRequest=s,this.setupTracks={},this.availableOptions=["DESCRIBE","OPTIONS","PAUSE","PLAY","SETUP","TEARDOWN","ANNOUNCE","RECORD","GET_PARAMETER"],this.session=(0,c.randomBytes)(4).toString("hex"),t&&(t=t.trim()),e instanceof l.default.Socket&&e.setNoDelay(!0)}async handleSetup(e=["play","record","teardown"]){let t=[];for(;;){let r=await(0,m.readLine)(this.client);if(r=r.trim(),r)t.push(r);else{const r=await this.headers(t);if(e.includes(r))return r;t=[]}}}async handlePlayback(){return this.handleSetup()}async handleTeardown(){return this.handleSetup()}async*handleRecord(){for(;;){const e=await(0,m.readLength)(this.client,4);if(e[0]!==t.RTSP_FRAME_MAGIC)throw new Error("RTSP Server expected frame magic but received: "+e.toString());const r=e.readUInt16BE(2),s=await(0,m.readLength)(this.client,r),n=e.readUInt8(1),i=n-n%2,o=Object.values(this.setupTracks).find((e=>e.destination===i));if(!o)throw new Error("RSTP Server received unknown channel: "+n);yield{type:o.codec,rtcp:n%2==1,header:e,packet:s}}}writeRtpPayload(e,t){return this.client.write(e),this.client.write(Buffer.from(t))}send(e,t){const r=Buffer.alloc(4);return r.writeUInt8(36,0),r.writeUInt8(t,1),r.writeUInt16BE(e.length,2),this.writeRtpPayload(r,e)}sendUdp(e,t,r){e.send(r,t,"127.0.0.1")}sendTrack(e,t,r){const s=this.setupTracks[e];return s?"udp"===s.protocol?(this.udp?this.sendUdp(r?s.rtcp:s.rtp,s.destination,t):this.console?.warn("RTSP Server UDP socket not available."),!0):this.send(t,r?s.destination+1:s.destination):(this.console?.warn("RTSP Server track not found:",e),!0)}options(e,t){const r={};r.Public=this.availableOptions.join(", "),this.respond(200,"OK",t,r)}async get_parameter(e,t){this.respond(200,"OK",t,{})}describe(e,t){const r={};r["Content-Base"]=e,r["Content-Type"]="application/sdp",this.respond(200,"OK",t,r,Buffer.from(this.sdp))}setupInterleaved(e,t,r){this.setupTracks[e.control]={control:e.control,protocol:"tcp",destination:t,codec:e.codec}}async setup(e,t){const r={};let s=t.transport;r.Session=this.session;const n=(0,y.parseSdp)(this.sdp).msections.find((t=>e.endsWith(t.control)));if(n){if(s.includes("TCP"))if(this.resolveInterleaved){const[e,t]=this.resolveInterleaved(n);this.setupInterleaved(n,e,t),s=`RTP/AVP/TCP;unicast;interleaved=${e}-${t}`}else{const e=s.match(/.*?interleaved=([0-9]+)-([0-9]+)/);if(e){const t=parseInt(e[1]),r=parseInt(e[2]);this.setupInterleaved(n,t,r)}}else{if(!this.udp)return void this.respond(461,"Unsupported Transport",t,{});const e=s.match(/.*?client_port=([0-9]+)-([0-9]+)/),[r,i,o]=e,[a,c]=await(0,f.createSquentialBindZero)();this.client.on("close",(()=>(0,f.closeQuiet)(a.server))),this.client.on("close",(()=>(0,f.closeQuiet)(c.server))),this.setupTracks[n.control]={control:n.control,protocol:"udp",destination:parseInt(i),codec:n.codec,rtp:a.server,rtcp:c.server},s=s.replace("RTP/AVP/UDP","RTP/AVP").replace("RTP/AVP","RTP/AVP/UDP"),s+=`;server_port=${a.port}-${c.port}`}r.Transport=s,this.respond(200,"OK",t,r)}else this.respond(404,"Not Found",t,r)}play(e,t){const r={},s=Object.values(this.setupTracks).map((t=>`url=${e}/${t.control}`)).join(",");r["RTP-Info"]=s,r.Range="npt=now-",r.Session=this.session,this.respond(200,"OK",t,r)}async announce(e,t){const r=parseInt(t["content-length"]),s=await(0,m.readLength)(this.client,r);this.sdp=s.toString();const n={};n.Session=this.session,this.respond(200,"OK",t,n)}async record(e,t){const r={};r.Session=this.session,this.respond(200,"OK",t,r)}async teardown(e,t){const r={};r.Session=this.session,this.respond(200,"OK",t,r),this.client.destroy()}async headers(e){this.console?.log("request headers",e.join("\n"));let[t,r]=e[0].split(" ",2);t=t.toLowerCase();const s=O(e);if(this.checkRequest){let n;try{n=await this.checkRequest(t,r,s,e)}catch(e){this.console?.error("error checking request",e)}if(!n)throw this.respond(400,"Bad Request",s,{}),this.client.destroy(),new Error("check request failed")}if(this[t]&&this.availableOptions.includes(t.toUpperCase()))return await this[t](r,s),t;this.respond(400,"Bad Request",s,{})}respond(e,t,r,s,n){let i=`RTSP/1.0 ${e} ${t}\r\n`;r.cseq&&(s.CSeq=r.cseq),n&&(s["Content-Length"]=n.length.toString());for(const[e,t]of Object.entries(s))i+=`${e}: ${t}\r\n`;this.console?.log("response headers",i),i+="\r\n",this.client.write(i),n&&(this.client.write(n),this.console?.log("response body",n.toString()))}destroy(){this.client.destroy();for(const e of Object.values(this.setupTracks))(0,f.closeQuiet)(e.rtp),(0,f.closeQuiet)(e.rtcp)}}t.RtspServer=M},371:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.DtlsSocket=t.DtlsServer=t.DtlsClient=void 0,n(r(7568),t),n(r(1310),t),n(r(4148),t);var i=r(7564);Object.defineProperty(t,"DtlsClient",{enumerable:!0,get:function(){return i.DtlsClient}});var o=r(9688);Object.defineProperty(t,"DtlsServer",{enumerable:!0,get:function(){return o.DtlsServer}});var a=r(654);Object.defineProperty(t,"DtlsSocket",{enumerable:!0,get:function(){return a.DtlsSocket}})},372:function(e,t,r){"use strict";var s,n=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=s(e),o=0;o<r.length;o++)"default"!==r[o]&&n(t,e,r[o]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0;const c=r(6982),u=r(9278),l=o(r(5701)),d=a(r(188)),h=a(r(6460)),p=r(2261),f=r(2126),g=r(2797),m=r(1227),y=r(9761),b=r(4687),v=r(9851),S=r(7830),w=r(599),E=r(730),C=(0,p.debug)("werift-ice : packages/ice/src/ice.ts : log");t.Connection=class{constructor(e,t){this._iceControlling=e,this.localUsername=(0,m.randomString)(4),this.localPassword=(0,m.randomString)(22),this.remoteIsLite=!1,this.remotePassword="",this.remoteUsername="",this.checkList=[],this.localCandidates=[],this.remoteCandidatesEnd=!1,this.localCandidatesEnd=!1,this.generation=-1,this.userHistory={},this.tieBreaker=BigInt(new l.Uint64BE((0,c.randomBytes)(64)).toString()),this.state="new",this._remoteCandidates=[],this.nominating=!1,this.checkListDone=!1,this.checkListState=new m.PQueue,this.earlyChecks=[],this.earlyChecksDone=!1,this.localCandidatesStart=!1,this.protocols=[],this.onData=new p.Event,this.stateChanged=new p.Event,this.onIceCandidate=new p.Event,this.queryConsent=()=>{this.queryConsentHandle&&this.queryConsentHandle.resolve(),this.queryConsentHandle=(0,m.cancelable)((async(e,t,r)=>{let s=0,n=!1;const i=new AbortController;r.once((()=>{n=!0,s+=y.CONSENT_FAILURES,i.abort(),this.queryConsentHandle=void 0}));const{localUsername:o,remoteUsername:a,iceControlling:c}=this;try{for(;"closed"!==this.state&&!n;){await h.default.setTimeout(y.CONSENT_INTERVAL*(.8+.4*Math.random())*1e3,void 0,{signal:i.signal});const e=this.nominated;if(!e||n)break;const t=this.buildRequest({nominate:!1,localUsername:o,remoteUsername:a,iceControlling:c});try{await e.protocol.request(t,e.remoteAddr,Buffer.from(this.remotePassword,"utf8"),0),s=0,"disconnected"===this.state&&this.setState("connected")}catch(t){if(e.id===this.nominated?.id){C("no stun response"),s++,this.setState("disconnected");break}}if(s>=y.CONSENT_FAILURES){C("Consent to send expired"),this.queryConsentHandle=void 0,this.setState("closed");break}}}catch(e){}}))},this.send=async e=>{const t=this.nominated;t&&(await t.protocol.sendData(e,t.remoteAddr),t.packetsSent++,t.bytesSent+=e.length)},this.checkStart=e=>(0,m.cancelable)((async t=>{C("check start",e.toJSON()),e.updateState(y.CandidatePairState.IN_PROGRESS);const r={},{remotePassword:s,remoteUsername:n,generation:i}=this,o=e.localCandidate.ufrag??this.localUsername,a=this.iceControlling&&!this.remoteIsLite,c=this.buildRequest({nominate:a,localUsername:o,remoteUsername:n,iceControlling:this.iceControlling}),u=performance.now();try{const[t,a]=await e.protocol.request(c,e.remoteAddr,Buffer.from(s,"utf8"),4),l=(performance.now()-u)/1e3;e.rtt=l,e.totalRoundTripTime+=l,e.roundTripTimeMeasurements++,C("response received",c.toJSON(),t.toJSON(),a,{localUsername:o,remoteUsername:n,remotePassword:s,generation:i,rtt:l}),r.response=t,r.addr=a}catch(r){const a=r;return C("failure case",c.toJSON(),a.response?JSON.stringify(a.response.toJSON(),null,2):r,{localUsername:o,remoteUsername:n,remotePassword:s,generation:i},e.remoteAddr),487===a.response?.getAttributeValue("ERROR-CODE")[0]?(c.attributesKeys.includes("ICE-CONTROLLED")?this.switchRole(!0):c.attributesKeys.includes("ICE-CONTROLLING")&&this.switchRole(!1),await this.checkStart(e).awaitable,void t()):401===a.response?.getAttributeValue("ERROR-CODE")[0]?(C("retry 401",e.toJSON()),await this.checkStart(e).awaitable,void t()):(C("checkStart CandidatePairState.FAILED",e.toJSON()),e.updateState(y.CandidatePairState.FAILED),this.checkComplete(e),void t())}if(!(0,d.default)(r.addr,e.remoteAddr))return e.updateState(y.CandidatePairState.FAILED),this.checkComplete(e),void t();if(a||e.remoteNominated)e.nominated=!0;else if(this.iceControlling&&!this.nominating){this.nominating=!0;const t=this.buildRequest({nominate:!0,localUsername:o,remoteUsername:n,iceControlling:this.iceControlling});try{await e.protocol.request(t,e.remoteAddr,Buffer.from(this.remotePassword,"utf8"))}catch(t){return e.updateState(y.CandidatePairState.FAILED),void this.checkComplete(e)}e.nominated=!0}e.updateState(y.CandidatePairState.SUCCEEDED),this.checkComplete(e),t()})),this.pairRemoteCandidate=e=>{for(const t of this.protocols)this.tryPair(t,e)},this.options={...y.defaultOptions,...t};const{stunServer:r,turnServer:s}=this.options;this.stunServer=(0,y.validateAddress)(r)??["stun.l.google.com",19302],this.turnServer=(0,y.validateAddress)(s),this.restart(),C("new Connection",this.options)}get iceControlling(){return this._iceControlling}set iceControlling(e){if(!(this.generation>0||this.nominated)){this._iceControlling=e;for(const t of this.checkList)t.iceControlling=e}}async restart(){this.generation++,this.localUsername=(0,m.randomString)(4),this.localPassword=(0,m.randomString)(22),this.options.localPasswordPrefix&&(this.localPassword=this.options.localPasswordPrefix+this.localPassword.slice(this.options.localPasswordPrefix.length)),this.userHistory[this.localUsername]=this.localPassword,this.remoteUsername="",this.remotePassword="",this.localCandidates=[],this._remoteCandidates=[],this.remoteCandidatesEnd=!1,this.localCandidatesEnd=!1,this.state="new",this.lookup?.close?.(),this.lookup=void 0,this.nominated=void 0,this.nominating=!1,this.checkList=[],this.checkListDone=!1,this.checkListState=new m.PQueue,this.earlyChecks=[],this.earlyChecksDone=!1,this.localCandidatesStart=!1;for(const e of this.protocols)e.localCandidate&&(e.localCandidate.generation=this.generation,e.localCandidate.ufrag=this.localUsername);this.queryConsentHandle?.resolve?.(),this.queryConsentHandle=void 0}resetNominatedPair(){C("resetNominatedPair"),this.nominated=void 0,this.nominating=!1}setRemoteParams({iceLite:e,usernameFragment:t,password:r}){C("setRemoteParams",{iceLite:e,usernameFragment:t,password:r}),this.remoteIsLite=e,this.remoteUsername=t,this.remotePassword=r}async gatherCandidates(){if(!this.localCandidatesStart){this.localCandidatesStart=!0;let e=(0,E.getHostAddresses)(this.options.useIpv4,this.options.useIpv6,{useLinkLocalAddress:this.options.useLinkLocalAddress});const{interfaceAddresses:t}=this.options;if(t){const r=e.filter((e=>Object.values(t).includes(e)));r.length&&(e=r)}this.options.additionalHostAddresses&&(e=Array.from(new Set([...this.options.additionalHostAddresses,...e])));const r=this.getCandidatePromises(e,5);await Promise.allSettled(r),this.localCandidatesEnd=!0}this.setState("completed")}appendLocalCandidate(e){this.localCandidates.push(e),this.onIceCandidate.execute(e)}ensureProtocol(e){e.onRequestReceived.subscribe(((t,r,s)=>{if(t.messageMethod!==b.methods.BINDING)return void this.respondError(t,r,e,[400,"Bad Request"]);const n=t.getAttributeValue("USERNAME"),{remoteUsername:i}=I(n),o=this.userHistory[i]??this.localPassword,{iceControlling:a}=this;if(a&&t.attributesKeys.includes("ICE-CONTROLLING")){if(this.tieBreaker>=t.getAttributeValue("ICE-CONTROLLING"))return void this.respondError(t,r,e,[487,"Role Conflict"]);this.switchRole(!1)}else if(!a&&t.attributesKeys.includes("ICE-CONTROLLED")){if(!(this.tieBreaker<t.getAttributeValue("ICE-CONTROLLED")))return void this.switchRole(!0);this.respondError(t,r,e,[487,"Role Conflict"])}if(this.options.filterStunResponse&&!this.options.filterStunResponse(t,r,e))return;const c=new v.Message(b.methods.BINDING,b.classes.RESPONSE,t.transactionId);c.setAttribute("XOR-MAPPED-ADDRESS",r).addMessageIntegrity(Buffer.from(o,"utf8")).addFingerprint(),e.sendStun(c,r).catch((e=>{C("sendStun error",e)})),0!==this.checkList.length||this.earlyChecksDone?this.checkIncoming(t,r,e):this.earlyChecks.push([t,r,e])})),e.onDataReceived.subscribe((t=>{try{const r=this.nominated;r&&r.protocol===e&&(r.packetsReceived++,r.bytesReceived+=t.length),this.onData.execute(t)}catch(e){C("dataReceived",e)}}))}getCandidatePromises(e,t=5){let r=[];const s=(e=e.filter((e=>!this.protocols.find((t=>t.localIp===e))))).map((async e=>{const t=new S.StunProtocol;this.ensureProtocol(t);try{await t.connectionMade((0,u.isIPv4)(e),this.options.portRange,this.options.interfaceAddresses),t.localIp=e,this.protocols.push(t),C("protocol",t.localIp);const r=[e,t.getExtraInfo()[1]];return t.localCandidate=new f.Candidate((0,f.candidateFoundation)("host","udp",r[0]),1,"udp",(0,f.candidatePriority)("host"),r[0],r[1],"host",void 0,void 0,void 0,this.generation,this.localUsername),this.pairLocalProtocol(t),this.appendLocalCandidate(t.localCandidate),t}catch(e){C("error protocol STUN",e)}}));r.push(...s.map((e=>e.then((e=>e?.localCandidate)))));const{stunServer:n,turnServer:i}=this;if(n){const e=s.map((async e=>{const r=await e;if(!r)return;return new Promise((async(e,s)=>{const i=setTimeout(s,1e3*t);if(r.localCandidate?.host&&(0,u.isIPv4)(r.localCandidate?.host)){const t=await(0,y.serverReflexiveCandidate)(r,n).catch((e=>{C("error",e)}));t&&this.appendLocalCandidate(t),clearTimeout(i),e(t)}else clearTimeout(i),e()})).catch((e=>{C("query STUN server",e)}))}));r.push(...e)}const{turnUsername:o,turnPassword:a}=this.options;if(i&&o&&a){const e=(async()=>{const e=await(0,w.createStunOverTurnClient)({address:i,username:o,password:a},{portRange:this.options.portRange,interfaceAddresses:this.options.interfaceAddresses,transport:"tcp"===this.options.turnTransport?"tcp":"udp"}).catch((async e=>{if("tcp"!==this.options.turnTransport)return await(0,w.createStunOverTurnClient)({address:i,username:o,password:a},{portRange:this.options.portRange,interfaceAddresses:this.options.interfaceAddresses,transport:"tcp"});throw e}));this.ensureProtocol(e),this.protocols.push(e);const t=e.turn.relayedAddress,r=e.turn.mappedAddress;return C("turn candidateAddress",t),e.localCandidate=new f.Candidate((0,f.candidateFoundation)("relay","udp",t[0]),1,"udp",(0,f.candidatePriority)("relay"),t[0],t[1],"relay",r[0],r[1],void 0,this.generation,this.localUsername),this.appendLocalCandidate(e.localCandidate),e.localCandidate})().catch((e=>{C("query TURN server",e)}));this.options.forceTurn&&(r=[]),r.push(e)}return r}async connect(){if(C("start connect ice"),!this.localCandidatesEnd&&!this.localCandidatesStart)throw new Error("Local candidates gathering was not performed");if(!this.remoteUsername||!this.remotePassword)throw new Error("Remote username or password is missing");for(const e of this.remoteCandidates)this.pairRemoteCandidate(e);this.sortCheckList(),this.unfreezeInitial(),C("earlyChecks",this.localPassword,this.earlyChecks.length);for(const e of this.earlyChecks)this.checkIncoming(...e);for(this.earlyChecks=[],this.earlyChecksDone=!0;"closed"!==this.state&&this.schedulingChecks();)await h.default.setTimeout(20);let e=y.ICE_FAILED;for(;this.checkList.length>0&&e===y.ICE_FAILED;)e=await this.checkListState.get(),C("checkListState",e);for(const e of this.checkList)e.handle?.resolve?.();if(e!==y.ICE_COMPLETED)throw new Error("ICE negotiation failed");this.queryConsent(),this.setState("connected")}unfreezeInitial(){const[e]=this.checkList;if(!e)return;e.state===y.CandidatePairState.FROZEN&&e.updateState(y.CandidatePairState.WAITING);const t=new Set(e.localCandidate.foundation);for(const r of this.checkList)r.component!==e.component||t.has(r.localCandidate.foundation)||r.state!==y.CandidatePairState.FROZEN||(r.updateState(y.CandidatePairState.WAITING),t.add(r.localCandidate.foundation))}schedulingChecks(){{const e=this.checkList.filter((e=>!this.options.forceTurn||e.protocol.type!==S.StunProtocol.type)).find((e=>e.state===y.CandidatePairState.WAITING));if(e)return e.handle=this.checkStart(e),!0}{const e=this.checkList.find((e=>e.state===y.CandidatePairState.FROZEN));if(e)return e.handle=this.checkStart(e),!0}return!this.remoteCandidatesEnd&&!this.checkListDone}async close(){this.setState("closed"),this.queryConsentHandle?.resolve?.(),this.checkList&&!this.checkListDone&&this.checkListState.put(new Promise((e=>{e(y.ICE_FAILED)}))),this.nominated=void 0;for(const e of this.protocols)e.close&&await e.close();this.protocols=[],this.localCandidates=[],this.lookup?.close?.(),this.lookup=void 0}setState(e){this.state=e,this.stateChanged.execute(e)}async addRemoteCandidate(e){if(e){if(e.host.includes(".local"))try{this.lookup||(this.lookup=new g.MdnsLookup);const t=await this.lookup.lookup(e.host);e.host=t}catch(e){return}try{(0,y.validateRemoteCandidate)(e)}catch(e){return}C("addRemoteCandidate",e),this._remoteCandidates.push(e),this.pairRemoteCandidate(e),this.sortCheckList()}else this.remoteCandidatesEnd=!0}getDefaultCandidate(){const e=this.localCandidates.sort(((e,t)=>e.priority-t.priority)),[t]=e;return t}set remoteCandidates(e){if(this.remoteCandidatesEnd)throw new Error("Cannot set remote candidates after end-of-candidates.");this._remoteCandidates=[];for(const t of e){try{(0,y.validateRemoteCandidate)(t)}catch(e){continue}this._remoteCandidates.push(t)}this.remoteCandidatesEnd=!0}get remoteCandidates(){return this._remoteCandidates}get candidatePairs(){return this.checkList}sortCheckList(){(0,y.sortCandidatePairs)(this.checkList,this.iceControlling)}findPair(e,t){return this.checkList.find((r=>(0,d.default)(r.protocol,e)&&(0,d.default)(r.remoteCandidate,t)))}switchRole(e){C("switch role",e),this.iceControlling=e,this.sortCheckList()}checkComplete(e){if(e.handle=void 0,e.state===y.CandidatePairState.SUCCEEDED){if(e.nominated&&(null==e.remoteCandidate.generation||e.remoteCandidate.generation===this.generation)&&null==this.nominated){C("nominated",e.toJSON()),this.nominated=e,this.nominating=!1;for(const t of this.checkList)t.component===e.component&&[y.CandidatePairState.WAITING,y.CandidatePairState.FROZEN].includes(t.state)&&t.updateState(y.CandidatePairState.FAILED)}if(this.nominated)return void(this.checkListDone||(C("ICE completed"),this.checkListState.put(new Promise((e=>e(y.ICE_COMPLETED)))),this.checkListDone=!0));C("not completed",e.toJSON());for(const t of this.checkList)t.localCandidate.foundation===e.localCandidate.foundation&&t.state===y.CandidatePairState.FROZEN&&t.updateState(y.CandidatePairState.WAITING)}{const e=[y.CandidatePairState.SUCCEEDED,y.CandidatePairState.FAILED];if(this.checkList.find((({state:t})=>!e.includes(t))))return}if(!this.iceControlling){const e=y.CandidatePairState.SUCCEEDED;if(this.checkList.find((({state:t})=>t===e)))return}this.checkListDone||(C("ICE failed"),this.checkListState.put(new Promise((e=>{e(y.ICE_FAILED)}))))}addPair(e){this.checkList.push(e),this.sortCheckList()}checkIncoming(e,t,r){const s=e.getAttributeValue("USERNAME"),{remoteUsername:n}=I(s);let i;const[o,a]=t;for(const e of this.remoteCandidates)if(e.host===o&&e.port===a){i=e;break}i||(i=new f.Candidate((0,m.randomString)(10),1,"udp",e.getAttributeValue("PRIORITY"),o,a,"prflx",void 0,void 0,void 0,void 0,void 0),this._remoteCandidates.push(i));let c=this.findPair(r,i);c||(c=new y.CandidatePair(r,i,this.iceControlling),c.updateState(y.CandidatePairState.WAITING),this.addPair(c)),c.localCandidate.ufrag=n,C("Triggered Checks",e.toJSON(),c.toJSON(),{localUsername:this.localUsername,remoteUsername:this.remoteUsername,localPassword:this.localPassword,remotePassword:this.remotePassword,generation:this.generation}),[y.CandidatePairState.WAITING,y.CandidatePairState.FAILED].includes(c.state)&&(c.handle=this.checkStart(c)),e.attributesKeys.includes("USE-CANDIDATE")&&!this.iceControlling&&(c.remoteNominated=!0,c.state===y.CandidatePairState.SUCCEEDED&&(c.nominated=!0,this.checkComplete(c)))}tryPair(e,t){if(e.localCandidate?.canPairWith(t)&&!this.findPair(e,t)){const r=new y.CandidatePair(e,t,this.iceControlling);if(this.options.filterCandidatePair&&!this.options.filterCandidatePair(r))return;r.updateState(y.CandidatePairState.WAITING),this.addPair(r)}}pairLocalProtocol(e){for(const t of this.remoteCandidates)this.tryPair(e,t)}buildRequest({nominate:e,remoteUsername:t,localUsername:r,iceControlling:s}){const n=T({remoteUsername:t,localUsername:r}),i=new v.Message(b.methods.BINDING,b.classes.REQUEST);return i.setAttribute("USERNAME",n).setAttribute("PRIORITY",(0,f.candidatePriority)("prflx")),s?(i.setAttribute("ICE-CONTROLLING",this.tieBreaker),e&&i.setAttribute("USE-CANDIDATE",null)):i.setAttribute("ICE-CONTROLLED",this.tieBreaker),i}respondError(e,t,r,s){const n=new v.Message(e.messageMethod,b.classes.ERROR,e.transactionId);n.setAttribute("ERROR-CODE",s).addMessageIntegrity(Buffer.from(this.localPassword,"utf8")).addFingerprint(),r.sendStun(n,t).catch((e=>{C("sendStun error",e)}))}};const T=({remoteUsername:e,localUsername:t})=>`${e}:${t}`,I=e=>{const[t,r]=e.split(":");return{remoteUsername:t,localUsername:r}}},376:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9023),n=r(6982),i=r(9511),o=r(9385),a=r(1394),c=Object.create(null);c.CN=o.getOID("commonName"),c.commonName="CN",c.C=o.getOID("countryName"),c.countryName="C",c.L=o.getOID("localityName"),c.localityName="L",c.ST=o.getOID("stateOrProvinceName"),c.stateOrProvinceName="ST",c.O=o.getOID("organizationName"),c.organizationName="O",c.OU=o.getOID("organizationalUnitName"),c.organizationalUnitName="OU",c.E=o.getOID("emailAddress"),c.emailAddress="E";const u={name:"Certificate",class:i.Class.UNIVERSAL,tag:i.Tag.SEQUENCE,value:[{name:"Certificate.TBSCertificate",class:i.Class.UNIVERSAL,tag:i.Tag.SEQUENCE,capture:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",class:i.Class.CONTEXT_SPECIFIC,tag:i.Tag.NONE,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",class:i.Class.UNIVERSAL,tag:i.Tag.INTEGER,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",class:i.Class.UNIVERSAL,tag:i.Tag.INTEGER,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",class:i.Class.UNIVERSAL,tag:i.Tag.SEQUENCE,value:[{name:"Certificate.TBSCertificate.signature.algorithm",class:i.Class.UNIVERSAL,tag:i.Tag.OID,capture:"certinfoSignatureOID"},{name:"Certificate.TBSCertificate.signature.parameters",class:i.Class.UNIVERSAL,tag:i.Tag.OCTETSTRING,optional:!0,capture:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",class:i.Class.UNIVERSAL,tag:i.Tag.SEQUENCE,capture:"certIssuer"},{name:"Certificate.TBSCertificate.validity",class:i.Class.UNIVERSAL,tag:i.Tag.SEQUENCE,value:[{name:"Certificate.TBSCertificate.validity.notBefore",class:i.Class.UNIVERSAL,tag:[i.Tag.UTCTIME,i.Tag.GENERALIZEDTIME],capture:"certValidityNotBefore"},{name:"Certificate.TBSCertificate.validity.notAfter",class:i.Class.UNIVERSAL,tag:[i.Tag.UTCTIME,i.Tag.GENERALIZEDTIME],capture:"certValidityNotAfter"}]},{name:"Certificate.TBSCertificate.subject",class:i.Class.UNIVERSAL,tag:i.Tag.SEQUENCE,capture:"certSubject"},a.publicKeyValidator,{name:"Certificate.TBSCertificate.issuerUniqueID",class:i.Class.CONTEXT_SPECIFIC,tag:i.Tag.BOOLEAN,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",class:i.Class.UNIVERSAL,tag:i.Tag.BITSTRING,capture:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",class:i.Class.CONTEXT_SPECIFIC,tag:i.Tag.INTEGER,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",class:i.Class.UNIVERSAL,tag:i.Tag.BITSTRING,capture:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",class:i.Class.CONTEXT_SPECIFIC,tag:i.Tag.BITSTRING,capture:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",class:i.Class.UNIVERSAL,tag:i.Tag.SEQUENCE,value:[{name:"Certificate.signatureAlgorithm.algorithm",class:i.Class.UNIVERSAL,tag:i.Tag.OID,capture:"certSignatureOID"},{name:"Certificate.TBSCertificate.signature.parameters",class:i.Class.UNIVERSAL,tag:i.Tag.OCTETSTRING,optional:!0,capture:"certSignatureParams"}]},{name:"Certificate.signatureValue",class:i.Class.UNIVERSAL,tag:i.Tag.BITSTRING,capture:"certSignature"}]};class l{constructor(){this.attributes=[],this.uniqueId=null}get commonName(){return this.getFieldValue("commonName")}get organizationName(){return this.getFieldValue("organizationName")}get organizationalUnitName(){return this.getFieldValue("organizationalUnitName")}get countryName(){return this.getFieldValue("countryName")}get localityName(){return this.getFieldValue("localityName")}get serialName(){return this.getFieldValue("serialName")}getHash(){const e=n.createHash("sha1");for(const t of this.attributes)e.update(t.oid),e.update(t.value);return e.digest()}getField(e){for(const t of this.attributes)if(e===t.oid||e===t.name||e===t.shortName)return t;return null}addField(e){y([e]),this.attributes.push(e)}setAttrs(e){y(e),this.attributes=e}toJSON(){const e={};for(const t of this.attributes){const r=t.shortName;"string"==typeof r&&""!==r&&(e[r]=t.value)}return e.uniqueId=this.uniqueId,e.attributes=this.attributes,e}getFieldValue(e){const t=this.getField(e);return null!=t?t.value:""}}t.DistinguishedName=l;class d{static fromPEMs(e){const t=[],r=i.PEM.parse(e);for(const e of r){if("CERTIFICATE"!==e.type&&"X509 CERTIFICATE"!==e.type&&"TRUSTED CERTIFICATE"!==e.type)throw new Error("Could not convert certificate from PEM: invalid type");if(e.procType.includes("ENCRYPTED"))throw new Error("Could not convert certificate from PEM: PEM is encrypted.");const r=i.ASN1.fromDER(e.body);t.push(new d(r))}if(0===t.length)throw new Error("No Certificate");return t}static fromPEM(e){return d.fromPEMs(e)[0]}constructor(e){const t=Object.create(null),r=e.validate(u,t);if(null!=r)throw new Error("Cannot read X.509 certificate: "+r.message);if(this.raw=e.DER,this.version=null==t.certVersion?0:i.ASN1.parseIntegerNum(t.certVersion.bytes)+1,this.serialNumber=i.ASN1.parseIntegerStr(t.certSerialNumber.bytes),this.signatureOID=i.ASN1.parseOID(t.certSignatureOID.bytes),this.signatureAlgorithm=o.getOIDName(this.signatureOID),this.infoSignatureOID=i.ASN1.parseOID(t.certinfoSignatureOID.bytes),this.signature=i.ASN1.parseBitString(t.certSignature.bytes).buf,this.validFrom=i.ASN1.parseTime(t.certValidityNotBefore.tag,t.certValidityNotBefore.bytes),this.validTo=i.ASN1.parseTime(t.certValidityNotAfter.tag,t.certValidityNotAfter.bytes),this.issuer=new l,this.issuer.setAttrs(b(t.certIssuer)),null!=t.certIssuerUniqueId&&(this.issuer.uniqueId=i.ASN1.parseBitString(t.certIssuerUniqueId.bytes)),this.subject=new l,this.subject.setAttrs(b(t.certSubject)),null!=t.certSubjectUniqueId&&(this.subject.uniqueId=i.ASN1.parseBitString(t.certSubjectUniqueId.bytes)),this.extensions=[],this.subjectKeyIdentifier="",this.authorityKeyIdentifier="",this.ocspServer="",this.issuingCertificateURL="",this.isCA=!1,this.maxPathLen=-1,this.basicConstraintsValid=!1,this.keyUsage=0,this.dnsNames=[],this.emailAddresses=[],this.ipAddresses=[],this.uris=[],null!=t.certExtensions){this.extensions=function(e){const t=[];for(const r of e.mustCompound())for(const e of r.mustCompound())t.push(h(e));return t}(t.certExtensions);for(const e of this.extensions)if("string"==typeof e.subjectKeyIdentifier&&(this.subjectKeyIdentifier=e.subjectKeyIdentifier),"string"==typeof e.authorityKeyIdentifier&&(this.authorityKeyIdentifier=e.authorityKeyIdentifier),"string"==typeof e.authorityInfoAccessOcsp&&(this.ocspServer=e.authorityInfoAccessOcsp),"string"==typeof e.authorityInfoAccessIssuers&&(this.issuingCertificateURL=e.authorityInfoAccessIssuers),"boolean"==typeof e.basicConstraintsValid&&(this.isCA=e.isCA,this.maxPathLen=e.maxPathLen,this.basicConstraintsValid=e.basicConstraintsValid),"number"==typeof e.keyUsage&&(this.keyUsage=e.keyUsage),Array.isArray(e.altNames))for(const t of e.altNames)null!=t.dnsName&&this.dnsNames.push(t.dnsName),null!=t.email&&this.emailAddresses.push(t.email),null!=t.ip&&this.ipAddresses.push(t.ip),null!=t.uri&&this.uris.push(t.uri)}this.publicKey=new a.PublicKey(t.publicKeyInfo),this.publicKeyRaw=this.publicKey.toDER(),this.tbsCertificate=t.tbsCertificate}getExtension(e,t=""){for(const r of this.extensions)if(e===r.oid||e===r.name)return""===t?r:r[t];return null}checkSignature(e){if(3===this.version&&!this.basicConstraintsValid||this.basicConstraintsValid&&!this.isCA)return new Error("The parent constraint violation error");if(!0!==this.getExtension("keyUsage","keyCertSign"))return new Error("The parent constraint violation error");if(!e.isIssuer(this))return new Error("The parent certificate did not issue the given child certificate");const t=function(e){switch(o.getOIDName(e)){case"sha1WithRsaEncryption":case"ecdsaWithSha1":case"dsaWithSha1":return"sha1";case"md5WithRsaEncryption":return"md5";case"sha256WithRsaEncryption":case"RSASSA-PSS":case"ecdsaWithSha256":case"dsaWithSha256":return"sha256";case"sha384WithRsaEncryption":case"ecdsaWithSha384":return"sha384";case"sha512WithRsaEncryption":case"ecdsaWithSha512":return"sha512";default:return""}}(e.signatureOID);if(""===t)return new Error("Unknown child signature OID.");return!1===this.publicKey.verify(e.tbsCertificate.DER,e.signature,t)?new Error("Child signature not matched"):null}isIssuer(e){return this.issuer.getHash().equals(e.subject.getHash())}verifySubjectKeyIdentifier(){return this.publicKey.getFingerprint("sha1","PublicKey").toString("hex")===this.subjectKeyIdentifier}toJSON(){const e={};for(const t of Object.keys(this))e[t]=v(this[t]);return delete e.tbsCertificate,e}[s.inspect.custom](e,t){return t.depth<=2&&(t.depth=10),`<${this.constructor.name} ${s.inspect(this.toJSON(),t)}>`}}function h(e){const t={};switch(t.oid=i.ASN1.parseOID(e.value[0].bytes),t.critical=!1,e.value[1].tag===i.Tag.BOOLEAN?(t.critical=i.ASN1.parseBool(e.value[1].bytes),t.value=e.value[2].bytes):t.value=e.value[1].bytes,t.name=o.getOIDName(t.oid),t.name){case"keyUsage":!function(e){const t=i.ASN1.parseBitString(i.ASN1.fromDER(e.value).bytes);let r=0,s=0;e.keyUsage=0;for(let r=0;r<9;r++)0!==t.at(r)&&(e.keyUsage|=1<<r);t.buf.length>0&&(r=t.buf[0],s=t.buf.length>1?t.buf[1]:0);e.digitalSignature=!(128&~r),e.nonRepudiation=!(64&~r),e.keyEncipherment=!(32&~r),e.dataEncipherment=!(16&~r),e.keyAgreement=!(8&~r),e.keyCertSign=!(4&~r),e.cRLSign=!(2&~r),e.encipherOnly=!(1&~r),e.decipherOnly=!(128&~s)}(t);break;case"basicConstraints":!function(e){const t=i.ASN1.fromDER(e.value),r=t.mustCompound();r.length>0&&r[0].tag===i.Tag.BOOLEAN?e.isCA=i.ASN1.parseBool(r[0].bytes):e.isCA=!1;let s=null;r.length>0&&r[0].tag===i.Tag.INTEGER?s=r[0].bytes:r.length>1&&(s=r[1].bytes);e.maxPathLen=null!==s?i.ASN1.parseInteger(s):-1;e.basicConstraintsValid=!0}(t);break;case"extKeyUsage":!function(e){const t=i.ASN1.fromDER(e.value),r=t.mustCompound();for(const t of r)e[o.getOIDName(i.ASN1.parseOID(t.bytes))]=!0}(t);break;case"nsCertType":!function(e){const t=i.ASN1.parseBitString(i.ASN1.fromDER(e.value).bytes);let r=0;t.buf.length>0&&(r=t.buf[0]);e.client=!(128&~r),e.server=!(64&~r),e.email=!(32&~r),e.objsign=!(16&~r),e.reserved=!(8&~r),e.sslCA=!(4&~r),e.emailCA=!(2&~r),e.objCA=!(1&~r)}(t);break;case"subjectAltName":case"issuerAltName":p(t);break;case"subjectKeyIdentifier":!function(e){const t=i.ASN1.parseDERWithTemplate(e.value,f);e.subjectKeyIdentifier=t.subjectKeyIdentifier.bytes.toString("hex")}(t);break;case"authorityKeyIdentifier":!function(e){const t=i.ASN1.parseDERWithTemplate(e.value,g);e.authorityKeyIdentifier=t.authorityKeyIdentifier.bytes.toString("hex")}(t);break;case"authorityInfoAccess":!function(e){const t=i.ASN1.parseDERWithTemplate(e.value,m);null!=t.authorityInfoAccessOcsp&&(e.authorityInfoAccessOcsp=t.authorityInfoAccessOcsp.bytes.toString());null!=t.authorityInfoAccessIssuers&&(e.authorityInfoAccessIssuers=t.authorityInfoAccessIssuers.bytes.toString())}(t)}return t}function p(e){e.altNames=[];const t=i.ASN1.fromDER(e.value).mustCompound();for(const r of t){const t={tag:r.tag,value:r.bytes};switch(e.altNames.push(t),r.tag){case 1:t.email=r.bytes.toString();break;case 2:t.dnsName=r.bytes.toString();break;case 6:t.uri=r.bytes.toString();break;case 7:t.ip=o.bytesToIP(r.bytes);break;case 8:t.oid=i.ASN1.parseOID(r.bytes)}}}t.Certificate=d;const f={name:"subjectKeyIdentifier",class:i.Class.UNIVERSAL,tag:i.Tag.OCTETSTRING,capture:"subjectKeyIdentifier"};const g={name:"authorityKeyIdentifier",class:i.Class.UNIVERSAL,tag:i.Tag.SEQUENCE,value:[{name:"authorityKeyIdentifier.value",class:i.Class.CONTEXT_SPECIFIC,tag:i.Tag.NONE,capture:"authorityKeyIdentifier"}]};const m={name:"authorityInfoAccess",class:i.Class.UNIVERSAL,tag:i.Tag.SEQUENCE,value:[{name:"authorityInfoAccess.authorityInfoAccessOcsp",class:i.Class.UNIVERSAL,tag:i.Tag.SEQUENCE,optional:!0,value:[{name:"authorityInfoAccess.authorityInfoAccessOcsp.oid",class:i.Class.UNIVERSAL,tag:i.Tag.OID},{name:"authorityInfoAccess.authorityInfoAccessOcsp.value",class:i.Class.CONTEXT_SPECIFIC,tag:i.Tag.OID,capture:"authorityInfoAccessOcsp"}]},{name:"authorityInfoAccess.authorityInfoAccessIssuers",class:i.Class.UNIVERSAL,tag:i.Tag.SEQUENCE,optional:!0,value:[{name:"authorityInfoAccess.authorityInfoAccessIssuers.oid",class:i.Class.UNIVERSAL,tag:i.Tag.OID},{name:"authorityInfoAccess.authorityInfoAccessIssuers.value",class:i.Class.CONTEXT_SPECIFIC,tag:i.Tag.OID,capture:"authorityInfoAccessIssuers"}]}]};function y(e){for(const t of e){if(null!=t.name&&""!==t.name||(null!=t.oid&&(t.name=o.getOIDName(t.oid)),""===t.name&&null!=t.shortName&&(t.name=o.getOIDName(c[t.shortName]))),null==t.oid||""===t.oid){if(""===t.name)throw new Error("Attribute oid not specified.");t.oid=o.getOID(t.name)}if(null!=t.shortName&&""!==t.shortName||(t.shortName=null==c[t.name]?"":c[t.name]),null==t.value)throw new Error("Attribute value not specified.")}}function b(e){const t=[];for(const s of e.mustCompound())for(const e of s.mustCompound()){const s=e.mustCompound(),n={};n.oid=i.ASN1.parseOID(s[0].bytes),n.value=s[1].value,n.valueTag=s[1].tag,n.name=o.getOIDName(n.oid),n.shortName=(r=n.name,null==c[r]?"":c[r]),t.push(n)}var r;return t}function v(e){return null==e||e instanceof Buffer||"function"!=typeof e.toJSON?e:e.toJSON()}},381:(e,t)=>{var r,s=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.decode=function(e,t,r){if(t=~~t,(r=r||e.length-t)===s.size)return s.decode(e,t,r);if(r===n.size)return n.decode(e,t,r);throw Error(`Invalid buffer size needs to be ${s.size} for v4 or ${n.size} for v6.`)},e.encode=function(e,t,r){r=~~r;const o=i(e);"function"==typeof t&&(t=t(r+o));if(o===s.size)return s.encode(e,t,r);return n.encode(e,t,r)},e.familyOf=function(e){return i(e)===s.size?1:2},e.name=void 0,e.sizeOf=i,e.v6=e.v4=void 0;const t=/^(\d{1,3}\.){3,3}\d{1,3}$/,r=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i,s={name:"v4",size:4,isFormat:e=>t.test(e),encode(e,t,r){r=~~r,t=t||new Uint8Array(r+4);const s=e.length;let n=0;for(let i=0;i<s;){const s=e.charCodeAt(i++);46===s?(t[r++]=n,n=0):n=10*n+(s-48)}return t[r]=n,t},decode:(e,t)=>(t=~~t,`${e[t++]}.${e[t++]}.${e[t++]}.${e[t]}`)};e.v4=s;const n={name:"v6",size:16,isFormat:e=>e.length>0&&r.test(e),encode(e,t,r){let s=(r=~~r)+16,n=-1,i=0,o=0,a=!0,c=!1;t=t||new Uint8Array(r+16);for(let u=0;u<e.length;u++){let l=e.charCodeAt(u);58===l?(a?-1!==n?(r<s&&(t[r]=0),r<s-1&&(t[r+1]=0),r+=2):r<s&&(n=r):(!0===c?(r<s&&(t[r]=o),r++):(r<s&&(t[r]=i>>8),r<s-1&&(t[r+1]=255&i),r+=2),i=0,o=0),a=!0,c=!1):46===l?(r<s&&(t[r]=o),r++,o=0,i=0,a=!1,c=!0):(a=!1,l>=97?l-=87:l>=65?l-=55:(l-=48,o=10*o+l),i=(i<<4)+l)}if(!1===a)!0===c?(r<s&&(t[r]=o),r++):(r<s&&(t[r]=i>>8),r<s-1&&(t[r+1]=255&i),r+=2);else if(0===n)r<s&&(t[r]=0),r<s-1&&(t[r+1]=0),r+=2;else if(-1!==n){r+=2;for(let e=Math.min(r-1,s-1);e>=n+2;e--)t[e]=t[e-2];t[n]=0,t[n+1]=0,n=r}if(n!==r&&-1!==n)for(r>s-2&&(r=s-2);s>n;)t[--s]=r<s&&r>n?t[--r]:0;else for(;r<s;)t[r++]=0;return t},decode(e,t){t=~~t;let r="";for(let s=0;s<16;s+=2)0!==s&&(r+=":"),r+=(e[t+s]<<8|e[t+s+1]).toString(16);return r.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}};e.v6=n;function i(e){if(s.isFormat(e))return s.size;if(n.isFormat(e))return n.size;throw Error(`Invalid ip address: ${e}`)}return e.name="ip","default"in e?e.default:e}({});void 0===(r=function(){return s}.apply(t,[]))||(e.exports=r)},386:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SctpTransportManager=void 0;const s=r(5433),n=r(9420),i=r(4579),o=r(6779),a=(0,s.debug)("werift:packages/webrtc/src/transport/sctpManager.ts");t.SctpTransportManager=class{constructor(){this.dataChannelsOpened=0,this.dataChannelsClosed=0,this.dataChannels=[],this.onDataChannel=new s.Event}createSctpTransport(){const e=new o.RTCSctpTransport;return e.mid=void 0,e.onDataChannel.subscribe((e=>{this.dataChannelsOpened++,this.dataChannels.push(e),this.onDataChannel.execute(e)})),this.sctpTransport=e,e}createDataChannel(e,t={}){const r={protocol:"",ordered:!0,negotiated:!1,...t};if(r.maxPacketLifeTime&&r.maxRetransmits)throw new Error("can not select both");this.sctpTransport||(this.sctpTransport=this.createSctpTransport());const s=new n.RTCDataChannelParameters({id:r.id,label:e,maxPacketLifeTime:r.maxPacketLifeTime,maxRetransmits:r.maxRetransmits,negotiated:r.negotiated,ordered:r.ordered,protocol:r.protocol}),i=new n.RTCDataChannel(this.sctpTransport,s);return this.dataChannelsOpened++,this.dataChannels.push(i),i.stateChange.subscribe((e=>{if("closed"===e){this.dataChannelsClosed++;const e=this.dataChannels.indexOf(i);-1!==e&&this.dataChannels.splice(e,1)}})),i}async connectSctp(){this.sctpTransport&&this.sctpRemotePort&&(await this.sctpTransport.start(this.sctpRemotePort),await this.sctpTransport.sctp.stateChanged.connected.asPromise(),a("sctp connected"))}setRemoteSCTP(e,t){if(this.sctpTransport){if(this.sctpRemotePort=e.sctpPort,!this.sctpRemotePort)throw new Error("sctpRemotePort not exist");this.sctpTransport.setRemotePort(this.sctpRemotePort),this.sctpTransport.mLineIndex=t,this.sctpTransport.mid||(this.sctpTransport.mid=e.rtp.muxId)}}async close(){this.sctpTransport&&await this.sctpTransport.stop(),this.onDataChannel.allUnsubscribe()}async getStats(){const e=(0,i.getStatsTimestamp)(),t=[];for(const r of this.dataChannels){const s={type:"data-channel",id:(0,i.generateStatsId)("data-channel",r.id),timestamp:e,label:r.label,protocol:r.protocol,dataChannelIdentifier:r.id,state:r.readyState,messagesSent:r.messagesSent||0,bytesSent:r.bytesSent||0,messagesReceived:r.messagesReceived||0,bytesReceived:r.bytesReceived||0};t.push(s)}return t}}},394:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=394,e.exports=t},431:function(e,t,r){"use strict";var s,n=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=s(e),o=0;o<r.length;o++)"default"!==r[o]&&n(t,e,r[o]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTCPlugin=void 0,t.fork=async function(){return{exit(){N()},async createRTCPeerConnectionSource(e){try{const t=await(0,A.createRTCPeerConnectionSource)({nativeId:this.nativeId,mixinId:e.mixinId,mediaStreamOptions:e.mediaStreamOptions,startRTCSignalingSession:t=>e.startRTCSignalingSession(t),maximumCompatibilityMode:e.maximumCompatibilityMode});return t.pcClose().finally((()=>N())),t}catch(e){throw N(),e}},async createConnection(e,t,r,s,n){try{const i=await async function(e,t,r,s,n){let i=!1;n.weriftConfiguration.iceFilterCandidatePair=e=>{const t=i;return i||=n.ipv4Ban?.includes(e.remoteCandidate.host),i||=n.ipv4Ban?.includes(e.remoteCandidate.relatedAddress),!t&&i&&console.warn("Banned 6to4 gateway detected, forcing IPv6.",e.remoteCandidate.host,e.remoteCandidate.relatedAddress),!i||(!v.default.isV4Format(e.remoteCandidate.host)||!v.default.isV4Format(e.remoteCandidate.relatedAddress))};const o=new u.Deferred;o.promise.catch((e=>this.console.log("cleaning up rtc connection:",e.message)));const a=new w.WebRTCConnectionManagement(console,e,t,r,s,n);o.promise.finally((()=>a.close().catch((()=>{}))));const{pc:c}=a;(0,C.waitClosed)(c).then((()=>o.resolve("peer connection closed")));const l=c.createDataChannel("rpc"),d=(0,y.createDataChannelSerializer)(l),h=new m.RpcPeer("webrtc-plugin","webrtc-client",d.sendMessage);d.setupRpcPeer(h),l.onmessage=e=>{e.data instanceof Buffer&&d.onData(e.data)};const p=async e=>await f.default.connectRPCObject(e);return h.params.connectRPCObject=p,a}(e,t,r,s,n);return i.waitClosed().finally((()=>N())),i}catch(e){throw N(),e}}}};const c=r(2889),u=r(3290),l=r(488),d=r(3301),h=r(1854),p=r(2335),f=o(r(2743)),g=r(1414),m=r(8114),y=r(4991),b=a(r(6982)),v=a(r(3139)),S=a(r(857)),w=r(7910),E=r(1690),C=r(4779),T=r(1856),I=r(3377),_=r(441),A=r(6238),{mediaManager:R,systemManager:P,deviceManager:k}=f.default;function B(e){setTimeout((()=>{e.result.then((e=>e.exit())).catch((()=>{}))}),1e3),setTimeout((()=>{e.worker.terminate()}),1e4)}I.defaultPeerConfig.headerExtensions={video:[],audio:[]};class O extends h.SettingsMixinDeviceBase{constructor(e,t){super(t),this.plugin=e,this.storageSettings=new g.StorageSettings(this,{})}async startIntercom(e){if(this.webrtcIntercom){return(await this.webrtcIntercom).startIntercom(e)}if(this.mixinDeviceInterfaces.includes(f.ScryptedInterface.Intercom))return this.mixinDevice.startIntercom(e);if(!this.mixinDeviceInterfaces.includes(f.ScryptedInterface.RTCSignalingClient)){if((this.type===f.ScryptedDeviceType.Speaker||this.type===f.ScryptedDeviceType.SmartSpeaker)&&this.mixinDeviceInterfaces.includes(f.ScryptedInterface.RTCSignalingChannel)){this.console.log("starting webrtc speaker intercom");const t=new I.RTCPeerConnection,r=new I.MediaStreamTrack({kind:"audio"}),s=t.addTransceiver(r),n=new _.WeriftSignalingSession(this.console,t),i=await this.mixinDevice.startRTCSignalingSession(n),o=await(0,w.createTrackForwarder)({timeStart:Date.now(),videoTransceiver:void 0,audioTransceiver:s,isLocalNetwork:void 0,destinationId:void 0,ipv4:void 0,type:void 0,requestMediaStream:async()=>e,maximumCompatibilityMode:!1,clientOptions:void 0});return(0,C.waitClosed)(t).finally((()=>o.kill())),o.killPromise.finally((()=>t.close())),void o.killPromise.finally((()=>i.endSession()))}throw new Error("webrtc session not connected.")}{const t=await this.mixinDevice.createRTCSignalingSession();await(0,w.createRTCPeerConnectionSink)(t,this.console,void 0,e,this.plugin.storageSettings.values.requireOpus,this.plugin.storageSettings.values.maximumCompatibilityMode,this.plugin.getRTCConfiguration(),await this.plugin.getWeriftConfiguration())}}async stopIntercom(){if(this.webrtcIntercom){return(await this.webrtcIntercom).stopIntercom()}if(this.mixinDeviceInterfaces.includes(f.ScryptedInterface.Intercom))return this.mixinDevice.stopIntercom();throw new Error("webrtc session not connected.")}async startRTCSignalingSession(e){const t=await(0,d.legacyGetSignalingSessionOptions)(e);if(this.mixinDeviceInterfaces.includes(f.ScryptedInterface.RTCSignalingChannel)&&!t?.proxy)return this.mixinDevice.startRTCSignalingSession(e);const r=P.getDeviceById(this.id),s=this.mixinDeviceInterfaces.includes(f.ScryptedInterface.Intercom),n=await R.createMediaObject((async e=>r.getVideoStream(e)),f.ScryptedMimeTypes.RequestMediaStream,{sourceId:r.id});return(0,w.createRTCPeerConnectionSink)(e,this.console,s?"sendrecv":"recvonly",n,this.plugin.storageSettings.values.requireOpus,this.plugin.storageSettings.values.maximumCompatibilityMode,this.plugin.getRTCConfiguration(),await this.plugin.getWeriftConfiguration(t?.disableTurn),!0!==t?.requiresAnswer)}getMixinSettings(){return this.storageSettings.getSettings()}putMixinSetting(e,t){return this.storageSettings.putSetting(e,t)}createVideoStreamOptions(){const e=(0,A.getRTCMediaStreamOptions)("webrtc","WebRTC");return e.source="cloud",e}async getVideoStream(e){if(this.mixinDeviceInterfaces.includes(f.ScryptedInterface.VideoCamera)&&"webrtc"!==e?.id)return this.mixinDevice.getVideoStream(e);const t=this.plugin.createTrackedFork(),r=await t.result;try{const{getIntercom:e,mediaObject:s,pcClose:n}=await r.createRTCPeerConnectionSource({__json_copy_serialize_children:!0,nativeId:this.nativeId,mixinId:this.id,mediaStreamOptions:this.createVideoStreamOptions(),startRTCSignalingSession:e=>this.mixinDevice.startRTCSignalingSession(e),maximumCompatibilityMode:this.plugin.storageSettings.values.maximumCompatibilityMode});this.webrtcIntercom=e();return n().finally((()=>{this.webrtcIntercom=void 0,B(t)})),s}catch(e){throw B(t),e}}async getVideoStreamOptions(){let e=[];return this.mixinDeviceInterfaces.includes(f.ScryptedInterface.VideoCamera)&&(e=await this.mixinDevice.getVideoStreamOptions()),e.push(this.createVideoStreamOptions()),e}}class x extends c.AutoenableMixinProvider{constructor(){super(),this.storageSettings=new g.StorageSettings(this,{iceInterfaceAddresses:{title:"ICE Interface Addresses",description:"The ICE interface addresses to bind and share with the peer.",choices:["Default","Scrypted Server Address","All Addresses"],defaultValue:"Default"},requireOpus:{group:"Advanced",title:"Require Opus Audio Codec",type:"boolean"},maximumCompatibilityMode:{group:"Advanced",title:"Maximum Compatibility Mode",description:"Debug: Enables maximum compatibility with WebRTC clients by transcoding to known safe reference codecs. This setting will automatically reset when the plugin or Scrypted restarts.",defaultValue:!1,type:"boolean"},useTurnServer:{group:"Advanced",title:"Use TURN Servers",description:"Uses a intermediary server to send video streams when necessary. Traverses around restrictive NATs.",type:"boolean",defaultValue:!0},activeConnections:{readonly:!0,title:"Current Open Connections",description:"The WebRTC connections that are currently open.",onGet:async()=>({defaultValue:this.activeConnections})},ipv4Ban:{group:"Advanced",title:"6to4 Ban",description:"The following IP addresses will trigger forcing an IPv6 connection. The default list includes T-Mobile's 6to4 gateway.",defaultValue:[],choices:["192.0.0.4"],combobox:!0,multiple:!0},debugLog:{group:"Advanced",title:"Debug Log",type:"boolean"},rtcConfiguration:{group:"Advanced",title:"Custom Client RTC Configuration",type:"textarea",description:"RTCConfiguration that can be used to specify custom TURN and STUN servers. https://gist.github.com/koush/f7dafec7dbca04982a76db8243abc57e"},weriftConfiguration:{group:"Advanced",title:"Custom Server RTC Configuration",type:"textarea",description:"RTCConfiguration that can be used to specify custom TURN and STUN servers. https://gist.github.com/koush/631d38ac8647a86baaac7b22d863f010"}}),this.activeConnections=0,this.zygote=(0,p.createZygote)(),this.storageSettings.values.maximumCompatibilityMode=!1,this.converters=[["*/*",f.ScryptedMimeTypes.RTCSignalingChannel],[f.ScryptedMimeTypes.RTCSignalingSession,f.ScryptedMimeTypes.RTCConnectionManagement],[f.ScryptedMimeTypes.RTCSignalingChannel,f.ScryptedMimeTypes.FFmpegInput]],k.onDevicesChanged({devices:[]})}shouldUnshiftMixin(){return!0}getSettings(){return this.storageSettings.getSettings()}putSetting(e,t){return this.storageSettings.putSetting(e,t)}async convertToSignalingChannel(e,t,r,s){const n=this,i=k.getMixinConsole(s?.sourceId,this.nativeId);if(t!==f.ScryptedMimeTypes.FFmpegInput&&t!==f.ScryptedMimeTypes.RequestMediaStream){try{const r=await R.createMediaObject(e,t);e=await R.convertMediaObjectToJSON(r,f.ScryptedMimeTypes.FFmpegInput)}catch(e){throw i.error("failed to create media object:",e),new Error(`@scrypted/webrtc is unable to convert ${t} to ${f.ScryptedMimeTypes.RTCSignalingChannel}`)}t=f.ScryptedMimeTypes.FFmpegInput}if(t===f.ScryptedMimeTypes.FFmpegInput){const t="object"!=typeof e||Buffer.isBuffer(e)?JSON.parse(e.toString()):e,r=await R.createFFmpegMediaObject(t,{sourceId:s?.sourceId});let o=f.default.systemManager.getDeviceById(r.sourceId);o.interfaces?.includes(f.ScryptedInterface.Intercom)||(o=void 0);const a=o?"sendrecv":void 0;class c{async startRTCSignalingSession(e){return(0,w.createRTCPeerConnectionSink)(e,i,a,r,n.storageSettings.values.requireOpus,n.storageSettings.values.maximumCompatibilityMode,n.getRTCConfiguration(),await n.getWeriftConfiguration())}}return new c}const o=e,a=await R.createMediaObject(o,f.ScryptedMimeTypes.RequestMediaStream);return new class{async startRTCSignalingSession(e){return(0,w.createRTCPeerConnectionSink)(e,i,void 0,a,n.storageSettings.values.requireOpus,n.storageSettings.values.maximumCompatibilityMode,n.getRTCConfiguration(),await n.getWeriftConfiguration())}}}async convertToRTCConnectionManagement(e,t,r,s,n){const i=await this.getWeriftConfiguration(),o=t,a=!!this.storageSettings.values.maximumCompatibilityMode,c=await(0,d.legacyGetSignalingSessionOptions)(o);let u;try{const{createConnection:t}=await e.result;u=await t(o,this.storageSettings.values.requireOpus,a,c,{configuration:this.getRTCConfiguration(),weriftConfiguration:i,ipv4Ban:this.storageSettings.values.ipv4Ban})}catch(t){throw B(e),t}return await u.negotiateRTCSignalingSession(),await u.waitConnected(),u}async convertToFFmpegInput(e,t,r,s,n){const i=t;try{const{createRTCPeerConnectionSource:t}=await e.result,r=(await t({__json_copy_serialize_children:!0,nativeId:void 0,mixinId:void 0,mediaStreamOptions:{id:"webrtc",name:"WebRTC",source:"cloud"},startRTCSignalingSession:e=>i.startRTCSignalingSession(e),maximumCompatibilityMode:this.storageSettings.values.maximumCompatibilityMode})).mediaObject;return await R.convertMediaObjectToJSON(r,f.ScryptedMimeTypes.FFmpegInput)}catch(t){throw B(e),t}}createTrackedFork(){const e=this.zygote();return this.activeConnections++,e.worker.on("exit",(()=>{this.activeConnections--})),e}async convertMedia(e,t,r,s){if(t===f.ScryptedMimeTypes.RTCSignalingSession&&r===f.ScryptedMimeTypes.RTCConnectionManagement){const n=this.createTrackedFork();try{const i=await(0,l.timeoutPromise)(12e4,this.convertToRTCConnectionManagement(n,e,t,r,s));return i.waitClosed().finally((()=>B(n))),i}catch(e){throw B(n),e}}else{if(t!==f.ScryptedMimeTypes.RTCSignalingChannel||r!==f.ScryptedMimeTypes.FFmpegInput){if(r===f.ScryptedMimeTypes.RTCSignalingChannel)return this.convertToSignalingChannel(e,t,r,s);throw new Error(`@scrypted/webrtc is unable to convert ${t} to ${r}`)}{const n=this.createTrackedFork();try{return await(0,l.timeoutPromise)(12e4,this.convertToFFmpegInput(n,e,t,r,s))}catch(e){throw B(n),e}}}}async canMixin(e,t){if(t.includes(f.ScryptedInterface.RTCSignalingChannel)||t.includes(f.ScryptedInterface.RTCSignalingClient)){const t=[f.ScryptedInterface.RTCSignalingChannel,f.ScryptedInterface.Settings];if(e===f.ScryptedDeviceType.Speaker)t.push(f.ScryptedInterface.Intercom);else if(e===f.ScryptedDeviceType.SmartSpeaker)t.push(f.ScryptedInterface.Intercom,f.ScryptedInterface.Microphone);else if(e===f.ScryptedDeviceType.Camera||e===f.ScryptedDeviceType.Doorbell)t.push(f.ScryptedInterface.VideoCamera,f.ScryptedInterface.Intercom);else if(e===f.ScryptedDeviceType.Display)t.push(f.ScryptedInterface.Intercom,f.ScryptedInterface.Display);else{if(e!==f.ScryptedDeviceType.SmartDisplay)return;t.push(f.ScryptedInterface.Intercom,f.ScryptedInterface.Microphone,f.ScryptedInterface.Display,f.ScryptedInterface.VideoCamera)}return t}if([f.ScryptedDeviceType.Camera,f.ScryptedDeviceType.Doorbell].includes(e)&&t.includes(f.ScryptedInterface.VideoCamera))return[f.ScryptedInterface.RTCSignalingChannel]}async getMixin(e,t,r){return new O(this,{mixinDevice:e,mixinDeviceInterfaces:t,mixinDeviceState:r,group:"WebRTC",groupKey:"webrtc",mixinProviderNativeId:this.nativeId})}async releaseMixin(e,t){await t.release()}async getCreateDeviceSettings(){return[{key:"name",title:"Name",description:"The name of the browser connected camera."}]}async createDevice(e){const t=b.default.randomBytes(8).toString("hex");return await k.onDeviceDiscovered({name:e.name?.toString(),type:f.ScryptedDeviceType.Camera,nativeId:t,interfaces:[f.ScryptedInterface.RTCSignalingClient,f.ScryptedInterface.Display,f.ScryptedInterface.Intercom,f.ScryptedInterface.VideoCamera]}),t}async getDevice(e){return new T.WebRTCCamera(this,e)}async releaseDevice(e,t){}getRTCConfiguration(){if(this.storageSettings.values.rtcConfiguration)try{return JSON.parse(this.storageSettings.values.rtcConfiguration)}catch(e){this.console.error("Custom RTC configuration failed. Invalid JSON?",e)}return{iceServers:this.storageSettings.values.useTurnServer?[...E.turnServers]:[...E.stunServers]}}async getWeriftConfiguration(e){let t;if(this.storageSettings.values.weriftConfiguration)try{t=JSON.parse(this.storageSettings.values.weriftConfiguration)}catch(e){this.console.error("Custom Werift configuration failed. Invalid JSON?",e)}const r=this.storageSettings.values.useTurnServer&&!e?[...E.weriftStunServers,...E.weriftTurnServers]:[...E.weriftStunServers];let s,n,i;if("All Addresses"!==this.storageSettings.values.iceInterfaceAddresses)try{s=await f.default.endpointManager.getLocalAddresses()}catch(e){}if(s||=[],s.length){const e=Object.values(S.default.networkInterfaces()).flat();s=s.filter((t=>e.find((e=>e.address===t)))),s.length&&(n=!1,i=!1)}return t?.iceAdditionalHostAddresses&&s.push(...t.iceAdditionalHostAddresses),s=[...new Set(s)],s.length||(s=void 0),{iceServers:r,iceUseIpv4:n,iceUseIpv6:i,iceAdditionalHostAddresses:s,...t}}}function N(){setTimeout((()=>{process.exit(0)}),1e3)}t.WebRTCPlugin=x,t.default=x},441:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WeriftSignalingSession=void 0;const n=r(3377),i=r(4813),o=r(7724),a=s(r(3139));function c(e){return!a.default.isV4Format(e)&&a.default.isV6Format(e)}t.WeriftSignalingSession=class{constructor(e,t){this.console=e,this.pc=t,this.options={},this.localHasV6=!1,this.remoteHasV6=!1}async getOptions(){return{}}async createLocalDescription(e,t,r){let s;if(this.pc.onIceCandidate.subscribe((e=>{this.localHasV6||=c(e.candidate?.split(" ")?.[4]),r?.({candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex})})),"offer"===e){let e=await this.pc.createOffer();r?this.pc.setLocalDescription(e):e=(await this.pc.setLocalDescription(e)).toJSON(),s=(0,i.createRawResponse)(e)}else{r||await this.remoteDescription;let e=await this.pc.createAnswer();r?this.pc.setLocalDescription(e):e=(await this.pc.setLocalDescription(e)).toJSON(),s=(0,i.createRawResponse)(e)}return s}async setRemoteDescription(e,t){this.remoteDescription=this.pc.setRemoteDescription(e)}async addIceCandidate(e){this.remoteHasV6||=c(e.candidate?.split(" ")?.[4]),e.candidate?.includes("relay")?await(0,o.sleep)(500):e.candidate?.includes("srflx")&&await(0,o.sleep)(250),await this.pc.addIceCandidate(new n.RTCIceCandidate(e))}}},476:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Flight6=void 0;const s=r(6203),n=r(91),i=r(9602),o=r(3038),a=r(8241),c=r(2499),u=r(9919),l=r(695),d=r(5205),h=r(6282),p=r(5982),f=r(3254),g=(0,d.debug)("werift-dtls : packages/dtls/flight/server/flight6.ts");class m extends f.Flight{constructor(e,t,r){super(e,t,6),this.cipher=r}handleHandshake(e){this.dtls.bufferHandshakeCache([e],!1,5);const t=(()=>{switch(e.msg_type){case i.HandshakeType.certificate_11:return o.Certificate.deSerialize(e.fragment);case i.HandshakeType.certificate_verify_15:return c.CertificateVerify.deSerialize(e.fragment);case i.HandshakeType.client_key_exchange_16:return u.ClientKeyExchange.deSerialize(e.fragment);case i.HandshakeType.finished_20:return l.Finished.deSerialize(e.fragment)}})();if(t){const e=y[t.msgType];if(!e)return;e({dtls:this.dtls,cipher:this.cipher})(t)}}async exec(){if(6===this.dtls.flight)return g(this.dtls.sessionId,"flight6 twice"),void this.send(this.dtls.lastMessage);this.dtls.flight=6;const e=[this.sendChangeCipherSpec(),this.sendFinished()];this.dtls.lastMessage=e,await this.transmit(e)}sendChangeCipherSpec(){const e=a.ChangeCipherSpec.createEmpty().serialize(),t=(0,h.createPlaintext)(this.dtls)([{type:p.ContentType.changeCipherSpec,fragment:e}],++this.dtls.recordSequenceNumber);return Buffer.concat(t.map((e=>e.serialize())))}sendFinished(){const e=Buffer.concat(this.dtls.sortedHandshakeCache.map((e=>e.serialize()))),t=this.cipher.verifyData(e),r=new l.Finished(t);this.dtls.epoch=1;const[s]=this.createPacket([r]);this.dtls.recordSequenceNumber=0;return this.cipher.encryptPacket(s).serialize()}}t.Flight6=m;const y={};y[i.HandshakeType.client_key_exchange_16]=({cipher:e,dtls:t})=>r=>{if(e.remoteKeyPair={curve:e.namedCurve,publicKey:r.publicKey},!(e.remoteKeyPair.publicKey&&e.localKeyPair&&e.remoteRandom&&e.localRandom))throw new Error("not exist");const i=(0,n.prfPreMasterSecret)(e.remoteKeyPair.publicKey,e.localKeyPair.privateKey,e.localKeyPair.curve);g(t.sessionId,"extendedMasterSecret",t.options.extendedMasterSecret,t.remoteExtendedMasterSecret);const o=Buffer.concat(t.sortedHandshakeCache.map((e=>e.serialize())));e.masterSecret=t.options.extendedMasterSecret&&t.remoteExtendedMasterSecret?(0,n.prfExtendedMasterSecret)(i,o):(0,n.prfMasterSecret)(i,e.remoteRandom.serialize(),e.localRandom.serialize()),e.cipher=(0,s.createCipher)(e.cipherSuite),e.cipher.init(e.masterSecret,e.localRandom.serialize(),e.remoteRandom.serialize()),g(t.sessionId,"setup cipher",e.cipher.summary)},y[i.HandshakeType.finished_20]=({dtls:e})=>t=>{g(e.sessionId,"finished",t)}},488:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeoutError=void 0,t.singletonPromise=function(e,t,r=0){if(e?.promise)return e;const s=t();e?e.promise=s:e={promise:s,cacheDuration:r};return s.finally((()=>setTimeout((()=>e.promise=void 0),e.cacheDuration))),e},t.timeoutPromise=function(e,t){return new Promise(((s,n)=>{const i=setTimeout((()=>n(new r(t))),e);t.then((e=>{clearTimeout(i),s(e)})).catch((e=>{clearTimeout(i),n(e)}))}))},t.timeoutFunction=function(e,t){return new Promise(((s,n)=>{let i=!1;const o=t((()=>i)),a=setTimeout((()=>{i=!0,n(new r(o))}),e);o.then((e=>{clearTimeout(a),s(e)})).catch((e=>{clearTimeout(a),n(e)}))}))},t.createPromiseDebouncer=function(){let e;return t=>(e||(e=t().finally((()=>e=void 0))),e)},t.createMapPromiseDebouncer=function(){const e=new Map;return(t,r,s)=>{const n=JSON.stringify(t);let i=e.get(n);return i||(i=s().finally((()=>{r?setTimeout((()=>e.delete(n)),r):e.delete(n)})),e.set(n,i)),i}};class r extends Error{constructor(e){super("Operation Timed Out"),this.promise=e}}t.TimeoutError=r},532:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.startRtpForwarderProcess=async function(e,t,r,s){r.audio||delete r.audio;r.video||delete r.video;const u=new n.Deferred,m=e=>{const t=e?.onRtp;t&&(e.onRtp=(e,r)=>{if(u.finished)return;const s=127&e.readUint8(1);s>=72&&s<=76||t(e,r)})};m(r.video),m(r.audio);let y,{inputArguments:b}=t;u.promise.finally((()=>y?.safeTeardown()));let v=!1;const{rtspMode:S,onRtspClient:w,rtspClientForceTcp:E}=s||{},{video:C,audio:T}=r;r=Object.assign({},r);const I=C?.codecCopy,_=T?.codecCopy,A=s?.ffmpegPath||await h.getFFmpegPath(),R=t.container?.startsWith("rtsp");let P;const k=new n.Deferred;u.promise.finally((()=>{k.finished||k.reject(new Error("killed"))}));const B=new n.Deferred,O=new n.Deferred;B.promise.then((e=>C?.onMSection?.(e))),O.promise.then((e=>T?.onMSection?.(e)));let x,N,D=!1;if(t.url&&R&&(!C||(L=I,M=t.mediaStreamOptions?.video?.codec,"copy"===L||L&&L===M))){delete r.video,y=new a.RtspClient(t.url),y.requestTimeout=1e4;try{const t=await y.options();P=(await y.describe()).body.toString();const s=(0,c.parseSdp)(P);let n,h=0;if(C){if(n=s.msections.find((e=>"video"===e.type&&(e.codec===I||"copy"===I))),!n)throw new Error(`advertised video codec ${I} not found in sdp.`);n.codec||(e.warn("Unable to determine sdpvideo codec? Please report this to @koush on Discord."),e.warn(P)),B.resolve(n);const t=new Set;t.add(n);for(const e of C.alternateCodecs||[]){const r=s.msections.find((t=>"video"===t.type&&t.codec===e));r&&!t.has(r)&&t.add(r)}const r=p(C);for(const s of t)await g(e,y,h,s,E,r),h+=2}else B.resolve(void 0);const f=s.msections.filter((e=>"audio"===e.type));let m=f.find((e=>e.codec&&e.codec===_||"copy"===_));if(!m)for(const e of f)if(!0===await(T?.negotiate?.(e))){m=e;break}if(e.log("a/v",I,_,"found",n?.codec,m?.codec),T)if(m){delete r.audio,O.resolve(m);const t=new Set;t.add(m);for(const e of T.alternateCodecs||[]){const r=s.msections.find((t=>"audio"===t.type&&t.codec===e));r&&!t.has(r)&&t.add(r)}const n=p(T);for(const r of t)await g(e,y,h,r,E,n),h+=2}else{const t=(0,c.parseSdp)(P),s=t.msections.find((e=>"audio"===e.type));if(s){t.msections=t.msections.filter((e=>e===s));const r=(0,c.addTrackControls)((0,c.replaceSectionPort)(t.toSdp(),"audio",0)),n=(0,c.parseSdp)(r).msections.find((e=>"audio"===e.type)).control;let p=!0,f=!1;const m=await g(e,y,h,s,!1,(t=>{if(p&&(p=!1,"aac"===s.codec)){const r=d.RtpPacket.deSerialize(t).payload;if(255==r[0]&&!(240&~r[1])){f=!0,D=!0;const t=["-hide_banner","-f","aac","-i","pipe:3",...T.encoderArguments,...T.outputArguments];(0,o.safePrintFFmpegArguments)(e,t);const r=l.default.spawn(A,t,{stdio:["pipe","pipe","pipe","pipe","pipe"]});(0,o.ffmpegLogInitialOutput)(e,r),u.promise.finally((()=>(0,o.safeKillFFmpeg)(r))),r.on("exit",(()=>u.resolve(void 0))),r.on("error",(()=>u.resolve(void 0))),S=r.stdio[3]}}if(f){const e=d.RtpPacket.deSerialize(t);S?.write(e.payload)}else w?.sendTrack(n,t,!1)})),v=await(0,i.listenZeroSingleClient)("127.0.0.1");let S,w;u.promise.finally((()=>v.clientPromise.then((e=>e.destroy())))),v.clientPromise.then((async e=>{const t=new a.RtspServer(e,r,!m);u.promise.finally((()=>t.destroy())),await t.handlePlayback(),w=t})).catch((e=>{u.finished||u.reject(e)})),T.ffmpegDestination="127.0.0.1",T.srtp=void 0,b=["-analyzeduration","0","-probesize","512","-i",`rtsp://${v.host}:${v.port}`]}else delete r.audio,e.warn("audio section not found in sdp."),O.resolve(void 0)}else O.resolve(void 0);v=await(w?.(y,t)),v||await y.play()}catch(e){throw y.client.destroy(),e}}else e.log("video codec/container not matched, transcoding:",I,JSON.stringify(t));var L,M;const U=e=>{k.resolve(e);const t=(0,c.parseSdp)(e),r=t.msections.find((e=>"video"===e.type)),s=t.msections.find((e=>"audio"===e.type));return x=r?.codec,N=s?.codec,B.resolve(r),O.resolve(s),{videoSection:r,audioSection:s}};await async function(e,t,r){for(const e of Object.keys(r)){const s=r[e];s.bind=await(0,i.createBindZero)(),s.bind.server.setRecvBufferSize(1048576);const{server:n,port:o}=s.bind;t.promise.finally((()=>(0,i.closeQuiet)(n)));const a=s.outputArguments=[];s.payloadType&&a.push("-payload_type",s.payloadType.toString()),s.ssrc&&a.push("-ssrc",s.ssrc.toString())}}(0,u,r),y?.client.on("close",(()=>u.resolve(void 0)));const j=!S,H=new n.Deferred;let F;if(Object.keys(r).length){if(j){H.resolve(void 0);for(const e of Object.keys(r)){const t=r[e];let s=t.ffmpegDestination||"127.0.0.1";"127.0.0.1"===s&&(s=`${s}:${t.bind.port}`);const n=new URLSearchParams;let i=`rtp://${s}`;t.rtcpPort&&n.set("rtcpport",t.rtcpPort.toString()),t.packetSize&&n.set("pkt_size",t.packetSize.toString()),t.srtp&&(i=`s${i}`,t.outputArguments.push("-srtp_out_suite",t.srtp.crytoSuite,"-srtp_out_params",t.srtp.key.toString("base64"))),i=`${i}?${n}`,t.outputArguments.push("-dn","-sn"),"video"!==e&&t.outputArguments.push("-vn"),"audio"!==e&&t.outputArguments.push("-an"),t.outputArguments.push("-f","rtp"),t.outputArguments.push(i)}}const t=[];for(const e of Object.keys(r)){const s=r[e];t.push(...s.encoderArguments,...s.outputArguments)}const s=["-hide_banner",...b,...t];if(j)C?.bind?.server&&f(C,C.bind.server,(()=>x)),T?.bind?.server&&f(T,T.bind.server,(()=>N)),s.push("-sdp_file","pipe:4");else{const t="udp"===S,n=await(0,i.listenZeroSingleClient)("127.0.0.1");s.push("-rtsp_transport",t?"udp":"tcp","-f","rtsp",`rtsp://127.0.0.1:${n.port}`),n.clientPromise.then((async s=>{s.on("close",(()=>u.resolve(void 0))),u.promise.finally((()=>s.destroy()));const n=new a.RtspServer(s,void 0,t);await n.handleSetup(["announce"]);const{videoSection:i,audioSection:o}=U(n.sdp);if(await n.handleSetup(),C&&f(C,n.setupTracks[i?.control]?.rtp,(()=>i.codec)),T&&f(T,n.setupTracks[o?.control]?.rtp,(()=>o.codec)),H.resolve(n),"pull"!==S){let t=!0,s=!0;for await(const a of n.handleRecord())a.type===i.codec?(t&&(t=!1,C.firstPacket?.(a.packet,i.codec)),C.onRtp(a.packet,i.codec)):a.type===o?.codec?(s&&(s=!1,r.audio.firstPacket?.(a.packet,o?.codec)),T.onRtp(a.packet,o?.codec)):e.warn("unexpected rtsp sample",a.type)}})).catch((e=>{u.finished||u.reject(e)}))}(0,o.safePrintFFmpegArguments)(e,s),F=l.default.spawn(A,s,{stdio:["pipe","pipe","pipe","pipe","pipe","pipe"]}),u.promise.finally((()=>(0,o.safeKillFFmpeg)(F))),F.on("exit",(()=>{D||u.resolve(void 0)})),F.on("error",(()=>{D||u.resolve(void 0)})),(0,o.ffmpegLogInitialOutput)(e,F),j&&F.stdio[4].on("data",(e=>{const t=e.toString();U(t)}))}else k.resolve(P);!v&&y&&process.nextTick((async()=>{try{await y.readLoop()}catch(e){}u.resolve(void 0)}));const z=new n.Deferred;return z.promise.catch((()=>{})),(async()=>{try{const e=await B.promise,t=await O.promise;let r="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=Media Server\nc=IN IP4 127.0.0.1\nt=0 0";const s=(0,c.parseSdp)(r);e&&s.msections.push(e),t&&s.msections.push(t),r=s.toSdp(),z.resolve(r)}catch(e){z.reject(e)}})(),{cp:F,rtspServer:H.promise,sdpContents:z.promise,videoSection:B.promise,audioSection:O.promise,kill:()=>u.resolve(void 0),killPromise:u.promise,get killed(){return u.finished}}};const n=r(3290),i=r(3515),o=r(3643),a=r(336),c=r(4890),u=s(r(2743)),l=s(r(5317)),d=r(1193),{mediaManager:h}=u.default;function p(e){const t=e.onRtp;return e.onRtp=(r,s)=>{e.onRtp=t,e.firstPacket?.(r,s),e.onRtp(r,s)},(t,r)=>e.onRtp(t,r)}function f(e,t,r){const s=p(e);t?.on("message",(e=>s(e,r())))}async function g(e,t,r,s,n,i){const o=s.codec;try{if(!n){await t.setup({type:"udp",path:s.control,onRtp:(e,t)=>i(t,o)});return!1}}catch(e){if(!(e instanceof a.RtspStatusError))throw e}return await t.setup({type:"tcp",port:r,path:s.control,onRtp:(e,t)=>i(t,o)}),!0}},575:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RedHandler=void 0;const s=r(4774);t.RedHandler=class{constructor(){this.size=150,this.sequenceNumbers=[]}push(e,t){const r=[];e.blocks.forEach((({blockPT:n,timestampOffset:i,block:o},a)=>{const c=(0,s.uint16Add)(t.header.sequenceNumber,-(e.blocks.length-(a+1)));i?r.push(new s.RtpPacket(new s.RtpHeader({timestamp:(0,s.uint32Add)(t.header.timestamp,-i),payloadType:n,ssrc:t.header.ssrc,sequenceNumber:c,marker:!0}),o)):r.push(new s.RtpPacket(new s.RtpHeader({timestamp:t.header.timestamp,payloadType:n,ssrc:t.header.ssrc,sequenceNumber:c,marker:!0}),o))}));return r.filter((e=>!this.sequenceNumbers.includes(e.header.sequenceNumber)&&(this.sequenceNumbers.length>this.size&&this.sequenceNumbers.shift(),this.sequenceNumbers.push(e.header.sequenceNumber),!0)))}}},599:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TurnProtocol=t.StunOverTurnProtocol=void 0,t.createTurnClient=m,t.createStunOverTurnClient=async function({address:e,username:t,password:r},{lifetime:s,portRange:n,interfaceAddresses:i,transport:o}={}){const a=await m({address:e,username:t,password:r},{lifetime:s,portRange:n,interfaceAddresses:i,transport:o});return new f(a)},t.makeIntegrityKey=y;const s=r(6982),n=r(4694),i=r(6460),o=r(2325),a=r(1227),c=r(2261),u=r(4687),l=r(9851),d=r(2372),h=(0,c.debug)("werift-ice:packages/ice/src/turn/protocol.ts"),p=600;class f{constructor(e){this.turn=e,this.type=f.type,this.disposer=new c.EventDisposer,this.onRequestReceived=new c.Event,this.onDataReceived=new c.Event,this.handleStunMessage=(e,t)=>{try{const r=(0,l.parseMessage)(e);if(!r)return void this.onDataReceived.execute(e);if(r.messageClass===u.classes.RESPONSE||r.messageClass===u.classes.ERROR){const e=this.turn.transactions[r.transactionIdHex];e&&e.responseReceived(r,t)}else r.messageClass===u.classes.REQUEST&&this.onRequestReceived.execute(r,t,e)}catch(e){h("datagramReceived error",e)}},e.onData.subscribe(((e,t)=>{this.handleStunMessage(e,t)})).disposer(this.disposer)}async request(e,t,r){if(this.turn.transactions[e.transactionIdHex])throw new Error("exist");r&&(e.addMessageIntegrity(r),e.addFingerprint());const s=new d.Transaction(e,t,this);this.turn.transactions[e.transactionIdHex]=s;try{return await s.run()}catch(e){throw e}finally{delete this.turn.transactions[e.transactionIdHex]}}async connectionMade(){}async sendData(e,t){await this.turn.sendData(e,t)}async sendStun(e,t){await this.turn.sendData(e.bytes,t)}async close(){return this.disposer.dispose(),this.turn.close()}}t.StunOverTurnProtocol=f,f.type="turn";class g{constructor(e,t,r,s,n,o={}){this.server=e,this.username=t,this.password=r,this.lifetime=s,this.transport=n,this.options=o,this.type=g.type,this.onData=new c.Event,this.onRequestReceived=new c.Event,this.onDataReceived=new c.Event,this.transactions={},this.channelNumber=16384,this.channelByAddr={},this.addrByChannel={},this.channelRefreshAt=0,this.tcpBuffer=Buffer.alloc(0),this.permissionByAddr={},this.creatingPermission=Promise.resolve(),this.refresh=e=>{this.refreshHandle=(0,a.cancelable)((async(t,r,s)=>{let n=!0;for(s.once((()=>{n=!1}));n;){const t=5/6*e*1e3;h("refresh delay",t,{exp:e}),await(0,i.setTimeout)(t);const r=new l.Message(u.methods.REFRESH,u.classes.REQUEST);r.setAttribute("LIFETIME",e);try{const[t]=await this.requestWithRetry(r,this.server);e=t.getAttributeValue("LIFETIME"),h("refresh",{exp:e})}catch(e){h("refresh error",e)}}}))},this.channelRefreshTime=this.options.channelRefreshTime??500}async connectionMade(){this.transport.onData=(e,t)=>{this.dataReceived(e,t)};const e=new l.Message(u.methods.ALLOCATE,u.classes.REQUEST);e.setAttribute("LIFETIME",this.lifetime).setAttribute("REQUESTED-TRANSPORT",285212672);const[t]=await this.requestWithRetry(e,this.server).catch((e=>{throw h("connect error",e),e}));this.relayedAddress=t.getAttributeValue("XOR-RELAYED-ADDRESS"),this.mappedAddress=t.getAttributeValue("XOR-MAPPED-ADDRESS");const r=t.getAttributeValue("LIFETIME");h("connect",this.relayedAddress,this.mappedAddress,{exp:r}),this.refresh(r)}handleChannelData(e){const[t,r]=n.jspack.Unpack("!HH",e.slice(0,4)),s=this.addrByChannel[t];if(s){const t=e.subarray(4,4+r);this.onData.execute(t,s)}}handleSTUNMessage(e,t){try{const r=(0,l.parseMessage)(e);if(!r)throw new Error("not stun message");if(r.messageClass===u.classes.RESPONSE||r.messageClass===u.classes.ERROR){const e=this.transactions[r.transactionIdHex];e&&e.responseReceived(r,t)}else r.messageClass===u.classes.REQUEST&&this.onData.execute(e,t);if(r.getAttributeValue("DATA")){const e=r.getAttributeValue("DATA");this.onData.execute(e,t)}}catch(t){h("parse error",e.toString())}}dataReceived(e,t){const r=(e,t)=>{e.length>=4&&b(e)?this.handleChannelData(e):this.handleSTUNMessage(e,t)};if("tcp"===this.transport.type)for(this.tcpBuffer=Buffer.concat([this.tcpBuffer,e]);this.tcpBuffer.length>=4;){let[,e]=(0,c.bufferReader)(this.tcpBuffer.subarray(0,4),[2,2]);e+=(0,l.paddingLength)(e);const s=b(this.tcpBuffer)?4+e:20+e;if(this.tcpBuffer.length<s)break;r(this.tcpBuffer.subarray(0,s),t),this.tcpBuffer=this.tcpBuffer.subarray(s)}else r(e,t)}async send(e,t){if(!this.transport.closed)if("tcp"===this.transport.type){const r=(0,l.paddingLength)(e.length);await this.transport.send(r>0?Buffer.concat([e,Buffer.alloc(r)]):e,t)}else await this.transport.send(e,t)}async createPermission(e){const t=new l.Message(u.methods.CREATE_PERMISSION,u.classes.REQUEST);t.setAttribute("XOR-PEER-ADDRESS",e).setAttribute("USERNAME",this.username).setAttribute("REALM",this.realm).setAttribute("NONCE",this.nonce),await this.request(t,this.server).catch((e=>{throw e}))}async request(e,t){if(this.transactions[e.transactionIdHex])throw new Error("exist");this.integrityKey&&e.setAttribute("USERNAME",this.username).setAttribute("REALM",this.realm).setAttribute("NONCE",this.nonce).addMessageIntegrity(this.integrityKey).addFingerprint();const r=new d.Transaction(e,t,this);this.transactions[e.transactionIdHex]=r;try{return await r.run()}catch(e){throw e}finally{delete this.transactions[e.transactionIdHex]}}async requestWithRetry(e,t){let r,s;try{[r,s]=await this.request(e,t)}catch(t){if(t instanceof o.TransactionFailed==0)throw h("requestWithRetry error",t),t;this.server=t.addr;const[n]=t.response.getAttributeValue("ERROR-CODE"),i=t.response.getAttributeValue("NONCE"),c=t.response.getAttributeValue("REALM");if(!(401===n&&c||438===n&&this.realm)||!i)throw t;h("retry with nonce",n),this.nonce=i,401===n&&(this.realm=c),this.integrityKey=y(this.username,this.realm,this.password),e.transactionId=(0,a.randomTransactionId)(),[r,s]=await this.request(e,this.server)}return[r,s]}async sendData(e,t){const r=await this.getChannel(t).catch((e=>new Error("channelBind error")));if(r instanceof Error){await this.getPermission(t);const r=new l.Message(u.methods.SEND,u.classes.INDICATION).setAttribute("DATA",e).setAttribute("XOR-PEER-ADDRESS",t);return void await this.sendStun(r,this.server)}const s=n.jspack.Pack("!HH",[r.number,e.length]);await this.send(Buffer.concat([Buffer.from(s),e]),this.server)}async getPermission(e){await this.creatingPermission;this.permissionByAddr[e.join(":")]||(this.creatingPermission=this.createPermission(e),this.permissionByAddr[e.join(":")]=!0,await this.creatingPermission.catch((e=>{throw h("createPermission error",e),e})))}async getChannel(e){this.channelBinding&&await this.channelBinding;let t=this.channelByAddr[e.join(":")];return t?this.channelRefreshAt<(0,c.int)(Date.now()/1e3)&&(this.channelBinding=this.channelBind(t.number,e),this.channelRefreshAt=(0,c.int)(Date.now()/1e3)+this.channelRefreshTime,await this.channelBinding.catch((e=>{throw h("channelBind error",e),e})),this.channelBinding=void 0,h("channelBind refresh",t)):(this.channelByAddr[e.join(":")]={number:this.channelNumber++,address:e},t=this.channelByAddr[e.join(":")],this.addrByChannel[t.number]=e,this.channelBinding=this.channelBind(t.number,e),await this.channelBinding.catch((e=>{throw h("channelBind error",e),e})),this.channelRefreshAt=(0,c.int)(Date.now()/1e3)+this.channelRefreshTime,this.channelBinding=void 0,h("channelBind",t)),t}async channelBind(e,t){const r=new l.Message(u.methods.CHANNEL_BIND,u.classes.REQUEST);r.setAttribute("CHANNEL-NUMBER",e).setAttribute("XOR-PEER-ADDRESS",t);const[s]=await this.requestWithRetry(r,this.server);if(s.messageMethod!==u.methods.CHANNEL_BIND)throw new Error("should be CHANNEL_BIND")}async sendStun(e,t){await this.send(e.bytes,t)}async close(){this.refreshHandle?.resolve?.(),await this.transport.close()}}async function m({address:e,username:t,password:r},{lifetime:s,portRange:n,interfaceAddresses:i,transport:o}={}){s??=p,o??="udp";const a="udp"===o?await c.UdpTransport.init("udp4",{portRange:n,interfaceAddresses:i}):await c.TcpTransport.init(e),u=new g(e,t,r,s,a);return await u.connectionMade(),u}function y(e,t,r){return(0,s.createHash)("md5").update(Buffer.from([e,t,r].join(":"))).digest()}function b(e){return 64==(192&e[0])}t.TurnProtocol=g,g.type="turn"},651:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerKeyExchange=void 0;const s=r(6353),n=r(7077),i=r(9827),o=r(9602);class a{constructor(e,t,r,s,n,i,a,c){this.ellipticCurveType=e,this.namedCurve=t,this.publicKeyLength=r,this.publicKey=s,this.hashAlgorithm=n,this.signatureAlgorithm=i,this.signatureLength=a,this.signature=c,this.msgType=o.HandshakeType.server_key_exchange_12}static createEmpty(){return new a(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}static deSerialize(e){const t=(0,s.decode)(e,a.spec);return new a(...Object.values(t))}serialize(){return(0,i.encodeBuffer)(this,a.spec)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.ServerKeyExchange=a,a.spec={ellipticCurveType:s.types.uint8,namedCurve:s.types.uint16be,publicKeyLength:s.types.uint8,publicKey:s.types.buffer((e=>e.current.publicKeyLength)),hashAlgorithm:s.types.uint8,signatureAlgorithm:s.types.uint8,signatureLength:s.types.uint16be,signature:s.types.buffer((e=>e.current.signatureLength))}},654:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DtlsSocket=void 0;const s=r(6353),n=r(6460),i=r(5205),o=r(4148),a=r(91),c=r(9379),u=r(7568),l=r(8138),d=r(1310),h=r(7654),p=r(2696),f=r(6033),g=r(6316),m=r(7890),y=r(986),b=r(6282),v=r(5982),S=r(7077),w=r(1456),E=(0,i.debug)("werift-dtls : packages/dtls/src/socket.ts : log"),C=(0,i.debug)("werift-dtls : packages/dtls/src/socket.ts : err");t.DtlsSocket=class{constructor(e,t){this.options=e,this.sessionType=t,this.onConnect=new i.Event,this.onData=new i.Event,this.onError=new i.Event,this.onClose=new i.Event,this.srtp=new d.SrtpContext,this.connected=!1,this.extensions=[],this.bufferFragmentedHandshakes=[],this.udpOnMessage=e=>{const t=(0,w.parsePacket)(e);for(const e of t)try{const t=(0,w.parsePlainText)(this.dtls,this.cipher)(e);for(const e of t)switch(e.type){case v.ContentType.handshake:{const t=e.data,r=this.handleFragmentHandshake([t]),s=Object.values(r.reduce(((e,t)=>(e[t.msg_type]||(e[t.msg_type]=[]),e[t.msg_type].push(t),e)),{})).map((e=>S.FragmentedHandshake.assemble(e))).sort(((e,t)=>e.msg_type-t.msg_type));this.onHandleHandshakes(s).catch((e=>{C(this.dtls.sessionId,"onHandleHandshakes error",e),this.onError.execute(e)}))}break;case v.ContentType.applicationData:this.onData.execute(e.data);break;case v.ContentType.alert:this.onClose.execute()}}catch(e){C(this.dtls.sessionId,"catch udpOnMessage error",e)}},this.waitForReady=e=>new Promise((async(t,r)=>{for(let r=0;r<10;r++){if(e()){t();break}await(0,n.setTimeout)(100*r)}r("waitForReady timeout")})),this.send=async e=>{const t=(0,b.createPlaintext)(this.dtls)([{type:v.ContentType.applicationData,fragment:e}],++this.dtls.recordSequenceNumber)[0];await this.transport.send(this.cipher.encryptPacket(t).serialize())},this.dtls=new l.DtlsContext(this.options,this.sessionType),this.cipher=new u.CipherContext(this.sessionType,this.options.cert,this.options.key,this.options.signatureHash),this.transport=new h.TransportContext(this.options.transport),this.setupExtensions(),this.transport.socket.onData=this.udpOnMessage}renegotiation(){E("renegotiation",this.sessionType),this.connected=!1,this.cipher=new u.CipherContext(this.sessionType,this.options.cert,this.options.key,this.options.signatureHash),this.dtls=new l.DtlsContext(this.options,this.sessionType),this.srtp=new d.SrtpContext,this.extensions=[],this.bufferFragmentedHandshakes=[]}setupExtensions(){if(E(this.dtls.sessionId,"support srtpProfiles",this.options.srtpProfiles),this.options.srtpProfiles&&this.options.srtpProfiles.length>0){const e=y.UseSRTP.create(this.options.srtpProfiles,Buffer.from([0]));this.extensions.push(e.extension)}{const e=p.EllipticCurves.createEmpty();e.data=o.NamedCurveAlgorithmList,this.extensions.push(e.extension)}{const e=m.Signature.createEmpty();e.data=o.signatures,this.extensions.push(e.extension)}this.options.extendedMasterSecret&&this.extensions.push({type:f.ExtendedMasterSecret.type,data:Buffer.alloc(0)});{const e=g.RenegotiationIndication.createEmpty();this.extensions.push(e.extension)}}handleFragmentHandshake(e){let t=e.filter((e=>e.fragment_length===e.length||(this.bufferFragmentedHandshakes.push(e),!1)));if(this.bufferFragmentedHandshakes.length>1){const[e]=this.bufferFragmentedHandshakes.slice(-1);e.fragment_offset+e.fragment_length===e.length&&(t=[...this.bufferFragmentedHandshakes,...t],this.bufferFragmentedHandshakes=[])}return t}close(){this.transport.socket.close()}extractSessionKeys(e,t){const r=this.exportKeyingMaterial("EXTRACTOR-dtls_srtp",2*e+2*t),{clientKey:n,serverKey:i,clientSalt:o,serverSalt:a}=(0,s.decode)(r,{clientKey:s.types.buffer(e),serverKey:s.types.buffer(e),clientSalt:s.types.buffer(t),serverSalt:s.types.buffer(t)});return this.sessionType===c.SessionType.CLIENT?{localKey:n,localSalt:o,remoteKey:i,remoteSalt:a}:{localKey:i,localSalt:a,remoteKey:n,remoteSalt:o}}exportKeyingMaterial(e,t){return(0,a.exportKeyingMaterial)(e,t,this.cipher.masterSecret,this.cipher.localRandom.serialize(),this.cipher.remoteRandom.serialize(),this.sessionType===c.SessionType.CLIENT)}}},656:(e,t,r)=>{"use strict";const{decodeCommon:s}=r(7868),{encodeCommon:n}=r(1620),{encodingLengthCommon:i}=r(1236),{isType:o,isFunction:a}=r(2),c=r(6101),u=r(59);e.exports=function(e,t=1){if(!o(e))throw new TypeError("Invalid data type.");if(!Number.isInteger(t)&&!a(t))throw new TypeError("Argument #2 should be a valid integer or function.");return{[c.skip]:!0,encodingLength:function(r){const s=u.clone(this),n=a(t)?t(s):t;return i(r,e,s),u.clean(s),s.bytes*n},decode:function r(n){const i=u.clone(this);r.bytes=0;const o=a(t)?t(i):t;if(0===o)return void u.clean(i);for(let t=o;t>0;t-=1)s(n,e,i);r.bytes=i.bytes,u.clean(i)},encode:function r(s,i){r.bytes=0;const o=u.clone(this),c=a(t)?t(o):t;if(0===c)return void u.clean(o);for(let t=c;t>0;t-=1)n(0,i,e,o);r.bytes=o.bytes,u.clean(o)}}}},667:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.generateKeyPair=function(e){switch(e){case i.NamedCurveAlgorithm.secp256r1_23:{const{privateKey:t,publicKey:r}=(0,o.p256Keypair)();return{curve:e,privateKey:t,publicKey:r}}case i.NamedCurveAlgorithm.x25519_29:{const t=n.default.box.keyPair();return{curve:e,privateKey:Buffer.from(t.secretKey.buffer),publicKey:Buffer.from(t.publicKey.buffer)}}default:throw new Error}};const n=s(r(4522)),i=r(4148),o=r(1447)},673:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.debug=t.WeriftError=void 0;const n=s(r(4652));class i extends Error{constructor(e){super(e.message)}toJSON(){return{message:this.message,payload:JSON.parse(JSON.stringify(this.payload)),path:this.path}}}t.WeriftError=i,t.debug=n.default.debug},695:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Finished=void 0;const s=r(7077),n=r(9602);class i{constructor(e){this.verifyData=e,this.msgType=n.HandshakeType.finished_20}static createEmpty(){return new i(void 0)}static deSerialize(e){return new i(e)}serialize(){return this.verifyData}toFragment(){const e=this.serialize();return new s.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.Finished=i},730:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.url2Address=void 0,t.getGlobalIp=async function(e,t){const r=new u.StunProtocol;await r.connectionMade(!0,void 0,t);const s=new c.Message(a.methods.BINDING,a.classes.REQUEST),[n]=await r.request(s,e??["stun.l.google.com",19302]);await r.close();return n.getAttributeValue("XOR-MAPPED-ADDRESS")[0]},t.isLinkLocalAddress=d,t.nodeIpAddress=h,t.getHostAddresses=function(e,t,r={}){const s=[];e&&s.push(...h(4,r));t&&s.push(...h(6,r));return s};const n=s(r(857)),i=s(r(3982)),o=r(2261),a=r(4687),c=r(9851),u=r(7830),l=(0,o.debug)("werift-ice : packages/ice/src/utils.ts");function d(e){return 4===(0,o.normalizeFamilyNodeV18)(e.family)&&e.address?.startsWith("169.254.")||6===(0,o.normalizeFamilyNodeV18)(e.family)&&e.address?.startsWith("fe80::")}function h(e,{useLinkLocalAddress:t}={}){const r=["ipsec","tun","utun","tap"],s=["vmnet","veth"],a=n.default.networkInterfaces();l(a);const c=Object.keys(a).map((n=>{for(const e of[...r,...s])if(n.startsWith(e))return{nic:n,addresses:[]};return{nic:n,addresses:a[n].filter((r=>!((0,o.normalizeFamilyNodeV18)(r.family)!==e||i.default.isLoopback(r.address)||!t&&d(r)))).map((e=>e.address))}})).filter((e=>!!e));return c.sort(((e,t)=>e.nic.localeCompare(t.nic))),Object.values(c).flatMap((e=>e.addresses))}t.url2Address=e=>{if(!e)return;const[t,r]=e.split(":");return[t,Number.parseInt(r)]}},759:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useSdesMid=function(){return new n.RTCRtpHeaderExtensionParameters({uri:s.RTP_EXTENSION_URI.sdesMid})},t.useSdesRTPStreamId=function(){return new n.RTCRtpHeaderExtensionParameters({uri:s.RTP_EXTENSION_URI.sdesRTPStreamID})},t.useRepairedRtpStreamId=function(){return new n.RTCRtpHeaderExtensionParameters({uri:s.RTP_EXTENSION_URI.repairedRtpStreamId})},t.useTransportWideCC=function(){return new n.RTCRtpHeaderExtensionParameters({uri:s.RTP_EXTENSION_URI.transportWideCC})},t.useAbsSendTime=function(){return new n.RTCRtpHeaderExtensionParameters({uri:s.RTP_EXTENSION_URI.absSendTime})},t.useDependencyDescriptor=function(){return new n.RTCRtpHeaderExtensionParameters({uri:s.RTP_EXTENSION_URI.dependencyDescriptor})},t.useAudioLevelIndication=function(){return new n.RTCRtpHeaderExtensionParameters({uri:s.RTP_EXTENSION_URI.audioLevelIndication})},t.useVideoOrientation=function(){return new n.RTCRtpHeaderExtensionParameters({uri:s.RTP_EXTENSION_URI.videoOrientation})};const s=r(6252),n=r(4582)},848:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hmac=t.HMAC=void 0;const s=r(5744),n=r(1609);class i extends n.Hash{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,(0,s.ahash)(e);const r=(0,n.toBytes)(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,o=new Uint8Array(i);o.set(r.length>i?e.create().update(r).digest():r);for(let e=0;e<o.length;e++)o[e]^=54;this.iHash.update(o),this.oHash=e.create();for(let e=0;e<o.length;e++)o[e]^=106;this.oHash.update(o),o.fill(0)}update(e){return(0,s.aexists)(this),this.iHash.update(e),this}digestInto(e){(0,s.aexists)(this),(0,s.abytes)(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:s,destroyed:n,blockLen:i,outputLen:o}=this;return e.finished=s,e.destroyed=n,e.blockLen=i,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}t.HMAC=i;t.hmac=(e,t,r)=>new i(e,t).update(r).digest(),t.hmac.create=(e,t)=>new i(e,t)},857:e=>{"use strict";e.exports=require("os")},872:(e,t,r)=>{"use strict";const{Transform:s}=r(2203),n=r(6736),i=r(8685),o=r(8176),a=Symbol("buffer");class c extends s{constructor(e={}){super(e),this[a]=new i}get buffer(){return this[a]}get length(){return this.buffer.length}append(e){this.buffer.append(e)}get(e){return this.buffer.get(e)}slice(e,t){return this.buffer.slice(e,t)}consume(e){this.buffer.consume(e)}toString(e,t,r){return this.buffer.toString(e,t,r)}indexOf(e,t=0){return this.buffer.indexOf(e,t)}readBuffer(e){l(e,this.length);const t=this.slice(0,e);return this.consume(e),t}writeBuffer(e){this.append(e)}}const u={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};Object.keys(u).forEach((e=>{const t=n();t(`\n    function binary_${e}() {\n      const bytes = ${t.formats.d(u[e])};\n      assertSize(bytes, this.length);\n\n      const res = this.buffer.${e}(0);\n      this.consume(bytes);\n\n      return res;\n    }\n  `),c.prototype[e]=t.toFunction({assertSize:l})})),["readIntBE","readIntLE","readUIntBE","readUIntLE"].forEach((e=>{const t=n();t(`\n    function binary_${e}(size) {\n      assertSize(size, this.length);\n\n      const res = this.buffer.${e}(size, 0);\n      this.consume(size);\n      return res;\n    }\n  `),c.prototype[e]=t.toFunction({assertSize:l})}));["writeDoubleBE","writeDoubleLE","writeFloatBE","writeFloatLE","writeInt32BE","writeInt32LE","writeUInt32BE","writeUInt32LE","writeInt16BE","writeInt16LE","writeUInt16BE","writeUInt16LE","writeInt8","writeUInt8"].forEach((e=>{const t=n();t(`\n    function binary_${e}(value) {\n      this.buffer.${e}(value);\n    }\n  `),c.prototype[e]=t.toFunction()}));function l(e,t){if(e>t)throw new o(e,t)}["writeIntBE","writeIntLE","writeUIntBE","writeUIntLE"].forEach((e=>{const t=n();t(`\n    function binary_${e}(value, size) {\n      this.buffer.${e}(value, size);\n    }\n  `),c.prototype[e]=t.toFunction()})),e.exports=c},918:e=>{"use strict";e.exports=function(e){return/^[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*$/.test(e)}},932:e=>{"use strict";e.exports=require("process")},962:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(9543),t)},969:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.opusAudioCodecOnly=t.requiredAudioCodecs=t.optionalVideoCodec=t.requiredVideoCodec=void 0,t.getAudioCodec=n,t.getFFmpegRtpAudioOutputArguments=function(e,t,r){const s=[],{encoder:i,name:o,sampleRate:a}=n(t);e?.codec!==o||e?.sampleRate&&e?.sampleRate!==a||r?(s.push("-acodec",i,"-flags","+global_header","-ar",`${t.clockRate}`,"-b:a","40k","-bufsize","96k","-ac",t.channels.toString()),"libopus"===i&&s.push("-application","lowdelay")):s.push("-acodec","copy");return s};const s=r(3377);function n(e){return"PCMA"===e.name?{name:"pcm_alaw",encoder:"pcm_alaw",sampleRate:8e3}:"PCMU"===e.name?{name:"pcm_mulaw",encoder:"pcm_mulaw",sampleRate:8e3}:{name:"opus",encoder:"libopus",sampleRate:16e3}}t.requiredVideoCodec=new s.RTCRtpCodecParameters({mimeType:"video/H264",clockRate:9e4,rtcpFeedback:[{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"},{type:"goog-remb"}],parameters:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f"}),t.optionalVideoCodec=new s.RTCRtpCodecParameters({mimeType:"video/H265",clockRate:9e4,rtcpFeedback:[{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"},{type:"goog-remb"}],parameters:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f"}),t.requiredAudioCodecs=[new s.RTCRtpCodecParameters({mimeType:"audio/opus",clockRate:48e3,channels:2,payloadType:111}),new s.RTCRtpCodecParameters({mimeType:"audio/PCMU",clockRate:8e3,channels:1,payloadType:0}),new s.RTCRtpCodecParameters({mimeType:"audio/PCMA",clockRate:8e3,channels:1,payloadType:8})],t.opusAudioCodecOnly=[new s.RTCRtpCodecParameters({mimeType:"audio/opus",clockRate:48e3,channels:2,payloadType:111})]},986:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UseSRTP=void 0;const s=r(6353);class n{constructor(e={}){this.type=n.type,this.data=Buffer.from([]),this.profiles=[],this.mki=Buffer.from([0]),Object.assign(this,e)}static create(e,t){return new n({profiles:e,mki:t})}static deSerialize(e){const t=new n((0,s.decode)(e,n.spec)),r=t.data.readUInt16BE(),i=new Array(r/2);for(let e=0;e<i.length;e++)i[e]=t.data.readUInt16BE(2*e+2);return t.profiles=i,t.mki=t.data.slice(r+2),t}serialize(){const e=Buffer.alloc(2);e.writeUInt16BE(2*this.profiles.length);const t=Buffer.concat([e,...this.profiles.map((e=>{const t=Buffer.alloc(2);return t.writeUInt16BE(e),t})),this.mki]);this.data=t;const r=(0,s.encode)(this,n.spec).slice();return Buffer.from(r)}static fromData(e){const t=Buffer.alloc(4);return t.writeUInt16BE(n.type),t.writeUInt16BE(e.length,2),n.deSerialize(Buffer.concat([t,e]))}get extension(){return{type:this.type,data:this.serialize().slice(4)}}}t.UseSRTP=n,n.type=14,n.spec={type:s.types.uint16be,data:s.types.buffer(s.types.uint16be)}},1133:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CipherAesGcm=void 0;const s=r(6982),n=r(2148),i=r(9543),o=r(4848),a=r(4221),c=r(1193);class u extends n.CipherAesBase{constructor(e,t,r,s){super(e,t,r,s),this.aeadAuthTagLen=16,this.rtpIvWriter=(0,i.createBufferWriter)([2,4,4,2],!0),this.rtcpIvWriter=(0,i.createBufferWriter)([2,4,2,4],!0),this.aadWriter=(0,i.createBufferWriter)([4],!0)}encryptRtp(e,t,r){const n=e.serialize(e.serializeSize),i=this.rtpInitializationVector(e,r),o=(0,s.createCipheriv)("aes-128-gcm",this.srtpSessionKey,i);o.setAAD(n);const a=o.update(t);o.final();const c=o.getAuthTag();return Buffer.concat([n,a,c])}decryptRtp(e,t){const r=c.RtpHeader.deSerialize(e);let n=Buffer.from([]);n=(0,o.growBufferSize)(n,e.length-this.aeadAuthTagLen),e.slice(0,r.payloadOffset).copy(n);const i=this.rtpInitializationVector(r,t),a=e.slice(r.payloadOffset,e.length-this.aeadAuthTagLen);return(0,s.createDecipheriv)("aes-128-gcm",this.srtpSessionKey,i).update(a).copy(n,r.payloadOffset),[n,r]}encryptRTCP(e,t){const r=e.readUInt32BE(4),n=e.length+this.aeadAuthTagLen;let i=Buffer.from([]);i=(0,o.growBufferSize)(i,n+l),e.slice(0,8).copy(i);const a=this.rtcpInitializationVector(r,t),c=this.rtcpAdditionalAuthenticatedData(e,t),u=(0,s.createCipheriv)("aes-128-gcm",this.srtcpSessionKey,a);u.setAAD(c);const d=u.update(e.slice(8));u.final(),d.copy(i,8);return u.getAuthTag().copy(i,8+d.length),c.slice(8,12).copy(i,n),i}decryptRTCP(e){const t=a.RtcpHeader.deSerialize(e),r=e.length-l,n=Buffer.alloc(r-this.aeadAuthTagLen);e.slice(0,8).copy(n);const i=e.readUInt32BE(4);let o=e.readUInt32BE(e.length-4);o&=~(d<<24);const c=this.rtcpInitializationVector(i,o),u=this.rtcpAdditionalAuthenticatedData(e,o),h=(0,s.createDecipheriv)("aes-128-gcm",this.srtcpSessionKey,c);h.setAAD(u);return h.update(e.slice(8,r)).copy(n,8),[n,t]}rtpInitializationVector(e,t){const r=this.rtpIvWriter([0,e.ssrc,t,e.sequenceNumber]);for(let e=0;e<r.length;e++)r[e]^=this.srtpSessionSalt[e];return r}rtcpInitializationVector(e,t){const r=this.rtcpIvWriter([0,e,0,t]);for(let e=0;e<r.length;e++)r[e]^=this.srtcpSessionSalt[e];return r}rtcpAdditionalAuthenticatedData(e,t){const r=Buffer.concat([e.subarray(0,8),this.aadWriter([t])]);return r[8]|=d,r}}t.CipherAesGcm=u;const l=4,d=128},1193:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtpPacket=t.RtpHeader=t.ExtensionProfiles=void 0;const s=r(9543);t.ExtensionProfiles={OneByte:48862,TwoByte:4096};class n{constructor(e={}){this.version=2,this.padding=!1,this.paddingSize=0,this.extension=!1,this.marker=!1,this.payloadOffset=0,this.payloadType=0,this.sequenceNumber=0,this.timestamp=0,this.ssrc=0,this.csrcLength=0,this.csrc=[],this.extensionProfile=t.ExtensionProfiles.OneByte,this.extensions=[],Object.assign(this,e)}static deSerialize(e){const r=new n;let i=0;const o=e[i++];r.version=(0,s.getBit)(o,0,2),r.padding=(0,s.getBit)(o,2)>0,r.extension=(0,s.getBit)(o,3)>0,r.csrcLength=(0,s.getBit)(o,4,4),r.csrc=[...Array(r.csrcLength)].map((()=>{const t=e.readUInt32BE(i);return i+=4,t})),i+=11;const a=e[1];r.marker=(0,s.getBit)(a,0)>0,r.payloadType=(0,s.getBit)(a,1,7),r.sequenceNumber=e.readUInt16BE(2),r.timestamp=e.readUInt32BE(4),r.ssrc=e.readUInt32BE(8);for(let t=0;t<r.csrc.length;t++){const s=12+4*t;r.csrc[t]=e.subarray(s).readUInt32BE()}if(r.extension){r.extensionProfile=e.subarray(i).readUInt16BE(),i+=2;const s=4*e.subarray(i).readUInt16BE();switch(r.extensionLength=s,i+=2,r.extensionProfile){case t.ExtensionProfiles.OneByte:{const t=i+s;for(;i<t;){if(0===e[i]){i++;continue}const t=e[i]>>4,s=1+(e[i]&(240^e[i]));if(i++,15===t)break;const n={id:t,payload:e.subarray(i,i+s)};r.extensions=[...r.extensions,n],i+=s}}break;case t.ExtensionProfiles.TwoByte:{const t=i+s;for(;i<t;){if(0===e[i]){i++;continue}const t=e[i];i++;const s=e[i];i++;const n={id:t,payload:e.subarray(i,i+s)};r.extensions=[...r.extensions,n],i+=s}}break;default:{const t={id:0,payload:e.subarray(i,i+s)};r.extensions=[...r.extensions,t],i+=r.extensions[0].payload.length}}}return r.payloadOffset=i,r.padding&&(r.paddingSize=e[e.length-1]),r}get serializeSize(){const{csrc:e,extensionProfile:r,extensions:s}=this;let n=12+4*e.length;if(s.length>0||!0===this.extension){let e=4;switch(r){case t.ExtensionProfiles.OneByte:for(const t of s)e+=1+t.payload.length;break;case t.ExtensionProfiles.TwoByte:for(const t of s)e+=2+t.payload.length;break;default:e+=s[0].payload.length}n+=4*Math.floor((e+3)/4)}return n}serialize(e){const r=Buffer.alloc(e);let n=0;const i=new s.BitWriter(8);i.set(2,0,this.version),this.padding&&i.set(1,2,1),this.extensions.length>0&&(this.extension=!0),this.extension&&i.set(1,3,1),i.set(4,4,this.csrc.length),r.writeUInt8(i.value,n++);const o=new s.BitWriter(8);this.marker&&o.set(1,0,1),o.set(7,1,this.payloadType),r.writeUInt8(o.value,n++),r.writeUInt16BE(this.sequenceNumber,2),n+=2,r.writeUInt32BE(this.timestamp,4),n+=4,r.writeUInt32BE(this.ssrc,8),n+=4;for(const e of this.csrc)r.writeUInt32BE(e,n),n+=4;if(this.extension){const e=n;r.writeUInt16BE(this.extensionProfile,n),n+=4;const s=n;switch(this.extensionProfile){case t.ExtensionProfiles.OneByte:for(const e of this.extensions)r.writeUInt8(e.id<<4|e.payload.length-1,n++),e.payload.copy(r,n),n+=e.payload.length;break;case t.ExtensionProfiles.TwoByte:for(const e of this.extensions)r.writeUInt8(e.id,n++),r.writeUInt8(e.payload.length,n++),e.payload.copy(r,n),n+=e.payload.length;break;default:{const e=this.extensions[0].payload.length;if(e%4!=0)throw new Error;this.extensions[0].payload.copy(r,n),n+=e}}const i=n-s,o=4*Math.trunc((i+3)/4);r.writeUInt16BE(Math.trunc(o/4),e+2);for(let e=0;e<o-i;e++)r.writeUInt8(0,n),n++}return this.payloadOffset=n,r}}t.RtpHeader=n;class i{constructor(e,t){this.header=e,this.payload=t}get serializeSize(){return this.header.serializeSize+this.payload.length}clone(){return new i(new n({...this.header}),this.payload)}serialize(){let e=this.header.serialize(this.header.serializeSize+this.payload.length);const{payloadOffset:t}=this.header;if(this.payload.copy(e,t),this.header.padding){const t=Buffer.alloc(this.header.paddingSize);t.writeUInt8(this.header.paddingSize,this.header.paddingSize-1),e=Buffer.concat([e,t])}return e}static deSerialize(e){const t=n.deSerialize(e);return new i(t,e.subarray(t.payloadOffset,e.length-t.paddingSize))}clear(){this.payload=null}}t.RtpPacket=i},1221:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CHUNK_BY_TYPE=t.ShutdownCompleteChunk=t.ShutdownAckChunk=t.ShutdownChunk=t.SackChunk=t.ReconfigChunk=t.HeartbeatAckChunk=t.HeartbeatChunk=t.ErrorChunk=t.AbortChunk=t.BaseParamsChunk=t.CookieAckChunk=t.CookieEchoChunk=t.DataChunk=t.ForwardTsnChunk=t.ReConfigChunk=t.InitAckChunk=t.InitChunk=t.BaseInitChunk=t.Chunk=void 0,t.decodeParams=A,t.parsePacket=function(e){if(e.length<12)throw new Error("SCTP packet length is less than 12 bytes");const r=e.readUInt16BE(0),s=e.readUInt16BE(2),i=e.readUInt32BE(4),o=e.readUInt32LE(8),a=(0,n.default)(Buffer.concat([e.slice(0,8),Buffer.from("\0\0\0\0"),e.slice(12)]));if(o!==a)throw new Error("SCTP packet has invalid checksum");const c=[];let u=12;for(;u+4<=e.length;){const r=e.readUInt8(u),s=e.readUInt8(u+1),n=e.readUInt16BE(u+2),i=e.slice(u+4,u+n),o=t.CHUNK_BY_TYPE[r.toString()];if(!o)throw new Error("unknown");c.push(new o(s,i)),u+=n+I(n)}return[r,s,i,c]},t.serializePacket=function(e,t,r,s){const i=Buffer.alloc(8);i.writeUInt16BE(e,0),i.writeUInt16BE(t,2),i.writeUInt32BE(r,4);const o=s.bytes,a=(0,n.default)(Buffer.concat([i,Buffer.from("\0\0\0\0"),o])),c=Buffer.alloc(4);c.writeUInt32LE(a,0);return Buffer.concat([i,c,o])};const n=s(r(6350));class i{get body(){return this._body}set body(e){this._body=e}constructor(e=0,t=Buffer.from("")){this.flags=e,this._body=t}get type(){return i.type}get bytes(){if(!this.body)throw new Error;const e=Buffer.alloc(4);e.writeUInt8(this.type,0),e.writeUInt8(this.flags,1),e.writeUInt16BE(this.body.length+4,2);return Buffer.concat([e,this.body,...[...Array(I(this.body.length))].map((()=>Buffer.from("\0")))])}}t.Chunk=i,i.type=-1;class o extends i{constructor(e=0,t){super(e,t),this.flags=e,t?(this.initiateTag=t.readUInt32BE(0),this.advertisedRwnd=t.readUInt32BE(4),this.outboundStreams=t.readUInt16BE(8),this.inboundStreams=t.readUInt16BE(10),this.initialTsn=t.readUInt32BE(12),this.params=A(t.slice(16))):(this.initiateTag=0,this.advertisedRwnd=0,this.outboundStreams=0,this.inboundStreams=0,this.initialTsn=0,this.params=[])}get body(){const e=Buffer.alloc(16);return e.writeUInt32BE(this.initiateTag,0),e.writeUInt32BE(this.advertisedRwnd,4),e.writeUInt16BE(this.outboundStreams,8),e.writeUInt16BE(this.inboundStreams,10),e.writeUInt32BE(this.initialTsn,12),Buffer.concat([e,_(this.params)])}}t.BaseInitChunk=o;class a extends o{get type(){return a.type}}t.InitChunk=a,a.type=1;class c extends o{get type(){return c.type}}t.InitAckChunk=c,c.type=2;class u extends o{get type(){return u.type}}t.ReConfigChunk=u,u.type=130;class l extends i{constructor(e=0,t){if(super(e,t),this.flags=e,this.streams=[],t){this.cumulativeTsn=t.readUInt32BE(0);let e=4;for(;e<t.length;)this.streams.push([t.readUInt16BE(e),t.readUInt16BE(e+2)]),e+=4}else this.cumulativeTsn=0}get type(){return l.type}set body(e){}get body(){const e=Buffer.alloc(4);return e.writeUInt32BE(this.cumulativeTsn,0),Buffer.concat([e,...this.streams.map((([e,t])=>{const r=Buffer.alloc(4);return r.writeUInt16BE(e,0),r.writeUInt16BE(t,2),r}))])}}t.ForwardTsnChunk=l,l.type=192;class d extends i{get type(){return d.type}constructor(e=0,t){super(e,t),this.flags=e,this.tsn=0,this.streamId=0,this.streamSeqNum=0,this.protocol=0,this.userData=Buffer.from(""),this.abandoned=!1,this.acked=!1,this.misses=0,this.retransmit=!1,this.sentCount=0,this.bookSize=0,t&&(this.tsn=t.readUInt32BE(0),this.streamId=t.readUInt16BE(4),this.streamSeqNum=t.readUInt16BE(6),this.protocol=t.readUInt32BE(8),this.userData=t.slice(12))}get bytes(){const e=16+this.userData.length,t=Buffer.alloc(16);t.writeUInt8(this.type,0),t.writeUInt8(this.flags,1),t.writeUInt16BE(e,2),t.writeUInt32BE(this.tsn,4),t.writeUInt16BE(this.streamId,8),t.writeUInt16BE(this.streamSeqNum,10),t.writeUInt32BE(this.protocol,12);let r=Buffer.concat([t,this.userData]);return e%4&&(r=Buffer.concat([r,...[...Array(I(e))].map((()=>Buffer.from("\0")))])),r}}t.DataChunk=d,d.type=0;class h extends i{get type(){return h.type}}t.CookieEchoChunk=h,h.type=10;class p extends i{get type(){return p.type}}t.CookieAckChunk=p,p.type=11;class f extends i{constructor(e=0,t=void 0){super(e,t),this.flags=e,this.params=[],t&&(this.params=A(t))}get body(){return _(this.params)}}t.BaseParamsChunk=f;class g extends f{get type(){return g.type}}t.AbortChunk=g,g.type=6;class m extends f{get type(){return m.type}get descriptions(){return this.params.map((([e,t])=>({name:(Object.entries(m.CODE).find((([,t])=>t===e))||[])[0],body:t})))}}t.ErrorChunk=m,m.type=9,m.CODE={InvalidStreamIdentifier:1,MissingMandatoryParameter:2,StaleCookieError:3,OutofResource:4,UnresolvableAddress:5,UnrecognizedChunkType:6,InvalidMandatoryParameter:7,UnrecognizedParameters:8,NoUserData:9,CookieReceivedWhileShuttingDown:10,RestartofanAssociationwithNewAddresses:11,UserInitiatedAbort:12,ProtocolViolation:13};class y extends f{get type(){return y.type}}t.HeartbeatChunk=y,y.type=4;class b extends f{get type(){return b.type}}t.HeartbeatAckChunk=b,b.type=5;class v extends f{get type(){return v.type}}t.ReconfigChunk=v,v.type=130;class S extends i{get type(){return S.type}constructor(e=0,t){if(super(e,t),this.flags=e,this.gaps=[],this.duplicates=[],this.cumulativeTsn=0,this.advertisedRwnd=0,t){this.cumulativeTsn=t.readUInt32BE(0),this.advertisedRwnd=t.readUInt32BE(4);const e=t.readUInt16BE(8),r=t.readUInt16BE(10);let s=12;[...Array(e)].forEach((()=>{this.gaps.push([t.readUInt16BE(s),t.readUInt16BE(s+2)]),s+=4})),[...Array(r)].forEach((()=>{this.duplicates.push(t.readUInt32BE(s)),s+=4}))}}get bytes(){const e=16+4*(this.gaps.length+this.duplicates.length),t=Buffer.alloc(16);t.writeUInt8(this.type,0),t.writeUInt8(this.flags,1),t.writeUInt16BE(e,2),t.writeUInt32BE(this.cumulativeTsn,4),t.writeUInt32BE(this.advertisedRwnd,8),t.writeUInt16BE(this.gaps.length,12),t.writeUInt16BE(this.duplicates.length,14);let r=Buffer.concat([t,...this.gaps.map((e=>{const t=Buffer.alloc(4);return t.writeUInt16BE(e[0],0),t.writeUInt16BE(e[1],2),t}))]);return r=Buffer.concat([r,...this.duplicates.map((e=>{const t=Buffer.alloc(4);return t.writeUInt32BE(e,0),t}))]),r}}t.SackChunk=S,S.type=3;class w extends i{get type(){return w.type}constructor(e=0,t){super(e,t),this.flags=e,this.cumulativeTsn=0,t&&(this.cumulativeTsn=t.readUInt32BE(0))}get body(){const e=Buffer.alloc(4);return e.writeUInt32BE(this.cumulativeTsn,0),e}}t.ShutdownChunk=w,w.type=7;class E extends i{get type(){return E.type}}t.ShutdownAckChunk=E,E.type=8;class C extends i{get type(){return C.type}}t.ShutdownCompleteChunk=C,C.type=14;const T=[d,a,c,S,y,b,g,w,E,m,h,p,C,v,l];function I(e){const t=e%4;return t?4-t:0}function _(e){let t=Buffer.from(""),r=Buffer.from("");return e.forEach((([e,s])=>{const n=s.length+4,i=Buffer.alloc(4);i.writeUInt16BE(e,0),i.writeUInt16BE(n,2),t=Buffer.concat([t,r,i,s]),r=Buffer.concat([...Array(I(n))].map((()=>Buffer.from("\0"))))})),t}function A(e){const t=[];let r=0;for(;r<=e.length-4;){const s=e.readUInt16BE(r),n=e.readUInt16BE(r+2);t.push([s,e.slice(r+4,r+n)]),r+=n+I(n)}return t}t.CHUNK_BY_TYPE=T.reduce(((e,t)=>(e[t.type]=t,e)),{})},1227:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cancelable=t.PQueue=void 0,t.randomString=function(e){return(0,s.randomBytes)(e).toString("hex").substring(0,e)},t.randomTransactionId=function(){return(0,s.randomBytes)(12)},t.bufferXor=function(e,t){if(e.length!==t.length)throw new TypeError("[webrtc-stun] You can not XOR buffers which length are different");const r=e.length,s=Buffer.allocUnsafe(r);for(let n=0;n<r;n++)s[n]=e[n]^t[n];return s},t.difference=function(e,t){return new Set([...e].filter((e=>!t.has(e))))};const s=r(6982),n=r(2261);t.PQueue=class{constructor(){this.queue=[],this.wait=new n.Event}put(e){this.queue.push(e),1===this.queue.length&&this.wait.execute(e)}get(){const e=this.queue.shift();return e||new Promise((e=>{this.wait.subscribe((t=>{this.queue.shift(),e(t)}))}))}};t.cancelable=e=>{let t,r;const s=new Promise(((e,s)=>{t=e,r=s}));s.then((()=>{i.execute(void 0),i.complete()})).catch((e=>{i.execute(e??new Error),i.complete()}));const i=new n.Event;return e(t,r,i).catch((()=>{})),{awaitable:s,resolve:t,reject:r}}},1236:(e,t,r)=>{"use strict";const{isUserType:s,isType:n}=r(2),i=r(59),o=r(6101);function a(e,t,r){n(t)?r[o.bytes]+=t.encodingLength.call(r,e):c(e,t,r)}function c(e,t,r){if(!s(t))throw new TypeError("Argument `schema` should be a plain object.");void 0===r.node?(r.node=e,r.current=e):r.current=e;const i=Object.keys(t);for(let s=0;s<i.length;s+=1){const a=i[s],u=t[a],l=e[a];n(u)?r[o.bytes]+=u.encodingLength.call(r,l):(c(l,u,r),r.current=e)}}e.exports={encodingLength:function(e,t){const r=new i;return a(e,t,r),i.clean(r),r.bytes},encodingLengthCommon:a}},1310:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SrtpContext=void 0;t.SrtpContext=class{static findMatchingSRTPProfile(e,t){for(const r of t)if(e.includes(r))return r}}},1328:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.flight2=void 0;const s=r(6982),n=r(4148),i=r(667),o=r(1310),a=r(2696),c=r(6033),u=r(6316),l=r(7890),d=r(986),h=r(7983),p=r(9750),f=r(3232),g=r(6282),m=r(5982),y=(0,f.debug)("werift-dtls : packages/dtls/flight/server/flight2.ts : log");t.flight2=(e,t,r,f)=>b=>{y("dtls version",b.clientVersion),t.flight=2,t.recordSequenceNumber=0,t.sequenceNumber=0,b.extensions.forEach((e=>{switch(e.type){case a.EllipticCurves.type:{const s=a.EllipticCurves.fromData(e.data).data;y(t.sessionId,"curves",s);const i=s.filter((e=>n.NamedCurveAlgorithmList.includes(e)))[0];r.namedCurve=i,y(t.sessionId,"curve selected",r.namedCurve)}break;case l.Signature.type:{if(!r.signatureHashAlgorithm)throw new Error("need to set certificate");const s=l.Signature.fromData(e.data).data;y(t.sessionId,"hash,signature",s);const n=s.find((e=>e.signature===r.signatureHashAlgorithm?.signature))?.signature,i=s.find((e=>e.hash===r.signatureHashAlgorithm?.hash))?.hash;if(null==n||null==i)throw new Error("invalid signatureHash")}break;case d.UseSRTP.type:{if(!t.options?.srtpProfiles)return;if(0===t.options.srtpProfiles.length)return;const r=d.UseSRTP.fromData(e.data);y(t.sessionId,"srtp profiles",r.profiles);const s=o.SrtpContext.findMatchingSRTPProfile(r.profiles,t.options?.srtpProfiles);if(!s)throw new Error;f.srtpProfile=s,y(t.sessionId,"srtp profile selected",f.srtpProfile)}break;case c.ExtendedMasterSecret.type:t.remoteExtendedMasterSecret=!0;break;case u.RenegotiationIndication.type:y(t.sessionId,"RenegotiationIndication",e.data);break;case 43:{const t=[...e.data.subarray(1)].map((e=>e.toString(10)));y("dtls supported version",t)}}})),r.localRandom=new p.DtlsRandom,r.remoteRandom=p.DtlsRandom.from(b.random);const v=b.cipherSuites;y(t.sessionId,"cipher suites",v);const S=(()=>{switch(r.signatureHashAlgorithm?.signature){case n.SignatureAlgorithm.ecdsa_3:return n.CipherSuite.TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_49195;case n.SignatureAlgorithm.rsa_1:return n.CipherSuite.TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256_49199}})();if(void 0===S||!v.includes(S))throw new Error("dtls cipher suite negotiation failed");r.cipherSuite=S,y(t.sessionId,"selected cipherSuite",r.cipherSuite),r.localKeyPair=(0,i.generateKeyPair)(r.namedCurve),t.cookie||=(0,s.randomBytes)(20);const w=new h.ServerHelloVerifyRequest({major:254,minor:253},t.cookie),E=(0,g.createFragments)(t)([w]),C=(0,g.createPlaintext)(t)(E.map((e=>({type:m.ContentType.handshake,fragment:e.serialize()}))),++t.recordSequenceNumber).map((e=>e.serialize()));for(const t of C)e.send(t)}},1362:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addVideoFilterArguments=function(e,t,r="unfilteredRecording"){const s=e.findIndex((e=>"-filter_complex"===e));void 0!==s&&-1!==s?e[s+1]=e[s+1]+`[${r}] ; [${r}] ${t}`:e.push("-filter_complex",t)}},1394:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9023),n=r(6982),i=r(4522),o=r(9511),a=r(9385);t.publicKeyValidator={name:"PublicKeyInfo",class:o.Class.UNIVERSAL,tag:o.Tag.SEQUENCE,capture:"publicKeyInfo",value:[{name:"PublicKeyInfo.AlgorithmIdentifier",class:o.Class.UNIVERSAL,tag:o.Tag.SEQUENCE,value:[{name:"PublicKeyAlgorithmIdentifier.algorithm",class:o.Class.UNIVERSAL,tag:o.Tag.OID,capture:"publicKeyOID"}]},{name:"PublicKeyInfo.PublicKey",class:o.Class.UNIVERSAL,tag:o.Tag.BITSTRING,capture:"publicKey"}]},t.privateKeyValidator={name:"PrivateKeyInfo",class:o.Class.UNIVERSAL,tag:o.Tag.SEQUENCE,capture:"privateKeyInfo",value:[{name:"PrivateKeyInfo.Version",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.AlgorithmIdentifier",class:o.Class.UNIVERSAL,tag:o.Tag.SEQUENCE,value:[{name:"PrivateKeyAlgorithmIdentifier.algorithm",class:o.Class.UNIVERSAL,tag:o.Tag.OID,capture:"privateKeyOID"}]},{name:"PrivateKeyInfo.PrivateKey",class:o.Class.UNIVERSAL,tag:o.Tag.OCTETSTRING,capture:"privateKey"}]};const c={name:"RSAPublicKey",class:o.Class.UNIVERSAL,tag:o.Tag.SEQUENCE,value:[{name:"RSAPublicKey.modulus",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"publicKeyExponent"}]},u={name:"RSAPrivateKey",class:o.Class.UNIVERSAL,tag:o.Tag.SEQUENCE,value:[{name:"RSAPrivateKey.version",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",class:o.Class.UNIVERSAL,tag:o.Tag.INTEGER,capture:"privateKeyCoefficient"}]},l=[a.getOID("X25519"),a.getOID("X448"),a.getOID("Ed25519"),a.getOID("Ed448")];class d{constructor(e){const r={},s=e.validate(t.publicKeyValidator,r);if(null!=s)throw new Error("Cannot read X.509 public key: "+s.message);this.oid=o.ASN1.parseOID(r.publicKeyOID.bytes),this.algo=a.getOIDName(this.oid),this._pkcs8=e,this._keyRaw=o.ASN1.parseBitString(r.publicKey.bytes).buf,this._finalKey=this._keyRaw,this._finalPEM=""}static fromPEM(e){const t=o.PEM.parse(e)[0];if(t.procType.includes("ENCRYPTED"))throw new Error("Could not convert public key from PEM, PEM is encrypted.");const r=o.ASN1.fromDER(t.body,!0);switch(t.type){case"PUBLIC KEY":return new d(r);case"RSA PUBLIC KEY":const e=o.ASN1.Seq([o.ASN1.Seq([o.ASN1.OID(a.getOID("rsaEncryption")),o.ASN1.Null()]),o.ASN1.BitString(r.DER)]);return new d(e);default:throw new Error("Could not convert public key from PEM, recommend PKCS#8 PEM")}}static addVerifier(e,t){if(""===(e=a.getOID(e)))throw new Error(`Invalid object identifier: ${e}`);if(null!=d._verifiers[e])throw new Error(`Verifier ${e} exists`);d._verifiers[e]=t}get keyRaw(){return this._finalKey}verify(e,t,r){const s=d._verifiers[this.oid];if(null!=s){const i=n.createHash(r).update(e).digest();return s.call(this,i,t)}const i=n.createVerify(r);return i.update(e),i.verify(this.toPEM(),t)}getFingerprint(e,t="PublicKey"){let r;switch(t){case"PublicKeyInfo":r=this._pkcs8.DER;break;case"PublicKey":r=this._keyRaw;break;default:throw new Error(`Unknown fingerprint type "${t}".`)}const s=n.createHash(e);return s.update(r),s.digest()}toASN1(){return this._pkcs8}toDER(){return this._pkcs8.DER}toPEM(){return""===this._finalPEM&&(this._finalPEM=new o.PEM("PUBLIC KEY",this._pkcs8.DER).toString()),this._finalPEM}toJSON(){return{oid:this.oid,algo:this.algo,publicKey:this._keyRaw}}[s.inspect.custom](e,t){return`<${this.constructor.name} ${s.inspect(this.toJSON(),t)}>`}}d._verifiers=Object.create(null),t.PublicKey=d;class h{constructor(e){const r=Object.create(null),s=e.validate(t.privateKeyValidator,r);if(null!=s)throw new Error("Cannot read X.509 private key: "+s.message);if(this.version=o.ASN1.parseIntegerNum(r.privateKeyVersion.bytes)+1,this.oid=o.ASN1.parseOID(r.privateKeyOID.bytes),this.algo=a.getOIDName(this.oid),this._pkcs8=e,this._keyRaw=r.privateKey.bytes,this._publicKeyRaw=null,this._finalKey=this._keyRaw,this._finalPEM="",l.includes(this.oid))if(this._finalKey=this._keyRaw=o.ASN1.parseDER(this._keyRaw,o.Class.UNIVERSAL,o.Tag.OCTETSTRING).bytes,"1.3.101.112"===this.oid){const e=i.sign.keyPair.fromSeed(this._keyRaw);this._publicKeyRaw=Buffer.from(e.publicKey),this._finalKey=Buffer.from(e.secretKey)}else if(2===this.version)for(const t of e.mustCompound())t.class===o.Class.CONTEXT_SPECIFIC&&1===t.tag&&(this._publicKeyRaw=o.ASN1.parseBitString(t.bytes).buf,this._finalKey=Buffer.concat([this._keyRaw,this._publicKeyRaw]))}static fromPEM(e){const t=o.PEM.parse(e)[0];if(t.procType.includes("ENCRYPTED"))throw new Error("Could not convert private key from PEM, PEM is encrypted.");let r=o.ASN1.fromDER(t.body,!0);switch(t.type){case"PRIVATE KEY":return new h(r);case"RSA PRIVATE KEY":return r=o.ASN1.Seq([r.value[0],o.ASN1.Seq([o.ASN1.OID(a.getOID("rsaEncryption")),o.ASN1.Null()]),new o.ASN1(o.Class.UNIVERSAL,o.Tag.OCTETSTRING,r.DER)]),new h(r);default:throw new Error("Could not convert private key from PEM, recommend PKCS#8 PEM")}}static addSigner(e,t){if(""===(e=a.getOID(e)))throw new Error(`Invalid object identifier: ${e}`);if(null!=h._signers[e])throw new Error(`Signer ${e} exists`);h._signers[e]=t}get keyRaw(){return this._finalKey}get publicKeyRaw(){return this._publicKeyRaw}sign(e,t){const r=h._signers[this.oid];if(null!=r){const s=n.createHash(t).update(e).digest();return r.call(this,s)}const s=n.createSign(t);return s.update(e),s.sign(this.toPEM())}toASN1(){return this._pkcs8}toDER(){return this._pkcs8.DER}toPEM(){return""===this._finalPEM&&(this._finalPEM=new o.PEM("PRIVATE KEY",this._pkcs8.DER).toString()),this._finalPEM}toJSON(){return{version:this.version,oid:this.oid,algo:this.algo,privateKey:this._keyRaw,publicKey:this._publicKeyRaw}}[s.inspect.custom](e,t){return`<${this.constructor.name} ${s.inspect(this.toJSON(),t)}>`}}h._signers=Object.create(null),t.PrivateKey=h;class p extends d{static fromPublicKey(e){return new p(e.toASN1())}constructor(e){if(super(e),a.getOID(this.oid)!==a.getOID("rsaEncryption"))throw new Error(`Invalid RSA public key, unknown OID: ${this.oid}`);const t=Object.create(null);this._pkcs1=o.ASN1.fromDER(this._keyRaw,!0);const r=this._pkcs1.validate(c,t);if(null!=r)throw new Error("Cannot read RSA public key: "+r.message);this.modulus=o.ASN1.parseIntegerStr(t.publicKeyModulus.bytes),this.exponent=o.ASN1.parseIntegerNum(t.publicKeyExponent.bytes)}toASN1(){return this._pkcs1}toDER(){return this._keyRaw}toPEM(){return""===this._finalPEM&&(this._finalPEM=new o.PEM("RSA PUBLIC KEY",this._keyRaw).toString()),this._finalPEM}toPublicKeyPEM(){return new o.PEM("PUBLIC KEY",this._pkcs8.DER).toString()}toJSON(){return{oid:this.oid,algo:this.algo,modulus:g(this.modulus),exponent:this.exponent}}[s.inspect.custom](e,t){return`<${this.constructor.name} ${s.inspect(this.toJSON(),t)}>`}}t.RSAPublicKey=p;class f extends h{static fromPrivateKey(e){return new f(e.toASN1())}constructor(e){if(super(e),a.getOID(this.oid)!==a.getOID("rsaEncryption"))throw new Error(`Invalid RSA private key, unknown OID: ${this.oid}`);const t=Object.create(null);this._pkcs1=o.ASN1.fromDER(this._keyRaw,!0);const r=this._pkcs1.validate(u,t);if(null!=r)throw new Error("Cannot read RSA private key: "+r.message);this.publicExponent=o.ASN1.parseIntegerNum(t.privateKeyPublicExponent.bytes),this.privateExponent=o.ASN1.parseIntegerStr(t.privateKeyPrivateExponent.bytes),this.modulus=o.ASN1.parseIntegerStr(t.privateKeyModulus.bytes),this.prime1=o.ASN1.parseIntegerStr(t.privateKeyPrime1.bytes),this.prime2=o.ASN1.parseIntegerStr(t.privateKeyPrime2.bytes),this.exponent1=o.ASN1.parseIntegerStr(t.privateKeyExponent1.bytes),this.exponent2=o.ASN1.parseIntegerStr(t.privateKeyExponent2.bytes),this.coefficient=o.ASN1.parseIntegerStr(t.privateKeyCoefficient.bytes)}toASN1(){return this._pkcs1}toDER(){return this._keyRaw}toPEM(){return""===this._finalPEM&&(this._finalPEM=new o.PEM("RSA PRIVATE KEY",this._keyRaw).toString()),this._finalPEM}toPrivateKeyPEM(){return new o.PEM("PRIVATE KEY",this._pkcs8.DER).toString()}toJSON(){return{version:this.version,oid:this.oid,algo:this.algo,publicExponent:this.publicExponent,privateExponent:g(this.privateExponent),modulus:g(this.modulus),prime1:g(this.prime1),prime2:g(this.prime2),exponent1:g(this.exponent1),exponent2:g(this.exponent2),coefficient:g(this.coefficient)}}[s.inspect.custom](e,t){return`<${this.constructor.name} ${s.inspect(this.toJSON(),t)}>`}}function g(e){return e.length%8!=0&&e.startsWith("00")?e.slice(2):e}t.RSAPrivateKey=f,d.addVerifier(a.getOID("Ed25519"),(function(e,t){return i.sign.detached.verify(e,t,this.keyRaw)})),h.addSigner(a.getOID("Ed25519"),(function(e){const t=this.keyRaw;if(64!==t.length)throw new Error("Invalid signing key.");return Buffer.from(i.sign.detached(e,t))}))},1414:function(e,t,r){"use strict";var s,n=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=s(e),o=0;o<r.length;o++)"default"!==r[o]&&n(t,e,r[o]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.StorageSettings=void 0;const a=o(r(2743)),{systemManager:c}=a.default;t.StorageSettings=class{constructor(e,t){this.device=e,this.settings=t,this.values={},this.hasValue={};for(const e of Object.keys(t)){const r=t[e],s=()=>this.getItem(e);let n;n="clippath"!==r.type?s:()=>{try{return JSON.parse(s())}catch(e){}},Object.defineProperty(this.values,e,{get:n,set:t=>this.putSetting(e,t),enumerable:!0}),Object.defineProperty(this.hasValue,e,{get:()=>null!=this.device.storage.getItem(e),enumerable:!0})}}get keys(){const e={};for(const t of Object.keys(this.settings))e[t]=t;return e}async getSettings(){const e=await(this.options?.onGet?.()),t=[];for(const[r,s]of Object.entries(this.settings)){let n=Object.assign({},s);e?.[r]&&(n=Object.assign(n,e[r])),n.onGet&&(n=Object.assign(n,await n.onGet())),n.hide||await(this.options?.hide?.[r]?.())||(n.key=r,n.value=this.getItemInternal(r,n,!0),"function"==typeof n.deviceFilter&&(n.deviceFilter=n.deviceFilter.toString()),t.push(n),delete n.onPut,delete n.onGet,delete n.mapPut,delete n.mapGet)}return t}async putSetting(e,t){const r=this.settings[e];let s;return r&&(s=this.getItemInternal(e,r)),this.putSettingInternal(r,s,e,t)}putSettingInternal(e,t,r,s){e?.noStore||(e?.mapPut&&(s=e.mapPut(t,s)),null==s?this.device.storage.removeItem(r):"object"==typeof s?this.device.storage.setItem(r,JSON.stringify(s)):this.device.storage.setItem(r,s?.toString())),e?.onPut?.(t,s),e?.hide||this.device.onDeviceEvent(a.ScryptedInterface.Settings,void 0)}getItemInternal(e,t,r){if(!t)return this.device.storage.getItem(e);const s=function(e,t,r,s){if(null==e)return r();const n=t.multiple?"array":t.type;if("boolean"===n)return"true"===e||"false"!==e&&(r()||!1);if("number"===n){const t=parseFloat(e);return isNaN(t)?r()||0:t}if("integer"===n){const t=parseInt(e);return isNaN(t)?r()||0:t}if("array"===n){if(!e)return r()||[];try{return JSON.parse(e)}catch(e){return r()||[]}}if("device"===n)return s?e:c.getDeviceById(e)||c.getDeviceById(r());if(e&&t.json)try{return JSON.parse(e)}catch(e){return r()}return e||r()}(this.device.storage.getItem(e),t,(()=>null!=t.persistedDefaultValue?(this.putSettingInternal(t,void 0,e,t.persistedDefaultValue),t.persistedDefaultValue):t.defaultValue),r);return t.mapGet?t.mapGet(s):s}getItem(e){return this.getItemInternal(e,this.settings[e])}}},1447:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.p256PreMasterSecret=t.p256Keypair=void 0;const s=r(3990);t.p256Keypair=()=>{const e=s.p256.utils.randomPrivateKey(),t=s.p256.getPublicKey(e,!1);return{privateKey:Buffer.from(e),publicKey:Buffer.from(t)}};t.p256PreMasterSecret=({publicKey:e,privateKey:t})=>{const r=s.p256.getSharedSecret(t,e);return Buffer.from(r).subarray(1)}},1456:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePlainText=t.parsePacket=void 0;const s=r(4007),n=r(5205),i=r(5982),o=r(7077),a=r(1598),c=(0,n.debug)("werift-dtls : packages/dtls/record/receive.ts : log"),u=(0,n.debug)("werift-dtls : packages/dtls/record/receive.ts : err");t.parsePacket=e=>{let t=0;const r=[];for(;e.length>t;){const s=e.readUInt16BE(t+11);if(e.length<t+(12+s))break;const n=a.DtlsPlaintext.deSerialize(e.subarray(t));r.push(n),t+=13+s}return r};t.parsePlainText=(e,t)=>r=>{switch(r.recordLayerHeader.contentType){case i.ContentType.changeCipherSpec:return c(e.sessionId,"change cipher spec"),[{type:i.ContentType.changeCipherSpec,data:void 0}];case i.ContentType.handshake:{let s=r.fragment;try{r.recordLayerHeader.epoch>0&&(c(e.sessionId,"decrypt handshake"),s=t.decryptPacket(r))}catch(t){throw u(e.sessionId,"decrypt failed",t),t}try{let e=0;const t=[];for(;s.length>e;){const r=o.FragmentedHandshake.deSerialize(s.subarray(e));t.push({type:i.ContentType.handshake,data:r}),e+=r.fragment_length+12}return t}catch(t){throw u(e.sessionId,"decSerialize failed",t,s),t}}case i.ContentType.applicationData:return[{type:i.ContentType.applicationData,data:t.decryptPacket(r)}];case i.ContentType.alert:{let n=s.Alert.deSerialize(r.fragment);if(null==i.AlertDesc[n.description]){const e=t.decryptPacket(r);n=s.Alert.deSerialize(e)}if(u(e.sessionId,"ContentType.alert",n,i.AlertDesc[n.description],"flight",e.flight,"lastFlight",e.lastFlight),n.level>1)throw new Error("alert fatal error");return[{type:i.ContentType.alert,data:void 0}]}default:return[{type:i.ContentType.alert,data:void 0}]}}},1589:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wNAF=function(e,t){return{constTimeNegate:a,hasPrecomputes:e=>1!==f(e),unsafeLadder(t,r,s=e.ZERO){let n=t;for(;r>i;)r&o&&(s=s.add(n)),n=n.double(),r>>=o;return s},precomputeWindow(e,r){const{windows:s,windowSize:n}=u(r,t),i=[];let o=e,a=o;for(let e=0;e<s;e++){a=o,i.push(a);for(let e=1;e<n;e++)a=a.add(o),i.push(a);o=a.double()}return i},wNAF(r,s,n){const{windows:i,windowSize:c}=u(r,t);let l=e.ZERO,d=e.BASE;const h=BigInt(2**r-1),p=2**r,f=BigInt(r);for(let e=0;e<i;e++){const t=e*c;let r=Number(n&h);n>>=f,r>c&&(r-=p,n+=o);const i=t,u=t+Math.abs(r)-1,g=e%2!=0,m=r<0;0===r?d=d.add(a(g,s[i])):l=l.add(a(m,s[u]))}return{p:l,f:d}},wNAFUnsafe(r,s,n,a=e.ZERO){const{windows:c,windowSize:l}=u(r,t),d=BigInt(2**r-1),h=2**r,p=BigInt(r);for(let e=0;e<c;e++){const t=e*l;if(n===i)break;let r=Number(n&d);if(n>>=p,r>l&&(r-=h,n+=o),0===r)continue;let c=s[t+Math.abs(r)-1];r<0&&(c=c.negate()),a=a.add(c)}return a},getPrecomputes(e,t,r){let s=h.get(t);return s||(s=this.precomputeWindow(t,e),1!==e&&h.set(t,r(s))),s},wNAFCached(e,t,r){const s=f(e);return this.wNAF(s,this.getPrecomputes(s,e,r),t)},wNAFCachedUnsafe(e,t,r,s){const n=f(e);return 1===n?this.unsafeLadder(e,t,s):this.wNAFUnsafe(n,this.getPrecomputes(n,e,r),t,s)},setWindowSize(e,r){c(r,t),p.set(e,r),h.delete(e)}}},t.pippenger=function(e,t,r,s){if(l(r,e),d(s,t),r.length!==s.length)throw new Error("arrays of points and scalars must have equal length");const i=e.ZERO,o=(0,n.bitLen)(BigInt(r.length)),a=o>12?o-3:o>4?o-2:o?2:1,c=(1<<a)-1,u=new Array(c+1).fill(i),h=Math.floor((t.BITS-1)/a)*a;let p=i;for(let e=h;e>=0;e-=a){u.fill(i);for(let t=0;t<s.length;t++){const n=s[t],i=Number(n>>BigInt(e)&BigInt(c));u[i]=u[i].add(r[t])}let t=i;for(let e=u.length-1,r=i;e>0;e--)r=r.add(u[e]),t=t.add(r);if(p=p.add(t),0!==e)for(let e=0;e<a;e++)p=p.double()}return p},t.precomputeMSMUnsafe=function(e,t,r,s){c(s,t.BITS),l(r,e);const n=e.ZERO,i=2**s-1,o=Math.ceil(t.BITS/s),a=BigInt((1<<s)-1),u=r.map((e=>{const t=[];for(let r=0,s=e;r<i;r++)t.push(s),s=s.add(e);return t}));return e=>{if(d(e,t),e.length>r.length)throw new Error("array of scalars must be smaller than array of points");let i=n;for(let t=0;t<o;t++){if(i!==n)for(let e=0;e<s;e++)i=i.double();const r=BigInt(o*s-(t+1)*s);for(let t=0;t<e.length;t++){const s=e[t],n=Number(s>>r&a);n&&(i=i.add(u[t][n-1]))}}return i}},t.validateBasic=function(e){return(0,s.validateField)(e.Fp),(0,n.validateObject)(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...(0,s.nLength)(e.n,e.nBitLength),...e,p:e.Fp.ORDER})};const s=r(5720),n=r(3939),i=BigInt(0),o=BigInt(1);function a(e,t){const r=t.negate();return e?r:t}function c(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function u(e,t){c(e,t);return{windows:Math.ceil(t/e)+1,windowSize:2**(e-1)}}function l(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach(((e,r)=>{if(!(e instanceof t))throw new Error("invalid point at index "+r)}))}function d(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach(((e,r)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+r)}))}const h=new WeakMap,p=new WeakMap;function f(e){return p.get(e)||1}},1597:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(371),t)},1598:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DtlsPlaintext=void 0;const s=r(4011),n=r(2888);class i{constructor(e,t){this.recordLayerHeader=e,this.fragment=t}get summary(){return{header:this.recordLayerHeader,fragment:(0,s.dumpBuffer)(this.fragment)}}static createEmpty(){return new i(void 0,void 0)}static deSerialize(e){if(e.length<13)throw new Error("Invalid DTLS record: buffer is too short");const t=e.readUInt8(0),r=e.readUInt8(1),s=e.readUInt8(2),n=e.readUInt16BE(3),o=e.slice(5,11).readUIntBE(0,6),a=e.readUInt16BE(11);if(e.length<13+a)throw new Error("Invalid DTLS record: fragment length exceeds buffer");const c=e.slice(13,13+a);return new i({contentType:t,protocolVersion:{major:r,minor:s},epoch:n,sequenceNumber:o,contentLen:a},c)}serialize(){const e=this.fragment.length,t=13+e,r=Buffer.alloc(t);return r.writeUInt8(this.recordLayerHeader.contentType,0),r.writeUInt8(this.recordLayerHeader.protocolVersion.major,1),r.writeUInt8(this.recordLayerHeader.protocolVersion.minor,2),r.writeUInt16BE(this.recordLayerHeader.epoch,3),r.writeUIntBE(this.recordLayerHeader.sequenceNumber,5,6),r.writeUInt16BE(e,11),this.fragment.copy(r,13),r}computeMACHeader(){return new n.MACHeader(this.recordLayerHeader.epoch,this.recordLayerHeader.sequenceNumber,this.recordLayerHeader.contentType,this.recordLayerHeader.protocolVersion,this.recordLayerHeader.contentLen).serialize()}}t.DtlsPlaintext=i},1609:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Hash=t.nextTick=t.byteSwapIfBE=t.isLE=void 0,t.isBytes=function(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name},t.u8=function(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},t.u32=function(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))},t.createView=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)},t.rotr=function(e,t){return e<<32-t|e>>>t},t.rotl=function(e,t){return e<<t|e>>>32-t>>>0},t.byteSwap=i,t.byteSwap32=function(e){for(let t=0;t<e.length;t++)e[t]=i(e[t])},t.bytesToHex=function(e){(0,n.abytes)(e);let t="";for(let r=0;r<e.length;r++)t+=o[e[r]];return t},t.hexToBytes=function(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const s=new Uint8Array(r);for(let t=0,n=0;t<r;t++,n+=2){const r=c(e.charCodeAt(n)),i=c(e.charCodeAt(n+1));if(void 0===r||void 0===i){const t=e[n]+e[n+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+n)}s[t]=16*r+i}return s},t.asyncLoop=async function(e,r,s){let n=Date.now();for(let i=0;i<e;i++){s(i);const e=Date.now()-n;e>=0&&e<r||(await(0,t.nextTick)(),n+=e)}},t.utf8ToBytes=u,t.toBytes=l,t.concatBytes=function(...e){let t=0;for(let r=0;r<e.length;r++){const s=e[r];(0,n.abytes)(s),t+=s.length}const r=new Uint8Array(t);for(let t=0,s=0;t<e.length;t++){const n=e[t];r.set(n,s),s+=n.length}return r},t.checkOpts=function(e,t){if(void 0!==t&&"[object Object]"!=={}.toString.call(t))throw new Error("Options should be object or undefined");return Object.assign(e,t)},t.wrapConstructor=function(e){const t=t=>e().update(l(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t},t.wrapConstructorWithOpts=function(e){const t=(t,r)=>e(r).update(l(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t},t.wrapXOFConstructorWithOpts=function(e){const t=(t,r)=>e(r).update(l(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t},t.randomBytes=function(e=32){if(s.crypto&&"function"==typeof s.crypto.getRandomValues)return s.crypto.getRandomValues(new Uint8Array(e));if(s.crypto&&"function"==typeof s.crypto.randomBytes)return s.crypto.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")};const s=r(4682),n=r(5744);function i(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}t.isLE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0],t.byteSwapIfBE=t.isLE?e=>e:e=>i(e);const o=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));const a={_0:48,_9:57,A:65,F:70,a:97,f:102};function c(e){return e>=a._0&&e<=a._9?e-a._0:e>=a.A&&e<=a.F?e-(a.A-10):e>=a.a&&e<=a.f?e-(a.a-10):void 0}function u(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}function l(e){return"string"==typeof e&&(e=u(e)),(0,n.abytes)(e),e}t.nextTick=async()=>{};t.Hash=class{clone(){return this._cloneInto()}}},1620:(e,t,r)=>{"use strict";const{isUserType:s,isEncodeType:n,isType:i}=r(2),o=r(6101),a=r(59),c=r(872);function u(e,t,r,s){i(r)?(r.encode.call(s,e,t),s[o.bytes]+=r.encode.bytes):l(e,t,r,s)}function l(e,t,r,i){!function(e){if(!s(e))throw new TypeError("Argument `schema` should be a plain object.")}(r),void 0===i.node?(i.node=e,i.current=e):i.current=e;const a=Object.keys(r);for(let s=0;s<a.length;s+=1){const c=a[s],u=r[c],d=e[c];n(u)?(u.encode.call(i,d,t),i[o.bytes]+=u.encode.bytes):(l(d,t,u,i),i.current=e)}}e.exports={encode:function e(t,r,s){const n=new a;if(r instanceof c){const e=s;s=r,r=e}s instanceof c||(s=new c);return u(t,s,r,n),e.bytes=n.bytes,a.clean(n),s},encodeCommon:u}},1636:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GenericNack=void 0;const s=r(9543),n=r(4221),i=r(5392);class o{toJSON(){return{lost:this.lost,senderSsrc:this.senderSsrc,mediaSourceSsrc:this.mediaSourceSsrc}}constructor(e={}){this.count=o.count,this.lost=[],Object.assign(this,e),this.header||(this.header=new n.RtcpHeader({type:i.RtcpTransportLayerFeedbackType,count:this.count,version:2}))}static deSerialize(e,t){const[r,n]=(0,s.bufferReader)(e,[4,4]),i=[];for(let t=8;t<e.length;t+=4){const[r,n]=(0,s.bufferReader)(e.subarray(t),[2,2]);i.push(r);for(let e=0;e<16;e++)n>>e&1&&i.push(r+e+1)}return new o({header:t,senderSsrc:r,mediaSourceSsrc:n,lost:i})}serialize(){const e=(0,s.bufferWriter)([4,4],[this.senderSsrc,this.mediaSourceSsrc]),t=[];if(this.lost.length>0){let e=this.lost[0],r=0;this.lost.slice(1).forEach((n=>{const i=n-e-1;i>=0&&i<16?r|=1<<i:(t.push((0,s.bufferWriter)([2,2],[e,r])),e=n,r=0)})),t.push((0,s.bufferWriter)([2,2],[e,r]))}const r=Buffer.concat([e,Buffer.concat(t)]);return this.header.length=r.length/4,Buffer.concat([this.header.serialize(),r])}}t.GenericNack=o,o.count=1},1641:(e,t,r)=>{"use strict";var s=r(9925);function n(e){return!0===s(e)&&"[object Object]"===Object.prototype.toString.call(e)}e.exports=function(e){var t,r;return!1!==n(e)&&("function"==typeof(t=e.constructor)&&(!1!==n(r=t.prototype)&&!1!==r.hasOwnProperty("isPrototypeOf")))}},1690:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.weriftStunServers=t.weriftTurnServers=t.stunServers=t.turnServers=void 0,t.toWeriftConfiguration=function(e){return{iceServers:e.iceServers.map(c)}};const r="turn.scrypted.app:3478",s=`stun:${r}`,n={username:"foo",credential:"bar"},i={urls:[`turn:${r}`],...n},o={urls:[s],...n},a={urls:["stun:stun.l.google.com:19302"]};function c(e){return{urls:"string"==typeof e.urls?e.urls:e.urls[0],username:e.username,credential:e.credential}}t.turnServers=[i,o,a],t.stunServers=[o,a],t.weriftTurnServers=t.turnServers.map(c),t.weriftStunServers=t.stunServers.map(c)},1836:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SCTP=t.WEBRTC_PPID=t.SCTP_STATE=void 0;var s=r(9475);Object.defineProperty(t,"SCTP_STATE",{enumerable:!0,get:function(){return s.SCTP_STATE}}),Object.defineProperty(t,"WEBRTC_PPID",{enumerable:!0,get:function(){return s.WEBRTC_PPID}});var n=r(9056);Object.defineProperty(t,"SCTP",{enumerable:!0,get:function(){return n.SCTP}})},1854:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsMixinDeviceBase=void 0;const n=r(2743),i=s(r(2743)),{deviceManager:o}=i.default;class a extends n.MixinDeviceBase{constructor(e){super(e),this.settingsGroup=e.group,this.settingsGroupKey=e.groupKey,process.nextTick((()=>o.onMixinEvent(this.id,this,n.ScryptedInterface.Settings,null)))}async getSettings(){const e=this.mixinDeviceInterfaces.includes(n.ScryptedInterface.Settings)?this.mixinDevice.getSettings():void 0,t=this.getMixinSettings(),r=[];try{const t=await e||[];r.push(...t)}catch(e){const t=this.name,s=`${t} Extension settings failed to load.`;this.console.error(s,e),r.push({key:Math.random().toString(),title:t,value:"Settings Error",group:"Errors",description:s,readonly:!0})}try{const e=await t||[];for(const t of e)t.group=t.group||this.settingsGroup,t.key=this.settingsGroupKey+":"+t.key;r.push(...e)}catch(e){const t=o.getDeviceState(this.mixinProviderNativeId).name,s=`${t} Extension settings failed to load.`;this.console.error(s,e),r.push({key:Math.random().toString(),title:t,value:"Settings Error",group:"Errors",description:s,readonly:!0})}return r}async putSetting(e,t){const r=this.settingsGroupKey+":";if(!e?.startsWith(r))return this.mixinDevice.putSetting(e,t);await this.putMixinSetting(e.substring(r.length),t)||o.onMixinEvent(this.id,this,n.ScryptedInterface.Settings,null)}async release(){await o.onMixinEvent(this.id,this,n.ScryptedInterface.Settings,null)}}t.SettingsMixinDeviceBase=a},1856:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTCCamera=void 0;const s=r(2743),n=r(6238);class i extends s.ScryptedDeviceBase{constructor(e,t){super(t),this.plugin=e}async startIntercom(e){const t=await this.intercom;if(!t)throw new Error("no webrtc session");return t.startIntercom(e)}async stopIntercom(){const e=await this.intercom;if(!e)throw new Error("no webrtc session");return e.stopIntercom()}async getVideoStream(e){const t=(0,n.getRTCMediaStreamOptions)("webrtc","WebRTC"),{mediaObject:r,getIntercom:s}=await(0,n.createRTCPeerConnectionSource)({mixinId:void 0,nativeId:this.nativeId,mediaStreamOptions:t,startRTCSignalingSession:e=>this.startRTCSignalingSession(e),maximumCompatibilityMode:this.plugin.storageSettings.values.maximumCompatibilityMode});return this.intercom?.then((e=>e.stopIntercom())),this.intercom=s(),r}async getVideoStreamOptions(){return[(0,n.getRTCMediaStreamOptions)("webrtc","WebRTC")]}async startRTCSignalingSession(e){if(!this.pendingClient)throw new Error('Browser client is not connected. Click "Stream Web Camera".');this.pendingClient(new class{constructor(){this.__proxy_props={options:{}}}async getOptions(){return{}}createLocalDescription(t,r,s){return e.createLocalDescription(t,r,s)}setRemoteDescription(t,r){return e.setRemoteDescription(t,r)}addIceCandidate(t){return e.addIceCandidate(t)}}),this.pendingClient=void 0}createRTCSignalingSession(){return new Promise((e=>{this.pendingClient=e}))}}t.WebRTCCamera=i},1867:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RedEncoder=void 0;const s=r(9543),n=r(8007);t.RedEncoder=class{constructor(e=1){this.distance=e,this.cache=[],this.cacheSize=10}push(e){this.cache.push(e),this.cache.length>this.cacheSize&&this.cache.shift()}build(){const e=new n.Red,t=this.cache.slice(-(this.distance+1)),r=t.pop();return r?(t.forEach((t=>{const n=(0,s.uint32Add)(r.timestamp,-t.timestamp);n>i||e.blocks.push({block:t.block,blockPT:t.blockPT,timestampOffset:n})})),e.blocks.push({block:r.block,blockPT:r.blockPT}),e):e}};const i=16383},1937:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Flight5=void 0;const s=r(4148),n=r(6203),i=r(667),o=r(91),a=r(1310),c=r(9602),u=r(6033),l=r(6316),d=r(986),h=r(3038),p=r(8241),f=r(2499),g=r(9919),m=r(695),y=r(6461),b=r(9133),v=r(7517),S=r(651),w=r(9750),E=r(3232),C=r(6282),T=r(5982),I=r(3254),_=(0,E.debug)("werift-dtls : packages/dtls/src/flight/client/flight5.ts : log");class A extends I.Flight{constructor(e,t,r,s){super(e,t,5,7),this.cipher=r,this.srtp=s}handleHandshake(e){this.dtls.bufferHandshakeCache([e],!1,4);const t=(()=>{switch(e.msg_type){case c.HandshakeType.server_hello_2:return b.ServerHello.deSerialize(e.fragment);case c.HandshakeType.certificate_11:return h.Certificate.deSerialize(e.fragment);case c.HandshakeType.server_key_exchange_12:return S.ServerKeyExchange.deSerialize(e.fragment);case c.HandshakeType.certificate_request_13:return y.ServerCertificateRequest.deSerialize(e.fragment);case c.HandshakeType.server_hello_done_14:return v.ServerHelloDone.deSerialize(e.fragment)}})();t&&R[t.msgType]({dtls:this.dtls,cipher:this.cipher,srtp:this.srtp})(t)}async exec(){if(5===this.dtls.flight)return _(this.dtls.sessionId,"flight5 twice"),void this.send(this.dtls.lastMessage);this.dtls.flight=5;const e=this.dtls.requestedCertificateTypes.length>0;_(this.dtls.sessionId,"send flight5",e);const t=[e&&this.sendCertificate(),this.sendClientKeyExchange(),e&&this.sendCertificateVerify(),this.sendChangeCipherSpec(),this.sendFinished()].filter((e=>e));this.dtls.lastMessage=t,await this.transmit(t)}sendCertificate(){const e=new h.Certificate([Buffer.from(this.cipher.localCert)]),t=this.createPacket([e]);return Buffer.concat(t.map((e=>e.serialize())))}sendClientKeyExchange(){if(!this.cipher.localKeyPair)throw new Error;const e=new g.ClientKeyExchange(this.cipher.localKeyPair.publicKey),t=this.createPacket([e]),r=Buffer.concat(t.map((e=>e.serialize()))),s=this.cipher.localKeyPair,i=this.cipher.remoteKeyPair;if(!i.publicKey)throw new Error("not exist");const a=(0,o.prfPreMasterSecret)(i.publicKey,s.privateKey,s.curve);_(this.dtls.sessionId,"extendedMasterSecret",this.dtls.options.extendedMasterSecret,this.dtls.remoteExtendedMasterSecret);const c=Buffer.concat(this.dtls.sortedHandshakeCache.map((e=>e.serialize())));return this.cipher.masterSecret=this.dtls.options.extendedMasterSecret&&this.dtls.remoteExtendedMasterSecret?(0,o.prfExtendedMasterSecret)(a,c):(0,o.prfMasterSecret)(a,this.cipher.localRandom.serialize(),this.cipher.remoteRandom.serialize()),this.cipher.cipher=(0,n.createCipher)(this.cipher.cipherSuite),this.cipher.cipher.init(this.cipher.masterSecret,this.cipher.remoteRandom.serialize(),this.cipher.localRandom.serialize()),_(this.dtls.sessionId,"cipher",this.cipher.cipher.summary),r}sendCertificateVerify(){const e=Buffer.concat(this.dtls.sortedHandshakeCache.map((e=>e.serialize()))),t=this.cipher.signatureData(e,"sha256"),r=(()=>{switch(this.cipher.signatureHashAlgorithm?.signature){case s.SignatureAlgorithm.ecdsa_3:return s.SignatureScheme.ecdsa_secp256r1_sha256;case s.SignatureAlgorithm.rsa_1:return s.SignatureScheme.rsa_pkcs1_sha256}})();if(!r)throw new Error;_(this.dtls.sessionId,"signatureScheme",this.cipher.signatureHashAlgorithm?.signature,r);const n=new f.CertificateVerify(r,t),i=this.createPacket([n]);return Buffer.concat(i.map((e=>e.serialize())))}sendChangeCipherSpec(){const e=p.ChangeCipherSpec.createEmpty().serialize(),t=(0,C.createPlaintext)(this.dtls)([{type:T.ContentType.changeCipherSpec,fragment:e}],++this.dtls.recordSequenceNumber);return Buffer.concat(t.map((e=>e.serialize())))}sendFinished(){const e=Buffer.concat(this.dtls.sortedHandshakeCache.map((e=>e.serialize()))),t=this.cipher.verifyData(e),r=new m.Finished(t);this.dtls.epoch=1;const[s]=this.createPacket([r]);this.dtls.recordSequenceNumber=0;const n=this.cipher.encryptPacket(s).serialize();return _(this.dtls.sessionId,"finished",this.cipher.cipher.summary),n}}t.Flight5=A;const R={};R[c.HandshakeType.server_hello_2]=({cipher:e,srtp:t,dtls:r})=>s=>{_(r.sessionId,"serverHello",s.cipherSuite),e.remoteRandom=w.DtlsRandom.from(s.random),e.cipherSuite=s.cipherSuite,_(r.sessionId,"selected cipherSuite",e.cipherSuite),s.extensions&&s.extensions.forEach((e=>{switch(e.type){case d.UseSRTP.type:{const s=d.UseSRTP.fromData(e.data),n=a.SrtpContext.findMatchingSRTPProfile(s.profiles,r.options.srtpProfiles||[]);if(_(r.sessionId,"selected srtp profile",n),null==n)return;t.srtpProfile=n}break;case u.ExtendedMasterSecret.type:r.remoteExtendedMasterSecret=!0;break;case l.RenegotiationIndication.type:_(r.sessionId,"RenegotiationIndication")}}))},R[c.HandshakeType.certificate_11]=({cipher:e,dtls:t})=>r=>{_(t.sessionId,"handshake certificate",r),e.remoteCertificate=r.certificateList[0]},R[c.HandshakeType.server_key_exchange_12]=({cipher:e,dtls:t})=>r=>{if(!e.localRandom||!e.remoteRandom)throw new Error;_(t.sessionId,"ServerKeyExchange",r),_(t.sessionId,"selected curve",r.namedCurve),e.remoteKeyPair={curve:r.namedCurve,publicKey:r.publicKey},e.localKeyPair=(0,i.generateKeyPair)(r.namedCurve)},R[c.HandshakeType.certificate_request_13]=({dtls:e})=>t=>{_(e.sessionId,"certificate_request",t),e.requestedCertificateTypes=t.certificateTypes,e.requestedSignatureAlgorithms=t.signatures},R[c.HandshakeType.server_hello_done_14]=({dtls:e})=>t=>{_(e.sessionId,"server_hello_done",t)}},1992:e=>{"use strict";function t(e){const t=new Uint32Array(256);for(let r=0;r<t.length;r+=1){let s=r;for(let t=0;t<8;t+=1)s=1&s?s>>>1^e:s>>>1;t[r]=s}return t}e.exports={createTable:t,createSlicedTable:function(e){const r=new Array(8),s=t(e);r[0]=s;for(let e=1;e<r.length;e+=1){r[e]=new Uint32Array(256);for(let t=0;t<256;t+=1)r[e][t]=r[e-1][t]>>>8^r[0][255&r[e-1][t]]}return r}}},2018:e=>{"use strict";e.exports=require("tty")},2126:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Candidate=void 0,t.candidateFoundation=function(e,t,r){const n=`${e}|${t}|${r}`;return(0,s.createHash)("md5").update(n,"ascii").digest("hex").slice(7)},t.candidatePriority=function(e,t=65535){let r=0;r="host"===e?126:"prflx"===e?110:"srflx"===e?100:0;return(1<<24)*r+256*t+255};const s=r(6982),n=r(9278);class i{constructor(e,t,r,s,n,i,o,a,c,u,l,d){this.foundation=e,this.component=t,this.transport=r,this.priority=s,this.host=n,this.port=i,this.type=o,this.relatedAddress=a,this.relatedPort=c,this.tcptype=u,this.generation=l,this.ufrag=d}static fromSdp(e){const t=e.split(" ");if(t.length<8)throw new Error("SDP does not have enough properties");const r={foundation:t[0],component:Number(t[1]),transport:t[2],priority:Number(t[3]),host:t[4],port:Number(t[5]),type:t[7]};for(let e=8,s=t.length-1;e<s;e+=2)"raddr"===t[e]?r.related_address=t[e+1]:"rport"===t[e]?r.related_port=Number(t[e+1]):"tcptype"===t[e]?r.tcptype=t[e+1]:"generation"===t[e]?r.generation=Number(t[e+1]):"ufrag"===t[e]&&(r.ufrag=t[e+1]);const{foundation:s,component:n,transport:o,priority:a,host:c,port:u,type:l}=r;return new i(s,n,o,a,c,u,l,r.related_address,r.related_port,r.tcptype,r.generation,r.ufrag)}canPairWith(e){const t=(0,n.isIPv4)(this.host),r=(0,n.isIPv4)(e.host);return this.component===e.component&&this.transport.toLowerCase()===e.transport.toLowerCase()&&t===r}toSdp(){let e=`${this.foundation} ${this.component} ${this.transport} ${this.priority} ${this.host} ${this.port} typ ${this.type}`;return this.relatedAddress&&(e+=` raddr ${this.relatedAddress}`),null!=this.relatedPort&&(e+=` rport ${this.relatedPort}`),this.tcptype&&(e+=` tcptype ${this.tcptype}`),null!=this.generation&&(e+=` generation ${this.generation}`),null!=this.ufrag&&(e+=` ufrag ${this.ufrag}`),e}}t.Candidate=i},2148:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CipherAesBase=void 0;t.CipherAesBase=class{constructor(e,t,r,s){this.srtpSessionKey=e,this.srtpSessionSalt=t,this.srtcpSessionKey=r,this.srtcpSessionSalt=s}encryptRtp(e,t,r){return Buffer.from([])}decryptRtp(e,t){return[]}encryptRTCP(e,t){return Buffer.from([])}decryptRTCP(e){return[]}}},2203:e=>{"use strict";e.exports=require("stream")},2237:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(9411),t)},2238:(e,t,r)=>{"use strict";r.d(t,{$:()=>u,parseHTTPHeadersQuotedKeyValueSet:()=>c});var s=r(7371);const n='"',i="=",o=", ",a=/\w+=(".*?"|[^",]+)(?=,|$)/g;function c(e,t,r=[],n=[]){const o=e.trim().match(a);if(!o)throw new s.w("E_MALFORMED_QUOTEDKEYVALUE",e);const c=o.map(((e,t)=>{const[r,...n]=e.split(i),o=n.join(i);if(0===n.length)throw new s.w("E_MALFORMED_QUOTEDKEYVALUE",t,e);return[r,o]})).reduce((function(e,[r,i],o){const a=r.toLowerCase();if(-1===t.indexOf(a))throw new s.w("E_UNAUTHORIZED_KEY",o,a);const c=i.replace(/^"(.+(?="$))"$/,"$1");return e[a]=n.includes(a)?c.toLowerCase():c,e}),{});return l(r,c),c}function u(e,t,r=[]){return l(r,e),t.reduce((function(t,r){return e[r]?t+(t?o:"")+r+i+n+e[r]+n:t}),"")}function l(e,t){e.forEach((e=>{if("undefined"==typeof t[e])throw new s.w("E_REQUIRED_KEY",e)}))}},2261:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(9543),t)},2325:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionTimeout=t.TransactionFailed=t.TransactionError=void 0;class r extends Error{}t.TransactionError=r;t.TransactionFailed=class extends r{constructor(e,t){super(),this.response=e,this.addr=t}get str(){let e="STUN transaction failed";const t=this.response.getAttributeValue("ERROR-CODE");if(t){const[r,s]=t;e+=` (${r} - ${s})`}return e}};t.TransactionTimeout=class extends r{get str(){return"STUN transaction timed out"}}},2332:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PacketResult=t.PacketStatus=t.PacketChunk=t.RecvDelta=t.StatusVectorChunk=t.RunLengthChunk=t.TransportWideCC=void 0;const s=r(962),n=r(4221),i=(0,s.debug)("werift/rtp/rtcp/rtpfb/twcc");class o{constructor(e={}){this.count=o.count,this.length=2,this.packetChunks=[],this.recvDeltas=[],Object.assign(this,e),this.header||(this.header=new n.RtcpHeader({type:205,count:this.count,version:2}))}static deSerialize(e,t){const[r,n,i,h,p,f]=(0,s.bufferReader)(e,[4,4,2,2,3,1]),g=[],m=[];let y=16;for(let t=0;t<h;){let r;switch((0,s.getBit)(e.slice(y,y+1)[0],0,1)){case l.TypeTCCRunLengthChunk:{const s=a.deSerialize(e.slice(y,y+2));r=s;const n=Math.min(h-t,s.runLength);if(s.packetStatus===d.TypeTCCPacketReceivedSmallDelta||s.packetStatus===d.TypeTCCPacketReceivedLargeDelta)for(let e=0;e<n;e++)m.push(new u({type:s.packetStatus}));t+=n}break;case l.TypeTCCStatusVectorChunk:{const s=c.deSerialize(e.slice(y,y+2));r=s,0===s.symbolSize&&s.symbolList.forEach((e=>{e===d.TypeTCCPacketReceivedSmallDelta&&m.push(new u({type:d.TypeTCCPacketReceivedSmallDelta}))})),1===s.symbolSize&&s.symbolList.forEach((e=>{e!==d.TypeTCCPacketReceivedSmallDelta&&e!==d.TypeTCCPacketReceivedLargeDelta||m.push(new u({type:e}))})),t+=s.symbolList.length}}if(!r)throw new Error;y+=2,g.push(r)}let b=y;return m.forEach((t=>{t.type===d.TypeTCCPacketReceivedSmallDelta&&(t.deSerialize(e.slice(b,b+1)),b++),t.type===d.TypeTCCPacketReceivedLargeDelta&&(t.deSerialize(e.slice(b,b+2)),b+=2)})),new o({senderSsrc:r,mediaSourceSsrc:n,baseSequenceNumber:i,packetStatusCount:h,referenceTime:p,fbPktCount:f,recvDeltas:m,packetChunks:g,header:t})}serialize(){const e=(0,s.bufferWriter)([4,4,2,2,3,1],[this.senderSsrc,this.mediaSourceSsrc,this.baseSequenceNumber,this.packetStatusCount,this.referenceTime,this.fbPktCount]),t=Buffer.concat(this.packetChunks.map((e=>e.serialize()))),r=Buffer.concat(this.recvDeltas.map((e=>{try{return e.serialize()}catch(e){return void i(e?.message)}})).filter((e=>e))),n=Buffer.concat([e,t,r]);if(this.header.padding&&n.length%4!=0){const e=4-n.length%4,t=Buffer.alloc(e);return t[t.length-1]=t.length,this.header.length=Math.floor((n.length+t.length)/4),Buffer.concat([this.header.serialize(),n,t])}return this.header.length=Math.floor(n.length/4),Buffer.concat([this.header.serialize(),n])}get packetResults(){const e=this.baseSequenceNumber-1,t=this.packetChunks.filter((e=>e instanceof a)).flatMap((t=>t.results(e)));let r=0;let s=64n*BigInt(this.referenceTime);for(const e of t){const t=this.recvDeltas[r];e.received&&t&&(s+=BigInt(t.delta)/1000n,e.delta=t.delta,e.receivedAtMs=Number(s),r++)}return t}}t.TransportWideCC=o,o.count=15;class a{constructor(e={}){Object.assign(this,e),this.type=l.TypeTCCRunLengthChunk}static deSerialize(e){const t=(0,s.getBit)(e[0],1,2),r=((0,s.getBit)(e[0],3,5)<<8)+e[1];return new a({type:0,packetStatus:t,runLength:r})}serialize(){return new s.BitWriter2(16).set(0).set(this.packetStatus,2).set(this.runLength,13).buffer}results(e){const t=this.packetStatus===d.TypeTCCPacketReceivedSmallDelta||this.packetStatus===d.TypeTCCPacketReceivedLargeDelta,r=[];for(let s=0;s<=this.runLength;++s)r.push(new h({sequenceNumber:++e,received:t}));return r}}t.RunLengthChunk=a;class c{constructor(e={}){this.symbolList=[],Object.assign(this,e)}static deSerialize(e){const t=l.TypeTCCStatusVectorChunk;let r=(0,s.getBit)(e[0],1,1);const n=[];function i(e,t){for(let r=0;r<e;r++)t(r)}switch(r){case 0:i(6,(t=>n.push((0,s.getBit)(e[0],2+t,1)))),i(8,(t=>n.push((0,s.getBit)(e[1],t,1))));break;case 1:i(3,(t=>n.push((0,s.getBit)(e[0],2+2*t,2)))),i(4,(t=>n.push((0,s.getBit)(e[1],2*t,2))));break;default:r=((0,s.getBit)(e[0],2,6)<<8)+e[1]}return new c({type:t,symbolSize:r,symbolList:n})}serialize(){const e=Buffer.alloc(2),t=new s.BitWriter2(16).set(1).set(this.symbolSize),r=0===this.symbolSize?1:2;return this.symbolList.forEach((e=>{t.set(e,r)})),e.writeUInt16BE(t.value),e}}t.StatusVectorChunk=c;class u{constructor(e={}){this.parsed=!1,Object.assign(this,e)}static deSerialize(e){let t,r;if(1===e.length?(t=d.TypeTCCPacketReceivedSmallDelta,r=250*e[0]):2===e.length&&(t=d.TypeTCCPacketReceivedLargeDelta,r=250*e.readInt16BE()),void 0===t||void 0===r)throw new Error;return new u({type:t,delta:r})}deSerialize(e){const t=u.deSerialize(e);this.delta=t.delta}parseDelta(){this.delta=Math.floor(this.delta/250),this.delta<0||this.delta>255?(this.delta>32767&&(this.delta=32767),this.delta<-32768&&(this.delta=-32768),this.type||(this.type=d.TypeTCCPacketReceivedLargeDelta)):this.type||(this.type=d.TypeTCCPacketReceivedSmallDelta),this.parsed=!0}serialize(){if(this.parsed||this.parseDelta(),this.type===d.TypeTCCPacketReceivedSmallDelta){const e=Buffer.alloc(1);return e.writeUInt8(this.delta),e}if(this.type===d.TypeTCCPacketReceivedLargeDelta){const e=Buffer.alloc(2);return e.writeInt16BE(this.delta),e}throw new Error("errDeltaExceedLimit "+this.delta+" "+this.type)}}var l,d;t.RecvDelta=u,function(e){e[e.TypeTCCRunLengthChunk=0]="TypeTCCRunLengthChunk",e[e.TypeTCCStatusVectorChunk=1]="TypeTCCStatusVectorChunk",e[e.packetStatusChunkLength=2]="packetStatusChunkLength"}(l||(t.PacketChunk=l={})),function(e){e[e.TypeTCCPacketNotReceived=0]="TypeTCCPacketNotReceived",e[e.TypeTCCPacketReceivedSmallDelta=1]="TypeTCCPacketReceivedSmallDelta",e[e.TypeTCCPacketReceivedLargeDelta=2]="TypeTCCPacketReceivedLargeDelta",e[e.TypeTCCPacketReceivedWithoutDelta=3]="TypeTCCPacketReceivedWithoutDelta"}(d||(t.PacketStatus=d={}));class h{constructor(e){this.sequenceNumber=0,this.delta=0,this.received=!1,this.receivedAtMs=0,Object.assign(this,e)}}t.PacketResult=h},2334:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SidebandBufferSerializer=t.BufferSerializer=void 0;class r{serialize(e){return console.warn("Using slow buffer serialization. Ensure the peer supports SidebandBufferSerializer."),e.toString("base64")}deserialize(e){return console.warn("Using slow buffer deserialization. Ensure the peer supports SidebandBufferSerializer."),Buffer.from(e,"base64")}}t.BufferSerializer=r;t.SidebandBufferSerializer=class{constructor(){this.bufferSerializer=new r}serialize(e,t){if(!t)return this.bufferSerializer.serialize(e);const r=t.buffers=t.buffers||[];return r.push(e),r.length-1}deserialize(e,t){if(!t?.buffers)return this.bufferSerializer.deserialize(e);return t.buffers[e]}}},2335:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createService=function(e,t){let r,s,i=!1;return{getResult(){if(i)throw new Error("service terminated");return r||(s=n.default.fork(e),s.worker.on("exit",(()=>r=void 0)),r=t(s.result),r.catch((()=>{r=void 0})),r)},terminate(){i||(i=!0,s.worker.terminate(),s=void 0,r=void 0)}}},t.createZygote=function(e){let t=n.default.fork(e);const r=function*(){for(;;){const r=t;t=n.default.fork(e),yield r}}();return()=>{const e=r.next();if(e.done||!e.value)throw new Error("Zygote exhausted");return e.value}},t.createZygoteWorkQueue=function(e=o.default.cpus().length>>1){const t=(0,i.createAsyncQueue)();let r=0;return async s=>{const i=t.take();if(i)return i(s);if(e&&r<e){let e=!1;const s=new AbortController;s.signal.addEventListener("abort",(()=>{}));const i=n.default.fork();let o;r++,i.worker.on("exit",(()=>{r--,e=!0,s.abort()}));const a=()=>{clearTimeout(o),o=setTimeout((()=>{1!==r&&i.worker.terminate()}),3e4),t.submit((async t=>{clearTimeout(o);try{return await t(i)}finally{e||a()}}),s.signal)};a()}return(await t.dequeue())(s)}};const n=s(r(2743)),i=r(5597),o=s(r(857))},2372:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Transaction=void 0;const s=r(2261),n=r(2325),i=r(4687),o=(0,s.debug)("werift-ice:packages/ice/src/stun/transaction.ts");t.Transaction=class{constructor(e,t,r,a){this.request=e,this.addr=t,this.protocol=r,this.retransmissions=a,this.timeoutDelay=i.RETRY_RTO,this.ended=!1,this.tries=0,this.onResponse=new s.Event,this.responseReceived=(e,t)=>{this.onResponse.length>0&&(e.messageClass===i.classes.RESPONSE?(this.onResponse.execute(e,t),this.onResponse.complete()):this.onResponse.error(new n.TransactionFailed(e,t)))},this.run=async()=>{try{this.retry().catch((e=>{o("retry failed",e)}));return await this.onResponse.asPromise()}catch(e){throw e}finally{this.cancel()}},this.retry=async()=>{for(;this.tries<this.triesMax&&!this.ended&&(this.protocol.sendStun(this.request,this.addr).catch((e=>{o("send stun failed",e)})),await new Promise((e=>setTimeout(e,this.timeoutDelay))),!this.ended);)this.timeoutDelay*=2,this.tries++;this.tries>=this.triesMax&&(o(`retry failed times:${this.tries} maxLimit:${this.triesMax}`),this.onResponse.error(new n.TransactionTimeout))},this.triesMax=1+(this.retransmissions?this.retransmissions:i.RETRY_MAX)}cancel(){this.ended=!0}}},2499:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CertificateVerify=void 0;const s=r(6353),n=r(7077),i=r(9602);class o{constructor(e,t){this.algorithm=e,this.signature=t,this.msgType=i.HandshakeType.certificate_verify_15}static createEmpty(){return new o(void 0,void 0)}static deSerialize(e){const t=(0,s.decode)(e,o.spec);return new o(...Object.values(t))}serialize(){const e=(0,s.encode)(this,o.spec).slice();return Buffer.from(e)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.CertificateVerify=o,o.spec={algorithm:s.types.uint16be,signature:s.types.buffer(s.types.uint16be)}},2510:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vp9RtpPayload=void 0;const s=r(9543);class n{constructor(){this.pDiff=[],this.width=[],this.height=[],this.n_g=0,this.pgT=[],this.pgU=[],this.pgP_Diff=[]}static deSerialize(e){const{p:t,offset:r}=this.parseRtpPayload(e);return t.payload=e.subarray(r),t}static parseRtpPayload(e){const t=new n;let r=0;if(t.iBit=(0,s.getBit)(e[r],0),t.pBit=(0,s.getBit)(e[r],1),t.lBit=(0,s.getBit)(e[r],2),t.fBit=(0,s.getBit)(e[r],3),t.bBit=(0,s.getBit)(e[r],4),t.eBit=(0,s.getBit)(e[r],5),t.vBit=(0,s.getBit)(e[r],6),t.zBit=(0,s.getBit)(e[r],7),r++,t.iBit)if(t.m=(0,s.getBit)(e[r],0),t.m){const n=(0,s.paddingByte)((0,s.getBit)(e[r],1,7)),i=(0,s.paddingByte)(e[r+1]);t.pictureId=Number.parseInt(n+i,2),r+=2}else t.pictureId=(0,s.getBit)(e[r],1,7),r++;if(t.lBit&&(t.tid=(0,s.getBit)(e[r],0,3),t.u=(0,s.getBit)(e[r],3),t.sid=(0,s.getBit)(e[r],4,3),t.d=(0,s.getBit)(e[r],7),r++,0===t.fBit&&(t.tl0PicIdx=e[r],r++)),t.fBit&&t.pBit)for(;;){t.pDiff=[...t.pDiff,(0,s.getBit)(e[r],0,7)];const n=(0,s.getBit)(e[r],7);if(r++,0===n)break}return t.vBit&&(t.n_s=(0,s.getBit)(e[r],0,3),t.y=(0,s.getBit)(e[r],3),t.g=(0,s.getBit)(e[r],4),r++,t.y&&[...Array(t.n_s+1)].forEach((()=>{t.width.push(e.readUInt16BE(r)),r+=2,t.height.push(e.readUInt16BE(r)),r+=2})),t.g&&(t.n_g=e[r],r++),t.n_g>0&&[...Array(t.n_g).keys()].forEach((n=>{t.pgT.push((0,s.getBit)(e[r],0,3)),t.pgU.push((0,s.getBit)(e[r],3));const i=(0,s.getBit)(e[r],4,2);r++,t.pgP_Diff[n]=[],i>0&&[...Array(i)].forEach((()=>{t.pgP_Diff[n].push(e[r]),r++}))}))),{offset:r,p:t}}static isDetectedFinalPacketInSequence(e){return e.marker}get isKeyframe(){return!(this.pBit||!this.bBit||this.sid&&this.lBit)}get isPartitionHead(){return this.bBit&&(!this.lBit||!this.d)}}t.Vp9RtpPayload=n},2667:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Flight3=void 0;const s=r(5205),n=r(3254),i=(0,s.debug)("werift-dtls : packages/dtls/src/flight/client/flight3.ts : log");class o extends n.Flight{constructor(e,t){super(e,t,3,5)}async exec(e){if(3===this.dtls.flight)throw new Error;this.dtls.flight=3,this.dtls.handshakeCache=[];const[t]=this.dtls.lastFlight;i("dtls version",t.clientVersion),t.cookie=e.cookie,this.dtls.cookie=e.cookie;const r=this.createPacket([t]),s=Buffer.concat(r.map((e=>e.serialize())));await this.transmit([s])}}t.Flight3=o},2696:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EllipticCurves=void 0;const s=r(6353);class n{constructor(e={}){this.type=n.type,this.data=[],Object.assign(this,e)}static createEmpty(){return new n}static fromData(e){return new n({type:n.type,data:(0,s.decode)(e,n.spec.data)})}static deSerialize(e){return new n((0,s.decode)(e,n.spec))}serialize(){return Buffer.from((0,s.encode)(this,n.spec).slice())}get extension(){return{type:this.type,data:this.serialize().slice(2)}}}t.EllipticCurves=n,n.type=10,n.spec={type:s.types.uint16be,data:s.types.array(s.types.uint16be,s.types.uint16be,"bytes")}},2743:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sdk=t.MixinDeviceBase=t.ScryptedDeviceBase=void 0,n(r(9849),t);const o=i(r(9896)),a=r(9849);r(3339);class c extends a.DeviceBase{constructor(e){super(),this.nativeId=e}get storage(){return this._storage||(this._storage=t.sdk.deviceManager.getDeviceStorage(this.nativeId)),this._storage}get log(){return this._log||(this._log=t.sdk.deviceManager.getDeviceLogger(this.nativeId)),this._log}get console(){return this._console||(this._console=t.sdk.deviceManager.getDeviceConsole(this.nativeId)),this._console}async createMediaObject(e,r){return t.sdk.mediaManager.createMediaObject(e,r,{sourceId:this.id})}getMediaObjectConsole(e){return"string"!=typeof e.sourceId?this.console:t.sdk.deviceManager.getMixinConsole(e.sourceId,this.nativeId)}_lazyLoadDeviceState(){this._deviceState||(this.nativeId?this._deviceState=t.sdk.deviceManager.getDeviceState(this.nativeId):this._deviceState=t.sdk.deviceManager.getDeviceState())}onDeviceEvent(e,r){return t.sdk.deviceManager.onDeviceEvent(this.nativeId,e,r)}}t.ScryptedDeviceBase=c;class u extends a.DeviceBase{constructor(e){super(),this._listeners=new Set,this.mixinDevice=e.mixinDevice,this.mixinDeviceInterfaces=e.mixinDeviceInterfaces,this.mixinStorageSuffix=e.mixinStorageSuffix,this._deviceState=e.mixinDeviceState,this.nativeId=t.sdk.systemManager.getDeviceById(this.id).nativeId,this.mixinProviderNativeId=e.mixinProviderNativeId,this._deviceState.__rpcproxy_traps_all_properties&&"string"==typeof this._deviceState.id&&(this._deviceState=t.sdk.deviceManager.createDeviceState(this._deviceState.id,this._deviceState.setState))}get storage(){if(!this._storage){const e=this.mixinStorageSuffix,r=this.id+(e?":"+e:"");this._storage=t.sdk.deviceManager.getMixinStorage(r,this.mixinProviderNativeId)}return this._storage}get console(){return this._console||(t.sdk.deviceManager.getMixinConsole?this._console=t.sdk.deviceManager.getMixinConsole(this.id,this.mixinProviderNativeId):this._console=t.sdk.deviceManager.getDeviceConsole(this.mixinProviderNativeId)),this._console}async createMediaObject(e,r){return t.sdk.mediaManager.createMediaObject(e,r,{sourceId:this.id})}getMediaObjectConsole(e){return"string"!=typeof e.sourceId?this.console:t.sdk.deviceManager.getMixinConsole(e.sourceId,this.mixinProviderNativeId)}onDeviceEvent(e,r){return t.sdk.deviceManager.onMixinEvent(this.id,this,e,r)}_lazyLoadDeviceState(){}manageListener(e){this._listeners.add(e)}release(){for(const e of this._listeners)e.removeListener()}}t.MixinDeviceBase=u,function(){function e(e){return function(){return this._lazyLoadDeviceState(),this._deviceState?.[e]}}function t(e){return function(t){this._lazyLoadDeviceState(),this._deviceState?this._deviceState[e]=t:console.warn("device state is unavailable. the device must be discovered with deviceManager.onDeviceDiscovered or deviceManager.onDevicesChanged before the state can be set.")}}for(const r of Object.values(a.ScryptedInterfaceProperty))r!==a.ScryptedInterfaceProperty.nativeId&&(Object.defineProperty(c.prototype,r,{set:t(r),get:e(r)}),Object.defineProperty(u.prototype,r,{set:t(r),get:e(r)}))}(),t.sdk={};try{let e=!1;try{process.env.SCRYPTED_SDK_ES_MODULE||process.env.SCRYPTED_SDK_MODULE;const s=process.env.SCRYPTED_SDK_CJS_MODULE||process.env.SCRYPTED_SDK_MODULE;if(s)if("undefined"!=typeof require){const r=require(process.env.SCRYPTED_SDK_MODULE);Object.assign(t.sdk,r.getScryptedStatic()),e=!0}else{const n=r(394)(s);Object.assign(t.sdk,n.getScryptedStatic()),e=!0}}catch(e){throw console.warn("failed to load sdk module",e),e}if(!e){let e;try{e=pluginRuntimeAPI}catch(e){}Object.assign(t.sdk,{log:deviceManager.getDeviceLogger(void 0),deviceManager,endpointManager,mediaManager,systemManager,pluginHostAPI,...e})}try{let e={...a.ScryptedInterfaceDescriptors};try{const t=JSON.parse(o.default.readFileSync("../sdk.json").toString()).interfaceDescriptors;t&&(e={...e,...t})}catch(e){console.warn("failed to load custom interface descriptors",e)}t.sdk.systemManager.setScryptedInterfaceDescriptors?.(a.TYPES_VERSION,e)?.catch((()=>{}))}catch(e){}}catch(e){console.error("sdk initialization error, import @scrypted/types or use @scrypted/client instead",e)}t.default=t.sdk},2797:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DnsLookup=t.MdnsLookup=void 0;const n=s(r(8394)),i=s(r(8167));t.MdnsLookup=class{constructor(){this.cache=new Map,this.mdnsInstance=(0,n.default)(),this.mdnsInstance.setMaxListeners(50)}lookup(e){return new Promise(((t,r)=>{const s=()=>{this.mdnsInstance.removeListener("response",i),clearTimeout(n)},n=setTimeout((()=>{s(),r(new Error("No mDNS response"))}),1e4),i=r=>{const n=r.answers?.[0];"A"===n?.type&&n.name===e&&(s(),t(n.data))};this.mdnsInstance.on("response",i),this.mdnsInstance.query(e,"A")}))}close(){this.mdnsInstance.destroy()}};t.DnsLookup=class{constructor(){this.cache=new Map;const e=`(${()=>{const e=global.require("worker_threads"),{lookup:t}=global.require("dns");e.parentPort?.on("message",(r=>{const{host:s}=r;(r=>{t(r,((t,s,n)=>{const i={err:t?.message,address:s,family:n,host:r};e.parentPort?.postMessage(i),process.exit()}))})(s)}))}})()`;this.thread=new i.default.Worker(e,{eval:!0}),this.thread.setMaxListeners(100)}async lookup(e){let t=this.cache.get(e);return t||(t=new Promise(((t,r)=>{const s=e=>r(new Error(`dns.lookup thread exited unexpectedly: ${e}`)),n=i=>{if(i.host===e){if(this.thread.removeListener("message",n),this.thread.removeListener("exit",s),!i.address)return r(new Error(i.err||"dns.lookup thread unknown error"));t(i.address)}};this.thread.on("message",n),this.thread.on("exit",s),this.thread.postMessage({host:e})})),this.cache.set(e,t),t)}close(){return this.thread.terminate()}}},2835:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHash=o,t.createCurve=function(e,t){const r=t=>(0,i.weierstrass)({...e,...o(t)});return{...r(t),create:r}};const s=r(848),n=r(1609),i=r(6518);function o(e){return{hash:e,hmac:(t,...r)=>(0,s.hmac)(e,t,(0,n.concatBytes)(...r)),randomBytes:n.randomBytes}}},2851:e=>{"use strict";e.exports=(e,t=process.argv)=>{const r=e.startsWith("-")?"":1===e.length?"-":"--",s=t.indexOf(r+e),n=t.indexOf("--");return-1!==s&&(-1===n||s<n)}},2887:(e,t,r)=>{e.exports=function(e){function t(e){let r,n,i,o=null;function a(...e){if(!a.enabled)return;const s=a,n=Number(new Date),i=n-(r||n);s.diff=i,s.prev=r,s.curr=n,r=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,n)=>{if("%%"===r)return"%";o++;const i=t.formatters[n];if("function"==typeof i){const t=e[o];r=i.call(s,t),e.splice(o,1),o--}return r})),t.formatArgs.call(s,e);(s.log||t.log).apply(s,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=s,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(n!==t.namespaces&&(n=t.namespaces,i=t.enabled(e)),i),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function s(e,r){const s=t(this.namespace+("undefined"==typeof r?":":r)+e);return s.log=this.log,s}function n(e,t){let r=0,s=0,n=-1,i=0;for(;r<e.length;)if(s<t.length&&(t[s]===e[r]||"*"===t[s]))"*"===t[s]?(n=s,i=r,s++):(r++,s++);else{if(-1===n)return!1;s=n+1,i++,r=i}for(;s<t.length&&"*"===t[s];)s++;return s===t.length}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names,...t.skips.map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").trim().replace(" ",",").split(",").filter(Boolean);for(const e of r)"-"===e[0]?t.skips.push(e.slice(1)):t.names.push(e)},t.enabled=function(e){for(const r of t.skips)if(n(e,r))return!1;for(const r of t.names)if(n(e,r))return!0;return!1},t.humanize=r(8582),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},2888:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MACHeader=void 0;const s=r(6353),n=r(3268);class i{constructor(e,t,r,s,n){this.epoch=e,this.sequenceNumber=t,this.contentType=r,this.protocolVersion=s,this.contentLen=n}static createEmpty(){return new i(void 0,void 0,void 0,void 0,void 0)}static deSerialize(e){return new i(...Object.values((0,s.decode)(e,i.spec)))}serialize(){const e=(0,s.encode)(this,i.spec).slice();return Buffer.from(e)}}t.MACHeader=i,i.spec={epoch:s.types.uint16be,sequenceNumber:s.types.uint48be,contentType:s.types.uint8,protocolVersion:n.ProtocolVersion,contentLen:s.types.uint16be}},2889:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AutoenableMixinProvider=void 0;const n=r(2743),i=s(r(2743)),{systemManager:o}=i.default;class a extends n.ScryptedDeviceBase{constructor(e,t="v4"){super(e),this.autoIncludeToken=t,this.hasEnabledMixin={};try{this.hasEnabledMixin=JSON.parse(this.storage.getItem("hasEnabledMixin"))}catch(e){this.hasEnabledMixin={}}this.pluginsComponent=o.getComponent("plugins"),o.listen((async(e,t,r)=>{t.eventInterface!==n.ScryptedInterface.ScryptedDevice||t.property||this.maybeEnableMixin(e)})),process.nextTick((()=>{for(const e of Object.keys(o.getSystemState())){const t=o.getDeviceById(e);this.maybeEnableMixin(t)}}))}async shouldEnableMixin(e){return!0}checkHasEnabledMixin(e){return this.hasEnabledMixin[e.id]===this.autoIncludeToken}shouldUnshiftMixin(e){return!1}async maybeEnableMixin(e){if(!e||e.mixins?.includes(this.id))return;if(this.checkHasEnabledMixin(e))return;if(!await this.canMixin(e.type,e.interfaces))return;if(!await this.shouldEnableMixin(e))return;this.log.i("auto enabling mixin for "+e.name);const t=(e.mixins||[]).slice();this.shouldUnshiftMixin(e)?t.unshift(this.id):t.push(this.id);const r=await this.pluginsComponent;await r.setMixins(e.id,t),this.setHasEnabledMixin(e.id)}setHasEnabledMixin(e){this.hasEnabledMixin[e]!==this.autoIncludeToken&&(this.hasEnabledMixin[e]=this.autoIncludeToken,this.storage.setItem("hasEnabledMixin",JSON.stringify(this.hasEnabledMixin)))}}t.AutoenableMixinProvider=a},2933:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ntpTime2Sec=t.RtcpSenderInfo=t.RtcpSrPacket=void 0;const s=r(9543),n=r(4221),i=r(5808);class o{constructor(e){this.ssrc=0,this.reports=[],this.type=o.type,Object.assign(this,e)}toJSON(){return{ssrc:this.ssrc,senderInfo:this.senderInfo.toJSON(),reports:this.reports.map((e=>e.toJSON()))}}serialize(){let e=Buffer.alloc(4);return e.writeUInt32BE(this.ssrc),e=Buffer.concat([e,this.senderInfo.serialize()]),e=Buffer.concat([e,...this.reports.map((e=>e.serialize()))]),n.RtcpHeader.serialize(o.type,this.reports.length,e,Math.floor(e.length/4))}static deSerialize(e,t){const r=e.readUInt32BE(),s=a.deSerialize(e.subarray(4,24));let n=24;const c=[];for(let r=0;r<t;r++)c.push(i.RtcpReceiverInfo.deSerialize(e.subarray(n,n+24))),n+=24;return new o({ssrc:r,senderInfo:s,reports:c})}}t.RtcpSrPacket=o,o.type=200;class a{constructor(e={}){Object.assign(this,e)}toJSON(){return{ntpTimestamp:(0,t.ntpTime2Sec)(this.ntpTimestamp),rtpTimestamp:this.rtpTimestamp}}serialize(){return(0,s.bufferWriter)([8,4,4,4],[this.ntpTimestamp,this.rtpTimestamp,this.packetCount,this.octetCount])}static deSerialize(e){const[t,r,n,i]=(0,s.bufferReader)(e,[8,4,4,4]);return new a({ntpTimestamp:t,rtpTimestamp:r,packetCount:n,octetCount:i})}}t.RtcpSenderInfo=a;t.ntpTime2Sec=e=>{const[t,r]=(0,s.bufferReader)((0,s.bufferWriter)([8],[e]),[4,4]);return Number(`${t}.${r}`)}},2971:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HashMD=void 0,t.setBigUint64=i,t.Chi=function(e,t,r){return e&t^~e&r},t.Maj=function(e,t,r){return e&t^e&r^t&r};const s=r(5744),n=r(1609);function i(e,t,r,s){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,s);const n=BigInt(32),i=BigInt(4294967295),o=Number(r>>n&i),a=Number(r&i),c=s?4:0,u=s?0:4;e.setUint32(t+c,o,s),e.setUint32(t+u,a,s)}class o extends n.Hash{constructor(e,t,r,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=(0,n.createView)(this.buffer)}update(e){(0,s.aexists)(this);const{view:t,buffer:r,blockLen:i}=this,o=(e=(0,n.toBytes)(e)).length;for(let s=0;s<o;){const a=Math.min(i-this.pos,o-s);if(a!==i)r.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0);else{const t=(0,n.createView)(e);for(;i<=o-s;s+=i)this.process(t,s)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,s.aexists)(this),(0,s.aoutput)(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:o,isLE:a}=this;let{pos:c}=this;t[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>o-c&&(this.process(r,0),c=0);for(let e=c;e<o;e++)t[e]=0;i(r,o-8,BigInt(8*this.length),a),this.process(r,0);const u=(0,n.createView)(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const d=l/4,h=this.get();if(d>h.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<d;e++)u.setUint32(4*e,h[e],a)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:n,destroyed:i,pos:o}=this;return e.length=s,e.pos=o,e.finished=n,e.destroyed=i,s%t&&e.buffer.set(r),e}}t.HashMD=o},2987:e=>{"use strict";e.exports=require("perf_hooks")},2989:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.safeKillFFmpeg=async function(e){if(!e)return;if(null!=e.exitCode)return;await new Promise((async t=>{e.on("exit",t);try{e.stdin.on("error",(()=>{})),e.stdin.write("q\n")}catch(e){}await(0,i.sleep)(2e3);for(const t of e.stdio)try{t?.destroy()}catch(e){}e.kill(),await(0,i.sleep)(2e3),e.kill("SIGKILL")}))},t.ffmpegLogInitialOutput=function(e,t,r,s){if(!e)return;const i=!!n.default.env.SCRYPTED_FFMPEG_NOISY||!!s?.getItem("SCRYPTED_FFMPEG_NOISY");function a(e){const s=n=>{const a=n.toString();for(const e of o)if(-1!==a.indexOf(e))return;if(!(i||r||-1===a.indexOf("frame=")&&-1===a.indexOf("size=")))return e(a),e("video/audio detected, discarding further input"),t.stdout.removeListener("data",s),void t.stderr.removeListener("data",s);e(a)};return s}t.stdout?.on("data",a(e.log)),t.stderr?.on("data",a(e.error)),t.on("exit",(()=>e.log("ffmpeg exited")))},t.safePrintFFmpegArguments=function(e,t){if(!e)return;const r=[];let s=!1;for(const e of t){try{if(s){const t=new URL(e);r.push(`${t.protocol}[REDACTED]`)}else r.push(e)}catch(t){r.push(e)}s="-i"===e}e.log(r.join(" "))};const n=s(r(932)),i=r(4610),o=["decode_slice_header error","no frame!","non-existing PPS"]},3038:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Certificate=void 0;const s=r(6353),n=r(7077),i=r(3268),o=r(9602);class a{constructor(e){this.certificateList=e,this.msgType=o.HandshakeType.certificate_11}static createEmpty(){return new a(void 0)}static deSerialize(e){return new a(...Object.values((0,s.decode)(e,a.spec)))}serialize(){const e=(0,s.encode)(this,a.spec).slice();return Buffer.from(e)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.Certificate=a,a.spec={certificateList:s.types.array(i.ASN11Cert,s.types.uint24be,"bytes")}},3049:e=>{"use strict";var t=function(e,t,r){process.nextTick((function(){e(t,r)}))};function r(){}function s(e,t){e.apply(null,t)}process.nextTick((function(e){42===e&&(t=process.nextTick)}),42),e.exports=function(e){var n=function r(i){var o=[i];function a(e){o.push(e)}function c(e){var i=arguments;for(n=function(e){return"[object Error]"===Object.prototype.toString.call(e)}(e)?r:a;o.length;)a(o.shift());function a(e){t(s,e,i)}}n=a,e(c)};return function(e){n(e||r)}}},3119:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtcpTransportLayerFeedback=void 0;const s=r(962),n=r(5392),i=r(1636),o=r(2332),a=(0,s.debug)("werift-rtp:packages/rtp/rtcp/rtpfb/index");class c{constructor(e={}){this.type=c.type,Object.assign(this,e)}serialize(){return this.feedback.serialize()}static deSerialize(e,t){let r;switch(t.count){case i.GenericNack.count:r=i.GenericNack.deSerialize(e,t);break;case o.TransportWideCC.count:r=o.TransportWideCC.deSerialize(e,t);break;default:a("unknown rtpfb packet",t.count)}return new c({feedback:r,header:t})}}t.RtcpTransportLayerFeedback=c,c.type=n.RtcpTransportLayerFeedbackType},3137:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SenderBandwidthEstimator=void 0;const s=r(5433),n=r(6252),i=r(8806),o=r(8076),a=20;t.SenderBandwidthEstimator=class{get congestionScore(){return this._congestionScore}set congestionScore(e){this._congestionScore=e,this.onCongestionScore.execute(e)}get availableBitrate(){return this._availableBitrate}set availableBitrate(e){this._availableBitrate=e,this.onAvailableBitrate.execute(e)}constructor(){this.congestion=!1,this.onAvailableBitrate=new s.Event,this.onCongestion=new s.Event,this.onCongestionScore=new s.Event,this.congestionCounter=0,this.cumulativeResult=new o.CumulativeResult,this.sentInfos={},this._congestionScore=1,this._availableBitrate=0}receiveTWCC(e){const t=(0,i.milliTime)()-this.cumulativeResult.firstPacketSentAtMs;t>1e3&&(this.cumulativeResult.reset(),this.congestionCounter<a?this.congestionCounter++:this.congestionScore<10&&this.congestionScore++,this.congestionCounter>=a&&!this.congestion&&(this.congestion=!0,this.onCongestion.execute(this.congestion)));for(const t of e.packetResults){if(!t.received)continue;const e=t.sequenceNumber,r=this.sentInfos[e];r&&(t.receivedAtMs&&this.cumulativeResult.addPacket(r.size,r.sendingAtMs,t.receivedAtMs))}if(t>=100&&this.cumulativeResult.numPackets>=20){if(this.availableBitrate=Math.min(this.cumulativeResult.sendBitrate,this.cumulativeResult.receiveBitrate),this.cumulativeResult.reset(),this.congestionCounter>-20){const e=(0,n.Int)(10)+1,t=e-(e-((0,n.Int)(5)+1))/10*this.congestionScore;this.congestionCounter=this.congestionCounter-t}this.congestionCounter<=-20&&(this.congestionScore>1&&(this.congestionScore--,this.onCongestion.execute(!1)),this.congestionCounter=0),this.congestionCounter<=0&&this.congestion&&(this.congestion=!1,this.onCongestion.execute(this.congestion))}}rtpPacketSent(e){Object.keys(e).map((e=>Number(e))).sort().filter((t=>t<e.wideSeq)).forEach((e=>{delete this.sentInfos[e]})),this.sentInfos[e.wideSeq]=e}}},3139:(e,t,r)=>{const s=t,{Buffer:n}=r(181),i=r(857);s.toBuffer=function(e,t,r){let s;if(r=~~r,this.isV4Format(e))s=t||n.alloc(r+4),e.split(/\./g).map((e=>{s[r++]=255&parseInt(e,10)}));else if(this.isV6Format(e)){const i=e.split(":",8);let o;for(o=0;o<i.length;o++){let e;this.isV4Format(i[o])&&(e=this.toBuffer(i[o]),i[o]=e.slice(0,2).toString("hex")),e&&++o<8&&i.splice(o,0,e.slice(2,4).toString("hex"))}if(""===i[0])for(;i.length<8;)i.unshift("0");else if(""===i[i.length-1])for(;i.length<8;)i.push("0");else if(i.length<8){for(o=0;o<i.length&&""!==i[o];o++);const e=[o,1];for(o=9-i.length;o>0;o--)e.push("0");i.splice(...e)}for(s=t||n.alloc(r+16),o=0;o<i.length;o++){const e=parseInt(i[o],16);s[r++]=e>>8&255,s[r++]=255&e}}if(!s)throw Error(`Invalid ip address: ${e}`);return s},s.toString=function(e,t,r){t=~~t;let s=[];if(4===(r=r||e.length-t)){for(let n=0;n<r;n++)s.push(e[t+n]);s=s.join(".")}else if(16===r){for(let n=0;n<r;n+=2)s.push(e.readUInt16BE(t+n).toString(16));s=s.join(":"),s=s.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),s=s.replace(/:{3,4}/,"::")}return s};const o=/^(\d{1,3}\.){3,3}\d{1,3}$/,a=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i;function c(e){return 4===e?"ipv4":6===e?"ipv6":e?e.toLowerCase():"ipv4"}s.isV4Format=function(e){return o.test(e)},s.isV6Format=function(e){return a.test(e)},s.fromPrefixLen=function(e,t){let r=4;"ipv6"===(t=e>32?"ipv6":c(t))&&(r=16);const i=n.alloc(r);for(let t=0,r=i.length;t<r;++t){let r=8;e<8&&(r=e),e-=r,i[t]=255&~(255>>r)}return s.toString(i)},s.mask=function(e,t){e=s.toBuffer(e),t=s.toBuffer(t);const r=n.alloc(Math.max(e.length,t.length));let i;if(e.length===t.length)for(i=0;i<e.length;i++)r[i]=e[i]&t[i];else if(4===t.length)for(i=0;i<t.length;i++)r[i]=e[e.length-4+i]&t[i];else{for(i=0;i<r.length-6;i++)r[i]=0;for(r[10]=255,r[11]=255,i=0;i<e.length;i++)r[i+12]=e[i]&t[i+12];i+=12}for(;i<r.length;i++)r[i]=0;return s.toString(r)},s.cidr=function(e){const t=e.split("/"),r=t[0];if(2!==t.length)throw new Error(`invalid CIDR subnet: ${r}`);const n=s.fromPrefixLen(parseInt(t[1],10));return s.mask(r,n)},s.subnet=function(e,t){const r=s.toLong(s.mask(e,t)),n=s.toBuffer(t);let i=0;for(let e=0;e<n.length;e++)if(255===n[e])i+=8;else{let t=255&n[e];for(;t;)t=t<<1&255,i++}const o=2**(32-i);return{networkAddress:s.fromLong(r),firstAddress:o<=2?s.fromLong(r):s.fromLong(r+1),lastAddress:o<=2?s.fromLong(r+o-1):s.fromLong(r+o-2),broadcastAddress:s.fromLong(r+o-1),subnetMask:t,subnetMaskLength:i,numHosts:o<=2?o:o-2,length:o,contains:e=>r===s.toLong(s.mask(e,t))}},s.cidrSubnet=function(e){const t=e.split("/"),r=t[0];if(2!==t.length)throw new Error(`invalid CIDR subnet: ${r}`);const n=s.fromPrefixLen(parseInt(t[1],10));return s.subnet(r,n)},s.not=function(e){const t=s.toBuffer(e);for(let e=0;e<t.length;e++)t[e]=255^t[e];return s.toString(t)},s.or=function(e,t){if(e=s.toBuffer(e),t=s.toBuffer(t),e.length===t.length){for(let r=0;r<e.length;++r)e[r]|=t[r];return s.toString(e)}let r=e,n=t;t.length>e.length&&(r=t,n=e);const i=r.length-n.length;for(let e=i;e<r.length;++e)r[e]|=n[e-i];return s.toString(r)},s.isEqual=function(e,t){if(e=s.toBuffer(e),t=s.toBuffer(t),e.length===t.length){for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}if(4===t.length){const r=t;t=e,e=r}for(let e=0;e<10;e++)if(0!==t[e])return!1;const r=t.readUInt16BE(10);if(0!==r&&65535!==r)return!1;for(let r=0;r<4;r++)if(e[r]!==t[r+12])return!1;return!0},s.isPrivate=function(e){if(s.isLoopback(e))return!0;if(!s.isV6Format(e)){const t=s.normalizeToLong(e);if(t<0)throw new Error("invalid ipv4 address");e=s.fromLong(t)}return/^(::f{4}:)?10\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?192\.168\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?172\.(1[6-9]|2\d|30|31)\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?169\.254\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^f[cd][0-9a-f]{2}:/i.test(e)||/^fe80:/i.test(e)||/^::1$/.test(e)||/^::$/.test(e)},s.isPublic=function(e){return!s.isPrivate(e)},s.isLoopback=function(e){return/\./.test(e)||/:/.test(e)||(e=s.fromLong(Number(e))),/^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})/.test(e)||/^0177\./.test(e)||/^0x7f\./i.test(e)||/^fe80::1$/i.test(e)||/^::1$/.test(e)||/^::$/.test(e)},s.loopback=function(e){if("ipv4"!==(e=c(e))&&"ipv6"!==e)throw new Error("family must be ipv4 or ipv6");return"ipv4"===e?"127.0.0.1":"fe80::1"},s.address=function(e,t){const r=i.networkInterfaces();if(t=c(t),e&&"private"!==e&&"public"!==e){const s=r[e].filter((e=>c(e.family)===t));if(0===s.length)return;return s[0].address}const n=Object.keys(r).map((n=>{const i=r[n].filter((r=>(r.family=c(r.family),r.family===t&&!s.isLoopback(r.address)&&(!e||("public"===e?s.isPrivate(r.address):s.isPublic(r.address))))));return i.length?i[0].address:void 0})).filter(Boolean);return n.length?n[0]:s.loopback(t)},s.toLong=function(e){let t=0;return e.split(".").forEach((e=>{t<<=8,t+=parseInt(e)})),t>>>0},s.fromLong=function(e){return`${e>>>24}.${e>>16&255}.${e>>8&255}.${255&e}`},s.normalizeToLong=function(e){const t=e.split(".").map((e=>e.startsWith("0x")||e.startsWith("0X")?parseInt(e,16):e.startsWith("0")&&"0"!==e&&/^[0-7]+$/.test(e)?parseInt(e,8):/^[1-9]\d*$/.test(e)||"0"===e?parseInt(e,10):NaN));if(t.some(isNaN))return-1;let r=0;switch(t.length){case 1:r=t[0];break;case 2:if(t[0]>255||t[1]>16777215)return-1;r=t[0]<<24|16777215&t[1];break;case 3:if(t[0]>255||t[1]>255||t[2]>65535)return-1;r=t[0]<<24|t[1]<<16|65535&t[2];break;case 4:if(t.some((e=>e>255)))return-1;r=t[0]<<24|t[1]<<16|t[2]<<8|t[3];break;default:return-1}return r>>>0}},3144:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let s=0,n=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(s++,"%c"===e&&(n=s))})),t.splice(n,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(2887)(t);const{formatters:s}=e.exports;s.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},3169:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.H264Repacketizer=t.NAL_TYPE_DELIMITER=t.NAL_TYPE_PPS=t.NAL_TYPE_SPS=t.NAL_TYPE_SEI=t.NAL_TYPE_IDR=t.NAL_TYPE_NON_IDR=t.NAL_TYPE_FU_A=t.NAL_TYPE_STAP_A=void 0,t.depacketizeStapA=a,t.splitH264NaluStartCode=c;const s=r(3453);t.NAL_TYPE_STAP_A=24,t.NAL_TYPE_FU_A=28,t.NAL_TYPE_NON_IDR=1,t.NAL_TYPE_IDR=5,t.NAL_TYPE_SEI=6,t.NAL_TYPE_SPS=7,t.NAL_TYPE_PPS=8,t.NAL_TYPE_DELIMITER=9;const n=1,i=2,o=n+i;function a(e){const t=[];let r,s=n;for(;s<e.length;){void 0!==r&&t.push(e.subarray(r,s));const n=e.readUInt16BE(s);s+=i,r=s,s+=n}return t.push(e.subarray(r)),t}function c(e){const t=[];let r=0,s=0;const n=()=>{const n=e.subarray(r,s);n.length&&t.push(n),s+=4,r=s};for(;s<e.length-4;){1===e.readUInt32BE(s)?n():s++}return s=e.length,n(),t}t.H264Repacketizer=class{constructor(e,t,r,n=new s.JitterBuffer(e,4)){this.console=e,this.maxPacketSize=t,this.codecInfo=r,this.jitterBuffer=n,this.extraPackets=0,this.setMaxPacketSize(t)}setMaxPacketSize(e){this.maxPacketSize=e,this.fuaMax=e-2,this.fuaMin=Math.round(.8*e)}ensureCodecInfo(){this.codecInfo||(this.codecInfo={sps:void 0,pps:void 0})}updateSps(e){this.ensureCodecInfo(),this.codecInfo.sps=e}updatePps(e){this.ensureCodecInfo(),this.codecInfo.pps=e}updateSei(e){this.ensureCodecInfo(),this.codecInfo.sei=e}shouldFilter(e){return!1}packetizeFuA(e,r,s){if((31&e[0])===t.NAL_TYPE_FU_A){const t=224&e[0],n=31&e[1],i=!!(128&e[1]),o=!!(64&e[1]),a=!i&&!o,c=Buffer.from([t|n]);e=Buffer.concat([c,e.subarray(2)]),i?s=!0:o?r=!0:a&&(r=!0,s=!0)}const i=224&e[0],o=31&e[0],a=i|t.NAL_TYPE_FU_A,c=Buffer.from([a,o]),u=r?c:Buffer.from([a,128|o]),l=s?c:Buffer.from([a,64|o]);let d=u;const h=[];let p=n;for(;p<e.length;){let t;const r=Math.min(this.fuaMax,e.length-p);t=e.subarray(p,p+r),p+=r,p===e.length&&(d=l),h.push(Buffer.concat([d,t])),d=c}return h}packetizeOneStapA(e){const r=[];if(!e.length)throw new Error("packetizeOneStapA requires at least one NAL");let s=0,n=this.maxPacketSize-o;const a=t.NAL_TYPE_STAP_A;for(;e.length&&e[0].length+i<=n&&s<9;){const t=e.shift();n-=i+t.length,s+=1;const o=Buffer.alloc(2);o.writeUInt16BE(t.length,0),r.push(o,t)}return 0===s?e.shift():1===s?r[1]:(r.unshift(Buffer.from([a])),Buffer.concat(r))}packetizeStapA(e){const t=[];for(;e.length;){const r=this.packetizeOneStapA(e);if(r.length<this.maxPacketSize){t.push(r);continue}const s=this.packetizeFuA(r);t.push(...s)}return t}createPacket(e,t,r){const s=e.clone();return s.header.sequenceNumber=(e.header.sequenceNumber+this.extraPackets+65536)%65536,s.header.marker=r,s.header.padding=!1,s.payload=t,t.length>this.maxPacketSize&&this.console.warn("packet exceeded max packet size. this may a bug."),s}flushPendingFuA(e){if(!this.pendingFuA)return;const r=this.pendingFuA[0],s=this.pendingFuA[this.pendingFuA.length-1],n=31&r.payload[1],i=!!(128&r.payload[1]),o=!!(64&s.payload[1]),a=224&r.payload[0],u=Buffer.from([a|n]),l=()=>{const e=this.pendingFuA.map((e=>e.payload.subarray(2)));e.unshift(u);return Buffer.concat(e)};if(n===t.NAL_TYPE_SPS){const n=c(l());for(;n.length;){const a=n.shift(),c=31&a[0];c===t.NAL_TYPE_SPS?this.updateSps(a):c===t.NAL_TYPE_PPS?this.updatePps(a):(c===t.NAL_TYPE_IDR&&this.maybeSendStapACodecInfo(r,e),this.fragment(r,e,{payload:a,noStart:!i,noEnd:!o,marker:s.header.marker}))}}else{for(;this.pendingFuA.length;){const t=this.pendingFuA[0];if(t.payload.length>this.maxPacketSize||t.payload.length<this.fuaMin)break;this.pendingFuA.shift(),e.push(this.createPacket(t,t.payload,t.header.marker))}if(!this.pendingFuA.length)return void(this.pendingFuA=void 0);const t=this.pendingFuA[0],r=this.pendingFuA[this.pendingFuA.length-1],s=!!(128&t.payload[1]),n=!!(64&r.payload[1]),i=l();this.fragment(t,e,{payload:i,noStart:!s,noEnd:!n,marker:r.header.marker})}this.extraPackets-=this.pendingFuA.length-1,this.pendingFuA=void 0}createRtpPackets(e,t,r,s=e.header.marker){t.forEach(((n,i)=>{0!==i&&this.extraPackets++;const o=s&&i===t.length-1;r.push(this.createPacket(e,n,o))}))}maybeSendStapACodecInfo(e,t){if(this.stapa)return void(this.stapa=void 0);if(!this.codecInfo?.sps||!this.codecInfo?.pps)return;const r=[this.codecInfo.sps,this.codecInfo.pps];this.codecInfo?.sei&&r.push(this.codecInfo.sei);const s=this.packetizeStapA(r);1===s.length?(this.createRtpPackets(e,s,t,!1),this.extraPackets++):this.console.error("expected only 1 packet for sps/pps stapa")}fragment(e,t,r={payload:e.payload,noStart:!1,noEnd:!1,marker:e.header.marker}){const{payload:s,noStart:n,noEnd:i,marker:o}=r;if(s.length>this.maxPacketSize||n||i){const r=this.packetizeFuA(s,n,i);this.createRtpPackets(e,r,t,o)}else t.push(this.createPacket(e,s,o))}repacketize(e){const t=[];for(const r of this.jitterBuffer.queue(e))this.repacketizeOne(r,t);return t}repacketizeOne(e,r){if(!e.payload.length)return this.flushPendingFuA(r),void this.extraPackets--;const i=31&e.payload[0];if(this.pendingFuA&&this.pendingFuA[0].header.timestamp!==e.header.timestamp&&this.flushPendingFuA(r),i===t.NAL_TYPE_FU_A){const i=e.payload,o=31&i[1];if(this.shouldFilter(o))return void this.extraPackets--;const a=!!(128&i[1]),c=!!(64&e.payload[1]);if(a)this.pendingFuA&&this.console.error("fua restarted. skipping refragmentation of previous fua.",o),this.pendingFuA=void 0,o===t.NAL_TYPE_IDR&&this.maybeSendStapACodecInfo(e,r);else if(this.pendingFuA){const t=this.pendingFuA[this.pendingFuA.length-1];if(!(0,s.isNextSequenceNumber)(t.header.sequenceNumber,e.header.sequenceNumber))return void this.console.error("fua packet missing. skipping refragmentation.",o)}if(this.pendingFuA||(this.pendingFuA=[]),this.pendingFuA.push(e),c)this.flushPendingFuA(r);else if(this.pendingFuA.reduce(((e,t)=>e+t.payload.length-2),n)>this.maxPacketSize){const e=this.pendingFuA[this.pendingFuA.length-1].clone(),t=[];this.flushPendingFuA(t);const s=t.pop();e.payload=s.payload,this.pendingFuA=[e],r.push(...t)}}else if(i===t.NAL_TYPE_STAP_A){this.flushPendingFuA(r);let s=!1,n=!1;const i=a(e.payload);i.forEach((e=>{const r=31&e[0];r===t.NAL_TYPE_SPS?(s=!0,this.updateSps(e)):r===t.NAL_TYPE_PPS?(n=!0,this.updatePps(e)):r===t.NAL_TYPE_SEI?this.updateSei(e):r===t.NAL_TYPE_DELIMITER||r===t.NAL_TYPE_NON_IDR||r===t.NAL_TYPE_IDR||0===r||this.console.warn("Skipped a stapa type.",r)})),s&&n&&(this.stapa=e);const o=this.packetizeStapA(i);this.createRtpPackets(e,o,r)}else if(i>=1&&i<24){if(this.flushPendingFuA(r),this.shouldFilter(i))return void this.extraPackets--;if(i===t.NAL_TYPE_SPS)return this.extraPackets--,void this.updateSps(e.payload);if(i===t.NAL_TYPE_PPS)return this.extraPackets--,void this.updatePps(e.payload);if(i===t.NAL_TYPE_SEI)return this.extraPackets--,void this.updateSei(e.payload);if(this.shouldFilter(i))return void this.extraPackets--;i===t.NAL_TYPE_IDR&&this.maybeSendStapACodecInfo(e,r),this.fragment(e,r)}else this.console.error("unknown nal unit type "+i),this.extraPackets--}}},3170:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.expand_message_xmd=u,t.expand_message_xof=l,t.hash_to_field=d,t.isogenyMap=function(e,t){const r=t.map((e=>Array.from(e).reverse()));return(t,s)=>{const[n,i,o,a]=r.map((r=>r.reduce(((r,s)=>e.add(e.mul(r,t),s)))));return t=e.div(n,i),s=e.mul(s,e.div(o,a)),{x:t,y:s}}},t.createHasher=function(e,t,r){if("function"!=typeof t)throw new Error("mapToCurve() must be defined");return{hashToCurve(s,n){const i=d(s,2,{...r,DST:r.DST,...n}),o=e.fromAffine(t(i[0])),a=e.fromAffine(t(i[1])),c=o.add(a).clearCofactor();return c.assertValidity(),c},encodeToCurve(s,n){const i=d(s,1,{...r,DST:r.encodeDST,...n}),o=e.fromAffine(t(i[0])).clearCofactor();return o.assertValidity(),o},mapToCurve(r){if(!Array.isArray(r))throw new Error("mapToCurve: expected array of bigints");for(const e of r)if("bigint"!=typeof e)throw new Error("mapToCurve: expected array of bigints");const s=e.fromAffine(t(r)).clearCofactor();return s.assertValidity(),s}}};const s=r(5720),n=r(3939),i=n.bytesToNumberBE;function o(e,t){if(c(e),c(t),e<0||e>=1<<8*t)throw new Error("invalid I2OSP input: "+e);const r=Array.from({length:t}).fill(0);for(let s=t-1;s>=0;s--)r[s]=255&e,e>>>=8;return new Uint8Array(r)}function a(e,t){const r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e[s]^t[s];return r}function c(e){if(!Number.isSafeInteger(e))throw new Error("number expected")}function u(e,t,r,s){(0,n.abytes)(e),(0,n.abytes)(t),c(r),t.length>255&&(t=s((0,n.concatBytes)((0,n.utf8ToBytes)("H2C-OVERSIZE-DST-"),t)));const{outputLen:i,blockLen:u}=s,l=Math.ceil(r/i);if(r>65535||l>255)throw new Error("expand_message_xmd: invalid lenInBytes");const d=(0,n.concatBytes)(t,o(t.length,1)),h=o(0,u),p=o(r,2),f=new Array(l),g=s((0,n.concatBytes)(h,e,p,o(0,1),d));f[0]=s((0,n.concatBytes)(g,o(1,1),d));for(let e=1;e<=l;e++){const t=[a(g,f[e-1]),o(e+1,1),d];f[e]=s((0,n.concatBytes)(...t))}return(0,n.concatBytes)(...f).slice(0,r)}function l(e,t,r,s,i){if((0,n.abytes)(e),(0,n.abytes)(t),c(r),t.length>255){const e=Math.ceil(2*s/8);t=i.create({dkLen:e}).update((0,n.utf8ToBytes)("H2C-OVERSIZE-DST-")).update(t).digest()}if(r>65535||t.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return i.create({dkLen:r}).update(e).update(o(r,2)).update(t).update(o(t.length,1)).digest()}function d(e,t,r){(0,n.validateObject)(r,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:o,k:a,m:d,hash:h,expand:p,DST:f}=r;(0,n.abytes)(e),c(t);const g="string"==typeof f?(0,n.utf8ToBytes)(f):f,m=o.toString(2).length,y=Math.ceil((m+a)/8),b=t*d*y;let v;if("xmd"===p)v=u(e,g,b,h);else if("xof"===p)v=l(e,g,b,a,h);else{if("_internal_pass"!==p)throw new Error('expand must be "xmd" or "xof"');v=e}const S=new Array(t);for(let e=0;e<t;e++){const t=new Array(d);for(let r=0;r<d;r++){const n=y*(r+e*d),a=v.subarray(n,n+y);t[r]=(0,s.mod)(i(a),o)}S[e]=t}return S}},3222:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Flight4=void 0;const s=r(4148),n=r(6033),i=r(6316),o=r(986),a=r(3038),c=r(6461),u=r(9133),l=r(7517),d=r(651),h=r(5205),p=r(3254),f=(0,h.debug)("werift-dtls : packages/dtls/flight/server/flight4.ts : log");class g extends p.Flight{constructor(e,t,r,s){super(e,t,4,6),this.cipher=r,this.srtp=s}async exec(e,t=!1){if(4===this.dtls.flight)return f(this.dtls.sessionId,"flight4 twice"),void this.send(this.dtls.lastMessage);this.dtls.flight=4,this.dtls.sequenceNumber=1,this.dtls.bufferHandshakeCache([e],!1,4);const r=[this.sendServerHello(),this.sendCertificate(),this.sendServerKeyExchange(),t&&this.sendCertificateRequest(),this.sendServerHelloDone()].filter((e=>e));this.dtls.lastMessage=r,await this.transmit(r)}sendServerHello(){const e=[];this.srtp.srtpProfile&&e.push(o.UseSRTP.create([this.srtp.srtpProfile],Buffer.from([0])).extension),this.dtls.options.extendedMasterSecret&&e.push({type:n.ExtendedMasterSecret.type,data:Buffer.alloc(0)});const t=i.RenegotiationIndication.createEmpty();e.push(t.extension);const r=new u.ServerHello(this.dtls.version,this.cipher.localRandom,Buffer.from([0]),this.cipher.cipherSuite,0,e),s=this.createPacket([r]);return Buffer.concat(s.map((e=>e.serialize())))}sendCertificate(){const e=new a.Certificate([Buffer.from(this.cipher.localCert)]),t=this.createPacket([e]);return Buffer.concat(t.map((e=>e.serialize())))}sendServerKeyExchange(){const e=this.cipher.generateKeySignature("sha256");if(!this.cipher.signatureHashAlgorithm)throw new Error("not exist");const t=new d.ServerKeyExchange(s.CurveType.named_curve_3,this.cipher.namedCurve,this.cipher.localKeyPair.publicKey.length,this.cipher.localKeyPair.publicKey,this.cipher.signatureHashAlgorithm.hash,this.cipher.signatureHashAlgorithm.signature,e.length,e),r=this.createPacket([t]);return Buffer.concat(r.map((e=>e.serialize())))}sendCertificateRequest(){const e=new c.ServerCertificateRequest(s.certificateTypes,s.signatures,[]);f(this.dtls.sessionId,"sendCertificateRequest",e);const t=this.createPacket([e]);return Buffer.concat(t.map((e=>e.serialize())))}sendServerHelloDone(){const e=new l.ServerHelloDone,t=this.createPacket([e]);return Buffer.concat(t.map((e=>e.serialize())))}}t.Flight4=g},3232:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(4774),t)},3254:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Flight=void 0;const s=r(6460),n=r(5205),i=r(6282),o=r(5982),a=(0,n.debug)("werift-dtls : packages/dtls/src/flight/flight.ts : warn"),c=(0,n.debug)("werift-dtls : packages/dtls/src/flight/flight.ts : err");class u{constructor(e,t,r,s){this.transport=e,this.dtls=t,this.flight=r,this.nextFlight=s,this.state="PREPARING",this.send=e=>Promise.all(e.map((e=>this.transport.send(e))))}createPacket(e){const t=(0,i.createFragments)(this.dtls)(e);this.dtls.bufferHandshakeCache(t,!0,this.flight);return(0,i.createPlaintext)(this.dtls)(t.map((e=>({type:o.ContentType.handshake,fragment:e.serialize()}))),++this.dtls.recordSequenceNumber)}async transmit(e){let t=0;for(;t<=u.RetransmitCount;t++){if(this.setState("SENDING"),this.send(e).catch((e=>{c("fail to send",c)})),this.setState("WAITING"),void 0===this.nextFlight){this.setState("FINISHED");break}if(await(0,s.setTimeout)((t+1)/2*1e3),this.dtls.flight>=this.nextFlight){this.setState("FINISHED");break}a(this.dtls.sessionId,"retransmit",t,this.dtls.flight)}if(t>u.RetransmitCount)throw c(this.dtls.sessionId,"retransmit failed",t),new Error(`over retransmitCount : ${this.flight} ${this.nextFlight}`)}setState(e){this.state=e}}t.Flight=u,u.RetransmitCount=10},3268:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProtocolVersion=t.SignatureHashAlgorithm=t.DistinguishedName=t.ClientCertificateType=t.ASN11Cert=t.ExtensionList=void 0;const s=r(6353),{uint16be:n,uint24be:i,buffer:o,array:a,uint8:c,string:u}=s.types,l={type:n,data:o(n)};t.ExtensionList=a(l,n,"bytes"),t.ASN11Cert=o(i),t.ClientCertificateType=c,t.DistinguishedName=u(n),t.SignatureHashAlgorithm={hash:c,signature:c},t.ProtocolVersion={major:c,minor:c}},3290:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=void 0;class r{constructor(){this.finished=!1,this.promise=new Promise(((e,t)=>{this.resolve=t=>(this.finished=!0,e(t),this),this.reject=e=>(this.finished=!0,t(e),this)}))}[Symbol.dispose](){this.finished||this.reject(new Error("deferred disposed without being resolved"))}async resolvePromise(e){try{this.resolve(await e)}catch(e){this.reject(e)}}}t.Deferred=r},3301:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserSignalingSession=void 0,t.waitPeerConnectionIceConnected=function(e){return new Promise(((t,r)=>{"connected"!==e.iceConnectionState?(e.addEventListener("iceconnectionstatechange",(()=>{"connected"===e.iceConnectionState&&t(void 0)})),i(e).then((e=>r(new Error(e))))):t(void 0)}))},t.waitPeerIceConnectionClosed=i,t.isPeerConnectionClosed=o,t.getPacketsLost=c,t.legacyGetSignalingSessionOptions=l,t.connectRTCSignalingClients=async function(e,t,r,s,n){const i=await l(t),o=await l(s),a=i?.disableTrickle||o?.disableTrickle;if(i?.offer&&o?.offer)throw new Error("Both RTC clients have offers and can not negotiate. Consider implementing this in @scrypted/webrtc.");if(i?.requiresOffer&&o?.requiresOffer)throw new Error("Both RTC clients require offers and can not negotiate.");r.type="offer",n.type="answer";const c=u(e,"offer",s),d=u(e,"answer",t),h=await t.createLocalDescription("offer",r,a?void 0:c.queueSendCandidate);"true"===localStorage.getItem("debugLog")&&e.log("offer sdp",h.sdp);await s.setRemoteDescription(h,n);const p=await s.createLocalDescription("answer",n,a?void 0:d.queueSendCandidate);"true"===localStorage.getItem("debugLog")&&e.log("answer sdp",p.sdp);await t.setRemoteDescription(p,r),d.flush(),c.flush()};const s=r(3290);function n(){try{return navigator.userAgent}catch(e){}}function i(e){return new Promise((t=>{e.addEventListener("iceconnectionstatechange",(()=>{o(e)&&t(e.iceConnectionState)}))}))}function o(e){return"disconnected"===e.iceConnectionState||"failed"===e.iceConnectionState||"closed"===e.iceConnectionState}function a(){return{userAgent:n(),capabilities:{audio:RTCRtpReceiver.getCapabilities?.("audio")||{codecs:void 0,headerExtensions:void 0},video:RTCRtpReceiver.getCapabilities?.("video")||{codecs:void 0,headerExtensions:void 0}},screen:{devicePixelRatio:window.devicePixelRatio,width:screen.width,height:screen.height}}}async function c(e){return[...(await e.getStats()).values()].filter((e=>"packetsLost"in e)).map((e=>e.packetsLost)).reduce(((e,t)=>e+t),0)}function u(e,t,r){let s=!1,n=[];const i=function(e,t,r){return async s=>{try{"true"===localStorage.getItem("debugLog")&&e.log(`${t} trickled candidate:`,s.sdpMLineIndex,s.candidate),await r.addIceCandidate(s)}catch(t){throw e.error("addIceCandidate error",t),t}}}(e,t,r);return{flush(){s=!0;for(const e of n)i(e);n=[]},queueSendCandidate:async e=>{s?i(e):n.push(e)}}}async function l(e){return"object"==typeof e.options?e.options:await e.getOptions()}t.BrowserSignalingSession=class{constructor(){this.pcDeferred=new s.Deferred,this.dcDeferred=new s.Deferred,this.micEnabled=!1,this.__proxy_props={options:a()},this.options=a()}async getOptions(){return this.options}async getPacketsLost(){return c(this.pc)}async setMicrophone(e){if(this.microphone&&e&&!this.micEnabled){this.micEnabled=!0;const e=await navigator.mediaDevices.getUserMedia({video:!1,audio:!0});await this.microphone.replaceTrack(e.getTracks()[0])}this.microphone?.track&&(this.microphone.track.enabled=e)}close(){this.pcDeferred.promise.then((e=>{for(const t of e.getTransceivers()||[])try{t.sender?.track?.stop?.()}catch(e){}e.close()})).catch((()=>{})),this.pcDeferred.reject(new Error("iceConnectionState "+this.pc?.iceConnectionState))}async createPeerConnection(e){if(this.pc)return;const t=this.pc=new RTCPeerConnection(e.configuration);if(this.pcDeferred.resolve(t),await(this.onPeerConnection?.(t)),t.addEventListener("iceconnectionstatechange",(()=>{console.log("iceConnectionState",t.iceConnectionState),console.log("connectionState",t.connectionState),o(t)&&this.close()})),e.datachannel){const r=t.createDataChannel(e.datachannel.label,e.datachannel.dict);r.binaryType="arraybuffer",this.dcDeferred.resolve(r)}if(e.audio){let r;r=e.getUserMediaSafariHack&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?t.addTransceiver("audio",{...e.audio,streams:[await navigator.mediaDevices.getUserMedia({audio:!0})]}):t.addTransceiver("audio",e.audio),"sendrecv"!==e.audio.direction&&"sendonly"!==e.audio.direction||(this.microphone=r.sender)}if(e.video)if("sendrecv"===e.video.direction||"sendonly"===e.video.direction)try{const e=await navigator.mediaDevices.getUserMedia({video:!0});for(const r of e.getTracks())t.addTrack(r)}catch(e){}else t.addTransceiver("video",e.video)}async createLocalDescription(e,t,r){await this.createPeerConnection(t);const s=new Promise((e=>{this.pc.onicecandidate=t=>{t.candidate?r?.(JSON.parse(JSON.stringify(t.candidate))):e(void 0)},this.pc.onicegatheringstatechange=()=>{"complete"===this.pc.iceGatheringState&&e(void 0)}})),n=e=>({type:e.type,sdp:e.sdp});if("offer"===e){let e=this.pc.localDescription;if(e)return n(this.pc.localDescription);e=await this.pc.createOffer({offerToReceiveAudio:!!t.audio,offerToReceiveVideo:!!t.video});const i=this.pc.setLocalDescription(e);return r||(await i,await s,e=this.pc.localDescription||await this.pc.createOffer({offerToReceiveAudio:!!t.audio,offerToReceiveVideo:!!t.video})),n(e)}{let e=await this.pc.createAnswer();const t=this.pc.setLocalDescription(e);return r||(await t,await s,e=this.pc.currentLocalDescription||e),n(e)}}async setRemoteDescription(e,t){await this.createPeerConnection(t),await this.pc.setRemoteDescription(e)}async addIceCandidate(e){await this.pc.addIceCandidate(e)}async endSession(){}}},3339:e=>{"use strict";e.exports=require("module")},3377:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(7823),t)},3450:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SrtcpContext=void 0;const s=r(169);class n extends s.Context{constructor(e,t,r){super(e,t,r)}encryptRTCP(e){const t=e.readUInt32BE(4),r=this.getSrtcpSsrcState(t);r.srtcpIndex++,r.srtcpIndex>>i&&(r.srtcpIndex=0);return this.cipher.encryptRTCP(e,r.srtcpIndex)}decryptRTCP(e){return this.cipher.decryptRTCP(e)}}t.SrtcpContext=n;const i=2147483647},3453:(e,t)=>{"use strict";function r(e,t){if(t===e)return 0;const r=t-e;let s;return s=t>e?e+65536-t:t+65536-e,Math.abs(r)<Math.abs(s)?r:s}function s(e,t=1){return(e+t+65536)%65536}Object.defineProperty(t,"__esModule",{value:!0}),t.JitterBuffer=void 0,t.sequenceNumberDistance=r,t.nextSequenceNumber=s,t.addRtpTimestamp=function(e,t){return Number(n&BigInt(e)+BigInt(t))},t.isNextSequenceNumber=i;const n=BigInt(4294967295);function i(e,t){return s(e)===t}t.JitterBuffer=class{constructor(e,t){this.console=e,this.jitterSize=t,this.pending=[]}flushPending(e,t){if(!this.pending)return t;const n=s(e);for(let e=0;e<this.jitterSize;e++){const s=(n+e)%this.jitterSize,i=this.pending[s];if(!i)continue;const{sequenceNumber:o}=i.header,a=r(this.lastSequenceNumber,o);a<=0?(this.console.log("jitter buffer purged packet:",o),this.pending[s]=void 0,t.push(i)):1===a&&(this.pending[s]=void 0,this.lastSequenceNumber=o,t.push(i))}return t}queue(e){if(void 0===this.lastSequenceNumber||i(this.lastSequenceNumber,e.header.sequenceNumber))return this.lastSequenceNumber=e.header.sequenceNumber,this.flushPending(this.lastSequenceNumber,[e]);const{sequenceNumber:t}=e.header,s=r(this.lastSequenceNumber,t);if(s<=0)return[];const n=[];if(s>this.jitterSize){const{lastSequenceNumber:e}=this;this.lastSequenceNumber=t-this.jitterSize,this.flushPending(e,n)}return this.pending[e.header.sequenceNumber%this.jitterSize]=e,this.flushPending(this.lastSequenceNumber,n)}}},3506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enumerate=function(e){return e.map(((e,t)=>[t,e]))},t.createEventsFromList=function(e){return e.reduce(((e,t)=>(e[t]=new s.Event,e)),{})};const s=r(4408)},3515:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.listenZeroSingleClient=t.listenZero=t.ListenZeroSingleClientTimeoutError=void 0,t.closeQuiet=o,t.bindUdp=a,t.bindZero=async function(e){return a(e,0)},t.createBindZero=c,t.createSquentialBindZero=async function(e){let t=0;for(;;){const r=await c(e);try{return[r,await u(r.port+1,e)]}catch(e){t++,o(r.server)}if(10===t)throw new Error("unable to reserve sequential udp ports")}},t.reserveUdpPort=async function(){const e=await c();return await new Promise((t=>e.server.close((()=>t(void 0))))),e.port},t.createBindUdp=u,t.bind=async function(e,t){return e.bind(t),await(0,i.once)(e,"listening"),{port:t,url:`udp://127.0.0.1:${t}`}};const n=s(r(7194)),i=r(4434);async function o(e){if(e)try{await new Promise(((t,r)=>{try{e.close(t)}catch(e){r(e)}}))}catch(e){}}async function a(e,t,r){e.bind(t,r),await(0,i.once)(e,"listening");const s=e.address().port;return{port:s,url:`udp://127.0.0.1:${s}`}}async function c(e){return u(0,e)}async function u(e,t){const r=n.default.createSocket(t||"udp4"),{port:s,url:i}=await a(r,e);return{server:r,port:s,url:i}}var l=r(8649);Object.defineProperty(t,"ListenZeroSingleClientTimeoutError",{enumerable:!0,get:function(){return l.ListenZeroSingleClientTimeoutError}}),Object.defineProperty(t,"listenZero",{enumerable:!0,get:function(){return l.listenZero}}),Object.defineProperty(t,"listenZeroSingleClient",{enumerable:!0,get:function(){return l.listenZeroSingleClient}})},3535:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaStream=t.MediaStreamTrack=void 0;const s=r(6982),n=r(5433),i=r(8655),o=r(6252);class a extends i.EventTarget{constructor(e){super(),this.uuid=(0,s.randomUUID)().toString(),this.remote=!1,this.enabled=!0,this.onReceiveRtp=new n.Event,this.onReceiveRtcp=new n.Event,this.onSourceChanged=new n.Event,this.stopped=!1,this.muted=!0,this.stop=()=>{this.stopped=!0,this.muted=!0,this.onReceiveRtp.complete(),this.emit("ended")},this.writeRtp=e=>{if(this.remote)throw new Error("this is remoteTrack");if(this.stopped)return;const t=Buffer.isBuffer(e)?o.RtpPacket.deSerialize(e):e;t.header.payloadType=this.codec?.payloadType??t.header.payloadType,this.onReceiveRtp.execute(t)},Object.assign(this,e),this.onReceiveRtp.subscribe((e=>{this.muted=!1,this.header=e.header})),this.label=`${this.remote?"remote":"local"} ${this.kind}`}}t.MediaStreamTrack=a;t.MediaStream=class{constructor(e){this.tracks=[],Array.isArray(e)?this.tracks=e:Object.assign(this,e),this.id??=(0,s.randomUUID)().toString()}addTrack(e){e.streamId=this.id,this.tracks.push(e)}getTracks(){return this.tracks}getAudioTracks(){return this.tracks.filter((e=>"audio"===e.kind))}getVideoTracks(){return this.tracks.filter((e=>"video"===e.kind))}}},3537:()=>{var e;!function(e){!function(){var t="object"==typeof globalThis?globalThis:"object"==typeof global?global:"object"==typeof self?self:"object"==typeof this?this:function(){try{return Function("return this;")()}catch(e){}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch(e){}}(),r=s(e);function s(e,t){return function(r,s){Object.defineProperty(e,r,{configurable:!0,writable:!0,value:s}),t&&t(r,s)}}"undefined"!=typeof t.Reflect&&(r=s(t.Reflect,r)),function(e,t){var r=Object.prototype.hasOwnProperty,s="function"==typeof Symbol,n=s&&"undefined"!=typeof Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=s&&"undefined"!=typeof Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,c=!o&&!a,u={create:o?function(){return de(Object.create(null))}:a?function(){return de({__proto__:null})}:function(){return de({})},has:c?function(e,t){return r.call(e,t)}:function(e,t){return t in e},get:c?function(e,t){return r.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},l=Object.getPrototypeOf(Function),d="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:ce(),h="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:ue(),p="function"==typeof WeakMap?WeakMap:le(),f=s?Symbol.for("@reflect-metadata:registry"):void 0,g=ne(),m=ie(g);function y(e,t,r,s){if(M(r)){if(!$(e))throw new TypeError;if(!G(t))throw new TypeError;return A(e,t)}if(!$(e))throw new TypeError;if(!H(t))throw new TypeError;if(!H(s)&&!M(s)&&!U(s))throw new TypeError;return U(s)&&(s=void 0),R(e,t,r=K(r),s)}function b(e,t){function r(r,s){if(!H(r))throw new TypeError;if(!M(s)&&!Y(s))throw new TypeError;x(e,t,r,s)}return r}function v(e,t,r,s){if(!H(r))throw new TypeError;return M(s)||(s=K(s)),x(e,t,r,s)}function S(e,t,r){if(!H(t))throw new TypeError;return M(r)||(r=K(r)),P(e,t,r)}function w(e,t,r){if(!H(t))throw new TypeError;return M(r)||(r=K(r)),k(e,t,r)}function E(e,t,r){if(!H(t))throw new TypeError;return M(r)||(r=K(r)),B(e,t,r)}function C(e,t,r){if(!H(t))throw new TypeError;return M(r)||(r=K(r)),O(e,t,r)}function T(e,t){if(!H(e))throw new TypeError;return M(t)||(t=K(t)),N(e,t)}function I(e,t){if(!H(e))throw new TypeError;return M(t)||(t=K(t)),D(e,t)}function _(e,t,r){if(!H(t))throw new TypeError;if(M(r)||(r=K(r)),!H(t))throw new TypeError;M(r)||(r=K(r));var s=ae(t,r,!1);return!M(s)&&s.OrdinaryDeleteMetadata(e,t,r)}function A(e,t){for(var r=e.length-1;r>=0;--r){var s=(0,e[r])(t);if(!M(s)&&!U(s)){if(!G(s))throw new TypeError;t=s}}return t}function R(e,t,r,s){for(var n=e.length-1;n>=0;--n){var i=(0,e[n])(t,r,s);if(!M(i)&&!U(i)){if(!H(i))throw new TypeError;s=i}}return s}function P(e,t,r){if(k(e,t,r))return!0;var s=re(t);return!U(s)&&P(e,s,r)}function k(e,t,r){var s=ae(t,r,!1);return!M(s)&&V(s.OrdinaryHasOwnMetadata(e,t,r))}function B(e,t,r){if(k(e,t,r))return O(e,t,r);var s=re(t);return U(s)?void 0:B(e,s,r)}function O(e,t,r){var s=ae(t,r,!1);if(!M(s))return s.OrdinaryGetOwnMetadata(e,t,r)}function x(e,t,r,s){ae(r,s,!0).OrdinaryDefineOwnMetadata(e,t,r,s)}function N(e,t){var r=D(e,t),s=re(e);if(null===s)return r;var n=N(s,t);if(n.length<=0)return r;if(r.length<=0)return n;for(var i=new h,o=[],a=0,c=r;a<c.length;a++){var u=c[a];i.has(u)||(i.add(u),o.push(u))}for(var l=0,d=n;l<d.length;l++){u=d[l];i.has(u)||(i.add(u),o.push(u))}return o}function D(e,t){var r=ae(e,t,!1);return r?r.OrdinaryOwnMetadataKeys(e,t):[]}function L(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function M(e){return void 0===e}function U(e){return null===e}function j(e){return"symbol"==typeof e}function H(e){return"object"==typeof e?null!==e:"function"==typeof e}function F(e,t){switch(L(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var r=3===t?"string":5===t?"number":"default",s=J(e,n);if(void 0!==s){var i=s.call(e,r);if(H(i))throw new TypeError;return i}return z(e,"default"===r?"number":r)}function z(e,t){if("string"===t){var r=e.toString;if(W(r))if(!H(n=r.call(e)))return n;if(W(s=e.valueOf))if(!H(n=s.call(e)))return n}else{var s;if(W(s=e.valueOf))if(!H(n=s.call(e)))return n;var n,i=e.toString;if(W(i))if(!H(n=i.call(e)))return n}throw new TypeError}function V(e){return!!e}function q(e){return""+e}function K(e){var t=F(e,3);return j(t)?t:q(t)}function $(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function W(e){return"function"==typeof e}function G(e){return"function"==typeof e}function Y(e){switch(L(e)){case 3:case 4:return!0;default:return!1}}function X(e,t){return e===t||e!=e&&t!=t}function J(e,t){var r=e[t];if(null!=r){if(!W(r))throw new TypeError;return r}}function Q(e){var t=J(e,i);if(!W(t))throw new TypeError;var r=t.call(e);if(!H(r))throw new TypeError;return r}function Z(e){return e.value}function ee(e){var t=e.next();return!t.done&&t}function te(e){var t=e.return;t&&t.call(e)}function re(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===l)return t;if(t!==l)return t;var r=e.prototype,s=r&&Object.getPrototypeOf(r);if(null==s||s===Object.prototype)return t;var n=s.constructor;return"function"!=typeof n||n===e?t:n}function se(){var e,r,s,n;M(f)||"undefined"==typeof t.Reflect||f in t.Reflect||"function"!=typeof t.Reflect.defineMetadata||(e=oe(t.Reflect));var i=new p,o={registerProvider:a,getProvider:u,setProvider:g};return o;function a(t){if(!Object.isExtensible(o))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===t:break;case M(r):r=t;break;case r===t:break;case M(s):s=t;break;case s===t:break;default:void 0===n&&(n=new h),n.add(t)}}function c(t,i){if(!M(r)){if(r.isProviderFor(t,i))return r;if(!M(s)){if(s.isProviderFor(t,i))return r;if(!M(n))for(var o=Q(n);;){var a=ee(o);if(!a)return;var c=Z(a);if(c.isProviderFor(t,i))return te(o),c}}}if(!M(e)&&e.isProviderFor(t,i))return e}function u(e,t){var r,s=i.get(e);return M(s)||(r=s.get(t)),M(r)?(M(r=c(e,t))||(M(s)&&(s=new d,i.set(e,s)),s.set(t,r)),r):r}function l(e){if(M(e))throw new TypeError;return r===e||s===e||!M(n)&&n.has(e)}function g(e,t,r){if(!l(r))throw new Error("Metadata provider not registered.");var s=u(e,t);if(s!==r){if(!M(s))return!1;var n=i.get(e);M(n)&&(n=new d,i.set(e,n)),n.set(t,r)}return!0}}function ne(){var e;return!M(f)&&H(t.Reflect)&&Object.isExtensible(t.Reflect)&&(e=t.Reflect[f]),M(e)&&(e=se()),!M(f)&&H(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,f,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function ie(e){var t=new p,r={isProviderFor:function(e,r){var s=t.get(e);return!M(s)&&s.has(r)},OrdinaryDefineOwnMetadata:o,OrdinaryHasOwnMetadata:n,OrdinaryGetOwnMetadata:i,OrdinaryOwnMetadataKeys:a,OrdinaryDeleteMetadata:c};return g.registerProvider(r),r;function s(s,n,i){var o=t.get(s),a=!1;if(M(o)){if(!i)return;o=new d,t.set(s,o),a=!0}var c=o.get(n);if(M(c)){if(!i)return;if(c=new d,o.set(n,c),!e.setProvider(s,n,r))throw o.delete(n),a&&t.delete(s),new Error("Wrong provider for target.")}return c}function n(e,t,r){var n=s(t,r,!1);return!M(n)&&V(n.has(e))}function i(e,t,r){var n=s(t,r,!1);if(!M(n))return n.get(e)}function o(e,t,r,n){s(r,n,!0).set(e,t)}function a(e,t){var r=[],n=s(e,t,!1);if(M(n))return r;for(var i=Q(n.keys()),o=0;;){var a=ee(i);if(!a)return r.length=o,r;var c=Z(a);try{r[o]=c}catch(e){try{te(i)}finally{throw e}}o++}}function c(e,r,n){var i=s(r,n,!1);if(M(i))return!1;if(!i.delete(e))return!1;if(0===i.size){var o=t.get(r);M(o)||(o.delete(n),0===o.size&&t.delete(o))}return!0}}function oe(e){var t=e.defineMetadata,r=e.hasOwnMetadata,s=e.getOwnMetadata,n=e.getOwnMetadataKeys,i=e.deleteMetadata,o=new p;return{isProviderFor:function(e,t){var r=o.get(e);return!(M(r)||!r.has(t))||!!n(e,t).length&&(M(r)&&(r=new h,o.set(e,r)),r.add(t),!0)},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:r,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:n,OrdinaryDeleteMetadata:i}}function ae(e,t,r){var s=g.getProvider(e,t);if(!M(s))return s;if(r){if(g.setProvider(e,t,m))return m;throw new Error("Illegal state.")}}function ce(){var e={},t=[],r=function(){function e(e,t,r){this._index=0,this._keys=e,this._values=t,this._selector=r}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var r=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var r=this._find(e,!0);return this._values[r]=t,this},t.prototype.delete=function(t){var r=this._find(t,!1);if(r>=0){for(var s=this._keys.length,n=r+1;n<s;n++)this._keys[n-1]=this._keys[n],this._values[n-1]=this._values[n];return this._keys.length--,this._values.length--,X(t,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new r(this._keys,this._values,s)},t.prototype.values=function(){return new r(this._keys,this._values,n)},t.prototype.entries=function(){return new r(this._keys,this._values,o)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){if(!X(this._cacheKey,e)){this._cacheIndex=-1;for(var r=0;r<this._keys.length;r++)if(X(this._keys[r],e)){this._cacheIndex=r;break}}return this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function s(e,t){return e}function n(e,t){return t}function o(e,t){return[e,t]}}function ue(){return function(){function e(){this._map=new d}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.keys()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}()}function le(){var e=16,t=u.create(),s=n();return function(){function e(){this._key=n()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=n()},e}();function n(){var e;do{e="@@WeakMap@@"+c()}while(u.has(t,e));return t[e]=!0,e}function i(e,t){if(!r.call(e,s)){if(!t)return;Object.defineProperty(e,s,{value:u.create()})}return e[s]}function o(e,t){for(var r=0;r<t;++r)e[r]=255*Math.random()|0;return e}function a(e){if("function"==typeof Uint8Array){var t=new Uint8Array(e);return"undefined"!=typeof crypto?crypto.getRandomValues(t):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(t):o(t,e),t}return o(new Array(e),e)}function c(){var t=a(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var r="",s=0;s<e;++s){var n=t[s];4!==s&&6!==s&&8!==s||(r+="-"),n<16&&(r+="0"),r+=n.toString(16).toLowerCase()}return r}}function de(e){return e.__=void 0,delete e.__,e}e("decorate",y),e("metadata",b),e("defineMetadata",v),e("hasMetadata",S),e("hasOwnMetadata",w),e("getMetadata",E),e("getOwnMetadata",C),e("getMetadataKeys",T),e("getOwnMetadataKeys",I),e("deleteMetadata",_)}(r,t),"undefined"==typeof t.Reflect&&(t.Reflect=e)}()}(e||(e={}))},3643:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.safePrintFFmpegArguments=t.ffmpegLogInitialOutput=t.safeKillFFmpeg=void 0;var s=r(2989);Object.defineProperty(t,"safeKillFFmpeg",{enumerable:!0,get:function(){return s.safeKillFFmpeg}}),Object.defineProperty(t,"ffmpegLogInitialOutput",{enumerable:!0,get:function(){return s.ffmpegLogInitialOutput}}),Object.defineProperty(t,"safePrintFFmpegArguments",{enumerable:!0,get:function(){return s.safePrintFFmpegArguments}})},3679:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NalUnitType=t.H264RtpPayload=void 0;const s=r(9543);class n{static deSerialize(e,r){const i=new n;let c=0;const u=e[c];if(i.f=(0,s.getBit)(u,0),i.nri=(0,s.getBit)(u,1,2),i.nalUnitType=(0,s.getBit)(u,3,5),c++,i.s=(0,s.getBit)(e[c],0),i.e=(0,s.getBit)(e[c],1),i.r=(0,s.getBit)(e[c],2),i.nalUnitPayloadType=(0,s.getBit)(e[c],3,5),c++,0<i.nalUnitType&&i.nalUnitType<t.NalUnitType.stap_a)i.payload=this.packaging(e);else if(i.nalUnitType===t.NalUnitType.stap_a){let t=o,r=Buffer.alloc(0);for(;t<e.length;){const s=e.readUInt16BE(t);t+=a,r=Buffer.concat([r,this.packaging(e.subarray(t,t+s))]),t+=s}i.payload=r}else if(i.nalUnitType===t.NalUnitType.fu_a){r||(r=Buffer.alloc(0));const t=e.subarray(c);if(i.fragment=Buffer.concat([r,t]),i.e){const e=new s.BitStream(Buffer.alloc(1)).writeBits(1,0).writeBits(2,i.nri).writeBits(5,i.nalUnitPayloadType),t=Buffer.concat([e.uint8Array,i.fragment]);i.fragment=void 0,i.payload=this.packaging(t)}}return i}static packaging(e){return Buffer.concat([i,e])}static isDetectedFinalPacketInSequence(e){return e.marker}get isKeyframe(){return this.nalUnitType===t.NalUnitType.idrSlice||this.nalUnitPayloadType===t.NalUnitType.idrSlice}get isPartitionHead(){return this.nalUnitType!==t.NalUnitType.fu_a&&this.nalUnitType!==t.NalUnitType.fu_b||0!==this.s}}t.H264RtpPayload=n,t.NalUnitType={idrSlice:5,stap_a:24,stap_b:25,mtap16:26,mtap24:27,fu_a:28,fu_b:29};const i=Buffer.from([0,0,0,1]),o=1,a=2},3826:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtcpPayloadSpecificFeedback=void 0;const s=r(962),n=r(4221),i=r(5356),o=r(7177),a=r(8982),c=(0,s.debug)("werift-rtp: /rtcp/psfb/index");class u{constructor(e={}){this.type=u.type,Object.assign(this,e)}serialize(){const e=this.feedback.serialize();return n.RtcpHeader.serialize(this.type,this.feedback.count,e,this.feedback.length)}static deSerialize(e,t){let r;switch(t.count){case i.FullIntraRequest.count:r=i.FullIntraRequest.deSerialize(e);break;case o.PictureLossIndication.count:r=o.PictureLossIndication.deSerialize(e);break;case a.ReceiverEstimatedMaxBitrate.count:r=a.ReceiverEstimatedMaxBitrate.deSerialize(e);break;default:c("unknown psfb packet",t.count)}return new u({feedback:r})}}t.RtcpPayloadSpecificFeedback=u,u.type=206},3846:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.H265Repacketizer=void 0,t.depacketizeAP=u,t.splitH265NaluStartCode=l;const s=r(3453),n=2,i=2,o=n+i;function a(e){return(126&e[0])>>1}function c(e){return 19===e||20===e||16===e||17===e||18===e||21===e}function u(e){const t=[];let r,s=n;for(;s<e.length;){void 0!==r&&t.push(e.subarray(r,s));const n=e.readUInt16BE(s);s+=i,r=s,s+=n}return t.push(e.subarray(r)),t}function l(e){const t=[];let r=0,s=0;const n=()=>{const n=e.subarray(r,s);n.length&&t.push(n),s+=4,r=s};for(;s<e.length-4;){1===e.readUInt32BE(s)?n():s++}return s=e.length,n(),t}t.H265Repacketizer=class{constructor(e,t,r,n=new s.JitterBuffer(e,4)){this.console=e,this.maxPacketSize=t,this.codecInfo=r,this.jitterBuffer=n,this.extraPackets=0,this.sentMarker=!0,this.setMaxPacketSize(t)}setMaxPacketSize(e){this.maxPacketSize=e,this.fuMax=e-3,this.fuMin=Math.round(.8*e)}ensureCodecInfo(){this.codecInfo||(this.codecInfo={vps:void 0,sps:void 0,pps:void 0})}updateVps(e){this.ensureCodecInfo(),this.codecInfo.vps=e}updateSps(e){this.ensureCodecInfo(),this.codecInfo.sps=e}updatePps(e){this.ensureCodecInfo(),this.codecInfo.pps=e}updateSeiPrefix(e){this.ensureCodecInfo(),this.codecInfo.seiPrefix=e}updateSeiSuffix(e){this.ensureCodecInfo(),this.codecInfo.seiSuffix=e}shouldFilter(e){return!1}packetizeFU(e,t,r){if(49===a(e)){const s=63&e[2],n=!!(128&e[2]),i=!!(64&e[2]),o=!n&&!i,a=(1&e[0])<<5|(248&e[1])>>3,c=7&e[1],u=Buffer.alloc(2);u[0]=s<<1|a>>5,u[1]=(31&a)<<3|c,e=Buffer.concat([u,e.subarray(3)]),n?r=!0:i?t=!0:o&&(t=!0,r=!0)}const s=a(e),i=(1&e[0])<<5|(248&e[1])>>3,o=7&e[1],c=Buffer.alloc(2);c[0]=98|i>>5,c[1]=(31&i)<<3|o;const u=Buffer.from([...c,s]),l=t?u:Buffer.from([...c,128|s]),d=r?u:Buffer.from([...c,64|s]);let h=l;const p=[];let f=n;for(;f<e.length;){let t;const r=Math.min(this.fuMax,e.length-f);t=e.subarray(f,f+r),f+=r,f===e.length&&(h=d),p.push(Buffer.concat([h,t])),h=u}return p}packetizeOneAP(e){if(!e.length)throw new Error("packetizeOneAP requires at least one NAL");let t=0,r=this.maxPacketSize-o;const s=Buffer.alloc(2);s[0]=96,s[1]=1;const n=[s];for(;e.length&&e[0].length+i<=r&&t<9;){const s=e.shift();r-=i+s.length,t+=1;const o=Buffer.alloc(2);o.writeUInt16BE(s.length,0),n.push(o,s)}return 0===t?e.shift():1===t?n[2]:Buffer.concat(n)}packetizeAP(e){const t=[];for(;e.length;){const r=this.packetizeOneAP(e);if(r.length<this.maxPacketSize){t.push(r);continue}const s=this.packetizeFU(r);t.push(...s)}return t}createPacket(e,t,r){const s=e.clone();return s.header.sequenceNumber=(e.header.sequenceNumber+this.extraPackets+65536)%65536,s.header.marker=r,s.header.padding=!1,s.payload=t,t.length>this.maxPacketSize&&this.console.warn("packet exceeded max packet size. this may be a bug."),this.sentMarker=s.header.marker,s}flushPendingFU(e){if(!this.pendingFU)return;const t=this.pendingFU[0],r=this.pendingFU[this.pendingFU.length-1],s=63&t.payload[2],n=!!(128&t.payload[2]),i=!!(64&r.payload[2]),o=(1&t.payload[0])<<5|(248&t.payload[1])>>3,u=7&t.payload[1],d=Buffer.alloc(2);d[0]=s<<1|o>>5,d[1]=(31&o)<<3|u;const h=()=>{const e=this.pendingFU.map((e=>e.payload.subarray(3)));return e.unshift(d),Buffer.concat(e)};if(32===s||33===s){const s=l(h());for(;s.length;){const o=s.shift(),u=a(o);32===u?this.updateVps(o):33===u?this.updateSps(o):34===u?this.updatePps(o):(c(u)&&this.maybeSendAPCodecInfo(t,e),this.fragment(t,e,{payload:o,noStart:!n,noEnd:!i,marker:r.header.marker}))}}else{for(;this.pendingFU.length;){const t=this.pendingFU[0];if(t.payload.length>this.maxPacketSize||t.payload.length<this.fuMin)break;this.pendingFU.shift(),e.push(this.createPacket(t,t.payload,t.header.marker))}if(!this.pendingFU.length)return void(this.pendingFU=void 0);const t=this.pendingFU[0],r=this.pendingFU[this.pendingFU.length-1],s=!!(128&t.payload[2]),n=!!(64&r.payload[2]),i=h();this.fragment(t,e,{payload:i,noStart:!s,noEnd:!n,marker:r.header.marker})}this.extraPackets-=this.pendingFU.length-1,this.pendingFU=void 0}createRtpPackets(e,t,r,s=e.header.marker){t.forEach(((n,i)=>{0!==i&&this.extraPackets++;const o=s&&i===t.length-1;r.push(this.createPacket(e,n,o))}))}maybeSendAPCodecInfo(e,t){if(this.ap)return void(this.ap=void 0);if(!this.sentMarker)return;if(!this.codecInfo?.sps||!this.codecInfo?.pps)return;const r=[this.codecInfo.sps,this.codecInfo.pps];this.codecInfo.vps&&r.unshift(this.codecInfo.vps),this.codecInfo?.seiPrefix&&r.push(this.codecInfo.seiPrefix),this.codecInfo?.seiSuffix&&r.push(this.codecInfo.seiSuffix);const s=this.packetizeAP(r);1===s.length?(this.createRtpPackets(e,s,t,!1),this.extraPackets++):this.console.error("expected only 1 packet for vps/sps/pps AP")}fragment(e,t,r={payload:e.payload,noStart:!1,noEnd:!1,marker:e.header.marker}){const{payload:s,noStart:n,noEnd:i,marker:o}=r;if(s.length>this.maxPacketSize||n||i){const r=this.packetizeFU(s,n,i);this.createRtpPackets(e,r,t,o)}else t.push(this.createPacket(e,s,o))}repacketize(e){const t=[];for(const r of this.jitterBuffer.queue(e))this.repacketizeOne(r,t);return t}repacketizeOne(e,t){if(!e.payload.length)return this.flushPendingFU(t),void this.extraPackets--;const r=a(e.payload);if(this.pendingFU&&this.pendingFU[0].header.timestamp!==e.header.timestamp&&this.flushPendingFU(t),49===r){const r=e.payload,i=63&r[2];if(this.shouldFilter(i))return void this.extraPackets--;const o=!!(128&r[2]),a=!!(64&r[2]);if(o)this.pendingFU&&this.console.error("FU restarted. skipping refragmentation of previous FU.",i),this.pendingFU=void 0,19!==i&&20!==i||this.maybeSendAPCodecInfo(e,t);else if(this.pendingFU){const t=this.pendingFU[this.pendingFU.length-1];if(!(0,s.isNextSequenceNumber)(t.header.sequenceNumber,e.header.sequenceNumber))return void this.console.error("FU packet missing. skipping refragmentation.",i)}if(this.pendingFU||(this.pendingFU=[]),this.pendingFU.push(e),a)this.flushPendingFU(t);else if(this.pendingFU.reduce(((e,t)=>e+t.payload.length-3),n)>this.maxPacketSize){const e=this.pendingFU[this.pendingFU.length-1].clone(),r=[];this.flushPendingFU(r);const s=r.pop();e.payload=s.payload,this.pendingFU=[e],t.push(...r),this.sentMarker=!1}}else if(48===r){this.flushPendingFU(t);let r=!1,s=!1,n=!1;const i=u(e.payload);if(i.forEach((e=>{const t=a(e);32===t?(r=!0,this.updateVps(e)):33===t?(s=!0,this.updateSps(e)):34===t?(n=!0,this.updatePps(e)):39===t?this.updateSeiPrefix(e):40===t?this.updateSeiSuffix(e):35===t||t>=0&&t<=9||19===t||0===t||this.console.warn("Skipped an AP type.",t)})),r&&s&&n&&e.payload.length<=this.maxPacketSize){this.ap=e;const r=this.packetizeAP(i);this.createRtpPackets(e,r,t)}else{const r=[];for(;i.length;){const e=i.shift();e.length<=this.maxPacketSize?r.push(e):r.push(...this.packetizeFU(e))}this.createRtpPackets(e,r,t)}}else if(r<=23||r>=32&&r<=40){if(this.flushPendingFU(t),this.shouldFilter(r))return void this.extraPackets--;if(32===r)return this.extraPackets--,void this.updateVps(e.payload);if(33===r)return this.extraPackets--,void this.updateSps(e.payload);if(34===r)return this.extraPackets--,void this.updatePps(e.payload);if(39===r)return this.extraPackets--,void this.updateSeiPrefix(e.payload);if(40===r)return this.extraPackets--,void this.updateSeiSuffix(e.payload);if(this.shouldFilter(r))return void this.extraPackets--;c(r)&&this.maybeSendAPCodecInfo(e,t),this.fragment(e,t)}else this.console.error("unknown NAL unit type "+r),this.extraPackets--}}},3862:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Directions=t.Sendrecv=t.Recvonly=t.Sendonly=t.Inactive=t.RTCRtpTransceiver=void 0;const s=r(6982),n=r(5433),i=r(6448),o=r(4579);t.RTCRtpTransceiver=class{set codecs(e){this._codecs=e}get codecs(){return this._codecs}constructor(e,t,r,i,o){this.kind=e,this.receiver=r,this.sender=i,this._direction=o,this.id=(0,s.randomUUID)().toString(),this.onTrack=new n.Event,this.usedForSender=!1,this._codecs=[],this.headerExtensions=[],this.options={},this.stopping=!1,this.stopped=!1,t&&this.setDtlsTransport(t)}get dtlsTransport(){return this.receiver.dtlsTransport}get direction(){return this._direction}setDirection(e){this._direction=e,i.SenderDirections.includes(this._currentDirection??"")&&(this.usedForSender=!0)}get currentDirection(){return this._currentDirection}setCurrentDirection(e){this._currentDirection=e}setDtlsTransport(e){this.receiver.setDtlsTransport(e),this.sender.setDtlsTransport(e)}get msid(){return`${this.sender.streamId} ${this.sender.trackId}`}addTrack(e){this.receiver.addTrack(e)&&this.onTrack.execute(e,this)}stop(){this.stopping||(this.stopping=!0)}getPayloadType(e){return this.codecs.find((t=>t.mimeType.toLowerCase().includes(e.toLowerCase())))?.payloadType}getCodecStats(){const e=(0,o.getStatsTimestamp)(),t=[];if(!this.dtlsTransport)return t;const r=(0,o.generateStatsId)("transport",this.dtlsTransport.id);for(const s of this.codecs){const n={type:"codec",id:(0,o.generateStatsId)("codec",s.payloadType,r),timestamp:e,payloadType:s.payloadType,transportId:r,mimeType:s.mimeType,clockRate:s.clockRate,channels:s.channels,sdpFmtpLine:s.parameters};t.push(n)}return t}},t.Inactive="inactive",t.Sendonly="sendonly",t.Recvonly="recvonly",t.Sendrecv="sendrecv",t.Directions=[t.Inactive,t.Sendonly,t.Recvonly,t.Sendrecv]},3890:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseQueue=void 0;t.PromiseQueue=class{constructor(){this.queue=[],this.running=!1,this.push=e=>new Promise(((t,r)=>{this.queue.push({promise:e,done:t,failed:r}),this.running||this.run()}))}async run(){const e=this.queue.shift();if(e){this.running=!0;try{const t=await e.promise();e.done(t)}catch(t){e.failed(t)}this.run()}else this.running=!1}cancel(){this.queue=[]}}},3894:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTCIceParameters=t.IceCandidate=t.RTCIceCandidate=t.RTCIceGatherer=t.IceGathererStates=t.IceTransportStates=t.RTCIceTransport=void 0,t.candidateFromIce=u,t.candidateToIce=l;const s=r(6982),n=r(5433),i=r(9411),o=r(4579),a=r(4262),c=(0,n.debug)("werift:packages/webrtc/src/transport/ice.ts");t.RTCIceTransport=class{constructor(e){this.iceGather=e,this.id=(0,s.randomUUID)().toString(),this.state="new",this.renominating=!1,this.onStateChange=new n.Event,this.onIceCandidate=new n.Event,this.onNegotiationNeeded=new n.Event,this.addRemoteCandidate=e=>{if(!this.connection.remoteCandidatesEnd)return e?this.connection.addRemoteCandidate(l(e)):this.connection.addRemoteCandidate(void 0)},this.connection=this.iceGather.connection,this.connection.stateChanged.subscribe((e=>{this.setState(e)})),this.iceGather.onIceCandidate=e=>{this.onIceCandidate.execute(e)}}get role(){return this.connection.iceControlling?"controlling":"controlled"}get gatheringState(){return this.iceGather.gatheringState}get localCandidates(){return this.iceGather.localCandidates}get localParameters(){return this.iceGather.localParameters}setState(e){e!==this.state&&(this.state=e,this.onStateChange.execute(e))}gather(){return this.iceGather.gather()}setRemoteParams(e,t=!1){t&&(this.renominating=!0),this.connection.remoteUsername&&this.connection.remotePassword&&(this.connection.remoteUsername!==e.usernameFragment||this.connection.remotePassword!==e.password)&&(this.renominating?(c("renomination",e),this.connection.resetNominatedPair(),this.renominating=!1):(c("restart",e),this.restart())),this.connection.setRemoteParams(e)}restart(){this.connection.restart(),this.setState("new"),this.iceGather.gatheringState="new",this.waitStart=void 0,this.onNegotiationNeeded.execute()}async start(){if("closed"===this.state)throw new Error("RTCIceTransport is closed");if(!this.connection.remotePassword||!this.connection.remoteUsername)throw new Error("remoteParams missing");this.waitStart&&await this.waitStart.asPromise(),this.waitStart=new n.Event,this.setState("checking");try{await this.connection.connect()}catch(e){throw this.setState("failed"),e}this.waitStart.execute(),this.waitStart.complete(),this.waitStart=void 0}async stop(){"closed"!==this.state&&(this.setState("closed"),await this.connection.close()),this.onStateChange.complete(),this.onIceCandidate.complete(),this.onNegotiationNeeded.complete()}async getStats(){const e=(0,o.getStatsTimestamp)(),t=[];for(const r of this.localCandidates){const s={type:"local-candidate",id:(0,o.generateStatsId)("local-candidate",r.foundation),timestamp:e,transportId:(0,o.generateStatsId)("transport",this.id),address:r.ip,port:r.port,protocol:r.protocol,candidateType:r.type,priority:r.priority,foundation:r.foundation};t.push(s)}for(const r of this.connection.remoteCandidates){const s=u(r),n={type:"remote-candidate",id:(0,o.generateStatsId)("remote-candidate",s.foundation),timestamp:e,transportId:(0,o.generateStatsId)("transport",this.id),address:s.ip,port:s.port,protocol:s.protocol,candidateType:s.type,priority:s.priority,foundation:s.foundation};t.push(n)}const r=this.connection?.candidatePairs?[...this.connection.candidatePairs.filter((e=>e.nominated)),...this.connection.candidatePairs.filter((e=>!e.nominated))]:[];for(const s of r){const r={type:"candidate-pair",id:(0,o.generateStatsId)("candidate-pair",s.foundation),timestamp:e,transportId:(0,o.generateStatsId)("transport",this.id),localCandidateId:(0,o.generateStatsId)("local-candidate",s.localCandidate.foundation),remoteCandidateId:(0,o.generateStatsId)("remote-candidate",s.remoteCandidate.foundation),state:s.state,nominated:s.nominated,packetsSent:s.packetsSent,packetsReceived:s.packetsReceived,bytesSent:s.bytesSent,bytesReceived:s.bytesReceived,currentRoundTripTime:s.rtt};t.push(r)}return t}},t.IceTransportStates=["new","checking","connected","completed","disconnected","failed","closed"],t.IceGathererStates=["new","gathering","complete"];function u(e){const t=new h(e.component,e.foundation,e.host,e.port,e.priority,e.transport,e.type,e.generation,e.ufrag);return t.relatedAddress=e.relatedAddress,t.relatedPort=e.relatedPort,t.tcpType=e.tcptype,t}function l(e){return new i.Candidate(e.foundation,e.component,e.protocol,e.priority,e.ip,e.port,e.type,e.relatedAddress,e.relatedPort,e.tcpType,e.generation,e.ufrag)}t.RTCIceGatherer=class{constructor(e={}){this.options=e,this.onIceCandidate=()=>{},this.gatheringState="new",this.onGatheringStateChange=new n.Event,this.connection=new i.Connection(!1,this.options),this.connection.onIceCandidate.subscribe((e=>{this.onIceCandidate(u(e))}))}async gather(){"new"===this.gatheringState&&(this.setState("gathering"),await this.connection.gatherCandidates(),this.onIceCandidate(void 0),this.setState("complete"))}get localCandidates(){return this.connection.localCandidates.map(u)}get localParameters(){return new p({usernameFragment:this.connection.localUsername,password:this.connection.localPassword})}setState(e){e!==this.gatheringState&&(this.gatheringState=e,this.onGatheringStateChange.execute(e))}};class d{constructor(e){Object.assign(this,e)}static fromSdp(e){return u(i.Candidate.fromSdp(e)).toJSON()}static isThis(e){if("string"==typeof e?.candidate)return!0}toJSON(){return{candidate:this.candidate,sdpMid:this.sdpMid,sdpMLineIndex:this.sdpMLineIndex,usernameFragment:this.usernameFragment}}}t.RTCIceCandidate=d;class h{constructor(e,t,r,s,n,i,o,a,c){this.component=e,this.foundation=t,this.ip=r,this.port=s,this.priority=n,this.protocol=i,this.type=o,this.generation=a,this.ufrag=c}toJSON(){return new d({candidate:(0,a.candidateToSdp)(this),sdpMLineIndex:this.sdpMLineIndex,sdpMid:this.sdpMid,usernameFragment:this.ufrag})}static fromJSON(e){try{if(!e.candidate)throw new Error("candidate is required");const t=(0,a.candidateFromSdp)(e.candidate);return t.sdpMLineIndex=e.sdpMLineIndex??void 0,t.sdpMid=e.sdpMid??void 0,t}catch(e){}}}t.IceCandidate=h;class p{constructor(e={}){this.iceLite=!1,Object.assign(this,e)}}t.RTCIceParameters=p},3939:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.notImplemented=t.bitMask=void 0,t.isBytes=i,t.abytes=o,t.abool=function(e,t){if("boolean"!=typeof t)throw new Error(e+" boolean expected, got "+t)},t.bytesToHex=c,t.numberToHexUnpadded=u,t.hexToNumber=l,t.hexToBytes=p,t.bytesToNumberBE=function(e){return l(c(e))},t.bytesToNumberLE=function(e){return o(e),l(c(Uint8Array.from(e).reverse()))},t.numberToBytesBE=f,t.numberToBytesLE=function(e,t){return f(e,t).reverse()},t.numberToVarBytesBE=function(e){return p(u(e))},t.ensureBytes=function(e,t,r){let s;if("string"==typeof t)try{s=p(t)}catch(t){throw new Error(e+" must be hex string or Uint8Array, cause: "+t)}else{if(!i(t))throw new Error(e+" must be hex string or Uint8Array");s=Uint8Array.from(t)}const n=s.length;if("number"==typeof r&&n!==r)throw new Error(e+" of length "+r+" expected, got "+n);return s},t.concatBytes=g,t.equalBytes=function(e,t){if(e.length!==t.length)return!1;let r=0;for(let s=0;s<e.length;s++)r|=e[s]^t[s];return 0===r},t.utf8ToBytes=function(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))},t.inRange=y,t.aInRange=function(e,t,r,s){if(!y(t,r,s))throw new Error("expected valid "+e+": "+r+" <= n < "+s+", got "+t)},t.bitLen=function(e){let t;for(t=0;e>r;e>>=s,t+=1);return t},t.bitGet=function(e,t){return e>>BigInt(t)&s},t.bitSet=function(e,t,n){return e|(n?s:r)<<BigInt(t)},t.createHmacDrbg=function(e,t,r){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof r)throw new Error("hmacFn must be a function");let s=b(e),n=b(e),i=0;const o=()=>{s.fill(1),n.fill(0),i=0},a=(...e)=>r(n,s,...e),c=(e=b())=>{n=a(v([0]),e),s=a(),0!==e.length&&(n=a(v([1]),e),s=a())},u=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const r=[];for(;e<t;){s=a();const t=s.slice();r.push(t),e+=s.length}return g(...r)};return(e,t)=>{let r;for(o(),c(e);!(r=t(u()));)c();return o(),r}},t.validateObject=function(e,t,r={}){const s=(t,r,s)=>{const n=S[r];if("function"!=typeof n)throw new Error("invalid validator function");const i=e[t];if(!(s&&void 0===i||n(i,e)))throw new Error("param "+String(t)+" is invalid. Expected "+r+", got "+i)};for(const[e,r]of Object.entries(t))s(e,r,!1);for(const[e,t]of Object.entries(r))s(e,t,!0);return e},t.memoized=function(e){const t=new WeakMap;return(r,...s)=>{const n=t.get(r);if(void 0!==n)return n;const i=e(r,...s);return t.set(r,i),i}};const r=BigInt(0),s=BigInt(1),n=BigInt(2);function i(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function o(e){if(!i(e))throw new Error("Uint8Array expected")}const a=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function c(e){o(e);let t="";for(let r=0;r<e.length;r++)t+=a[e[r]];return t}function u(e){const t=e.toString(16);return 1&t.length?"0"+t:t}function l(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return""===e?r:BigInt("0x"+e)}const d={_0:48,_9:57,A:65,F:70,a:97,f:102};function h(e){return e>=d._0&&e<=d._9?e-d._0:e>=d.A&&e<=d.F?e-(d.A-10):e>=d.a&&e<=d.f?e-(d.a-10):void 0}function p(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const s=new Uint8Array(r);for(let t=0,n=0;t<r;t++,n+=2){const r=h(e.charCodeAt(n)),i=h(e.charCodeAt(n+1));if(void 0===r||void 0===i){const t=e[n]+e[n+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+n)}s[t]=16*r+i}return s}function f(e,t){return p(e.toString(16).padStart(2*t,"0"))}function g(...e){let t=0;for(let r=0;r<e.length;r++){const s=e[r];o(s),t+=s.length}const r=new Uint8Array(t);for(let t=0,s=0;t<e.length;t++){const n=e[t];r.set(n,s),s+=n.length}return r}const m=e=>"bigint"==typeof e&&r<=e;function y(e,t,r){return m(e)&&m(t)&&m(r)&&t<=e&&e<r}t.bitMask=e=>(n<<BigInt(e-1))-s;const b=e=>new Uint8Array(e),v=e=>Uint8Array.from(e);const S={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||i(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};t.notImplemented=()=>{throw new Error("not implemented")}},3976:(e,t,r)=>{"use strict";const s=r(6101),{decodeCommon:n}=r(7868),i=r(59);e.exports=function(...e){if(0===e.length)throw new TypeError("You should set at least one condition type.");const t={decode:function r(o){r.bytes=0;const a=i.clone(this);for(const c of e){const e=n(o,c,a);if(!0!==c[s.skip])return r.bytes=a.bytes,i.clean(a),t[s.skip]=!1,e}t[s.skip]=!0},encode:()=>{},[s.skip]:!0};return t}},3982:(e,t,r)=>{const s=t,{Buffer:n}=r(181),i=r(857);s.toBuffer=function(e,t,r){let s;if(r=~~r,this.isV4Format(e))s=t||n.alloc(r+4),e.split(/\./g).map((e=>{s[r++]=255&parseInt(e,10)}));else if(this.isV6Format(e)){const i=e.split(":",8);let o;for(o=0;o<i.length;o++){let e;this.isV4Format(i[o])&&(e=this.toBuffer(i[o]),i[o]=e.slice(0,2).toString("hex")),e&&++o<8&&i.splice(o,0,e.slice(2,4).toString("hex"))}if(""===i[0])for(;i.length<8;)i.unshift("0");else if(""===i[i.length-1])for(;i.length<8;)i.push("0");else if(i.length<8){for(o=0;o<i.length&&""!==i[o];o++);const e=[o,1];for(o=9-i.length;o>0;o--)e.push("0");i.splice(...e)}for(s=t||n.alloc(r+16),o=0;o<i.length;o++){const e=parseInt(i[o],16);s[r++]=e>>8&255,s[r++]=255&e}}if(!s)throw Error(`Invalid ip address: ${e}`);return s},s.toString=function(e,t,r){t=~~t;let s=[];if(4===(r=r||e.length-t)){for(let n=0;n<r;n++)s.push(e[t+n]);s=s.join(".")}else if(16===r){for(let n=0;n<r;n+=2)s.push(e.readUInt16BE(t+n).toString(16));s=s.join(":"),s=s.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),s=s.replace(/:{3,4}/,"::")}return s};const o=/^(\d{1,3}\.){3,3}\d{1,3}$/,a=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i;function c(e){return 4===e?"ipv4":6===e?"ipv6":e?e.toLowerCase():"ipv4"}s.isV4Format=function(e){return o.test(e)},s.isV6Format=function(e){return a.test(e)},s.fromPrefixLen=function(e,t){let r=4;"ipv6"===(t=e>32?"ipv6":c(t))&&(r=16);const i=n.alloc(r);for(let t=0,r=i.length;t<r;++t){let r=8;e<8&&(r=e),e-=r,i[t]=255&~(255>>r)}return s.toString(i)},s.mask=function(e,t){e=s.toBuffer(e),t=s.toBuffer(t);const r=n.alloc(Math.max(e.length,t.length));let i;if(e.length===t.length)for(i=0;i<e.length;i++)r[i]=e[i]&t[i];else if(4===t.length)for(i=0;i<t.length;i++)r[i]=e[e.length-4+i]&t[i];else{for(i=0;i<r.length-6;i++)r[i]=0;for(r[10]=255,r[11]=255,i=0;i<e.length;i++)r[i+12]=e[i]&t[i+12];i+=12}for(;i<r.length;i++)r[i]=0;return s.toString(r)},s.cidr=function(e){const t=e.split("/"),r=t[0];if(2!==t.length)throw new Error(`invalid CIDR subnet: ${r}`);const n=s.fromPrefixLen(parseInt(t[1],10));return s.mask(r,n)},s.subnet=function(e,t){const r=s.toLong(s.mask(e,t)),n=s.toBuffer(t);let i=0;for(let e=0;e<n.length;e++)if(255===n[e])i+=8;else{let t=255&n[e];for(;t;)t=t<<1&255,i++}const o=2**(32-i);return{networkAddress:s.fromLong(r),firstAddress:o<=2?s.fromLong(r):s.fromLong(r+1),lastAddress:o<=2?s.fromLong(r+o-1):s.fromLong(r+o-2),broadcastAddress:s.fromLong(r+o-1),subnetMask:t,subnetMaskLength:i,numHosts:o<=2?o:o-2,length:o,contains:e=>r===s.toLong(s.mask(e,t))}},s.cidrSubnet=function(e){const t=e.split("/"),r=t[0];if(2!==t.length)throw new Error(`invalid CIDR subnet: ${r}`);const n=s.fromPrefixLen(parseInt(t[1],10));return s.subnet(r,n)},s.not=function(e){const t=s.toBuffer(e);for(let e=0;e<t.length;e++)t[e]=255^t[e];return s.toString(t)},s.or=function(e,t){if(e=s.toBuffer(e),t=s.toBuffer(t),e.length===t.length){for(let r=0;r<e.length;++r)e[r]|=t[r];return s.toString(e)}let r=e,n=t;t.length>e.length&&(r=t,n=e);const i=r.length-n.length;for(let e=i;e<r.length;++e)r[e]|=n[e-i];return s.toString(r)},s.isEqual=function(e,t){if(e=s.toBuffer(e),t=s.toBuffer(t),e.length===t.length){for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}if(4===t.length){const r=t;t=e,e=r}for(let e=0;e<10;e++)if(0!==t[e])return!1;const r=t.readUInt16BE(10);if(0!==r&&65535!==r)return!1;for(let r=0;r<4;r++)if(e[r]!==t[r+12])return!1;return!0},s.isPrivate=function(e){if(s.isLoopback(e))return!0;if(!s.isV6Format(e)){const t=s.normalizeToLong(e);if(t<0)throw new Error("invalid ipv4 address");e=s.fromLong(t)}return/^(::f{4}:)?10\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?192\.168\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?172\.(1[6-9]|2\d|30|31)\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?169\.254\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^f[cd][0-9a-f]{2}:/i.test(e)||/^fe80:/i.test(e)||/^::1$/.test(e)||/^::$/.test(e)},s.isPublic=function(e){return!s.isPrivate(e)},s.isLoopback=function(e){return/\./.test(e)||/:/.test(e)||(e=s.fromLong(Number(e))),/^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})/.test(e)||/^0177\./.test(e)||/^0x7f\./i.test(e)||/^fe80::1$/i.test(e)||/^::1$/.test(e)||/^::$/.test(e)},s.loopback=function(e){if("ipv4"!==(e=c(e))&&"ipv6"!==e)throw new Error("family must be ipv4 or ipv6");return"ipv4"===e?"127.0.0.1":"fe80::1"},s.address=function(e,t){const r=i.networkInterfaces();if(t=c(t),e&&"private"!==e&&"public"!==e){const s=r[e].filter((e=>c(e.family)===t));if(0===s.length)return;return s[0].address}const n=Object.keys(r).map((n=>{const i=r[n].filter((r=>(r.family=c(r.family),r.family===t&&!s.isLoopback(r.address)&&(!e||("public"===e?s.isPrivate(r.address):s.isPublic(r.address))))));return i.length?i[0].address:void 0})).filter(Boolean);return n.length?n[0]:s.loopback(t)},s.toLong=function(e){let t=0;return e.split(".").forEach((e=>{t<<=8,t+=parseInt(e)})),t>>>0},s.fromLong=function(e){return`${e>>>24}.${e>>16&255}.${e>>8&255}.${255&e}`},s.normalizeToLong=function(e){const t=e.split(".").map((e=>e.startsWith("0x")||e.startsWith("0X")?parseInt(e,16):e.startsWith("0")&&"0"!==e&&/^[0-7]+$/.test(e)?parseInt(e,8):/^[1-9]\d*$/.test(e)||"0"===e?parseInt(e,10):NaN));if(t.some(isNaN))return-1;let r=0;switch(t.length){case 1:r=t[0];break;case 2:if(t[0]>255||t[1]>16777215)return-1;r=t[0]<<24|16777215&t[1];break;case 3:if(t[0]>255||t[1]>255||t[2]>65535)return-1;r=t[0]<<24|t[1]<<16|65535&t[2];break;case 4:if(t.some((e=>e>255)))return-1;r=t[0]<<24|t[1]<<16|t[2]<<8|t[3];break;default:return-1}return r>>>0}},3990:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeToCurve=t.hashToCurve=t.secp256r1=t.p256=void 0;const s=r(8028),n=r(2835),i=r(3170),o=r(5720),a=r(6518),c=(0,o.Field)(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),u=c.create(BigInt("-3")),l=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b");t.p256=(0,n.createCurve)({a:u,b:l,Fp:c,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},s.sha256),t.secp256r1=t.p256;const d=(()=>(0,a.mapToCurveSimpleSWU)(c,{A:u,B:l,Z:c.create(BigInt("-10"))}))(),h=(()=>(0,i.createHasher)(t.secp256r1.ProjectivePoint,(e=>d(e[0])),{DST:"P256_XMD:SHA-256_SSWU_RO_",encodeDST:"P256_XMD:SHA-256_SSWU_NU_",p:c.ORDER,m:1,k:128,expand:"xmd",hash:s.sha256}))();t.hashToCurve=h.hashToCurve,t.encodeToCurve=h.encodeToCurve},4007:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Alert=void 0;const s=r(6353);class n{constructor(e,t){this.level=e,this.description=t}static deSerialize(e){return new n(...Object.values((0,s.decode)(e,n.spec)))}serialize(){const e=(0,s.encode)(this,n.spec).slice();return Buffer.from(e)}}t.Alert=n,n.spec={level:s.types.uint8,description:s.types.uint8}},4011:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getObjectSummary=t.dumpBuffer=void 0,t.enumerate=function(e){return e.map(((e,t)=>[t,e]))},t.divide=function(e,t){const r=e.split(t);return[r[0],r.slice(1).join(t)]};t.dumpBuffer=e=>"0x"+e.toString("hex").replace(/(.)(.)/g,"$1$2 ").split(" ").filter((e=>null!=e&&e.length>0)).join(",0x");t.getObjectSummary=e=>Object.entries({...e}).reduce(((e,[r,s])=>("number"!=typeof s&&"string"!=typeof s||(e[r]=s),Buffer.isBuffer(s)&&(e[r]=(0,t.dumpBuffer)(s)),e)),{})},4111:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTCRtpSender=void 0;const s=r(6982),n=r(4694),i=r(6982),o=r(6460),a=r(5433),c=r(7823),u=r(6252),l=r(8806),d=r(3137),h=r(4579),p=(0,u.debug)("werift:packages/webrtc/src/media/rtpSender.ts");t.RTCRtpSender=class{constructor(e){this.trackOrKind=e,this.type="sender",this.ssrc=n.jspack.Unpack("!L",(0,s.randomBytes)(4))[0],this.rtxSsrc=n.jspack.Unpack("!L",(0,s.randomBytes)(4))[0],this.streamId=(0,i.randomUUID)().toString(),this.trackId=(0,i.randomUUID)().toString(),this.onReady=new a.Event,this.onRtcp=new a.Event,this.onPictureLossIndication=new a.Event,this.onGenericNack=new a.Event,this.senderBWE=new d.SenderBandwidthEstimator,this.rtxSequenceNumber=(0,a.random16)(),this._redDistance=2,this.redEncoder=new u.RedEncoder(this._redDistance),this.headerExtensions=[],this.ntpTimestamp=0n,this.rtpTimestamp=0,this.octetCount=0,this.packetCount=0,this.receiverEstimatedMaxBitrate=0n,this.timestampOffset=0,this.seqOffset=0,this.rtpCache=[],this.dtlsDisposer=[],this.stopped=!1,this.rtcpRunning=!1,this.rtcpCancel=new AbortController,this.kind="string"==typeof this.trackOrKind?this.trackOrKind:this.trackOrKind.kind,"string"!=typeof e&&(e.streamId&&(this.streamId=e.streamId),this.registerTrack(e))}setDtlsTransport(e){this.dtlsTransport&&this.dtlsDisposer.forEach((e=>e())),this.dtlsTransport=e,this.dtlsDisposer=[this.dtlsTransport.onStateChange.subscribe((e=>{"connected"===e&&this.onReady.execute()})).unSubscribe]}get redDistance(){return this._redDistance}set redDistance(e){this._redDistance=e,this.redEncoder.distance=e}prepareSend(e){this.cname=e.rtcp?.cname,this.mid=e.muxId,this.headerExtensions=e.headerExtensions,this.rtpStreamId=e.rtpStreamId,this.repairedRtpStreamId=e.repairedRtpStreamId,this.codec=e.codecs[0],this.track&&(this.track.codec=this.codec),e.codecs.forEach((e=>{const t=(0,c.codecParametersFromString)(e.parameters??"");"rtx"===e.name.toLowerCase()&&t.apt===this.codec?.payloadType&&(this.rtxPayloadType=e.payloadType),"red"===e.name.toLowerCase()&&(this.redRedundantPayloadType=Number((e.parameters??"").split("/")[0]))}))}registerTrack(e){if(e.stopped)throw new Error("track is ended");this.disposeTrack&&this.disposeTrack(),e.id=this.trackId;const{unSubscribe:t}=e.onReceiveRtp.subscribe((async e=>{await this.sendRtp(e)}));this.track=e,this.disposeTrack=t,this.codec&&(e.codec=this.codec),e.onSourceChanged.subscribe((e=>{this.replaceRTP(e)}))}async replaceTrack(e){if(null!==e){if(e.stopped)throw new Error("track is ended");if(null!=this.sequenceNumber){const t=e.header||(await e.onReceiveRtp.asPromise())[0].header;this.replaceRTP(t)}this.registerTrack(e),p("replaceTrack","ssrc",e.ssrc,"rid",e.rid)}}stop(){this.stopped=!0,this.rtcpRunning=!1,this.rtcpCancel.abort(),this.disposeTrack&&this.disposeTrack(),this.track=void 0}async runRtcp(){if(!this.rtcpRunning&&!this.stopped){this.rtcpRunning=!0;try{for(;this.rtcpRunning;){await(0,o.setTimeout)(500+1e3*Math.random(),void 0,{signal:this.rtcpCancel.signal});const e=[new u.RtcpSrPacket({ssrc:this.ssrc,senderInfo:new u.RtcpSenderInfo({ntpTimestamp:this.ntpTimestamp,rtpTimestamp:this.rtpTimestamp,packetCount:this.packetCount,octetCount:this.octetCount})})];this.lastSRtimestamp=(0,l.compactNtp)(this.ntpTimestamp),this.lastSentSRTimestamp=(0,l.timestampSeconds)(),this.cname&&e.push(new u.RtcpSourceDescriptionPacket({chunks:[new u.SourceDescriptionChunk({source:this.ssrc,items:[new u.SourceDescriptionItem({type:1,text:this.cname})]})]}));try{await this.dtlsTransport.sendRtcp(e)}catch(e){p("sendRtcp failed",e),await(0,o.setTimeout)(500+1e3*Math.random())}}}catch(e){}}}replaceRTP({sequenceNumber:e,timestamp:t},r=!1){null!=this.sequenceNumber&&(this.seqOffset=(0,a.uint16Add)(this.sequenceNumber,-e),r&&(this.seqOffset=(0,a.uint16Add)(this.seqOffset,2))),null!=this.timestamp&&(this.timestampOffset=(0,a.uint32Add)(this.timestamp,-t),r&&(this.timestampOffset=(0,a.uint16Add)(this.timestampOffset,1))),this.rtpCache=[],p("replaceRTP",this.sequenceNumber,e,this.seqOffset)}async sendRtp(e){if("connected"!==this.dtlsTransport.state||!this.codec)return;e=Buffer.isBuffer(e)?u.RtpPacket.deSerialize(e):e;const{header:t,payload:r}=e;t.ssrc=this.ssrc,t.payloadType=this.codec.payloadType,t.timestamp=(0,a.uint32Add)(t.timestamp,this.timestampOffset),t.sequenceNumber=(0,a.uint16Add)(t.sequenceNumber,this.seqOffset),this.timestamp=t.timestamp,this.sequenceNumber=t.sequenceNumber;const s=(0,l.ntpTime)(),n=[...t.extensions];t.extensions=this.headerExtensions.map((e=>{const t=(()=>{switch(e.uri){case u.RTP_EXTENSION_URI.sdesMid:return this.mid?(0,u.serializeSdesMid)(this.mid):void 0;case u.RTP_EXTENSION_URI.sdesRTPStreamID:return this.rtpStreamId?(0,u.serializeSdesRTPStreamID)(this.rtpStreamId):void 0;case u.RTP_EXTENSION_URI.repairedRtpStreamId:return this.repairedRtpStreamId?(0,u.serializeRepairedRtpStreamId)(this.repairedRtpStreamId):void 0;case u.RTP_EXTENSION_URI.transportWideCC:return this.dtlsTransport.transportSequenceNumber=(0,a.uint16Add)(this.dtlsTransport.transportSequenceNumber,1),(0,u.serializeTransportWideCC)(this.dtlsTransport.transportSequenceNumber);case u.RTP_EXTENSION_URI.absSendTime:return(0,u.serializeAbsSendTime)(s)}})();if(t)return{id:e.id,payload:t}})).filter((e=>e));for(const e of n){const r=t.extensions.find((t=>t.id===e.id));r?r.payload=e.payload:t.extensions.push(e)}t.extensions=t.extensions.sort(((e,t)=>e.id-t.id)),this.ntpTimestamp=s,this.rtpTimestamp=t.timestamp,this.octetCount+=r.length,this.packetCount=(0,a.uint32Add)(this.packetCount,1),this.rtpCache[t.sequenceNumber%128]=e;let i=r;if(this.redRedundantPayloadType){this.redEncoder.push({block:i,timestamp:t.timestamp,blockPT:this.redRedundantPayloadType});i=this.redEncoder.build().serialize()}const o=await this.dtlsTransport.sendRtp(i,t);this.runRtcp();const c=(0,l.milliTime)(),d={wideSeq:this.dtlsTransport.transportSequenceNumber,size:o,sendingAtMs:c,sentAtMs:c};this.senderBWE.rtpPacketSent(d)}handleRtcpPacket(e){switch(e.type){case u.RtcpSrPacket.type:case u.RtcpRrPacket.type:e.reports.filter((e=>e.ssrc===this.ssrc)).forEach((e=>{if(this.lastSRtimestamp===e.lsr&&e.dlsr&&this.lastSentSRTimestamp){const t=(0,l.timestampSeconds)()-this.lastSentSRTimestamp-e.dlsr/65536;void 0===this.rtt?this.rtt=t:this.rtt=.85*this.rtt+(1-.85)*t}}));break;case u.RtcpTransportLayerFeedback.type:{const t=e;switch(t.feedback.count){case u.TransportWideCC.count:{const e=t.feedback;this.senderBWE.receiveTWCC(e)}break;case u.GenericNack.count:{const e=t.feedback;e.lost.forEach((async e=>{let t=this.rtpCache[e%128];t&&t.header.sequenceNumber!==e&&(t=void 0),t&&(null!=this.rtxPayloadType&&(t=(0,u.wrapRtx)(t,this.rtxPayloadType,this.rtxSequenceNumber,this.rtxSsrc),this.rtxSequenceNumber=(0,a.uint16Add)(this.rtxSequenceNumber,1)),await this.dtlsTransport.sendRtp(t.payload,t.header))})),this.onGenericNack.execute(e)}}}break;case u.RtcpPayloadSpecificFeedback.type:{const t=e;switch(t.feedback.count){case u.ReceiverEstimatedMaxBitrate.count:{const e=t.feedback;this.receiverEstimatedMaxBitrate=e.bitrate}break;case u.PictureLossIndication.count:this.onPictureLossIndication.execute()}}}this.onRtcp.execute(e)}getParameters(){return{encodings:[]}}setParameters(e){}async getStats(){const e=(0,h.getStatsTimestamp)(),t=[];if(!this.dtlsTransport)return t;const r=(0,h.generateStatsId)("transport",this.dtlsTransport.id),s={type:"outbound-rtp",id:(0,h.generateStatsId)("outbound-rtp",this.ssrc),timestamp:e,ssrc:this.ssrc,kind:this.kind,transportId:r,codecId:this.codec?(0,h.generateStatsId)("codec",this.codec.payloadType,r):void 0,mid:this.mid,packetsSent:this.packetCount,bytesSent:this.octetCount,rtxSsrc:this.rtxPayloadType?this.rtxSsrc:void 0};if(t.push(s),this.track){const r={type:"media-source",id:(0,h.generateStatsId)("media-source",this.trackId),timestamp:e,trackIdentifier:this.trackId,kind:this.kind};t.push(r)}if(void 0!==this.rtt){const n={type:"remote-inbound-rtp",id:(0,h.generateStatsId)("remote-inbound-rtp",this.ssrc),timestamp:e,ssrc:this.ssrc,kind:this.kind,transportId:r,codecId:s.codecId,localId:s.id,roundTripTime:this.rtt};t.push(n)}return t}}},4131:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4148:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.signatures=t.certificateTypes=t.SignatureScheme=t.CurveType=t.NamedCurveAlgorithmList=t.NamedCurveAlgorithm=t.CipherSuiteList=t.CipherSuite=t.HashAlgorithm=t.SignatureAlgorithm=void 0,t.SignatureAlgorithm={rsa_1:1,ecdsa_3:3},t.HashAlgorithm={sha256_4:4},t.CipherSuite={TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_49195:49195,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256_49199:49199},t.CipherSuiteList=Object.values(t.CipherSuite),t.NamedCurveAlgorithm={x25519_29:29,secp256r1_23:23},t.NamedCurveAlgorithmList=Object.values(t.NamedCurveAlgorithm),t.CurveType={named_curve_3:3},t.SignatureScheme={rsa_pkcs1_sha256:1025,ecdsa_secp256r1_sha256:1027},t.certificateTypes=[1,64],t.signatures=[{hash:t.HashAlgorithm.sha256_4,signature:t.SignatureAlgorithm.rsa_1},{hash:t.HashAlgorithm.sha256_4,signature:t.SignatureAlgorithm.ecdsa_3}]},4221:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtcpHeader=t.RTCP_HEADER_SIZE=void 0;const s=r(9543);t.RTCP_HEADER_SIZE=4;class n{constructor(e={}){this.version=2,this.padding=!1,this.count=0,this.type=0,this.length=0,Object.assign(this,e)}static serialize(e,t,r,s){const i=new n({type:e,count:t,version:2,length:s}).serialize();return Buffer.concat([i,r])}serialize(){const e=new s.BitWriter(8);e.set(2,0,this.version),this.padding&&e.set(1,2,1),e.set(5,3,this.count);return(0,s.bufferWriter)([1,1,2],[e.value,this.type,this.length])}static deSerialize(e){const[t,r,i]=(0,s.bufferReader)(e,[1,1,2]),o=(0,s.getBit)(t,0,2),a=(0,s.getBit)(t,2,1)>0,c=(0,s.getBit)(t,3,5);return new n({version:o,padding:a,count:c,type:r,length:i})}}t.RtcpHeader=n},4255:function(e,t,r){"use strict";var s,n=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=s(e),o=0;o<r.length;o++)"default"!==r[o]&&n(t,e,r[o]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ATTRIBUTES_BY_NAME=t.ATTRIBUTES_BY_TYPE=t.AttributeRepository=void 0,t.unpackErrorCode=h,t.unpackXorAddress=m,t.packErrorCode=y,t.packXorAddress=b;const c=o(r(5701)),u=a(r(3982)),l=r(4687);function d(e){const[t]=e,r=u.default.isV4Format(t)?l.IPV4_PROTOCOL:l.IPV6_PROTOCOL,s=Buffer.alloc(4);return s.writeUInt8(0,0),s.writeUInt8(r,1),s.writeUInt16BE(e[1],2),Buffer.concat([s,u.default.toBuffer(t)])}function h(e){if(e.length<4)throw new Error("STUN error code is less than 4 bytes");return[100*e.readUInt8(2)+e.readUInt8(3),e.slice(4).toString("utf8")]}function p(e){if(e.length<4)throw new Error("STUN address length is less than 4 bytes");const t=e.readUInt8(1),r=e.readUInt16BE(2),s=e.slice(4);switch(t){case l.IPV4_PROTOCOL:if(4!=s.length)throw new Error("STUN address has invalid length for IPv4");return[u.default.toString(s),r];case l.IPV6_PROTOCOL:if(16!=s.length)throw new Error("STUN address has invalid length for IPv6");return[u.default.toString(s),r];default:throw new Error("STUN address has unknown protocol")}}const f=Buffer.alloc(6);function g(e,t){const r=[...f,...t];let s=e.slice(0,2);for(let t=2;t<e.length;t++){const n=e[t]^r[t-2],i=Buffer.alloc(1);i.writeUIntBE(n,0,1),s=Buffer.concat([s,i])}return s}function m(e,t){return p(g(e,t))}function y(e){const t=Buffer.alloc(4);t.writeUInt16BE(0,0),t.writeUInt8(Math.floor(e[0]/100),2),t.writeUInt8(e[0]%100,3);const r=Buffer.from(e[1],"utf8");return Buffer.concat([t,r])}function b(e,t){return g(d(e),t)}f.writeUInt16BE(l.COOKIE>>16,0),f.writeUInt32BE(l.COOKIE,2);const v=e=>{const t=Buffer.alloc(4);return t.writeUInt32BE(e,0),t},S=e=>e.readUInt32BE(0),w=e=>new c.Int64BE(e.toString()).toBuffer(),E=e=>{const t=new c.Int64BE(e);return BigInt(t.toString())},C=e=>Buffer.from(e,"utf8"),T=e=>e.toString("utf8"),I=e=>e,_=e=>e,A=[[1,"MAPPED-ADDRESS",d,p],[3,"CHANGE-REQUEST",v,S],[4,"SOURCE-ADDRESS",d,p],[5,"CHANGED-ADDRESS",d,p],[6,"USERNAME",C,T],[8,"MESSAGE-INTEGRITY",I,_],[9,"ERROR-CODE",y,h],[12,"CHANNEL-NUMBER",e=>{const t=Buffer.alloc(4);return t.writeUInt16BE(e,0),t},e=>e.readUInt16BE(0)],[13,"LIFETIME",v,S],[18,"XOR-PEER-ADDRESS",b,m],[19,"DATA",I,_],[20,"REALM",C,T],[21,"NONCE",I,_],[22,"XOR-RELAYED-ADDRESS",b,m],[25,"REQUESTED-TRANSPORT",v,S],[32,"XOR-MAPPED-ADDRESS",b,m],[36,"PRIORITY",v,S],[37,"USE-CANDIDATE",e=>Buffer.from([]),e=>null],[32802,"SOFTWARE",C,T],[32808,"FINGERPRINT",v,S],[32809,"ICE-CONTROLLED",w,E],[32810,"ICE-CONTROLLING",w,E],[32811,"RESPONSE-ORIGIN",d,p],[32812,"OTHER-ADDRESS",d,p]];t.AttributeRepository=class{constructor(e=[]){this.attributes=e}getAttributes(){return this.attributes}setAttribute(e,t){const r=this.attributes.find((t=>t[0]===e));return r?r[1]=t:this.attributes.push([e,t]),this}getAttributeValue(e){const t=this.attributes.find((t=>t[0]===e));if(t)return t[1]}get attributesKeys(){return this.attributes.map((e=>e[0]))}clear(){this.attributes=[]}},t.ATTRIBUTES_BY_TYPE=A.reduce(((e,t)=>(e[t[0]]=t,e)),{}),t.ATTRIBUTES_BY_NAME=A.reduce(((e,t)=>(e[t[1]]=t,e)),{})},4262:function(e,t,r){"use strict";var s,n=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=s(e),o=0;o<r.length;o++)"default"!==r[o]&&n(t,e,r[o]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.SsrcDescription=t.RTCSessionDescription=t.GroupDescription=t.MediaDescription=t.SessionDescription=void 0,t.candidateToSdp=E,t.parseGroup=T,t.candidateFromSdp=I,t.addSDPHeader=function(e,t){const r=new u.Uint64BE((0,a.randomBytes)(64)).toString().slice(0,8);t.origin=`- ${r} 0 IN IP4 0.0.0.0`,t.msidSemantic.push(new v("WMS",["*"])),t.type=e},t.codecParametersFromString=function(e){const t={};return e.split(";").forEach((e=>{if(e.includes("=")){const[r,s]=(0,d.divide)(e,"=");l.FMTP_INT_PARAMETERS.includes(r)?t[r]=Number(s):t[r]=s}else if(e.includes(":")){const[r,s]=e.split(":");t[r]=Number.isNaN(Number(s))?s:Number(s)}else t[e]=void 0})),t},t.codecParametersToString=function(e,t="="){const r=Object.entries(e).map((([e,r])=>r?`${e}${t}${r}`:e));if(r.length>0)return r.join(";");return};const a=r(6982),c=r(9278),u=o(r(5701)),l=r(6448),d=r(8655),h=r(2237),p=r(4582),f=r(5692),g=r(3894),m=r(6779);class y{constructor(){this.version=0,this.name="-",this.time="0 0",this.group=[],this.extMapAllowMixed=!0,this.msidSemantic=[],this.media=[],this.dtlsFingerprints=[]}static parse(e){const[t,r]=function(e){const t=[],r=[];let s=e.split("\r\n");1===s.length&&(s=e.split("\n"));return s.forEach((e=>{e.startsWith("m=")?r.push([e]):r.length>0?r[r.length-1].push(e):t.push(e)})),[t,r]}(e),s=new y;t.forEach((e=>{if(e.startsWith("v="))s.version=Number.parseInt(e.slice(2),10);else if(e.startsWith("o="))s.origin=e.slice(2);else if(e.startsWith("s="))s.name=e.slice(2);else if(e.startsWith("c="))s.host=S(e.slice(2));else if(e.startsWith("t="))s.time=e.slice(2);else if(e.startsWith("a=")){const[t,r]=C(e);switch(t){case"fingerprint":{const[e,t]=r?.split(" ")||[];s.dtlsFingerprints.push(new f.RTCDtlsFingerprint(e,t))}break;case"ice-lite":s.iceLite=!0;break;case"ice-options":s.iceOptions=r;break;case"ice-pwd":s.icePassword=r;break;case"ice-ufrag":s.iceUsernameFragment=r;break;case"group":T(s.group,r);break;case"msid-semantic":T(s.msidSemantic,r);break;case"setup":s.dtlsRole=l.DTLS_SETUP_ROLE[r];break;case"extmap-allow-mixed":s.extMapAllowMixed=!0}}}));const n=s.group.find((e=>"BUNDLE"===e.semantic));return r.forEach((e=>{const t=e[0].match(/^m=([^ ]+) ([0-9]+) ([A-Z/]+) (.+)/);if(!t)throw new Error("m line not found");const r=t[1],i=t[4].split(" "),o=["audio","video"].includes(r)?i.map((e=>Number(e))):void 0,a=new b(r,Number.parseInt(t[2]),t[3],o||i);if(a.dtlsParams=new f.RTCDtlsParameters([...s.dtlsFingerprints],s.dtlsRole),a.iceParams=new g.RTCIceParameters({iceLite:s.iceLite,usernameFragment:s.iceUsernameFragment,password:s.icePassword}),a.iceOptions=s.iceOptions,s.media.push(a),e.slice(1).forEach((e=>{if(e.startsWith("c="))a.host=S(e.slice(2));else if(e.startsWith("a=")){const[t,r]=C(e);switch(t){case"candidate":if(!r)throw new Error;a.iceCandidates.push(I(r));break;case"end-of-candidates":a.iceCandidatesComplete=!0;break;case"extmap":{let[e,t]=r.split(" ");e.includes("/")&&([e]=e.split("/")),a.rtp.headerExtensions.push(new p.RTCRtpHeaderExtensionParameters({id:Number.parseInt(e),uri:t}))}break;case"fingerprint":{if(!r)throw new Error;const[e,t]=r.split(" ");a.dtlsParams?.fingerprints.push(new f.RTCDtlsFingerprint(e,t))}break;case"ice-options":a.iceOptions=r;break;case"ice-pwd":a.iceParams.password=r;break;case"ice-ufrag":a.iceParams.usernameFragment=r;break;case"ice-lite":a.iceParams.iceLite=!0;break;case"max-message-size":a.sctpCapabilities=new m.RTCSctpCapabilities(Number.parseInt(r,10));break;case"mid":a.rtp.muxId=r;break;case"msid":a.msid=r;break;case"rtcp":{const[e,t]=(0,d.divide)(r," ");a.rtcpPort=Number.parseInt(e),a.rtcpHost=S(t)}break;case"rtcp-mux":a.rtcpMux=!0;break;case"setup":a.dtlsParams.role=l.DTLS_SETUP_ROLE[r];break;case"recvonly":case"sendonly":case"sendrecv":case"inactive":a.direction=t;break;case"rtpmap":{const[e,t]=(0,d.divide)(r," "),[s,n,i]=t.split("/");let o;"audio"===a.kind&&(o=i?Number.parseInt(i):1);const c=new p.RTCRtpCodecParameters({mimeType:a.kind+"/"+s,channels:o,clockRate:Number.parseInt(n),payloadType:Number.parseInt(e)});a.rtp.codecs.push(c)}break;case"sctpmap":{if(!r)throw new Error;const[e,t]=(0,d.divide)(r," ");a.sctpMap[Number.parseInt(e)]=t,a.sctpPort=Number.parseInt(e)}break;case"sctp-port":if(!r)throw new Error;a.sctpPort=Number.parseInt(r);break;case"ssrc":{const[e,t]=(0,d.divide)(r," "),s=Number.parseInt(e),[n,i]=(0,d.divide)(t,":");let o=a.ssrc.find((e=>e.ssrc===s));o||(o=new A({ssrc:s}),a.ssrc.push(o)),l.SSRC_INFO_ATTRS.includes(n)&&(o[n]=i)}break;case"ssrc-group":T(a.ssrcGroup,r);break;case"rid":{const[e,t]=(0,d.divide)(r," ");a.simulcastParameters.push(new p.RTCRtpSimulcastParameters({rid:e,direction:t}))}}}})),(!a.iceParams.usernameFragment||!a.iceParams.password)&&a.rtp.muxId&&n&&n.items.includes(a.rtp.muxId))for(let e=0;e<n.items.length;e++){if(!n.items.includes(e.toString()))continue;const t=s.media[e];if(t.iceParams?.usernameFragment&&t.iceParams.password){a.iceParams={...t.iceParams};break}}a.dtlsParams.role||(a.dtlsParams=void 0);e.slice(1).forEach((e=>{if(e.startsWith("a=")){const[r,s]=C(e);if("fmtp"===r){const[e,r]=(0,d.divide)(s," ");(t=Number(e),a.rtp.codecs.find((e=>e.payloadType===t))).parameters=r}else if("rtcp-fb"===r){const[e,t,r]=s.split(" ");a.rtp.codecs.forEach((s=>{["*",s.payloadType.toString()].includes(e)&&s.rtcpFeedback.push(new p.RTCRtcpFeedback({type:t,parameter:r}))}))}}var t}))})),s}webrtcTrackId(e){if(e.msid?.includes(" ")){const t=e.msid.split(" ");for(const e of this.msidSemantic)if("WMS"===e.semantic&&(e.items.includes(t[0])||e.items.includes("*")))return t[1]}}get string(){const e=[`v=${this.version}`,`o=${this.origin}`,`s=${this.name}`];this.host&&e.push(`c=${w(this.host)}`),e.push(`t=${this.time}`),this.group.forEach((t=>e.push(`a=group:${t.str}`))),this.extMapAllowMixed&&e.push("a=extmap-allow-mixed"),this.msidSemantic.forEach((t=>e.push(`a=msid-semantic:${t.str}`)));const t=this.media.map((e=>e.toString())).join("");return e.join("\r\n")+"\r\n"+t}toJSON(){return new _(this.string,this.type)}toSdp(){return{type:this.type,sdp:this.string}}}t.SessionDescription=y;class b{constructor(e,t,r,s){this.kind=e,this.port=t,this.profile=r,this.fmt=s,this.rtcpMux=!1,this.ssrc=[],this.ssrcGroup=[],this.rtp={codecs:[],headerExtensions:[]},this.sctpMap={},this.iceCandidates=[],this.iceCandidatesComplete=!1,this.simulcastParameters=[]}toString(){const e=[];if(e.push(`m=${this.kind} ${this.port} ${this.profile} ${this.fmt.map((e=>e.toString())).join(" ")}`),this.host&&e.push(`c=${w(this.host)}`),this.iceCandidates.forEach((t=>{e.push(`a=candidate:${E(t)}`)})),this.iceCandidatesComplete&&e.push("a=end-of-candidates"),this.iceParams?.usernameFragment&&e.push(`a=ice-ufrag:${this.iceParams.usernameFragment}`),this.iceParams?.password&&e.push(`a=ice-pwd:${this.iceParams.password}`),this.iceParams?.iceLite&&e.push("a=ice-lite"),this.iceOptions&&e.push(`a=ice-options:${this.iceOptions}`),this.dtlsParams&&(this.dtlsParams.fingerprints.forEach((t=>{e.push(`a=fingerprint:${t.algorithm} ${t.value}`)})),e.push(`a=setup:${l.DTLS_ROLE_SETUP[this.dtlsParams.role]}`)),this.direction&&e.push(`a=${this.direction}`),this.rtp.muxId&&e.push(`a=mid:${this.rtp.muxId}`),this.msid&&e.push(`a=msid:${this.msid}`),this.rtcpPort&&this.rtcpHost&&(e.push(`a=rtcp:${this.rtcpPort} ${w(this.rtcpHost)}`),this.rtcpMux&&e.push("a=rtcp-mux")),this.ssrcGroup.forEach((t=>{e.push(`a=ssrc-group:${t.str}`)})),this.ssrc.forEach((t=>{l.SSRC_INFO_ATTRS.forEach((r=>{const s=t[r];void 0!==s&&e.push(`a=ssrc:${t.ssrc} ${r}:${s}`)}))})),this.rtp.codecs.forEach((t=>{e.push(`a=rtpmap:${t.payloadType} ${t.str}`),t.rtcpFeedback.forEach((r=>{let s=r.type;r.parameter&&(s+=` ${r.parameter}`),e.push(`a=rtcp-fb:${t.payloadType} ${s}`)})),t.parameters&&e.push(`a=fmtp:${t.payloadType} ${t.parameters}`)})),Object.keys(this.sctpMap).forEach((t=>{const r=this.sctpMap[Number(t)];e.push(`a=sctpmap:${t} ${r}`)})),this.sctpPort&&e.push(`a=sctp-port:${this.sctpPort}`),this.sctpCapabilities&&e.push(`a=max-message-size:${this.sctpCapabilities.maxMessageSize}`),this.rtp.headerExtensions.forEach((t=>e.push(`a=extmap:${t.id} ${t.uri}`))),this.simulcastParameters.length){this.simulcastParameters.forEach((t=>{e.push(`a=rid:${t.rid} ${t.direction}`)}));let t="a=simulcast:";const r=this.simulcastParameters.filter((e=>"recv"===e.direction));r.length&&(t+=`recv ${r.map((e=>e.rid)).join(";")} `);const s=this.simulcastParameters.filter((e=>"send"===e.direction));s.length&&(t+=`send ${s.map((e=>e.rid)).join(";")}`),e.push(t)}return e.join("\r\n")+"\r\n"}}t.MediaDescription=b;class v{constructor(e,t){this.semantic=e,this.items=t}get str(){return`${this.semantic} ${this.items.join(" ")}`}}function S(e){const t=e.match(/^IN (IP4|IP6) ([^ ]+)$/);if(!t)throw new Error("exception");return t[2]}function w(e){return`IN IP${(0,c.isIPv4)(e)?4:6} ${e}`}function E(e){let t=`${e.foundation} ${e.component} ${e.protocol} ${e.priority} ${e.ip} ${e.port} typ ${e.type}`;return null!=e.relatedAddress&&(t+=` raddr ${e.relatedAddress}`),null!=e.relatedPort&&(t+=` rport ${e.relatedPort}`),null!=e.tcpType&&(t+=` tcptype ${e.tcpType}`),null!=e.generation&&(t+=` generation ${e.generation}`),null!=e.ufrag&&(t+=` ufrag ${e.ufrag}`),t}function C(e){if(e.includes(":")){const t=(0,d.divide)(e.slice(2),":");return[t[0],t[1]]}return[e.slice(2),void 0]}function T(e,t,r=e=>e.toString()){const s=t.split(" ");s.length>0&&e.push(new v(s[0],s.slice(1).map(r)))}function I(e){const t=h.Candidate.fromSdp(e);return(0,g.candidateFromIce)(t)}t.GroupDescription=v;class _{constructor(e,t){this.sdp=e,this.type=t}static isThis(e){if("string"==typeof e?.sdp)return!0}toSdp(){return{sdp:this.sdp,type:this.type}}}t.RTCSessionDescription=_;class A{constructor(e){Object.assign(this,e)}}t.SsrcDescription=A},4351:(e,t,r)=>{"use strict";const{decodeCommon:s}=r(7868),{encodeCommon:n}=r(1620),{encodingLengthCommon:i}=r(1236),{isType:o,isUserType:a,isFunction:c}=r(2),u=r(59);function l(e){if(!Array.isArray(e))throw new TypeError("Argument #1 should be an Array.")}function d(e){if("number"!=typeof e)throw new TypeError("Length of an array should be a number.")}function h(e,t){if(e!==t)throw new Error(`Argument #1 required length ${e} instead of ${t}`)}e.exports=function(e,t,r="count"){if(!o(e)&&!a(e))throw new TypeError("Argument #1 should be a valid type.");const p="bytes"===r,f="number"==typeof t,g=o(t),m=c(t);if(!f&&!g&&!m)throw new TypeError("Unknown type of argument #1.");return{encode:function r(s,o){l(s);const a=u.clone(this);r.bytes=0;let c=0;g?c=s.length:f?c=t:m&&(c=t(a),d(c));p||h(c,s.length);if(p){const t=u.clone(a);for(const r of s)i(r,e,t);g&&(c=t.bytes),h(t.bytes,c),u.clean(t)}g&&(t.encode.call(a,c,o),r.bytes+=t.encode.bytes);s.forEach((t=>{n(t,o,e,a)})),r.bytes+=a.bytes,u.clean(a)},decode:function r(n){let i=0;r.bytes=0;const o=u.clone(this);f?i=t:g?(i=t.decode.call(o,n),r.bytes+=t.decode.bytes):m&&(i=t(o));let a;d(i),a=p?function(e,t,r,n){const i=[],o=n.bytes;let a=0;for(;a<t;)i.push(s(r,e,n)),a=n.bytes-o;if(a>t)throw new Error("Incorrect length of an array.");return i}(e,i,n,o):function(e,t,r,n){const i=new Array(t);for(let o=0;o<t;o+=1)i[o]=s(r,e,n);return i}(e,i,n,o);return r.bytes+=o.bytes,u.clean(o),a},encodingLength:function(r){l(r);const s=u.clone(this);let n=0;if(f&&p)return t;g&&!p&&(n=t.encodingLength(r.length));for(const t of r)i(t,e,s);u.clean(s),n+=s.bytes,g&&p&&(n+=t.encodingLength(n));return n}}}},4390:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DePacketizerBase=void 0;t.DePacketizerBase=class{static deSerialize(e,t){return{}}static isDetectedFinalPacketInSequence(e){return!0}get isKeyframe(){return!0}}},4408:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(9543),t)},4434:e=>{"use strict";e.exports=require("events")},4448:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpusRtpPayload=void 0;const s=r(9543);class n{static deSerialize(e){const t=new n;return t.payload=e,t}static isDetectedFinalPacketInSequence(e){return!0}get isKeyframe(){return!0}static createCodecPrivate(e=48e3){return Buffer.concat([Buffer.from("OpusHead"),(0,s.bufferWriter)([1,1],[1,2]),(0,s.bufferWriterLE)([2,4,2,1],[312,e,0,0])])}}t.OpusRtpPayload=n},4522:(e,t,r)=>{!function(e){"use strict";var t=function(e){var t,r=new Float64Array(16);if(e)for(t=0;t<e.length;t++)r[t]=e[t];return r},s=function(){throw new Error("no PRNG")},n=new Uint8Array(16),i=new Uint8Array(32);i[0]=9;var o=t(),a=t([1]),c=t([56129,1]),u=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),l=t([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),d=t([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),h=t([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),p=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function f(e,t,r,s){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r,e[t+4]=s>>24&255,e[t+5]=s>>16&255,e[t+6]=s>>8&255,e[t+7]=255&s}function g(e,t,r,s,n){var i,o=0;for(i=0;i<n;i++)o|=e[t+i]^r[s+i];return(1&o-1>>>8)-1}function m(e,t,r,s){return g(e,t,r,s,16)}function y(e,t,r,s){return g(e,t,r,s,32)}function b(e,t,r,s){!function(e,t,r,s){for(var n,i=255&s[0]|(255&s[1])<<8|(255&s[2])<<16|(255&s[3])<<24,o=255&r[0]|(255&r[1])<<8|(255&r[2])<<16|(255&r[3])<<24,a=255&r[4]|(255&r[5])<<8|(255&r[6])<<16|(255&r[7])<<24,c=255&r[8]|(255&r[9])<<8|(255&r[10])<<16|(255&r[11])<<24,u=255&r[12]|(255&r[13])<<8|(255&r[14])<<16|(255&r[15])<<24,l=255&s[4]|(255&s[5])<<8|(255&s[6])<<16|(255&s[7])<<24,d=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,h=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,p=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,f=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,g=255&s[8]|(255&s[9])<<8|(255&s[10])<<16|(255&s[11])<<24,m=255&r[16]|(255&r[17])<<8|(255&r[18])<<16|(255&r[19])<<24,y=255&r[20]|(255&r[21])<<8|(255&r[22])<<16|(255&r[23])<<24,b=255&r[24]|(255&r[25])<<8|(255&r[26])<<16|(255&r[27])<<24,v=255&r[28]|(255&r[29])<<8|(255&r[30])<<16|(255&r[31])<<24,S=255&s[12]|(255&s[13])<<8|(255&s[14])<<16|(255&s[15])<<24,w=i,E=o,C=a,T=c,I=u,_=l,A=d,R=h,P=p,k=f,B=g,O=m,x=y,N=b,D=v,L=S,M=0;M<20;M+=2)w^=(n=(x^=(n=(P^=(n=(I^=(n=w+x|0)<<7|n>>>25)+w|0)<<9|n>>>23)+I|0)<<13|n>>>19)+P|0)<<18|n>>>14,_^=(n=(E^=(n=(N^=(n=(k^=(n=_+E|0)<<7|n>>>25)+_|0)<<9|n>>>23)+k|0)<<13|n>>>19)+N|0)<<18|n>>>14,B^=(n=(A^=(n=(C^=(n=(D^=(n=B+A|0)<<7|n>>>25)+B|0)<<9|n>>>23)+D|0)<<13|n>>>19)+C|0)<<18|n>>>14,L^=(n=(O^=(n=(R^=(n=(T^=(n=L+O|0)<<7|n>>>25)+L|0)<<9|n>>>23)+T|0)<<13|n>>>19)+R|0)<<18|n>>>14,w^=(n=(T^=(n=(C^=(n=(E^=(n=w+T|0)<<7|n>>>25)+w|0)<<9|n>>>23)+E|0)<<13|n>>>19)+C|0)<<18|n>>>14,_^=(n=(I^=(n=(R^=(n=(A^=(n=_+I|0)<<7|n>>>25)+_|0)<<9|n>>>23)+A|0)<<13|n>>>19)+R|0)<<18|n>>>14,B^=(n=(k^=(n=(P^=(n=(O^=(n=B+k|0)<<7|n>>>25)+B|0)<<9|n>>>23)+O|0)<<13|n>>>19)+P|0)<<18|n>>>14,L^=(n=(D^=(n=(N^=(n=(x^=(n=L+D|0)<<7|n>>>25)+L|0)<<9|n>>>23)+x|0)<<13|n>>>19)+N|0)<<18|n>>>14;w=w+i|0,E=E+o|0,C=C+a|0,T=T+c|0,I=I+u|0,_=_+l|0,A=A+d|0,R=R+h|0,P=P+p|0,k=k+f|0,B=B+g|0,O=O+m|0,x=x+y|0,N=N+b|0,D=D+v|0,L=L+S|0,e[0]=w>>>0&255,e[1]=w>>>8&255,e[2]=w>>>16&255,e[3]=w>>>24&255,e[4]=E>>>0&255,e[5]=E>>>8&255,e[6]=E>>>16&255,e[7]=E>>>24&255,e[8]=C>>>0&255,e[9]=C>>>8&255,e[10]=C>>>16&255,e[11]=C>>>24&255,e[12]=T>>>0&255,e[13]=T>>>8&255,e[14]=T>>>16&255,e[15]=T>>>24&255,e[16]=I>>>0&255,e[17]=I>>>8&255,e[18]=I>>>16&255,e[19]=I>>>24&255,e[20]=_>>>0&255,e[21]=_>>>8&255,e[22]=_>>>16&255,e[23]=_>>>24&255,e[24]=A>>>0&255,e[25]=A>>>8&255,e[26]=A>>>16&255,e[27]=A>>>24&255,e[28]=R>>>0&255,e[29]=R>>>8&255,e[30]=R>>>16&255,e[31]=R>>>24&255,e[32]=P>>>0&255,e[33]=P>>>8&255,e[34]=P>>>16&255,e[35]=P>>>24&255,e[36]=k>>>0&255,e[37]=k>>>8&255,e[38]=k>>>16&255,e[39]=k>>>24&255,e[40]=B>>>0&255,e[41]=B>>>8&255,e[42]=B>>>16&255,e[43]=B>>>24&255,e[44]=O>>>0&255,e[45]=O>>>8&255,e[46]=O>>>16&255,e[47]=O>>>24&255,e[48]=x>>>0&255,e[49]=x>>>8&255,e[50]=x>>>16&255,e[51]=x>>>24&255,e[52]=N>>>0&255,e[53]=N>>>8&255,e[54]=N>>>16&255,e[55]=N>>>24&255,e[56]=D>>>0&255,e[57]=D>>>8&255,e[58]=D>>>16&255,e[59]=D>>>24&255,e[60]=L>>>0&255,e[61]=L>>>8&255,e[62]=L>>>16&255,e[63]=L>>>24&255}(e,t,r,s)}function v(e,t,r,s){!function(e,t,r,s){for(var n,i=255&s[0]|(255&s[1])<<8|(255&s[2])<<16|(255&s[3])<<24,o=255&r[0]|(255&r[1])<<8|(255&r[2])<<16|(255&r[3])<<24,a=255&r[4]|(255&r[5])<<8|(255&r[6])<<16|(255&r[7])<<24,c=255&r[8]|(255&r[9])<<8|(255&r[10])<<16|(255&r[11])<<24,u=255&r[12]|(255&r[13])<<8|(255&r[14])<<16|(255&r[15])<<24,l=255&s[4]|(255&s[5])<<8|(255&s[6])<<16|(255&s[7])<<24,d=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,h=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,p=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,f=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,g=255&s[8]|(255&s[9])<<8|(255&s[10])<<16|(255&s[11])<<24,m=255&r[16]|(255&r[17])<<8|(255&r[18])<<16|(255&r[19])<<24,y=255&r[20]|(255&r[21])<<8|(255&r[22])<<16|(255&r[23])<<24,b=255&r[24]|(255&r[25])<<8|(255&r[26])<<16|(255&r[27])<<24,v=255&r[28]|(255&r[29])<<8|(255&r[30])<<16|(255&r[31])<<24,S=255&s[12]|(255&s[13])<<8|(255&s[14])<<16|(255&s[15])<<24,w=0;w<20;w+=2)i^=(n=(y^=(n=(p^=(n=(u^=(n=i+y|0)<<7|n>>>25)+i|0)<<9|n>>>23)+u|0)<<13|n>>>19)+p|0)<<18|n>>>14,l^=(n=(o^=(n=(b^=(n=(f^=(n=l+o|0)<<7|n>>>25)+l|0)<<9|n>>>23)+f|0)<<13|n>>>19)+b|0)<<18|n>>>14,g^=(n=(d^=(n=(a^=(n=(v^=(n=g+d|0)<<7|n>>>25)+g|0)<<9|n>>>23)+v|0)<<13|n>>>19)+a|0)<<18|n>>>14,S^=(n=(m^=(n=(h^=(n=(c^=(n=S+m|0)<<7|n>>>25)+S|0)<<9|n>>>23)+c|0)<<13|n>>>19)+h|0)<<18|n>>>14,i^=(n=(c^=(n=(a^=(n=(o^=(n=i+c|0)<<7|n>>>25)+i|0)<<9|n>>>23)+o|0)<<13|n>>>19)+a|0)<<18|n>>>14,l^=(n=(u^=(n=(h^=(n=(d^=(n=l+u|0)<<7|n>>>25)+l|0)<<9|n>>>23)+d|0)<<13|n>>>19)+h|0)<<18|n>>>14,g^=(n=(f^=(n=(p^=(n=(m^=(n=g+f|0)<<7|n>>>25)+g|0)<<9|n>>>23)+m|0)<<13|n>>>19)+p|0)<<18|n>>>14,S^=(n=(v^=(n=(b^=(n=(y^=(n=S+v|0)<<7|n>>>25)+S|0)<<9|n>>>23)+y|0)<<13|n>>>19)+b|0)<<18|n>>>14;e[0]=i>>>0&255,e[1]=i>>>8&255,e[2]=i>>>16&255,e[3]=i>>>24&255,e[4]=l>>>0&255,e[5]=l>>>8&255,e[6]=l>>>16&255,e[7]=l>>>24&255,e[8]=g>>>0&255,e[9]=g>>>8&255,e[10]=g>>>16&255,e[11]=g>>>24&255,e[12]=S>>>0&255,e[13]=S>>>8&255,e[14]=S>>>16&255,e[15]=S>>>24&255,e[16]=d>>>0&255,e[17]=d>>>8&255,e[18]=d>>>16&255,e[19]=d>>>24&255,e[20]=h>>>0&255,e[21]=h>>>8&255,e[22]=h>>>16&255,e[23]=h>>>24&255,e[24]=p>>>0&255,e[25]=p>>>8&255,e[26]=p>>>16&255,e[27]=p>>>24&255,e[28]=f>>>0&255,e[29]=f>>>8&255,e[30]=f>>>16&255,e[31]=f>>>24&255}(e,t,r,s)}var S=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function w(e,t,r,s,n,i,o){var a,c,u=new Uint8Array(16),l=new Uint8Array(64);for(c=0;c<16;c++)u[c]=0;for(c=0;c<8;c++)u[c]=i[c];for(;n>=64;){for(b(l,u,o,S),c=0;c<64;c++)e[t+c]=r[s+c]^l[c];for(a=1,c=8;c<16;c++)a=a+(255&u[c])|0,u[c]=255&a,a>>>=8;n-=64,t+=64,s+=64}if(n>0)for(b(l,u,o,S),c=0;c<n;c++)e[t+c]=r[s+c]^l[c];return 0}function E(e,t,r,s,n){var i,o,a=new Uint8Array(16),c=new Uint8Array(64);for(o=0;o<16;o++)a[o]=0;for(o=0;o<8;o++)a[o]=s[o];for(;r>=64;){for(b(c,a,n,S),o=0;o<64;o++)e[t+o]=c[o];for(i=1,o=8;o<16;o++)i=i+(255&a[o])|0,a[o]=255&i,i>>>=8;r-=64,t+=64}if(r>0)for(b(c,a,n,S),o=0;o<r;o++)e[t+o]=c[o];return 0}function C(e,t,r,s,n){var i=new Uint8Array(32);v(i,s,n,S);for(var o=new Uint8Array(8),a=0;a<8;a++)o[a]=s[a+16];return E(e,t,r,o,i)}function T(e,t,r,s,n,i,o){var a=new Uint8Array(32);v(a,i,o,S);for(var c=new Uint8Array(8),u=0;u<8;u++)c[u]=i[u+16];return w(e,t,r,s,n,c,a)}var I=function(e){var t,r,s,n,i,o,a,c;this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0,t=255&e[0]|(255&e[1])<<8,this.r[0]=8191&t,r=255&e[2]|(255&e[3])<<8,this.r[1]=8191&(t>>>13|r<<3),s=255&e[4]|(255&e[5])<<8,this.r[2]=7939&(r>>>10|s<<6),n=255&e[6]|(255&e[7])<<8,this.r[3]=8191&(s>>>7|n<<9),i=255&e[8]|(255&e[9])<<8,this.r[4]=255&(n>>>4|i<<12),this.r[5]=i>>>1&8190,o=255&e[10]|(255&e[11])<<8,this.r[6]=8191&(i>>>14|o<<2),a=255&e[12]|(255&e[13])<<8,this.r[7]=8065&(o>>>11|a<<5),c=255&e[14]|(255&e[15])<<8,this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127,this.pad[0]=255&e[16]|(255&e[17])<<8,this.pad[1]=255&e[18]|(255&e[19])<<8,this.pad[2]=255&e[20]|(255&e[21])<<8,this.pad[3]=255&e[22]|(255&e[23])<<8,this.pad[4]=255&e[24]|(255&e[25])<<8,this.pad[5]=255&e[26]|(255&e[27])<<8,this.pad[6]=255&e[28]|(255&e[29])<<8,this.pad[7]=255&e[30]|(255&e[31])<<8};function _(e,t,r,s,n,i){var o=new I(i);return o.update(r,s,n),o.finish(e,t),0}function A(e,t,r,s,n,i){var o=new Uint8Array(16);return _(o,0,r,s,n,i),m(e,t,o,0)}function R(e,t,r,s,n){var i;if(r<32)return-1;for(T(e,0,t,0,r,s,n),_(e,16,e,32,r-32,e),i=0;i<16;i++)e[i]=0;return 0}function P(e,t,r,s,n){var i,o=new Uint8Array(32);if(r<32)return-1;if(C(o,0,32,s,n),0!==A(t,16,t,32,r-32,o))return-1;for(T(e,0,t,0,r,s,n),i=0;i<32;i++)e[i]=0;return 0}function k(e,t){var r;for(r=0;r<16;r++)e[r]=0|t[r]}function B(e){var t,r,s=1;for(t=0;t<16;t++)r=e[t]+s+65535,s=Math.floor(r/65536),e[t]=r-65536*s;e[0]+=s-1+37*(s-1)}function O(e,t,r){for(var s,n=~(r-1),i=0;i<16;i++)s=n&(e[i]^t[i]),e[i]^=s,t[i]^=s}function x(e,r){var s,n,i,o=t(),a=t();for(s=0;s<16;s++)a[s]=r[s];for(B(a),B(a),B(a),n=0;n<2;n++){for(o[0]=a[0]-65517,s=1;s<15;s++)o[s]=a[s]-65535-(o[s-1]>>16&1),o[s-1]&=65535;o[15]=a[15]-32767-(o[14]>>16&1),i=o[15]>>16&1,o[14]&=65535,O(a,o,1-i)}for(s=0;s<16;s++)e[2*s]=255&a[s],e[2*s+1]=a[s]>>8}function N(e,t){var r=new Uint8Array(32),s=new Uint8Array(32);return x(r,e),x(s,t),y(r,0,s,0)}function D(e){var t=new Uint8Array(32);return x(t,e),1&t[0]}function L(e,t){var r;for(r=0;r<16;r++)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}function M(e,t,r){for(var s=0;s<16;s++)e[s]=t[s]+r[s]}function U(e,t,r){for(var s=0;s<16;s++)e[s]=t[s]-r[s]}function j(e,t,r){var s,n,i=0,o=0,a=0,c=0,u=0,l=0,d=0,h=0,p=0,f=0,g=0,m=0,y=0,b=0,v=0,S=0,w=0,E=0,C=0,T=0,I=0,_=0,A=0,R=0,P=0,k=0,B=0,O=0,x=0,N=0,D=0,L=r[0],M=r[1],U=r[2],j=r[3],H=r[4],F=r[5],z=r[6],V=r[7],q=r[8],K=r[9],$=r[10],W=r[11],G=r[12],Y=r[13],X=r[14],J=r[15];i+=(s=t[0])*L,o+=s*M,a+=s*U,c+=s*j,u+=s*H,l+=s*F,d+=s*z,h+=s*V,p+=s*q,f+=s*K,g+=s*$,m+=s*W,y+=s*G,b+=s*Y,v+=s*X,S+=s*J,o+=(s=t[1])*L,a+=s*M,c+=s*U,u+=s*j,l+=s*H,d+=s*F,h+=s*z,p+=s*V,f+=s*q,g+=s*K,m+=s*$,y+=s*W,b+=s*G,v+=s*Y,S+=s*X,w+=s*J,a+=(s=t[2])*L,c+=s*M,u+=s*U,l+=s*j,d+=s*H,h+=s*F,p+=s*z,f+=s*V,g+=s*q,m+=s*K,y+=s*$,b+=s*W,v+=s*G,S+=s*Y,w+=s*X,E+=s*J,c+=(s=t[3])*L,u+=s*M,l+=s*U,d+=s*j,h+=s*H,p+=s*F,f+=s*z,g+=s*V,m+=s*q,y+=s*K,b+=s*$,v+=s*W,S+=s*G,w+=s*Y,E+=s*X,C+=s*J,u+=(s=t[4])*L,l+=s*M,d+=s*U,h+=s*j,p+=s*H,f+=s*F,g+=s*z,m+=s*V,y+=s*q,b+=s*K,v+=s*$,S+=s*W,w+=s*G,E+=s*Y,C+=s*X,T+=s*J,l+=(s=t[5])*L,d+=s*M,h+=s*U,p+=s*j,f+=s*H,g+=s*F,m+=s*z,y+=s*V,b+=s*q,v+=s*K,S+=s*$,w+=s*W,E+=s*G,C+=s*Y,T+=s*X,I+=s*J,d+=(s=t[6])*L,h+=s*M,p+=s*U,f+=s*j,g+=s*H,m+=s*F,y+=s*z,b+=s*V,v+=s*q,S+=s*K,w+=s*$,E+=s*W,C+=s*G,T+=s*Y,I+=s*X,_+=s*J,h+=(s=t[7])*L,p+=s*M,f+=s*U,g+=s*j,m+=s*H,y+=s*F,b+=s*z,v+=s*V,S+=s*q,w+=s*K,E+=s*$,C+=s*W,T+=s*G,I+=s*Y,_+=s*X,A+=s*J,p+=(s=t[8])*L,f+=s*M,g+=s*U,m+=s*j,y+=s*H,b+=s*F,v+=s*z,S+=s*V,w+=s*q,E+=s*K,C+=s*$,T+=s*W,I+=s*G,_+=s*Y,A+=s*X,R+=s*J,f+=(s=t[9])*L,g+=s*M,m+=s*U,y+=s*j,b+=s*H,v+=s*F,S+=s*z,w+=s*V,E+=s*q,C+=s*K,T+=s*$,I+=s*W,_+=s*G,A+=s*Y,R+=s*X,P+=s*J,g+=(s=t[10])*L,m+=s*M,y+=s*U,b+=s*j,v+=s*H,S+=s*F,w+=s*z,E+=s*V,C+=s*q,T+=s*K,I+=s*$,_+=s*W,A+=s*G,R+=s*Y,P+=s*X,k+=s*J,m+=(s=t[11])*L,y+=s*M,b+=s*U,v+=s*j,S+=s*H,w+=s*F,E+=s*z,C+=s*V,T+=s*q,I+=s*K,_+=s*$,A+=s*W,R+=s*G,P+=s*Y,k+=s*X,B+=s*J,y+=(s=t[12])*L,b+=s*M,v+=s*U,S+=s*j,w+=s*H,E+=s*F,C+=s*z,T+=s*V,I+=s*q,_+=s*K,A+=s*$,R+=s*W,P+=s*G,k+=s*Y,B+=s*X,O+=s*J,b+=(s=t[13])*L,v+=s*M,S+=s*U,w+=s*j,E+=s*H,C+=s*F,T+=s*z,I+=s*V,_+=s*q,A+=s*K,R+=s*$,P+=s*W,k+=s*G,B+=s*Y,O+=s*X,x+=s*J,v+=(s=t[14])*L,S+=s*M,w+=s*U,E+=s*j,C+=s*H,T+=s*F,I+=s*z,_+=s*V,A+=s*q,R+=s*K,P+=s*$,k+=s*W,B+=s*G,O+=s*Y,x+=s*X,N+=s*J,S+=(s=t[15])*L,o+=38*(E+=s*U),a+=38*(C+=s*j),c+=38*(T+=s*H),u+=38*(I+=s*F),l+=38*(_+=s*z),d+=38*(A+=s*V),h+=38*(R+=s*q),p+=38*(P+=s*K),f+=38*(k+=s*$),g+=38*(B+=s*W),m+=38*(O+=s*G),y+=38*(x+=s*Y),b+=38*(N+=s*X),v+=38*(D+=s*J),i=(s=(i+=38*(w+=s*M))+(n=1)+65535)-65536*(n=Math.floor(s/65536)),o=(s=o+n+65535)-65536*(n=Math.floor(s/65536)),a=(s=a+n+65535)-65536*(n=Math.floor(s/65536)),c=(s=c+n+65535)-65536*(n=Math.floor(s/65536)),u=(s=u+n+65535)-65536*(n=Math.floor(s/65536)),l=(s=l+n+65535)-65536*(n=Math.floor(s/65536)),d=(s=d+n+65535)-65536*(n=Math.floor(s/65536)),h=(s=h+n+65535)-65536*(n=Math.floor(s/65536)),p=(s=p+n+65535)-65536*(n=Math.floor(s/65536)),f=(s=f+n+65535)-65536*(n=Math.floor(s/65536)),g=(s=g+n+65535)-65536*(n=Math.floor(s/65536)),m=(s=m+n+65535)-65536*(n=Math.floor(s/65536)),y=(s=y+n+65535)-65536*(n=Math.floor(s/65536)),b=(s=b+n+65535)-65536*(n=Math.floor(s/65536)),v=(s=v+n+65535)-65536*(n=Math.floor(s/65536)),S=(s=S+n+65535)-65536*(n=Math.floor(s/65536)),i=(s=(i+=n-1+37*(n-1))+(n=1)+65535)-65536*(n=Math.floor(s/65536)),o=(s=o+n+65535)-65536*(n=Math.floor(s/65536)),a=(s=a+n+65535)-65536*(n=Math.floor(s/65536)),c=(s=c+n+65535)-65536*(n=Math.floor(s/65536)),u=(s=u+n+65535)-65536*(n=Math.floor(s/65536)),l=(s=l+n+65535)-65536*(n=Math.floor(s/65536)),d=(s=d+n+65535)-65536*(n=Math.floor(s/65536)),h=(s=h+n+65535)-65536*(n=Math.floor(s/65536)),p=(s=p+n+65535)-65536*(n=Math.floor(s/65536)),f=(s=f+n+65535)-65536*(n=Math.floor(s/65536)),g=(s=g+n+65535)-65536*(n=Math.floor(s/65536)),m=(s=m+n+65535)-65536*(n=Math.floor(s/65536)),y=(s=y+n+65535)-65536*(n=Math.floor(s/65536)),b=(s=b+n+65535)-65536*(n=Math.floor(s/65536)),v=(s=v+n+65535)-65536*(n=Math.floor(s/65536)),S=(s=S+n+65535)-65536*(n=Math.floor(s/65536)),i+=n-1+37*(n-1),e[0]=i,e[1]=o,e[2]=a,e[3]=c,e[4]=u,e[5]=l,e[6]=d,e[7]=h,e[8]=p,e[9]=f,e[10]=g,e[11]=m,e[12]=y,e[13]=b,e[14]=v,e[15]=S}function H(e,t){j(e,t,t)}function F(e,r){var s,n=t();for(s=0;s<16;s++)n[s]=r[s];for(s=253;s>=0;s--)H(n,n),2!==s&&4!==s&&j(n,n,r);for(s=0;s<16;s++)e[s]=n[s]}function z(e,r){var s,n=t();for(s=0;s<16;s++)n[s]=r[s];for(s=250;s>=0;s--)H(n,n),1!==s&&j(n,n,r);for(s=0;s<16;s++)e[s]=n[s]}function V(e,r,s){var n,i,o=new Uint8Array(32),a=new Float64Array(80),u=t(),l=t(),d=t(),h=t(),p=t(),f=t();for(i=0;i<31;i++)o[i]=r[i];for(o[31]=127&r[31]|64,o[0]&=248,L(a,s),i=0;i<16;i++)l[i]=a[i],h[i]=u[i]=d[i]=0;for(u[0]=h[0]=1,i=254;i>=0;--i)O(u,l,n=o[i>>>3]>>>(7&i)&1),O(d,h,n),M(p,u,d),U(u,u,d),M(d,l,h),U(l,l,h),H(h,p),H(f,u),j(u,d,u),j(d,l,p),M(p,u,d),U(u,u,d),H(l,u),U(d,h,f),j(u,d,c),M(u,u,h),j(d,d,u),j(u,h,f),j(h,l,a),H(l,p),O(u,l,n),O(d,h,n);for(i=0;i<16;i++)a[i+16]=u[i],a[i+32]=d[i],a[i+48]=l[i],a[i+64]=h[i];var g=a.subarray(32),m=a.subarray(16);return F(g,g),j(m,m,g),x(e,m),0}function q(e,t){return V(e,t,i)}function K(e,t){return s(t,32),q(e,t)}function $(e,t,r){var s=new Uint8Array(32);return V(s,r,t),v(e,n,s,S)}I.prototype.blocks=function(e,t,r){for(var s,n,i,o,a,c,u,l,d,h,p,f,g,m,y,b,v,S,w,E=this.fin?0:2048,C=this.h[0],T=this.h[1],I=this.h[2],_=this.h[3],A=this.h[4],R=this.h[5],P=this.h[6],k=this.h[7],B=this.h[8],O=this.h[9],x=this.r[0],N=this.r[1],D=this.r[2],L=this.r[3],M=this.r[4],U=this.r[5],j=this.r[6],H=this.r[7],F=this.r[8],z=this.r[9];r>=16;)h=d=0,h+=(C+=8191&(s=255&e[t+0]|(255&e[t+1])<<8))*x,h+=(T+=8191&(s>>>13|(n=255&e[t+2]|(255&e[t+3])<<8)<<3))*(5*z),h+=(I+=8191&(n>>>10|(i=255&e[t+4]|(255&e[t+5])<<8)<<6))*(5*F),h+=(_+=8191&(i>>>7|(o=255&e[t+6]|(255&e[t+7])<<8)<<9))*(5*H),d=(h+=(A+=8191&(o>>>4|(a=255&e[t+8]|(255&e[t+9])<<8)<<12))*(5*j))>>>13,h&=8191,h+=(R+=a>>>1&8191)*(5*U),h+=(P+=8191&(a>>>14|(c=255&e[t+10]|(255&e[t+11])<<8)<<2))*(5*M),h+=(k+=8191&(c>>>11|(u=255&e[t+12]|(255&e[t+13])<<8)<<5))*(5*L),h+=(B+=8191&(u>>>8|(l=255&e[t+14]|(255&e[t+15])<<8)<<8))*(5*D),p=d+=(h+=(O+=l>>>5|E)*(5*N))>>>13,p+=C*N,p+=T*x,p+=I*(5*z),p+=_*(5*F),d=(p+=A*(5*H))>>>13,p&=8191,p+=R*(5*j),p+=P*(5*U),p+=k*(5*M),p+=B*(5*L),d+=(p+=O*(5*D))>>>13,p&=8191,f=d,f+=C*D,f+=T*N,f+=I*x,f+=_*(5*z),d=(f+=A*(5*F))>>>13,f&=8191,f+=R*(5*H),f+=P*(5*j),f+=k*(5*U),f+=B*(5*M),g=d+=(f+=O*(5*L))>>>13,g+=C*L,g+=T*D,g+=I*N,g+=_*x,d=(g+=A*(5*z))>>>13,g&=8191,g+=R*(5*F),g+=P*(5*H),g+=k*(5*j),g+=B*(5*U),m=d+=(g+=O*(5*M))>>>13,m+=C*M,m+=T*L,m+=I*D,m+=_*N,d=(m+=A*x)>>>13,m&=8191,m+=R*(5*z),m+=P*(5*F),m+=k*(5*H),m+=B*(5*j),y=d+=(m+=O*(5*U))>>>13,y+=C*U,y+=T*M,y+=I*L,y+=_*D,d=(y+=A*N)>>>13,y&=8191,y+=R*x,y+=P*(5*z),y+=k*(5*F),y+=B*(5*H),b=d+=(y+=O*(5*j))>>>13,b+=C*j,b+=T*U,b+=I*M,b+=_*L,d=(b+=A*D)>>>13,b&=8191,b+=R*N,b+=P*x,b+=k*(5*z),b+=B*(5*F),v=d+=(b+=O*(5*H))>>>13,v+=C*H,v+=T*j,v+=I*U,v+=_*M,d=(v+=A*L)>>>13,v&=8191,v+=R*D,v+=P*N,v+=k*x,v+=B*(5*z),S=d+=(v+=O*(5*F))>>>13,S+=C*F,S+=T*H,S+=I*j,S+=_*U,d=(S+=A*M)>>>13,S&=8191,S+=R*L,S+=P*D,S+=k*N,S+=B*x,w=d+=(S+=O*(5*z))>>>13,w+=C*z,w+=T*F,w+=I*H,w+=_*j,d=(w+=A*U)>>>13,w&=8191,w+=R*M,w+=P*L,w+=k*D,w+=B*N,C=h=8191&(d=(d=((d+=(w+=O*x)>>>13)<<2)+d|0)+(h&=8191)|0),T=p+=d>>>=13,I=f&=8191,_=g&=8191,A=m&=8191,R=y&=8191,P=b&=8191,k=v&=8191,B=S&=8191,O=w&=8191,t+=16,r-=16;this.h[0]=C,this.h[1]=T,this.h[2]=I,this.h[3]=_,this.h[4]=A,this.h[5]=R,this.h[6]=P,this.h[7]=k,this.h[8]=B,this.h[9]=O},I.prototype.finish=function(e,t){var r,s,n,i,o=new Uint16Array(10);if(this.leftover){for(i=this.leftover,this.buffer[i++]=1;i<16;i++)this.buffer[i]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(r=this.h[1]>>>13,this.h[1]&=8191,i=2;i<10;i++)this.h[i]+=r,r=this.h[i]>>>13,this.h[i]&=8191;for(this.h[0]+=5*r,r=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=r,r=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=r,o[0]=this.h[0]+5,r=o[0]>>>13,o[0]&=8191,i=1;i<10;i++)o[i]=this.h[i]+r,r=o[i]>>>13,o[i]&=8191;for(o[9]-=8192,s=(1^r)-1,i=0;i<10;i++)o[i]&=s;for(s=~s,i=0;i<10;i++)this.h[i]=this.h[i]&s|o[i];for(this.h[0]=65535&(this.h[0]|this.h[1]<<13),this.h[1]=65535&(this.h[1]>>>3|this.h[2]<<10),this.h[2]=65535&(this.h[2]>>>6|this.h[3]<<7),this.h[3]=65535&(this.h[3]>>>9|this.h[4]<<4),this.h[4]=65535&(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14),this.h[5]=65535&(this.h[6]>>>2|this.h[7]<<11),this.h[6]=65535&(this.h[7]>>>5|this.h[8]<<8),this.h[7]=65535&(this.h[8]>>>8|this.h[9]<<5),n=this.h[0]+this.pad[0],this.h[0]=65535&n,i=1;i<8;i++)n=(this.h[i]+this.pad[i]|0)+(n>>>16)|0,this.h[i]=65535&n;e[t+0]=this.h[0]>>>0&255,e[t+1]=this.h[0]>>>8&255,e[t+2]=this.h[1]>>>0&255,e[t+3]=this.h[1]>>>8&255,e[t+4]=this.h[2]>>>0&255,e[t+5]=this.h[2]>>>8&255,e[t+6]=this.h[3]>>>0&255,e[t+7]=this.h[3]>>>8&255,e[t+8]=this.h[4]>>>0&255,e[t+9]=this.h[4]>>>8&255,e[t+10]=this.h[5]>>>0&255,e[t+11]=this.h[5]>>>8&255,e[t+12]=this.h[6]>>>0&255,e[t+13]=this.h[6]>>>8&255,e[t+14]=this.h[7]>>>0&255,e[t+15]=this.h[7]>>>8&255},I.prototype.update=function(e,t,r){var s,n;if(this.leftover){for((n=16-this.leftover)>r&&(n=r),s=0;s<n;s++)this.buffer[this.leftover+s]=e[t+s];if(r-=n,t+=n,this.leftover+=n,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(r>=16&&(n=r-r%16,this.blocks(e,t,n),t+=n,r-=n),r){for(s=0;s<r;s++)this.buffer[this.leftover+s]=e[t+s];this.leftover+=r}};var W=R,G=P;var Y=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function X(e,t,r,s){for(var n,i,o,a,c,u,l,d,h,p,f,g,m,y,b,v,S,w,E,C,T,I,_,A,R,P,k=new Int32Array(16),B=new Int32Array(16),O=e[0],x=e[1],N=e[2],D=e[3],L=e[4],M=e[5],U=e[6],j=e[7],H=t[0],F=t[1],z=t[2],V=t[3],q=t[4],K=t[5],$=t[6],W=t[7],G=0;s>=128;){for(E=0;E<16;E++)C=8*E+G,k[E]=r[C+0]<<24|r[C+1]<<16|r[C+2]<<8|r[C+3],B[E]=r[C+4]<<24|r[C+5]<<16|r[C+6]<<8|r[C+7];for(E=0;E<80;E++)if(n=O,i=x,o=N,a=D,c=L,u=M,l=U,j,h=H,p=F,f=z,g=V,m=q,y=K,b=$,W,_=65535&(I=W),A=I>>>16,R=65535&(T=j),P=T>>>16,_+=65535&(I=(q>>>14|L<<18)^(q>>>18|L<<14)^(L>>>9|q<<23)),A+=I>>>16,R+=65535&(T=(L>>>14|q<<18)^(L>>>18|q<<14)^(q>>>9|L<<23)),P+=T>>>16,_+=65535&(I=q&K^~q&$),A+=I>>>16,R+=65535&(T=L&M^~L&U),P+=T>>>16,_+=65535&(I=Y[2*E+1]),A+=I>>>16,R+=65535&(T=Y[2*E]),P+=T>>>16,T=k[E%16],A+=(I=B[E%16])>>>16,R+=65535&T,P+=T>>>16,R+=(A+=(_+=65535&I)>>>16)>>>16,_=65535&(I=w=65535&_|A<<16),A=I>>>16,R=65535&(T=S=65535&R|(P+=R>>>16)<<16),P=T>>>16,_+=65535&(I=(H>>>28|O<<4)^(O>>>2|H<<30)^(O>>>7|H<<25)),A+=I>>>16,R+=65535&(T=(O>>>28|H<<4)^(H>>>2|O<<30)^(H>>>7|O<<25)),P+=T>>>16,A+=(I=H&F^H&z^F&z)>>>16,R+=65535&(T=O&x^O&N^x&N),P+=T>>>16,d=65535&(R+=(A+=(_+=65535&I)>>>16)>>>16)|(P+=R>>>16)<<16,v=65535&_|A<<16,_=65535&(I=g),A=I>>>16,R=65535&(T=a),P=T>>>16,A+=(I=w)>>>16,R+=65535&(T=S),P+=T>>>16,x=n,N=i,D=o,L=a=65535&(R+=(A+=(_+=65535&I)>>>16)>>>16)|(P+=R>>>16)<<16,M=c,U=u,j=l,O=d,F=h,z=p,V=f,q=g=65535&_|A<<16,K=m,$=y,W=b,H=v,E%16==15)for(C=0;C<16;C++)T=k[C],_=65535&(I=B[C]),A=I>>>16,R=65535&T,P=T>>>16,T=k[(C+9)%16],_+=65535&(I=B[(C+9)%16]),A+=I>>>16,R+=65535&T,P+=T>>>16,S=k[(C+1)%16],_+=65535&(I=((w=B[(C+1)%16])>>>1|S<<31)^(w>>>8|S<<24)^(w>>>7|S<<25)),A+=I>>>16,R+=65535&(T=(S>>>1|w<<31)^(S>>>8|w<<24)^S>>>7),P+=T>>>16,S=k[(C+14)%16],A+=(I=((w=B[(C+14)%16])>>>19|S<<13)^(S>>>29|w<<3)^(w>>>6|S<<26))>>>16,R+=65535&(T=(S>>>19|w<<13)^(w>>>29|S<<3)^S>>>6),P+=T>>>16,P+=(R+=(A+=(_+=65535&I)>>>16)>>>16)>>>16,k[C]=65535&R|P<<16,B[C]=65535&_|A<<16;_=65535&(I=H),A=I>>>16,R=65535&(T=O),P=T>>>16,T=e[0],A+=(I=t[0])>>>16,R+=65535&T,P+=T>>>16,P+=(R+=(A+=(_+=65535&I)>>>16)>>>16)>>>16,e[0]=O=65535&R|P<<16,t[0]=H=65535&_|A<<16,_=65535&(I=F),A=I>>>16,R=65535&(T=x),P=T>>>16,T=e[1],A+=(I=t[1])>>>16,R+=65535&T,P+=T>>>16,P+=(R+=(A+=(_+=65535&I)>>>16)>>>16)>>>16,e[1]=x=65535&R|P<<16,t[1]=F=65535&_|A<<16,_=65535&(I=z),A=I>>>16,R=65535&(T=N),P=T>>>16,T=e[2],A+=(I=t[2])>>>16,R+=65535&T,P+=T>>>16,P+=(R+=(A+=(_+=65535&I)>>>16)>>>16)>>>16,e[2]=N=65535&R|P<<16,t[2]=z=65535&_|A<<16,_=65535&(I=V),A=I>>>16,R=65535&(T=D),P=T>>>16,T=e[3],A+=(I=t[3])>>>16,R+=65535&T,P+=T>>>16,P+=(R+=(A+=(_+=65535&I)>>>16)>>>16)>>>16,e[3]=D=65535&R|P<<16,t[3]=V=65535&_|A<<16,_=65535&(I=q),A=I>>>16,R=65535&(T=L),P=T>>>16,T=e[4],A+=(I=t[4])>>>16,R+=65535&T,P+=T>>>16,P+=(R+=(A+=(_+=65535&I)>>>16)>>>16)>>>16,e[4]=L=65535&R|P<<16,t[4]=q=65535&_|A<<16,_=65535&(I=K),A=I>>>16,R=65535&(T=M),P=T>>>16,T=e[5],A+=(I=t[5])>>>16,R+=65535&T,P+=T>>>16,P+=(R+=(A+=(_+=65535&I)>>>16)>>>16)>>>16,e[5]=M=65535&R|P<<16,t[5]=K=65535&_|A<<16,_=65535&(I=$),A=I>>>16,R=65535&(T=U),P=T>>>16,T=e[6],A+=(I=t[6])>>>16,R+=65535&T,P+=T>>>16,P+=(R+=(A+=(_+=65535&I)>>>16)>>>16)>>>16,e[6]=U=65535&R|P<<16,t[6]=$=65535&_|A<<16,_=65535&(I=W),A=I>>>16,R=65535&(T=j),P=T>>>16,T=e[7],A+=(I=t[7])>>>16,R+=65535&T,P+=T>>>16,P+=(R+=(A+=(_+=65535&I)>>>16)>>>16)>>>16,e[7]=j=65535&R|P<<16,t[7]=W=65535&_|A<<16,G+=128,s-=128}return s}function J(e,t,r){var s,n=new Int32Array(8),i=new Int32Array(8),o=new Uint8Array(256),a=r;for(n[0]=1779033703,n[1]=3144134277,n[2]=1013904242,n[3]=2773480762,n[4]=1359893119,n[5]=2600822924,n[6]=528734635,n[7]=1541459225,i[0]=4089235720,i[1]=2227873595,i[2]=4271175723,i[3]=1595750129,i[4]=2917565137,i[5]=725511199,i[6]=4215389547,i[7]=327033209,X(n,i,t,r),r%=128,s=0;s<r;s++)o[s]=t[a-r+s];for(o[r]=128,o[(r=256-128*(r<112?1:0))-9]=0,f(o,r-8,a/536870912|0,a<<3),X(n,i,o,r),s=0;s<8;s++)f(e,8*s,n[s],i[s]);return 0}function Q(e,r){var s=t(),n=t(),i=t(),o=t(),a=t(),c=t(),u=t(),d=t(),h=t();U(s,e[1],e[0]),U(h,r[1],r[0]),j(s,s,h),M(n,e[0],e[1]),M(h,r[0],r[1]),j(n,n,h),j(i,e[3],r[3]),j(i,i,l),j(o,e[2],r[2]),M(o,o,o),U(a,n,s),U(c,o,i),M(u,o,i),M(d,n,s),j(e[0],a,c),j(e[1],d,u),j(e[2],u,c),j(e[3],a,d)}function Z(e,t,r){var s;for(s=0;s<4;s++)O(e[s],t[s],r)}function ee(e,r){var s=t(),n=t(),i=t();F(i,r[2]),j(s,r[0],i),j(n,r[1],i),x(e,n),e[31]^=D(s)<<7}function te(e,t,r){var s,n;for(k(e[0],o),k(e[1],a),k(e[2],a),k(e[3],o),n=255;n>=0;--n)Z(e,t,s=r[n/8|0]>>(7&n)&1),Q(t,e),Q(e,e),Z(e,t,s)}function re(e,r){var s=[t(),t(),t(),t()];k(s[0],d),k(s[1],h),k(s[2],a),j(s[3],d,h),te(e,s,r)}function se(e,r,n){var i,o=new Uint8Array(64),a=[t(),t(),t(),t()];for(n||s(r,32),J(o,r,32),o[0]&=248,o[31]&=127,o[31]|=64,re(a,o),ee(e,a),i=0;i<32;i++)r[i+32]=e[i];return 0}var ne=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function ie(e,t){var r,s,n,i;for(s=63;s>=32;--s){for(r=0,n=s-32,i=s-12;n<i;++n)t[n]+=r-16*t[s]*ne[n-(s-32)],r=Math.floor((t[n]+128)/256),t[n]-=256*r;t[n]+=r,t[s]=0}for(r=0,n=0;n<32;n++)t[n]+=r-(t[31]>>4)*ne[n],r=t[n]>>8,t[n]&=255;for(n=0;n<32;n++)t[n]-=r*ne[n];for(s=0;s<32;s++)t[s+1]+=t[s]>>8,e[s]=255&t[s]}function oe(e){var t,r=new Float64Array(64);for(t=0;t<64;t++)r[t]=e[t];for(t=0;t<64;t++)e[t]=0;ie(e,r)}function ae(e,r,s,n){var i,o,a=new Uint8Array(64),c=new Uint8Array(64),u=new Uint8Array(64),l=new Float64Array(64),d=[t(),t(),t(),t()];J(a,n,32),a[0]&=248,a[31]&=127,a[31]|=64;var h=s+64;for(i=0;i<s;i++)e[64+i]=r[i];for(i=0;i<32;i++)e[32+i]=a[32+i];for(J(u,e.subarray(32),s+32),oe(u),re(d,u),ee(e,d),i=32;i<64;i++)e[i]=n[i];for(J(c,e,s+64),oe(c),i=0;i<64;i++)l[i]=0;for(i=0;i<32;i++)l[i]=u[i];for(i=0;i<32;i++)for(o=0;o<32;o++)l[i+o]+=c[i]*a[o];return ie(e.subarray(32),l),h}function ce(e,r,s,n){var i,c=new Uint8Array(32),l=new Uint8Array(64),d=[t(),t(),t(),t()],h=[t(),t(),t(),t()];if(s<64)return-1;if(function(e,r){var s=t(),n=t(),i=t(),c=t(),l=t(),d=t(),h=t();return k(e[2],a),L(e[1],r),H(i,e[1]),j(c,i,u),U(i,i,e[2]),M(c,e[2],c),H(l,c),H(d,l),j(h,d,l),j(s,h,i),j(s,s,c),z(s,s),j(s,s,i),j(s,s,c),j(s,s,c),j(e[0],s,c),H(n,e[0]),j(n,n,c),N(n,i)&&j(e[0],e[0],p),H(n,e[0]),j(n,n,c),N(n,i)?-1:(D(e[0])===r[31]>>7&&U(e[0],o,e[0]),j(e[3],e[0],e[1]),0)}(h,n))return-1;for(i=0;i<s;i++)e[i]=r[i];for(i=0;i<32;i++)e[i+32]=n[i];if(J(l,e,s),oe(l),te(d,h,l),re(h,r.subarray(32)),Q(d,h),ee(c,d),s-=64,y(r,0,c,0)){for(i=0;i<s;i++)e[i]=0;return-1}for(i=0;i<s;i++)e[i]=r[i+64];return s}var ue=16,le=64,de=32,he=64;function pe(e,t){if(32!==e.length)throw new Error("bad key size");if(24!==t.length)throw new Error("bad nonce size")}function fe(){for(var e=0;e<arguments.length;e++)if(!(arguments[e]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function ge(e){for(var t=0;t<e.length;t++)e[t]=0}e.lowlevel={crypto_core_hsalsa20:v,crypto_stream_xor:T,crypto_stream:C,crypto_stream_salsa20_xor:w,crypto_stream_salsa20:E,crypto_onetimeauth:_,crypto_onetimeauth_verify:A,crypto_verify_16:m,crypto_verify_32:y,crypto_secretbox:R,crypto_secretbox_open:P,crypto_scalarmult:V,crypto_scalarmult_base:q,crypto_box_beforenm:$,crypto_box_afternm:W,crypto_box:function(e,t,r,s,n,i){var o=new Uint8Array(32);return $(o,n,i),W(e,t,r,s,o)},crypto_box_open:function(e,t,r,s,n,i){var o=new Uint8Array(32);return $(o,n,i),G(e,t,r,s,o)},crypto_box_keypair:K,crypto_hash:J,crypto_sign:ae,crypto_sign_keypair:se,crypto_sign_open:ce,crypto_secretbox_KEYBYTES:32,crypto_secretbox_NONCEBYTES:24,crypto_secretbox_ZEROBYTES:32,crypto_secretbox_BOXZEROBYTES:ue,crypto_scalarmult_BYTES:32,crypto_scalarmult_SCALARBYTES:32,crypto_box_PUBLICKEYBYTES:32,crypto_box_SECRETKEYBYTES:32,crypto_box_BEFORENMBYTES:32,crypto_box_NONCEBYTES:24,crypto_box_ZEROBYTES:32,crypto_box_BOXZEROBYTES:16,crypto_sign_BYTES:le,crypto_sign_PUBLICKEYBYTES:de,crypto_sign_SECRETKEYBYTES:he,crypto_sign_SEEDBYTES:32,crypto_hash_BYTES:64,gf:t,D:u,L:ne,pack25519:x,unpack25519:L,M:j,A:M,S:H,Z:U,pow2523:z,add:Q,set25519:k,modL:ie,scalarmult:te,scalarbase:re},e.randomBytes=function(e){var t=new Uint8Array(e);return s(t,e),t},e.secretbox=function(e,t,r){fe(e,t,r),pe(r,t);for(var s=new Uint8Array(32+e.length),n=new Uint8Array(s.length),i=0;i<e.length;i++)s[i+32]=e[i];return R(n,s,s.length,t,r),n.subarray(ue)},e.secretbox.open=function(e,t,r){fe(e,t,r),pe(r,t);for(var s=new Uint8Array(ue+e.length),n=new Uint8Array(s.length),i=0;i<e.length;i++)s[i+ue]=e[i];return s.length<32||0!==P(n,s,s.length,t,r)?null:n.subarray(32)},e.secretbox.keyLength=32,e.secretbox.nonceLength=24,e.secretbox.overheadLength=ue,e.scalarMult=function(e,t){if(fe(e,t),32!==e.length)throw new Error("bad n size");if(32!==t.length)throw new Error("bad p size");var r=new Uint8Array(32);return V(r,e,t),r},e.scalarMult.base=function(e){if(fe(e),32!==e.length)throw new Error("bad n size");var t=new Uint8Array(32);return q(t,e),t},e.scalarMult.scalarLength=32,e.scalarMult.groupElementLength=32,e.box=function(t,r,s,n){var i=e.box.before(s,n);return e.secretbox(t,r,i)},e.box.before=function(e,t){fe(e,t),function(e,t){if(32!==e.length)throw new Error("bad public key size");if(32!==t.length)throw new Error("bad secret key size")}(e,t);var r=new Uint8Array(32);return $(r,e,t),r},e.box.after=e.secretbox,e.box.open=function(t,r,s,n){var i=e.box.before(s,n);return e.secretbox.open(t,r,i)},e.box.open.after=e.secretbox.open,e.box.keyPair=function(){var e=new Uint8Array(32),t=new Uint8Array(32);return K(e,t),{publicKey:e,secretKey:t}},e.box.keyPair.fromSecretKey=function(e){if(fe(e),32!==e.length)throw new Error("bad secret key size");var t=new Uint8Array(32);return q(t,e),{publicKey:t,secretKey:new Uint8Array(e)}},e.box.publicKeyLength=32,e.box.secretKeyLength=32,e.box.sharedKeyLength=32,e.box.nonceLength=24,e.box.overheadLength=e.secretbox.overheadLength,e.sign=function(e,t){if(fe(e,t),t.length!==he)throw new Error("bad secret key size");var r=new Uint8Array(le+e.length);return ae(r,e,e.length,t),r},e.sign.open=function(e,t){if(fe(e,t),t.length!==de)throw new Error("bad public key size");var r=new Uint8Array(e.length),s=ce(r,e,e.length,t);if(s<0)return null;for(var n=new Uint8Array(s),i=0;i<n.length;i++)n[i]=r[i];return n},e.sign.detached=function(t,r){for(var s=e.sign(t,r),n=new Uint8Array(le),i=0;i<n.length;i++)n[i]=s[i];return n},e.sign.detached.verify=function(e,t,r){if(fe(e,t,r),t.length!==le)throw new Error("bad signature size");if(r.length!==de)throw new Error("bad public key size");var s,n=new Uint8Array(le+e.length),i=new Uint8Array(le+e.length);for(s=0;s<le;s++)n[s]=t[s];for(s=0;s<e.length;s++)n[s+le]=e[s];return ce(i,n,n.length,r)>=0},e.sign.keyPair=function(){var e=new Uint8Array(de),t=new Uint8Array(he);return se(e,t),{publicKey:e,secretKey:t}},e.sign.keyPair.fromSecretKey=function(e){if(fe(e),e.length!==he)throw new Error("bad secret key size");for(var t=new Uint8Array(de),r=0;r<t.length;r++)t[r]=e[32+r];return{publicKey:t,secretKey:new Uint8Array(e)}},e.sign.keyPair.fromSeed=function(e){if(fe(e),32!==e.length)throw new Error("bad seed size");for(var t=new Uint8Array(de),r=new Uint8Array(he),s=0;s<32;s++)r[s]=e[s];return se(t,r,!0),{publicKey:t,secretKey:r}},e.sign.publicKeyLength=de,e.sign.secretKeyLength=he,e.sign.seedLength=32,e.sign.signatureLength=le,e.hash=function(e){fe(e);var t=new Uint8Array(64);return J(t,e,e.length),t},e.hash.hashLength=64,e.verify=function(e,t){return fe(e,t),0!==e.length&&0!==t.length&&(e.length===t.length&&0===g(e,0,t,0,e.length))},e.setPRNG=function(e){s=e},function(){var t="undefined"!=typeof self?self.crypto||self.msCrypto:null;if(t&&t.getRandomValues){e.setPRNG((function(e,r){var s,n=new Uint8Array(r);for(s=0;s<r;s+=65536)t.getRandomValues(n.subarray(s,s+Math.min(r-s,65536)));for(s=0;s<r;s++)e[s]=n[s];ge(n)}))}else(t=r(6982))&&t.randomBytes&&e.setPRNG((function(e,r){var s,n=t.randomBytes(r);for(s=0;s<r;s++)e[s]=n[s];ge(n)}))}()}(e.exports?e.exports:self.nacl=self.nacl||{})},4579:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTCStatsReport=void 0,t.generateStatsId=function(e,...t){const r=t.filter((e=>void 0!==e));return`${e}_${r.join("_")}`},t.getStatsTimestamp=function(){return performance.now()};class r extends Map{constructor(e){if(super(),e)for(const t of e)this.set(t.id,t)}}t.RTCStatsReport=r},4582:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTCRtpSimulcastParameters=t.RTCRtpCodingParameters=t.RTCRtpRtxParameters=t.RTCRtcpFeedback=t.RTCRtcpParameters=t.RTCRtpHeaderExtensionParameters=t.RTCRtpCodecParameters=void 0;t.RTCRtpCodecParameters=class{constructor(e){this.rtcpFeedback=[],this.direction="all",Object.assign(this,e)}get name(){return this.mimeType.split("/")[1]}get contentType(){return this.mimeType.split("/")[0]}get str(){let e=`${this.name}/${this.clockRate}`;return 2===this.channels&&(e+="/2"),e}};t.RTCRtpHeaderExtensionParameters=class{constructor(e){Object.assign(this,e)}};t.RTCRtcpParameters=class{constructor(e={}){this.mux=!1,Object.assign(this,e)}};t.RTCRtcpFeedback=class{constructor(e={}){Object.assign(this,e)}};t.RTCRtpRtxParameters=class{constructor(e={}){Object.assign(this,e)}};t.RTCRtpCodingParameters=class{constructor(e){Object.assign(this,e)}};t.RTCRtpSimulcastParameters=class{constructor(e){Object.assign(this,e)}}},4610:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=async function(e){await new Promise((t=>setTimeout(t,e)))}},4652:(e,t,r)=>{"undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?e.exports=r(3144):e.exports=r(314)},4682:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.crypto=void 0;const s=r(7598);t.crypto=s&&"object"==typeof s&&"webcrypto"in s?s.webcrypto:s&&"object"==typeof s&&"randomBytes"in s?s:void 0},4687:(e,t)=>{"use strict";var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.methods=t.classes=t.AttributeKeys=t.RETRY_RTO=t.RETRY_MAX=t.IPV6_PROTOCOL=t.IPV4_PROTOCOL=t.INTEGRITY_LENGTH=t.HEADER_LENGTH=t.FINGERPRINT_XOR=t.FINGERPRINT_LENGTH=t.COOKIE=void 0,t.COOKIE=554869826,t.FINGERPRINT_LENGTH=8,t.FINGERPRINT_XOR=1398035790,t.HEADER_LENGTH=20,t.INTEGRITY_LENGTH=24,t.IPV4_PROTOCOL=1,t.IPV6_PROTOCOL=2,t.RETRY_MAX=6,t.RETRY_RTO=50,t.AttributeKeys=["FINGERPRINT","MESSAGE-INTEGRITY","CHANGE-REQUEST","PRIORITY","USERNAME","ICE-CONTROLLING","SOURCE-ADDRESS","USE-CANDIDATE","ICE-CONTROLLED","ERROR-CODE","XOR-MAPPED-ADDRESS","CHANGED-ADDRESS","LIFETIME","REQUESTED-TRANSPORT","NONCE","REALM","XOR-RELAYED-ADDRESS","CHANNEL-NUMBER","XOR-PEER-ADDRESS","DATA","SOFTWARE","MAPPED-ADDRESS","RESPONSE-ORIGIN","OTHER-ADDRESS"],function(e){e[e.REQUEST=0]="REQUEST",e[e.INDICATION=16]="INDICATION",e[e.RESPONSE=256]="RESPONSE",e[e.ERROR=272]="ERROR"}(r||(t.classes=r={})),function(e){e[e.BINDING=1]="BINDING",e[e.SHARED_SECRET=2]="SHARED_SECRET",e[e.ALLOCATE=3]="ALLOCATE",e[e.REFRESH=4]="REFRESH",e[e.SEND=6]="SEND",e[e.DATA=7]="DATA",e[e.CREATE_PERMISSION=8]="CREATE_PERMISSION",e[e.CHANNEL_BIND=9]="CHANNEL_BIND"}(s||(t.methods=s={}))},4694:(e,t)=>{t.jspack=new function(){var e,t=!1,r=this;r._DeArray=function(e,t,r){return[e.slice(t,t+r)]},r._EnArray=function(e,t,r,s){for(var n=0;n<r;e[t+n]=s[n]?s[n]:0,n++);},r._DeChar=function(e,t){return String.fromCharCode(e[t])},r._EnChar=function(e,t,r){e[t]=r.charCodeAt(0)},r._DeInt=function(r,s){var n,i,o,a=t?e.len-1:0,c=t?-1:1,u=a+c*e.len;for(n=0,i=a,o=1;i!=u;n+=r[s+i]*o,i+=c,o*=256);return e.bSigned&&n&Math.pow(2,8*e.len-1)&&(n-=Math.pow(2,8*e.len)),n},r._EnInt=function(r,s,n){var i,o=t?e.len-1:0,a=t?-1:1,c=o+a*e.len;for(n=n<e.min?e.min:n>e.max?e.max:n,i=o;i!=c;r[s+i]=255&n,i+=a,n>>=8);},r._DeString=function(e,t,r){for(var s=new Array(r),n=0;n<r;s[n]=String.fromCharCode(e[t+n]),n++);return s.join("")},r._EnString=function(e,t,r,s){for(var n,i=0;i<r;e[t+i]=(n=s.charCodeAt(i))?n:0,i++);},r._De754=function(r,s){var n,i,o,a,c,u,l,d,h,p;for(l=e.mLen,h=(p=(1<<(d=8*e.len-e.mLen-1))-1)>>1,a=t?0:e.len-1,c=t?1:-1,n=r[s+a],a+=c,i=n&(1<<-(u=-7))-1,n>>=-u,u+=d;u>0;i=256*i+r[s+a],a+=c,u-=8);for(o=i&(1<<-u)-1,i>>=-u,u+=l;u>0;o=256*o+r[s+a],a+=c,u-=8);switch(i){case 0:i=1-h;break;case p:return o?NaN:1/0*(n?-1:1);default:o+=Math.pow(2,l),i-=h}return(n?-1:1)*o*Math.pow(2,i-l)},r._En754=function(r,s,n){var i,o,a,c,u,l,d,h,p,f;for(d=e.mLen,p=(f=(1<<(h=8*e.len-e.mLen-1))-1)>>1,i=n<0?1:0,n=Math.abs(n),isNaN(n)||n==1/0?(a=isNaN(n)?1:0,o=f):(o=Math.floor(Math.log(n)/Math.LN2),n*(l=Math.pow(2,-o))<1&&(o--,l*=2),(n+=o+p>=1?e.rt/l:e.rt*Math.pow(2,1-p))*l>=2&&(o++,l/=2),o+p>=f?(a=0,o=f):o+p>=1?(a=(n*l-1)*Math.pow(2,d),o+=p):(a=n*Math.pow(2,p-1)*Math.pow(2,d),o=0)),c=t?e.len-1:0,u=t?-1:1;d>=8;r[s+c]=255&a,c+=u,a/=256,d-=8);for(o=o<<d|a,h+=d;h>0;r[s+c]=255&o,c+=u,o/=256,h-=8);r[s+c-u]|=128*i},r._DeInt64=function(r,s){var n,i,o,a=t?0:7,c=t?1:-1,u=a+8*c,l=[0,0,!e.bSigned];for(n=a,o=1,i=0;n!=u;l[o]=(l[o]<<8>>>0)+r[s+n],n+=c,o=++i<4?1:0);return l},r._EnInt64=function(e,r,s){var n,i,o,a,c=t?0:7,u=t?1:-1,l=c+8*u;for(n=c,o=1,i=0,a=24;n!=l;e[r+n]=s[o]>>a&255,n+=u,o=++i<4?1:0,a=24-i%4*8);},r._sPattern="(\\d + )?([AxcbBhHsfdiIlLqQ])",r._lenLut={A:1,x:1,c:1,b:1,B:1,h:2,H:2,s:1,f:4,d:8,i:4,I:4,l:4,L:4,q:8,Q:8},r._elLut={A:{en:r._EnArray,de:r._DeArray},s:{en:r._EnString,de:r._DeString},c:{en:r._EnChar,de:r._DeChar},b:{en:r._EnInt,de:r._DeInt,len:1,bSigned:!0,min:-Math.pow(2,7),max:Math.pow(2,7)-1},B:{en:r._EnInt,de:r._DeInt,len:1,bSigned:!1,min:0,max:Math.pow(2,8)-1},h:{en:r._EnInt,de:r._DeInt,len:2,bSigned:!0,min:-Math.pow(2,15),max:Math.pow(2,15)-1},H:{en:r._EnInt,de:r._DeInt,len:2,bSigned:!1,min:0,max:Math.pow(2,16)-1},i:{en:r._EnInt,de:r._DeInt,len:4,bSigned:!0,min:-Math.pow(2,31),max:Math.pow(2,31)-1},I:{en:r._EnInt,de:r._DeInt,len:4,bSigned:!1,min:0,max:Math.pow(2,32)-1},l:{en:r._EnInt,de:r._DeInt,len:4,bSigned:!0,min:-Math.pow(2,31),max:Math.pow(2,31)-1},L:{en:r._EnInt,de:r._DeInt,len:4,bSigned:!1,min:0,max:Math.pow(2,32)-1},f:{en:r._En754,de:r._De754,len:4,mLen:23,rt:Math.pow(2,-24)-Math.pow(2,-77)},d:{en:r._En754,de:r._De754,len:8,mLen:52,rt:0},q:{en:r._EnInt64,de:r._DeInt64,bSigned:!0},Q:{en:r._EnInt64,de:r._DeInt64,bSigned:!1}},r._UnpackSeries=function(t,r,s,n){for(var i=e.de,o=[],a=0;a<t;o.push(i(s,n+a*r)),a++);return o},r._PackSeries=function(t,r,s,n,i,o){for(var a=e.en,c=0;c<t;a(s,n+c*r,i[o+c]),c++);},r.Unpack=function(r,s,n){t="<"!=r.charAt(0),n=n||0;for(var i,o,a,c=new RegExp(this._sPattern,"g"),u=[];i=c.exec(r);){if(n+(o=null==i[1]||""==i[1]?1:parseInt(i[1]))*(a=this._lenLut[i[2]])>s.length)return;switch(i[2]){case"A":case"s":u.push(this._elLut[i[2]].de(s,n,o));break;case"c":case"b":case"B":case"h":case"H":case"i":case"I":case"l":case"L":case"f":case"d":case"q":case"Q":e=this._elLut[i[2]],u.push(this._UnpackSeries(o,a,s,n))}n+=o*a}return Array.prototype.concat.apply([],u)},r.PackTo=function(r,s,n,i){t="<"!=r.charAt(0);for(var o,a,c,u,l=new RegExp(this._sPattern,"g"),d=0;o=l.exec(r);){if(n+(a=null==o[1]||""==o[1]?1:parseInt(o[1]))*(c=this._lenLut[o[2]])>s.length)return!1;switch(o[2]){case"A":case"s":if(d+1>i.length)return!1;this._elLut[o[2]].en(s,n,a,i[d]),d+=1;break;case"c":case"b":case"B":case"h":case"H":case"i":case"I":case"l":case"L":case"f":case"d":case"q":case"Q":if(e=this._elLut[o[2]],d+a>i.length)return!1;this._PackSeries(a,c,s,n,i,d),d+=a;break;case"x":for(u=0;u<a;u++)s[n+u]=0}n+=a*c}return s},r.Pack=function(e,t){return this.PackTo(e,new Array(this.CalcLength(e)),0,t)},r.CalcLength=function(e){for(var t,r=new RegExp(this._sPattern,"g"),s=0;t=r.exec(e);)s+=(null==t[1]||""==t[1]?1:parseInt(t[1]))*this._lenLut[t[2]];return s}}},4756:e=>{"use strict";e.exports=require("tls")},4774:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(181),n(r(6157),t),n(r(9543),t),n(r(6719),t),n(r(4848),t),n(r(4221),t),n(r(3826),t),n(r(7177),t),n(r(8982),t),n(r(5808),t),n(r(7821),t),n(r(3119),t),n(r(1636),t),n(r(2332),t),n(r(6879),t),n(r(2933),t),n(r(8433),t),n(r(1867),t),n(r(575),t),n(r(8007),t),n(r(1193),t),n(r(145),t),n(r(9142),t),n(r(9821),t),n(r(7164),t)},4779:(e,t)=>{"use strict";async function r(e,t){if(!t())return new Promise(((r,s)=>{const n=e.subscribe((()=>{try{t()&&(n.unSubscribe(),r(void 0))}catch(e){n.unSubscribe(),s(e)}}))}))}function s(e){return"closed"===e.connectionState||"disconnected"===e.connectionState||"failed"===e.connectionState}function n(e){return"disconnected"===e.iceConnectionState||"failed"===e.iceConnectionState||"closed"===e.iceConnectionState}Object.defineProperty(t,"__esModule",{value:!0}),t.waitConnected=function(e){return r(e.connectionStateChange,(()=>{if(s(e))throw new Error("peer connection closed");return"connected"===e.connectionState}))},t.waitIceConnected=function(e){return r(e.iceConnectionStateChange,(()=>{if(n(e))throw new Error("peer ice connection closed");return"connected"===e.iceConnectionState||"completed"===e.iceConnectionState}))},t.waitClosed=async function(e){const t=r(e.connectionStateChange,(()=>s(e))),i=r(e.iceConnectionStateChange,(()=>n(e)));await Promise.any([t,i]),await e.close()},t.logConnectionState=function(e,t){t.iceConnectionStateChange.subscribe((()=>e.log("iceConnectionState",t.iceConnectionState))),t.iceGatheringStateChange.subscribe((()=>e.log("iceGatheringState",t.iceGatheringState))),t.signalingStateChange.subscribe((()=>e.log("signalingState",t.signalingState))),t.connectionStateChange.subscribe((()=>e.log("connectionState",t.connectionState)))}},4813:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createRawResponse=function(e){return{type:e.type,sdp:e.sdp}},t.isPeerConnectionAlive=function(e){return"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState&&"closed"!==e.iceConnectionState&&("closed"!==e.connectionState&&"disconnected"!==e.connectionState&&"failed"!==e.connectionState)},t.getWeriftIceServers=function(e){if(!e?.iceServers)return;const t=[];for(const r of e.iceServers)if("string"==typeof r.urls)t.push({...r});else for(const e of r.urls)t.push(Object.assign({},r,{urls:e}));return t},t.isLocalIceTransport=c,t.logIsLocalIceTransport=function(e,t){const r=c(t);return e.log("Connection is local network:",r.isLocalNetwork,r.destinationId,r),r};const n=s(r(3139)),i=s(r(857));const o=n.default.cidrSubnet("198.18.0.0/15");function a(e){return n.default.isPrivate(e)||o.contains(e)}function c(e){let t,r,s=!0;for(const o of e.iceTransports){const{remoteAddr:e,localCandidate:c,remoteCandidate:u}=o.connection.nominated,[l,d]=e;r=u.type,t||(t=l);let h=!1;try{const e=Object.values(i.default.networkInterfaces()).flat().find((e=>e.address===c.host));h=n.default.cidrSubnet(e.cidr).contains(l)}catch(e){}s=s&&(a(l)||h)}return{ipv4:n.default.isV4Format(t),type:r,isLocalNetwork:s,destinationId:t}}},4848:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.timer=void 0,t.enumerate=function(e){return e.map(((e,t)=>[t,e]))},t.growBufferSize=function(e,t){const r=Buffer.alloc(t);return e.copy(r),r},t.Int=function(e){return Number.parseInt(e.toString(),10)},t.isMedia=function(e){const t=e[0];return t>127&&t<192},t.timer={setTimeout:(...e)=>{const t=setTimeout(...e);return()=>clearTimeout(t)},setInterval:(...e)=>{const t=setInterval((()=>{e[0]()}),...e.slice(1));return()=>clearInterval(t)}}},4890:(e,t)=>{"use strict";function r(e){let t=e.split("\n").map((e=>e.trim()));t=t.filter((e=>!e.includes("a=control:")));let r=0;for(let e=0;e<t.length;e++){t[e].startsWith("m=")&&(t.splice(e+1,0,"a=control:trackID="+r),r++)}return t.join("\r\n")}function s(e,t,r=["recvonly","sendrecv"]){const s=function(e){return("\n"+e).split("\nm=")}(e).filter((e=>e.startsWith(t)));for(const e of s){const t=()=>{const t=e.split("\n").map((e=>e.trim())),r="a=control:",s=t.find((e=>e.startsWith(r)));return{section:"m="+e,trackId:s.substring(10)}};for(const s of r)if(e.includes(`a=${s}`))return t();if(r.includes("recvonly")&&!e.includes("sendonly")&&!e.includes("inactive"))return t()}}function n(e){const t=[];for(const r of e.split(" ").slice(3)||[])t.push(parseInt(r));return t}function i(e){const t=e.split(" ");return{type:t[0].substring(2),port:parseInt(t[1]),protocol:t[2],payloadTypes:n(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.replacePorts=function(e,t,r){return e.replace(/c=IN .*/,"c=IN IP4 127.0.0.1").replace(/m=audio \d+/,`m=audio ${t}`).replace(/m=video \d+/,`m=video ${r}`)},t.replaceSectionPort=function(e,t,r){const s=new RegExp(`m=${t} \\d+`);return e.replace(/c=IN .*/,"c=IN IP4 127.0.0.1").replace(s,`m=${t} ${r}`)},t.addTrackControls=r,t.createSdpInput=function(e,t,s){let n=s.replace(/c=IN .*/,"c=IN IP4 127.0.0.1").replace(/m=audio \d+/,`m=audio ${e}`).replace(/m=video \d+/,`m=video ${t}`),i=n.split("\n").map((e=>e.trim()));return i=i.filter((e=>!e.includes("a=rtcp-mux"))).filter((e=>!e.includes("a=candidate"))).filter((e=>!e.includes("a=ice"))),n=i.join("\r\n"),n=r(n),n=n.split("m=").slice(1).map((e=>"m="+e)).join(""),n},t.findFmtp=function(e,t){let r=e.split("\n").map((e=>e.trim()));const s=new RegExp(`a=rtpmap:(\\d+) ${t}`);return r.map((e=>e.match(s))).filter((e=>!!e)).map((e=>{const t=parseInt(e[1]),s=`a=fmtp:${t} `,n=r.find((e=>e.startsWith(s)))?.substring(s.length);return{payloadType:t,fmtp:n}}))},t.findTrackByType=s,t.findTracksByType=function(e,t=["recvonly","sendrecv"]){return{audio:s(e,"audio",t)?.trackId,video:s(e,"video",t)?.trackId}},t.parseMLinePayloadTypes=n,t.parseMLine=i,t.parseFmtp=a,t.parseRtpMap=c,t.parseMSection=d,t.parseSdp=function(e){const t=e.split("\n").map((e=>e.trim())),r=[],s=[];let n;for(const e of t)e.startsWith("m=")&&(n&&s.push(n),n=[]),n?n.push(e):r.push(e);n&&s.push(n);const i={header:{lines:r,contents:r.join("\r\n")},msections:s.map(d),toSdp:()=>[...i.header.lines,...i.msections.map((e=>e.lines)).flat()].join("\r\n")};return i},t.getSpsPps=function(e){const t=e?.fmtp?.[0]?.parameters?.["sprop-parameter-sets"]?.split(",");if(2!==t?.length)return{sps:void 0,pps:void 0};const[r,s]=t;return{sps:Buffer.from(r,"base64"),pps:Buffer.from(s,"base64")}},t.getSpsPpsVps=function(e){const t=e?.fmtp?.[0]?.parameters;if(!t)return{sps:void 0,pps:void 0,vps:void 0};const r=t["sprop-sps"],s=t["sprop-pps"],n=t["sprop-vps"];return{sps:r?Buffer.from(r,"base64"):void 0,pps:s?Buffer.from(s,"base64"):void 0,vps:n?Buffer.from(n,"base64"):void 0}};const o="a=fmtp";function a(e){return e.filter((e=>e.startsWith(o))).map((e=>{const t=e.indexOf(" ");if(-1===t)return;const r=e.substring(0,t),s=e.substring(t+1),n=parseInt(r.split(":")[1]);if(!r||!s||Number.isNaN(n))return;const i={};return s.split(";").map((e=>e.trim())).forEach((e=>{const[t,...r]=e.split("=");i[t]=r.join("=")})),{payloadType:n,parameters:i}})).filter((e=>!!e))}function c(e,t){const r=e.type,s=t?.match(/a=rtpmap:([\d]+) (.*?)\/([\d]+)(\/([\d]+))?/);let n,i,o=parseInt(s?.[5])||void 0,a=parseInt(s?.[1]);t=t?.toLowerCase(),t?.includes("mpeg4")?(n="aac",i="aac"):t?.includes("opus")?(n="opus",i="libopus"):t?.includes("pcma")?(n="pcm_alaw",i="pcm_alaw"):t?.includes("pcmu")?(n="pcm_mulaw",i="pcm_mulaw"):t?.includes("g726")?n="g726":t?.includes("pcm")?n="pcm":t?.includes("l16")?(n="pcm_s16be",i="pcm_s16be"):t?.includes("speex")?(n="speex",i="libspeex"):t?.includes("h264")?n="h264":t?.includes("h265")?n="h265":t||"audio"!==r||(e.payloadTypes?.includes(0)?(n="pcm_mulaw",i="pcm_mulaw",a=0,o=1):e.payloadTypes?.includes(8)?(n="pcm_alaw",i="pcm_alaw",a=8,o=1):e.payloadTypes?.includes(14)?(n="mp3",i="mp3",a=14,o=2):(n="pcm_alaw",i="pcm_alaw",a=8,o=1));let c=parseInt(s?.[3]);return c||(c=void 0,"pcm_mulaw"===n||"pcm_alaw"===n?c=8e3:"pcm_s16be"===n&&(c=16e3)),{line:t,codec:n,ffmpegEncoder:i,rawCodec:s?.[2],clock:c,channels:o,payloadType:a}}const u="a=control:",l="a=rtpmap:";function d(e){const t=e.find((e=>e.startsWith(u)))?.substring(u.length),r=i(e[0]),s=e.filter((e=>e.startsWith(l))),n=s.map((e=>c(r,e))),o=c(r,s[0]),{codec:d}=o;let h;for(const t of["sendonly","sendrecv","recvonly","inactive"]){if(e.find((e=>e==="a="+t))){h=t;break}}const p={...r,fmtp:a(e),lines:e,rtpmaps:n,contents:e.join("\r\n"),control:t,codec:d,rtpmap:o,direction:h,toSdp:()=>p.lines.join("\r\n")};return p}},4933:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9023),n="-----BEGIN ",i="-----END ",o="-----",a="Proc-Type";class c{static parse(e){const t=[],r=e.toString("utf8").split("\n").map((e=>e.trim())).filter((e=>""!==e&&!e.startsWith("#")));for(;r.length>0;)t.push(u(r));if(0===t.length)throw new Error("PEM: no block");return t}constructor(e,t){this.type=e,this.body=t,this.headers=Object.create(null)}get procType(){return this.getHeader(a)}getHeader(e){const t=this.headers[e];return null==t?"":t}setHeader(e,t){if(e.includes(":"))throw new Error("pem: cannot encode a header key that contains a colon");if(""===e||""===t)throw new Error("pem: invalid header key or value");this.headers[e]=t}toString(){let e=n+this.type+o+"\n";const t=Object.keys(this.headers);if(t.length>0){const r=this.procType;""!==r&&(e+=`${a}: ${r}\n`),t.sort();for(const r of t)r!==a&&(e+=`${r}: ${this.headers[r]}\n`);e+="\n"}const r=this.body.toString("base64");let s=0;for(;s<r.length;)e+=r.slice(s,s+64)+"\n",s+=64;return e+=i+this.type+o+"\n",e}toBuffer(){return Buffer.from(this.toString(),"utf8")}valueOf(){return this.body}toJSON(){return{type:this.type,body:this.body,headers:this.headers}}[s.inspect.custom](e,t){return`<${this.constructor.name} ${s.inspect(this.toJSON(),t)}>`}}function u(e){let t=e.shift();if(null==t||!t.startsWith(n)||!t.endsWith(o))throw new Error("pem: invalid BEGIN line");const r=t.slice(11,t.length-5);if(""===r)throw new Error("pem: invalid type");const s=[];for(t=e.shift();null!=t&&t.includes(": ");){const r=t.split(": ");if(2!==r.length||""===r[0]||""===r[1])throw new Error("pem: invalid Header line");s.push(r),t=e.shift()}let a="";for(;null!=t&&!t.startsWith(i);)a+=t,t=e.shift();if(null==t||t!==`${i}${r}${o}`)throw new Error("pem: invalid END line");const u=new c(r,Buffer.from(a,"base64"));if(""===a||u.body.toString("base64")!==a)throw new Error("pem: invalid base64 body");for(const e of s)u.setHeader(e[0],e[1]);return u}t.PEM=c},4953:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientHello=void 0;const s=r(6353),n=r(7077),i=r(3268),o=r(9602),a=r(9750);class c{constructor(e,t,r,s,n,i,a){this.clientVersion=e,this.random=t,this.sessionId=r,this.cookie=s,this.cipherSuites=n,this.compressionMethods=i,this.extensions=a,this.msgType=o.HandshakeType.client_hello_1,this.messageSeq=0}static createEmpty(){return new c(void 0,void 0,void 0,void 0,void 0,void 0,void 0)}static deSerialize(e){return new c(...Object.values((0,s.decode)(e,c.spec)))}serialize(){const e=(0,s.encode)(this,c.spec).slice();return Buffer.from(e)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.ClientHello=c,c.spec={clientVersion:{major:s.types.uint8,minor:s.types.uint8},random:a.DtlsRandom.spec,sessionId:s.types.buffer(s.types.uint8),cookie:s.types.buffer(s.types.uint8),cipherSuites:s.types.array(s.types.uint16be,s.types.uint16be,"bytes"),compressionMethods:s.types.array(s.types.uint8,s.types.uint8,"bytes"),extensions:i.ExtensionList}},4991:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDuplexRpcPeer=function(e,t,r,s){const i=o(s),a=new n.RpcPeer(e,t,((e,t,s)=>{try{i.sendMessage(e,t,s)}catch(e){t?.(e),r.destroy()}}));return i.setupRpcPeer(a),r.on("data",(e=>i.onData(e))),r.on("close",i.onDisconnected),r.on("error",i.onDisconnected),a},t.createRpcSerializer=i,t.createRpcDuplexSerializer=o,t.createDataChannelSerializer=function(e){let t;function r(r){const s=!!t;t||(t=[]),t.push(r),s||setTimeout((()=>function(){if(!t||0===t.length)return;const r=t;t=void 0;for(const t of r){let r=0;for(;r<t.length;){const s=t.length-r,n=Math.min(s,16384),i=t.subarray(r,r+n);e.send(i),r+=n}}}()),0)}return o({write:e=>{r(e)}})};const s=r(2334),n=r(8114);function i(e){let t;const{sendMessageBuffer:r,sendMessageFinish:n}=e;let i=!0;let o;return{kill:e=>{t.kill(e)},sendMessage:(e,t,s)=>{if(!i)return void t?.(new Error("peer disconnected"));const o=s?.buffers;if(o)for(const e of o)r(e);n(e)},setupRpcPeer:e=>{t=e,t.addSerializer(Buffer,"Buffer",new s.SidebandBufferSerializer),t.constructorSerializerMap.set(Uint8Array,"Buffer")},onMessageBuffer:e=>{o=o||{},o.buffers||=[];o.buffers.push(e)},onMessageFinish:e=>{const r=o;o=void 0,t.handleMessage(e,r)},onDisconnected:()=>{i=!1,t.kill("connection closed.")}}}function o(e){const t=t=>r=>((t,r)=>{const s=Buffer.alloc(5);s.writeUInt32BE(r.length+1,0),s.writeUInt8(t,4),e.write(Buffer.concat([s,r]))})(t,r),r=t(1),s=t(0),n=i({sendMessageBuffer:r,sendMessageFinish:e=>s(Buffer.from(JSON.stringify(e)))});let o,a,c,u;return{onData:e=>{for(;e.length;){if(!a){if(o=o?Buffer.concat([o,e]):e,o.length<5)return;e=o.slice(5);const t=o.readUInt32BE(0)-1;u=o.readUInt8(4),e.length>=t&&0===u?(a=e.length===t?e:e.slice(0,t),c=t,e=e.slice(t)):(a=Buffer.alloc(t),c=0),o=void 0}const t=a.length-c;if(t){const r=e.slice(0,t);e=e.slice(t),a.set(r,c),c+=r.length}if(c!==a.length)return;const r=a;if(a=void 0,0===u)try{const e=JSON.parse(r.toString());n.onMessageFinish(e)}catch(e){n.kill("message parse failure "+e.message)}else n.onMessageBuffer(r)}},setupRpcPeer:n.setupRpcPeer,sendMessage:n.sendMessage,onDisconnected:n.onDisconnected}}},5193:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SrtpContext=void 0;const s=r(1193),n=r(169);class i extends n.Context{constructor(e,t,r){super(e,t,r)}encryptRtp(e,t){const r=this.getSrtpSsrcState(t.ssrc);this.updateRolloverCount(t.sequenceNumber,r);return this.cipher.encryptRtp(t,e,r.rolloverCounter)}decryptRtp(e){const t=s.RtpHeader.deSerialize(e),r=this.getSrtpSsrcState(t.ssrc);this.updateRolloverCount(t.sequenceNumber,r);return this.cipher.decryptRtp(e,r.rolloverCounter)}}t.SrtpContext=i},5205:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(9543),t)},5300:(e,t)=>{"use strict";t.toString=function(e){switch(e){case 1:return"IN";case 2:return"CS";case 3:return"CH";case 4:return"HS";case 255:return"ANY"}return"UNKNOWN_"+e},t.toClass=function(e){switch(e.toUpperCase()){case"IN":return 1;case"CS":return 2;case"CH":return 3;case"HS":return 4;case"ANY":return 255}return 0}},5317:e=>{"use strict";e.exports=require("child_process")},5353:(e,t,r)=>{"use strict";const{isType:s}=r(2),n=r(8176);function i(e){return function t(r,s){const n=Buffer.from(r.toString(),e);s.writeBuffer(n),s.writeInt8(0),t.bytes=n.length+1}}function o(e){return function t(r){const s=r.indexOf(0);if(-1===s)throw new n(r.length+1,r.length);const i=s+1,o=r.readBuffer(i);return t.bytes=i,o.toString(e,0,s)}}function a(e,t){return function r(s,n){if(s=s.toString(),Buffer.byteLength(s,t)!==e)throw new Error(`Size of string should be ${e} in bytes.`);const i=Buffer.from(s,t);n.writeBuffer(i),r.bytes=i.length}}function c(e,t){return function r(s){const n=s.readBuffer(e);return r.bytes=e,n.toString(t)}}function u(e,t){return function r(s,n){s=s.toString();e.encode.call(this,Buffer.byteLength(s,t),n),r.bytes=e.encode.bytes;const i=Buffer.from(s,t);n.writeBuffer(i),r.bytes+=i.length}}function l(e,t){return function r(s){const n=e.decode.call(this,s);if("number"!=typeof n)throw new TypeError("Size of a string should be a number.");const i=s.readBuffer(n);return r.bytes=e.decode.bytes+i.length,i.toString(t)}}function d(e,t){return function(r){const s=Buffer.byteLength(r,t);return e.encodingLength(s)+s}}function h(e,t){return function r(s,n){r.bytes=0;const i=e(this),o=Buffer.from(s.toString(),t);f(i),function(e,t){if(e!==t)throw new Error(`Buffer required length ${e} instead of ${t}`)}(i,o.length),n.writeBuffer(o),r.bytes+=o.length}}function p(e,t){return function r(s){const n=e(this);f(n);const i=s.readBuffer(n);return r.bytes=n,i.toString(t)}}function f(e){if("number"!=typeof e)throw new TypeError("Length of a buffer should be a number.")}e.exports=function(e,t="ascii"){if(!Buffer.isEncoding(t))throw new Error("Argument #2 should be an encoding name.");if("number"==typeof e)return{encode:a(e,t),decode:c(e,t),encodingLength:()=>e};if(s(e))return{encode:u(e,t),decode:l(e,t),encodingLength:d(e,t)};if(null===e)return{encode:i(t),decode:o(t),encodingLength:e=>Buffer.byteLength(e,t)+1};if("function"==typeof e)return{encode:h(e,t),decode:p(e,t),encodingLength:e=>Buffer.byteLength(e,t)};throw new TypeError("Unknown type of argument #1.")}},5356:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FullIntraRequest=void 0;const s=r(9543);class n{constructor(e={}){this.count=n.count,this.fir=[],Object.assign(this,e)}get length(){return Math.floor(this.serialize().length/4-1)}static deSerialize(e){const[t,r]=(0,s.bufferReader)(e,[4,4]),i=[];for(let t=8;t<e.length;t+=8)i.push({ssrc:e.readUInt32BE(t),sequenceNumber:e[t+4]});return new n({senderSsrc:t,mediaSsrc:r,fir:i})}serialize(){const e=(0,s.bufferWriter)([4,4],[this.senderSsrc,this.mediaSsrc]),t=Buffer.alloc(8*this.fir.length);return this.fir.forEach((({ssrc:e,sequenceNumber:r},s)=>{t.writeUInt32BE(e,8*s),t[8*s+4]=r})),Buffer.concat([e,t])}}t.FullIntraRequest=n,n.count=4},5382:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(9385);t.bytesFromIP=s.bytesFromIP,t.bytesToIP=s.bytesToIP,t.getOID=s.getOID,t.getOIDName=s.getOIDName;var n=r(1394);t.PublicKey=n.PublicKey,t.PrivateKey=n.PrivateKey,t.RSAPublicKey=n.RSAPublicKey,t.RSAPrivateKey=n.RSAPrivateKey;var i=r(376);t.Certificate=i.Certificate,t.DistinguishedName=i.DistinguishedName},5392:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtcpTransportLayerFeedbackType=void 0,t.RtcpTransportLayerFeedbackType=205},5433:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(9543),t)},5597:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createAsyncQueue=i,t.createAsyncQueueFromGenerator=function(e){const t=i();return(async()=>{try{for await(const r of e)await t.enqueue(r)}catch(e){t.end(e)}t.end()})(),t};const s=r(3290);class n extends Error{}function i(){let e;const t=new s.Deferred,r=[],i=[],o=async()=>{if(i.length){const{item:e,dequeued:t}=i.shift();return t?.resolve(),e}if(e)throw e;const t=new s.Deferred;return r.push(t),t.promise},a=(t,n,o)=>{if(e)return!1;if(r.length){const e=r.shift();return n?.resolve(),e.resolve(t),!0}o&&(n||=new s.Deferred);const a={item:t,dequeued:n};if(i.push(a),!o)return!0;const c=()=>{const e=i.indexOf(a);-1!==e&&(i.splice(e,1),n?.reject(new Error("abort")))};return n?.promise.catch((()=>{})).finally((()=>o.removeEventListener("abort",c))),o.addEventListener("abort",c),!0};function c(s){if(e)return!1;for(e=s||new n,t.resolve();r.length;)r.shift().reject(e);return!0}function u(){return async function*(){try{for(;;)try{const e=await o();yield e}catch(e){if(c(e),e instanceof n)return;throw e}}finally{c()}}()}return{[Symbol.dispose](){c(new Error("async queue disposed"))},get ended(){return e},endPromise:t.promise,take:()=>{if(i.length){const{item:e,dequeued:t}=i.shift();return t?.resolve(),e}if(e)throw e},clear:()=>function(e){const t=[],r=i.splice(0,i.length);for(const s of r)e?s.dequeued?.reject(e):s.dequeued?.resolve(void 0),t.push(s.item);return t}(),queued:i,async pipe(e){for await(const t of u())e(t)},submit:(e,t)=>a(e,void 0,t),end:c,async enqueue(e,t){const r=new s.Deferred;return!!a(e,r,t)&&(await r.promise,!0)},dequeue:o,get queue(){return u()},wait:async e=>{const t=i[e];if(t)return t.dequeued||(t.dequeued=new s.Deferred),t.dequeued.promise}}}},5692:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTCDtlsParameters=t.RTCDtlsFingerprint=t.RTCCertificate=t.DtlsStates=t.RTCDtlsTransport=void 0;const s=r(5382),n=r(6982),i=r(6460),o=r(5433),a=r(1597),c=r(6252),u=r(4579),l=r(8806),d=(0,c.debug)("werift:packages/webrtc/src/transport/dtls.ts");class h{constructor(e,t,r,s=[]){this.config=e,this.iceTransport=t,this.localCertificate=r,this.srtpProfiles=s,this.id=(0,n.randomUUID)().toString(),this.state="new",this.role="auto",this.srtpStarted=!1,this.transportSequenceNumber=0,this.bytesSent=0,this.bytesReceived=0,this.packetsSent=0,this.packetsReceived=0,this.dataReceiver=()=>{},this.onStateChange=new o.Event,this.onRtcp=new o.Event,this.onRtp=new o.Event,this.sendData=async e=>{if(!(this.config.debug.outboundPacketLoss&&this.config.debug.outboundPacketLoss/100<Math.random())){if(!this.dtls)throw new Error("dtls not established");await this.dtls.send(e)}},this.localCertificate??=h.localCertificate}get localParameters(){return new g(this.localCertificate?this.localCertificate.getFingerprints():[],this.role)}static async SetupCertificate(){return this.localCertificate?this.localCertificate:(this.localCertificatePromise||(this.localCertificatePromise=(async()=>{const{certPem:e,keyPem:t,signatureHash:r}=await a.CipherContext.createSelfSignedCertificateWithKey({signature:a.SignatureAlgorithm.ecdsa_3,hash:a.HashAlgorithm.sha256_4},a.NamedCurveAlgorithm.secp256r1_23);return this.localCertificate=new p(t,e,r),this.localCertificate})()),this.localCertificatePromise)}setRemoteParams(e){this.remoteParameters=e}async start(){if("new"!==this.state)throw new Error("state must be new");if(0===this.remoteParameters?.fingerprints.length)throw new Error("remote fingerprint not exist");"auto"===this.role&&("controlling"===this.iceTransport.role?this.role="server":this.role="client"),this.setState("connecting"),await new Promise((async(e,t)=>{"server"===this.role?this.dtls=new a.DtlsServer({cert:this.localCertificate?.certPem,key:this.localCertificate?.privateKey,signatureHash:this.localCertificate?.signatureHash,transport:y(this.iceTransport.connection),srtpProfiles:this.srtpProfiles,extendedMasterSecret:!0}):this.dtls=new a.DtlsClient({cert:this.localCertificate?.certPem,key:this.localCertificate?.privateKey,signatureHash:this.localCertificate?.signatureHash,transport:y(this.iceTransport.connection),srtpProfiles:this.srtpProfiles,extendedMasterSecret:!0}),this.dtls.onData.subscribe((e=>{this.config.debug.inboundPacketLoss&&this.config.debug.inboundPacketLoss/100<Math.random()||this.dataReceiver(e)})),this.dtls.onClose.subscribe((()=>{this.setState("closed")})),this.dtls.onConnect.once(e),this.dtls.onError.once((e=>{this.setState("failed"),d("dtls failed",e),t(e)})),this.dtls instanceof a.DtlsClient&&(await(0,i.setTimeout)(100),this.dtls.connect().catch((e=>{this.setState("failed"),d("dtls connect failed",e),t(e)})))})),this.srtpProfiles.length>0&&this.startSrtp(),this.dtls.onConnect.subscribe((()=>{this.updateSrtpSession(),this.setState("connected")})),this.setState("connected"),d("dtls connected")}updateSrtpSession(){if(!this.dtls)throw new Error;const e=this.dtls.srtp.srtpProfile;if(!e)throw new Error("need srtpProfile");d("selected SRTP Profile",e);const{localKey:t,localSalt:r,remoteKey:s,remoteSalt:n}=this.dtls.extractSessionKeys((0,c.keyLength)(e),(0,c.saltLength)(e)),i={keys:{localMasterKey:t,localMasterSalt:r,remoteMasterKey:s,remoteMasterSalt:n},profile:e};this.srtp=new c.SrtpSession(i),this.srtcp=new c.SrtcpSession(i)}startSrtp(){this.srtpStarted||(this.srtpStarted=!0,this.updateSrtpSession(),this.iceTransport.connection.onData.subscribe((e=>{if(!(this.config.debug.inboundPacketLoss&&this.config.debug.inboundPacketLoss/100<Math.random())&&(0,c.isMedia)(e))if(this.bytesReceived+=e.length,this.packetsReceived++,(0,c.isRtcp)(e)){const t=this.srtcp.decrypt(e),r=c.RtcpPacketConverter.deSerialize(t);for(const e of r)try{this.onRtcp.execute(e)}catch(e){d("RTCP error",e)}}else{const t=this.srtp.decrypt(e),r=c.RtpPacket.deSerialize(t);try{this.onRtp.execute(r)}catch(e){d("RTP error",e)}}})))}async sendRtp(e,t){try{const r=this.srtp.encrypt(e,t);return this.config.debug.outboundPacketLoss&&this.config.debug.outboundPacketLoss/100<Math.random()||(this.bytesSent+=r.length,this.packetsSent++,await this.iceTransport.connection.send(r).catch((()=>{}))),r.length}catch(e){return d("failed to send",e),0}}async sendRtcp(e){const t=Buffer.concat(e.map((e=>e.serialize()))),r=this.srtcp.encrypt(t);if(this.config.debug.outboundPacketLoss&&this.config.debug.outboundPacketLoss/100<Math.random())return r.length;this.bytesSent+=r.length,this.packetsSent++,await this.iceTransport.connection.send(r).catch((()=>{}))}setState(e){e!=this.state&&(this.state=e,this.onStateChange.execute(e))}async stop(){this.setState("closed"),await this.iceTransport.stop()}async getStats(){const e=(0,u.getStatsTimestamp)(),t=[],r={type:"transport",id:(0,u.generateStatsId)("transport",this.id),timestamp:e,bytesSent:this.bytesSent,bytesReceived:this.bytesReceived,packetsSent:this.packetsSent,packetsReceived:this.packetsReceived,dtlsState:this.state,iceState:this.iceTransport.state,selectedCandidatePairId:this.iceTransport.connection.nominated?(0,u.generateStatsId)("candidate-pair",this.iceTransport.connection.nominated.localCandidate.foundation,this.iceTransport.connection.nominated.remoteCandidate.foundation):void 0,localCertificateId:this.localCertificate?(0,u.generateStatsId)("certificate","local"):void 0,remoteCertificateId:this.remoteParameters?(0,u.generateStatsId)("certificate","remote"):void 0,dtlsRole:"auto"===this.role?void 0:this.role};if(t.push(r),this.localCertificate){const r=this.localCertificate.getFingerprints();if(r.length>0){const s={type:"certificate",id:(0,u.generateStatsId)("certificate","local"),timestamp:e,fingerprint:r[0].value,fingerprintAlgorithm:r[0].algorithm,base64Certificate:Buffer.from(this.localCertificate.certPem).toString("base64")};t.push(s)}}if(this.remoteParameters&&this.remoteParameters.fingerprints.length>0){const r={type:"certificate",id:(0,u.generateStatsId)("certificate","remote"),timestamp:e,fingerprint:this.remoteParameters.fingerprints[0].value,fingerprintAlgorithm:this.remoteParameters.fingerprints[0].algorithm,base64Certificate:""};t.push(r)}const s=await this.iceTransport.getStats();return t.push(...s),t}}t.RTCDtlsTransport=h,t.DtlsStates=["new","connecting","connected","closed","failed"];class p{constructor(e,t,r){this.certPem=t,this.signatureHash=r;const n=s.Certificate.fromPEM(Buffer.from(t));this.publicKey=n.publicKey.toPEM(),this.privateKey=s.PrivateKey.fromPEM(Buffer.from(e)).toPEM()}getFingerprints(){return[new f("sha-256",(0,l.fingerprint)(s.Certificate.fromPEM(Buffer.from(this.certPem)).raw,"sha256"))]}}t.RTCCertificate=p;class f{constructor(e,t){this.algorithm=e,this.value=t}}t.RTCDtlsFingerprint=f;class g{constructor(e=[],t){this.fingerprints=e,this.role=t}}t.RTCDtlsParameters=g;class m{constructor(e){this.ice=e,this.closed=!1,this.onData=()=>{},this.type="ice",this.send=e=>this.ice.send(e),e.onData.subscribe((e=>{(0,l.isDtls)(e)&&this.onData&&this.onData(e)}))}get address(){return{}}async close(){this.closed=!0,this.ice.close()}}const y=e=>new m(e)},5693:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NackHandler=void 0;const s=r(5433),n=r(5433),i=r(6252),o=(0,i.debug)("werift:packages/webrtc/src/media/receiver/nack.ts");t.NackHandler=class{constructor(e){this.receiver=e,this.newEstSeqNum=0,this._lost={},this.onPacketLost=new s.Event,this.retryCount=10,this.closed=!1,this.sendNack=()=>new Promise(((e,t)=>{if(this.lostSeqNumbers.length>0&&this.mediaSourceSsrc){const r=new i.GenericNack({senderSsrc:this.receiver.rtcpSsrc,mediaSourceSsrc:this.mediaSourceSsrc,lost:this.lostSeqNumbers}),s=new i.RtcpTransportLayerFeedback({feedback:r});this.receiver.dtlsTransport.sendRtcp([s]).then(e).catch(t),this.updateRetryCount(),this.onPacketLost.execute(r)}}))}get lostSeqNumbers(){return Object.keys(this._lost).map(Number).sort()}getLost(e){return this._lost[e]}setLost(e,t){this._lost[e]=t,this.nackLoop||this.closed||(this.nackLoop=setInterval((async()=>{try{await this.sendNack(),Object.keys(this._lost).length||(clearInterval(this.nackLoop),this.nackLoop=void 0)}catch(e){o("failed to send nack",e)}}),5))}removeLost(e){delete this._lost[e]}addPacket(e){const{sequenceNumber:t,ssrc:r}=e.header;if(this.mediaSourceSsrc=r,0!==this.newEstSeqNum){if(this.getLost(t))this.removeLost(t);else if(t===(0,n.uint16Add)(this.newEstSeqNum,1))this.newEstSeqNum=t;else if(t>(0,n.uint16Add)(this.newEstSeqNum,1)){for(let e=(0,n.uint16Add)(this.newEstSeqNum,1);e<t;e=(0,n.uint16Add)(e,1))this.setLost(e,1);this.newEstSeqNum=t,this.pruneLost()}}else this.newEstSeqNum=t}pruneLost(){this.lostSeqNumbers.length>150&&(this._lost=Object.entries(this._lost).slice(-150).reduce(((e,[t,r])=>(e[t]=r,e)),{}))}close(){this.closed=!0,clearInterval(this.nackLoop),this._lost={}}updateRetryCount(){this.lostSeqNumbers.forEach((e=>{if(this._lost[e]++>this.retryCount)return this.removeLost(e),e}))}}},5701:function(e,t){!function(e){var t,r="undefined",s=r!==typeof Buffer&&Buffer,n=r!==typeof Uint8Array&&Uint8Array,i=r!==typeof ArrayBuffer&&ArrayBuffer,o=[0,0,0,0,0,0,0,0],a=Array.isArray||function(e){return!!e&&"[object Array]"==Object.prototype.toString.call(e)},c=4294967296;function u(a,u,S){var w=u?0:4,E=u?4:0,C=u?0:3,T=u?1:2,I=u?2:1,_=u?3:0,A=u?m:b,R=u?y:v,P=O.prototype,k="is"+a,B="_"+k;return P.buffer=void 0,P.offset=0,P[B]=!0,P.toNumber=x,P.toString=function(e){var t=this.buffer,r=this.offset,s=D(t,r+w),n=D(t,r+E),i="",o=!S&&2147483648&s;o&&(s=~s,n=c-n);e=e||10;for(;;){var a=s%e*c+n;if(s=Math.floor(s/e),n=Math.floor(a/e),i=(a%e).toString(e)+i,!s&&!n)break}o&&(i="-"+i);return i},P.toJSON=x,P.toArray=l,s&&(P.toBuffer=d),n&&(P.toArrayBuffer=h),O[k]=function(e){return!(!e||!e[B])},e[a]=O,O;function O(e,a,u,l){return this instanceof O?function(e,a,u,l,d){n&&i&&(a instanceof i&&(a=new n(a)),l instanceof i&&(l=new n(l)));if(!(a||u||l||t))return void(e.buffer=g(o,0));if(!p(a,u)){var h=t||Array;d=u,l=a,u=0,a=t===s?s.alloc(8):new h(8)}if(e.buffer=a,e.offset=u|=0,r===typeof l)return;"string"==typeof l?function(e,t,r,s){var n=0,i=r.length,o=0,a=0;"-"===r[0]&&n++;var u=n;for(;n<i;){var l=parseInt(r[n++],s);if(!(l>=0))break;a=a*s+l,o=o*s+Math.floor(a/c),a%=c}u&&(o=~o,a?a=c-a:o++);N(e,t+w,o),N(e,t+E,a)}(a,u,l,d||10):p(l,d)?f(a,u,l,d):"number"==typeof d?(N(a,u+w,l),N(a,u+E,d)):l>0?A(a,u,l):l<0?R(a,u,l):f(a,u,o,0)}(this,e,a,u,l):new O(e,a,u,l)}function x(){var e=this.buffer,t=this.offset,r=D(e,t+w),s=D(e,t+E);return S||(r|=0),r?r*c+s:s}function N(e,t,r){e[t+_]=255&r,r>>=8,e[t+I]=255&r,r>>=8,e[t+T]=255&r,r>>=8,e[t+C]=255&r}function D(e,t){return 16777216*e[t+C]+(e[t+T]<<16)+(e[t+I]<<8)+e[t+_]}}function l(e){var r=this.buffer,s=this.offset;return t=null,!1!==e&&a(r)?8===r.length?r:r.slice(s,s+8):g(r,s)}function d(e){var r=this.buffer,n=this.offset;return t=s,!1!==e&&s.isBuffer(r)?8===r.length?r:r.slice(n,n+8):s.from(h.call(this,e))}function h(e){var r=this.buffer,s=this.offset,o=r.buffer;if(t=n,!1!==e&&!r.offset&&o instanceof i)return 8===o.byteLength?o:o.slice(s,s+8);var a=new n(8);return f(a,0,r,s),a.buffer}function p(e,t){var r=e&&e.length;return t|=0,r&&t+8<=r&&"string"!=typeof e[t]}function f(e,t,r,s){t|=0,s|=0;for(var n=0;n<8;n++)e[t++]=255&r[s++]}function g(e,t){return Array.prototype.slice.call(e,t,t+8)}function m(e,t,r){for(var s=t+8;s>t;)e[--s]=255&r,r/=256}function y(e,t,r){var s=t+8;for(r++;s>t;)e[--s]=255&-r^255,r/=256}function b(e,t,r){for(var s=t+8;t<s;)e[t++]=255&r,r/=256}function v(e,t,r){var s=t+8;for(r++;t<s;)e[t++]=255&-r^255,r/=256}u("Uint64BE",!0,!0),u("Int64BE",!0,!1),u("Uint64LE",!1,!0),u("Int64LE",!1,!1)}("string"!=typeof t.nodeName?t:this||{})},5720:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNegativeLE=void 0,t.mod=d,t.pow=h,t.pow2=function(e,t,r){let s=e;for(;t-- >n;)s*=s,s%=r;return s},t.invert=p,t.tonelliShanks=f,t.FpSqrt=g,t.validateField=function(e){const t=m.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});return(0,s.validateObject)(e,t)},t.FpPow=y,t.FpInvertBatch=b,t.FpDiv=function(e,t,r){return e.mul(t,"bigint"==typeof r?p(r,e.ORDER):e.inv(r))},t.FpLegendre=v,t.FpIsSquare=function(e){const t=v(e.ORDER);return r=>{const s=t(e,r);return e.eql(s,e.ZERO)||e.eql(s,e.ONE)}},t.nLength=S,t.Field=function(e,t,r=!1,o={}){if(e<=n)throw new Error("invalid field: expected ORDER > 0, got "+e);const{nBitLength:a,nByteLength:c}=S(e,t);if(c>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const l=Object.freeze({ORDER:e,isLE:r,BITS:a,BYTES:c,MASK:(0,s.bitMask)(a),ZERO:n,ONE:i,create:t=>d(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("invalid field element: expected bigint, got "+typeof t);return n<=t&&t<e},is0:e=>e===n,isOdd:e=>(e&i)===i,neg:t=>d(-t,e),eql:(e,t)=>e===t,sqr:t=>d(t*t,e),add:(t,r)=>d(t+r,e),sub:(t,r)=>d(t-r,e),mul:(t,r)=>d(t*r,e),pow:(e,t)=>y(l,e,t),div:(t,r)=>d(t*p(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>p(t,e),sqrt:o.sqrt||(t=>(u||(u=g(e)),u(l,t))),invertBatch:e=>b(l,e),cmov:(e,t,r)=>r?t:e,toBytes:e=>r?(0,s.numberToBytesLE)(e,c):(0,s.numberToBytesBE)(e,c),fromBytes:e=>{if(e.length!==c)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+e.length);return r?(0,s.bytesToNumberLE)(e):(0,s.bytesToNumberBE)(e)}});return Object.freeze(l)},t.FpSqrtOdd=function(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");const r=e.sqrt(t);return e.isOdd(r)?r:e.neg(r)},t.FpSqrtEven=function(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");const r=e.sqrt(t);return e.isOdd(r)?e.neg(r):r},t.hashToPrivateScalar=function(e,t,r=!1){const n=(e=(0,s.ensureBytes)("privateHash",e)).length,o=S(t).nByteLength+8;if(o<24||n<o||n>1024)throw new Error("hashToPrivateScalar: expected "+o+"-1024 bytes of input, got "+n);return d(r?(0,s.bytesToNumberLE)(e):(0,s.bytesToNumberBE)(e),t-i)+i},t.getFieldBytesLength=w,t.getMinHashLength=E,t.mapHashToField=function(e,t,r=!1){const n=e.length,o=w(t),a=E(t);if(n<16||n<a||n>1024)throw new Error("expected "+a+"-1024 bytes of input, got "+n);const c=d(r?(0,s.bytesToNumberLE)(e):(0,s.bytesToNumberBE)(e),t-i)+i;return r?(0,s.numberToBytesLE)(c,o):(0,s.numberToBytesBE)(c,o)};const s=r(3939),n=BigInt(0),i=BigInt(1),o=BigInt(2),a=BigInt(3),c=BigInt(4),u=BigInt(5),l=BigInt(8);function d(e,t){const r=e%t;return r>=n?r:t+r}function h(e,t,r){if(t<n)throw new Error("invalid exponent, negatives unsupported");if(r<=n)throw new Error("invalid modulus");if(r===i)return n;let s=i;for(;t>n;)t&i&&(s=s*e%r),e=e*e%r,t>>=i;return s}function p(e,t){if(e===n)throw new Error("invert: expected non-zero number");if(t<=n)throw new Error("invert: expected positive modulus, got "+t);let r=d(e,t),s=t,o=n,a=i,c=i,u=n;for(;r!==n;){const e=s/r,t=s%r,n=o-c*e,i=a-u*e;s=r,r=t,o=c,a=u,c=n,u=i}if(s!==i)throw new Error("invert: does not exist");return d(o,t)}function f(e){const t=(e-i)/o;let r,s,a;for(r=e-i,s=0;r%o===n;r/=o,s++);for(a=o;a<e&&h(a,t,e)!==e-i;a++)if(a>1e3)throw new Error("Cannot find square root: likely non-prime P");if(1===s){const t=(e+i)/c;return function(e,r){const s=e.pow(r,t);if(!e.eql(e.sqr(s),r))throw new Error("Cannot find square root");return s}}const u=(r+i)/o;return function(e,n){if(e.pow(n,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let o=s,c=e.pow(e.mul(e.ONE,a),r),l=e.pow(n,u),d=e.pow(n,r);for(;!e.eql(d,e.ONE);){if(e.eql(d,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(d);t<o&&!e.eql(r,e.ONE);t++)r=e.sqr(r);const r=e.pow(c,i<<BigInt(o-t-1));c=e.sqr(r),l=e.mul(l,r),d=e.mul(d,c),o=t}return l}}function g(e){if(e%c===a){const t=(e+i)/c;return function(e,r){const s=e.pow(r,t);if(!e.eql(e.sqr(s),r))throw new Error("Cannot find square root");return s}}if(e%l===u){const t=(e-u)/l;return function(e,r){const s=e.mul(r,o),n=e.pow(s,t),i=e.mul(r,n),a=e.mul(e.mul(i,o),n),c=e.mul(i,e.sub(a,e.ONE));if(!e.eql(e.sqr(c),r))throw new Error("Cannot find square root");return c}}return f(e)}t.isNegativeLE=(e,t)=>(d(e,t)&i)===i;const m=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function y(e,t,r){if(r<n)throw new Error("invalid exponent, negatives unsupported");if(r===n)return e.ONE;if(r===i)return t;let s=e.ONE,o=t;for(;r>n;)r&i&&(s=e.mul(s,o)),o=e.sqr(o),r>>=i;return s}function b(e,t){const r=new Array(t.length),s=t.reduce(((t,s,n)=>e.is0(s)?t:(r[n]=t,e.mul(t,s))),e.ONE),n=e.inv(s);return t.reduceRight(((t,s,n)=>e.is0(s)?t:(r[n]=e.mul(t,r[n]),e.mul(t,s))),n),r}function v(e){const t=(e-i)/o;return(e,r)=>e.pow(r,t)}function S(e,t){const r=void 0!==t?t:e.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}function w(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function E(e){const t=w(e);return t+Math.ceil(t/2)}},5744:(e,t)=>{"use strict";function r(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function s(e,...t){if(!((r=e)instanceof Uint8Array||ArrayBuffer.isView(r)&&"Uint8Array"===r.constructor.name))throw new Error("Uint8Array expected");var r;if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}Object.defineProperty(t,"__esModule",{value:!0}),t.anumber=r,t.abytes=s,t.ahash=function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");r(e.outputLen),r(e.blockLen)},t.aexists=function(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},t.aoutput=function(e,t){s(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}},5808:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtcpReceiverInfo=t.RtcpRrPacket=void 0;const s=r(9543),n=r(4221);class i{constructor(e={}){this.ssrc=0,this.reports=[],this.type=i.type,Object.assign(this,e)}serialize(){let e=(0,s.bufferWriter)([4],[this.ssrc]);return e=Buffer.concat([e,...this.reports.map((e=>e.serialize()))]),n.RtcpHeader.serialize(i.type,this.reports.length,e,Math.floor(e.length/4))}static deSerialize(e,t){const[r]=(0,s.bufferReader)(e,[4]);let n=4;const a=[];for(let r=0;r<t;r++)a.push(o.deSerialize(e.slice(n,n+24))),n+=24;return new i({ssrc:r,reports:a})}}t.RtcpRrPacket=i,i.type=201;class o{constructor(e={}){Object.assign(this,e)}toJSON(){return{ssrc:this.ssrc,fractionLost:this.fractionLost,packetsLost:this.packetsLost,highestSequence:this.highestSequence,jitter:this.jitter,lsr:this.lsr,dlsr:this.dlsr}}serialize(){return(0,s.bufferWriter)([4,1,3,4,4,4,4],[this.ssrc,this.fractionLost,this.packetsLost,this.highestSequence,this.jitter,this.lsr,this.dlsr])}static deSerialize(e){const[t,r,n,i,a,c,u]=(0,s.bufferReader)(e,[4,1,3,4,4,4,4]);return new o({ssrc:t,fractionLost:r,packetsLost:n,highestSequence:i,jitter:a,lsr:c,dlsr:u})}}t.RtcpReceiverInfo=o},5857:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionStates=t.SignalingStates=void 0,t.SignalingStates=["stable","have-local-offer","have-remote-offer","have-local-pranswer","have-remote-pranswer","closed"],t.ConnectionStates=["closed","failed","disconnected","new","connecting","connected"]},5865:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BufferVisitor=class{constructor(e,t=0,r=0){this.start=t,this.end=r>t?r:t,this.buf=e}get length(){return this.buf.length}reset(e=0,t=0){return this.start=e,t>=this.start?this.end=t:this.end<this.start&&(this.end=this.start),this}walk(e){return this.start=this.end,this.end+=e,this}mustHas(e,t="Too few bytes to parse."){const r=this.end+e;if(r>this.buf.length){const e=new Error(t);throw e.available=this.buf.length,e.requested=r,e}return this.walk(0),this}mustWalk(e,t){return this.mustHas(e,t),this.walk(e),this}}},5890:(e,t,r)=>{"use strict";const{isType:s,isFunction:n}=r(2),i=r(8176),o=r(872);function a(e){if(!(Buffer.isBuffer(e)||e instanceof o))throw new TypeError("Argument 1 should be a Buffer or a BinaryStream.")}function c(e,t){if(e!==t)throw new Error(`Buffer required length ${e} instead of ${t}`)}function u(e){if("number"!=typeof e)throw new TypeError("Length of a buffer should be a number.")}e.exports=function(e){const t="number"==typeof e,r=s(e),o=n(e),l=null===e;if(!(t||r||o||l))throw new TypeError("Unknown type of argument #1.");return{encode:function s(n,i){a(n),s.bytes=0;const d=this;t&&c(e,n.length);r&&(e.encode.call(d,n.length,i),s.bytes+=e.encode.bytes);if(o){const t=e(d);u(t),c(t,n.length)}i.writeBuffer(Buffer.isBuffer(n)?n:n.buffer),s.bytes+=n.length,l&&(i.writeUInt8(0),s.bytes+=1)},decode:function s(n){let a=0;s.bytes=0;const c=this;if(t)a=e;else if(r)a=e.decode.call(c,n),s.bytes+=e.decode.bytes,u(a);else if(o)a=e(c),u(a);else if(l&&(a=n.indexOf(0),-1===a))throw new i(n.length+1,n.length);const d=n.readBuffer(a);s.bytes+=a,l&&(s.bytes+=1,n.consume(1));return d},encodingLength:function(s){a(s);let n=0;if(t)return e;l?n=1:r&&(n=e.encodingLength(s.length));return n+s.length}}}},5903:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventDisposer=t.Event=void 0;t.Event=class{constructor(){this.event={stack:[],promiseStack:[],eventId:0},this.ended=!1,this.onerror=e=>{},this.execute=(...e)=>{if(!this.ended){for(const t of this.event.stack)t.execute(...e);(async()=>{for(const t of this.event.promiseStack)await t.execute(...e)})().catch((e=>{this.onerror(e)}))}},this.complete=()=>{if(!this.ended){for(const e of this.event.stack)e.complete&&e.complete();this.allUnsubscribe(),this.ended=!0,this.onended&&(this.onended(),this.onended=void 0)}},this.error=e=>{if(!this.ended){for(const t of this.event.stack)t.error&&t.error(e);this.allUnsubscribe()}},this.allUnsubscribe=()=>{if(this.ended)throw new Error("event completed");this.event={stack:[],promiseStack:[],eventId:0}},this.subscribe=(e,t,r)=>{const s=this.event.eventId;this.event.stack.push({execute:e,id:s,complete:t,error:r}),this.event.eventId++;const n=()=>{this.event.stack=this.event.stack.filter((e=>e.id!==s&&e))};return{unSubscribe:n,disposer:e=>{e.push(n)}}},this.queuingSubscribe=(e,t,r)=>{if(this.ended)throw new Error("event completed");const s=this.event.eventId;this.event.promiseStack.push({execute:e,id:s,complete:t,error:r}),this.event.eventId++;const n=()=>{this.event.stack=this.event.stack.filter((e=>e.id!==s&&e))};return{unSubscribe:n,disposer:e=>{e.push(n)}}},this.once=(e,t,r)=>{const s=this.subscribe(((...t)=>{s.unSubscribe(),e(...t)}),t,r)},this.watch=(e,t)=>new Promise(((r,s)=>{const n=t&&setTimeout((()=>{s("Event watch timeout")}),t),{unSubscribe:i}=this.subscribe(((...t)=>{e(...t)&&(n&&clearTimeout(n),i(),r(t))}))})),this.asPromise=e=>new Promise(((t,r)=>{const s=e&&setTimeout((()=>{r("Event asPromise timeout")}),e);this.once(((...e)=>{s&&clearTimeout(s),t(e)}),(()=>{s&&clearTimeout(s),t([])}),(e=>{s&&clearTimeout(s),r(e)}))}))}pipe(e){this.subscribe(((...t)=>{e.execute(...t)}))}get returnTrigger(){const{execute:e,error:t,complete:r}=this;return{execute:e,error:t,complete:r}}get returnListener(){const{subscribe:e,once:t,asPromise:r}=this;return{subscribe:e,once:t,asPromise:r}}get length(){return this.event.stack.length}};t.EventDisposer=class{constructor(){this._disposer=[]}push(e){this._disposer.push(e)}dispose(){this._disposer.forEach((e=>e())),this._disposer=[]}}},5982:(e,t)=>{"use strict";var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.AlertDesc=t.ContentType=void 0,function(e){e[e.changeCipherSpec=20]="changeCipherSpec",e[e.alert=21]="alert",e[e.handshake=22]="handshake",e[e.applicationData=23]="applicationData"}(r||(t.ContentType=r={})),function(e){e[e.CloseNotify=0]="CloseNotify",e[e.UnexpectedMessage=10]="UnexpectedMessage",e[e.BadRecordMac=20]="BadRecordMac",e[e.DecryptionFailed=21]="DecryptionFailed",e[e.RecordOverflow=22]="RecordOverflow",e[e.DecompressionFailure=30]="DecompressionFailure",e[e.HandshakeFailure=40]="HandshakeFailure",e[e.NoCertificate=41]="NoCertificate",e[e.BadCertificate=42]="BadCertificate",e[e.UnsupportedCertificate=43]="UnsupportedCertificate",e[e.CertificateRevoked=44]="CertificateRevoked",e[e.CertificateExpired=45]="CertificateExpired",e[e.CertificateUnknown=46]="CertificateUnknown",e[e.IllegalParameter=47]="IllegalParameter",e[e.UnknownCa=48]="UnknownCa",e[e.AccessDenied=49]="AccessDenied",e[e.DecodeError=50]="DecodeError",e[e.DecryptError=51]="DecryptError",e[e.ExportRestriction=60]="ExportRestriction",e[e.ProtocolVersion=70]="ProtocolVersion",e[e.InsufficientSecurity=71]="InsufficientSecurity",e[e.InternalError=80]="InternalError",e[e.UserCanceled=90]="UserCanceled",e[e.NoRenegotiation=100]="NoRenegotiation",e[e.UnsupportedExtension=110]="UnsupportedExtension"}(s||(t.AlertDesc=s={}))},6033:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedMasterSecret=void 0;class r{}t.ExtendedMasterSecret=r,r.type=23},6098:function(e,t,r){"use strict";var s,n=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=s(e),o=0;o<r.length;o++)"default"!==r[o]&&n(t,e,r[o]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0});const a=r(6982),c=r(4011),u=r(5205),l=r(91),d=o(r(9379)),h=(0,u.debug)("werift-dtls : packages/dtls/src/cipher/suites/aead.ts : err");class p extends d.default{constructor(){super(),this.keyLength=0,this.nonceLength=0,this.ivLength=0,this.authTagLength=0,this.nonceImplicitLength=0,this.nonceExplicitLength=0}get summary(){return(0,c.getObjectSummary)(this)}init(e,t,r){const s=(0,l.prfEncryptionKeys)(e,r,t,this.keyLength,this.ivLength,this.nonceLength,this.hashAlgorithm);this.clientWriteKey=s.clientWriteKey,this.serverWriteKey=s.serverWriteKey,this.clientNonce=s.clientNonce,this.serverNonce=s.serverNonce}encrypt(e,t,r){const s=e===d.SessionType.CLIENT,n=s?this.clientNonce:this.serverNonce,i=s?this.clientWriteKey:this.serverWriteKey;if(!n||!i)throw new Error;n.writeUInt16BE(r.epoch,this.nonceImplicitLength),n.writeUIntBE(r.sequenceNumber,this.nonceImplicitLength+2,6);const o=n.slice(this.nonceImplicitLength),c=this.encodeAdditionalBuffer(r,t.length),u=(0,a.createCipheriv)(this.blockAlgorithm,i,n,{authTagLength:this.authTagLength});u.setAAD(c,{plaintextLength:t.length});const l=u.update(t),h=u.final(),p=u.getAuthTag();return Buffer.concat([o,l,h,p])}encodeAdditionalBuffer(e,t){const r=Buffer.alloc(13);return r.writeUInt16BE(e.epoch,0),r.writeUintBE(e.sequenceNumber,2,6),r.writeUInt8(e.type,8),r.writeUInt16BE(e.version,9),r.writeUInt16BE(t,11),r}decrypt(e,t,r){const s=e===d.SessionType.CLIENT,n=s?this.serverNonce:this.clientNonce,i=s?this.serverWriteKey:this.clientWriteKey;if(!n||!i)throw new Error;t.subarray(0,this.nonceExplicitLength).copy(n,this.nonceImplicitLength);const o=t.subarray(this.nonceExplicitLength,t.length-this.authTagLength),u=t.subarray(t.length-this.authTagLength),l=this.encodeAdditionalBuffer(r,o.length),p=(0,a.createDecipheriv)(this.blockAlgorithm,i,n,{authTagLength:this.authTagLength});p.setAuthTag(u),p.setAAD(l,{plaintextLength:o.length});const f=p.update(o);try{const e=p.final();return e.length>0?Buffer.concat([f,e]):f}catch(s){throw h("decrypt failed",s,e,(0,c.dumpBuffer)(t),r,this.summary),s}}}t.default=p},6101:e=>{"use strict";const t=Symbol("skip"),r=Symbol("bytes");e.exports={skip:t,bytes:r}},6157:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.saltLength=t.keyLength=t.Profiles=t.ProtectionProfileAeadAes128Gcm=t.ProtectionProfileAes128CmHmacSha1_80=void 0,t.ProtectionProfileAes128CmHmacSha1_80=1,t.ProtectionProfileAeadAes128Gcm=7,t.Profiles=[t.ProtectionProfileAes128CmHmacSha1_80,t.ProtectionProfileAeadAes128Gcm];t.keyLength=e=>{switch(e){case t.ProtectionProfileAes128CmHmacSha1_80:case t.ProtectionProfileAeadAes128Gcm:return 16}};t.saltLength=e=>{switch(e){case t.ProtectionProfileAes128CmHmacSha1_80:return 14;case t.ProtectionProfileAeadAes128Gcm:return 12}}},6203:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createCipher=function(e){switch(e){case o.TLS_RSA_WITH_AES_128_GCM_SHA256:return f(o.TLS_RSA_WITH_AES_128_GCM_SHA256,"TLS_RSA_WITH_AES_128_GCM_SHA256","aes-128-gcm",u,a);case o.TLS_RSA_WITH_AES_256_GCM_SHA384:return f(o.TLS_RSA_WITH_AES_256_GCM_SHA384,"TLS_RSA_WITH_AES_256_GCM_SHA384","aes-256-gcm",u,c,"sha384");case o.TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256:return f(o.TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256","aes-128-gcm",l,a);case o.TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384:return f(o.TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,"TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384","aes-256-gcm",l,c,"sha384");case o.TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256:return f(o.TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256","aes-128-gcm",d,a);case o.TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384:return f(o.TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,"TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384","aes-256-gcm",d,c,"sha384");case o.TLS_PSK_WITH_AES_128_GCM_SHA256:return f(o.TLS_PSK_WITH_AES_128_GCM_SHA256,"TLS_PSK_WITH_AES_128_GCM_SHA256","aes-128-gcm",h,a,"sha256");case o.TLS_PSK_WITH_AES_256_GCM_SHA384:return f(o.TLS_PSK_WITH_AES_256_GCM_SHA384,"TLS_PSK_WITH_AES_256_GCM_SHA384","aes-256-gcm",h,c,"sha384");case o.TLS_ECDHE_PSK_WITH_AES_128_GCM_SHA256:return f(o.TLS_ECDHE_PSK_WITH_AES_128_GCM_SHA256,"TLS_ECDHE_PSK_WITH_AES_128_GCM_SHA256","aes-128-gcm",p,a,"sha256");case o.TLS_ECDHE_PSK_WITH_AES_256_GCM_SHA384:return f(o.TLS_ECDHE_PSK_WITH_AES_256_GCM_SHA384,"TLS_ECDHE_PSK_WITH_AES_256_GCM_SHA384","aes-256-gcm",p,c,"sha384")}return null},t.createAEADCipher=f;const n=r(9284),i=s(r(6098)),o={TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256:49195,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384:49196,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256:49199,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384:49200,TLS_RSA_WITH_AES_128_GCM_SHA256:156,TLS_RSA_WITH_AES_256_GCM_SHA384:157,TLS_PSK_WITH_AES_128_GCM_SHA256:168,TLS_PSK_WITH_AES_256_GCM_SHA384:169,TLS_ECDHE_PSK_WITH_AES_128_GCM_SHA256:53249,TLS_ECDHE_PSK_WITH_AES_256_GCM_SHA384:53250,TLS_ECDHE_PSK_WITH_CHACHA20_POLY1305_SHA256:52396,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256:52393,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256:52392,TLS_PSK_WITH_CHACHA20_POLY1305_SHA256:52395},a={K_LEN:16,N_MIN:12,N_MAX:12,P_MAX:2**36-31,A_MAX:2**53-1,C_MAX:2**36-15},c={K_LEN:32,N_MIN:12,N_MAX:12,P_MAX:2**36-31,A_MAX:2**53-1,C_MAX:2**36-15},u=(0,n.createRSAKeyExchange)(),l=(0,n.createECDHERSAKeyExchange)(),d=(0,n.createECDHEECDSAKeyExchange)(),h=(0,n.createPSKKeyExchange)(),p=(0,n.createECDHEPSKKeyExchange)();function f(e,t,r,s,n,o="sha256"){const a=new i.default;return a.id=e,a.name=t,a.blockAlgorithm=r,a.kx=s,a.hashAlgorithm=o,a.keyLength=n.K_LEN,a.nonceLength=n.N_MAX,a.nonceImplicitLength=4,a.nonceExplicitLength=8,a.ivLength=a.nonceImplicitLength,a.authTagLength=16,a}},6238:function(e,t,r){"use strict";var s,n=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=s(e),o=0;o<r.length;o++)"default"!==r[o]&&n(t,e,r[o]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.createRTCPeerConnectionSource=async function(e){const{mediaStreamOptions:t,startRTCSignalingSession:r,mixinId:s,nativeId:n,maximumCompatibilityMode:i}=e,o=s?d.default.deviceManager.getMixinConsole(s,n):d.default.deviceManager.getDeviceConsole(n),{clientPromise:v,port:S}=await(0,c.listenZeroSingleClient)("127.0.0.1"),w=Date.now(),E=new a.Deferred,C=new a.Deferred,T=new a.Deferred;!function(...e){e.forEach((e=>e.promise.catch((()=>{}))))}(E,T);const I=()=>{o.log("webrtc/rtsp cleaning up"),v.then((e=>e.destroy())).catch((()=>{})),E.promise.then((e=>e.endSession())).catch((()=>{})),C.promise.then((e=>e.close())).catch((()=>{})),function(...e){e.forEach((e=>e.catch((()=>{}))))}(T.promise.then((e=>e.stopIntercom())))};v.then((e=>e.on("close",I)));(async()=>{const e=await v,t=new u.RtspServer(e,void 0,!0);let s,n,a;const c=async e=>{(e=>{if(C.finished)return;const t=new m.RTCPeerConnection({bundlePolicy:e.configuration?.bundlePolicy,codecs:{audio:[...g.requiredAudioCodecs],video:[g.requiredVideoCodec]},iceServers:(0,y.getWeriftIceServers)(e.configuration)});(0,p.waitClosed)(t).then((()=>I())),(0,p.logConnectionState)(o,t),C.resolve(t),(async()=>{try{t.remoteIsBundled?await(0,p.waitConnected)(t):await(0,p.waitIceConnected)(t),(0,y.logIsLocalIceTransport)(o,t)}catch(e){}})()})(e);let r=!1,i=!1;const c=await C.promise,l=setTimeout((()=>I()),12e4);(0,p.waitClosed)(c).then((()=>clearTimeout(l)));const d=e=>{a=e,a.setDirection("sendrecv"),a.mid="0",a.onTrack.subscribe((e=>{e.onReceiveRtp.subscribe((e=>{r||(r=!0,o.log("first audio packet",Date.now()-w)),t.sendTrack(s,e.serialize(),!1)})),e.onReceiveRtcp.subscribe((e=>t.sendTrack(s,e.serialize(),!0)))}))},f=e=>{const r=e;r.mid="1",r.onTrack.subscribe((e=>{o.log("received video track"),e.onReceiveRtp.subscribe((e=>{if(!i){i=!0,o.log("first video packet",Date.now()-w);const t=(0,u.getNaluTypesInNalu)(e.payload);o.log("video packet types",...t)}t.sendTrack(n,e.serialize(),!1)})),e.onReceiveRtcp.subscribe((e=>t.sendTrack(n,e.serialize(),!0))),e.onReceiveRtp.once((()=>{clearTimeout(l);let t=0;const s=setInterval((()=>{const s=new h.FullIntraRequest({senderSsrc:r.receiver.rtcpSsrc,mediaSsrc:e.ssrc,fir:[{sequenceNumber:t++,ssrc:e.ssrc}]}),n=new m.RtcpPayloadSpecificFeedback({feedback:s});r.receiver.dtlsTransport.sendRtcp([n]),r.receiver.sendRtcpPLI(e.ssrc)}),4e3);(0,p.waitClosed)(c).then((()=>clearInterval(s)))}))}))};"answer"!==e.type?(d(c.addTransceiver("audio",e.audio)),f(c.addTransceiver("video",e.video))):c.onTransceiverAdded.subscribe((e=>{"audio"===e.kind?d(e):"video"===e.kind&&f(e)}))},S=async e=>{if("answer"!==e.type)throw new Error("rtsp setup needs answer sdp");t.sdp=(0,l.createSdpInput)(0,0,e.sdp);const r=(0,l.parseSdp)(t.sdp);s=r.msections.find((e=>"audio"===e.type)).control,n=r.msections.find((e=>"video"===e.type)).control,await t.handlePlayback(),o.log("rtsp server playback started")};const _=new class{constructor(){this.__proxy_props={options:{}},this.options={}}async getOptions(){return{}}async createLocalDescription(e,t,r){"offer"===e&&await c(t);const s=await C.promise;t.datachannel&&s.createDataChannel(t.datachannel.label,t.datachannel.dict);const n="complete"===s.iceGatheringState?Promise.resolve(void 0):new Promise((e=>s.iceGatheringStateChange.subscribe((t=>{"complete"===t&&e(void 0)}))));if(r&&(s.onicecandidate=e=>{o.log("sendIceCandidate",e.candidate.sdpMLineIndex,e.candidate.candidate),r({...e.candidate})}),"answer"===e){let e=await s.createAnswer();o.log("createLocalDescription",e.sdp);const t=(0,y.createRawResponse)(e);await S(t);const i=s.setLocalDescription(e);return r?t:(await i,await n,e=s.localDescription||e,(0,y.createRawResponse)(e))}{let e=await s.createOffer();o.log("createLocalDescription",e.sdp);const t=s.setLocalDescription(e);return r||(await t,await n,e=await s.createOffer()),(0,y.createRawResponse)(e)}}async setRemoteDescription(e,t){o.log("setRemoteDescription",e.sdp),"offer"===e.type?await c(t):await S(e);const r=await C.promise;await r.setRemoteDescription(e)}async addIceCandidate(e){o.log("addIceCandidate",e.sdpMLineIndex,e.candidate);const t=await C.promise;await t.addIceCandidate(e)}},A=await r(_);E.resolve(A),o.log("waiting for peer connection");const R=await C.promise;let P;o.log("waiting for ice connected"),await(0,p.waitIceConnected)(R);const k={__json_copy_serialize_children:!0,async startIntercom(e){if(!(0,y.isPeerConnectionAlive)(R))throw new Error("peer connection is closed");const t=a?.sender?.codec;if(!a?.sender?.sendRtp||!t)throw new Error("peer connection does not support two way audio");const r=await b.convertMediaObjectToJSON(e,d.ScryptedMimeTypes.FFmpegInput);let s=0;const{kill:n}=await(0,f.startRtpForwarderProcess)(o,r,{audio:{codecCopy:t.name,encoderArguments:(0,g.getFFmpegRtpAudioOutputArguments)(r.mediaStreamOptions?.audio,a.sender.codec,i),onRtp:e=>{const r=m.RtpPacket.deSerialize(e),n=Date.now();r.header.payloadType=t.payloadType,r.header.marker=n-s>1e3,a.sender.sendRtp(r.serialize()),s=n}}});k.stopIntercom(),P=n;(await E.promise).setPlayback({audio:!0,video:!1})},async stopIntercom(){P?.(),A.setPlayback({audio:!1,video:!1})}};T.resolve(k)})().catch((e=>{o.error("session start failed",e),E.reject(e),C.reject(e),T.reject(e),I()}));const _=C.promise.then((e=>(0,p.waitClosed)(e)));_.finally(I),C.promise.catch((e=>{o.error("failed to create webrtc signaling session",e),I()}));const A={url:`rtsp://127.0.0.1:${S}`,container:"rtsp",mediaStreamOptions:t};return{__json_copy_serialize_children:!0,mediaObject:await b.createMediaObject(A,d.ScryptedMimeTypes.MediaStreamUrl),getIntercom:()=>T.promise,pcClose:()=>_}},t.getRTCMediaStreamOptions=function(e,t){return{id:e,name:t,tool:"scrypted",container:"rtsp",video:{codec:"h264"},audio:{}}};const a=r(3290),c=r(3515),u=r(336),l=r(4890),d=o(r(2743)),h=r(5356),p=r(4779),f=r(532),g=r(969),m=r(3377),y=r(4813),{mediaManager:b}=d.default},6252:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(4774),t)},6266:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SecureTransportManager=void 0;const s=r(6448),n=r(5433),i=r(5692),o=r(3894),a=r(8806),c=(0,n.debug)("werift:packages/webrtc/src/transport/secureTransportManager.ts");t.SecureTransportManager=class{constructor({config:e,transceiverManager:t,sctpManager:r}){if(this.connectionState="new",this.iceConnectionState="new",this.iceGatheringState="new",this.iceGatheringStateChange=new n.Event,this.iceConnectionStateChange=new n.Event,this.onIceCandidate=new n.Event,this.connectionStateChange=new n.Event,this.config=e,this.transceiverManager=t,this.sctpManager=r,this.config.dtls){const{keys:e}=this.config.dtls;e&&this.setupCertificate(e)}}get dtlsTransports(){return[...this.transceiverManager.getTransceivers().map((e=>e.dtlsTransport)),this.sctpManager.sctpTransport?.dtlsTransport].filter((e=>null!=e)).reduce(((e,t)=>(e.map((e=>e.id)).includes(t.id)||e.push(t),e)),[])}get iceTransports(){return this.dtlsTransports.map((e=>e.iceTransport))}setupCertificate(e){this.certificate=new i.RTCCertificate(e.keyPem,e.certPem,e.signatureHash)}createTransport(){const[e]=this.iceTransports,t=new o.RTCIceGatherer({...(0,a.parseIceServers)(this.config.iceServers),forceTurn:"relay"===this.config.iceTransportPolicy,portRange:this.config.icePortRange,interfaceAddresses:this.config.iceInterfaceAddresses,additionalHostAddresses:this.config.iceAdditionalHostAddresses,filterStunResponse:this.config.iceFilterStunResponse,filterCandidatePair:this.config.iceFilterCandidatePair,localPasswordPrefix:this.config.icePasswordPrefix,useIpv4:this.config.iceUseIpv4,useIpv6:this.config.iceUseIpv6,turnTransport:!0===this.config.forceTurnTCP?"tcp":"udp",useLinkLocalAddress:this.config.iceUseLinkLocalAddress});e&&(t.connection.localUsername=e.connection.localUsername,t.connection.localPassword=e.connection.localPassword),t.onGatheringStateChange.subscribe((()=>{this.updateIceGatheringState()})),this.updateIceGatheringState();const r=new o.RTCIceTransport(t);r.onStateChange.subscribe((()=>{this.updateIceConnectionState()}));return new i.RTCDtlsTransport(this.config,r,this.certificate,u)}handleNewIceCandidate({candidate:e,media:t,remoteIsBundled:r,transceiver:s,sctpTransport:n,bundlePolicy:i}){return"max-bundle"===i||r?(e.sdpMLineIndex=0,t&&(e.sdpMid=t.rtp.muxId)):(s&&(e.sdpMLineIndex=s.mLineIndex,e.sdpMid=s.mid),n&&(e.sdpMLineIndex=n.mLineIndex,e.sdpMid=n.mid)),e.foundation&&!e.foundation.startsWith("candidate:")&&(e.foundation="candidate:"+e.foundation),this.onIceCandidate.execute(e),e}async addIceCandidate(e,t){const r=o.IceCandidate.fromJSON(t);if(!r)return;let s;"number"==typeof r.sdpMid&&(s=this.getTransportByMid(r.sdpMid)),s||"number"!=typeof r.sdpMLineIndex||(s=this.getTransportByMLineIndex(e,r.sdpMLineIndex)),s||(s=this.iceTransports[0]),s?await s.addRemoteCandidate(r):c("iceTransport not found for candidate",r)}getTransportByMid(e){let t;const r=this.transceiverManager.getTransceivers().find((t=>t.mid===e));return r?t=r.dtlsTransport.iceTransport:t||this.sctpManager.sctpTransport?.mid!==e||(t=this.sctpManager.sctpTransport.dtlsTransport.iceTransport),t}getTransportByMLineIndex(e,t){const r=e.media[t];if(!r)return;return this.getTransportByMid(r.rtp.muxId)}restartIce(){for(const e of this.iceTransports)e.restart()}setLocalRole({type:e,role:t}){for(const r of this.dtlsTransports){const s=r.iceTransport;s.connection.iceControlling="offer"===e,s.connection.remoteIsLite&&(s.connection.iceControlling=!0),"answer"===e&&t&&(r.role=t)}}updateIceGatheringState(){const e=this.iceTransports;function t(...t){return e.filter((e=>t.includes(e.gatheringState))).length===e.length}let r;r=e.length&&t("complete")?"complete":!e.length||t("new","complete")?"new":e.map((e=>e.gatheringState)).includes("gathering")?"gathering":"new",this.iceGatheringState!==r&&(this.iceGatheringState=r,this.iceGatheringStateChange.execute(r))}updateIceConnectionState(){const e=this.iceTransports;let t;function r(...t){return e.filter((e=>t.includes(e.state))).length===e.length}function s(...t){return e.some((e=>t.includes(e.state)))}t="closed"===this.connectionState?"closed":s("failed")?"failed":s("disconnected")?"disconnected":r("new","closed")?"new":s("new","checking")?"checking":r("completed","closed")?"completed":r("connected","completed","closed")?"connected":"new",this.iceConnectionState!==t&&(c("iceConnectionStateChange",t),this.iceConnectionState=t,this.iceConnectionStateChange.execute(t))}async gatherCandidates(e){const t=this.iceTransports.find((e=>"connected"===e.state||"completed"===e.state));e&&t?c("skipping ICE gathering for bundled connection"):await Promise.allSettled(this.iceTransports.map((e=>e.gather()))).catch((e=>{c("gatherCandidates failed",e)}))}setConnectionState(e){c("connectionStateChange",e),this.connectionState=e,this.connectionStateChange.execute(e)}async getStats(){const e=[];for(const t of this.dtlsTransports){const r=await t.getStats();r&&e.push(...r)}return e}async ensureCerts(){this.certificate||(this.certificate=await i.RTCDtlsTransport.SetupCertificate());for(const e of this.dtlsTransports)e.localCertificate=this.certificate}async close(){this.setConnectionState("closed"),await Promise.allSettled([...this.dtlsTransports.map((e=>e.stop()))]),this.iceGatheringStateChange.allUnsubscribe(),this.iceConnectionStateChange.allUnsubscribe(),this.onIceCandidate.allUnsubscribe(),this.connectionStateChange.allUnsubscribe()}};const u=[s.SRTP_PROFILE.SRTP_AEAD_AES_128_GCM,s.SRTP_PROFILE.SRTP_AES128_CM_HMAC_SHA1_80]},6276:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(8774),t),n(r(7734),t),n(r(759),t),n(r(4582),t),n(r(9587),t),n(r(9260),t),n(r(4111),t),n(r(3862),t),n(r(4579),t),n(r(7522),t),n(r(3535),t)},6282:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPlaintext=t.createFragments=void 0;const s=r(1598);t.createFragments=e=>t=>(e.lastFlight=t,t.flatMap((t=>{t.messageSeq=e.sequenceNumber++;return t.toFragment().chunk()})));t.createPlaintext=e=>(t,r)=>t.map((t=>new s.DtlsPlaintext({contentType:t.type,protocolVersion:e.version,epoch:e.epoch,sequenceNumber:r,contentLen:t.fragment.length},t.fragment)))},6316:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenegotiationIndication=void 0;const s=r(6353);class n{constructor(e={}){this.type=n.type,this.data=0,Object.assign(this,e)}static createEmpty(){return new n}static deSerialize(e){return new n((0,s.decode)(e,n.spec))}serialize(){const e=(0,s.encode)(this,n.spec).slice();return Buffer.from(e)}get extension(){return{type:this.type,data:this.serialize().slice(2)}}}t.RenegotiationIndication=n,n.type=65281,n.spec={type:s.types.uint16be,data:s.types.uint8}},6350:(e,t,r)=>{"use strict";const{createSlicedTable:s}=r(1992),n=r(8459),i=s(2197175160);e.exports=function(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e);return(4294967295^n(i,t,4294967295,0))>>>0}},6353:(e,t,r)=>{"use strict";const s=r(872),n=r(4351),i=r(5890),o=r(7260),a=r(656),c=r(5353),u=r(256),l=r(228),d=r(3976),{encode:h}=r(1620),{decode:p}=r(7868),{encodingLength:f}=r(1236),g=r(7552),m=r(8176),y={array:n,bool:o,buffer:i,reserved:a,string:c,when:l,select:d};for(const e of Object.keys(u))y[e]=u[e];const b=Symbol("schema");function v(e){const t=new s({readableObjectMode:!1,writableObjectMode:!0,transform:w});return t[b]=e,t}function S(e){let t=null;const r=Buffer.isBuffer(e);r||(t=e);const n=new s({transform:E,readableObjectMode:!0,writableObjectMode:!1});return n[b]=t,r&&n.append(e),n}function w(e,t,r){try{h(e,this[b],this);const t=this.slice();this.consume(t.length),r(null,t)}catch(e){r(e)}}function E(e,t,r){this.append(e);try{for(;this.length>0;){const e=new g(this),t=p(e,this[b]);e.commit(),this.push(t)}r()}catch(e){e instanceof m?r():r(e)}}e.exports={createEncodeStream:v,createDecodeStream:S,encode:h,decode:p,encodingLength:f,createEncode:v,createDecode:S,types:y,BinaryStream:s,NotEnoughDataError:m}},6444:e=>{"use strict";e.exports=function(e,t,r,s){let n=r;for(let r=s;r<t.length;r+=1){const s=t[r];n=e[0][255&(n^s)]^n>>>8}return n}},6448:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignatureAlgorithm=t.ReceiverDirection=t.SenderDirections=t.SRTP_PROFILE=t.SSRC_INFO_ATTRS=t.FMTP_INT_PARAMETERS=t.DTLS_SETUP_ROLE=t.DTLS_ROLE_SETUP=t.DIRECTIONS=t.MEDIA_KINDS=t.DISCARD_PORT=t.DISCARD_HOST=t.WEBRTC_BINARY_EMPTY=t.WEBRTC_STRING_EMPTY=t.WEBRTC_BINARY=t.WEBRTC_STRING=t.WEBRTC_DCEP=t.DATA_CHANNEL_PARTIAL_RELIABLE_TIMED_UNORDERED=t.DATA_CHANNEL_PARTIAL_RELIABLE_REXMIT_UNORDERED=t.DATA_CHANNEL_RELIABLE_UNORDERED=t.DATA_CHANNEL_PARTIAL_RELIABLE_TIMED=t.DATA_CHANNEL_PARTIAL_RELIABLE_REXMIT=t.DATA_CHANNEL_RELIABLE=t.DATA_CHANNEL_OPEN=t.DATA_CHANNEL_ACK=void 0;const s=r(1597);Object.defineProperty(t,"SignatureAlgorithm",{enumerable:!0,get:function(){return s.SignatureAlgorithm}});const n=r(6252);t.DATA_CHANNEL_ACK=2,t.DATA_CHANNEL_OPEN=3,t.DATA_CHANNEL_RELIABLE=0,t.DATA_CHANNEL_PARTIAL_RELIABLE_REXMIT=1,t.DATA_CHANNEL_PARTIAL_RELIABLE_TIMED=2,t.DATA_CHANNEL_RELIABLE_UNORDERED=128,t.DATA_CHANNEL_PARTIAL_RELIABLE_REXMIT_UNORDERED=129,t.DATA_CHANNEL_PARTIAL_RELIABLE_TIMED_UNORDERED=130,t.WEBRTC_DCEP=50,t.WEBRTC_STRING=51,t.WEBRTC_BINARY=53,t.WEBRTC_STRING_EMPTY=56,t.WEBRTC_BINARY_EMPTY=57,t.DISCARD_HOST="0.0.0.0",t.DISCARD_PORT=9,t.MEDIA_KINDS=["audio","video"],t.DIRECTIONS=["inactive","sendonly","recvonly","sendrecv"],t.DTLS_ROLE_SETUP={auto:"actpass",client:"active",server:"passive"},t.DTLS_SETUP_ROLE=Object.keys(t.DTLS_ROLE_SETUP).reduce(((e,r)=>(e[t.DTLS_ROLE_SETUP[r]]=r,e)),{}),t.FMTP_INT_PARAMETERS=["apt","max-fr","max-fs","maxplaybackrate","minptime","stereo","useinbandfec"],t.SSRC_INFO_ATTRS=["cname","msid","mslabel","label"],t.SRTP_PROFILE={SRTP_AES128_CM_HMAC_SHA1_80:n.ProtectionProfileAes128CmHmacSha1_80,SRTP_AEAD_AES_128_GCM:n.ProtectionProfileAeadAes128Gcm},t.SenderDirections=["sendonly","sendrecv"],t.ReceiverDirection=["sendrecv","recvonly"]},6460:e=>{"use strict";e.exports=require("timers/promises")},6461:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerCertificateRequest=void 0;const s=r(6353),n=r(7077),i=r(3268),o=r(9602);class a{constructor(e,t,r){this.certificateTypes=e,this.signatures=t,this.authorities=r,this.msgType=o.HandshakeType.certificate_request_13}static createEmpty(){return new a(void 0,void 0,void 0)}static deSerialize(e){return new a(...Object.values((0,s.decode)(e,a.spec)))}serialize(){const e=(0,s.encode)(this,a.spec).slice();return Buffer.from(e)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.ServerCertificateRequest=a,a.spec={certificateTypes:s.types.array(i.ClientCertificateType,s.types.uint8,"bytes"),signatures:s.types.array(i.SignatureHashAlgorithm,s.types.uint16be,"bytes"),authorities:s.types.array(i.DistinguishedName,s.types.uint16be,"bytes")}},6518:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DER=t.DERErr=void 0,t.weierstrassPoints=m,t.weierstrass=function(e){const r=function(e){const t=(0,s.validateBasic)(e);return i.validateObject(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:c,n:u}=r,l=c.BYTES+1,p=2*c.BYTES+1;function f(e){return(0,n.mod)(e,u)}function g(e){return(0,n.invert)(e,u)}const{ProjectivePoint:y,normPrivateKeyToScalar:b,weierstrassEquation:v,isWithinCurveOrder:S}=m({...r,toBytes(e,t,r){const s=t.toAffine(),n=c.toBytes(s.x),a=i.concatBytes;return(0,o.abool)("isCompressed",r),r?a(Uint8Array.from([t.hasEvenY()?2:3]),n):a(Uint8Array.from([4]),n,c.toBytes(s.y))},fromBytes(e){const t=e.length,r=e[0],s=e.subarray(1);if(t!==l||2!==r&&3!==r){if(t===p&&4===r){return{x:c.fromBytes(s.subarray(0,c.BYTES)),y:c.fromBytes(s.subarray(c.BYTES,2*c.BYTES))}}throw new Error("invalid Point, expected length of "+l+", or uncompressed "+p+", got "+t)}{const e=i.bytesToNumberBE(s);if(!i.inRange(e,h,c.ORDER))throw new Error("Point is not on curve");const t=v(e);let n;try{n=c.sqrt(t)}catch(e){const t=e instanceof Error?": "+e.message:"";throw new Error("Point is not on curve"+t)}return!(1&~r)!==((n&h)===h)&&(n=c.neg(n)),{x:e,y:n}}}}),w=e=>i.bytesToHex(i.numberToBytesBE(e,r.nByteLength));function E(e){return e>u>>h}const C=(e,t,r)=>i.bytesToNumberBE(e.slice(t,r));class T{constructor(e,t,r){this.r=e,this.s=t,this.recovery=r,this.assertValidity()}static fromCompact(e){const t=r.nByteLength;return e=(0,o.ensureBytes)("compactSignature",e,2*t),new T(C(e,0,t),C(e,t,2*t))}static fromDER(e){const{r,s}=t.DER.toSig((0,o.ensureBytes)("DER",e));return new T(r,s)}assertValidity(){i.aInRange("r",this.r,h,u),i.aInRange("s",this.s,h,u)}addRecoveryBit(e){return new T(this.r,this.s,e)}recoverPublicKey(e){const{r:t,s,recovery:n}=this,i=R((0,o.ensureBytes)("msgHash",e));if(null==n||![0,1,2,3].includes(n))throw new Error("recovery id invalid");const a=2===n||3===n?t+r.n:t;if(a>=c.ORDER)throw new Error("recovery id 2 or 3 invalid");const u=1&n?"03":"02",l=y.fromHex(u+w(a)),d=g(a),h=f(-i*d),p=f(s*d),m=y.BASE.multiplyAndAddUnsafe(l,h,p);if(!m)throw new Error("point at infinify");return m.assertValidity(),m}hasHighS(){return E(this.s)}normalizeS(){return this.hasHighS()?new T(this.r,f(-this.s),this.recovery):this}toDERRawBytes(){return i.hexToBytes(this.toDERHex())}toDERHex(){return t.DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return i.hexToBytes(this.toCompactHex())}toCompactHex(){return w(this.r)+w(this.s)}}const I={isValidPrivateKey(e){try{return b(e),!0}catch(e){return!1}},normPrivateKeyToScalar:b,randomPrivateKey:()=>{const e=(0,n.getMinHashLength)(r.n);return(0,n.mapHashToField)(r.randomBytes(e),r.n)},precompute:(e=8,t=y.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function _(e){const t=i.isBytes(e),r="string"==typeof e,s=(t||r)&&e.length;return t?s===l||s===p:r?s===2*l||s===2*p:e instanceof y}const A=r.bits2int||function(e){if(e.length>8192)throw new Error("input is too large");const t=i.bytesToNumberBE(e),s=8*e.length-r.nBitLength;return s>0?t>>BigInt(s):t},R=r.bits2int_modN||function(e){return f(A(e))},P=i.bitMask(r.nBitLength);function k(e){return i.aInRange("num < 2^"+r.nBitLength,e,d,P),i.numberToBytesBE(e,r.nByteLength)}function B(e,t,s=O){if(["recovered","canonical"].some((e=>e in s)))throw new Error("sign() legacy options not supported");const{hash:n,randomBytes:u}=r;let{lowS:l,prehash:p,extraEntropy:m}=s;null==l&&(l=!0),e=(0,o.ensureBytes)("msgHash",e),a(s),p&&(e=(0,o.ensureBytes)("prehashed msgHash",n(e)));const v=R(e),w=b(t),C=[k(w),k(v)];if(null!=m&&!1!==m){const e=!0===m?u(c.BYTES):m;C.push((0,o.ensureBytes)("extraEntropy",e))}const I=i.concatBytes(...C),_=v;return{seed:I,k2sig:function(e){const t=A(e);if(!S(t))return;const r=g(t),s=y.BASE.multiply(t).toAffine(),n=f(s.x);if(n===d)return;const i=f(r*f(_+n*w));if(i===d)return;let o=(s.x===n?0:2)|Number(s.y&h),a=i;return l&&E(i)&&(a=function(e){return E(e)?f(-e):e}(i),o^=1),new T(n,a,o)}}}const O={lowS:r.lowS,prehash:!1},x={lowS:r.lowS,prehash:!1};return y.BASE._setWindowSize(8),{CURVE:r,getPublicKey:function(e,t=!0){return y.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,r=!0){if(_(e))throw new Error("first arg must be private key");if(!_(t))throw new Error("second arg must be public key");return y.fromHex(t).multiply(b(e)).toRawBytes(r)},sign:function(e,t,s=O){const{seed:n,k2sig:o}=B(e,t,s),a=r;return i.createHmacDrbg(a.hash.outputLen,a.nByteLength,a.hmac)(n,o)},verify:function(e,s,n,c=x){const u=e;s=(0,o.ensureBytes)("msgHash",s),n=(0,o.ensureBytes)("publicKey",n);const{lowS:l,prehash:d,format:h}=c;if(a(c),"strict"in c)throw new Error("options.strict was renamed to lowS");if(void 0!==h&&"compact"!==h&&"der"!==h)throw new Error("format must be compact or der");const p="string"==typeof u||i.isBytes(u),m=!p&&!h&&"object"==typeof u&&null!==u&&"bigint"==typeof u.r&&"bigint"==typeof u.s;if(!p&&!m)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let b,v;try{if(m&&(b=new T(u.r,u.s)),p){try{"compact"!==h&&(b=T.fromDER(u))}catch(e){if(!(e instanceof t.DER.Err))throw e}b||"der"===h||(b=T.fromCompact(u))}v=y.fromHex(n)}catch(e){return!1}if(!b)return!1;if(l&&b.hasHighS())return!1;d&&(s=r.hash(s));const{r:S,s:w}=b,E=R(s),C=g(w),I=f(E*C),_=f(S*C),A=y.BASE.multiplyAndAddUnsafe(v,I,_)?.toAffine();if(!A)return!1;return f(A.x)===S},ProjectivePoint:y,Signature:T,utils:I}},t.SWUFpSqrtRatio=y,t.mapToCurveSimpleSWU=function(e,t){if((0,n.validateField)(e),!e.isValid(t.A)||!e.isValid(t.B)||!e.isValid(t.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");const r=y(e,t.Z);if(!e.isOdd)throw new Error("Fp.isOdd is not implemented!");return s=>{let n,i,o,a,c,u,l,d;n=e.sqr(s),n=e.mul(n,t.Z),i=e.sqr(n),i=e.add(i,n),o=e.add(i,e.ONE),o=e.mul(o,t.B),a=e.cmov(t.Z,e.neg(i),!e.eql(i,e.ZERO)),a=e.mul(a,t.A),i=e.sqr(o),u=e.sqr(a),c=e.mul(u,t.A),i=e.add(i,c),i=e.mul(i,o),u=e.mul(u,a),c=e.mul(u,t.B),i=e.add(i,c),l=e.mul(n,o);const{isValid:h,value:p}=r(i,u);d=e.mul(n,s),d=e.mul(d,p),l=e.cmov(l,o,h),d=e.cmov(d,p,h);const f=e.isOdd(s)===e.isOdd(d);return d=e.cmov(e.neg(d),d,f),l=e.div(l,a),{x:l,y:d}}};const s=r(1589),n=r(5720),i=r(3939),o=r(3939);function a(e){void 0!==e.lowS&&(0,o.abool)("lowS",e.lowS),void 0!==e.prehash&&(0,o.abool)("prehash",e.prehash)}const{bytesToNumberBE:c,hexToBytes:u}=i;class l extends Error{constructor(e=""){super(e)}}t.DERErr=l,t.DER={Err:l,_tlv:{encode:(e,r)=>{const{Err:s}=t.DER;if(e<0||e>256)throw new s("tlv.encode: wrong tag");if(1&r.length)throw new s("tlv.encode: unpadded data");const n=r.length/2,o=i.numberToHexUnpadded(n);if(o.length/2&128)throw new s("tlv.encode: long form length too big");const a=n>127?i.numberToHexUnpadded(o.length/2|128):"";return i.numberToHexUnpadded(e)+a+o+r},decode(e,r){const{Err:s}=t.DER;let n=0;if(e<0||e>256)throw new s("tlv.encode: wrong tag");if(r.length<2||r[n++]!==e)throw new s("tlv.decode: wrong tlv");const i=r[n++];let o=0;if(!!(128&i)){const e=127&i;if(!e)throw new s("tlv.decode(long): indefinite length not supported");if(e>4)throw new s("tlv.decode(long): byte length is too big");const t=r.subarray(n,n+e);if(t.length!==e)throw new s("tlv.decode: length bytes not complete");if(0===t[0])throw new s("tlv.decode(long): zero leftmost byte");for(const e of t)o=o<<8|e;if(n+=e,o<128)throw new s("tlv.decode(long): not minimal encoding")}else o=i;const a=r.subarray(n,n+o);if(a.length!==o)throw new s("tlv.decode: wrong value length");return{v:a,l:r.subarray(n+o)}}},_int:{encode(e){const{Err:r}=t.DER;if(e<d)throw new r("integer: negative integers are not allowed");let s=i.numberToHexUnpadded(e);if(8&Number.parseInt(s[0],16)&&(s="00"+s),1&s.length)throw new r("unexpected DER parsing assertion: unpadded hex");return s},decode(e){const{Err:r}=t.DER;if(128&e[0])throw new r("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new r("invalid signature integer: unnecessary leading zero");return c(e)}},toSig(e){const{Err:r,_int:s,_tlv:n}=t.DER,o="string"==typeof e?u(e):e;i.abytes(o);const{v:a,l:c}=n.decode(48,o);if(c.length)throw new r("invalid signature: left bytes after parsing");const{v:l,l:d}=n.decode(2,a),{v:h,l:p}=n.decode(2,d);if(p.length)throw new r("invalid signature: left bytes after parsing");return{r:s.decode(l),s:s.decode(h)}},hexFromSig(e){const{_tlv:r,_int:s}=t.DER,n=r.encode(2,s.encode(e.r))+r.encode(2,s.encode(e.s));return r.encode(48,n)}};const d=BigInt(0),h=BigInt(1),p=BigInt(2),f=BigInt(3),g=BigInt(4);function m(e){const t=function(e){const t=(0,s.validateBasic)(e);i.validateObject(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:o}=t;if(r){if(!n.eql(o,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:r}=t,a=(0,n.Field)(t.n,t.nBitLength),c=t.toBytes||((e,t,s)=>{const n=t.toAffine();return i.concatBytes(Uint8Array.from([4]),r.toBytes(n.x),r.toBytes(n.y))}),u=t.fromBytes||(e=>{const t=e.subarray(1);return{x:r.fromBytes(t.subarray(0,r.BYTES)),y:r.fromBytes(t.subarray(r.BYTES,2*r.BYTES))}});function l(e){const{a:s,b:n}=t,i=r.sqr(e),o=r.mul(i,e);return r.add(r.add(o,r.mul(e,s)),n)}if(!r.eql(r.sqr(t.Gy),l(t.Gx)))throw new Error("bad generator point: equation left != right");function p(e){const{allowedPrivateKeyLengths:r,nByteLength:s,wrapPrivateKey:a,n:c}=t;if(r&&"bigint"!=typeof e){if(i.isBytes(e)&&(e=i.bytesToHex(e)),"string"!=typeof e||!r.includes(e.length))throw new Error("invalid private key");e=e.padStart(2*s,"0")}let u;try{u="bigint"==typeof e?e:i.bytesToNumberBE((0,o.ensureBytes)("private key",e,s))}catch(t){throw new Error("invalid private key, expected hex or "+s+" bytes, got "+typeof e)}return a&&(u=(0,n.mod)(u,c)),i.aInRange("private key",u,h,c),u}function g(e){if(!(e instanceof b))throw new Error("ProjectivePoint expected")}const m=(0,o.memoized)(((e,t)=>{const{px:s,py:n,pz:i}=e;if(r.eql(i,r.ONE))return{x:s,y:n};const o=e.is0();null==t&&(t=o?r.ONE:r.inv(i));const a=r.mul(s,t),c=r.mul(n,t),u=r.mul(i,t);if(o)return{x:r.ZERO,y:r.ZERO};if(!r.eql(u,r.ONE))throw new Error("invZ was invalid");return{x:a,y:c}})),y=(0,o.memoized)((e=>{if(e.is0()){if(t.allowInfinityPoint&&!r.is0(e.py))return;throw new Error("bad point: ZERO")}const{x:s,y:n}=e.toAffine();if(!r.isValid(s)||!r.isValid(n))throw new Error("bad point: x or y not FE");const i=r.sqr(n),o=l(s);if(!r.eql(i,o))throw new Error("bad point: equation left != right");if(!e.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0}));class b{constructor(e,t,s){if(this.px=e,this.py=t,this.pz=s,null==e||!r.isValid(e))throw new Error("x required");if(null==t||!r.isValid(t))throw new Error("y required");if(null==s||!r.isValid(s))throw new Error("z required");Object.freeze(this)}static fromAffine(e){const{x:t,y:s}=e||{};if(!e||!r.isValid(t)||!r.isValid(s))throw new Error("invalid affine point");if(e instanceof b)throw new Error("projective point not allowed");const n=e=>r.eql(e,r.ZERO);return n(t)&&n(s)?b.ZERO:new b(t,s,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=r.invertBatch(e.map((e=>e.pz)));return e.map(((e,r)=>e.toAffine(t[r]))).map(b.fromAffine)}static fromHex(e){const t=b.fromAffine(u((0,o.ensureBytes)("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return b.BASE.multiply(p(e))}static msm(e,t){return(0,s.pippenger)(b,a,e,t)}_setWindowSize(e){S.setWindowSize(this,e)}assertValidity(){y(this)}hasEvenY(){const{y:e}=this.toAffine();if(r.isOdd)return!r.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){g(e);const{px:t,py:s,pz:n}=this,{px:i,py:o,pz:a}=e,c=r.eql(r.mul(t,a),r.mul(i,n)),u=r.eql(r.mul(s,a),r.mul(o,n));return c&&u}negate(){return new b(this.px,r.neg(this.py),this.pz)}double(){const{a:e,b:s}=t,n=r.mul(s,f),{px:i,py:o,pz:a}=this;let c=r.ZERO,u=r.ZERO,l=r.ZERO,d=r.mul(i,i),h=r.mul(o,o),p=r.mul(a,a),g=r.mul(i,o);return g=r.add(g,g),l=r.mul(i,a),l=r.add(l,l),c=r.mul(e,l),u=r.mul(n,p),u=r.add(c,u),c=r.sub(h,u),u=r.add(h,u),u=r.mul(c,u),c=r.mul(g,c),l=r.mul(n,l),p=r.mul(e,p),g=r.sub(d,p),g=r.mul(e,g),g=r.add(g,l),l=r.add(d,d),d=r.add(l,d),d=r.add(d,p),d=r.mul(d,g),u=r.add(u,d),p=r.mul(o,a),p=r.add(p,p),d=r.mul(p,g),c=r.sub(c,d),l=r.mul(p,h),l=r.add(l,l),l=r.add(l,l),new b(c,u,l)}add(e){g(e);const{px:s,py:n,pz:i}=this,{px:o,py:a,pz:c}=e;let u=r.ZERO,l=r.ZERO,d=r.ZERO;const h=t.a,p=r.mul(t.b,f);let m=r.mul(s,o),y=r.mul(n,a),v=r.mul(i,c),S=r.add(s,n),w=r.add(o,a);S=r.mul(S,w),w=r.add(m,y),S=r.sub(S,w),w=r.add(s,i);let E=r.add(o,c);return w=r.mul(w,E),E=r.add(m,v),w=r.sub(w,E),E=r.add(n,i),u=r.add(a,c),E=r.mul(E,u),u=r.add(y,v),E=r.sub(E,u),d=r.mul(h,w),u=r.mul(p,v),d=r.add(u,d),u=r.sub(y,d),d=r.add(y,d),l=r.mul(u,d),y=r.add(m,m),y=r.add(y,m),v=r.mul(h,v),w=r.mul(p,w),y=r.add(y,v),v=r.sub(m,v),v=r.mul(h,v),w=r.add(w,v),m=r.mul(y,w),l=r.add(l,m),m=r.mul(E,w),u=r.mul(S,u),u=r.sub(u,m),m=r.mul(S,y),d=r.mul(E,d),d=r.add(d,m),new b(u,l,d)}subtract(e){return this.add(e.negate())}is0(){return this.equals(b.ZERO)}wNAF(e){return S.wNAFCached(this,e,b.normalizeZ)}multiplyUnsafe(e){const{endo:s,n}=t;i.aInRange("scalar",e,d,n);const o=b.ZERO;if(e===d)return o;if(this.is0()||e===h)return this;if(!s||S.hasPrecomputes(this))return S.wNAFCachedUnsafe(this,e,b.normalizeZ);let{k1neg:a,k1:c,k2neg:u,k2:l}=s.splitScalar(e),p=o,f=o,g=this;for(;c>d||l>d;)c&h&&(p=p.add(g)),l&h&&(f=f.add(g)),g=g.double(),c>>=h,l>>=h;return a&&(p=p.negate()),u&&(f=f.negate()),f=new b(r.mul(f.px,s.beta),f.py,f.pz),p.add(f)}multiply(e){const{endo:s,n}=t;let o,a;if(i.aInRange("scalar",e,h,n),s){const{k1neg:t,k1:n,k2neg:i,k2:c}=s.splitScalar(e);let{p:u,f:l}=this.wNAF(n),{p:d,f:h}=this.wNAF(c);u=S.constTimeNegate(t,u),d=S.constTimeNegate(i,d),d=new b(r.mul(d.px,s.beta),d.py,d.pz),o=u.add(d),a=l.add(h)}else{const{p:t,f:r}=this.wNAF(e);o=t,a=r}return b.normalizeZ([o,a])[0]}multiplyAndAddUnsafe(e,t,r){const s=b.BASE,n=(e,t)=>t!==d&&t!==h&&e.equals(s)?e.multiply(t):e.multiplyUnsafe(t),i=n(this,t).add(n(e,r));return i.is0()?void 0:i}toAffine(e){return m(this,e)}isTorsionFree(){const{h:e,isTorsionFree:r}=t;if(e===h)return!0;if(r)return r(b,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:r}=t;return e===h?this:r?r(b,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return(0,o.abool)("isCompressed",e),this.assertValidity(),c(b,this,e)}toHex(e=!0){return(0,o.abool)("isCompressed",e),i.bytesToHex(this.toRawBytes(e))}}b.BASE=new b(t.Gx,t.Gy,r.ONE),b.ZERO=new b(r.ZERO,r.ONE,r.ZERO);const v=t.nBitLength,S=(0,s.wNAF)(b,t.endo?Math.ceil(v/2):v);return{CURVE:t,ProjectivePoint:b,normPrivateKeyToScalar:p,weierstrassEquation:l,isWithinCurveOrder:function(e){return i.inRange(e,h,t.n)}}}function y(e,t){const r=e.ORDER;let s=d;for(let e=r-h;e%p===d;e/=p)s+=h;const n=s,i=p<<n-h-h,o=i*p,a=(r-h)/o,c=(a-h)/p,u=o-h,l=i,m=e.pow(t,a),y=e.pow(t,(a+h)/p);let b=(t,r)=>{let s=m,i=e.pow(r,u),o=e.sqr(i);o=e.mul(o,r);let a=e.mul(t,o);a=e.pow(a,c),a=e.mul(a,i),i=e.mul(a,r),o=e.mul(a,t);let d=e.mul(o,i);a=e.pow(d,l);let f=e.eql(a,e.ONE);i=e.mul(o,y),a=e.mul(d,s),o=e.cmov(i,o,f),d=e.cmov(a,d,f);for(let t=n;t>h;t--){let r=t-p;r=p<<r-h;let n=e.pow(d,r);const a=e.eql(n,e.ONE);i=e.mul(o,s),s=e.mul(s,s),n=e.mul(d,s),o=e.cmov(i,o,a),d=e.cmov(n,d,a)}return{isValid:f,value:o}};if(e.ORDER%g===f){const r=(e.ORDER-f)/g,s=e.sqrt(e.neg(t));b=(t,n)=>{let i=e.sqr(n);const o=e.mul(t,n);i=e.mul(i,o);let a=e.pow(i,r);a=e.mul(a,o);const c=e.mul(a,s),u=e.mul(e.sqr(a),n),l=e.eql(u,t);return{isValid:l,value:e.cmov(c,a,l)}}}return b}},6528:e=>{"use strict";class t{constructor(){this.next=null,this.buffer=null}}e.exports=class e{constructor(){this.head=null,this.tail=null,this.length=0,this.count=0}push(e){const r=new t;r.buffer=e,this.length>0?this.tail.next=r:this.head=r,this.tail=r,this.length+=e.length,this.count+=1}unshift(e){const r=new t;r.buffer=e,r.next=this.head,this.isEmpty()&&(this.tail=r),this.head=r,this.length+=e.length,this.count+=1}shift(){if(this.isEmpty())return null;const e=this.head.buffer;return this.head===this.tail?(this.head=null,this.tail=null):this.head=this.head.next,this.length-=e.length,this.length=Math.max(this.length,0),this.count-=1,e}get first(){return this.isEmpty()?null:this.head.buffer}get last(){return this.isEmpty()?null:this.tail.buffer}isEmpty(){return 0===this.length}clear(){this.head=null,this.tail=null,this.length=0,this.count=0}slice(t,r){if(t<0||t>=this.length)return new e;if(r<0||r>this.length||r<t)return new e;const s=new e;let n=this.head,i=t,o=r;for(;n;){if(n.buffer.length>i){0===i&&n.buffer.length<=o?s.push(n.buffer):n.buffer.length>=o?s.push(n.buffer.slice(i,o)):s.push(n.buffer.slice(i));break}i-=n.buffer.length,o-=n.buffer.length,n=n.next}if(n.buffer.length<o)for(;n;){if(n.buffer.length===o){s.push(n.buffer);break}if(n.buffer.length>o){s.push(n.buffer.slice(0,o));break}i<0&&n.buffer.length<o&&s.push(n.buffer),i-=n.buffer.length,o-=n.buffer.length,n=n.next}return s}}},6550:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;t.Session=class{constructor(e){this.ContextCls=e}start(e,t,r,s,n){this.localContext=new this.ContextCls(e,t,n),this.remoteContext=new this.ContextCls(r,s,n)}}},6719:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.depacketizerCodecs=void 0,t.dePacketizeRtpPackets=function(e,t,r){const s=e=>{const s=[];for(const n of t){const t=e.deSerialize(n.payload,r);t.fragment?(r??=Buffer.alloc(0),r=t.fragment):t.payload&&(r=void 0),s.push(t)}return{isKeyframe:!!s.find((e=>e.isKeyframe)),data:Buffer.concat(s.map((e=>e.payload)).filter((e=>e))),sequence:t.at(-1)?.header.sequenceNumber??0,timestamp:t.at(-1)?.header.timestamp??0,frameFragmentBuffer:r}};switch(e.toUpperCase()){case"AV1":{const e=t.map((e=>i.AV1RtpPayload.deSerialize(e.payload)));return{isKeyframe:!!e.find((e=>e.isKeyframe)),data:i.AV1RtpPayload.getFrame(e),sequence:t.at(-1)?.header.sequenceNumber??0,timestamp:t.at(-1)?.header.timestamp??0}}case"MPEG4/ISO/AVC":return s(o.H264RtpPayload);case"VP8":return s(c.Vp8RtpPayload);case"VP9":return s(u.Vp9RtpPayload);case"OPUS":return s(a.OpusRtpPayload);default:throw new Error}};const i=r(8597),o=r(3679),a=r(4448),c=r(8341),u=r(2510);n(r(8597),t),n(r(4390),t),n(r(3679),t),n(r(4448),t),n(r(8341),t),n(r(2510),t),t.depacketizerCodecs=["MPEG4/ISO/AVC","VP8","VP9","OPUS","AV1"]},6736:(e,t,r)=>{for(var s=r(9023),n=r(918),i=/[\{\[]/,o=/[\}\]]/,a=["do","if","in","for","let","new","try","var","case","else","enum","eval","null","this","true","void","with","await","break","catch","class","const","false","super","throw","while","yield","delete","export","import","public","return","static","switch","typeof","default","extends","finally","package","private","continue","debugger","function","arguments","interface","protected","implements","instanceof","NaN","undefined"],c={},u=0;u<a.length;u++)c[a[u]]=!0;var l={s:function(e){return""+e},d:function(e){return""+Number(e)},o:function(e){return JSON.stringify(e)}},d=function(){var e=[],t=0,r={},a=function(r){for(var s="";s.length<2*t;)s+="  ";e.push(s+r)},u=function(e){return o.test(e.trim()[0])&&i.test(e[e.length-1])?(t--,a(e),void t++):i.test(e[e.length-1])?(a(e),void t++):o.test(e.trim()[0])?(t--,void a(e)):void a(e)},d=function(e){if(!e)return d;if(1===arguments.length&&e.indexOf("\n")>-1)for(var t=e.trim().split("\n"),r=0;r<t.length;r++)u(t[r].trim());else u(s.format.apply(s,arguments));return d};return d.scope={},d.formats=l,d.sym=function(e){return e&&function(e){return n(e)&&!c.hasOwnProperty(e)}(e)||(e="tmp"),r[e]||(r[e]=0),e+(r[e]++||"")},d.property=function(e,t){return 1===arguments.length&&(t=e,e=""),n(t+="")?e?e+"."+t:t:e?e+"["+JSON.stringify(t)+"]":JSON.stringify(t)},d.toString=function(){return e.join("\n")},d.toFunction=function(e){e||(e={});var t="return ("+d.toString()+")";Object.keys(d.scope).forEach((function(t){e[t]||(e[t]=d.scope[t])}));var r=Object.keys(e).map((function(e){return e})),s=r.map((function(t){return e[t]}));return Function.apply(null,r.concat(t)).apply(null,s)},arguments.length&&d.apply(null,arguments),d};d.formats=l,e.exports=d},6779:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTCSctpCapabilities=t.RTCSctpTransport=void 0;const s=r(6982),n=r(4694),i=r(5433),o=r(1836),a=r(6448),c=r(9420),u=(0,i.debug)("werift:packages/webrtc/src/transport/sctp.ts");t.RTCSctpTransport=class{constructor(e=5e3){this.port=e,this.onDataChannel=new i.Event,this.id=(0,s.randomUUID)().toString(),this.bundled=!1,this.dataChannels={},this.dataChannelQueue=[],this.eventDisposer=[],this.datachannelReceive=async(e,t,r)=>{if(t===a.WEBRTC_DCEP&&r.length>0)switch(u("DCEP",e,t,r),r[0]){case a.DATA_CHANNEL_OPEN:{if(r.length<12)return void u("DATA_CHANNEL_OPEN data.length not enough");if(Object.keys(this.dataChannels).includes(e.toString()))u("datachannel already opened","retransmit ack");else{const[,t,,s,i,o]=n.jspack.Unpack("!BBHLHH",r);let a=12;const l=r.slice(a,a+i).toString("utf8");a+=i;const d=r.slice(a,a+o).toString("utf8");u("DATA_CHANNEL_OPEN",{channelType:t,reliability:s,streamId:e,label:l,protocol:d});const h=1==(3&t)?s:void 0,p=2==(3&t)?s:void 0,f=new c.RTCDataChannelParameters({label:l,ordered:!(128&t),maxPacketLifeTime:p,maxRetransmits:h,protocol:d,id:e}),g=new c.RTCDataChannel(this,f,!1);g.isCreatedByRemote=!0,this.dataChannels[e]=g,this.onDataChannel.execute(g),g.setReadyState("open")}const t=this.dataChannels[e];this.dataChannelQueue.push([t,a.WEBRTC_DCEP,Buffer.from(n.jspack.Pack("!B",[a.DATA_CHANNEL_ACK]))]),await this.dataChannelFlush()}break;case a.DATA_CHANNEL_ACK:{u("DATA_CHANNEL_ACK",e,t);const r=this.dataChannels[e];if(!r)throw new Error("channel not found");r.setReadyState("open")}}else{const s=this.dataChannels[e];if(s){const e=(()=>{switch(t){case a.WEBRTC_STRING:return r.toString("utf8");case a.WEBRTC_STRING_EMPTY:return"";case a.WEBRTC_BINARY:return r;case a.WEBRTC_BINARY_EMPTY:return Buffer.from([]);default:throw new Error}})();s.messagesReceived++,s.bytesReceived+=r.length,s.onMessage.execute(e),s.emit("message",{data:e}),s.onmessage&&s.onmessage({data:e})}}},this.datachannelSend=(e,t)=>{e.addBufferedAmount(t.length),this.dataChannelQueue.push("string"==typeof t?[e,a.WEBRTC_STRING,Buffer.from(t)]:[e,a.WEBRTC_BINARY,t]),this.sctp.associationState!==o.SCTP_STATE.ESTABLISHED&&u("sctp not established",this.sctp.associationState),this.dataChannelFlush()}}setDtlsTransport(e){this.dtlsTransport&&this.dtlsTransport.id===e.id||(this.eventDisposer.forEach((e=>e())),this.dtlsTransport=e,this.sctp=new o.SCTP(new d(this.dtlsTransport),this.port),this.eventDisposer=[...[this.sctp.onReceive.subscribe(this.datachannelReceive),this.sctp.onReconfigStreams.subscribe((e=>{e.forEach((e=>{const t=this.dataChannels[e];t&&(t.setReadyState("closing"),t.setReadyState("closed"),delete this.dataChannels[e])}))})),this.sctp.stateChanged.connected.subscribe((()=>{Object.values(this.dataChannels).forEach((e=>{e.negotiated&&"open"!==e.readyState&&e.setReadyState("open")})),this.dataChannelFlush()})),this.sctp.stateChanged.closed.subscribe((()=>{Object.values(this.dataChannels).forEach((e=>{e.setReadyState("closed")})),this.dataChannels={}})),this.dtlsTransport.onStateChange.subscribe((e=>{"closed"===e&&this.sctp.setState(o.SCTP_STATE.CLOSED)}))].map((e=>e.unSubscribe)),()=>this.sctp.onSackReceived=async()=>{}],this.sctp.onSackReceived=async()=>{await this.dataChannelFlush()})}get isServer(){return"controlling"!==this.dtlsTransport.iceTransport.role}channelByLabel(e){return Object.values(this.dataChannels).find((t=>t.label===e))}dataChannelAddNegotiated(e){if(null==e.id)throw new Error;if(this.dataChannels[e.id])throw new Error;this.dataChannels[e.id]=e,this.sctp.associationState===o.SCTP_STATE.ESTABLISHED&&e.setReadyState("open")}dataChannelOpen(e){if(e.id){if(this.dataChannels[e.id])throw new Error(`Data channel with ID ${e.id} already registered`);this.dataChannels[e.id]=e}let t=a.DATA_CHANNEL_RELIABLE;let r=0;e.ordered||(t=128),e.maxRetransmits?(t=1,r=e.maxRetransmits):e.maxPacketLifeTime&&(t=2,r=e.maxPacketLifeTime);const s=n.jspack.Pack("!BBHLHH",[a.DATA_CHANNEL_OPEN,t,0,r,e.label.length,e.protocol.length]),i=Buffer.concat([Buffer.from(s),Buffer.from(e.label,"utf8"),Buffer.from(e.protocol,"utf8")]);this.dataChannelQueue.push([e,a.WEBRTC_DCEP,i]),this.dataChannelFlush()}async dataChannelFlush(){if(this.sctp.associationState==o.SCTP_STATE.ESTABLISHED&&!(this.sctp.outboundQueue.length>0)){for(;this.dataChannelQueue.length>0;){const[e,t,r]=this.dataChannelQueue.shift();let s=e.id;if(void 0===s){for(s=this.dataChannelId;Object.keys(this.dataChannels).includes(s.toString());)s+=2;this.dataChannels[s]=e,e.setId(s)}if(t===a.WEBRTC_DCEP)await this.sctp.send(s,t,r,{ordered:!0});else{const n=e.maxPacketLifeTime?Date.now()+e.maxPacketLifeTime/1e3:void 0;await this.sctp.send(s,t,r,{expiry:n,maxRetransmits:e.maxRetransmits,ordered:e.ordered}),e.addBufferedAmount(-r.length)}}this.dataChannelQueue=[]}}static getCapabilities(){return new l(65536)}setRemotePort(e){this.sctp.setRemotePort(e)}async start(e){this.isServer?this.dataChannelId=0:this.dataChannelId=1,this.sctp.isServer=this.isServer,await this.sctp.start(e)}async stop(){this.dtlsTransport.dataReceiver=()=>{},await this.sctp.stop()}dataChannelClose(e){["closing","closed"].includes(e.readyState)||(e.setReadyState("closing"),this.sctp.associationState===o.SCTP_STATE.ESTABLISHED?(this.sctp.reconfigQueue.includes(e.id)||this.sctp.reconfigQueue.push(e.id),1===this.sctp.reconfigQueue.length&&this.sctp.transmitReconfigRequest()):(this.dataChannelQueue=this.dataChannelQueue.filter((t=>t[0].id!==e.id)),this.sctp.reconfigQueue=this.sctp.reconfigQueue.filter((t=>t!==e.id)),e.id&&delete this.dataChannels[e.id],e.setReadyState("closed")))}};class l{constructor(e){this.maxMessageSize=e}}t.RTCSctpCapabilities=l;class d{constructor(e){this.dtls=e,this.send=e=>this.dtls.sendData(e)}set onData(e){this.dtls.dataReceiver=e}close(){}}},6879:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SourceDescriptionItem=t.SourceDescriptionChunk=t.RtcpSourceDescriptionPacket=void 0;const s=r(9543),n=r(4221);class i{constructor(e){this.type=i.type,this.chunks=[],Object.assign(this,e)}get length(){let e=0;return this.chunks.forEach((t=>e+=t.length)),e}serialize(){let e=Buffer.concat(this.chunks.map((e=>e.serialize())));for(;e.length%4;)e=Buffer.concat([e,Buffer.from([0])]);return n.RtcpHeader.serialize(this.type,this.chunks.length,e,e.length/4)}static deSerialize(e,t){const r=[];for(let t=0;t<e.length;){const s=o.deSerialize(e.slice(t));r.push(s),t+=s.length}return new i({chunks:r})}}t.RtcpSourceDescriptionPacket=i,i.type=202;class o{constructor(e={}){this.items=[],Object.assign(this,e)}get length(){let e=4;return this.items.forEach((t=>e+=t.length)),e+=1,e+=c(e),e}serialize(){const e=Buffer.concat([(0,s.bufferWriter)([4],[this.source]),Buffer.concat(this.items.map((e=>e.serialize())))]);return Buffer.concat([e,Buffer.alloc(c(e.length))])}static deSerialize(e){const t=e.readUInt32BE(),r=[];for(let t=4;t<e.length;){if(0===e[t])break;const s=a.deSerialize(e.slice(t));r.push(s),t+=s.length}return new o({source:t,items:r})}}t.SourceDescriptionChunk=o;class a{constructor(e){Object.assign(this,e)}get length(){return 2+Buffer.from(this.text).length}serialize(){const e=Buffer.from(this.text);return Buffer.concat([(0,s.bufferWriter)([1,1],[this.type,e.length]),e])}static deSerialize(e){const t=e[0],r=e[1],s=e.slice(2,2+r).toString();return new a({type:t,text:s})}}function c(e){return e%4==0?0:4-e%4}t.SourceDescriptionItem=a},6982:e=>{"use strict";e.exports=require("crypto")},7005:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StreamStatistics=void 0;const s=r(5433);t.StreamStatistics=class{constructor(e){this.cycles=0,this.packets_received=0,this.jitter_q4=0,this.expected_prior=0,this.received_prior=0,this.clockRate=e}add(e,t=Date.now()/1e3){const r=null==this.max_seq||(0,s.uint16Gt)(e.header.sequenceNumber,this.max_seq);if(this.packets_received++,null==this.base_seq&&(this.base_seq=e.header.sequenceNumber),r){const r=(0,s.int)(t*this.clockRate);if(null!=this.max_seq&&e.header.sequenceNumber<this.max_seq&&(this.cycles+=65536),this.max_seq=e.header.sequenceNumber,e.header.timestamp!==this.last_timestamp&&this.packets_received>1){const t=Math.abs(r-(this.last_arrival??0)-(e.header.timestamp-(this.last_timestamp??0)));this.jitter_q4+=t-(this.jitter_q4+8>>4)}this.last_arrival=r,this.last_timestamp=e.header.timestamp}}get fraction_lost(){const e=this.packets_expected-this.expected_prior;this.expected_prior=this.packets_expected;const t=this.packets_received-this.received_prior;this.received_prior=this.packets_received;const r=e-t;return 0==e||r<=0?0:Math.floor((r<<8)/e)}get jitter(){return this.jitter_q4>>4}get packets_expected(){return this.cycles+(this.max_seq??0)-(this.base_seq??0)+1}get packets_lost(){const e=this.packets_expected-this.packets_received;return e<0?0:e}}},7016:e=>{"use strict";e.exports=require("url")},7019:function(e){!function(){"use strict";function t(e){return parseInt(e)===e}function r(e){if(!t(e.length))return!1;for(var r=0;r<e.length;r++)if(!t(e[r])||e[r]<0||e[r]>255)return!1;return!0}function s(e,s){if(e.buffer&&"Uint8Array"===e.name)return s&&(e=e.slice?e.slice():Array.prototype.slice.call(e)),e;if(Array.isArray(e)){if(!r(e))throw new Error("Array contains invalid value: "+e);return new Uint8Array(e)}if(t(e.length)&&r(e))return new Uint8Array(e);throw new Error("unsupported array-like object")}function n(e){return new Uint8Array(e)}function i(e,t,r,s,n){null==s&&null==n||(e=e.slice?e.slice(s,n):Array.prototype.slice.call(e,s,n)),t.set(e,r)}var o,a={toBytes:function(e){var t=[],r=0;for(e=encodeURI(e);r<e.length;){var n=e.charCodeAt(r++);37===n?(t.push(parseInt(e.substr(r,2),16)),r+=2):t.push(n)}return s(t)},fromBytes:function(e){for(var t=[],r=0;r<e.length;){var s=e[r];s<128?(t.push(String.fromCharCode(s)),r++):s>191&&s<224?(t.push(String.fromCharCode((31&s)<<6|63&e[r+1])),r+=2):(t.push(String.fromCharCode((15&s)<<12|(63&e[r+1])<<6|63&e[r+2])),r+=3)}return t.join("")}},c=(o="0123456789abcdef",{toBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},fromBytes:function(e){for(var t=[],r=0;r<e.length;r++){var s=e[r];t.push(o[(240&s)>>4]+o[15&s])}return t.join("")}}),u={16:10,24:12,32:14},l=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],d=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],h=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],p=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],f=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],g=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],m=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],y=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],b=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],v=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],S=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],w=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],E=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],C=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],T=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];function I(e){for(var t=[],r=0;r<e.length;r+=4)t.push(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3]);return t}var _=function(e){if(!(this instanceof _))throw Error("AES must be instanitated with `new`");Object.defineProperty(this,"key",{value:s(e,!0)}),this._prepare()};_.prototype._prepare=function(){var e=u[this.key.length];if(null==e)throw new Error("invalid key size (must be 16, 24 or 32 bytes)");this._Ke=[],this._Kd=[];for(var t=0;t<=e;t++)this._Ke.push([0,0,0,0]),this._Kd.push([0,0,0,0]);var r,s=4*(e+1),n=this.key.length/4,i=I(this.key);for(t=0;t<n;t++)r=t>>2,this._Ke[r][t%4]=i[t],this._Kd[e-r][t%4]=i[t];for(var o,a=0,c=n;c<s;){if(o=i[n-1],i[0]^=d[o>>16&255]<<24^d[o>>8&255]<<16^d[255&o]<<8^d[o>>24&255]^l[a]<<24,a+=1,8!=n)for(t=1;t<n;t++)i[t]^=i[t-1];else{for(t=1;t<n/2;t++)i[t]^=i[t-1];o=i[n/2-1],i[n/2]^=d[255&o]^d[o>>8&255]<<8^d[o>>16&255]<<16^d[o>>24&255]<<24;for(t=n/2+1;t<n;t++)i[t]^=i[t-1]}for(t=0;t<n&&c<s;)h=c>>2,p=c%4,this._Ke[h][p]=i[t],this._Kd[e-h][p]=i[t++],c++}for(var h=1;h<e;h++)for(var p=0;p<4;p++)o=this._Kd[h][p],this._Kd[h][p]=w[o>>24&255]^E[o>>16&255]^C[o>>8&255]^T[255&o]},_.prototype.encrypt=function(e){if(16!=e.length)throw new Error("invalid plaintext size (must be 16 bytes)");for(var t=this._Ke.length-1,r=[0,0,0,0],s=I(e),i=0;i<4;i++)s[i]^=this._Ke[0][i];for(var o=1;o<t;o++){for(i=0;i<4;i++)r[i]=p[s[i]>>24&255]^f[s[(i+1)%4]>>16&255]^g[s[(i+2)%4]>>8&255]^m[255&s[(i+3)%4]]^this._Ke[o][i];s=r.slice()}var a,c=n(16);for(i=0;i<4;i++)a=this._Ke[t][i],c[4*i]=255&(d[s[i]>>24&255]^a>>24),c[4*i+1]=255&(d[s[(i+1)%4]>>16&255]^a>>16),c[4*i+2]=255&(d[s[(i+2)%4]>>8&255]^a>>8),c[4*i+3]=255&(d[255&s[(i+3)%4]]^a);return c},_.prototype.decrypt=function(e){if(16!=e.length)throw new Error("invalid ciphertext size (must be 16 bytes)");for(var t=this._Kd.length-1,r=[0,0,0,0],s=I(e),i=0;i<4;i++)s[i]^=this._Kd[0][i];for(var o=1;o<t;o++){for(i=0;i<4;i++)r[i]=y[s[i]>>24&255]^b[s[(i+3)%4]>>16&255]^v[s[(i+2)%4]>>8&255]^S[255&s[(i+1)%4]]^this._Kd[o][i];s=r.slice()}var a,c=n(16);for(i=0;i<4;i++)a=this._Kd[t][i],c[4*i]=255&(h[s[i]>>24&255]^a>>24),c[4*i+1]=255&(h[s[(i+3)%4]>>16&255]^a>>16),c[4*i+2]=255&(h[s[(i+2)%4]>>8&255]^a>>8),c[4*i+3]=255&(h[255&s[(i+1)%4]]^a);return c};var A=function(e){if(!(this instanceof A))throw Error("AES must be instanitated with `new`");this.description="Electronic Code Block",this.name="ecb",this._aes=new _(e)};A.prototype.encrypt=function(e){if((e=s(e)).length%16!=0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var t=n(e.length),r=n(16),o=0;o<e.length;o+=16)i(e,r,0,o,o+16),i(r=this._aes.encrypt(r),t,o);return t},A.prototype.decrypt=function(e){if((e=s(e)).length%16!=0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var t=n(e.length),r=n(16),o=0;o<e.length;o+=16)i(e,r,0,o,o+16),i(r=this._aes.decrypt(r),t,o);return t};var R=function(e,t){if(!(this instanceof R))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Block Chaining",this.name="cbc",t){if(16!=t.length)throw new Error("invalid initialation vector size (must be 16 bytes)")}else t=n(16);this._lastCipherblock=s(t,!0),this._aes=new _(e)};R.prototype.encrypt=function(e){if((e=s(e)).length%16!=0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var t=n(e.length),r=n(16),o=0;o<e.length;o+=16){i(e,r,0,o,o+16);for(var a=0;a<16;a++)r[a]^=this._lastCipherblock[a];this._lastCipherblock=this._aes.encrypt(r),i(this._lastCipherblock,t,o)}return t},R.prototype.decrypt=function(e){if((e=s(e)).length%16!=0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var t=n(e.length),r=n(16),o=0;o<e.length;o+=16){i(e,r,0,o,o+16),r=this._aes.decrypt(r);for(var a=0;a<16;a++)t[o+a]=r[a]^this._lastCipherblock[a];i(e,this._lastCipherblock,0,o,o+16)}return t};var P=function(e,t,r){if(!(this instanceof P))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Feedback",this.name="cfb",t){if(16!=t.length)throw new Error("invalid initialation vector size (must be 16 size)")}else t=n(16);r||(r=1),this.segmentSize=r,this._shiftRegister=s(t,!0),this._aes=new _(e)};P.prototype.encrypt=function(e){if(e.length%this.segmentSize!=0)throw new Error("invalid plaintext size (must be segmentSize bytes)");for(var t,r=s(e,!0),n=0;n<r.length;n+=this.segmentSize){t=this._aes.encrypt(this._shiftRegister);for(var o=0;o<this.segmentSize;o++)r[n+o]^=t[o];i(this._shiftRegister,this._shiftRegister,0,this.segmentSize),i(r,this._shiftRegister,16-this.segmentSize,n,n+this.segmentSize)}return r},P.prototype.decrypt=function(e){if(e.length%this.segmentSize!=0)throw new Error("invalid ciphertext size (must be segmentSize bytes)");for(var t,r=s(e,!0),n=0;n<r.length;n+=this.segmentSize){t=this._aes.encrypt(this._shiftRegister);for(var o=0;o<this.segmentSize;o++)r[n+o]^=t[o];i(this._shiftRegister,this._shiftRegister,0,this.segmentSize),i(e,this._shiftRegister,16-this.segmentSize,n,n+this.segmentSize)}return r};var k=function(e,t){if(!(this instanceof k))throw Error("AES must be instanitated with `new`");if(this.description="Output Feedback",this.name="ofb",t){if(16!=t.length)throw new Error("invalid initialation vector size (must be 16 bytes)")}else t=n(16);this._lastPrecipher=s(t,!0),this._lastPrecipherIndex=16,this._aes=new _(e)};k.prototype.encrypt=function(e){for(var t=s(e,!0),r=0;r<t.length;r++)16===this._lastPrecipherIndex&&(this._lastPrecipher=this._aes.encrypt(this._lastPrecipher),this._lastPrecipherIndex=0),t[r]^=this._lastPrecipher[this._lastPrecipherIndex++];return t},k.prototype.decrypt=k.prototype.encrypt;var B=function(e){if(!(this instanceof B))throw Error("Counter must be instanitated with `new`");0===e||e||(e=1),"number"==typeof e?(this._counter=n(16),this.setValue(e)):this.setBytes(e)};B.prototype.setValue=function(e){if("number"!=typeof e||parseInt(e)!=e)throw new Error("invalid counter value (must be an integer)");if(e>Number.MAX_SAFE_INTEGER)throw new Error("integer value out of safe range");for(var t=15;t>=0;--t)this._counter[t]=e%256,e=parseInt(e/256)},B.prototype.setBytes=function(e){if(16!=(e=s(e,!0)).length)throw new Error("invalid counter bytes size (must be 16 bytes)");this._counter=e},B.prototype.increment=function(){for(var e=15;e>=0;e--){if(255!==this._counter[e]){this._counter[e]++;break}this._counter[e]=0}};var O=function(e,t){if(!(this instanceof O))throw Error("AES must be instanitated with `new`");this.description="Counter",this.name="ctr",t instanceof B||(t=new B(t)),this._counter=t,this._remainingCounter=null,this._remainingCounterIndex=16,this._aes=new _(e)};O.prototype.encrypt=function(e){for(var t=s(e,!0),r=0;r<t.length;r++)16===this._remainingCounterIndex&&(this._remainingCounter=this._aes.encrypt(this._counter._counter),this._remainingCounterIndex=0,this._counter.increment()),t[r]^=this._remainingCounter[this._remainingCounterIndex++];return t},O.prototype.decrypt=O.prototype.encrypt;var x={AES:_,Counter:B,ModeOfOperation:{ecb:A,cbc:R,cfb:P,ofb:k,ctr:O},utils:{hex:c,utf8:a},padding:{pkcs7:{pad:function(e){var t=16-(e=s(e,!0)).length%16,r=n(e.length+t);i(e,r);for(var o=e.length;o<r.length;o++)r[o]=t;return r},strip:function(e){if((e=s(e,!0)).length<16)throw new Error("PKCS#7 invalid length");var t=e[e.length-1];if(t>16)throw new Error("PKCS#7 padding byte out of range");for(var r=e.length-t,o=0;o<t;o++)if(e[r+o]!==t)throw new Error("PKCS#7 invalid padding byte");var a=n(r);return i(e,a,0,0,r),a}}},_arrayTest:{coerceArray:s,createArray:n,copyArray:i}};e.exports=x}()},7077:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FragmentedHandshake=void 0;const s=r(6353),n=r(4011);class i{constructor(e,t,r,s,n,i){this.msg_type=e,this.length=t,this.message_seq=r,this.fragment_offset=s,this.fragment_length=n,this.fragment=i}get summary(){return(0,n.getObjectSummary)(this)}static createEmpty(){return new i(void 0,void 0,void 0,void 0,void 0,void 0)}static deSerialize(e){return new i(...Object.values((0,s.decode)(e,i.spec)))}serialize(){const e=(0,s.encode)(this,i.spec).slice();return Buffer.from(e)}chunk(e){let t=0;const r=this.fragment.length;if(0===r)return[new i(this.msg_type,r,this.message_seq,t,0,this.fragment)];const s=[];for(e||(e=1240);t<r;){const n=Math.min(e,r-t),o=Buffer.from(this.fragment.slice(t,t+n));if(o.length<=0)throw new Error("Zero or less bytes processed while fragmenting handshake message.");s.push(new i(this.msg_type,r,this.message_seq,t,o.length,o)),t+=o.length}return s}static assemble(e){if(!e?.length)throw new Error("cannot reassemble handshake from empty array");e=e.sort(((e,t)=>e.fragment_offset-t.fragment_offset));const t=Buffer.alloc(e[0].length);for(const r of e)r.fragment.copy(t,r.fragment_offset);return new i(e[0].msg_type,e[0].length,e[0].message_seq,0,t.length,t)}static findAllFragments(e,t){const r=e.find((e=>e.msg_type===t));return r&&e?.length?e.filter((e=>e.msg_type===r.msg_type&&e.message_seq===r.message_seq&&e.length===r.length)):[]}}t.FragmentedHandshake=i,i.spec={msg_type:s.types.uint8,length:s.types.uint24be,message_seq:s.types.uint16be,fragment_offset:s.types.uint24be,fragment_length:s.types.uint24be,fragment:s.types.buffer((e=>e.current.fragment_length))}},7164:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtpBuilder=void 0;const s=r(9543),n=r(1193);t.RtpBuilder=class{constructor(e){this.props=e,this.sequenceNumber=(0,s.random16)(),this.timestamp=(0,s.random32)()}create(e){this.sequenceNumber=(0,s.uint16Add)(this.sequenceNumber,1);const t=this.props.between*this.props.clockRate/1e3;this.timestamp=(0,s.uint32Add)(this.timestamp,t);const r=new n.RtpHeader({sequenceNumber:this.sequenceNumber,timestamp:Number(this.timestamp),payloadType:96,extension:!0,marker:!1,padding:!1});return new n.RtpPacket(r,e)}}},7177:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PictureLossIndication=void 0;const s=r(9543);class n{constructor(e={}){this.count=n.count,this.length=2,Object.assign(this,e)}static deSerialize(e){const[t,r]=(0,s.bufferReader)(e,[4,4]);return new n({senderSsrc:t,mediaSsrc:r})}serialize(){return(0,s.bufferWriter)([4,4],[this.senderSsrc,this.mediaSsrc])}}t.PictureLossIndication=n,n.count=1},7187:e=>{"use strict";function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const r=new Int32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);function s(e){if(Buffer.isBuffer(e))return e;if("number"==typeof e)return Buffer.alloc(e);if("string"==typeof e)return Buffer.from(e);throw new Error("input must be buffer, number, or string, received "+typeof e)}function n(e,t){e=s(e),Buffer.isBuffer(t)&&(t=t.readUInt32BE(0));let n=-1^t;for(var i=0;i<e.length;i++)n=r[255&(n^e[i])]^n>>>8;return-1^n}function i(){return function(e){const t=s(4);return t.writeInt32BE(e,0),t}(n.apply(null,arguments))}i.signed=function(){return n.apply(null,arguments)},i.unsigned=function(){return n.apply(null,arguments)>>>0};const o=t(i);e.exports=o},7194:e=>{"use strict";e.exports=require("dgram")},7229:(e,t)=>{"use strict";t.toString=function(e){switch(e){case 1:return"A";case 10:return"NULL";case 28:return"AAAA";case 18:return"AFSDB";case 42:return"APL";case 257:return"CAA";case 60:return"CDNSKEY";case 59:return"CDS";case 37:return"CERT";case 5:return"CNAME";case 49:return"DHCID";case 32769:return"DLV";case 39:return"DNAME";case 48:return"DNSKEY";case 43:return"DS";case 55:return"HIP";case 13:return"HINFO";case 45:return"IPSECKEY";case 25:return"KEY";case 36:return"KX";case 29:return"LOC";case 15:return"MX";case 35:return"NAPTR";case 2:return"NS";case 47:return"NSEC";case 50:return"NSEC3";case 51:return"NSEC3PARAM";case 12:return"PTR";case 46:return"RRSIG";case 17:return"RP";case 24:return"SIG";case 6:return"SOA";case 99:return"SPF";case 33:return"SRV";case 44:return"SSHFP";case 32768:return"TA";case 249:return"TKEY";case 52:return"TLSA";case 250:return"TSIG";case 16:return"TXT";case 252:return"AXFR";case 251:return"IXFR";case 41:return"OPT";case 255:return"ANY"}return"UNKNOWN_"+e},t.toType=function(e){switch(e.toUpperCase()){case"A":return 1;case"NULL":return 10;case"AAAA":return 28;case"AFSDB":return 18;case"APL":return 42;case"CAA":return 257;case"CDNSKEY":return 60;case"CDS":return 59;case"CERT":return 37;case"CNAME":return 5;case"DHCID":return 49;case"DLV":return 32769;case"DNAME":return 39;case"DNSKEY":return 48;case"DS":return 43;case"HIP":return 55;case"HINFO":return 13;case"IPSECKEY":return 45;case"KEY":return 25;case"KX":return 36;case"LOC":return 29;case"MX":return 15;case"NAPTR":return 35;case"NS":return 2;case"NSEC":return 47;case"NSEC3":return 50;case"NSEC3PARAM":return 51;case"PTR":return 12;case"RRSIG":return 46;case"RP":return 17;case"SIG":return 24;case"SOA":return 6;case"SPF":return 99;case"SRV":return 33;case"SSHFP":return 44;case"TA":return 32768;case"TKEY":return 249;case"TLSA":return 52;case"TSIG":return 250;case"TXT":return 16;case"AXFR":return 252;case"IXFR":return 251;case"OPT":return 41;case"ANY":case"*":return 255}return e.toUpperCase().startsWith("UNKNOWN_")?parseInt(e.slice(8)):0}},7260:(e,t,r)=>{"use strict";const{isType:s}=r(2);e.exports=function(e){if(!s(e))throw new TypeError("Argument #1 should be valid type.");return{encode:function t(r,s){e.encode.call(this,r?1:0,s),t.bytes=e.encode.bytes},decode:function t(r){const s=e.decode.call(this,r);return t.bytes=e.decode.bytes,Boolean(s)},encodingLength:e.encodingLength}}},7284:(e,t,r)=>{"use strict";r.d(t,{BASIC:()=>c});var s=r(7371),n=r(2238);const i=["realm"],o=i,a={type:"Basic",parseWWWAuthenticateRest:function(e){return(0,n.parseHTTPHeadersQuotedKeyValueSet)(e,o,i)},buildWWWAuthenticateRest:function(e){return(0,n.$)(e,o,i)},parseAuthorizationRest:function(e){if(!e)throw new s.w("E_EMPTY_AUTH");const{username:t,password:r}=a.decodeHash(e);return{hash:e,username:t,password:r}},buildAuthorizationRest:function({hash:e,username:t,password:r}){if(t&&r)return a.computeHash({username:t,password:r});if(!e)throw new s.w("E_NO_HASH");return e},computeHash:function({username:e,password:t}){return Buffer.from(e+":"+t).toString("base64")},decodeHash:function(e){const[t,...r]=Buffer.from(e,"base64").toString().split(":");return{username:t,password:r.join(":")}}},c=a;r(6982);const u=["realm","nonce"],l=["username","realm","nonce","uri","response"]},7371:(e,t,r)=>{"use strict";r.d(t,{w:()=>n});var s=r(857);class n extends Error{code;params;wrappedErrors;constructor(e,t,...r){e instanceof Array||(r=("undefined"==typeof t?[]:[t]).concat(r),t=e,e=[]),super(t),this.code=t||"E_UNEXPECTED",this.params=r,this.wrappedErrors=e,this.name=this.toString(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}static wrap(e,t,...r){const s=o(e.message),i=("wrappedErrors"in e?e.wrappedErrors:[]).concat(e);return t||(t=s?e.message:"E_UNEXPECTED"),e.message&&!s&&r.push(e.message),new n(i,t,...r)}static cast(e,t,...r){return i(e)?e:n.wrap(e,t,...r)}static bump(e,t,...r){return i(e)?n.wrap(e,e.code,...e.params):n.wrap(e,t,...r)}toString(){return(this.wrappedErrors.length?this.wrappedErrors[this.wrappedErrors.length-1].stack+s.EOL:"")+this.constructor.name+": "+this.code+" ("+this.params.join(", ")+")"}}function i(e){return!!(e instanceof n)||!!(e.constructor&&e.constructor.name&&e.constructor.name.endsWith("Error")&&"code"in e&&"string"==typeof e.code&&o(e.code)&&"params"in e&&e.params&&e.params instanceof Array)}function o(e){return/^([A-Z0-9_]+)$/.test(e)}},7449:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.interfaceAddress=void 0,t.randomPort=n,t.randomPorts=async function(e,t="udp4",r){return Promise.all([...Array(e)].map((()=>n(t,r))))},t.findPort=async function(e,r,n="udp4",i){let o;for(let a=e;a<=r;a++){const c=(0,s.createSocket)(n);setImmediate((()=>c.bind({port:a,address:(0,t.interfaceAddress)(n,i)})));if(await new Promise((e=>{c.once("error",(t=>e(t))),c.once("listening",(()=>e()))})))await new Promise((e=>c.close((()=>e()))));else if(o=c.address()?.port,await new Promise((e=>c.close((()=>e())))),e<=o&&o<=r)break}if(!o)throw new Error("port not found");return o},t.normalizeFamilyNodeV18=function(e){return"IPv4"===e?4:"IPv6"===e?6:e};const s=r(7194);async function n(e="udp4",r){const n=(0,s.createSocket)(e);setImmediate((()=>n.bind({port:0,address:(0,t.interfaceAddress)(e,r)}))),await new Promise((e=>{n.once("error",e),n.once("listening",e)}));const i=n.address()?.port;return await new Promise((e=>n.close((()=>e())))),i}t.interfaceAddress=(e,t)=>t?t[e]:void 0},7517:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerHelloDone=void 0;const s=r(6353),n=r(7077),i=r(9602);class o{constructor(){this.msgType=i.HandshakeType.server_hello_done_14}static createEmpty(){return new o}static deSerialize(e){return new o(...Object.values((0,s.decode)(e,o.spec)))}serialize(){const e=(0,s.encode)(this,o.spec).slice();return Buffer.from(e)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.ServerHelloDone=o,o.spec={}},7522:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransceiverManager=void 0;const s=r(6448),n=r(5433),i=r(6276),o=r(7999),a=r(4262),c=r(8806),u=(0,n.debug)("werift:packages/webrtc/src/media/rtpTransceiverManager.ts");t.TransceiverManager=class{constructor(e,t,r){this.cname=e,this.config=t,this.router=r,this.transceivers=[],this.onTransceiverAdded=new n.Event,this.onRemoteTransceiverAdded=new n.Event,this.onTrack=new n.Event,this.onNegotiationNeeded=new n.Event}getTransceivers(){return this.transceivers}getSenders(){return this.getTransceivers().map((e=>e.sender))}getReceivers(){return this.getTransceivers().map((e=>e.receiver))}getTransceiverByMLineIndex(e){return this.transceivers.find((t=>t.mLineIndex===e))}pushTransceiver(e){this.transceivers.push(e)}replaceTransceiver(e,t){this.transceivers[t]=e}addTransceiver(e,t,r={}){const s="string"==typeof e?e:e.kind,n=r.direction||"sendrecv",o=new i.RTCRtpSender(e),a=new i.RTCRtpReceiver(this.config,s,o.ssrc),c=new i.RTCRtpTransceiver(s,t,a,o,n);c.options=r,this.router.registerRtpSender(c.sender);const u=this.transceivers.findIndex((e=>"inactive"===e.currentDirection)),l=this.transceivers.find((e=>"inactive"===e.currentDirection));return u>-1&&l?(this.replaceTransceiver(c,u),c.mLineIndex=l.mLineIndex,l.setCurrentDirection(void 0)):this.pushTransceiver(c),this.onTransceiverAdded.execute(c),c}addTrack(e,t){if(this.getSenders().find((t=>t.track?.uuid===e.uuid)))throw new Error("Track already added");const r=this.transceivers.find((t=>null==t.sender.track&&t.kind===e.kind&&!0===s.SenderDirections.includes(t.direction)));if(r){return r.sender.registerTrack(e),r}const n=this.transceivers.find((t=>null==t.sender.track&&t.kind===e.kind&&!1===s.SenderDirections.includes(t.direction)&&!t.usedForSender));if(n){switch(n.sender.registerTrack(e),n.direction){case"recvonly":n.setDirection("sendrecv");break;case"inactive":n.setDirection("sendonly")}return n}return this.addTransceiver(e,void 0,{direction:"sendrecv"})}removeTrack(e){if(!this.getSenders().find((({ssrc:t})=>e.ssrc===t)))throw new Error("Sender does not exist");const t=this.transceivers.find((({sender:{ssrc:t}})=>e.ssrc===t));if(!t)throw new Error("No matching transceiver found");e.stop(),"recvonly"!==t.currentDirection?t.stopping||t.stopped?t.setDirection("inactive"):"sendrecv"===t.direction?t.setDirection("recvonly"):"sendonly"!==t.direction&&"recvonly"!==t.direction||t.setDirection("inactive"):this.onNegotiationNeeded.execute()}assignTransceiverCodecs(e){const t=this.config.codecs[e.kind].filter((t=>{switch(t.direction){case"recvonly":return!!s.ReceiverDirection.includes(e.direction);case"sendonly":return!!s.SenderDirections.includes(e.direction);case"sendrecv":return!![i.Sendrecv,i.Recvonly,i.Sendonly].includes(e.direction);case"all":return!0;default:return!1}}));e.codecs=t}getLocalRtpParams(e){if(null==e.mid)throw new Error("mid not assigned");return{codecs:e.codecs,muxId:e.mid,headerExtensions:e.headerExtensions,rtcp:{cname:this.cname,ssrc:e.sender.ssrc,mux:!0}}}getRemoteRtpParams(e,t){return{muxId:e.rtp.muxId,rtcp:e.rtp.rtcp,codecs:t.codecs,headerExtensions:t.headerExtensions,encodings:Object.values(t.codecs.reduce(((t,r)=>{if("rtx"===r.name.toLowerCase()){const s=t[(0,a.codecParametersFromString)(r.parameters??"").apt];return s&&2===e.ssrc.length&&(s.rtx=new i.RTCRtpRtxParameters({ssrc:e.ssrc[1].ssrc})),t}return t[r.payloadType]=new i.RTCRtpCodingParameters({ssrc:e.ssrc[0]?.ssrc,payloadType:r.payloadType}),t}),{}))}}setRemoteRTP(e,t,r,s){if(e.mid||(e.mid=t.rtp.muxId),e.mLineIndex=s,e.codecs=t.rtp.codecs.filter((e=>{const r=this.config.codecs[t.kind]||[],s=(0,o.findCodecByMimeType)(r,e);if(!s)return!1;if("rtx"===s?.name.toLowerCase()){const e=(0,a.codecParametersFromString)(s.parameters??"").apt,n=t.rtp.codecs.find((t=>t.payloadType===e));return!!n&&!!(0,o.findCodecByMimeType)(r,n)}return!0})),u("negotiated codecs",e.codecs),0===e.codecs.length)throw new Error("negotiate codecs failed.");e.headerExtensions=t.rtp.headerExtensions.filter((e=>(this.config.headerExtensions[t.kind]||[]).find((t=>t.uri===e.uri))));const n=t.direction??"inactive",l=(0,c.reverseDirection)(n);["answer","pranswer"].includes(r)?e.setCurrentDirection(l):e.offerDirection=l;const d=this.getLocalRtpParams(e);if(e.sender.prepareSend(d),["recvonly","sendrecv"].includes(e.direction)){const r=this.getRemoteRtpParams(t,e);for(const s of t.simulcastParameters)this.router.registerRtpReceiverByRid(e,s,r);e.receiver.prepareReceive(r),this.router.registerRtpReceiverBySsrc(e,r)}if(["sendonly","sendrecv"].includes(n)){if(t.msid){const[r,s]=t.msid.split(" ");e.receiver.remoteStreamId=r,e.receiver.remoteTrackId=s}this.onTrack.execute({track:e.receiver.track,transceiver:e,stream:new i.MediaStream({id:e.receiver.remoteStreamId,tracks:[e.receiver.track]})})}t.ssrc[0]?.ssrc&&e.receiver.setupTWCC(t.ssrc[0].ssrc)}async getStats(e){const t=[];for(const r of this.transceivers){const s=!e||r.sender.track===e||r.receiver.track===e;if(r.sender){const e=await r.sender.getStats();if(e)for(const r of e)"outbound-rtp"===r.type||"media-source"===r.type?s&&t.push(r):t.push(r)}if(r.receiver){const e=await r.receiver.getStats();if(e)for(const r of e)"inbound-rtp"===r.type||"remote-outbound-rtp"===r.type?s&&t.push(r):t.push(r)}if(s){const e=r.getCodecStats();e&&t.push(...e)}}return t}close(){for(const e of this.transceivers)e.receiver.stop(),e.sender.stop();this.onTransceiverAdded.allUnsubscribe(),this.onRemoteTransceiverAdded.allUnsubscribe(),this.onTrack.allUnsubscribe(),this.onNegotiationNeeded.allUnsubscribe()}}},7552:(e,t,r)=>{"use strict";const s=r(6736),n=r(8176);class i{constructor(e){this.stream=e,this.index=0}append(e){this.stream.append(e)}commit(){this.stream.consume(this.index)}get(e=0){return this.stream.get(this.index+e)}get length(){return this.stream.length}slice(e,t){return this.stream.slice(e,t)}toString(e,t,r){return this.stream.toString(e,t,r)}readBuffer(e){a(this.index+e,this.length);const t=this.stream.slice(this.index,this.index+e);return this.index+=e,t}indexOf(e,t=0){return this.stream.indexOf(e,this.index+t)-this.index}}const o={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};function a(e,t){if(e>t)throw new n(e,t)}Object.keys(o).forEach((e=>{const t=s(),r=o[e];t(`\n    function transaction_${e}() {\n      assertSize(this.index + ${t.formats.d(r)}, this.length);\n      const value = this.stream.buffer.${e}(this.index);\n      this.index += ${t.formats.d(r)};\n      return value;\n    }\n  `),i.prototype[e]=t.toFunction({assertSize:a})})),["readIntBE","readIntLE","readUIntBE","readUIntLE"].forEach((e=>{const t=s();t(`\n    function transaction_${e}(bytes) {\n      assertSize(this.index + bytes, this.length);\n      const value = this.stream.buffer.${e}(bytes, this.index);\n      this.index += bytes;\n      return value;\n    }\n  `),i.prototype[e]=t.toFunction({assertSize:a})})),e.exports=i},7564:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DtlsClient=void 0;const s=r(9379),n=r(269),i=r(2667),o=r(1937),a=r(9602),c=r(7983),u=r(5205),l=r(654),d=(0,u.debug)("werift-dtls : packages/dtls/src/client.ts : log");class h extends l.DtlsSocket{constructor(e){super(e,s.SessionType.CLIENT),this.handleHandshakes=async e=>{d(this.dtls.sessionId,"handleHandshakes",e.map((e=>e.msg_type)));for(const t of e)switch(t.msg_type){case a.HandshakeType.hello_verify_request_3:{const e=c.ServerHelloVerifyRequest.deSerialize(t.fragment);await new i.Flight3(this.transport,this.dtls).exec(e)}break;case a.HandshakeType.server_hello_2:if(this.connected)return;this.flight5=new o.Flight5(this.transport,this.dtls,this.cipher,this.srtp),this.flight5.handleHandshake(t);break;case a.HandshakeType.certificate_11:case a.HandshakeType.server_key_exchange_12:case a.HandshakeType.certificate_request_13:await this.waitForReady((()=>!!this.flight5)),this.flight5?.handleHandshake(t);break;case a.HandshakeType.server_hello_done_14:{await this.waitForReady((()=>!!this.flight5)),this.flight5?.handleHandshake(t);const e=[11,12,this.options.certificateRequest&&13].filter((e=>"number"==typeof e));await this.waitForReady((()=>this.dtls.checkHandshakesExist(e))),await(this.flight5?.exec())}break;case a.HandshakeType.finished_20:this.dtls.flight=7,this.connected=!0,this.onConnect.execute(),d(this.dtls.sessionId,"dtls connected")}},this.onHandleHandshakes=this.handleHandshakes,d(this.dtls.sessionId,"start client")}async connect(){await new n.Flight1(this.transport,this.dtls,this.cipher).exec(this.extensions)}}t.DtlsClient=h},7568:function(e,t,r){"use strict";var s,n=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=s(e),o=0;o<r.length;o++)"default"!==r[o]&&n(t,e,r[o]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.CipherContext=void 0;const a=r(6982),c=r(5382),u=o(r(7856)),l=r(6353),d=r(4148),h=r(91),p=r(9379),f=a.webcrypto;u.cryptoProvider.set(f);class g{constructor(e,t,r,s){this.sessionType=e,this.certPem=t,this.keyPem=r,t&&r&&s&&this.parseX509(t,r,s)}encryptPacket(e){const t=e.recordLayerHeader,r=t.protocolVersion.major<<8|t.protocolVersion.minor,s=this.cipher.encrypt(this.sessionType,e.fragment,{type:t.contentType,version:r,epoch:t.epoch,sequenceNumber:t.sequenceNumber});return e.fragment=s,e.recordLayerHeader.contentLen=s.length,e}decryptPacket(e){const t=e.recordLayerHeader,r=t.protocolVersion.major<<8|t.protocolVersion.minor;return this.cipher.decrypt(this.sessionType,e.fragment,{type:t.contentType,version:r,epoch:t.epoch,sequenceNumber:t.sequenceNumber})}verifyData(e){return this.sessionType===p.SessionType.CLIENT?(0,h.prfVerifyDataClient)(this.masterSecret,e):(0,h.prfVerifyDataServer)(this.masterSecret,e)}signatureData(e,t){const r=(0,a.createSign)(t).update(e),s=this.localPrivateKey.toPEM().toString();return r.sign(s)}generateKeySignature(e){const t=this.sessionType===p.SessionType.CLIENT?this.localRandom:this.remoteRandom,r=this.sessionType===p.SessionType.SERVER?this.localRandom:this.remoteRandom,s=this.valueKeySignature(t.serialize(),r.serialize(),this.localKeyPair.publicKey,this.namedCurve);return this.localPrivateKey.sign(s,e)}parseX509(e,t,r){const s=c.Certificate.fromPEM(Buffer.from(e)),n=c.PrivateKey.fromPEM(Buffer.from(t));this.localCert=s.raw,this.localPrivateKey=n,this.signatureHashAlgorithm=r}valueKeySignature(e,t,r,s){const n=Buffer.from((0,l.encode)({type:d.CurveType.named_curve_3,curve:s,len:r.length},{type:l.types.uint8,curve:l.types.uint16be,len:l.types.uint8}).slice());return Buffer.concat([e,t,n,r])}}t.CipherContext=g,g.createSelfSignedCertificateWithKey=async(e,t)=>{const r=(()=>{switch(e.signature){case d.SignatureAlgorithm.rsa_1:return"RSASSA-PKCS1-v1_5";case d.SignatureAlgorithm.ecdsa_3:return"ECDSA"}})(),s=(()=>{if(e.hash===d.HashAlgorithm.sha256_4)return"SHA-256"})(),n=(()=>{switch(t){case d.NamedCurveAlgorithm.secp256r1_23:return"P-256";case d.NamedCurveAlgorithm.x25519_29:return"ECDSA"===r?"P-256":"X25519";default:if("ECDSA"===r)return"P-256";if("RSASSA-PKCS1-v1_5"===r)return"X25519"}})(),i=(()=>{switch(r){case"ECDSA":return{name:r,hash:s,namedCurve:n};case"RSASSA-PKCS1-v1_5":return{name:r,hash:s,publicExponent:new Uint8Array([1,0,1]),modulusLength:2048}}})(),o=await f.subtle.generateKey(i,!0,["sign","verify"]);return{certPem:(await u.X509CertificateGenerator.createSelfSigned({serialNumber:(0,a.randomBytes)(8).toString("hex"),name:"C=AU, ST=Some-State, O=Internet Widgits Pty Ltd",notBefore:new Date,notAfter:new Date(Date.now()+31536e7),signingAlgorithm:i,keys:o})).toString("pem"),keyPem:u.PemConverter.encode(await f.subtle.exportKey("pkcs8",o.privateKey),"private key"),signatureHash:e}}},7598:e=>{"use strict";e.exports=require("node:crypto")},7654:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransportContext=void 0;t.TransportContext=class{constructor(e){this.socket=e,this.send=e=>this.socket.send(e)}}},7724:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=void 0;var s=r(4610);Object.defineProperty(t,"sleep",{enumerable:!0,get:function(){return s.sleep}})},7734:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useTWCC=t.useREMB=t.usePLI=t.useNACK=t.useFIR=void 0;t.useFIR=()=>({type:"ccm",parameter:"fir"});t.useNACK=()=>({type:"nack"});t.usePLI=()=>({type:"nack",parameter:"pli"});t.useREMB=()=>({type:"goog-remb"});t.useTWCC=()=>({type:"transport-cc"})},7821:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtcpPacketConverter=void 0,t.isRtcp=function(e){return e.length>=2&&e[1]>=192&&e[1]<=208};const s=r(962),n=r(4221),i=r(3826),o=r(5808),a=r(3119),c=r(6879),u=r(2933),l=(0,s.debug)("werift-rtp:packages/rtp/src/rtcp/rtcp.ts");t.RtcpPacketConverter=class{static deSerialize(e){let t=0;const r=[];for(;t<e.length;){const s=n.RtcpHeader.deSerialize(e.subarray(t,t+n.RTCP_HEADER_SIZE));t+=n.RTCP_HEADER_SIZE;let d=e.subarray(t);t+=4*s.length,s.padding&&(d=d.subarray(0,d.length-d.subarray(-1)[0]));try{switch(s.type){case u.RtcpSrPacket.type:r.push(u.RtcpSrPacket.deSerialize(d,s.count));break;case o.RtcpRrPacket.type:r.push(o.RtcpRrPacket.deSerialize(d,s.count));break;case c.RtcpSourceDescriptionPacket.type:r.push(c.RtcpSourceDescriptionPacket.deSerialize(d,s));break;case a.RtcpTransportLayerFeedback.type:r.push(a.RtcpTransportLayerFeedback.deSerialize(d,s));break;case i.RtcpPayloadSpecificFeedback.type:r.push(i.RtcpPayloadSpecificFeedback.deSerialize(d,s))}}catch(e){l("deSerialize RTCP",e)}}return r}}},7823:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(5433),t),n(r(1597),t),n(r(2237),t),n(r(6252),t),n(r(9420),t),n(r(6276),t),n(r(7999),t),n(r(4262),t),n(r(5692),t),n(r(3894),t),n(r(6779),t),n(r(5857),t),n(r(8806),t),n(r(8383),t)},7830:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StunProtocol=void 0;const s=r(2261),n=r(4687),i=r(9851),o=r(2372),a=(0,s.debug)("werift-ice : packages/ice/src/stun/protocol.ts");class c{get transactionsKeys(){return Object.keys(this.transactions)}constructor(){this.type=c.type,this.transactions={},this.onRequestReceived=new s.Event,this.onDataReceived=new s.Event,this.connectionMade=async(e,t,r)=>{this.transport=e?await s.UdpTransport.init("udp4",{portRange:t,interfaceAddresses:r}):await s.UdpTransport.init("udp6",{portRange:t,interfaceAddresses:r}),this.transport.onData=(e,t)=>{this.datagramReceived(e,t)}}}datagramReceived(e,t){try{const r=(0,i.parseMessage)(e);if(!r)return void(this.localCandidate&&this.onDataReceived.execute(e));if(r.messageClass!==n.classes.RESPONSE&&r.messageClass!==n.classes.ERROR||!this.transactionsKeys.includes(r.transactionIdHex))r.messageClass===n.classes.REQUEST&&this.onRequestReceived.execute(r,t,e);else{this.transactions[r.transactionIdHex].responseReceived(r,t)}}catch(e){a("datagramReceived error",e)}}getExtraInfo(){const{address:e,port:t}=this.transport.address;return[e,t]}async sendStun(e,t){if(this.transport.closed)return;const r=e.bytes;await this.transport.send(r,t).catch((()=>{a("sendStun failed",t,e)}))}async sendData(e,t){this.transport.closed||await this.transport.send(e,t)}async request(e,t,r,s){if(this.transactionsKeys.includes(e.transactionIdHex))throw new Error("already request ed");r&&(e.addMessageIntegrity(r),e.addFingerprint());const n=new o.Transaction(e,t,this,s);this.transactions[e.transactionIdHex]=n;try{return await n.run()}catch(e){throw e}finally{delete this.transactions[e.transactionIdHex]}}async close(){Object.values(this.transactions).forEach((e=>{e.cancel()})),await this.transport.close(),this.onRequestReceived.complete(),this.onDataReceived.complete()}}t.StunProtocol=c,c.type="stun"},7856:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AlgorithmProvider:()=>Bc,AsnData:()=>yu,AsnDefaultSignatureFormatter:()=>gl,AsnEcSignatureFormatter:()=>vl,Attribute:()=>ll,AttributeFactory:()=>pl,AuthorityInfoAccessExtension:()=>al,AuthorityKeyIdentifierExtension:()=>Xu,BasicConstraintsExtension:()=>Ju,CRLDistributionPointsExtension:()=>ol,CertificatePolicyExtension:()=>il,ChallengePasswordAttribute:()=>dl,CryptoProvider:()=>Su,DefaultAlgorithmSerializer:()=>fu,EcAlgorithm:()=>lu,EdAlgorithm:()=>Tl,ExtendedKeyUsage:()=>Qu,ExtendedKeyUsageExtension:()=>el,Extension:()=>bu,ExtensionFactory:()=>nl,ExtensionsAttribute:()=>hl,GeneralName:()=>Fu,GeneralNames:()=>zu,KeyUsageFlags:()=>Zu,KeyUsagesExtension:()=>tl,Name:()=>_u,NameIdentifier:()=>Cu,OidSerializer:()=>gu,PemConverter:()=>Wu,Pkcs10CertificateRequest:()=>Il,Pkcs10CertificateRequestGenerator:()=>_l,PublicKey:()=>Yu,RsaAlgorithm:()=>yl,ShaAlgorithm:()=>bl,SubjectAlternativeNameExtension:()=>sl,SubjectKeyIdentifierExtension:()=>rl,TextConverter:()=>mu,TextObject:()=>pu,X509Certificate:()=>Al,X509CertificateGenerator:()=>kl,X509Certificates:()=>Rl,X509ChainBuilder:()=>Pl,X509Crl:()=>xl,X509CrlEntry:()=>Ol,X509CrlGenerator:()=>Nl,X509CrlReason:()=>Bl,cryptoProvider:()=>wu,diAlgorithm:()=>kc,diAlgorithmProvider:()=>Oc,diAsnSignatureFormatter:()=>fl,idEd25519:()=>El,idEd448:()=>Cl,idX25519:()=>Sl,idX448:()=>wl});var s={};r.r(s),r.d(s,{Any:()=>kt,BaseBlock:()=>$,BaseStringBlock:()=>G,BitString:()=>qe,BmpString:()=>dt,Boolean:()=>He,CharacterString:()=>Et,Choice:()=>Bt,Constructed:()=>De,DATE:()=>It,DateTime:()=>At,Duration:()=>Rt,EndOfContent:()=>Me,Enumerated:()=>Xe,GeneralString:()=>wt,GeneralizedTime:()=>Tt,GraphicString:()=>vt,HexBlock:()=>H,IA5String:()=>bt,Integer:()=>Ye,Null:()=>Ue,NumericString:()=>ft,ObjectIdentifier:()=>Ze,OctetString:()=>ze,Primitive:()=>Be,PrintableString:()=>gt,RawData:()=>xt,RelativeObjectIdentifier:()=>rt,Repeated:()=>Ot,Sequence:()=>st,Set:()=>nt,TIME:()=>Pt,TeletexString:()=>mt,TimeOfDay:()=>_t,UTCTime:()=>Ct,UniversalString:()=>pt,Utf8String:()=>ut,ValueBlock:()=>z,VideotexString:()=>yt,ViewWriter:()=>w,VisibleString:()=>St,compareSchema:()=>Nt,fromBER:()=>xe,verifySchema:()=>Dt});r(3537);class n{static isArrayBuffer(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const r=n.toUint8Array(e),s=n.toUint8Array(t);if(r.length!==s.byteLength)return!1;for(let e=0;e<r.length;e++)if(r[e]!==s[e])return!1;return!0}static concat(...e){let t;t=!Array.isArray(e[0])||e[1]instanceof Function?Array.isArray(e[0])&&e[1]instanceof Function?e[0]:e[e.length-1]instanceof Function?e.slice(0,e.length-1):e:e[0];let r=0;for(const e of t)r+=e.byteLength;const s=new Uint8Array(r);let n=0;for(const e of t){const t=this.toUint8Array(e);s.set(t,n),n+=t.length}return e[e.length-1]instanceof Function?this.toView(s,e[e.length-1]):s.buffer}}const i="string",o=/^[0-9a-f\s]+$/i,a=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,c=/^[a-zA-Z0-9-_]+$/;class u{static fromString(e){const t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r.buffer}static toString(e){const t=n.toUint8Array(e);let r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return decodeURIComponent(escape(r))}}class l{static toString(e,t=!1){const r=n.toArrayBuffer(e),s=new DataView(r);let i="";for(let e=0;e<r.byteLength;e+=2){const r=s.getUint16(e,t);i+=String.fromCharCode(r)}return i}static fromString(e,t=!1){const r=new ArrayBuffer(2*e.length),s=new DataView(r);for(let r=0;r<e.length;r++)s.setUint16(2*r,e.charCodeAt(r),t);return r}}class d{static isHex(e){return typeof e===i&&o.test(e)}static isBase64(e){return typeof e===i&&a.test(e)}static isBase64Url(e){return typeof e===i&&c.test(e)}static ToString(e,t="utf8"){const r=n.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return l.toString(r,!0);case"utf16":case"utf16be":return l.toString(r);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return l.fromString(e,!0);case"utf16":case"utf16be":return l.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=n.toUint8Array(e);if("undefined"!=typeof btoa){const e=this.ToString(t,"binary");return btoa(e)}return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!d.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!d.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=d.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return u.fromString(e);case"utf16":case"utf16be":return l.fromString(e);case"utf16le":case"usc2":return l.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=d.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return u.toString(e);case"utf16":case"utf16be":return l.toString(e);case"utf16le":case"usc2":return l.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return r.buffer}static ToBinary(e){const t=n.toUint8Array(e);let r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return r}static ToHex(e){const t=n.toUint8Array(e);let r="";const s=t.length;for(let e=0;e<s;e++){const s=t[e];s<16&&(r+="0"),r+=s.toString(16)}return r}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!d.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const r=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2){const s=t.slice(e,e+2);r[e/2]=parseInt(s,16)}return r.buffer}static ToUtf16String(e,t=!1){return l.toString(e,t)}static FromUtf16String(e,t=!1){return l.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let r=0;r<t;r++)e+="=";return e}static formatString(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}function h(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;const r=new Uint8Array(e),s=new Uint8Array(t);for(let t=0;t<e.byteLength;t++)if(r[t]!==s[t])return!1;return!0}function p(e,t){let r=0;if(1===e.length)return e[0];for(let s=e.length-1;s>=0;s--)r+=e[e.length-1-s]*Math.pow(2,t*s);return r}function f(e,t,r=-1){const s=r;let n=e,i=0,o=Math.pow(2,t);for(let r=1;r<8;r++){if(e<o){let e;if(s<0)e=new ArrayBuffer(r),i=r;else{if(s<r)return new ArrayBuffer(0);e=new ArrayBuffer(s),i=s}const o=new Uint8Array(e);for(let e=r-1;e>=0;e--){const r=Math.pow(2,e*t);o[i-e-1]=Math.floor(n/r),n-=o[i-e-1]*r}return e}o*=Math.pow(2,t)}return new ArrayBuffer(0)}function g(...e){let t=0,r=0;for(const r of e)t+=r.length;const s=new ArrayBuffer(t),n=new Uint8Array(s);for(const t of e)n.set(t,r),r+=t.length;return n}function m(){const e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const t=255===e[0]&&128&e[1],r=0===e[0]&&!(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}const t=new ArrayBuffer(this.valueHex.byteLength),r=new Uint8Array(t);for(let e=0;e<this.valueHex.byteLength;e++)r[e]=0;r[0]=128&e[0];const s=p(r,8),n=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(n);for(let t=0;t<this.valueHex.byteLength;t++)i[t]=e[t];i[0]&=127;return p(i,8)-s}function y(e,t){const r=e.toString(10);if(t<r.length)return"";const s=t-r.length,n=new Array(s);for(let e=0;e<s;e++)n[e]="0";return n.join("").concat(r)}d.DEFAULT_UTF8_ENCODING="utf8";Math.log(2);function b(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function v(e){let t=0,r=0;for(let r=0;r<e.length;r++){t+=e[r].byteLength}const s=new Uint8Array(t);for(let t=0;t<e.length;t++){const n=e[t];s.set(new Uint8Array(n),r),r+=n.byteLength}return s.buffer}function S(e,t,r,s){return t instanceof Uint8Array?t.byteLength?r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):s<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-s<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class w{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return v(this.items)}}const E=[new Uint8Array([1])],C="0123456789",T="name",I="valueHexView",_="isHexOnly",A="idBlock",R="tagClass",P="tagNumber",k="isConstructed",B="fromBER",O="toBER",x="local",N="",D=new ArrayBuffer(0),L=new Uint8Array(0),M="EndOfContent",U="OCTET STRING",j="BIT STRING";function H(e){var t;return(t=class extends e{constructor(...e){var t;super(...e);const r=e[0]||{};this.isHexOnly=null!==(t=r.isHexOnly)&&void 0!==t&&t,this.valueHexView=r.valueHex?n.toUint8Array(r.valueHex):L}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(e){this.valueHexView=new Uint8Array(e)}fromBER(e,t,r){const s=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!S(this,s,t,r))return-1;const n=t+r;return this.valueHexView=s.subarray(t,n),this.valueHexView.length?(this.blockLength=r,n):(this.warnings.push("Zero buffer length"),t)}toBER(e=!1){return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",D)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:d.ToHex(this.valueHexView)}}}).NAME="hexBlock",t}class F{constructor({blockLength:e=0,error:t=N,warnings:r=[],valueBeforeDecode:s=L}={}){this.blockLength=e,this.error=t,this.warnings=r,this.valueBeforeDecodeView=n.toUint8Array(s)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:d.ToHex(this.valueBeforeDecodeView)}}}F.NAME="baseBlock";class z extends F{fromBER(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}z.NAME="valueBlock";class V extends(H(F)){constructor({idBlock:e={}}={}){var t,r,s,i;super(),e?(this.isHexOnly=null!==(t=e.isHexOnly)&&void 0!==t&&t,this.valueHexView=e.valueHex?n.toUint8Array(e.valueHex):L,this.tagClass=null!==(r=e.tagClass)&&void 0!==r?r:-1,this.tagNumber=null!==(s=e.tagNumber)&&void 0!==s?s:-1,this.isConstructed=null!==(i=e.isConstructed)&&void 0!==i&&i):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",D}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const r=new Uint8Array(1);if(!e){let e=this.tagNumber;e&=31,t|=e,r[0]=t}return r.buffer}if(!this.isHexOnly){const r=f(this.tagNumber,7),s=new Uint8Array(r),n=r.byteLength,i=new Uint8Array(n+1);if(i[0]=31|t,!e){for(let e=0;e<n-1;e++)i[e+1]=128|s[e];i[n]=s[n-1]}return i.buffer}const r=new Uint8Array(this.valueHexView.byteLength+1);if(r[0]=31|t,!e){const e=this.valueHexView;for(let t=0;t<e.length-1;t++)r[t+1]=128|e[t];r[this.valueHexView.byteLength]=e[e.length-1]}return r.buffer}fromBER(e,t,r){const s=n.toUint8Array(e);if(!S(this,s,t,r))return-1;const i=s.subarray(t,t+r);if(0===i.length)return this.error="Zero buffer length",-1;switch(192&i[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=!(32&~i[0]),this.isHexOnly=!1;const o=31&i[0];if(31!==o)this.tagNumber=o,this.blockLength=1;else{let e=1,t=this.valueHexView=new Uint8Array(255),r=255;for(;128&i[e];){if(t[e-1]=127&i[e],e++,e>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(e===r){r+=255;const e=new Uint8Array(r);for(let r=0;r<t.length;r++)e[r]=t[r];t=this.valueHexView=new Uint8Array(r)}}this.blockLength=e+1,t[e-1]=127&i[e];const s=new Uint8Array(e);for(let r=0;r<e;r++)s[r]=t[r];t=this.valueHexView=new Uint8Array(e),t.set(s),this.blockLength<=9?this.tagNumber=p(t,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}V.NAME="identificationBlock";class q extends F{constructor({lenBlock:e={}}={}){var t,r,s;super(),this.isIndefiniteForm=null!==(t=e.isIndefiniteForm)&&void 0!==t&&t,this.longFormUsed=null!==(r=e.longFormUsed)&&void 0!==r&&r,this.length=null!==(s=e.length)&&void 0!==s?s:0}fromBER(e,t,r){const s=n.toUint8Array(e);if(!S(this,s,t,r))return-1;const i=s.subarray(t,t+r);if(0===i.length)return this.error="Zero buffer length",-1;if(255===i[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===i[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&i[0]),!1===this.longFormUsed)return this.length=i[0],this.blockLength=1,t+this.blockLength;const o=127&i[0];if(o>8)return this.error="Too big integer",-1;if(o+1>i.length)return this.error="End of input reached before message was fully decoded",-1;const a=t+1,c=s.subarray(a,a+o);return 0===c[o-1]&&this.warnings.push("Needlessly long encoded length"),this.length=p(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),!1===e&&(r=new Uint8Array(t),r[0]=128),t;if(this.longFormUsed){const s=f(this.length,8);if(s.byteLength>127)return this.error="Too big length",D;if(t=new ArrayBuffer(s.byteLength+1),e)return t;const n=new Uint8Array(s);r=new Uint8Array(t),r[0]=128|s.byteLength;for(let e=0;e<s.byteLength;e++)r[e+1]=n[e];return t}return t=new ArrayBuffer(1),!1===e&&(r=new Uint8Array(t),r[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}q.NAME="lengthBlock";const K={};class $ extends F{constructor({name:e=N,optional:t=!1,primitiveSchema:r,...s}={},n){super(s),this.name=e,this.optional=t,r&&(this.primitiveSchema=r),this.idBlock=new V(s),this.lenBlock=new q(s),this.valueBlock=n?new n(s):new z(s)}fromBER(e,t,r){const s=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===s?(this.error=this.valueBlock.error,s):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}toBER(e,t){const r=t||new w;t||W(this);const s=this.idBlock.toBER(e);if(r.write(s),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{const t=this.valueBlock.toBER(e);this.lenBlock.length=t.byteLength;const s=this.lenBlock.toBER(e);r.write(s),r.write(t)}return t?D:r.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return"ascii"===e?this.onAsciiEncoding():d.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${d.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;return function(e,t){if(e.byteLength!==t.byteLength)return!1;const r=new Uint8Array(e),s=new Uint8Array(t);for(let e=0;e<r.length;e++)if(r[e]!==s[e])return!1;return!0}(this.toBER(),e.toBER())}}function W(e){if(e instanceof K.Constructed)for(const t of e.valueBlock.value)W(t)&&(e.lenBlock.isIndefiniteForm=!0);return!!e.lenBlock.isIndefiniteForm}$.NAME="BaseBlock";class G extends ${constructor({value:e=N,...t}={},r){super(t,r),e&&this.fromString(e)}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}fromBER(e,t,r){const s=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===s?(this.error=this.valueBlock.error,s):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}G.NAME="BaseStringBlock";class Y extends(H(z)){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}var X,J,Q,Z,ee,te,re,se,ne,ie,oe,ae,ce,ue,le,de,he,pe,fe,ge,me,ye,be,ve,Se,we,Ee,Ce,Te,Ie,_e,Ae,Re,Pe,ke;Y.NAME="PrimitiveValueBlock";class Be extends ${constructor(e={}){super(e,Y),this.idBlock.isConstructed=!1}}function Oe(e,t=0,r=e.length){const s=t;let n=new $({},z);const i=new F;if(!S(i,e,t,r))return n.error=i.error,{offset:-1,result:n};if(!e.subarray(t,t+r).length)return n.error="Zero buffer length",{offset:-1,result:n};let o=n.idBlock.fromBER(e,t,r);if(n.idBlock.warnings.length&&n.warnings.concat(n.idBlock.warnings),-1===o)return n.error=n.idBlock.error,{offset:-1,result:n};if(t=o,r-=n.idBlock.blockLength,o=n.lenBlock.fromBER(e,t,r),n.lenBlock.warnings.length&&n.warnings.concat(n.lenBlock.warnings),-1===o)return n.error=n.lenBlock.error,{offset:-1,result:n};if(t=o,r-=n.lenBlock.blockLength,!n.idBlock.isConstructed&&n.lenBlock.isIndefiniteForm)return n.error="Indefinite length form used for primitive encoding form",{offset:-1,result:n};let a=$;if(1===n.idBlock.tagClass){if(n.idBlock.tagNumber>=37&&!1===n.idBlock.isHexOnly)return n.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:n};switch(n.idBlock.tagNumber){case 0:if(n.idBlock.isConstructed&&n.lenBlock.length>0)return n.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:n};a=K.EndOfContent;break;case 1:a=K.Boolean;break;case 2:a=K.Integer;break;case 3:a=K.BitString;break;case 4:a=K.OctetString;break;case 5:a=K.Null;break;case 6:a=K.ObjectIdentifier;break;case 10:a=K.Enumerated;break;case 12:a=K.Utf8String;break;case 13:a=K.RelativeObjectIdentifier;break;case 14:a=K.TIME;break;case 15:return n.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:n};case 16:a=K.Sequence;break;case 17:a=K.Set;break;case 18:a=K.NumericString;break;case 19:a=K.PrintableString;break;case 20:a=K.TeletexString;break;case 21:a=K.VideotexString;break;case 22:a=K.IA5String;break;case 23:a=K.UTCTime;break;case 24:a=K.GeneralizedTime;break;case 25:a=K.GraphicString;break;case 26:a=K.VisibleString;break;case 27:a=K.GeneralString;break;case 28:a=K.UniversalString;break;case 29:a=K.CharacterString;break;case 30:a=K.BmpString;break;case 31:a=K.DATE;break;case 32:a=K.TimeOfDay;break;case 33:a=K.DateTime;break;case 34:a=K.Duration;break;default:{const e=n.idBlock.isConstructed?new K.Constructed:new K.Primitive;e.idBlock=n.idBlock,e.lenBlock=n.lenBlock,e.warnings=n.warnings,n=e}}}else a=n.idBlock.isConstructed?K.Constructed:K.Primitive;return n=function(e,t){if(e instanceof t)return e;const r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecodeView=e.valueBeforeDecodeView,r}(n,a),o=n.fromBER(e,t,n.lenBlock.isIndefiniteForm?r:n.lenBlock.length),n.valueBeforeDecodeView=e.subarray(s,s+n.blockLength),{offset:o,result:n}}function xe(e){if(!e.byteLength){const e=new $({},z);return e.error="Input buffer has zero length",{offset:-1,result:e}}return Oe(n.toUint8Array(e).slice(),0,e.byteLength)}X=Be,K.Primitive=X,Be.NAME="PRIMITIVE";class Ne extends z{constructor({value:e=[],isIndefiniteForm:t=!1,...r}={}){super(r),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,r){const s=n.toUint8Array(e);if(!S(this,s,t,r))return-1;if(this.valueBeforeDecodeView=s.subarray(t,t+r),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;let i=t;for(;o=this.isIndefiniteForm,a=r,(o?1:a)>0;){const e=Oe(s,i,r);if(-1===e.offset)return this.error=e.result.error,this.warnings.concat(e.result.warnings),-1;if(i=e.offset,this.blockLength+=e.result.blockLength,r-=e.result.blockLength,this.value.push(e.result),this.isIndefiniteForm&&e.result.constructor.NAME===M)break}var o,a;return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===M?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(e,t){const r=t||new w;for(let t=0;t<this.value.length;t++)this.value[t].toBER(e,r);return t?D:r.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}Ne.NAME="ConstructedValueBlock";class De extends ${constructor(e={}){super(e,Ne),this.idBlock.isConstructed=!0}fromBER(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const s=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===s?(this.error=this.valueBlock.error,s):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}onAsciiEncoding(){const e=[];for(const t of this.valueBlock.value)e.push(t.toString("ascii").split("\n").map((e=>`  ${e}`)).join("\n"));const t=3===this.idBlock.tagClass?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :\n${e.join("\n")}`:`${t} :`}}J=De,K.Constructed=J,De.NAME="CONSTRUCTED";class Le extends z{fromBER(e,t,r){return t}toBER(e){return D}}Le.override="EndOfContentValueBlock";class Me extends ${constructor(e={}){super(e,Le),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}Q=Me,K.EndOfContent=Q,Me.NAME=M;class Ue extends ${constructor(e={}){super(e,z),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}toBER(e,t){const r=new ArrayBuffer(2);if(!e){const e=new Uint8Array(r);e[0]=5,e[1]=0}return t&&t.write(r),r}onAsciiEncoding(){return`${this.constructor.NAME}`}}Z=Ue,K.Null=Z,Ue.NAME="NULL";class je extends(H(z)){constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=n.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}fromBER(e,t,r){const s=n.toUint8Array(e);return S(this,s,t,r)?(this.valueHexView=s.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,m.call(this),this.blockLength=r,t+r):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}je.NAME="BooleanValueBlock";class He extends ${constructor(e={}){super(e,je),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}ee=He,K.Boolean=ee,He.NAME="BOOLEAN";class Fe extends(H(Ne)){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,r){let s=0;if(this.isConstructed){if(this.isHexOnly=!1,s=Ne.prototype.fromBER.call(this,e,t,r),-1===s)return s;for(let e=0;e<this.value.length;e++){const t=this.value[e].constructor.NAME;if(t===M){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(t!==U)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,s=super.fromBER(e,t,r),this.blockLength=r;return s}toBER(e,t){return this.isConstructed?Ne.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}Fe.NAME="OctetStringValueBlock";class ze extends ${constructor({idBlock:e={},lenBlock:t={},...r}={}){var s,n;null!==(s=r.isConstructed)&&void 0!==s||(r.isConstructed=!!(null===(n=r.value)||void 0===n?void 0:n.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},Fe),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===r)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const s=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(s.byteLength){const e=Oe(s,0,s.byteLength);-1!==e.offset&&e.offset===r&&(this.valueBlock.value=[e.result])}}catch(e){}}return super.fromBER(e,t,r)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?De.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${d.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof ze&&e.push(t.valueBlock.valueHexView);return n.concat(e)}}te=ze,K.OctetString=te,ze.NAME=U;class Ve extends(H(Ne)){constructor({unusedBits:e=0,isConstructed:t=!1,...r}={}){super(r),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,r){if(!r)return t;let s=-1;if(this.isConstructed){if(s=Ne.prototype.fromBER.call(this,e,t,r),-1===s)return s;for(const e of this.value){const t=e.constructor.NAME;if(t===M){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(t!==j)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const r=e.valueBlock;if(this.unusedBits>0&&r.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=r.unusedBits}return s}const i=n.toUint8Array(e);if(!S(this,i,t,r))return-1;const o=i.subarray(t,t+r);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const e=o.subarray(1);try{if(e.byteLength){const t=Oe(e,0,e.byteLength);-1!==t.offset&&t.offset===r-1&&(this.value=[t.result])}}catch(e){}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+r}toBER(e,t){if(this.isConstructed)return Ne.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return D;const r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}Ve.NAME="BitStringValueBlock";class qe extends ${constructor({idBlock:e={},lenBlock:t={},...r}={}){var s,n;null!==(s=r.isConstructed)&&void 0!==s||(r.isConstructed=!!(null===(n=r.value)||void 0===n?void 0:n.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},Ve),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return De.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const r of t)e.push(r.toString(2).padStart(8,"0"));const r=e.join("");return`${this.constructor.NAME} : ${r.substring(0,r.length-this.valueBlock.unusedBits)}`}}}function Ke(e,t){const r=new Uint8Array([0]),s=new Uint8Array(e),n=new Uint8Array(t);let i=s.slice(0);const o=i.length-1,a=n.slice(0),c=a.length-1;let u=0;let l=0;for(let e=c<o?o:c;e>=0;e--,l++){if(!0==l<a.length)u=i[o-l]+a[c-l]+r[0];else u=i[o-l]+r[0];if(r[0]=u/10,!0==l>=i.length)i=g(new Uint8Array([u%10]),i);else i[o-l]=u%10}return r[0]>0&&(i=g(r,i)),i}function $e(e){if(e>=E.length)for(let t=E.length;t<=e;t++){const e=new Uint8Array([0]);let r=E[t-1].slice(0);for(let t=r.length-1;t>=0;t--){const s=new Uint8Array([(r[t]<<1)+e[0]]);e[0]=s[0]/10,r[t]=s[0]%10}e[0]>0&&(r=g(e,r)),E.push(r)}return E[e]}function We(e,t){let r=0;const s=new Uint8Array(e),n=new Uint8Array(t),i=s.slice(0),o=i.length-1,a=n.slice(0),c=a.length-1;let u,l=0;for(let e=c;e>=0;e--,l++)if(u=i[o-l]-a[c-l]-r,!0==u<0)r=1,i[o-l]=u+10;else r=0,i[o-l]=u;if(r>0)for(let e=o-c+1;e>=0;e--,l++){if(u=i[o-l]-r,!(u<0)){r=0,i[o-l]=u;break}r=1,i[o-l]=u+10}return i.slice()}re=qe,K.BitString=re,qe.NAME=j;class Ge extends(H(z)){constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),void 0!==e&&(this.valueDec=e)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=m.call(this)))}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function(e){const t=e<0?-1*e:e;let r=128;for(let s=1;s<8;s++){if(t<=r){if(e<0){const e=f(r-t,8,s);return new Uint8Array(e)[0]|=128,e}let n=f(t,8,s),i=new Uint8Array(n);if(128&i[0]){const e=n.slice(0),t=new Uint8Array(e);n=new ArrayBuffer(n.byteLength+1),i=new Uint8Array(n);for(let r=0;r<e.byteLength;r++)i[r+1]=t[r];i[0]=0}return n}r*=Math.pow(2,8)}return new ArrayBuffer(0)}(e))}get valueDec(){return this._valueDec}fromDER(e,t,r,s=0){const n=this.fromBER(e,t,r);if(-1===n)return n;const i=this.valueHexView;return 0===i[0]&&128&i[1]?this.valueHexView=i.subarray(1):0!==s&&i.length<s&&(s-i.length>1&&(s=i.length+1),this.valueHexView=i.subarray(s-i.length)),n}toDER(e=!1){const t=this.valueHexView;switch(!0){case!!(128&t[0]):{const e=new Uint8Array(this.valueHexView.length+1);e[0]=0,e.set(t,1),this.valueHexView=e}break;case 0===t[0]&&!(128&t[1]):this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}fromBER(e,t,r){const s=super.fromBER(e,t,r);return-1===s||this.setValueHex(),s}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=8*this.valueHexView.length-1;let t,r=new Uint8Array(8*this.valueHexView.length/3),s=0;const n=this.valueHexView;let i="",o=!1;for(let o=n.byteLength-1;o>=0;o--){t=n[o];for(let n=0;n<8;n++){if(!(1&~t))if(s===e)r=We($e(s),r),i="-";else r=Ke(r,$e(s));s++,t>>=1}}for(let e=0;e<r.length;e++)r[e]&&(o=!0),o&&(i+=C.charAt(r[e]));return!1===o&&(i+=C.charAt(0)),i}}se=Ge,Ge.NAME="IntegerValueBlock",Object.defineProperty(se.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});class Ye extends ${constructor(e={}){super(e,Ge),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return b(),BigInt(this.valueBlock.toString())}static fromBigInt(e){b();const t=BigInt(e),r=new w,s=t.toString(16).replace(/^-/,""),i=new Uint8Array(d.FromHex(s));if(t<0){const e=new Uint8Array(i.length+(128&i[0]?1:0));e[0]|=128;const s=BigInt(`0x${d.ToHex(e)}`)+t,o=n.toUint8Array(d.FromHex(s.toString(16)));o[0]|=128,r.write(o)}else 128&i[0]&&r.write(new Uint8Array([0])),r.write(i);return new Ye({valueHex:r.final()})}convertToDER(){const e=new Ye({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new Ye({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}ne=Ye,K.Integer=ne,Ye.NAME="INTEGER";class Xe extends Ye{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}ie=Xe,K.Enumerated=ie,Xe.NAME="ENUMERATED";class Je extends(H(z)){constructor({valueDec:e=-1,isFirstSid:t=!1,...r}={}){super(r),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,r){if(!r)return t;const s=n.toUint8Array(e);if(!S(this,s,t,r))return-1;const i=s.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let e=0;e<r&&(this.valueHexView[e]=127&i[e],this.blockLength++,128&i[e]);e++);const o=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)o[e]=this.valueHexView[e];return this.valueHexView=o,128&i[this.blockLength-1]?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=p(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){b();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const r=new Uint8Array(t.length/7);for(let e=0;e<r.length;e++)r[e]=parseInt(t.slice(7*e,7*e+7),2)+(e+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const t=this.valueHexView,r=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)r[e]=128|t[e];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}const t=f(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",D;const r=new Uint8Array(t.byteLength);if(!e){const e=new Uint8Array(t),s=t.byteLength-1;for(let t=0;t<s;t++)r[t]=128|e[t];r[s]=e[s]}return r}toString(){let e="";if(this.isHexOnly)e=d.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}Je.NAME="sidBlock";class Qe extends z{constructor({value:e=N,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let s=t;for(;r>0;){const t=new Je;if(s=t.fromBER(e,s,r),-1===s)return this.blockLength=0,this.error=t.error,s;0===this.value.length&&(t.isFirstSid=!0),this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return s}toBER(e){const t=[];for(let r=0;r<this.value.length;r++){const s=this.value[r].toBER(e);if(0===s.byteLength)return this.error=this.value[r].error,D;t.push(s)}return v(t)}fromString(e){this.value=[];let t=0,r=0,s="",n=!1;do{if(r=e.indexOf(".",t),s=-1===r?e.substring(t):e.substring(t,r),t=r+1,n){const e=this.value[0];let t=0;switch(e.valueDec){case 0:break;case 1:t=40;break;case 2:t=80;break;default:return void(this.value=[])}const r=parseInt(s,10);if(isNaN(r))return;e.valueDec=r+t,n=!1}else{const e=new Je;if(s>Number.MAX_SAFE_INTEGER){b();const t=BigInt(s);e.valueBigInt=t}else if(e.valueDec=parseInt(s,10),isNaN(e.valueDec))return;this.value.length||(e.isFirstSid=!0,n=!0),this.value.push(e)}}while(-1!==r)}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let s=this.value[r].toString();0!==r&&(e=`${e}.`),t?(s=`{${s}}`,this.value[r].isFirstSid?e=`2.{${s} - 80}`:e+=s):e+=s}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}Qe.NAME="ObjectIdentifierValueBlock";class Ze extends ${constructor(e={}){super(e,Qe),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}oe=Ze,K.ObjectIdentifier=oe,Ze.NAME="OBJECT IDENTIFIER";class et extends(H(F)){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,r){if(0===r)return t;const s=n.toUint8Array(e);if(!S(this,s,t,r))return-1;const i=s.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let e=0;e<r&&(this.valueHexView[e]=127&i[e],this.blockLength++,128&i[e]);e++);const o=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)o[e]=this.valueHexView[e];return this.valueHexView=o,128&i[this.blockLength-1]?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=p(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const t=this.valueHexView,r=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)r[e]=128|t[e];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}const t=f(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",D;const r=new Uint8Array(t.byteLength);if(!e){const e=new Uint8Array(t),s=t.byteLength-1;for(let t=0;t<s;t++)r[t]=128|e[t];r[s]=e[s]}return r.buffer}toString(){let e="";return e=this.isHexOnly?d.ToHex(this.valueHexView):this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}et.NAME="relativeSidBlock";class tt extends z{constructor({value:e=N,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let s=t;for(;r>0;){const t=new et;if(s=t.fromBER(e,s,r),-1===s)return this.blockLength=0,this.error=t.error,s;this.blockLength+=t.blockLength,r-=t.blockLength,this.value.push(t)}return s}toBER(e,t){const r=[];for(let t=0;t<this.value.length;t++){const s=this.value[t].toBER(e);if(0===s.byteLength)return this.error=this.value[t].error,D;r.push(s)}return v(r)}fromString(e){this.value=[];let t=0,r=0,s="";do{r=e.indexOf(".",t),s=-1===r?e.substring(t):e.substring(t,r),t=r+1;const n=new et;if(n.valueDec=parseInt(s,10),isNaN(n.valueDec))return!0;this.value.push(n)}while(-1!==r);return!0}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let s=this.value[r].toString();0!==r&&(e=`${e}.`),t?(s=`{${s}}`,e+=s):e+=s}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}tt.NAME="RelativeObjectIdentifierValueBlock";class rt extends ${constructor(e={}){super(e,tt),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}ae=rt,K.RelativeObjectIdentifier=ae,rt.NAME="RelativeObjectIdentifier";class st extends De{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}ce=st,K.Sequence=ce,st.NAME="SEQUENCE";class nt extends De{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}ue=nt,K.Set=ue,nt.NAME="SET";class it extends(H(z)){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=N}toJSON(){return{...super.toJSON(),value:this.value}}}it.NAME="StringValueBlock";class ot extends it{}ot.NAME="SimpleStringValueBlock";class at extends G{constructor({...e}={}){super(e,ot)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,n.toUint8Array(e))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);this.valueBlock.value=e}}at.NAME="SIMPLE STRING";class ct extends at{fromBuffer(e){this.valueBlock.valueHexView=n.toUint8Array(e);try{this.valueBlock.value=d.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=d.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(d.FromUtf8String(e)),this.valueBlock.value=e}}ct.NAME="Utf8StringValueBlock";class ut extends ct{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}le=ut,K.Utf8String=le,ut.NAME="UTF8String";class lt extends at{fromBuffer(e){this.valueBlock.value=d.ToUtf16String(e),this.valueBlock.valueHexView=n.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(d.FromUtf16String(e))}}lt.NAME="BmpStringValueBlock";class dt extends lt{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}de=dt,K.BmpString=de,dt.NAME="BMPString";class ht extends at{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t);for(let e=0;e<r.length;e+=4)r[e]=r[e+3],r[e+1]=r[e+2],r[e+2]=0,r[e+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(4*t);for(let s=0;s<t;s++){const t=f(e.charCodeAt(s),8),n=new Uint8Array(t);if(n.length>4)continue;const i=4-n.length;for(let e=n.length-1;e>=0;e--)r[4*s+e+i]=n[e]}this.valueBlock.value=e}}ht.NAME="UniversalStringValueBlock";class pt extends ht{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}he=pt,K.UniversalString=he,pt.NAME="UniversalString";class ft extends at{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}pe=ft,K.NumericString=pe,ft.NAME="NumericString";class gt extends at{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}fe=gt,K.PrintableString=fe,gt.NAME="PrintableString";class mt extends at{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}ge=mt,K.TeletexString=ge,mt.NAME="TeletexString";class yt extends at{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}me=yt,K.VideotexString=me,yt.NAME="VideotexString";class bt extends at{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}ye=bt,K.IA5String=ye,bt.NAME="IA5String";class vt extends at{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}be=vt,K.GraphicString=be,vt.NAME="GraphicString";class St extends at{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}ve=St,K.VisibleString=ve,St.NAME="VisibleString";class wt extends at{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}Se=wt,K.GeneralString=Se,wt.NAME="GeneralString";class Et extends at{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}we=Et,K.CharacterString=we,Et.NAME="CharacterString";class Ct extends St{constructor({value:e,valueDate:t,...r}={}){if(super(r),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let t=0;t<e.length;t++)this.valueBlock.valueHexView[t]=e.charCodeAt(t)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,n.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null===t)return void(this.error="Wrong input string for conversion");const r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}toString(e="iso"){if("iso"===e){const e=new Array(7);return e[0]=y(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=y(this.month,2),e[2]=y(this.day,2),e[3]=y(this.hour,2),e[4]=y(this.minute,2),e[5]=y(this.second,2),e[6]="Z",e.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}Ee=Ct,K.UTCTime=Ee,Ct.NAME="UTCTime";class Tt extends Ct{constructor(e={}){var t;super(e),null!==(t=this.millisecond)&&void 0!==t||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t,r=!1,s="",n="",i=0,o=0,a=0;if("Z"===e[e.length-1])s=e.substring(0,e.length-1),r=!0;else{const t=new Number(e[e.length-1]);if(isNaN(t.valueOf()))throw new Error("Wrong input string for conversion");s=e}if(r){if(-1!==s.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==s.indexOf("-"))throw new Error("Wrong input string for conversion")}else{let e=1,t=s.indexOf("+"),r="";if(-1===t&&(t=s.indexOf("-"),e=-1),-1!==t){if(r=s.substring(t+1),s=s.substring(0,t),2!==r.length&&4!==r.length)throw new Error("Wrong input string for conversion");let n=parseInt(r.substring(0,2),10);if(isNaN(n.valueOf()))throw new Error("Wrong input string for conversion");if(o=e*n,4===r.length){if(n=parseInt(r.substring(2,4),10),isNaN(n.valueOf()))throw new Error("Wrong input string for conversion");a=e*n}}}let c=s.indexOf(".");if(-1===c&&(c=s.indexOf(",")),-1!==c){const e=new Number(`0${s.substring(c)}`);if(isNaN(e.valueOf()))throw new Error("Wrong input string for conversion");i=e.valueOf(),n=s.substring(0,c)}else n=s;switch(!0){case 8===n.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==c)throw new Error("Wrong input string for conversion");break;case 10===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==c){let e=60*i;this.minute=Math.floor(e),e=60*(e-this.minute),this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 12===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==c){let e=60*i;this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 14===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==c){const e=1e3*i;this.millisecond=Math.floor(e)}break;default:throw new Error("Wrong input string for conversion")}const u=t.exec(n);if(null===u)throw new Error("Wrong input string for conversion");for(let e=1;e<u.length;e++)switch(e){case 1:this.year=parseInt(u[e],10);break;case 2:this.month=parseInt(u[e],10);break;case 3:this.day=parseInt(u[e],10);break;case 4:this.hour=parseInt(u[e],10)+o;break;case 5:this.minute=parseInt(u[e],10)+a;break;case 6:this.second=parseInt(u[e],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===r){const e=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=e.getUTCFullYear(),this.month=e.getUTCMonth(),this.day=e.getUTCDay(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}}toString(e="iso"){if("iso"===e){const e=[];return e.push(y(this.year,4)),e.push(y(this.month,2)),e.push(y(this.day,2)),e.push(y(this.hour,2)),e.push(y(this.minute,2)),e.push(y(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(y(this.millisecond,3))),e.push("Z"),e.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}Ce=Tt,K.GeneralizedTime=Ce,Tt.NAME="GeneralizedTime";class It extends ut{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}Te=It,K.DATE=Te,It.NAME="DATE";class _t extends ut{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}Ie=_t,K.TimeOfDay=Ie,_t.NAME="TimeOfDay";class At extends ut{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}_e=At,K.DateTime=_e,At.NAME="DateTime";class Rt extends ut{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}Ae=Rt,K.Duration=Ae,Rt.NAME="Duration";class Pt extends ut{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}Re=Pt,K.TIME=Re,Pt.NAME="TIME";class kt{constructor({name:e=N,optional:t=!1}={}){this.name=e,this.optional=t}}class Bt extends kt{constructor({value:e=[],...t}={}){super(t),this.value=e}}class Ot extends kt{constructor({value:e=new kt,local:t=!1,...r}={}){super(r),this.value=e,this.local=t}}class xt{constructor({data:e=L}={}){this.dataView=n.toUint8Array(e)}get data(){return this.dataView.slice().buffer}set data(e){this.dataView=n.toUint8Array(e)}fromBER(e,t,r){const s=t+r;return this.dataView=n.toUint8Array(e).subarray(t,s),s}toBER(e){return this.dataView.slice().buffer}}function Nt(e,t,r){if(r instanceof Bt){for(let s=0;s<r.value.length;s++){if(Nt(e,t,r.value[s]).verified)return{verified:!0,result:e}}{const e={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty(T)&&(e.name=r.name),e}}if(r instanceof kt)return r.hasOwnProperty(T)&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(A in r==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(B in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(O in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const s=r.idBlock.toBER(!1);if(0===s.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(s,0,s.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty(R))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty(P))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty(k))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if(!(_ in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(r.idBlock.isHexOnly){if(I in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const s=r.idBlock.valueHexView,n=t.idBlock.valueHexView;if(s.length!==n.length)return{verified:!1,result:e};for(let t=0;t<s.length;t++)if(s[t]!==n[1])return{verified:!1,result:e}}if(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,N),r.name&&(e[r.name]=t)),r instanceof K.Constructed){let s=0,n={verified:!1,result:{error:"Unknown error"}},i=r.valueBlock.value.length;if(i>0&&r.valueBlock.value[0]instanceof Ot&&(i=t.valueBlock.value.length),0===i)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){let t=!0;for(let e=0;e<r.valueBlock.value.length;e++)t=t&&(r.valueBlock.value[e].optional||!1);return t?{verified:!0,result:e}:(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,N),r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(let o=0;o<i;o++)if(o-s>=t.valueBlock.value.length){if(!1===r.valueBlock.value[o].optional){const t={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,N),r.name&&(delete e[r.name],t.name=r.name)),t}}else if(r.valueBlock.value[0]instanceof Ot){if(n=Nt(e,t.valueBlock.value[o],r.valueBlock.value[0].value),!1===n.verified){if(!r.valueBlock.value[0].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,N),r.name&&delete e[r.name]),n;s++}if(T in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){let s={};s=x in r.valueBlock.value[0]&&r.valueBlock.value[0].local?t:e,"undefined"==typeof s[r.valueBlock.value[0].name]&&(s[r.valueBlock.value[0].name]=[]),s[r.valueBlock.value[0].name].push(t.valueBlock.value[o])}}else if(n=Nt(e,t.valueBlock.value[o-s],r.valueBlock.value[o]),!1===n.verified){if(!r.valueBlock.value[o].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,N),r.name&&delete e[r.name]),n;s++}if(!1===n.verified){const t={verified:!1,result:e};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,N),r.name&&(delete e[r.name],t.name=r.name)),t}return{verified:!0,result:e}}if(r.primitiveSchema&&I in t.valueBlock){const s=Oe(t.valueBlock.valueHexView);if(-1===s.offset){const t={verified:!1,result:s.result};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,N),r.name&&(delete e[r.name],t.name=r.name)),t}return Nt(e,s.result,r.primitiveSchema)}return{verified:!0,result:e}}function Dt(e,t){if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};const r=Oe(n.toUint8Array(e));return-1===r.offset?{verified:!1,result:r.result}:Nt(r.result,r.result,t)}!function(e){e[e.Sequence=0]="Sequence",e[e.Set=1]="Set",e[e.Choice=2]="Choice"}(Pe||(Pe={})),function(e){e[e.Any=1]="Any",e[e.Boolean=2]="Boolean",e[e.OctetString=3]="OctetString",e[e.BitString=4]="BitString",e[e.Integer=5]="Integer",e[e.Enumerated=6]="Enumerated",e[e.ObjectIdentifier=7]="ObjectIdentifier",e[e.Utf8String=8]="Utf8String",e[e.BmpString=9]="BmpString",e[e.UniversalString=10]="UniversalString",e[e.NumericString=11]="NumericString",e[e.PrintableString=12]="PrintableString",e[e.TeletexString=13]="TeletexString",e[e.VideotexString=14]="VideotexString",e[e.IA5String=15]="IA5String",e[e.GraphicString=16]="GraphicString",e[e.VisibleString=17]="VisibleString",e[e.GeneralString=18]="GeneralString",e[e.CharacterString=19]="CharacterString",e[e.UTCTime=20]="UTCTime",e[e.GeneralizedTime=21]="GeneralizedTime",e[e.DATE=22]="DATE",e[e.TimeOfDay=23]="TimeOfDay",e[e.DateTime=24]="DateTime",e[e.Duration=25]="Duration",e[e.TIME=26]="TIME",e[e.Null=27]="Null"}(ke||(ke={}));class Lt{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if("number"==typeof e)this.fromNumber(e);else{if(!n.isBufferSource(e))throw TypeError("Unsupported type of 'params' argument for BitString");this.unusedBits=t,this.value=n.toArrayBuffer(e)}}fromASN(e){if(!(e instanceof qe))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new qe({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new qe({name:e})}toNumber(){let e="";const t=new Uint8Array(this.value);for(const r of t)e+=r.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2);const r=t.length+7>>3;this.unusedBits=(r<<3)-t.length;const s=new Uint8Array(r);t=t.padStart(r<<3,"0").split("").reverse().join("");let n=0;for(;n<r;)s[n]=parseInt(t.slice(n<<3,8+(n<<3)),2),n++;this.value=s.buffer}}class Mt{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){"number"==typeof e?this.buffer=new ArrayBuffer(e):n.isBufferSource(e)?this.buffer=n.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof ze))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new ze({valueHex:this.buffer})}toSchema(e){return new ze({name:e})}}const Ut={fromASN:e=>e instanceof Ue?null:e.valueBeforeDecodeView,toASN:e=>{if(null===e)return new Ue;const t=xe(e);if(t.result.error)throw new Error(t.result.error);return t.result}},jt={fromASN:e=>e.valueBlock.valueHexView.byteLength>=4?e.valueBlock.toString():e.valueBlock.valueDec,toASN:e=>new Ye({value:+e})},Ht={fromASN:e=>e.valueBlock.valueDec,toASN:e=>new Xe({value:e})},Ft={fromASN:e=>e.valueBlock.valueHexView,toASN:e=>new Ye({valueHex:e})},zt={fromASN:e=>e.valueBlock.valueHexView,toASN:e=>new qe({valueHex:e})},Vt={fromASN:e=>e.valueBlock.toString(),toASN:e=>new Ze({value:e})},qt={fromASN:e=>e.valueBlock.value,toASN:e=>new He({value:e})},Kt={fromASN:e=>e.valueBlock.valueHexView,toASN:e=>new ze({valueHex:e})},$t={fromASN:e=>new Mt(e.getValue()),toASN:e=>e.toASN()};function Wt(e){return{fromASN:e=>e.valueBlock.value,toASN:t=>new e({value:t})}}const Gt=Wt(ut),Yt=Wt(dt),Xt=Wt(pt),Jt=Wt(ft),Qt=Wt(gt),Zt=Wt(mt),er=Wt(yt),tr=Wt(bt),rr=Wt(vt),sr=Wt(St),nr=Wt(wt),ir=Wt(Et),or={fromASN:e=>e.toDate(),toASN:e=>new Ct({valueDate:e})},ar={fromASN:e=>e.toDate(),toASN:e=>new Tt({valueDate:e})},cr={fromASN:()=>null,toASN:()=>new Ue};function ur(e){switch(e){case ke.Any:return Ut;case ke.BitString:return zt;case ke.BmpString:return Yt;case ke.Boolean:return qt;case ke.CharacterString:return ir;case ke.Enumerated:return Ht;case ke.GeneralString:return nr;case ke.GeneralizedTime:return ar;case ke.GraphicString:return rr;case ke.IA5String:return tr;case ke.Integer:return jt;case ke.Null:return cr;case ke.NumericString:return Jt;case ke.ObjectIdentifier:return Vt;case ke.OctetString:return Kt;case ke.PrintableString:return Qt;case ke.TeletexString:return Zt;case ke.UTCTime:return or;case ke.UniversalString:return Xt;case ke.Utf8String:return Gt;case ke.VideotexString:return er;case ke.VisibleString:return sr;default:return null}}function lr(e){return"function"==typeof e&&e.prototype?!(!e.prototype.toASN||!e.prototype.fromASN)||lr(e.prototype):!!(e&&"object"==typeof e&&"toASN"in e&&"fromASN"in e)}function dr(e){var t;if(e){const r=Object.getPrototypeOf(e);return(null===(t=null==r?void 0:r.prototype)||void 0===t?void 0:t.constructor)===Array||dr(r)}return!1}function hr(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;const r=new Uint8Array(e),s=new Uint8Array(t);for(let t=0;t<e.byteLength;t++)if(r[t]!==s[t])return!1;return!0}const pr=new class{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){const r=this.items.get(e);if(!r)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!r.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return r}cache(e){const t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){const t={type:Pe.Sequence,items:{}},r=this.findParentSchema(e);return r&&(Object.assign(t,r),t.items=Object.assign({},t.items,r.items)),t}create(e,t){const r=this.items.get(e)||this.createDefault(e),n=[];for(const e in r.items){const i=r.items[e],o=t?e:"";let a;if("number"==typeof i.type){const e=ke[i.type],t=s[e];if(!t)throw new Error(`Cannot get ASN1 class by name '${e}'`);a=new t({name:o})}else if(lr(i.type)){a=(new i.type).toSchema(o)}else if(i.optional){this.get(i.type).type===Pe.Choice?a=new kt({name:o}):(a=this.create(i.type,!1),a.name=o)}else a=new kt({name:o});const c=!!i.optional||void 0!==i.defaultValue;if(i.repeated){a.name="";a=new("set"===i.repeated?nt:st)({name:"",value:[new Ot({name:o,value:a})]})}if(null!==i.context&&void 0!==i.context)if(i.implicit)if("number"==typeof i.type||lr(i.type)){const e=i.repeated?De:Be;n.push(new e({name:o,optional:c,idBlock:{tagClass:3,tagNumber:i.context}}))}else{this.cache(i.type);const e=!!i.repeated;let t=e?a:this.get(i.type,!0).schema;t="valueBlock"in t?t.valueBlock.value:t.value,n.push(new De({name:e?"":o,optional:c,idBlock:{tagClass:3,tagNumber:i.context},value:t}))}else n.push(new De({optional:c,idBlock:{tagClass:3,tagNumber:i.context},value:[a]}));else a.optional=c,n.push(a)}switch(r.type){case Pe.Sequence:return new st({value:n,name:""});case Pe.Set:return new nt({value:n,name:""});case Pe.Choice:return new Bt({value:n,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){const t=Object.getPrototypeOf(e);if(t){return this.items.get(t)||this.findParentSchema(t)}return null}},fr=e=>t=>{let r;pr.has(t)?r=pr.get(t):(r=pr.createDefault(t),pr.set(t,r)),Object.assign(r,e)},gr=e=>(t,r)=>{let s;pr.has(t.constructor)?s=pr.get(t.constructor):(s=pr.createDefault(t.constructor),pr.set(t.constructor,s));const n=Object.assign({},e);if("number"==typeof n.type&&!n.converter){const s=ur(e.type);if(!s)throw new Error(`Cannot get default converter for property '${r}' of ${t.constructor.name}`);n.converter=s}s.items[r]=n};class mr extends Error{constructor(){super(...arguments),this.schemas=[]}}class yr{static parse(e,t){const r=xe(e);if(r.result.error)throw new Error(r.result.error);return this.fromASN(r.result,t)}static fromASN(e,t){var r;try{if(lr(t)){return(new t).fromASN(e)}const n=pr.get(t);pr.cache(t);let i=n.schema;if(e.constructor===De&&n.type!==Pe.Choice){i=new De({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:n.schema.valueBlock.value});for(const t in n.items)delete e[t]}const o=Nt({},e,i);if(!o.verified)throw new mr(`Data does not match to ${t.name} ASN1 schema. ${o.result.error}`);const a=new t;if(dr(t)){if(!("value"in e.valueBlock)||!Array.isArray(e.valueBlock.value))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const r=n.itemType;if("number"==typeof r){const s=ur(r);if(!s)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,(e=>s.fromASN(e)))}return t.from(e.valueBlock.value,(e=>this.fromASN(e,r)))}for(const e in n.items){const t=o.result[e];if(!t)continue;const i=n.items[e],c=i.type;if("number"==typeof c||lr(c)){const n=null!==(r=i.converter)&&void 0!==r?r:lr(c)?new c:null;if(!n)throw new Error("Converter is empty");if(i.repeated)if(i.implicit){const r=new("sequence"===i.repeated?st:nt);r.valueBlock=t.valueBlock;const s=xe(r.toBER(!1));if(-1===s.offset)throw new Error(`Cannot parse the child item. ${s.result.error}`);if(!("value"in s.result.valueBlock)||!Array.isArray(s.result.valueBlock.value))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const o=s.result.valueBlock.value;a[e]=Array.from(o,(e=>n.fromASN(e)))}else a[e]=Array.from(t,(e=>n.fromASN(e)));else{let r=t;if(i.implicit){let e;if(lr(c))e=(new c).toSchema("");else{const t=ke[c],r=s[t];if(!r)throw new Error(`Cannot get '${t}' class from asn1js module`);e=new r}e.valueBlock=r.valueBlock,r=xe(e.toBER(!1)).result}a[e]=n.fromASN(r)}}else if(i.repeated){if(!Array.isArray(t))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");a[e]=Array.from(t,(e=>this.fromASN(e,c)))}else a[e]=this.fromASN(t,c)}return a}catch(e){throw e instanceof mr&&e.schemas.push(t.name),e}}}class br{static serialize(e){return e instanceof $?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&"object"==typeof e&&lr(e))return e.toASN();if(!e||"object"!=typeof e)throw new TypeError("Parameter 1 should be type of Object.");const t=e.constructor,r=pr.get(t);pr.cache(t);let s,n=[];if(r.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if("number"==typeof r.itemType){const s=ur(r.itemType);if(!s)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);n=e.map((e=>s.toASN(e)))}else n=e.map((e=>this.toAsnItem({type:r.itemType},"[]",t,e)))}else for(const s in r.items){const i=r.items[s],o=e[s];if(void 0===o||i.defaultValue===o||"object"==typeof i.defaultValue&&"object"==typeof o&&hr(this.serialize(i.defaultValue),this.serialize(o)))continue;const a=br.toAsnItem(i,s,t,o);if("number"==typeof i.context)if(i.implicit)if(i.repeated||"number"!=typeof i.type&&!lr(i.type))n.push(new De({optional:i.optional,idBlock:{tagClass:3,tagNumber:i.context},value:a.valueBlock.value}));else{const e={};e.valueHex=a instanceof Ue?a.valueBeforeDecodeView:a.valueBlock.toBER(),n.push(new Be({optional:i.optional,idBlock:{tagClass:3,tagNumber:i.context},...e}))}else n.push(new De({optional:i.optional,idBlock:{tagClass:3,tagNumber:i.context},value:[a]}));else i.repeated?n=n.concat(a):n.push(a)}switch(r.type){case Pe.Sequence:s=new st({value:n});break;case Pe.Set:s=new nt({value:n});break;case Pe.Choice:if(!n[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);s=n[0]}return s}static toAsnItem(e,t,r,s){let n;if("number"==typeof e.type){const i=e.converter;if(!i)throw new Error(`Property '${t}' doesn't have converter for type ${ke[e.type]} in schema '${r.name}'`);if(e.repeated){if(!Array.isArray(s))throw new TypeError("Parameter 'objProp' should be type of Array.");const t=Array.from(s,(e=>i.toASN(e)));n=new("sequence"===e.repeated?st:nt)({value:t})}else n=i.toASN(s)}else if(e.repeated){if(!Array.isArray(s))throw new TypeError("Parameter 'objProp' should be type of Array.");const t=Array.from(s,(e=>this.toASN(e)));n=new("sequence"===e.repeated?st:nt)({value:t})}else n=this.toASN(s);return n}}class vr extends Array{constructor(e=[]){if("number"==typeof e)super(e);else{super();for(const t of e)this.push(t)}}}class Sr{static serialize(e){return br.serialize(e)}static parse(e,t){return yr.parse(e,t)}static toString(e){const t=xe(n.isBufferSource(e)?n.toArrayBuffer(e):Sr.serialize(e));if(-1===t.offset)throw new Error(`Cannot decode ASN.1 data. ${t.result.error}`);return t.result.toString()}}function wr(e,t,r,s){var n,i=arguments.length,o=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i<3?n(o):i>3?n(t,r,o):n(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;class Er{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){const t=e.split(".");if(4!==t.length)throw new Error("Invalid IPv4 address");return t.map((e=>{const t=parseInt(e,10);if(isNaN(t)||t<0||t>255)throw new Error("Invalid IPv4 address part");return t}))}static parseIPv6(e){const t=this.expandIPv6(e).split(":");if(8!==t.length)throw new Error("Invalid IPv6 address");return t.reduce(((e,t)=>{const r=parseInt(t,16);if(isNaN(r)||r<0||r>65535)throw new Error("Invalid IPv6 address part");return e.push(r>>8&255),e.push(255&r),e}),[])}static expandIPv6(e){if(!e.includes("::"))return e;const t=e.split("::");if(t.length>2)throw new Error("Invalid IPv6 address");const r=t[0]?t[0].split(":"):[],s=t[1]?t[1].split(":"):[],n=8-(r.length+s.length);if(n<0)throw new Error("Invalid IPv6 address");return[...r,...Array(n).fill("0"),...s].join(":")}static formatIPv6(e){const t=[];for(let r=0;r<16;r+=2)t.push((e[r]<<8|e[r+1]).toString(16));return this.compressIPv6(t.join(":"))}static compressIPv6(e){const t=e.split(":");let r=-1,s=0,n=-1,i=0;for(let e=0;e<t.length;e++)"0"===t[e]?(-1===n&&(n=e),i++):(i>s&&(r=n,s=i),n=-1,i=0);if(i>s&&(r=n,s=i),s>1){return`${t.slice(0,r).join(":")}::${t.slice(r+s).join(":")}`}return e}static parseCIDR(e){const[t,r]=e.split("/"),s=parseInt(r,10);if(this.isIPv4(t)){if(s<0||s>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(t),s]}if(s<0||s>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(t),s]}static decodeIP(e){if(64===e.length&&0===parseInt(e,16))return"::/0";if(16!==e.length)return e;const t=parseInt(e.slice(8),16).toString(2).split("").reduce(((e,t)=>e+ +t),0);let r=e.slice(0,8).replace(/(.{2})/g,(e=>`${parseInt(e,16)}.`));return r=r.slice(0,-1),`${r}/${t}`}static toString(e){const t=new Uint8Array(e);if(4===t.length)return Array.from(t).join(".");if(16===t.length)return this.formatIPv6(t);if(8===t.length||32===t.length){const e=t.length/2,r=t.slice(0,e),s=t.slice(e);if(t.every((e=>0===e)))return 8===t.length?"0.0.0.0/0":"::/0";const n=s.reduce(((e,t)=>e+(t.toString(2).match(/1/g)||[]).length),0);if(8===t.length){return`${Array.from(r).join(".")}/${n}`}return`${this.formatIPv6(r)}/${n}`}return this.decodeIP(d.ToHex(e))}static fromString(e){if(e.includes("/")){const[t,r]=this.parseCIDR(e),s=new Uint8Array(t.length);let n=r;for(let e=0;e<s.length;e++)n>=8?(s[e]=255,n-=8):n>0&&(s[e]=255<<8-n,n=0);const i=new Uint8Array(2*t.length);return i.set(t,0),i.set(s,t.length),i.buffer}const t=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(t).buffer}}var Cr,Tr,Ir;let _r=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};wr([gr({type:ke.TeletexString})],_r.prototype,"teletexString",void 0),wr([gr({type:ke.PrintableString})],_r.prototype,"printableString",void 0),wr([gr({type:ke.UniversalString})],_r.prototype,"universalString",void 0),wr([gr({type:ke.Utf8String})],_r.prototype,"utf8String",void 0),wr([gr({type:ke.BmpString})],_r.prototype,"bmpString",void 0),_r=wr([fr({type:Pe.Choice})],_r);let Ar=class extends _r{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?d.ToHex(this.anyValue):super.toString())}};wr([gr({type:ke.IA5String})],Ar.prototype,"ia5String",void 0),wr([gr({type:ke.Any})],Ar.prototype,"anyValue",void 0),Ar=wr([fr({type:Pe.Choice})],Ar);class Rr{constructor(e={}){this.type="",this.value=new Ar,Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],Rr.prototype,"type",void 0),wr([gr({type:Ar})],Rr.prototype,"value",void 0);let Pr=Cr=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Cr.prototype)}};Pr=Cr=wr([fr({type:Pe.Set,itemType:Rr})],Pr);let kr=Tr=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Tr.prototype)}};kr=Tr=wr([fr({type:Pe.Sequence,itemType:Pr})],kr);let Br=Ir=class extends kr{constructor(e){super(e),Object.setPrototypeOf(this,Ir.prototype)}};Br=Ir=wr([fr({type:Pe.Sequence})],Br);const Or={fromASN:e=>Er.toString(Kt.fromASN(e)),toASN:e=>Kt.toASN(Er.fromString(e))};class xr{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],xr.prototype,"typeId",void 0),wr([gr({type:ke.Any,context:0})],xr.prototype,"value",void 0);class Nr{constructor(e={}){this.partyName=new _r,Object.assign(this,e)}}wr([gr({type:_r,optional:!0,context:0,implicit:!0})],Nr.prototype,"nameAssigner",void 0),wr([gr({type:_r,context:1,implicit:!0})],Nr.prototype,"partyName",void 0);let Dr=class{constructor(e={}){Object.assign(this,e)}};wr([gr({type:xr,context:0,implicit:!0})],Dr.prototype,"otherName",void 0),wr([gr({type:ke.IA5String,context:1,implicit:!0})],Dr.prototype,"rfc822Name",void 0),wr([gr({type:ke.IA5String,context:2,implicit:!0})],Dr.prototype,"dNSName",void 0),wr([gr({type:ke.Any,context:3,implicit:!0})],Dr.prototype,"x400Address",void 0),wr([gr({type:Br,context:4,implicit:!1})],Dr.prototype,"directoryName",void 0),wr([gr({type:Nr,context:5})],Dr.prototype,"ediPartyName",void 0),wr([gr({type:ke.IA5String,context:6,implicit:!0})],Dr.prototype,"uniformResourceIdentifier",void 0),wr([gr({type:ke.OctetString,context:7,implicit:!0,converter:Or})],Dr.prototype,"iPAddress",void 0),wr([gr({type:ke.ObjectIdentifier,context:8,implicit:!0})],Dr.prototype,"registeredID",void 0),Dr=wr([fr({type:Pe.Choice})],Dr);const Lr="1.3.6.1.5.5.7",Mr=`${Lr}.3`,Ur=`${Lr}.48`,jr=`${Ur}.1`,Hr=`${Ur}.2`,Fr=`${Ur}.3`,zr=`${Ur}.5`,Vr="2.5.29";var qr;const Kr=`${`${Lr}.1`}.1`;class $r{constructor(e={}){this.accessMethod="",this.accessLocation=new Dr,Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],$r.prototype,"accessMethod",void 0),wr([gr({type:Dr})],$r.prototype,"accessLocation",void 0);let Wr=qr=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,qr.prototype)}};Wr=qr=wr([fr({type:Pe.Sequence,itemType:$r})],Wr);const Gr=`${Vr}.35`;class Yr extends Mt{}class Xr{constructor(e={}){e&&Object.assign(this,e)}}wr([gr({type:Yr,context:0,optional:!0,implicit:!0})],Xr.prototype,"keyIdentifier",void 0),wr([gr({type:Dr,context:1,optional:!0,implicit:!0,repeated:"sequence"})],Xr.prototype,"authorityCertIssuer",void 0),wr([gr({type:ke.Integer,context:2,optional:!0,implicit:!0,converter:Ft})],Xr.prototype,"authorityCertSerialNumber",void 0);const Jr=`${Vr}.19`;class Qr{constructor(e={}){this.cA=!1,Object.assign(this,e)}}var Zr;wr([gr({type:ke.Boolean,defaultValue:!1})],Qr.prototype,"cA",void 0),wr([gr({type:ke.Integer,optional:!0})],Qr.prototype,"pathLenConstraint",void 0);let es=Zr=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Zr.prototype)}};var ts;es=Zr=wr([fr({type:Pe.Sequence,itemType:Dr})],es);const rs=`${Vr}.29`;let ss=ts=class extends es{constructor(e){super(e),Object.setPrototypeOf(this,ts.prototype)}};var ns;ss=ts=wr([fr({type:Pe.Sequence})],ss);const is=`${Vr}.32`;let os=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};wr([gr({type:ke.IA5String})],os.prototype,"ia5String",void 0),wr([gr({type:ke.VisibleString})],os.prototype,"visibleString",void 0),wr([gr({type:ke.BmpString})],os.prototype,"bmpString",void 0),wr([gr({type:ke.Utf8String})],os.prototype,"utf8String",void 0),os=wr([fr({type:Pe.Choice})],os);class as{constructor(e={}){this.organization=new os,this.noticeNumbers=[],Object.assign(this,e)}}wr([gr({type:os})],as.prototype,"organization",void 0),wr([gr({type:ke.Integer,repeated:"sequence"})],as.prototype,"noticeNumbers",void 0);class cs{constructor(e={}){Object.assign(this,e)}}wr([gr({type:as,optional:!0})],cs.prototype,"noticeRef",void 0),wr([gr({type:os,optional:!0})],cs.prototype,"explicitText",void 0);let us=class{constructor(e={}){Object.assign(this,e)}};wr([gr({type:ke.IA5String})],us.prototype,"cPSuri",void 0),wr([gr({type:cs})],us.prototype,"userNotice",void 0),us=wr([fr({type:Pe.Choice})],us);class ls{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],ls.prototype,"policyQualifierId",void 0),wr([gr({type:ke.Any})],ls.prototype,"qualifier",void 0);class ds{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],ds.prototype,"policyIdentifier",void 0),wr([gr({type:ls,repeated:"sequence",optional:!0})],ds.prototype,"policyQualifiers",void 0);let hs=ns=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,ns.prototype)}};hs=ns=wr([fr({type:Pe.Sequence,itemType:ds})],hs);let ps=class{constructor(e=0){this.value=e}};wr([gr({type:ke.Integer})],ps.prototype,"value",void 0),ps=wr([fr({type:Pe.Choice})],ps);let fs=class extends ps{};var gs;fs=wr([fr({type:Pe.Choice})],fs);const ms=`${Vr}.31`;var ys;!function(e){e[e.unused=1]="unused",e[e.keyCompromise=2]="keyCompromise",e[e.cACompromise=4]="cACompromise",e[e.affiliationChanged=8]="affiliationChanged",e[e.superseded=16]="superseded",e[e.cessationOfOperation=32]="cessationOfOperation",e[e.certificateHold=64]="certificateHold",e[e.privilegeWithdrawn=128]="privilegeWithdrawn",e[e.aACompromise=256]="aACompromise"}(ys||(ys={}));class bs extends Lt{toJSON(){const e=[],t=this.toNumber();return t&ys.aACompromise&&e.push("aACompromise"),t&ys.affiliationChanged&&e.push("affiliationChanged"),t&ys.cACompromise&&e.push("cACompromise"),t&ys.certificateHold&&e.push("certificateHold"),t&ys.cessationOfOperation&&e.push("cessationOfOperation"),t&ys.keyCompromise&&e.push("keyCompromise"),t&ys.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&ys.superseded&&e.push("superseded"),t&ys.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}}let vs=class{constructor(e={}){Object.assign(this,e)}};wr([gr({type:Dr,context:0,repeated:"sequence",implicit:!0})],vs.prototype,"fullName",void 0),wr([gr({type:Pr,context:1,implicit:!0})],vs.prototype,"nameRelativeToCRLIssuer",void 0),vs=wr([fr({type:Pe.Choice})],vs);class Ss{constructor(e={}){Object.assign(this,e)}}wr([gr({type:vs,context:0,optional:!0})],Ss.prototype,"distributionPoint",void 0),wr([gr({type:bs,context:1,optional:!0,implicit:!0})],Ss.prototype,"reasons",void 0),wr([gr({type:Dr,context:2,optional:!0,repeated:"sequence",implicit:!0})],Ss.prototype,"cRLIssuer",void 0);let ws=gs=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,gs.prototype)}};var Es;ws=gs=wr([fr({type:Pe.Sequence,itemType:Ss})],ws);let Cs=Es=class extends ws{constructor(e){super(e),Object.setPrototypeOf(this,Es.prototype)}};Cs=Es=wr([fr({type:Pe.Sequence,itemType:Ss})],Cs);class Ts{constructor(e={}){this.onlyContainsUserCerts=Ts.ONLY,this.onlyContainsCACerts=Ts.ONLY,this.indirectCRL=Ts.ONLY,this.onlyContainsAttributeCerts=Ts.ONLY,Object.assign(this,e)}}Ts.ONLY=!1,wr([gr({type:vs,context:0,optional:!0})],Ts.prototype,"distributionPoint",void 0),wr([gr({type:ke.Boolean,context:1,defaultValue:Ts.ONLY,implicit:!0})],Ts.prototype,"onlyContainsUserCerts",void 0),wr([gr({type:ke.Boolean,context:2,defaultValue:Ts.ONLY,implicit:!0})],Ts.prototype,"onlyContainsCACerts",void 0),wr([gr({type:bs,context:3,optional:!0,implicit:!0})],Ts.prototype,"onlySomeReasons",void 0),wr([gr({type:ke.Boolean,context:4,defaultValue:Ts.ONLY,implicit:!0})],Ts.prototype,"indirectCRL",void 0),wr([gr({type:ke.Boolean,context:5,defaultValue:Ts.ONLY,implicit:!0})],Ts.prototype,"onlyContainsAttributeCerts",void 0);const Is=`${Vr}.21`;var _s;!function(e){e[e.unspecified=0]="unspecified",e[e.keyCompromise=1]="keyCompromise",e[e.cACompromise=2]="cACompromise",e[e.affiliationChanged=3]="affiliationChanged",e[e.superseded=4]="superseded",e[e.cessationOfOperation=5]="cessationOfOperation",e[e.certificateHold=6]="certificateHold",e[e.removeFromCRL=8]="removeFromCRL",e[e.privilegeWithdrawn=9]="privilegeWithdrawn",e[e.aACompromise=10]="aACompromise"}(_s||(_s={}));let As=class{constructor(e=_s.unspecified){this.reason=_s.unspecified,this.reason=e}toJSON(){return _s[this.reason]}toString(){return this.toJSON()}};var Rs;wr([gr({type:ke.Enumerated})],As.prototype,"reason",void 0),As=wr([fr({type:Pe.Choice})],As);const Ps=`${Vr}.37`;let ks=Rs=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Rs.prototype)}};ks=Rs=wr([fr({type:Pe.Sequence,itemType:ke.ObjectIdentifier})],ks);const Bs=`${Mr}.1`,Os=`${Mr}.2`,xs=`${Mr}.3`,Ns=`${Mr}.4`,Ds=`${Mr}.8`,Ls=`${Mr}.9`;let Ms=class{constructor(e=new ArrayBuffer(0)){this.value=e}};wr([gr({type:ke.Integer,converter:Ft})],Ms.prototype,"value",void 0),Ms=wr([fr({type:Pe.Choice})],Ms);const Us=`${Vr}.24`;let js=class{constructor(e){this.value=new Date,e&&(this.value=e)}};var Hs;wr([gr({type:ke.GeneralizedTime})],js.prototype,"value",void 0),js=wr([fr({type:Pe.Choice})],js);let Fs=Hs=class extends es{constructor(e){super(e),Object.setPrototypeOf(this,Hs.prototype)}};Fs=Hs=wr([fr({type:Pe.Sequence})],Fs);const zs=`${Vr}.15`;var Vs,qs;!function(e){e[e.digitalSignature=1]="digitalSignature",e[e.nonRepudiation=2]="nonRepudiation",e[e.keyEncipherment=4]="keyEncipherment",e[e.dataEncipherment=8]="dataEncipherment",e[e.keyAgreement=16]="keyAgreement",e[e.keyCertSign=32]="keyCertSign",e[e.cRLSign=64]="cRLSign",e[e.encipherOnly=128]="encipherOnly",e[e.decipherOnly=256]="decipherOnly"}(Vs||(Vs={}));class Ks extends Lt{toJSON(){const e=this.toNumber(),t=[];return e&Vs.cRLSign&&t.push("crlSign"),e&Vs.dataEncipherment&&t.push("dataEncipherment"),e&Vs.decipherOnly&&t.push("decipherOnly"),e&Vs.digitalSignature&&t.push("digitalSignature"),e&Vs.encipherOnly&&t.push("encipherOnly"),e&Vs.keyAgreement&&t.push("keyAgreement"),e&Vs.keyCertSign&&t.push("keyCertSign"),e&Vs.keyEncipherment&&t.push("keyEncipherment"),e&Vs.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}}class $s{constructor(e={}){this.base=new Dr,this.minimum=0,Object.assign(this,e)}}wr([gr({type:Dr})],$s.prototype,"base",void 0),wr([gr({type:ke.Integer,context:0,defaultValue:0,implicit:!0})],$s.prototype,"minimum",void 0),wr([gr({type:ke.Integer,context:1,optional:!0,implicit:!0})],$s.prototype,"maximum",void 0);let Ws=qs=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,qs.prototype)}};Ws=qs=wr([fr({type:Pe.Sequence,itemType:$s})],Ws);class Gs{constructor(e={}){Object.assign(this,e)}}wr([gr({type:Ws,context:0,optional:!0,implicit:!0})],Gs.prototype,"permittedSubtrees",void 0),wr([gr({type:Ws,context:1,optional:!0,implicit:!0})],Gs.prototype,"excludedSubtrees",void 0);class Ys{constructor(e={}){Object.assign(this,e)}}var Xs;wr([gr({type:ke.Integer,context:0,implicit:!0,optional:!0,converter:Ft})],Ys.prototype,"requireExplicitPolicy",void 0),wr([gr({type:ke.Integer,context:1,implicit:!0,optional:!0,converter:Ft})],Ys.prototype,"inhibitPolicyMapping",void 0);class Js{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],Js.prototype,"issuerDomainPolicy",void 0),wr([gr({type:ke.ObjectIdentifier})],Js.prototype,"subjectDomainPolicy",void 0);let Qs=Xs=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Xs.prototype)}};var Zs;Qs=Xs=wr([fr({type:Pe.Sequence,itemType:Js})],Qs);const en=`${Vr}.17`;let tn=Zs=class extends es{constructor(e){super(e),Object.setPrototypeOf(this,Zs.prototype)}};tn=Zs=wr([fr({type:Pe.Sequence})],tn);class rn{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}}var sn;wr([gr({type:ke.ObjectIdentifier})],rn.prototype,"type",void 0),wr([gr({type:ke.Any,repeated:"set"})],rn.prototype,"values",void 0);let nn=sn=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,sn.prototype)}};nn=sn=wr([fr({type:Pe.Sequence,itemType:rn})],nn);const on=`${Vr}.14`;class an extends Yr{}class cn{constructor(e={}){Object.assign(this,e)}}wr([gr({type:ke.GeneralizedTime,context:0,implicit:!0,optional:!0})],cn.prototype,"notBefore",void 0),wr([gr({type:ke.GeneralizedTime,context:1,implicit:!0,optional:!0})],cn.prototype,"notAfter",void 0);var un,ln;!function(e){e[e.keyUpdateAllowed=1]="keyUpdateAllowed",e[e.newExtensions=2]="newExtensions",e[e.pKIXCertificate=4]="pKIXCertificate"}(un||(un={}));class dn extends Lt{toJSON(){const e=[],t=this.toNumber();return t&un.pKIXCertificate&&e.push("pKIXCertificate"),t&un.newExtensions&&e.push("newExtensions"),t&un.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}}class hn{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new dn,Object.assign(this,e)}}wr([gr({type:ke.GeneralString})],hn.prototype,"entrustVers",void 0),wr([gr({type:dn})],hn.prototype,"entrustInfoFlags",void 0);let pn=ln=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,ln.prototype)}};pn=ln=wr([fr({type:Pe.Sequence,itemType:$r})],pn);class fn{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof fn&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&h(e.parameters,this.parameters)||e.parameters===this.parameters)}}wr([gr({type:ke.ObjectIdentifier})],fn.prototype,"algorithm",void 0),wr([gr({type:ke.Any,optional:!0})],fn.prototype,"parameters",void 0);class gn{constructor(e={}){this.algorithm=new fn,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:fn})],gn.prototype,"algorithm",void 0),wr([gr({type:ke.BitString})],gn.prototype,"subjectPublicKey",void 0);let mn=class{constructor(e){if(e)if("string"==typeof e||"number"==typeof e||e instanceof Date){const t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){const e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};wr([gr({type:ke.UTCTime})],mn.prototype,"utcTime",void 0),wr([gr({type:ke.GeneralizedTime})],mn.prototype,"generalTime",void 0),mn=wr([fr({type:Pe.Choice})],mn);class yn{constructor(e){this.notBefore=new mn(new Date),this.notAfter=new mn(new Date),e&&(this.notBefore=new mn(e.notBefore),this.notAfter=new mn(e.notAfter))}}var bn;wr([gr({type:mn})],yn.prototype,"notBefore",void 0),wr([gr({type:mn})],yn.prototype,"notAfter",void 0);class vn{constructor(e={}){this.extnID="",this.critical=vn.CRITICAL,this.extnValue=new Mt,Object.assign(this,e)}}vn.CRITICAL=!1,wr([gr({type:ke.ObjectIdentifier})],vn.prototype,"extnID",void 0),wr([gr({type:ke.Boolean,defaultValue:vn.CRITICAL})],vn.prototype,"critical",void 0),wr([gr({type:Mt})],vn.prototype,"extnValue",void 0);let Sn=bn=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,bn.prototype)}};var wn;Sn=bn=wr([fr({type:Pe.Sequence,itemType:vn})],Sn),function(e){e[e.v1=0]="v1",e[e.v2=1]="v2",e[e.v3=2]="v3"}(wn||(wn={}));class En{constructor(e={}){this.version=wn.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new fn,this.issuer=new Br,this.validity=new yn,this.subject=new Br,this.subjectPublicKeyInfo=new gn,Object.assign(this,e)}}wr([gr({type:ke.Integer,context:0,defaultValue:wn.v1})],En.prototype,"version",void 0),wr([gr({type:ke.Integer,converter:Ft})],En.prototype,"serialNumber",void 0),wr([gr({type:fn})],En.prototype,"signature",void 0),wr([gr({type:Br})],En.prototype,"issuer",void 0),wr([gr({type:yn})],En.prototype,"validity",void 0),wr([gr({type:Br})],En.prototype,"subject",void 0),wr([gr({type:gn})],En.prototype,"subjectPublicKeyInfo",void 0),wr([gr({type:ke.BitString,context:1,implicit:!0,optional:!0})],En.prototype,"issuerUniqueID",void 0),wr([gr({type:ke.BitString,context:2,implicit:!0,optional:!0})],En.prototype,"subjectUniqueID",void 0),wr([gr({type:Sn,context:3,optional:!0})],En.prototype,"extensions",void 0);class Cn{constructor(e={}){this.tbsCertificate=new En,this.signatureAlgorithm=new fn,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:En})],Cn.prototype,"tbsCertificate",void 0),wr([gr({type:fn})],Cn.prototype,"signatureAlgorithm",void 0),wr([gr({type:ke.BitString})],Cn.prototype,"signatureValue",void 0);class Tn{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new mn,Object.assign(this,e)}}wr([gr({type:ke.Integer,converter:Ft})],Tn.prototype,"userCertificate",void 0),wr([gr({type:mn})],Tn.prototype,"revocationDate",void 0),wr([gr({type:vn,optional:!0,repeated:"sequence"})],Tn.prototype,"crlEntryExtensions",void 0);class In{constructor(e={}){this.signature=new fn,this.issuer=new Br,this.thisUpdate=new mn,Object.assign(this,e)}}wr([gr({type:ke.Integer,optional:!0})],In.prototype,"version",void 0),wr([gr({type:fn})],In.prototype,"signature",void 0),wr([gr({type:Br})],In.prototype,"issuer",void 0),wr([gr({type:mn})],In.prototype,"thisUpdate",void 0),wr([gr({type:mn,optional:!0})],In.prototype,"nextUpdate",void 0),wr([gr({type:Tn,repeated:"sequence",optional:!0})],In.prototype,"revokedCertificates",void 0),wr([gr({type:vn,optional:!0,context:0,repeated:"sequence"})],In.prototype,"crlExtensions",void 0);class _n{constructor(e={}){this.tbsCertList=new In,this.signatureAlgorithm=new fn,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:In})],_n.prototype,"tbsCertList",void 0),wr([gr({type:fn})],_n.prototype,"signatureAlgorithm",void 0),wr([gr({type:ke.BitString})],_n.prototype,"signature",void 0);class An{constructor(e={}){this.issuer=new Br,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:Br})],An.prototype,"issuer",void 0),wr([gr({type:ke.Integer,converter:Ft})],An.prototype,"serialNumber",void 0);let Rn=class{constructor(e={}){Object.assign(this,e)}};var Pn;wr([gr({type:an,context:0,implicit:!0})],Rn.prototype,"subjectKeyIdentifier",void 0),wr([gr({type:An})],Rn.prototype,"issuerAndSerialNumber",void 0),Rn=wr([fr({type:Pe.Choice})],Rn),function(e){e[e.v0=0]="v0",e[e.v1=1]="v1",e[e.v2=2]="v2",e[e.v3=3]="v3",e[e.v4=4]="v4",e[e.v5=5]="v5"}(Pn||(Pn={}));let kn=class extends fn{};kn=wr([fr({type:Pe.Sequence})],kn);let Bn=class extends fn{};Bn=wr([fr({type:Pe.Sequence})],Bn);let On=class extends fn{};On=wr([fr({type:Pe.Sequence})],On);let xn=class extends fn{};xn=wr([fr({type:Pe.Sequence})],xn);let Nn=class extends fn{};Nn=wr([fr({type:Pe.Sequence})],Nn);let Dn=class extends fn{};Dn=wr([fr({type:Pe.Sequence})],Dn);class Ln{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}}var Mn;wr([gr({type:ke.ObjectIdentifier})],Ln.prototype,"attrType",void 0),wr([gr({type:ke.Any,repeated:"set"})],Ln.prototype,"attrValues",void 0);class Un{constructor(e={}){this.version=Pn.v0,this.sid=new Rn,this.digestAlgorithm=new kn,this.signatureAlgorithm=new Bn,this.signature=new Mt,Object.assign(this,e)}}wr([gr({type:ke.Integer})],Un.prototype,"version",void 0),wr([gr({type:Rn})],Un.prototype,"sid",void 0),wr([gr({type:kn})],Un.prototype,"digestAlgorithm",void 0),wr([gr({type:Ln,repeated:"set",context:0,implicit:!0,optional:!0})],Un.prototype,"signedAttrs",void 0),wr([gr({type:Bn})],Un.prototype,"signatureAlgorithm",void 0),wr([gr({type:Mt})],Un.prototype,"signature",void 0),wr([gr({type:Ln,repeated:"set",context:1,implicit:!0,optional:!0})],Un.prototype,"unsignedAttrs",void 0);let jn=Mn=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Mn.prototype)}};jn=Mn=wr([fr({type:Pe.Set,itemType:Un})],jn);let Hn=class extends mn{};Hn=wr([fr({type:Pe.Choice})],Hn);let Fn=class extends Un{};Fn=wr([fr({type:Pe.Sequence})],Fn);class zn{constructor(e={}){this.acIssuer=new Dr,this.acSerial=0,this.attrs=[],Object.assign(this,e)}}var Vn;wr([gr({type:Dr})],zn.prototype,"acIssuer",void 0),wr([gr({type:ke.Integer})],zn.prototype,"acSerial",void 0),wr([gr({type:rn,repeated:"sequence"})],zn.prototype,"attrs",void 0);let qn=Vn=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Vn.prototype)}};qn=Vn=wr([fr({type:Pe.Sequence,itemType:ke.ObjectIdentifier})],qn);class Kn{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}}wr([gr({type:ke.Integer,optional:!0})],Kn.prototype,"pathLenConstraint",void 0),wr([gr({type:qn,implicit:!0,context:0,optional:!0})],Kn.prototype,"permittedAttrs",void 0),wr([gr({type:qn,implicit:!0,context:1,optional:!0})],Kn.prototype,"excludedAttrs",void 0),wr([gr({type:ke.Boolean,defaultValue:!0})],Kn.prototype,"permitUnSpecified",void 0);class $n{constructor(e={}){this.issuer=new es,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}}var Wn;wr([gr({type:es})],$n.prototype,"issuer",void 0),wr([gr({type:ke.Integer,converter:Ft})],$n.prototype,"serial",void 0),wr([gr({type:ke.BitString,optional:!0})],$n.prototype,"issuerUID",void 0),function(e){e[e.publicKey=0]="publicKey",e[e.publicKeyCert=1]="publicKeyCert",e[e.otherObjectTypes=2]="otherObjectTypes"}(Wn||(Wn={}));class Gn{constructor(e={}){this.digestedObjectType=Wn.publicKey,this.digestAlgorithm=new fn,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ke.Enumerated})],Gn.prototype,"digestedObjectType",void 0),wr([gr({type:ke.ObjectIdentifier,optional:!0})],Gn.prototype,"otherObjectTypeID",void 0),wr([gr({type:fn})],Gn.prototype,"digestAlgorithm",void 0),wr([gr({type:ke.BitString})],Gn.prototype,"objectDigest",void 0);class Yn{constructor(e={}){Object.assign(this,e)}}wr([gr({type:es,optional:!0})],Yn.prototype,"issuerName",void 0),wr([gr({type:$n,context:0,implicit:!0,optional:!0})],Yn.prototype,"baseCertificateID",void 0),wr([gr({type:Gn,context:1,implicit:!0,optional:!0})],Yn.prototype,"objectDigestInfo",void 0);let Xn=class{constructor(e={}){Object.assign(this,e)}};wr([gr({type:Dr,repeated:"sequence"})],Xn.prototype,"v1Form",void 0),wr([gr({type:Yn,context:0,implicit:!0})],Xn.prototype,"v2Form",void 0),Xn=wr([fr({type:Pe.Choice})],Xn);class Jn{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}}wr([gr({type:ke.GeneralizedTime})],Jn.prototype,"notBeforeTime",void 0),wr([gr({type:ke.GeneralizedTime})],Jn.prototype,"notAfterTime",void 0);class Qn{constructor(e={}){Object.assign(this,e)}}var Zn,ei;wr([gr({type:$n,implicit:!0,context:0,optional:!0})],Qn.prototype,"baseCertificateID",void 0),wr([gr({type:es,implicit:!0,context:1,optional:!0})],Qn.prototype,"entityName",void 0),wr([gr({type:Gn,implicit:!0,context:2,optional:!0})],Qn.prototype,"objectDigestInfo",void 0),function(e){e[e.v2=1]="v2"}(Zn||(Zn={}));class ti{constructor(e={}){this.version=Zn.v2,this.holder=new Qn,this.issuer=new Xn,this.signature=new fn,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new Jn,this.attributes=[],Object.assign(this,e)}}wr([gr({type:ke.Integer})],ti.prototype,"version",void 0),wr([gr({type:Qn})],ti.prototype,"holder",void 0),wr([gr({type:Xn})],ti.prototype,"issuer",void 0),wr([gr({type:fn})],ti.prototype,"signature",void 0),wr([gr({type:ke.Integer,converter:Ft})],ti.prototype,"serialNumber",void 0),wr([gr({type:Jn})],ti.prototype,"attrCertValidityPeriod",void 0),wr([gr({type:rn,repeated:"sequence"})],ti.prototype,"attributes",void 0),wr([gr({type:ke.BitString,optional:!0})],ti.prototype,"issuerUniqueID",void 0),wr([gr({type:Sn,optional:!0})],ti.prototype,"extensions",void 0);class ri{constructor(e={}){this.acinfo=new ti,this.signatureAlgorithm=new fn,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ti})],ri.prototype,"acinfo",void 0),wr([gr({type:fn})],ri.prototype,"signatureAlgorithm",void 0),wr([gr({type:ke.BitString})],ri.prototype,"signatureValue",void 0),function(e){e[e.unmarked=1]="unmarked",e[e.unclassified=2]="unclassified",e[e.restricted=4]="restricted",e[e.confidential=8]="confidential",e[e.secret=16]="secret",e[e.topSecret=32]="topSecret"}(ei||(ei={}));class si extends Lt{}class ni{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier,implicit:!0,context:0})],ni.prototype,"type",void 0),wr([gr({type:ke.Any,implicit:!0,context:1})],ni.prototype,"value",void 0);class ii{constructor(e={}){this.policyId="",this.classList=new si(ei.unclassified),Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],ii.prototype,"policyId",void 0),wr([gr({type:si,defaultValue:new si(ei.unclassified)})],ii.prototype,"classList",void 0),wr([gr({type:ni,repeated:"set"})],ii.prototype,"securityCategories",void 0);class oi{constructor(e={}){Object.assign(this,e)}}wr([gr({type:Mt})],oi.prototype,"cotets",void 0),wr([gr({type:ke.ObjectIdentifier})],oi.prototype,"oid",void 0),wr([gr({type:ke.Utf8String})],oi.prototype,"string",void 0);class ai{constructor(e={}){this.values=[],Object.assign(this,e)}}wr([gr({type:es,implicit:!0,context:0,optional:!0})],ai.prototype,"policyAuthority",void 0),wr([gr({type:oi,repeated:"sequence"})],ai.prototype,"values",void 0);var ci;class ui{constructor(e={}){this.targetCertificate=new $n,Object.assign(this,e)}}wr([gr({type:$n})],ui.prototype,"targetCertificate",void 0),wr([gr({type:Dr,optional:!0})],ui.prototype,"targetName",void 0),wr([gr({type:Gn,optional:!0})],ui.prototype,"certDigestInfo",void 0);let li=class{constructor(e={}){Object.assign(this,e)}};wr([gr({type:Dr,context:0,implicit:!0})],li.prototype,"targetName",void 0),wr([gr({type:Dr,context:1,implicit:!0})],li.prototype,"targetGroup",void 0),wr([gr({type:ui,context:2,implicit:!0})],li.prototype,"targetCert",void 0),li=wr([fr({type:Pe.Choice})],li);let di=ci=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,ci.prototype)}};var hi;di=ci=wr([fr({type:Pe.Sequence,itemType:li})],di);let pi=hi=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,hi.prototype)}};pi=hi=wr([fr({type:Pe.Sequence,itemType:di})],pi);class fi{constructor(e={}){Object.assign(this,e)}}wr([gr({type:es,implicit:!0,context:0,optional:!0})],fi.prototype,"roleAuthority",void 0),wr([gr({type:Dr,implicit:!0,context:1})],fi.prototype,"roleName",void 0);class gi{constructor(e={}){this.service=new Dr,this.ident=new Dr,Object.assign(this,e)}}var mi;wr([gr({type:Dr})],gi.prototype,"service",void 0),wr([gr({type:Dr})],gi.prototype,"ident",void 0),wr([gr({type:Mt,optional:!0})],gi.prototype,"authInfo",void 0);class yi{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],yi.prototype,"otherCertFormat",void 0),wr([gr({type:ke.Any})],yi.prototype,"otherCert",void 0);let bi=class{constructor(e={}){Object.assign(this,e)}};wr([gr({type:Cn})],bi.prototype,"certificate",void 0),wr([gr({type:ri,context:2,implicit:!0})],bi.prototype,"v2AttrCert",void 0),wr([gr({type:yi,context:3,implicit:!0})],bi.prototype,"other",void 0),bi=wr([fr({type:Pe.Choice})],bi);let vi=mi=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,mi.prototype)}};vi=mi=wr([fr({type:Pe.Set,itemType:bi})],vi);class Si{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],Si.prototype,"contentType",void 0),wr([gr({type:ke.Any,context:0})],Si.prototype,"content",void 0);let wi=class{constructor(e={}){Object.assign(this,e)}};wr([gr({type:Mt})],wi.prototype,"single",void 0),wr([gr({type:ke.Any})],wi.prototype,"any",void 0),wi=wr([fr({type:Pe.Choice})],wi);class Ei{constructor(e={}){this.eContentType="",Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],Ei.prototype,"eContentType",void 0),wr([gr({type:wi,context:0,optional:!0})],Ei.prototype,"eContent",void 0);let Ci=class{constructor(e={}){Object.assign(this,e)}};wr([gr({type:Mt,context:0,implicit:!0,optional:!0})],Ci.prototype,"value",void 0),wr([gr({type:Mt,converter:$t,context:0,implicit:!0,optional:!0,repeated:"sequence"})],Ci.prototype,"constructedValue",void 0),Ci=wr([fr({type:Pe.Choice})],Ci);class Ti{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new xn,Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],Ti.prototype,"contentType",void 0),wr([gr({type:xn})],Ti.prototype,"contentEncryptionAlgorithm",void 0),wr([gr({type:Ci,optional:!0})],Ti.prototype,"encryptedContent",void 0);class Ii{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}}var _i;wr([gr({type:ke.ObjectIdentifier})],Ii.prototype,"keyAttrId",void 0),wr([gr({type:ke.Any,optional:!0})],Ii.prototype,"keyAttr",void 0);class Ai{constructor(e={}){this.subjectKeyIdentifier=new an,Object.assign(this,e)}}wr([gr({type:an})],Ai.prototype,"subjectKeyIdentifier",void 0),wr([gr({type:ke.GeneralizedTime,optional:!0})],Ai.prototype,"date",void 0),wr([gr({type:Ii,optional:!0})],Ai.prototype,"other",void 0);let Ri=class{constructor(e={}){Object.assign(this,e)}};wr([gr({type:Ai,context:0,implicit:!0,optional:!0})],Ri.prototype,"rKeyId",void 0),wr([gr({type:An,optional:!0})],Ri.prototype,"issuerAndSerialNumber",void 0),Ri=wr([fr({type:Pe.Choice})],Ri);class Pi{constructor(e={}){this.rid=new Ri,this.encryptedKey=new Mt,Object.assign(this,e)}}wr([gr({type:Ri})],Pi.prototype,"rid",void 0),wr([gr({type:Mt})],Pi.prototype,"encryptedKey",void 0);let ki=_i=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,_i.prototype)}};ki=_i=wr([fr({type:Pe.Sequence,itemType:Pi})],ki);class Bi{constructor(e={}){this.algorithm=new fn,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:fn})],Bi.prototype,"algorithm",void 0),wr([gr({type:ke.BitString})],Bi.prototype,"publicKey",void 0);let Oi=class{constructor(e={}){Object.assign(this,e)}};wr([gr({type:an,context:0,implicit:!0,optional:!0})],Oi.prototype,"subjectKeyIdentifier",void 0),wr([gr({type:Bi,context:1,implicit:!0,optional:!0})],Oi.prototype,"originatorKey",void 0),wr([gr({type:An,optional:!0})],Oi.prototype,"issuerAndSerialNumber",void 0),Oi=wr([fr({type:Pe.Choice})],Oi);class xi{constructor(e={}){this.version=Pn.v3,this.originator=new Oi,this.keyEncryptionAlgorithm=new On,this.recipientEncryptedKeys=new ki,Object.assign(this,e)}}wr([gr({type:ke.Integer})],xi.prototype,"version",void 0),wr([gr({type:Oi,context:0})],xi.prototype,"originator",void 0),wr([gr({type:Mt,context:1,optional:!0})],xi.prototype,"ukm",void 0),wr([gr({type:On})],xi.prototype,"keyEncryptionAlgorithm",void 0),wr([gr({type:ki})],xi.prototype,"recipientEncryptedKeys",void 0);let Ni=class{constructor(e={}){Object.assign(this,e)}};wr([gr({type:an,context:0,implicit:!0})],Ni.prototype,"subjectKeyIdentifier",void 0),wr([gr({type:An})],Ni.prototype,"issuerAndSerialNumber",void 0),Ni=wr([fr({type:Pe.Choice})],Ni);class Di{constructor(e={}){this.version=Pn.v0,this.rid=new Ni,this.keyEncryptionAlgorithm=new On,this.encryptedKey=new Mt,Object.assign(this,e)}}wr([gr({type:ke.Integer})],Di.prototype,"version",void 0),wr([gr({type:Ni})],Di.prototype,"rid",void 0),wr([gr({type:On})],Di.prototype,"keyEncryptionAlgorithm",void 0),wr([gr({type:Mt})],Di.prototype,"encryptedKey",void 0);class Li{constructor(e={}){this.keyIdentifier=new Mt,Object.assign(this,e)}}wr([gr({type:Mt})],Li.prototype,"keyIdentifier",void 0),wr([gr({type:ke.GeneralizedTime,optional:!0})],Li.prototype,"date",void 0),wr([gr({type:Ii,optional:!0})],Li.prototype,"other",void 0);class Mi{constructor(e={}){this.version=Pn.v4,this.kekid=new Li,this.keyEncryptionAlgorithm=new On,this.encryptedKey=new Mt,Object.assign(this,e)}}wr([gr({type:ke.Integer})],Mi.prototype,"version",void 0),wr([gr({type:Li})],Mi.prototype,"kekid",void 0),wr([gr({type:On})],Mi.prototype,"keyEncryptionAlgorithm",void 0),wr([gr({type:Mt})],Mi.prototype,"encryptedKey",void 0);class Ui{constructor(e={}){this.version=Pn.v0,this.keyEncryptionAlgorithm=new On,this.encryptedKey=new Mt,Object.assign(this,e)}}wr([gr({type:ke.Integer})],Ui.prototype,"version",void 0),wr([gr({type:Dn,context:0,optional:!0})],Ui.prototype,"keyDerivationAlgorithm",void 0),wr([gr({type:On})],Ui.prototype,"keyEncryptionAlgorithm",void 0),wr([gr({type:Mt})],Ui.prototype,"encryptedKey",void 0);class ji{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],ji.prototype,"oriType",void 0),wr([gr({type:ke.Any})],ji.prototype,"oriValue",void 0);let Hi=class{constructor(e={}){Object.assign(this,e)}};var Fi;wr([gr({type:Di,optional:!0})],Hi.prototype,"ktri",void 0),wr([gr({type:xi,context:1,implicit:!0,optional:!0})],Hi.prototype,"kari",void 0),wr([gr({type:Mi,context:2,implicit:!0,optional:!0})],Hi.prototype,"kekri",void 0),wr([gr({type:Ui,context:3,implicit:!0,optional:!0})],Hi.prototype,"pwri",void 0),wr([gr({type:ji,context:4,implicit:!0,optional:!0})],Hi.prototype,"ori",void 0),Hi=wr([fr({type:Pe.Choice})],Hi);let zi=Fi=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Fi.prototype)}};var Vi;zi=Fi=wr([fr({type:Pe.Set,itemType:Hi})],zi);class qi{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],qi.prototype,"otherRevInfoFormat",void 0),wr([gr({type:ke.Any})],qi.prototype,"otherRevInfo",void 0);let Ki=class{constructor(e={}){this.other=new qi,Object.assign(this,e)}};wr([gr({type:qi,context:1,implicit:!0})],Ki.prototype,"other",void 0),Ki=wr([fr({type:Pe.Choice})],Ki);let $i=Vi=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Vi.prototype)}};$i=Vi=wr([fr({type:Pe.Set,itemType:Ki})],$i);class Wi{constructor(e={}){Object.assign(this,e)}}var Gi;wr([gr({type:vi,context:0,implicit:!0,optional:!0})],Wi.prototype,"certs",void 0),wr([gr({type:$i,context:1,implicit:!0,optional:!0})],Wi.prototype,"crls",void 0);let Yi=Gi=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Gi.prototype)}};Yi=Gi=wr([fr({type:Pe.Set,itemType:Ln})],Yi);class Xi{constructor(e={}){this.version=Pn.v0,this.recipientInfos=new zi,this.encryptedContentInfo=new Ti,Object.assign(this,e)}}wr([gr({type:ke.Integer})],Xi.prototype,"version",void 0),wr([gr({type:Wi,context:0,implicit:!0,optional:!0})],Xi.prototype,"originatorInfo",void 0),wr([gr({type:zi})],Xi.prototype,"recipientInfos",void 0),wr([gr({type:Ti})],Xi.prototype,"encryptedContentInfo",void 0),wr([gr({type:Yi,context:1,implicit:!0,optional:!0})],Xi.prototype,"unprotectedAttrs",void 0);const Ji="1.2.840.113549.1.7.2";var Qi;let Zi=Qi=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Qi.prototype)}};Zi=Qi=wr([fr({type:Pe.Set,itemType:kn})],Zi);class eo{constructor(e={}){this.version=Pn.v0,this.digestAlgorithms=new Zi,this.encapContentInfo=new Ei,this.signerInfos=new jn,Object.assign(this,e)}}wr([gr({type:ke.Integer})],eo.prototype,"version",void 0),wr([gr({type:Zi})],eo.prototype,"digestAlgorithms",void 0),wr([gr({type:Ei})],eo.prototype,"encapContentInfo",void 0),wr([gr({type:vi,context:0,implicit:!0,optional:!0})],eo.prototype,"certificates",void 0),wr([gr({type:$i,context:1,implicit:!0,optional:!0})],eo.prototype,"crls",void 0),wr([gr({type:jn})],eo.prototype,"signerInfos",void 0);const to="1.2.840.10045.2.1",ro="1.2.840.10045.4.1",so="1.2.840.10045.4.3.1",no="1.2.840.10045.4.3.2",io="1.2.840.10045.4.3.3",oo="1.2.840.10045.4.3.4",ao="1.2.840.10045.3.1.7",co="1.3.132.0.34",uo="1.3.132.0.35";function lo(e){return new fn({algorithm:e})}const ho=lo(ro),po=(lo(so),lo(no)),fo=lo(io),go=lo(oo);let mo=class{constructor(e={}){Object.assign(this,e)}};wr([gr({type:ke.ObjectIdentifier})],mo.prototype,"fieldType",void 0),wr([gr({type:ke.Any})],mo.prototype,"parameters",void 0),mo=wr([fr({type:Pe.Sequence})],mo);let yo=class{constructor(e={}){Object.assign(this,e)}};var bo;wr([gr({type:ke.OctetString})],yo.prototype,"a",void 0),wr([gr({type:ke.OctetString})],yo.prototype,"b",void 0),wr([gr({type:ke.BitString,optional:!0})],yo.prototype,"seed",void 0),yo=wr([fr({type:Pe.Sequence})],yo),function(e){e[e.ecpVer1=1]="ecpVer1"}(bo||(bo={}));let vo=class{constructor(e={}){this.version=bo.ecpVer1,Object.assign(this,e)}};wr([gr({type:ke.Integer})],vo.prototype,"version",void 0),wr([gr({type:mo})],vo.prototype,"fieldID",void 0),wr([gr({type:yo})],vo.prototype,"curve",void 0),wr([gr({type:class extends Mt{}})],vo.prototype,"base",void 0),wr([gr({type:ke.Integer,converter:Ft})],vo.prototype,"order",void 0),wr([gr({type:ke.Integer,optional:!0})],vo.prototype,"cofactor",void 0),vo=wr([fr({type:Pe.Sequence})],vo);let So=class{constructor(e={}){Object.assign(this,e)}};wr([gr({type:ke.ObjectIdentifier})],So.prototype,"namedCurve",void 0),wr([gr({type:ke.Null})],So.prototype,"implicitCurve",void 0),wr([gr({type:vo})],So.prototype,"specifiedCurve",void 0),So=wr([fr({type:Pe.Choice})],So);class wo{constructor(e={}){this.version=1,this.privateKey=new Mt,Object.assign(this,e)}}wr([gr({type:ke.Integer})],wo.prototype,"version",void 0),wr([gr({type:Mt})],wo.prototype,"privateKey",void 0),wr([gr({type:So,context:0,optional:!0})],wo.prototype,"parameters",void 0),wr([gr({type:ke.BitString,context:1,optional:!0})],wo.prototype,"publicKey",void 0);class Eo{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ke.Integer,converter:Ft})],Eo.prototype,"r",void 0),wr([gr({type:ke.Integer,converter:Ft})],Eo.prototype,"s",void 0);const Co="1.2.840.113549.1.1",To=`${Co}.1`,Io=`${Co}.7`,_o=`${Co}.9`,Ao=`${Co}.10`,Ro=`${Co}.2`,Po=`${Co}.4`,ko=`${Co}.5`,Bo=`${Co}.14`,Oo=`${Co}.11`,xo=`${Co}.12`,No=`${Co}.13`,Do=`${Co}.15`,Lo=`${Co}.16`,Mo="1.3.14.3.2.26",Uo="2.16.840.1.101.3.4.2.4",jo="2.16.840.1.101.3.4.2.1",Ho="2.16.840.1.101.3.4.2.2",Fo="2.16.840.1.101.3.4.2.3",zo=`${Co}.8`;function Vo(e){return new fn({algorithm:e,parameters:null})}Vo("1.2.840.113549.2.2"),Vo("1.2.840.113549.2.5");const qo=Vo(Mo),Ko=(Vo(Uo),Vo(jo),Vo(Ho),Vo(Fo),Vo("2.16.840.1.101.3.4.2.5"),Vo("2.16.840.1.101.3.4.2.6"),new fn({algorithm:zo,parameters:Sr.serialize(qo)})),$o=new fn({algorithm:_o,parameters:Sr.serialize(Kt.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});Vo(To),Vo(Ro),Vo(Po),Vo(ko),Vo(Do),Vo(Lo),Vo(xo),Vo(No),Vo(Do),Vo(Lo);class Wo{constructor(e={}){this.hashAlgorithm=new fn(qo),this.maskGenAlgorithm=new fn({algorithm:zo,parameters:Sr.serialize(qo)}),this.pSourceAlgorithm=new fn($o),Object.assign(this,e)}}wr([gr({type:fn,context:0,defaultValue:qo})],Wo.prototype,"hashAlgorithm",void 0),wr([gr({type:fn,context:1,defaultValue:Ko})],Wo.prototype,"maskGenAlgorithm",void 0),wr([gr({type:fn,context:2,defaultValue:$o})],Wo.prototype,"pSourceAlgorithm",void 0);new fn({algorithm:Io,parameters:Sr.serialize(new Wo)});class Go{constructor(e={}){this.hashAlgorithm=new fn(qo),this.maskGenAlgorithm=new fn({algorithm:zo,parameters:Sr.serialize(qo)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}}wr([gr({type:fn,context:0,defaultValue:qo})],Go.prototype,"hashAlgorithm",void 0),wr([gr({type:fn,context:1,defaultValue:Ko})],Go.prototype,"maskGenAlgorithm",void 0),wr([gr({type:ke.Integer,context:2,defaultValue:20})],Go.prototype,"saltLength",void 0),wr([gr({type:ke.Integer,context:3,defaultValue:1})],Go.prototype,"trailerField",void 0);new fn({algorithm:Ao,parameters:Sr.serialize(new Go)});class Yo{constructor(e={}){this.digestAlgorithm=new fn,this.digest=new Mt,Object.assign(this,e)}}var Xo;wr([gr({type:fn})],Yo.prototype,"digestAlgorithm",void 0),wr([gr({type:Mt})],Yo.prototype,"digest",void 0);class Jo{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ke.Integer,converter:Ft})],Jo.prototype,"prime",void 0),wr([gr({type:ke.Integer,converter:Ft})],Jo.prototype,"exponent",void 0),wr([gr({type:ke.Integer,converter:Ft})],Jo.prototype,"coefficient",void 0);let Qo=Xo=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Xo.prototype)}};Qo=Xo=wr([fr({type:Pe.Sequence,itemType:Jo})],Qo);class Zo{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ke.Integer})],Zo.prototype,"version",void 0),wr([gr({type:ke.Integer,converter:Ft})],Zo.prototype,"modulus",void 0),wr([gr({type:ke.Integer,converter:Ft})],Zo.prototype,"publicExponent",void 0),wr([gr({type:ke.Integer,converter:Ft})],Zo.prototype,"privateExponent",void 0),wr([gr({type:ke.Integer,converter:Ft})],Zo.prototype,"prime1",void 0),wr([gr({type:ke.Integer,converter:Ft})],Zo.prototype,"prime2",void 0),wr([gr({type:ke.Integer,converter:Ft})],Zo.prototype,"exponent1",void 0),wr([gr({type:ke.Integer,converter:Ft})],Zo.prototype,"exponent2",void 0),wr([gr({type:ke.Integer,converter:Ft})],Zo.prototype,"coefficient",void 0),wr([gr({type:Qo,optional:!0})],Zo.prototype,"otherPrimeInfos",void 0);class ea{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}}var ta;wr([gr({type:ke.Integer,converter:Ft})],ea.prototype,"modulus",void 0),wr([gr({type:ke.Integer,converter:Ft})],ea.prototype,"publicExponent",void 0),function(e){e[e.Transient=0]="Transient",e[e.Singleton=1]="Singleton",e[e.ResolutionScoped=2]="ResolutionScoped",e[e.ContainerScoped=3]="ContainerScoped"}(ta||(ta={}));const ra=ta;var sa=function(e,t){return sa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},sa(e,t)};function na(e,t){function r(){this.constructor=e}sa(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function ia(e,t,r,s){return new(r||(r=Promise))((function(n,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))}function oa(e,t){var r,s,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,s&&(n=2&i[0]?s.return:i[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,i[1])).done)return n;switch(s=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,s=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],s=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function aa(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],s=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ca(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,n,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)o.push(s.value)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o}function ua(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(ca(arguments[t]));return e}function la(e){return!!e.useClass}function da(e){return!!e.useFactory}var ha=function(){function e(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return e.prototype.createProxy=function(e){var t,r=this,s=!1;return new Proxy({},this.createHandler((function(){return s||(t=e(r.wrap()),s=!0),t})))},e.prototype.createHandler=function(e){var t={};return this.reflectMethods.forEach((function(r){t[r]=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];return t[0]=e(),Reflect[r].apply(void 0,ua(t))}})),t},e}();function pa(e){return"string"==typeof e||"symbol"==typeof e}function fa(e){return"object"==typeof e&&"token"in e&&"transform"in e}function ga(e){return!!e.useToken}function ma(e){return null!=e.useValue}const ya=function(){function e(){this._registryMap=new Map}return e.prototype.entries=function(){return this._registryMap.entries()},e.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},e.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},e.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},e.prototype.setAll=function(e,t){this._registryMap.set(e,t)},e.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},e.prototype.clear=function(){this._registryMap.clear()},e.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},e}();const ba=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return na(t,e),t}(ya);const va=function(){this.scopedResolutions=new Map};function Sa(e,t,r){var s,n,i=ca(e.toString().match(/constructor\(([\w, ]+)\)/)||[],2)[1],o=function(e,t){return null===e?"at position #"+t:'"'+e.split(",")[t].trim()+'" at position #'+t}(void 0===i?null:i,t);return s="Cannot inject the dependency "+o+' of "'+e.name+'" constructor. Reason:',void 0===n&&(n="    "),ua([s],r.message.split("\n").map((function(e){return n+e}))).join("\n")}var wa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return na(t,e),t}(ya),Ea=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return na(t,e),t}(ya);const Ca=function(){this.preResolution=new wa,this.postResolution=new Ea};var Ta=new Map,Ia=function(){function e(e){this.parent=e,this._registry=new ba,this.interceptors=new Ca,this.disposed=!1,this.disposables=new Set}return e.prototype.register=function(e,t,r){var s;if(void 0===r&&(r={lifecycle:ra.Transient}),this.ensureNotDisposed(),s=function(e){return la(e)||ma(e)||ga(e)||da(e)}(t)?t:{useClass:t},ga(s))for(var n=[e],i=s;null!=i;){var o=i.useToken;if(n.includes(o))throw new Error("Token registration cycle detected! "+ua(n,[o]).join(" -> "));n.push(o);var a=this._registry.get(o);i=a&&ga(a.provider)?a.provider:null}if((r.lifecycle===ra.Singleton||r.lifecycle==ra.ContainerScoped||r.lifecycle==ra.ResolutionScoped)&&(ma(s)||da(s)))throw new Error('Cannot use lifecycle "'+ra[r.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:s,options:r}),this},e.prototype.registerType=function(e,t){return this.ensureNotDisposed(),pa(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},e.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},e.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),pa(e)){if(pa(t))return this.register(e,{useToken:t},{lifecycle:ra.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:ra.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var r=e;return t&&!pa(t)&&(r=t),this.register(e,{useClass:r},{lifecycle:ra.Singleton})},e.prototype.resolve=function(e,t){void 0===t&&(t=new va),this.ensureNotDisposed();var r=this.getRegistration(e);if(!r&&pa(e))throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"');if(this.executePreResolutionInterceptor(e,"Single"),r){var s=this.resolveRegistration(r,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}if(function(e){return"function"==typeof e||e instanceof ha}(e)){s=this.construct(e,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},e.prototype.executePreResolutionInterceptor=function(e,t){var r,s;if(this.interceptors.preResolution.has(e)){var n=[];try{for(var i=aa(this.interceptors.preResolution.getAll(e)),o=i.next();!o.done;o=i.next()){var a=o.value;"Once"!=a.options.frequency&&n.push(a),a.callback(e,t)}}catch(e){r={error:e}}finally{try{o&&!o.done&&(s=i.return)&&s.call(i)}finally{if(r)throw r.error}}this.interceptors.preResolution.setAll(e,n)}},e.prototype.executePostResolutionInterceptor=function(e,t,r){var s,n;if(this.interceptors.postResolution.has(e)){var i=[];try{for(var o=aa(this.interceptors.postResolution.getAll(e)),a=o.next();!a.done;a=o.next()){var c=a.value;"Once"!=c.options.frequency&&i.push(c),c.callback(e,t,r)}}catch(e){s={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}this.interceptors.postResolution.setAll(e,i)}},e.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===ra.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var r,s=e.options.lifecycle===ra.Singleton,n=e.options.lifecycle===ra.ContainerScoped,i=s||n;return r=ma(e.provider)?e.provider.useValue:ga(e.provider)?i?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):la(e.provider)?i?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):da(e.provider)?e.provider.useFactory(this):this.construct(e.provider,t),e.options.lifecycle===ra.ResolutionScoped&&t.scopedResolutions.set(e,r),r},e.prototype.resolveAll=function(e,t){var r=this;void 0===t&&(t=new va),this.ensureNotDisposed();var s=this.getAllRegistrations(e);if(!s&&pa(e))throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"');if(this.executePreResolutionInterceptor(e,"All"),s){var n=s.map((function(e){return r.resolveRegistration(e,t)}));return this.executePostResolutionInterceptor(e,n,"All"),n}var i=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,i,"All"),i},e.prototype.isRegistered=function(e,t){return void 0===t&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},e.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},e.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var r=aa(this._registry.entries()),s=r.next();!s.done;s=r.next()){var n=ca(s.value,2),i=n[0],o=n[1];this._registry.setAll(i,o.filter((function(e){return!ma(e.provider)})).map((function(e){return e.instance=void 0,e})))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.createChildContainer=function(){var t,r;this.ensureNotDisposed();var s=new e(this);try{for(var n=aa(this._registry.entries()),i=n.next();!i.done;i=n.next()){var o=ca(i.value,2),a=o[0],c=o[1];c.some((function(e){return e.options.lifecycle===ra.ContainerScoped}))&&s._registry.setAll(a,c.map((function(e){return e.options.lifecycle===ra.ContainerScoped?{provider:e.provider,options:e.options}:e})))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return s},e.prototype.beforeResolution=function(e,t,r){void 0===r&&(r={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:r})},e.prototype.afterResolution=function(e,t,r){void 0===r&&(r={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:r})},e.prototype.dispose=function(){return ia(this,void 0,void 0,(function(){var e;return oa(this,(function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach((function(t){var r=t.dispose();r&&e.push(r)})),[4,Promise.all(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},e.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},e.prototype.construct=function(e,t){var r=this;if(e instanceof ha)return e.createProxy((function(e){return r.resolve(e,t)}));var s,n=function(){var s=Ta.get(e);if(!s||0===s.length){if(0===e.length)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var n=s.map(r.resolveParams(t,e));return new(e.bind.apply(e,ua([void 0],n)))}();return"function"!=typeof(s=n).dispose||s.dispose.length>0||this.disposables.add(n),n},e.prototype.resolveParams=function(e,t){var r=this;return function(s,n){var i,o,a,c;try{return"object"==typeof(c=s)&&"token"in c&&"multiple"in c?fa(s)?s.multiple?(i=r.resolve(s.transform)).transform.apply(i,ua([r.resolveAll(s.token)],s.transformArgs)):(o=r.resolve(s.transform)).transform.apply(o,ua([r.resolve(s.token,e)],s.transformArgs)):s.multiple?r.resolveAll(s.token):r.resolve(s.token,e):fa(s)?(a=r.resolve(s.transform,e)).transform.apply(a,ua([r.resolve(s.token,e)],s.transformArgs)):r.resolve(s,e)}catch(e){throw new Error(Sa(t,n,e))}}},e.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},e}(),_a=new Ia;var Aa="injectionTokens";const Ra=function(){return function(e){Ta.set(e,function(e){var t=Reflect.getMetadata("design:paramtypes",e)||[],r=Reflect.getOwnMetadata(Aa,e)||{};return Object.keys(r).forEach((function(e){t[+e]=r[e]})),t}(e))}};if("undefined"==typeof Reflect||!Reflect.getMetadata)throw new Error("tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.");var Pa;class ka{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}}wr([gr({type:ke.ObjectIdentifier})],ka.prototype,"attrId",void 0),wr([gr({type:ke.Any,repeated:"set"})],ka.prototype,"attrValues",void 0);let Ba=Pa=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Pa.prototype)}};var Oa;Ba=Pa=wr([fr({type:Pe.Sequence,itemType:ka})],Ba);let xa=Oa=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Oa.prototype)}};xa=Oa=wr([fr({type:Pe.Sequence,itemType:Si})],xa);class Na{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],Na.prototype,"certId",void 0),wr([gr({type:ke.Any,context:0})],Na.prototype,"certValue",void 0);class Da{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],Da.prototype,"crlId",void 0),wr([gr({type:ke.Any,context:0})],Da.prototype,"crltValue",void 0);class La extends Mt{}class Ma{constructor(e={}){this.encryptionAlgorithm=new fn,this.encryptedData=new La,Object.assign(this,e)}}var Ua,ja;wr([gr({type:fn})],Ma.prototype,"encryptionAlgorithm",void 0),wr([gr({type:La})],Ma.prototype,"encryptedData",void 0),function(e){e[e.v1=0]="v1"}(ja||(ja={}));class Ha extends Mt{}let Fa=Ua=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Ua.prototype)}};Fa=Ua=wr([fr({type:Pe.Sequence,itemType:rn})],Fa);class za{constructor(e={}){this.version=ja.v1,this.privateKeyAlgorithm=new fn,this.privateKey=new Ha,Object.assign(this,e)}}wr([gr({type:ke.Integer})],za.prototype,"version",void 0),wr([gr({type:fn})],za.prototype,"privateKeyAlgorithm",void 0),wr([gr({type:Ha})],za.prototype,"privateKey",void 0),wr([gr({type:Fa,implicit:!0,context:0,optional:!0})],za.prototype,"attributes",void 0);let Va=class extends za{};Va=wr([fr({type:Pe.Sequence})],Va);let qa=class extends Ma{};qa=wr([fr({type:Pe.Sequence})],qa);class Ka{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],Ka.prototype,"secretTypeId",void 0),wr([gr({type:ke.Any,context:0})],Ka.prototype,"secretValue",void 0);class $a{constructor(e={}){this.mac=new Yo,this.macSalt=new Mt,this.iterations=1,Object.assign(this,e)}}wr([gr({type:Yo})],$a.prototype,"mac",void 0),wr([gr({type:Mt})],$a.prototype,"macSalt",void 0),wr([gr({type:ke.Integer,defaultValue:1})],$a.prototype,"iterations",void 0);class Wa{constructor(e={}){this.version=3,this.authSafe=new Si,this.macData=new $a,Object.assign(this,e)}}var Ga;wr([gr({type:ke.Integer})],Wa.prototype,"version",void 0),wr([gr({type:Si})],Wa.prototype,"authSafe",void 0),wr([gr({type:$a,optional:!0})],Wa.prototype,"macData",void 0);class Ya{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:ke.ObjectIdentifier})],Ya.prototype,"bagId",void 0),wr([gr({type:ke.Any,context:0})],Ya.prototype,"bagValue",void 0),wr([gr({type:ka,repeated:"set",optional:!0})],Ya.prototype,"bagAttributes",void 0);let Xa=Ga=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Ga.prototype)}};var Ja,Qa,Za;Xa=Ga=wr([fr({type:Pe.Sequence,itemType:Ya})],Xa);const ec="1.2.840.113549.1.9",tc=`${ec}.7`,rc=`${ec}.14`;let sc=class extends _r{constructor(e={}){super(e)}toString(){return{}.toString(),this.ia5String||super.toString()}};wr([gr({type:ke.IA5String})],sc.prototype,"ia5String",void 0),sc=wr([fr({type:Pe.Choice})],sc);let nc=class extends Si{};nc=wr([fr({type:Pe.Sequence})],nc);let ic=class extends Wa{};ic=wr([fr({type:Pe.Sequence})],ic);let oc=class extends Ma{};oc=wr([fr({type:Pe.Sequence})],oc);let ac=class{constructor(e=""){this.value=e}toString(){return this.value}};wr([gr({type:ke.IA5String})],ac.prototype,"value",void 0),ac=wr([fr({type:Pe.Choice})],ac);let cc=class extends sc{};cc=wr([fr({type:Pe.Choice})],cc);let uc=class extends _r{};uc=wr([fr({type:Pe.Choice})],uc);let lc=class{constructor(e=new Date){this.value=e}};wr([gr({type:ke.GeneralizedTime})],lc.prototype,"value",void 0),lc=wr([fr({type:Pe.Choice})],lc);let dc=class extends _r{};dc=wr([fr({type:Pe.Choice})],dc);let hc=class{constructor(e="M"){this.value=e}toString(){return this.value}};wr([gr({type:ke.PrintableString})],hc.prototype,"value",void 0),hc=wr([fr({type:Pe.Choice})],hc);let pc=class{constructor(e=""){this.value=e}toString(){return this.value}};wr([gr({type:ke.PrintableString})],pc.prototype,"value",void 0),pc=wr([fr({type:Pe.Choice})],pc);let fc=class extends pc{};fc=wr([fr({type:Pe.Choice})],fc);let gc=class extends _r{};gc=wr([fr({type:Pe.Choice})],gc);let mc=class{constructor(e=""){this.value=e}toString(){return this.value}};wr([gr({type:ke.ObjectIdentifier})],mc.prototype,"value",void 0),mc=wr([fr({type:Pe.Choice})],mc);let yc=class extends mn{};yc=wr([fr({type:Pe.Choice})],yc);let bc=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};wr([gr({type:ke.Integer})],bc.prototype,"value",void 0),bc=wr([fr({type:Pe.Choice})],bc);let vc=class extends Un{};vc=wr([fr({type:Pe.Sequence})],vc);let Sc=class extends _r{};Sc=wr([fr({type:Pe.Choice})],Sc);let wc=Ja=class extends Sn{constructor(e){super(e),Object.setPrototypeOf(this,Ja.prototype)}};wc=Ja=wr([fr({type:Pe.Sequence})],wc);let Ec=Qa=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Qa.prototype)}};Ec=Qa=wr([fr({type:Pe.Set,itemType:Ln})],Ec);let Cc=class{constructor(e=""){this.value=e}toString(){return this.value}};wr([gr({type:ke.BmpString})],Cc.prototype,"value",void 0),Cc=wr([fr({type:Pe.Choice})],Cc);let Tc=class extends fn{};Tc=wr([fr({type:Pe.Sequence})],Tc);let Ic=Za=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,Za.prototype)}};var _c;Ic=Za=wr([fr({type:Pe.Sequence,itemType:Tc})],Ic);let Ac=_c=class extends vr{constructor(e){super(e),Object.setPrototypeOf(this,_c.prototype)}};Ac=_c=wr([fr({type:Pe.Sequence,itemType:rn})],Ac);class Rc{constructor(e={}){this.version=0,this.subject=new Br,this.subjectPKInfo=new gn,this.attributes=new Ac,Object.assign(this,e)}}wr([gr({type:ke.Integer})],Rc.prototype,"version",void 0),wr([gr({type:Br})],Rc.prototype,"subject",void 0),wr([gr({type:gn})],Rc.prototype,"subjectPKInfo",void 0),wr([gr({type:Ac,implicit:!0,context:0})],Rc.prototype,"attributes",void 0);class Pc{constructor(e={}){this.certificationRequestInfo=new Rc,this.signatureAlgorithm=new fn,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}wr([gr({type:Rc})],Pc.prototype,"certificationRequestInfo",void 0),wr([gr({type:fn})],Pc.prototype,"signatureAlgorithm",void 0),wr([gr({type:ke.BitString})],Pc.prototype,"signature",void 0);const kc="crypto.algorithm";class Bc{getAlgorithms(){return _a.resolveAll(kc)}toAsnAlgorithm(e){for(const t of this.getAlgorithms()){const r=t.toAsnAlgorithm(e);if(r)return r}if(/^[0-9.]+$/.test(e.name)){const t=new fn({algorithm:e.name});if("parameters"in e){const r=e;t.parameters=r.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(const t of this.getAlgorithms()){const r=t.toWebAlgorithm(e);if(r)return r}return{name:e.algorithm,parameters:e.parameters}}}const Oc="crypto.algorithmProvider";var xc;_a.registerSingleton(Oc,Bc);const Nc="1.3.36.3.3.2.8.1.1",Dc=`${Nc}.1`,Lc=`${Nc}.2`,Mc=`${Nc}.3`,Uc=`${Nc}.4`,jc=`${Nc}.5`,Hc=`${Nc}.6`,Fc=`${Nc}.7`,zc=`${Nc}.8`,Vc=`${Nc}.9`,qc=`${Nc}.10`,Kc=`${Nc}.11`,$c=`${Nc}.12`,Wc=`${Nc}.13`,Gc=`${Nc}.14`,Yc="brainpoolP160r1",Xc="brainpoolP160t1",Jc="brainpoolP192r1",Qc="brainpoolP192t1",Zc="brainpoolP224r1",eu="brainpoolP224t1",tu="brainpoolP256r1",ru="brainpoolP256t1",su="brainpoolP320r1",nu="brainpoolP320t1",iu="brainpoolP384r1",ou="brainpoolP384t1",au="brainpoolP512r1",cu="brainpoolP512t1",uu="ECDSA";let lu=xc=class{toAsnAlgorithm(e){if(e.name.toLowerCase()===uu.toLowerCase())if("hash"in e){switch(("string"==typeof e.hash?e.hash:e.hash.name).toLowerCase()){case"sha-1":return ho;case"sha-256":return po;case"sha-384":return fo;case"sha-512":return go}}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=ao;break;case"K-256":t=xc.SECP256K1;break;case"P-384":t=co;break;case"P-521":t=uo;break;case Yc:t=Dc;break;case Xc:t=Lc;break;case Jc:t=Mc;break;case Qc:t=Uc;break;case Zc:t=jc;break;case eu:t=Hc;break;case tu:t=Fc;break;case ru:t=zc;break;case su:t=Vc;break;case nu:t=qc;break;case iu:t=Kc;break;case ou:t=$c;break;case au:t=Wc;break;case cu:t=Gc}if(t)return new fn({algorithm:to,parameters:Sr.serialize(new So({namedCurve:t}))})}return null}toWebAlgorithm(e){switch(e.algorithm){case ro:return{name:uu,hash:{name:"SHA-1"}};case no:return{name:uu,hash:{name:"SHA-256"}};case io:return{name:uu,hash:{name:"SHA-384"}};case oo:return{name:uu,hash:{name:"SHA-512"}};case to:if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(Sr.parse(e.parameters,So).namedCurve){case ao:return{name:uu,namedCurve:"P-256"};case xc.SECP256K1:return{name:uu,namedCurve:"K-256"};case co:return{name:uu,namedCurve:"P-384"};case uo:return{name:uu,namedCurve:"P-521"};case Dc:return{name:uu,namedCurve:Yc};case Lc:return{name:uu,namedCurve:Xc};case Mc:return{name:uu,namedCurve:Jc};case Uc:return{name:uu,namedCurve:Qc};case jc:return{name:uu,namedCurve:Zc};case Hc:return{name:uu,namedCurve:eu};case Fc:return{name:uu,namedCurve:tu};case zc:return{name:uu,namedCurve:ru};case Vc:return{name:uu,namedCurve:su};case qc:return{name:uu,namedCurve:nu};case Kc:return{name:uu,namedCurve:iu};case $c:return{name:uu,namedCurve:ou};case Wc:return{name:uu,namedCurve:au};case Gc:return{name:uu,namedCurve:cu}}}return null}};lu.SECP256K1="1.3.132.0.10",lu=xc=wr([Ra()],lu),_a.registerSingleton(kc,lu);const du=Symbol("name"),hu=Symbol("value");class pu{constructor(e,t={},r=""){this[du]=e,this[hu]=r;for(const e in t)this[e]=t[e]}}pu.NAME=du,pu.VALUE=hu;class fu{static toTextObject(e){const t=new pu("Algorithm Identifier",{},gu.toString(e.algorithm));if(e.parameters)switch(e.algorithm){case to:{const r=(new lu).toWebAlgorithm(e);r&&"namedCurve"in r?t["Named Curve"]=r.namedCurve:t.Parameters=e.parameters;break}default:t.Parameters=e.parameters}return t}}class gu{static toString(e){const t=this.items[e];return t||e}}gu.items={[Mo]:"sha1",[Uo]:"sha224",[jo]:"sha256",[Ho]:"sha384",[Fo]:"sha512",[To]:"rsaEncryption",[ko]:"sha1WithRSAEncryption",[Bo]:"sha224WithRSAEncryption",[Oo]:"sha256WithRSAEncryption",[xo]:"sha384WithRSAEncryption",[No]:"sha512WithRSAEncryption",[to]:"ecPublicKey",[ro]:"ecdsaWithSHA1",[so]:"ecdsaWithSHA224",[no]:"ecdsaWithSHA256",[io]:"ecdsaWithSHA384",[oo]:"ecdsaWithSHA512",[Bs]:"TLS WWW server authentication",[Os]:"TLS WWW client authentication",[xs]:"Code Signing",[Ns]:"E-mail Protection",[Ds]:"Time Stamping",[Ls]:"OCSP Signing",[Ji]:"Signed Data"};class mu{static serialize(e){return this.serializeObj(e).join("\n")}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,t=0){const r=[];let s=this.pad(t++),i="";const o=e[pu.VALUE];o&&(i=` ${o}`),r.push(`${s}${e[pu.NAME]}:${i}`),s=this.pad(t);for(const i in e){if("symbol"==typeof i)continue;const o=e[i],a=i?`${i}: `:"";if("string"==typeof o||"number"==typeof o||"boolean"==typeof o)r.push(`${s}${a}${o}`);else if(o instanceof Date)r.push(`${s}${a}${o.toUTCString()}`);else if(Array.isArray(o))for(const e of o)e[pu.NAME]=i,r.push(...this.serializeObj(e,t));else if(o instanceof pu)o[pu.NAME]=i,r.push(...this.serializeObj(o,t));else if(n.isBufferSource(o))i?(r.push(`${s}${a}`),r.push(...this.serializeBufferSource(o,t+1))):r.push(...this.serializeBufferSource(o,t));else{if(!("toTextObject"in o))throw new TypeError("Cannot serialize data in text format. Unsupported type.");{const e=o.toTextObject();e[pu.NAME]=i,r.push(...this.serializeObj(e,t))}}}return r}static serializeBufferSource(e,t=0){const r=this.pad(t),s=n.toUint8Array(e),i=[];for(let e=0;e<s.length;){const t=[];for(let r=0;r<16&&e<s.length;r++){8===r&&t.push("");const n=s[e++].toString(16).padStart(2,"0");t.push(n)}i.push(`${r}${t.join(" ")}`)}return i}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}}mu.oidSerializer=gu,mu.algorithmSerializer=fu;class yu{constructor(...e){if(1===e.length){const t=e[0];this.rawData=Sr.serialize(t),this.onInit(t)}else{const t=Sr.parse(e[0],e[1]);this.rawData=n.toArrayBuffer(e[0]),this.onInit(t)}}equal(e){return e instanceof yu&&h(e.rawData,this.rawData)}toString(e="text"){switch(e){case"asn":return Sr.toString(this.rawData);case"text":return mu.serialize(this.toTextObject());case"hex":return d.ToHex(this.rawData);case"base64":return d.ToBase64(this.rawData);case"base64url":return d.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){const e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new pu(this.getTextName(),{},e)}}yu.NAME="ASN";class bu extends yu{constructor(...e){let t;t=n.isBufferSource(e[0])?n.toArrayBuffer(e[0]):Sr.serialize(new vn({extnID:e[0],critical:e[1],extnValue:new Mt(n.toArrayBuffer(e[2]))})),super(t,vn)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[pu.NAME]===bu.NAME&&(e[pu.NAME]=gu.toString(this.type)),e}}var vu;class Su{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&void 0!==e.extractable}constructor(){this.items=new Map,this[vu]="CryptoProvider","undefined"!=typeof self&&"undefined"!=typeof crypto?this.set(Su.DEFAULT,crypto):"undefined"!=typeof global&&global.crypto&&global.crypto.subtle&&this.set(Su.DEFAULT,global.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=Su.DEFAULT){const t=this.items.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if("string"==typeof e){if(!t)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(Su.DEFAULT,e);return this}}vu=Symbol.toStringTag,Su.DEFAULT="default";const wu=new Su,Eu=/^[0-2](?:\.[1-9][0-9]*)+$/;class Cu{constructor(e={}){this.items={};for(const t in e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return t=e,new RegExp(Eu).test(t)?e:this.get(e);var t}register(e,t){this.items[e]=t,this.items[t]=e}}const Tu=new Cu;function Iu(e,t){return`\\${d.ToHex(d.FromUtf8String(t)).toUpperCase()}`}Tu.register("CN","2.5.4.3"),Tu.register("L","2.5.4.7"),Tu.register("ST","2.5.4.8"),Tu.register("O","2.5.4.10"),Tu.register("OU","2.5.4.11"),Tu.register("C","2.5.4.6"),Tu.register("DC","0.9.2342.19200300.100.1.25"),Tu.register("E","1.2.840.113549.1.9.1"),Tu.register("G","2.5.4.42"),Tu.register("I","2.5.4.43"),Tu.register("SN","2.5.4.4"),Tu.register("T","2.5.4.12");class _u{static isASCII(e){for(let t=0;t<e.length;t++){if(e.charCodeAt(t)>255)return!1}return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,t={}){this.extraNames=new Cu,this.asn=new Br;for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const r=t[e];this.extraNames.register(e,r)}"string"==typeof e?this.asn=this.fromString(e):e instanceof Br?this.asn=e:n.isBufferSource(e)?this.asn=Sr.parse(e,Br):this.asn=this.fromJSON(e)}getField(e){const t=this.extraNames.findId(e)||Tu.findId(e),r=[];for(const e of this.asn)for(const s of e)s.type===t&&r.push(s.value.toString());return r}getName(e){return this.extraNames.get(e)||Tu.get(e)}toString(){return this.asn.map((e=>e.map((e=>`${this.getName(e.type)||e.type}=${e.value.anyValue?`#${d.ToHex(e.value.anyValue)}`:e.value.toString().replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,Iu)}`)).join("+"))).join(", ")}toJSON(){var e;const t=[];for(const r of this.asn){const s={};for(const t of r){const r=this.getName(t.type)||t.type;null!==(e=s[r])&&void 0!==e||(s[r]=[]),s[r].push(t.value.anyValue?`#${d.ToHex(t.value.anyValue)}`:t.value.toString())}t.push(s)}return t}fromString(e){const t=new Br,r=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g;let s=null,n=",";for(;s=r.exec(`${e},`);){let[,e,r]=s;const i=r[r.length-1];","!==i&&"+"!==i||(r=r.slice(0,r.length-1),s[3]=i);const o=s[3];e=this.getTypeOid(e);const a=this.createAttribute(e,r);"+"===n?t[t.length-1].push(a):t.push(new Pr([a])),n=o}return t}fromJSON(e){const t=new Br;for(const r of e){const e=new Pr;for(const t in r){const s=this.getTypeOid(t),n=r[t];for(const t of n){const r=this.createAttribute(s,t);e.push(r)}}t.push(e)}return t}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,t){const r=new Rr({type:e});if("object"==typeof t)for(const e in t)switch(e){case"ia5String":r.value.ia5String=t[e];break;case"utf8String":r.value.utf8String=t[e];break;case"universalString":r.value.universalString=t[e];break;case"bmpString":r.value.bmpString=t[e];break;case"printableString":r.value.printableString=t[e]}else if("#"===t[0])r.value.anyValue=d.FromHex(t.slice(1));else{const s=this.processStringValue(t);e===this.getName("E")||e===this.getName("DC")?r.value.ia5String=s:_u.isPrintableString(s)?r.value.printableString=s:r.value.utf8String=s}return r}processStringValue(e){const t=/"(.*?[^\\])?"/.exec(e);return t&&(e=t[1]),e.replace(/\\0a/gi,"\n").replace(/\\0d/gi,"\r").replace(/\\0g/gi,"\t").replace(/\\(.)/g,"$1")}toArrayBuffer(){return Sr.serialize(this.asn)}async getThumbprint(...e){var t;let r,s="SHA-1";return e.length>=1&&!(null===(t=e[0])||void 0===t?void 0:t.subtle)?(s=e[0]||s,r=e[1]||wu.get()):r=e[0]||wu.get(),await r.subtle.digest(s,this.toArrayBuffer())}}const Au="Cannot initialize GeneralName from ASN.1 data.",Ru=`${Au} Unsupported string format in use.`,Pu=`${Au} Value doesn't match to GUID regular expression.`,ku=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,Bu="1.3.6.1.4.1.311.25.1",Ou="1.3.6.1.4.1.311.20.2.3",xu="dns",Nu="dn",Du="email",Lu="ip",Mu="url",Uu="guid",ju="upn",Hu="id";class Fu extends yu{constructor(...e){let t;if(2===e.length)switch(e[0]){case Nu:{const r=new _u(e[1]).toArrayBuffer(),s=Sr.parse(r,Br);t=new Dr({directoryName:s});break}case xu:t=new Dr({dNSName:e[1]});break;case Du:t=new Dr({rfc822Name:e[1]});break;case Uu:{const r=new RegExp(ku,"i").exec(e[1]);if(!r)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");const s=r.slice(1).map(((e,t)=>t<3?d.ToHex(new Uint8Array(d.FromHex(e)).reverse()):e)).join("");t=new Dr({otherName:new xr({typeId:Bu,value:Sr.serialize(new Mt(d.FromHex(s)))})});break}case Lu:t=new Dr({iPAddress:e[1]});break;case Hu:t=new Dr({registeredID:e[1]});break;case ju:t=new Dr({otherName:new xr({typeId:Ou,value:Sr.serialize(Gt.toASN(e[1]))})});break;case Mu:t=new Dr({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else t=n.isBufferSource(e[0])?Sr.parse(e[0],Dr):e[0];super(t)}onInit(e){if(null!=e.dNSName)this.type=xu,this.value=e.dNSName;else if(null!=e.rfc822Name)this.type=Du,this.value=e.rfc822Name;else if(null!=e.iPAddress)this.type=Lu,this.value=e.iPAddress;else if(null!=e.uniformResourceIdentifier)this.type=Mu,this.value=e.uniformResourceIdentifier;else if(null!=e.registeredID)this.type=Hu,this.value=e.registeredID;else if(null!=e.directoryName)this.type=Nu,this.value=new _u(e.directoryName).toString();else{if(null==e.otherName)throw new Error(Ru);if(e.otherName.typeId===Bu){this.type=Uu;const t=Sr.parse(e.otherName.value,Mt),r=new RegExp(ku,"i").exec(d.ToHex(t));if(!r)throw new Error(Pu);this.value=r.slice(1).map(((e,t)=>t<3?d.ToHex(new Uint8Array(d.FromHex(e)).reverse()):e)).join("-")}else{if(e.otherName.typeId!==Ou)throw new Error(Ru);this.type=ju,this.value=Sr.parse(e.otherName.value,_r).toString()}}}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case Nu:case xu:case Uu:case Lu:case Hu:case ju:case Mu:e=this.type.toUpperCase();break;case Du:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let t=this.value;return this.type===Hu&&(t=gu.toString(t)),new pu(e,void 0,t)}}class zu extends yu{constructor(e){let t;if(e instanceof es)t=e;else if(Array.isArray(e)){const r=[];for(const t of e)if(t instanceof Dr)r.push(t);else{const e=Sr.parse(new Fu(t.type,t.value).rawData,Dr);r.push(e)}t=new es(r)}else{if(!n.isBufferSource(e))throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");t=Sr.parse(e,es)}super(t)}onInit(e){const t=[];for(const r of e){let e=null;try{e=new Fu(r)}catch{continue}t.push(e)}this.items=t}toJSON(){return this.items.map((e=>e.toJSON()))}toTextObject(){const e=super.toTextObjectEmpty();for(const t of this.items){const r=t.toTextObject();let s=e[r[pu.NAME]];Array.isArray(s)||(s=[],e[r[pu.NAME]]=s),s.push(r)}return e}}zu.NAME="GeneralNames";const Vu="-{5}",qu="\\n",Ku="\\n",$u=`${`${Vu}BEGIN (${`[^${qu}]+`}(?=${Vu}))${Vu}`}${Ku}(?:((?:${`[^:${qu}]+`}: ${`(?:[^${qu}]+${Ku}(?: +[^${qu}]+${Ku})*)`})+))?${Ku}?(${`(?:[a-zA-Z0-9=+/]+${Ku})+`})${`${Vu}END \\1${Vu}`}`;class Wu{static isPem(e){return"string"==typeof e&&new RegExp($u,"g").test(e)}static decodeWithHeaders(e){e=e.replace(/\r/g,"");const t=new RegExp($u,"g"),r=[];let s=null;for(;s=t.exec(e);){const e=s[3].replace(new RegExp(`[${qu}]+`,"g"),""),t={type:s[1],headers:[],rawData:d.FromBase64(e)},n=s[2];if(n){const e=n.split(new RegExp(Ku,"g"));let r=null;for(const s of e){const[e,n]=s.split(/:(.*)/);if(void 0===n){if(!r)throw new Error("Cannot parse PEM string. Incorrect header value");r.value+=e.trim()}else r&&t.headers.push(r),r={key:e,value:n.trim()}}r&&t.headers.push(r)}r.push(t)}return r}static decode(e){return this.decodeWithHeaders(e).map((e=>e.rawData))}static decodeFirst(e){const t=this.decode(e);if(!t.length)throw new RangeError("PEM string doesn't contain any objects");return t[0]}static encode(e,t){if(Array.isArray(e)){const r=new Array;return t?e.forEach((e=>{if(!n.isBufferSource(e))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");r.push(this.encodeStruct({type:t,rawData:n.toArrayBuffer(e)}))})):e.forEach((e=>{if(!("type"in e))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");r.push(this.encodeStruct(e))})),r.join("\n")}if(!t)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:t,rawData:n.toArrayBuffer(e)})}static encodeStruct(e){var t;const r=e.type.toLocaleUpperCase(),s=[];if(s.push(`-----BEGIN ${r}-----`),null===(t=e.headers)||void 0===t?void 0:t.length){for(const t of e.headers)s.push(`${t.key}: ${t.value}`);s.push("")}const n=d.ToBase64(e.rawData);let i,o=0;const a=Array();for(;o<n.length&&(n.length-o<64?i=n.substring(o):(i=n.substring(o,o+64),o+=64),0!==i.length)&&(a.push(i),!(i.length<64)););return s.push(...a),s.push(`-----END ${r}-----`),s.join("\n")}}Wu.CertificateTag="CERTIFICATE",Wu.CrlTag="CRL",Wu.CertificateRequestTag="CERTIFICATE REQUEST",Wu.PublicKeyTag="PUBLIC KEY",Wu.PrivateKeyTag="PRIVATE KEY";class Gu extends yu{static isAsnEncoded(e){return n.isBufferSource(e)||"string"==typeof e}static toArrayBuffer(e){if("string"==typeof e){if(Wu.isPem(e))return Wu.decode(e)[0];if(d.isHex(e))return d.FromHex(e);if(d.isBase64(e))return d.FromBase64(e);if(d.isBase64Url(e))return d.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}{const t=d.ToBinary(e);return Wu.isPem(t)?Wu.decode(t)[0]:d.isHex(t)?d.FromHex(t):d.isBase64(t)?d.FromBase64(t):d.isBase64Url(t)?d.FromBase64Url(t):n.toArrayBuffer(e)}}constructor(...e){Gu.isAsnEncoded(e[0])?super(Gu.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){return"pem"===e?Wu.encode(this.rawData,this.tag):super.toString(e)}}class Yu extends Gu{static async create(e,t=wu.get()){if(e instanceof Yu)return e;if(Su.isCryptoKey(e)){if("public"!==e.type)throw new TypeError("Public key is required");const r=await t.subtle.exportKey("spki",e);return new Yu(r)}if(e.publicKey)return e.publicKey;if(n.isBufferSource(e))return new Yu(e);throw new TypeError("Unsupported PublicKeyType")}constructor(e){Gu.isAsnEncoded(e)?super(e,gn):super(e),this.tag=Wu.PublicKeyTag}async export(...e){let t,r=["verify"],s={hash:"SHA-256",...this.algorithm};e.length>1?(s=e[0]||s,r=e[1]||r,t=e[2]||wu.get()):t=e[0]||wu.get();let n=this.rawData;const i=Sr.parse(this.rawData,gn);return i.algorithm.algorithm===Ao&&(n=function(e,t){return e.algorithm=new fn({algorithm:To,parameters:null}),t=Sr.serialize(e),t}(i,n)),t.subtle.importKey("spki",n,s,!0,r)}onInit(e){const t=_a.resolve(Oc),r=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case To:{const t=Sr.parse(e.subjectPublicKey,ea),s=n.toUint8Array(t.modulus);r.publicExponent=n.toUint8Array(t.publicExponent),r.modulusLength=(s[0]?s:s.slice(1)).byteLength<<3;break}}}async getThumbprint(...e){var t;let r,s="SHA-1";return e.length>=1&&!(null===(t=e[0])||void 0===t?void 0:t.subtle)?(s=e[0]||s,r=e[1]||wu.get()):r=e[0]||wu.get(),await r.subtle.digest(s,this.rawData)}async getKeyIdentifier(...e){let t,r="SHA-1";1===e.length?"string"==typeof e[0]?(r=e[0],t=wu.get()):t=e[0]:2===e.length?(r=e[0],t=e[1]):t=wu.get();const s=Sr.parse(this.rawData,gn);return await t.subtle.digest(r,s.subjectPublicKey)}toTextObject(){const e=this.toTextObjectEmpty(),t=Sr.parse(this.rawData,gn);if(e.Algorithm=mu.serializeAlgorithm(t.algorithm),t.algorithm.algorithm===to)e["EC Point"]=t.subjectPublicKey;else e["Raw Data"]=t.subjectPublicKey;return e}}class Xu extends bu{static async create(e,t=!1,r=wu.get()){if("name"in e&&"serialNumber"in e)return new Xu(e,t);const s=await Yu.create(e,r),n=await s.getKeyIdentifier(r);return new Xu(d.ToHex(n),t)}constructor(...e){if(n.isBufferSource(e[0]))super(e[0]);else if("string"==typeof e[0]){const t=new Xr({keyIdentifier:new Yr(d.FromHex(e[0]))});super(Gr,e[1],Sr.serialize(t))}else{const t=e[0],r=t.name instanceof zu?Sr.parse(t.name.rawData,es):t.name,s=new Xr({authorityCertIssuer:r,authorityCertSerialNumber:d.FromHex(t.serialNumber)});super(Gr,e[1],Sr.serialize(s))}}onInit(e){super.onInit(e);const t=Sr.parse(e.extnValue,Xr);t.keyIdentifier&&(this.keyId=d.ToHex(t.keyIdentifier)),(t.authorityCertIssuer||t.authorityCertSerialNumber)&&(this.certId={name:t.authorityCertIssuer||[],serialNumber:t.authorityCertSerialNumber?d.ToHex(t.authorityCertSerialNumber):""})}toTextObject(){const e=this.toTextObjectWithoutValue(),t=Sr.parse(this.value,Xr);return t.authorityCertIssuer&&(e["Authority Issuer"]=new zu(t.authorityCertIssuer).toTextObject()),t.authorityCertSerialNumber&&(e["Authority Serial Number"]=t.authorityCertSerialNumber),t.keyIdentifier&&(e[""]=t.keyIdentifier),e}}Xu.NAME="Authority Key Identifier";class Ju extends bu{constructor(...e){if(n.isBufferSource(e[0])){super(e[0]);const t=Sr.parse(this.value,Qr);this.ca=t.cA,this.pathLength=t.pathLenConstraint}else{const t=new Qr({cA:e[0],pathLenConstraint:e[1]});super(Jr,e[2],Sr.serialize(t)),this.ca=e[0],this.pathLength=e[1]}}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),void 0!==this.pathLength&&(e["Path Length"]=this.pathLength),e}}var Qu,Zu;Ju.NAME="Basic Constraints",function(e){e.serverAuth="1.3.6.1.5.5.7.3.1",e.clientAuth="1.3.6.1.5.5.7.3.2",e.codeSigning="1.3.6.1.5.5.7.3.3",e.emailProtection="1.3.6.1.5.5.7.3.4",e.timeStamping="1.3.6.1.5.5.7.3.8",e.ocspSigning="1.3.6.1.5.5.7.3.9"}(Qu||(Qu={}));class el extends bu{constructor(...e){if(n.isBufferSource(e[0])){super(e[0]);const t=Sr.parse(this.value,ks);this.usages=t.map((e=>e))}else{const t=new ks(e[0]);super(Ps,e[1],Sr.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.usages.map((e=>gu.toString(e))).join(", "),e}}el.NAME="Extended Key Usages",function(e){e[e.digitalSignature=1]="digitalSignature",e[e.nonRepudiation=2]="nonRepudiation",e[e.keyEncipherment=4]="keyEncipherment",e[e.dataEncipherment=8]="dataEncipherment",e[e.keyAgreement=16]="keyAgreement",e[e.keyCertSign=32]="keyCertSign",e[e.cRLSign=64]="cRLSign",e[e.encipherOnly=128]="encipherOnly",e[e.decipherOnly=256]="decipherOnly"}(Zu||(Zu={}));class tl extends bu{constructor(...e){if(n.isBufferSource(e[0])){super(e[0]);const t=Sr.parse(this.value,Ks);this.usages=t.toNumber()}else{const t=new Ks(e[0]);super(zs,e[1],Sr.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=Sr.parse(this.value,Ks);return e[""]=t.toJSON().join(", "),e}}tl.NAME="Key Usages";class rl extends bu{static async create(e,t=!1,r=wu.get()){const s=await Yu.create(e,r),n=await s.getKeyIdentifier(r);return new rl(d.ToHex(n),t)}constructor(...e){if(n.isBufferSource(e[0])){super(e[0]);const t=Sr.parse(this.value,an);this.keyId=d.ToHex(t)}else{const t="string"==typeof e[0]?d.FromHex(e[0]):e[0],r=new an(t);super(on,e[1],Sr.serialize(r)),this.keyId=d.ToHex(t)}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=Sr.parse(this.value,an);return e[""]=t,e}}rl.NAME="Subject Key Identifier";class sl extends bu{constructor(...e){n.isBufferSource(e[0])?super(e[0]):super(en,e[1],new zu(e[0]||[]).rawData)}onInit(e){super.onInit(e);const t=Sr.parse(e.extnValue,tn);this.names=new zu(t)}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(const r in t)e[r]=t[r];return e}}sl.NAME="Subject Alternative Name";class nl{static register(e,t){this.items.set(e,t)}static create(e){const t=new bu(e),r=this.items.get(t.type);return r?new r(e):t}}nl.items=new Map;class il extends bu{constructor(...e){var t;if(n.isBufferSource(e[0])){super(e[0]);const t=Sr.parse(this.value,hs);this.policies=t.map((e=>e.policyIdentifier))}else{const r=e[0],s=null!==(t=e[1])&&void 0!==t&&t,n=new hs(r.map((e=>new ds({policyIdentifier:e}))));super(is,s,Sr.serialize(n)),this.policies=r}}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map((e=>new pu("",{},gu.toString(e)))),e}}il.NAME="Certificate Policies",nl.register(is,il);class ol extends bu{constructor(...e){var t;if(n.isBufferSource(e[0]))super(e[0]);else if(Array.isArray(e[0])&&"string"==typeof e[0][0]){const t=e[0].map((e=>new Ss({distributionPoint:new vs({fullName:[new Dr({uniformResourceIdentifier:e})]})}))),r=new ws(t);super(ms,e[1],Sr.serialize(r))}else{const t=new ws(e[0]);super(ms,e[1],Sr.serialize(t))}null!==(t=this.distributionPoints)&&void 0!==t||(this.distributionPoints=[])}onInit(e){super.onInit(e);const t=Sr.parse(e.extnValue,ws);this.distributionPoints=t}toTextObject(){const e=this.toTextObjectWithoutValue();return e["Distribution Point"]=this.distributionPoints.map((e=>{var t;const r={};return e.distributionPoint&&(r[""]=null===(t=e.distributionPoint.fullName)||void 0===t?void 0:t.map((e=>new Fu(e).toString())).join(", ")),e.reasons&&(r.Reasons=e.reasons.toString()),e.cRLIssuer&&(r["CRL Issuer"]=e.cRLIssuer.map((e=>e.toString())).join(", ")),r})),e}}ol.NAME="CRL Distribution Points";class al extends bu{constructor(...e){var t,r,s,i;if(n.isBufferSource(e[0]))super(e[0]);else if(e[0]instanceof Wr){const t=new Wr(e[0]);super(Kr,e[1],Sr.serialize(t))}else{const t=e[0],r=new Wr;ul(r,t,jr,"ocsp"),ul(r,t,Hr,"caIssuers"),ul(r,t,Fr,"timeStamping"),ul(r,t,zr,"caRepository"),super(Kr,e[1],Sr.serialize(r))}null!==(t=this.ocsp)&&void 0!==t||(this.ocsp=[]),null!==(r=this.caIssuers)&&void 0!==r||(this.caIssuers=[]),null!==(s=this.timeStamping)&&void 0!==s||(this.timeStamping=[]),null!==(i=this.caRepository)&&void 0!==i||(this.caRepository=[])}onInit(e){super.onInit(e),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[];Sr.parse(e.extnValue,Wr).forEach((e=>{switch(e.accessMethod){case jr:this.ocsp.push(new Fu(e.accessLocation));break;case Hr:this.caIssuers.push(new Fu(e.accessLocation));break;case Fr:this.timeStamping.push(new Fu(e.accessLocation));break;case zr:this.caRepository.push(new Fu(e.accessLocation))}}))}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ocsp.length&&cl(e,"OCSP",this.ocsp),this.caIssuers.length&&cl(e,"CA Issuers",this.caIssuers),this.timeStamping.length&&cl(e,"Time Stamping",this.timeStamping),this.caRepository.length&&cl(e,"CA Repository",this.caRepository),e}}function cl(e,t,r){if(1===r.length)e[t]=r[0].toTextObject();else{const s=new pu("");r.forEach(((e,t)=>{const r=e.toTextObject(),n=`${r[pu.NAME]} ${t+1}`;let i=s[n];Array.isArray(i)||(i=[],s[n]=i),i.push(r)})),e[t]=s}}function ul(e,t,r,s){const n=t[s];if(n){(Array.isArray(n)?n:[n]).forEach((t=>{"string"==typeof t&&(t=new Fu("url",t)),e.push(new $r({accessMethod:r,accessLocation:Sr.parse(t.rawData,Dr)}))}))}}al.NAME="Authority Info Access";class ll extends yu{constructor(...e){let t;if(n.isBufferSource(e[0]))t=n.toArrayBuffer(e[0]);else{const r=e[0],s=Array.isArray(e[1])?e[1].map((e=>n.toArrayBuffer(e))):[];t=Sr.serialize(new rn({type:r,values:s}))}super(t,rn)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Value=this.values.map((e=>new pu("",{"":e}))),e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty();return e[pu.NAME]===ll.NAME&&(e[pu.NAME]=gu.toString(this.type)),e}}ll.NAME="Attribute";class dl extends ll{constructor(...e){var t;if(n.isBufferSource(e[0]))super(e[0]);else{const t=new Sc({printableString:e[0]});super(tc,[Sr.serialize(t)])}null!==(t=this.password)&&void 0!==t||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){const e=Sr.parse(this.values[0],Sc);this.password=e.toString()}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[pu.VALUE]=this.password,e}}dl.NAME="Challenge Password";class hl extends ll{constructor(...e){var t;if(n.isBufferSource(e[0]))super(e[0]);else{const t=e[0],r=new Sn;for(const e of t)r.push(Sr.parse(e.rawData,vn));super(rc,[Sr.serialize(r)])}null!==(t=this.items)&&void 0!==t||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){const e=Sr.parse(this.values[0],Sn);this.items=e.map((e=>nl.create(Sr.serialize(e))))}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.items.map((e=>e.toTextObject()));for(const r of t)e[r[pu.NAME]]=r;return e}}hl.NAME="Extensions";class pl{static register(e,t){this.items.set(e,t)}static create(e){const t=new ll(e),r=this.items.get(t.type);return r?new r(e):t}}pl.items=new Map;const fl="crypto.signatureFormatter";class gl{toAsnSignature(e,t){return n.toArrayBuffer(t)}toWebSignature(e,t){return n.toArrayBuffer(t)}}var ml;let yl=ml=class{static createPssParams(e,t){const r=ml.getHashAlgorithm(e);return r?new Go({hashAlgorithm:r,maskGenAlgorithm:new fn({algorithm:zo,parameters:Sr.serialize(r)}),saltLength:t}):null}static getHashAlgorithm(e){const t=_a.resolve(Oc);return"string"==typeof e?t.toAsnAlgorithm({name:e}):"object"==typeof e&&e&&"name"in e?t.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if(!("hash"in e))return new fn({algorithm:To,parameters:null});{let t;if("string"==typeof e.hash)t=e.hash;else{if(!e.hash||"object"!=typeof e.hash||!("name"in e.hash)||"string"!=typeof e.hash.name)throw new Error("Cannot get hash algorithm name");t=e.hash.name.toUpperCase()}switch(t.toLowerCase()){case"sha-1":return new fn({algorithm:ko,parameters:null});case"sha-256":return new fn({algorithm:Oo,parameters:null});case"sha-384":return new fn({algorithm:xo,parameters:null});case"sha-512":return new fn({algorithm:No,parameters:null})}}break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e)||"number"!=typeof e.saltLength)throw new Error("Cannot get 'saltLength' from 'alg' argument");const t=ml.createPssParams(e.hash,e.saltLength);if(!t)throw new Error("Cannot create PSS parameters");return new fn({algorithm:Ao,parameters:Sr.serialize(t)})}return new fn({algorithm:Ao,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case To:return{name:"RSASSA-PKCS1-v1_5"};case ko:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case Oo:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case xo:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case No:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case Ao:if(e.parameters){const t=Sr.parse(e.parameters,Go);return{name:"RSA-PSS",hash:_a.resolve(Oc).toWebAlgorithm(t.hashAlgorithm),saltLength:t.saltLength}}return{name:"RSA-PSS"}}return null}};yl=ml=wr([Ra()],yl),_a.registerSingleton(kc,yl);let bl=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new fn({algorithm:Mo});case"sha-256":return new fn({algorithm:jo});case"sha-384":return new fn({algorithm:Ho});case"sha-512":return new fn({algorithm:Fo})}return null}toWebAlgorithm(e){switch(e.algorithm){case Mo:return{name:"SHA-1"};case jo:return{name:"SHA-256"};case Ho:return{name:"SHA-384"};case Fo:return{name:"SHA-512"}}return null}};bl=wr([Ra()],bl),_a.registerSingleton(kc,bl);class vl{addPadding(e,t){const r=n.toUint8Array(t),s=new Uint8Array(e);return s.set(r,e-r.length),s}removePadding(e,t=!1){let r=n.toUint8Array(e);for(let e=0;e<r.length;e++)if(r[e]){r=r.slice(e);break}if(t&&r[0]>127){const e=new Uint8Array(r.length+1);return e.set(r,1),e.buffer}return r.buffer}toAsnSignature(e,t){if("ECDSA"===e.name){const r=e.namedCurve,s=vl.namedCurveSize.get(r)||vl.defaultNamedCurveSize,i=new Eo,o=n.toUint8Array(t);return i.r=this.removePadding(o.slice(0,s),!0),i.s=this.removePadding(o.slice(s,s+s),!0),Sr.serialize(i)}return null}toWebSignature(e,t){if("ECDSA"===e.name){const r=Sr.parse(t,Eo),s=e.namedCurve,n=vl.namedCurveSize.get(s)||vl.defaultNamedCurveSize;return function(...e){const t=e.map((e=>e.byteLength)).reduce(((e,t)=>e+t)),r=new Uint8Array(t);let s=0;return e.map((e=>new Uint8Array(e))).forEach((e=>{for(const t of e)r[s++]=t})),r.buffer}(this.addPadding(n,this.removePadding(r.r)),this.addPadding(n,this.removePadding(r.s)))}return null}}vl.namedCurveSize=new Map,vl.defaultNamedCurveSize=32;const Sl="1.3.101.110",wl="1.3.101.111",El="1.3.101.112",Cl="1.3.101.113";let Tl=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"ed25519":t=El;break;case"x25519":t=Sl;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=El;break;case"ed448":t=Cl}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=Sl;break;case"x448":t=wl}}return t?new fn({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case El:return{name:"Ed25519"};case Cl:return{name:"EdDSA",namedCurve:"Ed448"};case Sl:return{name:"X25519"};case wl:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};Tl=wr([Ra()],Tl),_a.registerSingleton(kc,Tl);class Il extends Gu{constructor(e){Gu.isAsnEncoded(e)?super(e,Pc):super(e),this.tag=Wu.CertificateRequestTag}onInit(e){this.tbs=Sr.serialize(e.certificationRequestInfo),this.publicKey=new Yu(e.certificationRequestInfo.subjectPKInfo);const t=_a.resolve(Oc);this.signatureAlgorithm=t.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signature,this.attributes=e.certificationRequestInfo.attributes.map((e=>pl.create(Sr.serialize(e))));const r=this.getAttribute(rc);this.extensions=[],r instanceof hl&&(this.extensions=r.items),this.subjectName=new _u(e.certificationRequestInfo.subject),this.subject=this.subjectName.toString()}getAttribute(e){for(const t of this.attributes)if(t.type===e)return t;return null}getAttributes(e){return this.attributes.filter((t=>t.type===e))}getExtension(e){for(const t of this.extensions)if(t.type===e)return t;return null}getExtensions(e){return this.extensions.filter((t=>t.type===e))}async verify(e=wu.get()){const t={...this.publicKey.algorithm,...this.signatureAlgorithm},r=await this.publicKey.export(t,["verify"],e),s=_a.resolveAll(fl).reverse();let n=null;for(const e of s)if(n=e.toWebSignature(t,this.signature),n)break;if(!n)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,r,n,this.tbs)}toTextObject(){const e=this.toTextObjectEmpty(),t=Sr.parse(this.rawData,Pc),r=t.certificationRequestInfo,s=new pu("",{Version:`${wn[r.version]} (${r.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){const e=new pu("");for(const t of this.attributes){const r=t.toTextObject();e[r[pu.NAME]]=r}s.Attributes=e}return e.Data=s,e.Signature=new pu("",{Algorithm:mu.serializeAlgorithm(t.signatureAlgorithm),"":t.signature}),e}}Il.NAME="PKCS#10 Certificate Request";class _l{static async create(e,t=wu.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");const r=await t.subtle.exportKey("spki",e.keys.publicKey),s=new Pc({certificationRequestInfo:new Rc({subjectPKInfo:Sr.parse(r,gn)})});if(e.name){const t=e.name instanceof _u?e.name:new _u(e.name);s.certificationRequestInfo.subject=Sr.parse(t.toArrayBuffer(),Br)}if(e.attributes)for(const t of e.attributes)s.certificationRequestInfo.attributes.push(Sr.parse(t.rawData,rn));if(e.extensions&&e.extensions.length){const t=new rn({type:rc}),r=new Sn;for(const t of e.extensions)r.push(Sr.parse(t.rawData,vn));t.values.push(Sr.serialize(r)),s.certificationRequestInfo.attributes.push(t)}const n={...e.signingAlgorithm,...e.keys.privateKey.algorithm},i=_a.resolve(Oc);s.signatureAlgorithm=i.toAsnAlgorithm(n);const o=Sr.serialize(s.certificationRequestInfo),a=await t.subtle.sign(n,e.keys.privateKey,o),c=_a.resolveAll(fl).reverse();let u=null;for(const e of c)if(u=e.toAsnSignature(n,a),u)break;if(!u)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return s.signature=u,new Il(Sr.serialize(s))}}class Al extends Gu{constructor(e){Gu.isAsnEncoded(e)?super(e,Cn):super(e),this.tag=Wu.CertificateTag}onInit(e){const t=e.tbsCertificate;this.tbs=Sr.serialize(t),this.serialNumber=d.ToHex(t.serialNumber),this.subjectName=new _u(t.subject),this.subject=new _u(t.subject).toString(),this.issuerName=new _u(t.issuer),this.issuer=this.issuerName.toString();const r=_a.resolve(Oc);this.signatureAlgorithm=r.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signatureValue;const s=t.validity.notBefore.utcTime||t.validity.notBefore.generalTime;if(!s)throw new Error("Cannot get 'notBefore' value");this.notBefore=s;const n=t.validity.notAfter.utcTime||t.validity.notAfter.generalTime;if(!n)throw new Error("Cannot get 'notAfter' value");this.notAfter=n,this.extensions=[],t.extensions&&(this.extensions=t.extensions.map((e=>nl.create(Sr.serialize(e))))),this.publicKey=new Yu(t.subjectPublicKeyInfo)}getExtension(e){for(const t of this.extensions)if("string"==typeof e){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter((t=>"string"==typeof e?t.type===e:t instanceof e))}async verify(e={},t=wu.get()){let r,s;const i=e.publicKey;try{if(i)if("publicKey"in i)r={...i.publicKey.algorithm,...this.signatureAlgorithm},s=await i.publicKey.export(r,["verify"],t);else if(i instanceof Yu)r={...i.algorithm,...this.signatureAlgorithm},s=await i.export(r,["verify"],t);else if(n.isBufferSource(i)){const e=new Yu(i);r={...e.algorithm,...this.signatureAlgorithm},s=await e.export(r,["verify"],t)}else r={...i.algorithm,...this.signatureAlgorithm},s=i;else r={...this.publicKey.algorithm,...this.signatureAlgorithm},s=await this.publicKey.export(r,["verify"],t)}catch(e){return!1}const o=_a.resolveAll(fl).reverse();let a=null;for(const e of o)if(a=e.toWebSignature(r,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");const c=await t.subtle.verify(this.signatureAlgorithm,s,a,this.tbs);if(e.signatureOnly)return c;{const t=(e.date||new Date).getTime();return c&&this.notBefore.getTime()<t&&t<this.notAfter.getTime()}}async getThumbprint(...e){let t,r="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(r=e[0]||r,t=e[1])),null!=t||(t=wu.get()),await t.subtle.digest(r,this.rawData)}async isSelfSigned(e=wu.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){const e=this.toTextObjectEmpty(),t=Sr.parse(this.rawData,Cn),r=t.tbsCertificate,s=new pu("",{Version:`${wn[r.version]} (${r.version})`,"Serial Number":r.serialNumber,"Signature Algorithm":mu.serializeAlgorithm(r.signature),Issuer:this.issuer,Validity:new pu("",{"Not Before":r.validity.notBefore.getTime(),"Not After":r.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(r.issuerUniqueID&&(s["Issuer Unique ID"]=r.issuerUniqueID),r.subjectUniqueID&&(s["Subject Unique ID"]=r.subjectUniqueID),this.extensions.length){const e=new pu("");for(const t of this.extensions){const r=t.toTextObject();e[r[pu.NAME]]=r}s.Extensions=e}return e.Data=s,e.Signature=new pu("",{Algorithm:mu.serializeAlgorithm(t.signatureAlgorithm),"":t.signatureValue}),e}}Al.NAME="Certificate";class Rl extends Array{constructor(e){if(super(),Gu.isAsnEncoded(e))this.import(e);else if(e instanceof Al)this.push(e);else if(Array.isArray(e))for(const t of e)this.push(t)}export(e){const t=new eo;t.version=1,t.encapContentInfo.eContentType="1.2.840.113549.1.7.1",t.encapContentInfo.eContent=new wi({single:new Mt}),t.certificates=new vi(this.map((e=>new bi({certificate:Sr.parse(e.rawData,Cn)}))));const r=new Si({contentType:Ji,content:Sr.serialize(t)}),s=Sr.serialize(r);return"raw"===e?s:this.toString(e)}import(e){const t=Gu.toArrayBuffer(e),r=Sr.parse(t,Si);if(r.contentType!==Ji)throw new TypeError("Cannot parse CMS package. Incoming data is not a SignedData object.");const s=Sr.parse(r.content,eo);this.clear();for(const e of s.certificates||[])e.certificate&&this.push(new Al(e.certificate))}clear(){for(;this.pop(););}toString(e="pem"){const t=this.export("raw");switch(e){case"pem":return Wu.encode(t,"CMS");case"pem-chain":return this.map((e=>e.toString("pem"))).join("\n");case"asn":return Sr.toString(t);case"hex":return d.ToHex(t);case"base64":return d.ToBase64(t);case"base64url":return d.ToBase64Url(t);case"text":return mu.serialize(this.toTextObject());default:throw TypeError("Argument 'format' is unsupported value")}}toTextObject(){const e=Sr.parse(this.export("raw"),Si),t=Sr.parse(e.content,eo);return new pu("X509Certificates",{"Content Type":gu.toString(e.contentType),Content:new pu("",{Version:`${Pn[t.version]} (${t.version})`,Certificates:new pu("",{Certificate:this.map((e=>e.toTextObject()))})})})}}class Pl{constructor(e={}){this.certificates=[],e.certificates&&(this.certificates=e.certificates)}async build(e,t=wu.get()){const r=new Rl(e);let s=e;for(;s=await this.findIssuer(s,t);){const e=await s.getThumbprint(t);for(const s of r){if(h(e,await s.getThumbprint(t)))throw new Error("Cannot build a certificate chain. Circular dependency.")}r.push(s)}return r}async findIssuer(e,t=wu.get()){if(!await e.isSelfSigned(t)){const r=e.getExtension(Gr);for(const s of this.certificates)if(s.subject===e.issuer){if(r)if(r.keyId){const e=s.getExtension(on);if(e&&e.keyId!==r.keyId)continue}else if(r.certId){const e=s.getExtension(en);if(e&&(r.certId.serialNumber!==s.serialNumber||!h(Sr.serialize(r.certId.name),Sr.serialize(e))))continue}try{const r={...s.publicKey.algorithm,...e.signatureAlgorithm},n=await s.publicKey.export(r,["verify"],t);if(!await e.verify({publicKey:n,signatureOnly:!0},t))continue}catch(e){continue}return s}}return null}}class kl{static async createSelfSigned(e,t=wu.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)}static async create(e,t=wu.get()){var r;let s;s=e.publicKey instanceof Yu?e.publicKey.rawData:"publicKey"in e.publicKey?e.publicKey.publicKey.rawData:n.isBufferSource(e.publicKey)?e.publicKey:await t.subtle.exportKey("spki",e.publicKey);const i=e.serialNumber?n.toUint8Array(d.FromHex(e.serialNumber)):t.getRandomValues(new Uint8Array(16));i[0]>127&&(i[0]&=127),i.length>1&&0===i[0]&&(i[1]|=128);const o=e.notBefore||new Date,a=e.notAfter||new Date(o.getTime()+31536e6),c=new Cn({tbsCertificate:new En({version:wn.v3,serialNumber:i,validity:new yn({notBefore:o,notAfter:a}),extensions:new Sn((null===(r=e.extensions)||void 0===r?void 0:r.map((e=>Sr.parse(e.rawData,vn))))||[]),subjectPublicKeyInfo:Sr.parse(s,gn)})});if(e.subject){const t=e.subject instanceof _u?e.subject:new _u(e.subject);c.tbsCertificate.subject=Sr.parse(t.toArrayBuffer(),Br)}if(e.issuer){const t=e.issuer instanceof _u?e.issuer:new _u(e.issuer);c.tbsCertificate.issuer=Sr.parse(t.toArrayBuffer(),Br)}const u={hash:"SHA-256"},l="signingKey"in e?{...u,...e.signingAlgorithm,...e.signingKey.algorithm}:{...u,...e.signingAlgorithm},h=_a.resolve(Oc);c.tbsCertificate.signature=c.signatureAlgorithm=h.toAsnAlgorithm(l);const p=Sr.serialize(c.tbsCertificate),f="signingKey"in e?await t.subtle.sign(l,e.signingKey,p):e.signature,g=_a.resolveAll(fl).reverse();let m=null;for(const e of g)if(m=e.toAsnSignature(l,f),m)break;if(!m)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return c.signatureValue=m,new Al(Sr.serialize(c))}}var Bl;!function(e){e[e.unspecified=0]="unspecified",e[e.keyCompromise=1]="keyCompromise",e[e.cACompromise=2]="cACompromise",e[e.affiliationChanged=3]="affiliationChanged",e[e.superseded=4]="superseded",e[e.cessationOfOperation=5]="cessationOfOperation",e[e.certificateHold=6]="certificateHold",e[e.removeFromCRL=8]="removeFromCRL",e[e.privilegeWithdrawn=9]="privilegeWithdrawn",e[e.aACompromise=10]="aACompromise"}(Bl||(Bl={}));class Ol extends yu{constructor(...e){let t;t=n.isBufferSource(e[0])?n.toArrayBuffer(e[0]):Sr.serialize(new Tn({userCertificate:e[0],revocationDate:new mn(e[1]),crlEntryExtensions:e[2]})),super(t,Tn)}onInit(e){this.serialNumber=d.ToHex(e.userCertificate),this.revocationDate=e.revocationDate.getTime(),this.extensions=[],e.crlEntryExtensions&&(this.extensions=e.crlEntryExtensions.map((e=>{const t=nl.create(Sr.serialize(e));switch(t.type){case Is:this.reason=Sr.parse(t.value,As).reason;break;case Us:this.invalidity=Sr.parse(t.value,js).value}return t})))}}class xl extends Gu{constructor(e){Gu.isAsnEncoded(e)?super(e,_n):super(e),this.tag=Wu.CrlTag}onInit(e){var t,r;const s=e.tbsCertList;this.tbs=Sr.serialize(s),this.version=s.version;const n=_a.resolve(Oc);this.signatureAlgorithm=n.toWebAlgorithm(e.signatureAlgorithm),this.tbsCertListSignatureAlgorithm=s.signature,this.certListSignatureAlgorithm=e.signatureAlgorithm,this.signature=e.signature,this.issuerName=new _u(s.issuer),this.issuer=this.issuerName.toString();const i=s.thisUpdate.getTime();if(!i)throw new Error("Cannot get 'thisUpdate' value");this.thisUpdate=i;const o=null===(t=s.nextUpdate)||void 0===t?void 0:t.getTime();this.nextUpdate=o,this.entries=(null===(r=s.revokedCertificates)||void 0===r?void 0:r.map((e=>new Ol(Sr.serialize(e)))))||[],this.extensions=[],s.crlExtensions&&(this.extensions=s.crlExtensions.map((e=>nl.create(Sr.serialize(e)))))}getExtension(e){for(const t of this.extensions)if("string"==typeof e){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter((t=>"string"==typeof e?t.type===e:t instanceof e))}async verify(e,t=wu.get()){if(!this.certListSignatureAlgorithm.isEqual(this.tbsCertListSignatureAlgorithm))throw new Error("algorithm identifier in the sequence tbsCertList and CertificateList mismatch");let r,s;const n=e.publicKey;try{n instanceof Al?(r={...n.publicKey.algorithm,...n.signatureAlgorithm},s=await n.publicKey.export(r,["verify"])):n instanceof Yu?(r={...n.algorithm,...this.signature},s=await n.export(r,["verify"])):(r={...n.algorithm,...this.signature},s=n)}catch(e){return!1}const i=_a.resolveAll(fl).reverse();let o=null;for(const e of i)if(o=e.toWebSignature(r,this.signature),o)break;if(!o)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return await t.subtle.verify(this.signatureAlgorithm,s,o,this.tbs)}async getThumbprint(...e){let t,r="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(r=e[0]||r,t=e[1])),null!=t||(t=wu.get()),await t.subtle.digest(r,this.rawData)}findRevoked(e){const t="string"==typeof e?e:e.serialNumber;for(const e of this.entries)if(e.serialNumber===t)return e;return null}}class Nl{static async create(e,t=wu.get()){var r;const s=e.issuer instanceof _u?e.issuer:new _u(e.issuer),n=new _n({tbsCertList:new In({version:wn.v2,issuer:Sr.parse(s.toArrayBuffer(),Br),thisUpdate:new mn(e.thisUpdate||new Date)})});if(e.nextUpdate&&(n.tbsCertList.nextUpdate=new mn(e.nextUpdate)),e.extensions&&e.extensions.length&&(n.tbsCertList.crlExtensions=new Sn(e.extensions.map((e=>Sr.parse(e.rawData,vn)))||[])),e.entries&&e.entries.length){n.tbsCertList.revokedCertificates=[];for(const t of e.entries){const s=Gu.toArrayBuffer(t.serialNumber);if(n.tbsCertList.revokedCertificates.findIndex((e=>h(e.userCertificate,s)))>-1)throw new Error(`Certificate serial number ${t.serialNumber} already exists in tbsCertList`);const i=new Tn({userCertificate:s,revocationDate:new mn(t.revocationDate||new Date)});if("extensions"in t&&(null===(r=t.extensions)||void 0===r?void 0:r.length)?i.crlEntryExtensions=t.extensions.map((e=>Sr.parse(e.rawData,vn))):i.crlEntryExtensions=[],!(t instanceof Ol)&&(t.reason&&i.crlEntryExtensions.push(new vn({extnID:Is,critical:!1,extnValue:new Mt(Sr.serialize(new As(t.reason)))})),t.invalidity&&i.crlEntryExtensions.push(new vn({extnID:Us,critical:!1,extnValue:new Mt(Sr.serialize(new js(t.invalidity)))})),t.issuer)){const t=e.issuer instanceof _u?e.issuer:new _u(e.issuer);i.crlEntryExtensions.push(new vn({extnID:rs,critical:!1,extnValue:new Mt(Sr.serialize(Sr.parse(t.toArrayBuffer(),Br)))}))}n.tbsCertList.revokedCertificates.push(i)}}const i={...e.signingAlgorithm,...e.signingKey.algorithm},o=_a.resolve(Oc);n.tbsCertList.signature=n.signatureAlgorithm=o.toAsnAlgorithm(i);const a=Sr.serialize(n.tbsCertList),c=await t.subtle.sign(i,e.signingKey,a),u=_a.resolveAll(fl).reverse();let l=null;for(const e of u)if(l=e.toAsnSignature(i,c),l)break;if(!l)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return n.signature=l,new xl(Sr.serialize(n))}}nl.register(Jr,Ju),nl.register(Ps,el),nl.register(zs,tl),nl.register(on,rl),nl.register(Gr,Xu),nl.register(en,sl),nl.register(ms,ol),nl.register(Kr,al),pl.register(tc,dl),pl.register(rc,hl),_a.registerSingleton(fl,gl),_a.registerSingleton(fl,vl),vl.namedCurveSize.set("P-256",32),vl.namedCurveSize.set("K-256",32),vl.namedCurveSize.set("P-384",48),vl.namedCurveSize.set("P-521",66)},7868:(e,t,r)=>{"use strict";const{isType:s,isUserType:n,isDecodeType:i}=r(2),o=r(872),a=r(6101),c=r(59);function u(e,t,r){if(s(t)){const s=t.decode.call(r,e);return r[a.bytes]+=t.decode.bytes,s}return l(e,t,r)}function l(e,t,r){!function(e){if(!n(e))throw new TypeError("Argument #2 should be a plain object.")}(t);const s=Object.create(null);void 0===r.node?(r.node=s,r.current=s):r.current=s;const o=Object.keys(t);for(let n=0;n<o.length;n+=1){const c=o[n],u=t[c];if(!i(u)){s[c]=l(e,u,r),r.current=s;continue}const d=u.decode.call(r,e);r[a.bytes]+=u.decode.bytes,!0!==u[a.skip]&&(s[c]=d)}return s}e.exports={decode:function e(t,r){let s=t;Buffer.isBuffer(t)&&(s=new o,s.append(t));const n=new c,i=u(s,r,n);return e.bytes=n.bytes,c.clean(n),i},decodeCommon:u}},7890:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Signature=void 0;const s=r(6353);class n{constructor(e={}){this.type=n.type,this.data=[],Object.assign(this,e)}static createEmpty(){return new n}static deSerialize(e){return new n((0,s.decode)(e,n.spec))}serialize(){const e=(0,s.encode)(this,n.spec).slice();return Buffer.from(e)}static fromData(e){const t=Buffer.alloc(2);return t.writeUInt16BE(n.type),n.deSerialize(Buffer.concat([t,e]))}get extension(){return{type:this.type,data:this.serialize().slice(2)}}}t.Signature=n,n.type=13,n.spec={type:s.types.uint16be,data:s.types.array({hash:s.types.uint8,signature:s.types.uint8},s.types.uint16be,"bytes")}},7910:function(e,t,r){"use strict";var s,n=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},s(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=s(e),o=0;o<r.length;o++)"default"!==r[o]&&n(t,e,r[o]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTCConnectionManagement=void 0,t.createTrackForwarder=E,t.parseOptions=T,t.createRTCPeerConnectionSink=async function(e,t,r,s,n,i,o,a,c=!0){const l=await(0,u.legacyGetSignalingSessionOptions)(e),d=new _(t,e,n,i,l,{configuration:o,weriftConfiguration:a}),h=await d.addTrack(s,{audioDirection:r});h.control.killed.promise.then((()=>{h.cleanup(!1),d.pc.close()}));const p={audio:{direction:r},video:{direction:"recvonly"},configuration:o};return d.negotiateRTCSignalingSessionInternal(p,c),h.control};const a=r(3290),c=r(1362),u=r(3301),l=r(4890),d=o(r(2743)),h=r(3169),p=(r(9409),r(3846)),f=r(4779),g=r(532),m=r(9696),y=r(969),b=r(3377),v=r(441),S=r(4813);const w=["Windows","Macintosh","iPhone","iPad","iOS"];async function E(e){const{timeStart:t,isLocalNetwork:r,destinationId:s,type:n,requestMediaStream:i,videoTransceiver:o,audioTransceiver:a,maximumCompatibilityMode:u,clientOptions:f}=e,{sessionSupportsH264High:m,transcodeWidth:v,isMediumResolution:S,width:E,height:C}=T(f);let I=u;const _=!S&&!I;let A;I?A="medium-resolution":r||(A="remote");const R=!!o?.codecs.find((e=>"video/H265"===e.mimeType)),P=await i({video:{codec:"h264",alternateCodecs:R?["h265","h264"]:void 0,width:E,height:C},audio:{codec:"opus",alternateCodecs:["opus","pcm_mulaw","pcm_alaw"]},adaptive:_?{codecSwitch:!0,pictureLoss:!0}:void 0,destination:A,destinationId:s,tool:_?"scrypted":"ffmpeg"});if(!P)return;let k=!1;try{const e=await d.default.connectRPCObject(await d.default.mediaManager.convertMediaObject(P,d.ScryptedMimeTypes.MediaStreamFeedback));e&&(o.sender.onRtcp.subscribe((t=>{e.onRtcp(t.serialize())})),k=!0)}catch(e){}const B=d.default.deviceManager.getMixinConsole(P.sourceId),O=await d.default.mediaManager.convertMediaObjectToJSON(P,d.ScryptedMimeTypes.FFmpegInput),{mediaStreamOptions:x}=O;if(S&&!I){let t=!1;for(const r of w)t||=e?.clientOptions?.userAgent?.includes(r);if(!t){const e=O?.mediaStreamOptions?.video?.width;I=!e||e>1280}}B.log("Client Stream Profile",{transcodeBaseline:I,sessionSupportsH264High:m,maximumCompatibilityMode:u,...f});const N=(e,t)=>{const r=e?.codecs.find((e=>e.mimeType===t));return r&&(e.sender.codec=r),r},D={"audio/PCMU":"pcm_mulaw","audio/PCMA":"pcm_alaw","audio/opus":"opus","video/H264":"h264","video/H265":"h265"},L={pcm_mulaw:"audio/PCMU",pcm_alaw:"audio/PCMA",opus:"audio/opus",h264:"video/H264",h265:"video/H265"};let M="h264"!==x?.video?.codec;u||("pcm_mulaw"===x?.audio?.codec?N(a,"audio/PCMU"):"pcm_alaw"===x?.audio?.codec&&N(a,"audio/PCMA"),"h265"===x?.video?.codec&&R&&(N(o,"video/H265"),M=!1));const{name:U}=(0,y.getAudioCodec)(a.sender.codec);let j=u?void 0:U;const H=[],F=I||M;let z;if(!F&&(!x?.video?.h264Info?.reserved30&&!x?.video?.h264Info?.reserved31)&&("h264"===x?.video?.codec?z="h264":"h265"===x?.video?.codec&&(z="h265")),O.mediaStreamOptions?.oobCodecParameters&&H.push("-bsf:v","dump_extra"),F){const e=r?1e6:5e5,t=e;H.push("-b:v",t.toString(),"-bufsize",(2*t).toString(),"-maxrate",t.toString(),"-r","15");const s=`scale='min(${v},iw)':-2`;(0,c.addVideoFilterArguments)(H,s),H.push("-profile:v","baseline","-preset","ultrafast","-g","60","-c:v","libx264","-bf","0")}else H.push("-vcodec","copy");const V=(0,y.getFFmpegRtpAudioOutputArguments)(O.mediaStreamOptions?.audio,a.sender.codec,u);let q=!!z;if(F)try{const e=await d.default.mediaManager.convertMediaObject(P,d.ScryptedMimeTypes.FFmpegTranscodeStream);await e({videoTranscodeArguments:H,audioTranscodeArguments:V}),H.splice(0,H.length),z="copy",j="copy",q=!0}catch(e){}k&&(q=!1);let K=0;const $={negotiate:async e=>!!j&&("copy"===j||("opus"===e.codec?48e3===e.rtpmap.clock:("pcm_mulaw"===e.codec||"pcm_alaw"===e.codec)&&(!("pcm_mulaw"===e.codec&&!a.codecs.find((e=>"audio/PCMU"===e.mimeType)))&&(!("pcm_alaw"===e.codec&&!a.codecs.find((e=>"audio/PCMA"===e.mimeType)))&&8e3===e.rtpmap.clock)))),alternateCodecs:["opus","pcm_mulaw","pcm_alaw"],onRtp:(e,t)=>{{D[a.sender.codec.mimeType]!==t&&N(a,L[t]);const r=b.RtpPacket.deSerialize(e),s=Date.now();r.header.marker=s-K>1e3,r.header.payloadType=a.sender.codec.payloadType,a.sender.sendRtp(r.serialize()),K=s}},encoderArguments:[...V],firstPacket:e=>{const t=b.RtpPacket.deSerialize(e);a.sender.replaceRTP(t.header,!0)}},W=1200;let G,Y;const X={codecCopy:z,alternateCodecs:R?["h264","h265"]:void 0,packetSize:W,onMSection:e=>Y=e,onRtp:(e,t)=>{let r;if(q&&!G){if("h264"===Y.codec){const e=(0,l.getSpsPps)(Y);G=new h.H264Repacketizer(B,1188,{...e})}else if("h265"===Y.codec){const e=(0,l.getSpsPpsVps)(Y);G=new p.H265Repacketizer(B,1188,{...e})}r=(e,t)=>{D[o.sender.codec.mimeType]!==t&&N(o,L[t]);const r=G.repacketize(b.RtpPacket.deSerialize(e));for(const e of r)o.sender.sendRtp(e)}}else r=(e,t)=>{D[o.sender.codec.mimeType]!==t&&N(o,L[t]),o.sender.sendRtp(e)};X.onRtp=r,X.onRtp(e,t)},encoderArguments:[...H],firstPacket:e=>{B.log("first video packet",Date.now()-t);const r=b.RtpPacket.deSerialize(e);o.sender.replaceRTP(r.header,!0)}};let J;return J=null!==O.mediaStreamOptions?.audio&&a?null!==O.mediaStreamOptions?.video&&o?{video:X,audio:$}:{audio:$}:{video:X},(0,g.startRtpForwarderProcess)(B,O,J)}const C=[100,110,122,244].map((e=>e.toString(16)));function T(e){let t=!!e?.capabilities?.video?.codecs?.filter((e=>"video/h264"===e.mimeType.toLowerCase()))?.find((e=>{let t=e.sdpFmtpLine.toLowerCase();for(const e of C)if(t.includes(`profile-level-id=${e}`))return!0;return!1}));e?.userAgent?.includes("Firefox/")&&(t=!0);const r=e?.screen?.width?2*Math.trunc(e?.screen?.width/2):960,s=Math.max(640,Math.min(r,1280)),n=e?.screen?.devicePixelRatio||1,i=e?.screen?.width*n||void 0,o=e?.screen?.height*n||void 0,a=Math.max(i,o),c=!t||a&&a<1920;return{sessionSupportsH264High:t,transcodeWidth:s,isMediumResolution:c,width:c?1280:i,height:c?720:o}}class I{constructor(e,t,r,s){this.connectionManagement=e,this.video=t,this.audio=r,this.removed=new a.Deferred,this.control=new m.ScryptedSessionControl(s,r),this.connectionManagement.activeTracks.add(this)}async onStop(){return this.removed.promise}attachForwarder(e){const t=this.removed;e.killPromise.then((()=>t.resolve(void 0))).catch((e=>t.reject(e)))}async replace(e){const{createTrackForwarder:t,intercom:r}=await this.connectionManagement.createTracks(e);this.cleanup(!0),this.removed=new a.Deferred,this.control=new m.ScryptedSessionControl(r,this.audio);const s=await t(this.video,this.audio);this.attachForwarder(s),(0,f.waitClosed)(this.connectionManagement.pc).finally((()=>s.kill())),this.removed.promise.finally((()=>s.kill()))}cleanup(e){this.removed.finished||(this.removed.resolve(void 0),this.control.endSession(),this.video.sender.onRtcp.allUnsubscribe(),e||(this.connectionManagement.activeTracks.delete(this),this.video.stop(),this.audio.stop(),this.connectionManagement.pc.removeTrack(this.video.sender),this.connectionManagement.pc.removeTrack(this.audio.sender)))}async stop(){return this.cleanup(!1)}setPlayback(e){return this.control.setPlaybackInternal(e)}}class _{constructor(e,t,r,s,n,i){this.console=e,this.clientSession=t,this.requireOpus=r,this.maximumCompatibilityMode=s,this.clientOptions=n,this.options=i,this.negotiationDeferred=new a.Deferred,this.activeTracks=new Set,this.closed=!1,this.pc=new b.RTCPeerConnection({codecs:{audio:[...r?y.opusAudioCodecOnly:y.requiredAudioCodecs],video:[y.requiredVideoCodec,y.optionalVideoCodec]},...i.weriftConfiguration}),(0,f.logConnectionState)(e,this.pc),(0,f.waitConnected)(this.pc).then((()=>(0,S.logIsLocalIceTransport)(this.console,this.pc))).catch((()=>{})),this.weriftSignalingSession=new v.WeriftSignalingSession(e,this.pc)}async probe(){}async createTracks(e){let t;try{t=await d.default.connectRPCObject(await d.default.mediaManager.convertMediaObject(e,d.ScryptedMimeTypes.RequestMediaStream))}catch(r){e=await d.default.connectRPCObject(e),t=async()=>e}const r=async e=>{if(!t)throw new Error("RequestMediaStream can't be called twice");const r=t;t=void 0;const s=r(e);return d.default.connectRPCObject(s)};let s=d.default.systemManager.getDeviceById(e.sourceId);s.interfaces?.includes(d.ScryptedInterface.Intercom)||(s=void 0);const n=new b.MediaStreamTrack({kind:"video"}),i=new b.MediaStreamTrack({kind:"audio"}),o=d.default.deviceManager.getMixinConsole(e.sourceId),a=Date.now();return{vtrack:n,atrack:i,intercom:s,createTrackForwarder:async(e,t)=>await E({timeStart:a,...(0,S.logIsLocalIceTransport)(o,this.pc),requestMediaStream:r,videoTransceiver:e,audioTransceiver:t,maximumCompatibilityMode:this.maximumCompatibilityMode,clientOptions:this.clientOptions})}}get negotiation(){return this.negotiationDeferred.finished&&(this.negotiationDeferred=new a.Deferred),this.negotiationDeferred.promise}async negotiateRTCSignalingSession(){return this.negotiateRTCSignalingSessionInternal({configuration:this.options?.configuration})}async negotiateRTCSignalingSessionInternal(e,t){try{t?await(0,u.connectRTCSignalingClients)(this.console,this.clientSession,e,this.weriftSignalingSession,{}):await(0,u.connectRTCSignalingClients)(this.console,this.weriftSignalingSession,{},this.clientSession,e),this.negotiationDeferred.resolve(void 0)}catch(e){throw this.console.error("negotiation failed",e),this.negotiationDeferred.reject(e),e}}async addTrack(e,t){const{atrack:r,vtrack:s,createTrackForwarder:n,intercom:i}=await this.createTracks(e);let o=t?.audioDirection||"sendrecv";i||(o="sendonly");const a=this.pc.addTransceiver(s,{direction:"sendonly"});a.mid=t?.videoMid;const c=this.pc.addTransceiver(r,{direction:o});c.mid=t?.audioMid;const u=new I(this,a,c,i);return this.negotiation.then((async()=>{try{if(this.console.log("waiting ice connected"),this.pc.remoteIsBundled?await(0,f.waitConnected)(this.pc):await(0,f.waitIceConnected)(this.pc),u.removed.finished)return;this.console.log("done waiting ice connected");const e=await n(a,c);u.attachForwarder(e),(0,f.waitClosed)(this.pc).finally((()=>e?.kill())),u.removed.promise.finally((()=>e?.kill()))}catch(e){this.console.error("Error starting playback for WebRTC track.",e),u.cleanup(!1)}})),u}async connectRPCObject(e){return d.default.connectRPCObject(e)}async close(){for(const e of this.activeTracks)e.cleanup(!1);this.activeTracks.clear(),this.pc.close()}async waitClosed(){await(0,f.waitClosed)(this.pc)}async waitConnected(){await(0,f.waitIceConnected)(this.pc),await(0,f.waitConnected)(this.pc)}}t.WebRTCConnectionManagement=_},7983:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerHelloVerifyRequest=void 0;const s=r(6353),n=r(7077),i=r(3268),o=r(9602);class a{constructor(e,t){this.serverVersion=e,this.cookie=t,this.msgType=o.HandshakeType.hello_verify_request_3}static createEmpty(){return new a(void 0,void 0)}static deSerialize(e){return new a(...Object.values((0,s.decode)(e,a.spec)))}serialize(){const e=(0,s.encode)(this,a.spec).slice();return Buffer.from(e)}get version(){return{major:255-this.serverVersion.major,minor:255-this.serverVersion.minor}}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.ServerHelloVerifyRequest=a,a.spec={serverVersion:i.ProtocolVersion,cookie:s.types.buffer(s.types.uint8)}},7999:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultPeerConfig=t.findCodecByMimeType=t.RTCPeerConnection=void 0;const s=r(6982),n=r(8655),i=r(5433),o=r(6276),a=r(4579),c=r(386),u=r(4262),l=r(8383),d=r(6266),h=r(8806),p=(0,i.debug)("werift:packages/webrtc/src/peerConnection.ts");class f extends n.EventTarget{constructor(e={}){super(),this.cname=(0,s.randomUUID)().toString(),this.config=g(),this.signalingState="stable",this.negotiationneeded=!1,this.needRestart=!1,this.router=new o.RtpRouter,this.isClosed=!1,this.shouldNegotiationneeded=!1,this.iceGatheringStateChange=new i.Event,this.iceConnectionStateChange=new i.Event,this.signalingStateChange=new i.Event,this.connectionStateChange=new i.Event,this.onDataChannel=new i.Event,this.onRemoteTransceiverAdded=new i.Event,this.onTransceiverAdded=new i.Event,this.onIceCandidate=new i.Event,this.onNegotiationneeded=new i.Event,this.onTrack=new i.Event,this.needNegotiation=async()=>{this.shouldNegotiationneeded=!0,this.negotiationneeded||"stable"!==this.signalingState||(this.shouldNegotiationneeded=!1,setImmediate((()=>{this.negotiationneeded=!0,this.onNegotiationneeded.execute(),this.onnegotiationneeded&&this.onnegotiationneeded({})})))},this.setConfiguration(e),this.sdpManager=new l.SDPManager({cname:this.cname,bundlePolicy:this.config.bundlePolicy}),this.transceiverManager=new o.TransceiverManager(this.cname,this.config,this.router),this.transceiverManager.onTransceiverAdded.pipe(this.onTransceiverAdded),this.transceiverManager.onRemoteTransceiverAdded.pipe(this.onRemoteTransceiverAdded),this.transceiverManager.onTrack.subscribe((({track:e,stream:t,transceiver:r})=>{const s={track:e,streams:[t],transceiver:r,receiver:r.receiver};this.onTrack.execute(e),this.emit("track",s),this.ontrack&&this.ontrack(s)})),this.transceiverManager.onNegotiationNeeded.subscribe((()=>this.needNegotiation())),this.sctpManager=new c.SctpTransportManager,this.sctpManager.onDataChannel.subscribe((e=>{this.onDataChannel.execute(e);const t={channel:e};this.ondatachannel?.(t),this.emit("datachannel",t)})),this.secureManager=new d.SecureTransportManager({config:this.config,sctpManager:this.sctpManager,transceiverManager:this.transceiverManager}),this.secureManager.iceGatheringStateChange.pipe(this.iceGatheringStateChange),this.secureManager.iceConnectionStateChange.subscribe((e=>{"closed"===e&&this.close(),this.iceConnectionStateChange.execute(e)})),this.secureManager.connectionStateChange.subscribe((e=>{this.connectionStateChange.execute(e),this.onconnectionstatechange?.(),this.emit("connectionstatechange")})),this.secureManager.onIceCandidate.subscribe((e=>{const t=e?e.toJSON():void 0;this.onIceCandidate.execute(t),this.onicecandidate?.({candidate:t}),this.emit("icecandidate",{candidate:t})}))}get connectionState(){return this.secureManager.connectionState}get iceConnectionState(){return this.secureManager.iceConnectionState}get iceGathererState(){return this.secureManager.iceGatheringState}get iceGatheringState(){return this.secureManager.iceGatheringState}get dtlsTransports(){return this.secureManager.dtlsTransports}get sctpTransport(){return this.sctpManager.sctpTransport}get sctpRemotePort(){return this.sctpManager.sctpRemotePort}get iceTransports(){return this.secureManager.iceTransports}get extIdUriMap(){return this.router.extIdUriMap}get iceGeneration(){return this.iceTransports[0].connection.generation}get localDescription(){return this.sdpManager.localDescription}get remoteDescription(){return this.sdpManager.remoteDescription}get remoteIsBundled(){return this.sdpManager.remoteIsBundled}get _localDescription(){return this.sdpManager._localDescription}get _remoteDescription(){return this.sdpManager._remoteDescription}getTransceivers(){return this.transceiverManager.getTransceivers()}getSenders(){return this.transceiverManager.getSenders()}getReceivers(){return this.transceiverManager.getReceivers()}setConfiguration(e){if((0,h.deepMerge)(this.config,e),this.config.icePortRange){const[e,t]=this.config.icePortRange;if(e===t)throw new Error("should not be same value");if(e>=t)throw new Error("The min must be less than max")}for(const[e,t]of(0,n.enumerate)([...this.config.codecs.audio||[],...this.config.codecs.video||[]]))if(null==t.payloadType)switch(t.payloadType=96+e,t.name.toLowerCase()){case"rtx":t.parameters="apt="+(t.payloadType-1);break;case"red":if("audio"===t.contentType){const e=t.payloadType+1;t.parameters=`${e}/${e}`,t.payloadType=63}}[...this.config.headerExtensions.audio||[],...this.config.headerExtensions.video||[]].forEach(((e,t)=>{e.id=1+t}))}getConfiguration(){return this.config}async createOffer({iceRestart:e}={}){(e||this.needRestart)&&(this.needRestart=!1,this.secureManager.restartIce()),await this.secureManager.ensureCerts();for(const e of this.transceiverManager.getTransceivers())0===e.codecs.length&&this.transceiverManager.assignTransceiverCodecs(e),0===e.headerExtensions.length&&(e.headerExtensions=this.config.headerExtensions[e.kind]??[]);return this.sdpManager.buildOfferSdp(this.transceiverManager.getTransceivers(),this.sctpTransport).toJSON()}createSctpTransport(){const e=this.sctpManager.createSctpTransport(),t=this.findOrCreateTransport();return e.setDtlsTransport(t),e}createDataChannel(e,t={}){this.sctpTransport||(this.createSctpTransport(),this.needNegotiation());const r=this.sctpManager.createDataChannel(e,t);if(!r.sctp.dtlsTransport){const e=this.findOrCreateTransport();r.sctp.setDtlsTransport(e)}return r}removeTrack(e){if(this.isClosed)throw new Error("peer closed");this.transceiverManager.removeTrack(e),this.needNegotiation()}findOrCreateTransport(){const[e]=this.iceTransports;if(("max-bundle"===this.sdpManager.bundlePolicy||"disable"!==this.sdpManager.bundlePolicy&&this.remoteIsBundled)&&e)return this.dtlsTransports[0];const t=this.secureManager.createTransport();t.onRtp.subscribe((e=>{this.router.routeRtp(e)})),t.onRtcp.subscribe((e=>{this.router.routeRtcp(e)}));const r=t.iceTransport;return r.onNegotiationNeeded.subscribe((()=>{this.needNegotiation()})),r.onIceCandidate.subscribe((e=>{if(this.localDescription)return e?void(this._localDescription?this.secureManager.handleNewIceCandidate({candidate:e,bundlePolicy:this.sdpManager.bundlePolicy,remoteIsBundled:!!this.sdpManager.remoteIsBundled,media:this._localDescription.media[0],transceiver:this.transceiverManager.getTransceivers().find((e=>e.dtlsTransport.iceTransport.id===r.id)),sctpTransport:this.sctpTransport?.dtlsTransport.iceTransport.id===r.id?this.sctpTransport:void 0}):p("localDescription not found when ice candidate was gathered")):(this.sdpManager.setLocal(this._localDescription,this.transceiverManager.getTransceivers(),this.sctpTransport),this.onIceCandidate.execute(void 0),this.onicecandidate&&this.onicecandidate({candidate:void 0}),void this.emit("icecandidate",{candidate:void 0}));p("localDescription not found when ice candidate was gathered")})),t}async setLocalDescription(e){e=e??(["stable","have-local-offer","have-remote-pranswer"].includes(this.signalingState)?await this.createOffer():await this.createAnswer());const t=this.sdpManager.parseSdp({sdp:e.sdp,isLocal:!0,signalingState:this.signalingState,type:e.type});"offer"===t.type?this.setSignalingState("have-local-offer"):"answer"===t.type&&this.setSignalingState("stable");for(const[e,r]of(0,n.enumerate)(t.media)){const t=r.rtp.muxId;if(this.sdpManager.registerMid(t),["audio","video"].includes(r.kind)){const r=this.transceiverManager.getTransceiverByMLineIndex(e);r&&(r.mid=t)}"application"===r.kind&&this.sctpTransport&&(this.sctpTransport.mid=t)}const r=t.media.find((e=>e.dtlsParams))?.dtlsParams?.role;if(this.secureManager.setLocalRole({type:t.type,role:r}),["answer","pranswer"].includes(t.type))for(const e of this.transceiverManager.getTransceivers()){const t=(0,h.andDirection)(e.direction,e.offerDirection);e.setCurrentDirection(t)}return this.sdpManager.setLocal(t,this.transceiverManager.getTransceivers(),this.sctpTransport),await this.gatherCandidates().catch((e=>{p("gatherCandidates failed",e)})),"answer"===t.type&&this.connect().catch((e=>{p("connect failed",e),this.secureManager.setConnectionState("failed")})),this.sdpManager.setLocal(t,this.transceiverManager.getTransceivers(),this.sctpTransport),this.shouldNegotiationneeded&&this.needNegotiation(),t}async gatherCandidates(){await this.secureManager.gatherCandidates(!!this.sdpManager.remoteIsBundled)}async addIceCandidate(e){const t=this.sdpManager.buildOfferSdp(this.transceiverManager.getTransceivers(),this.sctpTransport);await this.secureManager.addIceCandidate(t,e)}async connect(){p("start connect");(await Promise.allSettled(this.dtlsTransports.map((async e=>{const{iceTransport:t}=e;if("connected"===t.state)return;const r=()=>"connected"===e.state;r()||(this.secureManager.setConnectionState("connecting"),await t.start().catch((e=>{throw p("iceTransport.start failed",e),e})),r()||(await e.start().catch((e=>{throw p("dtlsTransport.start failed",e),e})),this.sctpTransport&&this.sctpTransport.dtlsTransport.id===e.id&&await this.sctpManager.connectSctp()))})))).find((e=>"rejected"===e.status))?this.secureManager.setConnectionState("failed"):this.secureManager.setConnectionState("connected")}restartIce(){this.needRestart=!0,this.needNegotiation()}async setRemoteDescription(e){e instanceof u.SessionDescription&&(e=e.toSdp());const t=this.sdpManager.setRemoteDescription(e,this.signalingState);let r;const s=(e,t)=>e.kind===t.kind&&[void 0,t.rtp.muxId].includes(e.mid);let n=t.media.map(((n,i)=>{let o;if(["audio","video"].includes(n.kind)){let a=this.transceiverManager.getTransceivers().find((e=>s(e,n)));if(a){if("inactive"===a.direction&&a.stopping)return a.stopped=!0,void("answer"===e.type&&a.setCurrentDirection("inactive"))}else a=this.addTransceiver(n.kind,{direction:"recvonly"}),a.mid=n.rtp.muxId,this.onRemoteTransceiverAdded.execute(a);this.sdpManager.remoteIsBundled&&(r?a.setDtlsTransport(r):r=a.dtlsTransport),o=a.dtlsTransport,this.transceiverManager.setRemoteRTP(a,n,t.type,i)}else{if("application"!==n.kind)throw new Error("invalid media kind");{let e=this.sctpTransport;e||(e=this.createSctpTransport(),e.mid=n.rtp.muxId),this.sdpManager.remoteIsBundled&&(r?e.setDtlsTransport(r):r=e.dtlsTransport),o=e.dtlsTransport,this.sctpManager.setRemoteSCTP(n,i)}}const a=o.iceTransport;if(n.iceParams){const e=!!this.sdpManager.inactiveRemoteMedia;a.setRemoteParams(n.iceParams,e),n.iceParams?.iceLite&&(a.connection.iceControlling=!0)}return n.dtlsParams&&o.setRemoteParams(n.dtlsParams),n.iceCandidates.forEach(a.addRemoteCandidate),n.iceCandidatesComplete&&a.addRemoteCandidate(void 0),"answer"===t.type&&n.dtlsParams?.role&&(o.role="client"===n.dtlsParams.role?"server":"client"),a}));n=n.filter((e=>!!e));const i=this.transceiverManager.getTransceivers().filter((e=>null==t.media.find((t=>s(e,t)))));if("answer"===e.type)for(const e of i)e.stop(),e.stopped=!0;"offer"===t.type?this.setSignalingState("have-remote-offer"):"answer"===t.type&&this.setSignalingState("stable"),"answer"===t.type&&(p("caller start connect"),this.connect().catch((e=>{p("connect failed",e),this.secureManager.setConnectionState("failed")}))),this.negotiationneeded=!1,this.shouldNegotiationneeded&&this.needNegotiation()}addTransceiver(e,t={}){const r=this.findOrCreateTransport(),s=this.transceiverManager.addTransceiver(e,r,t);return this.secureManager.updateIceConnectionState(),this.needNegotiation(),s}addTrack(e,t){if(this.isClosed)throw new Error("is closed");const r=this.transceiverManager.addTrack(e,t);if(!r.dtlsTransport){const e=this.findOrCreateTransport();r.setDtlsTransport(e)}return this.needNegotiation(),r.sender}async createAnswer(){this.assertNotClosed(),await this.secureManager.ensureCerts();return this.sdpManager.buildAnswerSdp({transceivers:this.transceiverManager.getTransceivers(),sctpTransport:this.sctpTransport,signalingState:this.signalingState}).toJSON()}assertNotClosed(){if(this.isClosed)throw new Error("RTCPeerConnection is closed")}setSignalingState(e){p("signalingStateChange",e),this.signalingState=e,this.signalingStateChange.execute(e),this.onsignalingstatechange&&this.onsignalingstatechange({})}createPeerConnectionStats(){const e=(0,a.getStatsTimestamp)();return{type:"peer-connection",id:(0,a.generateStatsId)("peer-connection"),timestamp:e,dataChannelsOpened:this.sctpManager.dataChannelsOpened,dataChannelsClosed:this.sctpManager.dataChannelsClosed}}async getStats(e){const t=[];t.push(this.createPeerConnectionStats());const r=await this.transceiverManager.getStats(e);t.push(...r);const s=await this.secureManager.getStats();if(t.push(...s),this.sctpTransport){const e=await this.sctpManager.getStats();e&&t.push(...e)}return new a.RTCStatsReport(t)}async close(){this.isClosed||(this.isClosed=!0,this.setSignalingState("closed"),this.transceiverManager.close(),await this.secureManager.close(),await this.sctpManager.close(),this.onDataChannel.allUnsubscribe(),this.iceGatheringStateChange.allUnsubscribe(),this.iceConnectionStateChange.allUnsubscribe(),this.signalingStateChange.allUnsubscribe(),this.onTransceiverAdded.allUnsubscribe(),this.onRemoteTransceiverAdded.allUnsubscribe(),this.onIceCandidate.allUnsubscribe(),p("peerConnection closed"))}}t.RTCPeerConnection=f;function g(){return{codecs:{audio:[(0,o.useOPUS)(),(0,o.usePCMU)()],video:[(0,o.useVP8)()]},headerExtensions:{audio:[],video:[]},iceTransportPolicy:"all",iceServers:[{urls:"stun:stun.l.google.com:19302"}],icePortRange:void 0,iceInterfaceAddresses:void 0,iceAdditionalHostAddresses:void 0,iceUseIpv4:!0,iceUseIpv6:!0,iceFilterStunResponse:void 0,iceFilterCandidatePair:void 0,icePasswordPrefix:void 0,iceUseLinkLocalAddress:void 0,dtls:{},bundlePolicy:"max-compat",debug:{},midSuffix:!1,forceTurnTCP:!1}}t.findCodecByMimeType=(e,t)=>e.find((e=>e.mimeType.toLowerCase()===t.mimeType.toLowerCase()))?t:void 0,t.defaultPeerConfig=g()},8007:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RedHeader=t.Red=void 0;const s=r(962),n=(0,s.debug)("packages/rtp/src/rtp/red/packet.ts");class i{constructor(){this.blocks=[]}static deSerialize(e){const t=e instanceof ArrayBuffer?Buffer.from(e):e,r=new i;let s=0;return[r.header,s]=o.deSerialize(t),r.header.fields.forEach((({blockLength:e,timestampOffset:n,blockPT:i})=>{if(e&&n){const o=t.subarray(s,s+e);r.blocks.push({block:o,blockPT:i,timestampOffset:n}),s+=e}else{const e=t.subarray(s);r.blocks.push({block:e,blockPT:i})}})),r}serialize(){this.header=new o;for(const{timestampOffset:e,blockPT:t,block:r}of this.blocks)e?this.header.fields.push({fBit:1,blockPT:t,blockLength:r.length,timestampOffset:e}):this.header.fields.push({fBit:0,blockPT:t});let e=this.header.serialize();for(const{block:t}of this.blocks)e=Buffer.concat([e,t]);return e}}t.Red=i;class o{constructor(){this.fields=[]}static deSerialize(e){let t=0;const r=new o;for(;;){const n={};r.fields.push(n);const i=new s.BitStream(e.subarray(t));if(n.fBit=i.readBits(1),n.blockPT=i.readBits(7),t++,0===n.fBit)break;n.timestampOffset=i.readBits(14),n.blockLength=i.readBits(10),t+=3}return[r,t]}serialize(){let e=Buffer.alloc(0);for(const t of this.fields)try{if(t.timestampOffset&&t.blockLength){const r=new s.BitStream(Buffer.alloc(4)).writeBits(1,t.fBit).writeBits(7,t.blockPT).writeBits(14,t.timestampOffset).writeBits(10,t.blockLength);e=Buffer.concat([e,r.uint8Array])}else{const r=new s.BitStream(Buffer.alloc(1)).writeBits(1,0).writeBits(7,t.blockPT);e=Buffer.concat([e,r.uint8Array])}}catch(e){n(e?.message)}return e}}t.RedHeader=o},8028:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sha224=t.sha256=t.SHA256=void 0;const s=r(2971),n=r(1609),i=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),o=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),a=new Uint32Array(64);class c extends s.HashMD{constructor(){super(64,32,8,!1),this.A=0|o[0],this.B=0|o[1],this.C=0|o[2],this.D=0|o[3],this.E=0|o[4],this.F=0|o[5],this.G=0|o[6],this.H=0|o[7]}get(){const{A:e,B:t,C:r,D:s,E:n,F:i,G:o,H:a}=this;return[e,t,r,s,n,i,o,a]}set(e,t,r,s,n,i,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|s,this.E=0|n,this.F=0|i,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)a[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=a[e-15],r=a[e-2],s=(0,n.rotr)(t,7)^(0,n.rotr)(t,18)^t>>>3,i=(0,n.rotr)(r,17)^(0,n.rotr)(r,19)^r>>>10;a[e]=i+a[e-7]+s+a[e-16]|0}let{A:r,B:o,C:c,D:u,E:l,F:d,G:h,H:p}=this;for(let e=0;e<64;e++){const t=p+((0,n.rotr)(l,6)^(0,n.rotr)(l,11)^(0,n.rotr)(l,25))+(0,s.Chi)(l,d,h)+i[e]+a[e]|0,f=((0,n.rotr)(r,2)^(0,n.rotr)(r,13)^(0,n.rotr)(r,22))+(0,s.Maj)(r,o,c)|0;p=h,h=d,d=l,l=u+t|0,u=c,c=o,o=r,r=t+f|0}r=r+this.A|0,o=o+this.B|0,c=c+this.C|0,u=u+this.D|0,l=l+this.E|0,d=d+this.F|0,h=h+this.G|0,p=p+this.H|0,this.set(r,o,c,u,l,d,h,p)}roundClean(){a.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}t.SHA256=c;class u extends c{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}t.sha256=(0,n.wrapConstructor)((()=>new c)),t.sha224=(0,n.wrapConstructor)((()=>new u))},8076:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CumulativeResult=void 0;const s=r(6252);t.CumulativeResult=class{constructor(){this.numPackets=0,this.totalSize=0,this.firstPacketSentAtMs=0,this.lastPacketSentAtMs=0,this.firstPacketReceivedAtMs=0,this.lastPacketReceivedAtMs=0}addPacket(e,t,r){0===this.numPackets?(this.firstPacketSentAtMs=t,this.firstPacketReceivedAtMs=r,this.lastPacketSentAtMs=t,this.lastPacketReceivedAtMs=r):(t<this.firstPacketSentAtMs&&(this.firstPacketSentAtMs=t),r<this.firstPacketReceivedAtMs&&(this.firstPacketReceivedAtMs=r),t>this.lastPacketSentAtMs&&(this.lastPacketSentAtMs=t),r>this.lastPacketReceivedAtMs&&(this.lastPacketReceivedAtMs=r)),this.numPackets++,this.totalSize+=e}reset(){this.numPackets=0,this.totalSize=0,this.firstPacketSentAtMs=0,this.lastPacketSentAtMs=0,this.firstPacketReceivedAtMs=0,this.lastPacketReceivedAtMs=0}get receiveBitrate(){const e=this.lastPacketReceivedAtMs-this.firstPacketReceivedAtMs,t=this.totalSize/e*8*1e3;return(0,s.Int)(t)}get sendBitrate(){const e=this.lastPacketSentAtMs-this.firstPacketSentAtMs,t=this.totalSize/e*8*1e3;return(0,s.Int)(t)}}},8114:(e,t)=>{"use strict";function r(){let e;globalThis.gc||console.warn("rpc peer garbage collection not available: global.gc is not exposed.");try{e=globalThis}catch(e){}let t=0;return setInterval((()=>{const r=Date.now(),s=r-t,n=i.remotesCreated;i.remotesCreated=0;const o=i.remotesCollected;i.remotesCollected=0,(n||o||s>3e5)&&(t=r,e?.gc?.())}),1e4)}Object.defineProperty(t,"__esModule",{value:!0}),t.RpcPeer=t.RPCResultError=void 0,t.startPeriodicGarbageCollection=r,t.getEvalSource=function(){return`\n    (() => {\n        ${s}\n\n        ${i}\n\n        ${r}\n\n        return {\n            startPeriodicGarbageCollection,\n            RpcPeer,\n            RpcProxy,\n        };\n    })();\n    `};class s{constructor(e,t,r,s,n){this.peer=e,this.entry=t,this.constructorName=r,this.proxyProps=s,this.proxyOneWayMethods=n}toPrimitive(){const e=this.peer;return`RpcProxy-${e.selfName}:${e.peerName}: ${this.constructorName}`}get(e,t,r){if(t===Symbol.asyncIterator){if(!this.proxyProps?.[Symbol.asyncIterator.toString()])return;return()=>new Proxy((()=>{}),this)}if(s.iteratorMethods.has(t?.toString())){const e=this.proxyProps?.[Symbol.asyncIterator.toString()]?.[t];if(e)return new Proxy((()=>e),this)}if(t===i.PROPERTY_PROXY_ID)return this.entry.id;if("__proxy_constructor"===t)return this.constructorName;if(t===i.PROPERTY_PROXY_PEER)return this.peer;if(t===i.PROPERTY_PROXY_PROPERTIES)return this.proxyProps;if(t===i.PROPERTY_PROXY_ONEWAY_METHODS)return this.proxyOneWayMethods;if(t===i.PROPERTY_JSON_DISABLE_SERIALIZATION||t===i.PROPERTY_JSON_COPY_SERIALIZE_CHILDREN)return;if("then"===t)return;if("constructor"===t)return;if(void 0!==this.proxyProps?.[t])return this.proxyProps?.[t];const n=i.handleFunctionInvocations(this,e,t,r);return n||new Proxy((()=>t),this)}set(e,t,r,s){return t===i.finalizerIdSymbol?this.entry.finalizerId=r:(this.proxyProps||={},this.proxyProps[t]=r),!0}apply(e,t,r){const s=e()||null,i=this.proxyOneWayMethods?.includes?.(s);if(Object.isFrozen(this.peer.pendingResults))return i?Promise.resolve():Promise.reject(new n(this.peer,"RpcPeer has been killed (apply) "+e()));const o=[],a={};for(const e of r||[])o.push(this.peer.serialize(e,a));const c={type:"apply",id:void 0,proxyId:this.entry.id,args:o,method:s};if(i)return c.oneway=!0,null===s&&delete c.method,this.peer.send(c,void 0,a),Promise.resolve();const u=this.peer.createPendingResult(s,((e,t)=>{c.id=e,this.peer.send(c,t,a)})),l=this.proxyProps?.[Symbol.asyncIterator.toString()];return!l||s!==l.next&&s!==l.return?u:u.then((e=>s===l.return?{done:!0,value:void 0}:{value:e,done:!1})).catch((e=>{if("StopAsyncIteration"===e.name)return{done:!0,value:void 0};throw e}))}}s.iteratorMethods=new Set(["next","throw","return"]);class n extends Error{constructor(e,t,r,s){super(`${t}\n${e.selfName}:${e.peerName}`),this.cause=r,s?.name&&(this.name=s?.name),s?.stack&&(this.stack=`${r?.stack||s.stack}\n${e.peerName}:${e.selfName}`)}}t.RPCResultError=n;try{}catch(e){window.WeakRef=class{constructor(e){this.target=e}deref(){return this.target}},window.FinalizationRegistry=class{register(){}}}class i{static isRpcProxy(e){return!!e?.[i.PROPERTY_PROXY_ID]}static getDefaultTransportSafeArgumentTypes(){const e=new Set;return e.add(Number.name),e.add(String.name),e.add(Object.name),e.add(Boolean.name),e.add(Array.name),e}static handleFunctionInvocations(e,t,r,s){return"apply"===r?(r,s)=>e.apply(t,e,s):"call"===r?(r,...s)=>e.apply(t,e,s):"toString"===r||r===Symbol.toPrimitive?(t,...r)=>e.toPrimitive():void 0}static getIteratorNext(e){if(!e[Symbol.asyncIterator])return;const t=e[this.PROPERTY_PROXY_PROPERTIES]?.[Symbol.asyncIterator.toString()];return t?.next||"next"}static prepareProxyProperties(e){let t=e?.[i.PROPERTY_PROXY_PROPERTIES];return e[Symbol.asyncIterator]?(t||={},t[Symbol.asyncIterator.toString()]||(t[Symbol.asyncIterator.toString()]={next:"next",throw:"throw",return:"return"}),t):t}constructor(e,t,r){this.selfName=e,this.peerName=t,this.send=r,this.params={},this.pendingResults={},this.localProxied=new Map,this.localProxyMap=new Map,this.remoteWeakProxies={},this.finalizers=new FinalizationRegistry((e=>this.finalize(e))),this.nameDeserializerMap=new Map,this.onProxyTypeSerialization=new Map,this.constructorSerializerMap=new Map,this.transportSafeArgumentTypes=i.getDefaultTransportSafeArgumentTypes(),this.tags={},this.yieldedAsyncIterators=new Set,this.killed=new Promise(((e,t)=>{this.killedDeferred={resolve:e,reject:t,method:void 0}})).catch((e=>e.message||"Unknown Error")),this.killedSafe=this.killed.then((()=>{})).catch((()=>{}))}static isTransportSafe(e){return!e||!e[Symbol.asyncIterator]&&!e[i.PROPERTY_JSON_DISABLE_SERIALIZATION]&&this.getDefaultTransportSafeArgumentTypes().has(e.constructor?.name)}isTransportSafe(e){return!e||!e[Symbol.asyncIterator]&&!e[i.PROPERTY_JSON_DISABLE_SERIALIZATION]&&this.transportSafeArgumentTypes.has(e.constructor?.name)}static generateId(){return[...new Array(8)].map((()=>i.RANDOM_DIGITS.charAt(Math.floor(Math.random()*i.RANDOM_DIGITS.length)))).join("")}createPendingResult(e,t){if(Object.isFrozen(this.pendingResults))return Promise.reject(new n(this,"RpcPeer has been killed (createPendingResult)"));const r=new Promise(((r,s)=>{const o=i.generateId();this.pendingResults[o]={resolve:r,reject:s,method:e},t(o,(e=>s(new n(this,e.message,e))))}));return r.catch((()=>{})),r}kill(e){if(Object.isFrozen(this.pendingResults))return;const t=new n(this,e||"peer was killed");this.killedDeferred.reject(t);for(const e of Object.values(this.pendingResults))e.reject(t);for(const e of this.yieldedAsyncIterators)e.throw(t).catch((()=>{}));this.yieldedAsyncIterators.clear(),this.pendingResults=Object.freeze({}),this.params=Object.freeze({}),this.remoteWeakProxies=Object.freeze({}),this.localProxyMap.clear(),this.localProxied.clear()}addSerializer(e,t,r){this.nameDeserializerMap.set(t,r),this.constructorSerializerMap.set(e,t)}finalize(e){i.remotesCollected++,delete this.remoteWeakProxies[e.id];const t={__local_proxy_id:e.id,__local_proxy_finalizer_id:e.finalizerId,type:"finalize"};this.send(t)}async getParam(e){return this.createPendingResult("getParam",((t,r)=>{const s={id:t,type:"param",param:e};this.send(s,r)}))}createErrorResult(e,t){return e.result=this.serializeError(t),e.throw=!0,e}deserialize(e,t){if(!e)return e;const r=e[i.PROPERTY_JSON_COPY_SERIALIZE_CHILDREN];if(r){if(Array.isArray(r)){const e=[];for(const s of r)e.push(this.deserialize(s,t));return e}const s={};for(const[r,n]of Object.entries(e))s[r]=this.deserialize(n,t);return s}const{__remote_proxy_id:s,__remote_proxy_finalizer_id:o,__local_proxy_id:a,__remote_constructor_name:c,__serialized_value:u,__remote_proxy_props:l,__remote_proxy_oneway_methods:d}=e;if(c===i.RPC_RESULT_ERROR_NAME)return this.deserializeError(u);if(s){let e=this.remoteWeakProxies[s]?.deref();e||(e=this.newProxy(s,c,l,d)),e[i.finalizerIdSymbol]=o;const r=this.nameDeserializerMap.get(c);return r?r.deserialize(e,t):e}if(a){const e=this.localProxyMap.get(a);if(!e)throw new n(this,`invalid local proxy id ${a}`);return e}const h=this.nameDeserializerMap.get(c);return h?h.deserialize(u,t):e}deserializeError(e){const{name:t,stack:r,message:s}=e;return new n(this,s,void 0,{name:t,stack:r})}serializeError(e){const t={stack:e.stack||"[no stack]",name:e.name||"[no name]",message:e.message||"[no message]"};return{__remote_constructor_name:i.RPC_RESULT_ERROR_NAME,__remote_proxy_id:void 0,__remote_proxy_finalizer_id:void 0,__remote_proxy_oneway_methods:void 0,__remote_proxy_props:void 0,__serialized_value:t}}serialize(e,t){if(!0===e?.[i.PROPERTY_JSON_COPY_SERIALIZE_CHILDREN]){if(Array.isArray(e)){const r=[];for(const s of e)r.push(this.serialize(s,t));return{[i.PROPERTY_JSON_COPY_SERIALIZE_CHILDREN]:r}}const r={};for(const[s,n]of Object.entries(e))r[s]=this.serialize(n,t);return r}if(this.isTransportSafe(e))return e;let r=e.__proxy_constructor||e.constructor?.name?.toString();if(e instanceof Error)return this.serializeError(e);const s=this.constructorSerializerMap.get(e.constructor);if(s){r=s;const n=this.nameDeserializerMap.get(s);if(!n)throw new Error("serializer not found for "+s);const o=n.serialize(e,t);return{__remote_proxy_id:void 0,__remote_proxy_finalizer_id:void 0,__remote_constructor_name:r,__remote_proxy_props:i.prepareProxyProperties(e),__remote_proxy_oneway_methods:e?.[i.PROPERTY_PROXY_ONEWAY_METHODS],__serialized_value:o}}let n=this.localProxied.get(e);if(n){const{proxyId:t,properties:s}=this.onProxySerialization?.(e)||{proxyId:n.id,properties:i.prepareProxyProperties(e)};if(t!==n.id)throw new Error("onProxySerialization proxy id mismatch");const o=i.generateId();n.finalizerId=o;return{__remote_proxy_id:t,__remote_proxy_finalizer_id:o,__remote_constructor_name:r,__remote_proxy_props:s,__remote_proxy_oneway_methods:e?.[i.PROPERTY_PROXY_ONEWAY_METHODS]}}const{__proxy_id:o,__proxy_peer:a}=e;if(o&&a===this){return{__local_proxy_id:o}}this.onProxyTypeSerialization.get(r)?.(e);const{proxyId:c,properties:u}=this.onProxySerialization?.(e)||{proxyId:i.generateId(),properties:i.prepareProxyProperties(e)};n={id:c,finalizerId:c},this.localProxied.set(e,n),this.localProxyMap.set(c,e);return{__remote_proxy_id:c,__remote_proxy_finalizer_id:c,__remote_constructor_name:r,__remote_proxy_props:u,__remote_proxy_oneway_methods:e?.[i.PROPERTY_PROXY_ONEWAY_METHODS]}}newProxy(e,t,r,n){i.remotesCreated++;const o={id:e,finalizerId:void 0},a=new s(this,o,t,r,n),c=new Proxy("Function"===t||"AsyncFunction"===t?function(){}:a,a),u=new WeakRef(c);return this.remoteWeakProxies[e]=u,this.finalizers.register(a,o),c}handleMessage(e,t){try{i.activeRpcPeer=this,this.handleMessageInternal(e,t)}finally{i.activeRpcPeer=void 0}}sendResult(e,t){this.send(e,(r=>{this.send(this.createErrorResult(e,r),void 0,t)}),t)}async handleMessageInternal(e,t){if(!Object.isFrozen(this.pendingResults))try{switch(e.type){case"param":{const t=e,r={};let s;try{s={type:"result",id:t.id,result:this.serialize(this.params[t.param],r)}}catch(e){this.createErrorResult(s,e)}this.sendResult(s,r);break}case"apply":{const r=e,s={type:"result",id:r.id||""},o={};try{const e=this.localProxyMap.get(r.proxyId);if(!e)throw new Error(`proxy id ${r.proxyId} not found`);const a=[];for(const e of r.args||[])a.push(this.deserialize(e,t));let c;if(r.method){if(!e[r.method])throw new Error(`target ${e?.constructor?.name} does not have method ${r.method}`);const t=i.getIteratorNext(e)===r.method;if(t&&this.yieldedAsyncIterators.delete(e),c=await e[r.method](...a),t){if(c.done){throw{name:"StopAsyncIteration",message:void 0}}Object.isFrozen(this.pendingResults)?e.throw(new n(this,"RpcPeer has been killed (yield)")).catch((()=>{})):this.yieldedAsyncIterators.add(e),c=c.value}}else c=await e(...a);s.result=this.serialize(c,o)}catch(e){this.createErrorResult(s,e)}r.oneway||this.sendResult(s,o);break}case"result":{const r=e,s=this.pendingResults[r.id];if(delete this.pendingResults[r.id],!s)throw new Error(`unknown result ${r.id}`);const n=this.deserialize(r.result,t);r.throw?s.reject(n):s.resolve(n);break}case"finalize":{const t=e,r=this.localProxyMap.get(t.__local_proxy_id);if(r){const e=this.localProxied.get(r);if(t.__local_proxy_finalizer_id&&t.__local_proxy_finalizer_id!==e?.finalizerId)break;this.localProxyMap.delete(t.__local_proxy_id),this.localProxied.delete(r)}break}default:throw new Error(`unknown rpc message type ${e.type}`)}}catch(e){return void console.error("unhandled rpc error",this.peerName,e)}}}t.RpcPeer=i,i.finalizerIdSymbol=Symbol("rpcFinalizerId"),i.remotesCollected=0,i.remotesCreated=0,i.RANDOM_DIGITS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i.RPC_RESULT_ERROR_NAME="RPCResultError",i.PROPERTY_PROXY_ID="__proxy_id",i.PROPERTY_PROXY_PEER="__proxy_peer",i.PROPERTY_PROXY_ONEWAY_METHODS="__proxy_oneway_methods",i.PROPERTY_JSON_DISABLE_SERIALIZATION="__json_disable_serialization",i.PROPERTY_PROXY_PROPERTIES="__proxy_props",i.PROPERTY_JSON_COPY_SERIALIZE_CHILDREN="__json_copy_serialize_children",i.PROBED_PROPERTIES=new Set(["then","constructor","__proxy_id","__proxy_constructor",i.PROPERTY_PROXY_PEER,i.PROPERTY_PROXY_ONEWAY_METHODS,i.PROPERTY_JSON_DISABLE_SERIALIZATION,i.PROPERTY_PROXY_PROPERTIES,i.PROPERTY_JSON_COPY_SERIALIZE_CHILDREN])},8119:(e,t,r)=>{"use strict";const s=r(6444);e.exports=function(e,t,r,n){let i=n,o=r;for(let r=i;r+4<t.length;r+=4){const s=t.readUInt32LE(r)^o;o=e[0][s>>>24&255]^e[1][s>>>16&255]^e[2][s>>>8&255]^e[3][255&s],i+=4}return s(e,t,o,i)}},8138:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DtlsContext=void 0;const s=(0,r(5205).debug)("werift-dtls : packages/dtls/src/context/dtls.ts : log");t.DtlsContext=class{constructor(e,t){this.options=e,this.sessionType=t,this.version={major:254,minor:253},this.lastFlight=[],this.lastMessage=[],this.recordSequenceNumber=0,this.sequenceNumber=0,this.epoch=0,this.flight=0,this.handshakeCache={},this.requestedCertificateTypes=[],this.requestedSignatureAlgorithms=[],this.remoteExtendedMasterSecret=!1,this.checkHandshakesExist=e=>!e.find((e=>null==this.sortedHandshakeCache.find((t=>t.msg_type===e))))}get sessionId(){return this.cookie?this.cookie.toString("hex").slice(0,10):""}get sortedHandshakeCache(){return Object.entries(this.handshakeCache).sort((([e],[t])=>Number(e)-Number(t))).flatMap((([,{data:e}])=>e.sort(((e,t)=>e.message_seq-t.message_seq))))}bufferHandshakeCache(e,t,r){this.handshakeCache[r]||(this.handshakeCache[r]={data:[],isLocal:t,flight:r});const n=e.filter((e=>{const n=this.handshakeCache[r].data.find((t=>t.msg_type===e.msg_type));return!n||(s(this.sessionId,"exist",n.summary,t,r),!1)}));this.handshakeCache[r].data=[...this.handshakeCache[r].data,...n]}}},8167:e=>{"use strict";e.exports=require("worker_threads")},8172:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReceiverTWCC=void 0;const s=r(6460),n=r(5433),i=r(6252),o=r(8806),a=(0,i.debug)("werift:packages/webrtc/media/receiver/receiverTwcc");t.ReceiverTWCC=class{constructor(e,t,r){this.dtlsTransport=e,this.rtcpSsrc=t,this.mediaSourceSsrc=r,this.extensionInfo={},this.twccRunning=!1,this.fbPktCount=0,this.runTWCC()}handleTWCC(e){this.extensionInfo[e]={tsn:e,timestamp:(0,o.microTime)()},Object.keys(this.extensionInfo).length>10&&this.sendTWCC()}async runTWCC(){for(;this.twccRunning;)this.sendTWCC(),await(0,s.setTimeout)(100)}sendTWCC(){if(0===Object.keys(this.extensionInfo).length)return;const e=Object.values(this.extensionInfo).sort(((e,t)=>e.tsn-t.tsn)),t=e[0].tsn,r=e.slice(-1)[0].tsn,s=[],o=e[0].tsn,c=(0,n.uint16Add)(r-t,1);let u,l;const d=[];for(let e=t;e<=r;e++){const t=this.extensionInfo[e]?.timestamp;if(t){this.lastTimestamp||(this.lastTimestamp=t),u||(u=this.lastTimestamp);const n=t-this.lastTimestamp;this.lastTimestamp=t;const o=new i.RecvDelta({delta:Number(n)});o.parseDelta(),d.push(o),null!=l&&l.status!==o.type&&(s.push(new i.RunLengthChunk({packetStatus:l.status,runLength:e-l.minTSN})),l={minTSN:e,status:o.type}),e===r&&(null!=l?s.push(new i.RunLengthChunk({packetStatus:l.status,runLength:e-l.minTSN+1})):s.push(new i.RunLengthChunk({packetStatus:o.type,runLength:1}))),null==l&&(l={minTSN:e,status:o.type})}}if(!u)return;const h=new i.RtcpTransportLayerFeedback({feedback:new i.TransportWideCC({senderSsrc:this.rtcpSsrc,mediaSourceSsrc:this.mediaSourceSsrc,baseSequenceNumber:o,packetStatusCount:c,referenceTime:(0,n.uint24)(Math.floor(Number(u/1000n/64n))),fbPktCount:this.fbPktCount,recvDeltas:d,packetChunks:s})});this.dtlsTransport.sendRtcp([h]).catch((e=>{a(e)})),this.extensionInfo={},this.fbPktCount=(0,n.uint8Add)(this.fbPktCount,1)}}},8176:e=>{"use strict";e.exports=class extends Error{constructor(e,t){super(`requested ${e} bytes but only ${t} available`),this.name="NotEnoughDataError"}}},8195:(e,t)=>{"use strict";t.toString=function(e){switch(e){case 0:return"QUERY";case 1:return"IQUERY";case 2:return"STATUS";case 3:return"OPCODE_3";case 4:return"NOTIFY";case 5:return"UPDATE";case 6:return"OPCODE_6";case 7:return"OPCODE_7";case 8:return"OPCODE_8";case 9:return"OPCODE_9";case 10:return"OPCODE_10";case 11:return"OPCODE_11";case 12:return"OPCODE_12";case 13:return"OPCODE_13";case 14:return"OPCODE_14";case 15:return"OPCODE_15"}return"OPCODE_"+e},t.toOpcode=function(e){switch(e.toUpperCase()){case"QUERY":return 0;case"IQUERY":return 1;case"STATUS":return 2;case"OPCODE_3":return 3;case"NOTIFY":return 4;case"UPDATE":return 5;case"OPCODE_6":return 6;case"OPCODE_7":return 7;case"OPCODE_8":return 8;case"OPCODE_9":return 9;case"OPCODE_10":return 10;case"OPCODE_11":return 11;case"OPCODE_12":return 12;case"OPCODE_13":return 13;case"OPCODE_14":return 14;case"OPCODE_15":return 15}return 0}},8241:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChangeCipherSpec=void 0;const s=r(6353);class n{constructor(e=1){this.type=e}static createEmpty(){return new n}static deSerialize(e){return new n(...Object.values((0,s.decode)(e,n.spec)))}serialize(){const e=(0,s.encode)(this,n.spec).slice();return Buffer.from(e)}}t.ChangeCipherSpec=n,n.spec={type:s.types.uint8}},8246:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TcpTransport=t.UdpTransport=void 0;const n=r(7194),i=s(r(9278)),o=r(9278),a=r(673),c=r(7449),u=(0,a.debug)("werift-ice:packages/ice/src/transport.ts");class l{constructor(e,t={}){this.socketType=e,this.options=t,this.type="udp",this.onData=()=>{},this.closed=!1,this.send=async(e,t)=>{if(t&&!i.default.isIP(t[0]))return new Promise(((r,s)=>{this.socket.send(e,t[1],t[0],(n=>{n?(u("send error",t,e),s(n)):r()}))}));t=t??[this.rinfo?.address,this.rinfo?.port],this.socket.send(e,t[1],t[0])},this.close=()=>new Promise((e=>{this.closed=!0,this.socket.once("close",e);try{this.socket.close()}catch(t){e()}})),this.socket=(0,n.createSocket)(e),this.socket.on("message",((e,t)=>{6===(0,c.normalizeFamilyNodeV18)(t.family)&&([t.address]=t.address.split("%")),this.rinfo=t;try{this.onData(e,[t.address,t.port])}catch(e){u("onData error",e)}}))}static async init(e,t={}){const r=new l(e,t);return await r.init(),r}async init(){const e=(0,c.interfaceAddress)(this.socketType,this.options.interfaceAddresses);if(this.options.port)this.socket.bind({port:this.options.port,address:e});else if(this.options.portRange){const t=await(0,c.findPort)(this.options.portRange[0],this.options.portRange[1],this.socketType,this.options.interfaceAddresses);this.socket.bind({port:t,address:e})}else this.socket.bind({address:e});await new Promise((e=>this.socket.once("listening",e)))}get address(){return this.socket.address()}get host(){return this.socket.address().address}get port(){return this.socket.address().port}}t.UdpTransport=l;class d{constructor(e){this.addr=e,this.type="tcp",this.onData=()=>{},this.closed=!1,this.send=async(e,t)=>{await this.connecting,this.client.write(e,(e=>{e&&console.log("err",e)}))},this.close=async()=>{this.closed=!0,this.client.destroy()},this.connect()}connect(){this.closed||(this.client&&this.client.destroy(),this.connecting=new Promise(((e,t)=>{try{this.client=(0,o.connect)({port:this.addr[1],host:this.addr[0]},e)}catch(e){t(e)}})),this.client.on("data",(e=>{const t=[this.client.remoteAddress,this.client.remotePort];this.onData(e,t)})),this.client.on("end",(()=>{this.connect()})),this.client.on("error",(e=>{console.log("error",e)})))}async init(){await this.connecting}static async init(e){const t=new d(e);return await t.init(),t}get address(){return{}}}t.TcpTransport=d},8341:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vp8RtpPayload=void 0;const s=r(9543);class n{constructor(){this.size0=0,this.size1=0,this.size2=0}static deSerialize(e){const t=new n;let r=0;if(t.xBit=(0,s.getBit)(e[r],0),t.nBit=(0,s.getBit)(e[r],2),t.sBit=(0,s.getBit)(e[r],3),t.pid=(0,s.getBit)(e[r],5,3),r++,t.xBit&&(t.iBit=(0,s.getBit)(e[r],0),t.lBit=(0,s.getBit)(e[r],1),t.tBit=(0,s.getBit)(e[r],2),t.kBit=(0,s.getBit)(e[r],3),r++),t.iBit)if(t.mBit=(0,s.getBit)(e[r],0),t.mBit){const n=(0,s.paddingByte)((0,s.getBit)(e[r],1,7)),i=(0,s.paddingByte)(e[r+1]);t.pictureId=Number.parseInt(n+i,2),r+=2}else t.pictureId=(0,s.getBit)(e[r],1,7),r++;return t.lBit&&r++,(t.lBit||t.kBit)&&(t.tBit,t.kBit,r++),t.payload=e.subarray(r),t.payloadHeaderExist&&(t.size0=(0,s.getBit)(e[r],0,3),t.hBit=(0,s.getBit)(e[r],3),t.ver=(0,s.getBit)(e[r],4,3),t.pBit=(0,s.getBit)(e[r],7),r++,t.size1=e[r],r++,t.size2=e[r]),t}static isDetectedFinalPacketInSequence(e){return e.marker}get isKeyframe(){return 0===this.pBit}get isPartitionHead(){return 1===this.sBit}get payloadHeaderExist(){return 1===this.sBit&&0===this.pid}get size(){if(this.payloadHeaderExist){return this.size0+8*this.size1+2048*this.size2}return 0}}t.Vp8RtpPayload=n},8383:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SDPManager=void 0;const s=r(6448),n=r(4582),i=r(4262),o=r(6779),a=r(8806);t.SDPManager=class{constructor({cname:e,midSuffix:t,bundlePolicy:r}){this.seenMid=new Set,this.cname=e,this.midSuffix=t??!1,this.bundlePolicy=r}get localDescription(){if(this._localDescription)return this._localDescription.toJSON()}get remoteDescription(){if(this._remoteDescription)return this._remoteDescription.toJSON()}get _localDescription(){return this.pendingLocalDescription||this.currentLocalDescription}get _remoteDescription(){return this.pendingRemoteDescription||this.currentRemoteDescription}get inactiveRemoteMedia(){return this._remoteDescription?.media?.find?.((e=>"inactive"===e.direction))}createMediaDescriptionForTransceiver(e,t){const r=new i.MediaDescription(e.kind,9,"UDP/TLS/RTP/SAVPF",e.codecs.map((e=>e.payloadType)));return r.direction=t,r.msid=e.msid,r.rtp={codecs:e.codecs,headerExtensions:e.headerExtensions,muxId:e.mid},r.rtcpHost="0.0.0.0",r.rtcpPort=9,r.rtcpMux=!0,r.ssrc=[new i.SsrcDescription({ssrc:e.sender.ssrc,cname:this.cname})],e.options.simulcast&&(r.simulcastParameters=e.options.simulcast.map((e=>new n.RTCRtpSimulcastParameters(e)))),r.rtp.codecs.find((e=>"rtx"===e.name.toLowerCase()))&&(r.ssrc.push(new i.SsrcDescription({ssrc:e.sender.rtxSsrc,cname:this.cname})),r.ssrcGroup=[new i.GroupDescription("FID",[e.sender.ssrc.toString(),e.sender.rtxSsrc.toString()])]),this.addTransportDescription(r,e.dtlsTransport),r}createMediaDescriptionForSctp(e){const t=new i.MediaDescription("application",s.DISCARD_PORT,"UDP/DTLS/SCTP",["webrtc-datachannel"]);return t.sctpPort=e.port,t.rtp.muxId=e.mid,t.sctpCapabilities=o.RTCSctpTransport.getCapabilities(),this.addTransportDescription(t,e.dtlsTransport),t}addTransportDescription(e,t){const r=t.iceTransport;e.iceCandidates=r.localCandidates,e.iceCandidatesComplete="complete"===r.gatheringState,e.iceParams=r.localParameters,e.iceOptions="trickle",e.host=s.DISCARD_HOST,e.port=s.DISCARD_PORT,"inactive"===e.direction&&(e.port=0,e.msid=void 0),e.dtlsParams||(e.dtlsParams=t.localParameters,e.dtlsParams.fingerprints||(e.dtlsParams.fingerprints=t.localParameters.fingerprints))}allocateMid(e=""){let t="";for(let r=0;t=(r++).toString()+e,this.seenMid.has(t););return this.seenMid.add(t),t}parseSdp({sdp:e,isLocal:t,signalingState:r,type:s}){const n=i.SessionDescription.parse(e);return this.validateDescription({description:n,isLocal:t,signalingState:r}),n.type=s,n}validateDescription({description:e,isLocal:t,signalingState:r}){if(t){if("offer"===e.type){if(!["stable","have-local-offer"].includes(r))throw new Error("Cannot handle offer in signaling state")}else if("answer"===e.type&&!["have-remote-offer","have-local-pranswer"].includes(r))throw new Error("Cannot handle answer in signaling state")}else if("offer"===e.type){if(!["stable","have-remote-offer"].includes(r))throw new Error("Cannot handle offer in signaling state")}else if("answer"===e.type&&!["have-local-offer","have-remote-pranswer"].includes(r))throw new Error("Cannot handle answer in signaling state")}buildOfferSdp(e,t){const r=new i.SessionDescription;(0,i.addSDPHeader)("offer",r);(this.currentLocalDescription?.media??[]).forEach(((s,n)=>{const i=s.rtp.muxId;if(i)if("application"===s.kind){if(!t)throw new Error("sctpTransport not found");t.mLineIndex=n,r.media.push(this.createMediaDescriptionForSctp(t))}else{const t=e.find((e=>e.mid===i));if(!t){if("inactive"===s.direction)return void r.media.push(s);throw new Error("transceiver not found")}t.mLineIndex=n,r.media.push(this.createMediaDescriptionForTransceiver(t,t.direction))}}));for(const t of e.filter((e=>!r.media.find((t=>t.rtp.muxId===e.mid))))){null==t.mid&&(t.mid=this.allocateMid(this.midSuffix?"av":""));const e=this.createMediaDescriptionForTransceiver(t,t.direction);void 0===t.mLineIndex?(t.mLineIndex=r.media.length,r.media.push(e)):r.media[t.mLineIndex]=e}if(t&&!r.media.find((e=>"application"===e.kind))&&(t.mLineIndex=r.media.length,null==t.mid&&(t.mid=this.allocateMid(this.midSuffix?"dc":"")),r.media.push(this.createMediaDescriptionForSctp(t))),"disable"!==this.bundlePolicy){const e=r.media.map((e=>"inactive"!==e.direction?e.rtp.muxId:void 0)).filter((e=>e));if(e.length){const t=new i.GroupDescription("BUNDLE",e);r.group.push(t)}}return r}buildAnswerSdp({transceivers:e,sctpTransport:t,signalingState:r}){if(!["have-remote-offer","have-local-pranswer"].includes(r))throw new Error("createAnswer failed");if(!this._remoteDescription)throw new Error("wrong state");const s=new i.SessionDescription;(0,i.addSDPHeader)("answer",s);for(const r of this._remoteDescription.media){let n,i;if(["audio","video"].includes(r.kind)){const t=e.find((e=>e.mid===r.rtp.muxId));if(!t)throw new Error(`Transceiver with mid=${r.rtp.muxId} not found`);i=this.createMediaDescriptionForTransceiver(t,(0,a.andDirection)(t.direction,t.offerDirection)),n=t.dtlsTransport}else{if("application"!==r.kind)throw new Error("invalid kind");if(!t||!t.mid)throw new Error("sctpTransport not found");i=this.createMediaDescriptionForSctp(t),n=t.dtlsTransport}i.dtlsParams&&("auto"===n.role?i.dtlsParams.role="client":i.dtlsParams.role=n.role),r.simulcastParameters&&r.simulcastParameters.length>0&&(i.simulcastParameters=r.simulcastParameters.map((e=>({...e,direction:"send"===e.direction?"recv":"send"})))),s.media.push(i)}if("disable"!==this.bundlePolicy){const e=new i.GroupDescription("BUNDLE",[]);for(const t of s.media)"inactive"!==t.direction&&e.items.push(t.rtp.muxId);s.group.push(e)}return s}setLocalDescription(e){this.currentLocalDescription=e,"answer"===e.type?this.pendingLocalDescription=void 0:this.pendingLocalDescription=e}setRemoteDescription(e,t){if(!e.sdp||!e.type||"rollback"===e.type||"pranswer"===e.type)throw new Error("invalid sessionDescription");const r=this.parseSdp({sdp:e.sdp,isLocal:!1,signalingState:t,type:e.type});return"answer"===r.type?(this.currentRemoteDescription=r,this.pendingRemoteDescription=void 0):this.pendingRemoteDescription=r,r}registerMid(e){this.seenMid.add(e)}get remoteIsBundled(){const e=this._remoteDescription;if(!e)return;return e.group.find((e=>"BUNDLE"===e.semantic&&"disable"!==this.bundlePolicy))}setLocal(e,t,r){e.media.filter((e=>["audio","video"].includes(e.kind))).forEach(((e,r)=>{this.addTransportDescription(e,t[r].dtlsTransport)}));const s=e.media.find((e=>"application"===e.kind));r&&s&&this.addTransportDescription(s,r.dtlsTransport),this.setLocalDescription(e)}}},8394:(e,t,r)=>{var s=r(8920),n=r(7194),i=r(3049),o=r(4434),a=r(857),c=function(){};function u(e){return 4===e||"IPv4"===e}e.exports=function(e){e||(e={});var t=new o.EventEmitter,r="number"==typeof e.port?e.port:5353,l=e.type||"udp4",d=e.ip||e.host||("udp4"===l?"224.0.0.251":null),h={address:d,port:r},p={},f=!1,g=null;if(!("udp6"!==l||d&&e.interface))throw new Error("For IPv6 multicast you must specify `ip` and `interface`");var m=e.socket||n.createSocket({type:l,reuseAddr:!1!==e.reuseAddr,toString:function(){return l}});m.on("error",(function(e){"EACCES"===e.code||"EADDRINUSE"===e.code?t.emit("error",e):t.emit("warning",e)})),m.on("message",(function(e,r){try{e=s.decode(e)}catch(e){return void t.emit("warning",e)}t.emit("packet",e,r),"query"===e.type&&t.emit("query",e,r),"response"===e.type&&t.emit("response",e,r)})),m.on("listening",(function(){r||(r=h.port=m.address().port),!1!==e.multicast&&(t.update(),g=setInterval(t.update,5e3),m.setMulticastTTL(e.ttl||255),m.setMulticastLoopback(!1!==e.loopback))}));var y=i((function(t){if(!r||!1===e.bind)return t(null);m.once("error",t),m.bind(r,e.bind||e.interface,(function(){m.removeListener("error",t),t(null)}))}));return y((function(e){if(e)return t.emit("error",e);t.emit("ready")})),t.send=function(e,r,n){if("function"==typeof r)return t.send(e,null,r);n||(n=c),r?r.host||r.address||(r.address=h.address):r=h,y((function(t){if(f)return n();if(t)return n(t);var i=s.encode(e);m.send(i,0,i.length,r.port,r.address||r.host,n)}))},t.response=t.respond=function(e,r,n){Array.isArray(e)&&(e={answers:e}),e.type="response",e.flags=(e.flags||0)|s.AUTHORITATIVE_ANSWER,t.send(e,r,n)},t.query=function(e,r,s,n){return"function"==typeof r?t.query(e,null,null,r):"object"==typeof r&&r&&r.port?t.query(e,null,r,s):"function"==typeof s?t.query(e,r,null,s):(n||(n=c),"string"==typeof e&&(e=[{name:e,type:r||"ANY"}]),Array.isArray(e)&&(e={type:"query",questions:e}),e.type="query",void t.send(e,s,n))},t.destroy=function(e){if(e||(e=c),f)return process.nextTick(e);for(var t in f=!0,clearInterval(g),p)try{m.dropMembership(d,t)}catch(e){}p={},m.close(e)},t.update=function(){for(var r=e.interface?[].concat(e.interface):function(){for(var e=a.networkInterfaces(),t=Object.keys(e),r=[],s=0;s<t.length;s++)for(var n=e[t[s]],i=0;i<n.length;i++){var o=n[i];if(u(o.family)){r.push(o.address);break}}return r}(),s=!1,n=0;n<r.length;n++){var i=r[n];if(!p[i])try{m.addMembership(d,i),p[i]=!0,s=!0}catch(e){t.emit("warning",e)}}if(s){if(m.setMulticastInterface)try{m.setMulticastInterface(e.interface||function(){for(var e=a.networkInterfaces(),t=Object.keys(e),r=0;r<t.length;r++)for(var s=e[t[r]],n=0;n<s.length;n++){var i=s[n];if(u(i.family)&&!i.internal)return"darwin"===a.platform()&&"en0"===t[r]?i.address:"0.0.0.0"}return"127.0.0.1"}())}catch(e){t.emit("warning",e)}t.emit("networkInterface")}},t}},8433:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTP_EXTENSION_URI=void 0,t.rtpHeaderExtensionsParser=function(e,r){return e.map((e=>{const s=r[e.id];if(!s)return{uri:"unknown",value:e.payload};switch(s){case t.RTP_EXTENSION_URI.sdesMid:case t.RTP_EXTENSION_URI.sdesRTPStreamID:case t.RTP_EXTENSION_URI.repairedRtpStreamId:return{uri:s,value:n(e.payload)};case t.RTP_EXTENSION_URI.transportWideCC:return{uri:s,value:i(e.payload)};case t.RTP_EXTENSION_URI.absSendTime:return{uri:s,value:o(e.payload)};case t.RTP_EXTENSION_URI.audioLevelIndication:return{uri:s,value:a(e.payload)};case t.RTP_EXTENSION_URI.videoOrientation:return{uri:s,value:c(e.payload)};default:return{uri:s,value:e.payload}}})).reduce(((e,t)=>(t&&(e[t.uri]=t.value),e)),{})},t.serializeSdesMid=function(e){return Buffer.from(e)},t.serializeSdesRTPStreamID=function(e){return Buffer.from(e)},t.serializeRepairedRtpStreamId=function(e){return Buffer.from(e)},t.serializeTransportWideCC=function(e){return(0,s.bufferWriter)([2],[e])},t.serializeAbsSendTime=function(e){const t=Buffer.alloc(3),r=e>>14n&0x00ffffffn;return t.writeUIntBE(Number(r),0,3),t},t.serializeAudioLevelIndication=function(e){const t=new s.BitStream(Buffer.alloc(1));return t.writeBits(1,1),t.writeBits(7,e),t.uint8Array},t.deserializeString=n,t.deserializeUint16BE=i,t.deserializeAbsSendTime=o,t.deserializeAudioLevelIndication=a,t.deserializeVideoOrientation=c;const s=r(9543);function n(e){return e.toString()}function i(e){return e.readUInt16BE()}function o(e){return(0,s.bufferReader)(e,[3])[0]}function a(e){const t=new s.BitStream(e);return{v:1===t.readBits(1),level:t.readBits(7)}}function c(e){const t=new s.BitStream(e);t.readBits(4);return{c:t.readBits(1),f:t.readBits(1),r1:t.readBits(1),r0:t.readBits(1)}}t.RTP_EXTENSION_URI={sdesMid:"urn:ietf:params:rtp-hdrext:sdes:mid",sdesRTPStreamID:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",repairedRtpStreamId:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",transportWideCC:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",absSendTime:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",dependencyDescriptor:"https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension",audioLevelIndication:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",videoOrientation:"urn:3gpp:video-orientation"}},8459:(e,t,r)=>{"use strict";const s=r(8119);e.exports=function(e,t,r,n){let i=n,o=r;for(let r=i;r+8<t.length;r+=8){const s=t.readUInt32LE(r)^o,n=t.readUInt32LE(r+4);o=e[0][n>>>24&255]^e[1][n>>>16&255]^e[2][n>>>8&255]^e[3][255&n]^e[4][s>>>24&255]^e[5][s>>>16&255]^e[6][s>>>8&255]^e[7][255&s],i+=8}return s(e,t,o,i)}},8460:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StreamEndError=void 0,t.read16BELengthLoop=async function(e,t){let r;const{skipHeader:i,callback:o}=t,a=t.offset||0,c=t.headerLength||2;let u,l;e.on("error",(e=>r=e));let d=0,h=0;const p=()=>{h++,f()},f=()=>{for(;;){if(d!==h)return;if(u){const t=e.read(l);if(!t)return;o(u,t),u=void 0}else{if(u=e.read(c),!u)return;if(i?.(u,p)){d++,u=void 0;continue}l=u.readUInt16BE(a)}}};throw f(),e.on("readable",f),await(0,s.once)(e,"end"),new n("read16BELengthLoop")},t.readLength=async function(e,t){if(e.readableEnded||e.destroyed)throw new n("readLength start");if(!t)return Buffer.alloc(0);{const r=e.read(t);if(r)return r}return new Promise(((r,s)=>{const i=()=>{const i=e.read(t);if(i)return a(),void r(i);(e.readableEnded||e.destroyed)&&s(new n("readLength readable"))},o=()=>{a(),s(new n("readLength end"))},a=()=>{e.removeListener("readable",i),e.removeListener("end",o)};e.on("readable",i),e.on("end",o)}))},t.readUntil=o,t.readLine=async function(e){return o(e,i)},t.readString=async function(e){return(await a(e)).toString()},t.readBuffer=a;const s=r(4434);class n extends Error{constructor(e){super(`stream ended: ${e}`)}}t.StreamEndError=n;const i="\n".charCodeAt(0);async function o(e,t){const r=[];for(;;){const n=e.read();if(!n){await(0,s.once)(e,"readable");continue}const i=n.findIndex((e=>e===t));if(-1===i){r.push(n);continue}const o=n.subarray(0,i);r.push(o);const a=n.subarray(i+1);return e.unshift(a),Buffer.concat(r).toString()}}async function a(e){const t=[];return(e=await e).on("data",(e=>{t.push(e)})),e.resume(),await(0,s.once)(e,"end"),Buffer.concat(t)}},8489:(e,t)=>{"use strict";t.toString=function(e){switch(e){case 1:return"LLQ";case 2:return"UL";case 3:return"NSID";case 5:return"DAU";case 6:return"DHU";case 7:return"N3U";case 8:return"CLIENT_SUBNET";case 9:return"EXPIRE";case 10:return"COOKIE";case 11:return"TCP_KEEPALIVE";case 12:return"PADDING";case 13:return"CHAIN";case 14:return"KEY_TAG";case 26946:return"DEVICEID"}return e<0?null:`OPTION_${e}`},t.toCode=function(e){if("number"==typeof e)return e;if(!e)return-1;switch(e.toUpperCase()){case"OPTION_0":return 0;case"LLQ":return 1;case"UL":return 2;case"NSID":return 3;case"OPTION_4":return 4;case"DAU":return 5;case"DHU":return 6;case"N3U":return 7;case"CLIENT_SUBNET":return 8;case"EXPIRE":return 9;case"COOKIE":return 10;case"TCP_KEEPALIVE":return 11;case"PADDING":return 12;case"CHAIN":return 13;case"KEY_TAG":return 14;case"DEVICEID":return 26946;case"OPTION_65535":return 65535}const t=e.match(/_(\d+)$/);return t?parseInt(t[1],10):-1}},8551:(e,t,r)=>{"use strict";const s=r(857),n=r(2018),i=r(2851),{env:o}=process;let a;function c(e){return 0!==e&&{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function u(e,t){if(0===a)return 0;if(i("color=16m")||i("color=full")||i("color=truecolor"))return 3;if(i("color=256"))return 2;if(e&&!t&&void 0===a)return 0;const r=a||0;if("dumb"===o.TERM)return r;if("win32"===process.platform){const e=s.release().split(".");return Number(e[0])>=10&&Number(e[2])>=10586?Number(e[2])>=14931?3:2:1}if("CI"in o)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some((e=>e in o))||"codeship"===o.CI_NAME?1:r;if("TEAMCITY_VERSION"in o)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(o.TEAMCITY_VERSION)?1:0;if("truecolor"===o.COLORTERM)return 3;if("TERM_PROGRAM"in o){const e=parseInt((o.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(o.TERM_PROGRAM){case"iTerm.app":return e>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(o.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(o.TERM)||"COLORTERM"in o?1:r}i("no-color")||i("no-colors")||i("color=false")||i("color=never")?a=0:(i("color")||i("colors")||i("color=true")||i("color=always"))&&(a=1),"FORCE_COLOR"in o&&(a="true"===o.FORCE_COLOR?1:"false"===o.FORCE_COLOR?0:0===o.FORCE_COLOR.length?1:Math.min(parseInt(o.FORCE_COLOR,10),3)),e.exports={supportsColor:function(e){return c(u(e,e&&e.isTTY))},stdout:c(u(!0,n.isatty(1))),stderr:c(u(!0,n.isatty(2)))}},8582:e=>{var t=1e3,r=60*t,s=60*r,n=24*s,i=7*n,o=365.25*n;function a(e,t,r,s){var n=t>=1.5*r;return Math.round(e/r)+" "+s+(n?"s":"")}e.exports=function(e,c){c=c||{};var u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*i;case"days":case"day":case"d":return c*n;case"hours":case"hour":case"hrs":case"hr":case"h":return c*s;case"minutes":case"minute":case"mins":case"min":case"m":return c*r;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===u&&isFinite(e))return c.long?function(e){var i=Math.abs(e);if(i>=n)return a(e,i,n,"day");if(i>=s)return a(e,i,s,"hour");if(i>=r)return a(e,i,r,"minute");if(i>=t)return a(e,i,t,"second");return e+" ms"}(e):function(e){var i=Math.abs(e);if(i>=n)return Math.round(e/n)+"d";if(i>=s)return Math.round(e/s)+"h";if(i>=r)return Math.round(e/r)+"m";if(i>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},8597:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AV1Obu=t.AV1RtpPayload=void 0,t.leb128decode=c;const s=r(9270),n=r(962),i=(0,n.debug)("werift-rtp : packages/rtp/src/codec/av1.ts");class o{constructor(){this.obu_or_fragment=[]}static isDetectedFinalPacketInSequence(e){return e.marker}get isKeyframe(){return 1===this.nBit_RtpStartsNewCodedVideoSequence}static getFrame(e){const t=[],r=e.flatMap((e=>e.obu_or_fragment)).reduce(((e,t,r)=>(e[r]=t,e)),{}),s=Object.keys(r).length;for(const e of Object.keys(r).map(Number)){const n=r[e];if(!n)continue;const{data:o,isFragment:a}=n;if(a){let n=[];for(let t=e;t<s;t++){const e=r[t];if(!e.isFragment)break;n.push(e.data),delete r[t]}n.length<=1&&(i("fragment lost, maybe packet lost"),n=[]),t.push(Buffer.concat(n))}else t.push(o)}const n=t.map((e=>a.deSerialize(e))),o=n.pop();return Buffer.concat([...n.map((e=>(e.obu_has_size_field=1,e.serialize()))),o.serialize()])}}t.AV1RtpPayload=o,o.deSerialize=e=>{const t=new o;let r=0;if(t.zBit_RtpStartsWithFragment=(0,n.getBit)(e[r],0),t.yBit_RtpEndsWithFragment=(0,n.getBit)(e[r],1),t.w_RtpNumObus=(0,n.getBit)(e[r],2,2),t.nBit_RtpStartsNewCodedVideoSequence=(0,n.getBit)(e[r],4),r++,t.nBit_RtpStartsNewCodedVideoSequence&&t.zBit_RtpStartsWithFragment)throw new Error;[...Array(t.w_RtpNumObus-1).keys()].forEach((s=>{const[n,i]=c(e.subarray(r)),o=r+i,a=o+n;let u=!1;t.zBit_RtpStartsWithFragment&&0===s&&(u=!0),t.obu_or_fragment.push({data:e.subarray(o,a),isFragment:u}),r+=i+n}));let s=!1;return(t.yBit_RtpEndsWithFragment||1===t.w_RtpNumObus&&t.zBit_RtpStartsWithFragment)&&(s=!0),t.obu_or_fragment.push({data:e.subarray(r),isFragment:s}),t};class a{static deSerialize(e){const t=new a;let r=0;return t.obu_forbidden_bit=(0,n.getBit)(e[r],0),t.obu_type=u[(0,n.getBit)(e[r],1,4)],t.obu_extension_flag=(0,n.getBit)(e[r],5),t.obu_has_size_field=(0,n.getBit)(e[r],6),t.obu_reserved_1bit=(0,n.getBit)(e[r],7),r++,t.payload=e.subarray(r),t}serialize(){const e=new n.BitWriter2(8).set(this.obu_forbidden_bit).set(l[this.obu_type],4).set(this.obu_extension_flag).set(this.obu_has_size_field).set(this.obu_reserved_1bit).buffer;let t=Buffer.alloc(0);return this.obu_has_size_field&&(t=s.LEB128.encode(this.payload.length)),Buffer.concat([e,t,this.payload])}}function c(e){let t=0,r=0;for(let s=0;s<8;s++){const n=e.readUInt8(s);if(t|=(127&n)<<7*s,r++,!(128&n))break}return[t,r]}t.AV1Obu=a;const u={0:"Reserved",1:"OBU_SEQUENCE_HEADER",2:"OBU_TEMPORAL_DELIMITER",3:"OBU_FRAME_HEADER",4:"OBU_TILE_GROUP",5:"OBU_METADATA",6:"OBU_FRAME",7:"OBU_REDUNDANT_FRAME_HEADER",8:"OBU_TILE_LIST",15:"OBU_PADDING"},l=Object.entries(u).reduce(((e,[t,r])=>(e[r]=Number(t),e)),{})},8649:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ListenZeroSingleClientTimeoutError=void 0,t.listenZero=c,t.listenZeroSingleClient=async function(e,t,r=3e4){const s=t?.tls?new o.default.Server(t):new i.default.Server(t),n=await c(s,e);let u;const l=new Promise(((e,t)=>{const n=setTimeout((()=>{s.close(),t(new a)}),r);u=()=>{clearTimeout(n),s.close()},s.on("connection",(t=>{u(),e(t)}))}));l.catch((()=>{}));let d=e;d&&"0.0.0.0"!==d||(d="127.0.0.1");return{server:s,cancel:u,url:`tcp://${d}:${n}`,host:d,port:n,clientPromise:l}};const n=r(4434),i=s(r(9278)),o=s(r(4756));class a extends Error{constructor(){super("timeout waiting for client")}}async function c(e,t){return e.listen(0,t||"127.0.0.1"),await(0,n.once)(e,"listening"),e.address().port}t.ListenZeroSingleClientTimeoutError=a},8655:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EventTarget=t.PromiseQueue=void 0,t.enumerate=function(e){return e.map(((e,t)=>[t,e]))},t.divide=function(e,t){const r=e.split(t);return[r[0],r.slice(1).join(t)]};const n=s(r(4434));t.PromiseQueue=class{constructor(){this.queue=[],this.running=!1,this.push=e=>new Promise((t=>{this.queue.push({promise:e,done:t}),this.running||this.run()}))}async run(){const e=this.queue.shift();e?(this.running=!0,await e.promise(),e.done(),this.run()):this.running=!1}};class i extends n.default{constructor(){super(...arguments),this.addEventListener=(e,t)=>{this.addListener(e,t)},this.removeEventListener=(e,t)=>{this.removeListener(e,t)}}}t.EventTarget=i},8685:(e,t,r)=>{"use strict";const s=r(6736),n=r(6528);class i{constructor(){this.queue=new n,this.offset=0}get length(){return this.queue.length-this.offset}append(e){if(Buffer.isBuffer(e)){if(this.offset>0){const e=this.queue.shift();this.queue.unshift(e.slice(this.offset)),this.offset=0}this.queue.push(e)}else if(Array.isArray(e))for(let t=0;t<e.length;t+=1)this.append(e[t]);else if(e instanceof i){if(this.offset>0){const e=this.queue.shift();this.queue.unshift(e.slice(this.offset)),this.offset=0}if(e.offset>0){const t=e.queue.shift();e.queue.unshift(t.slice(e.offset)),e.offset=0}let t=e.queue.head;for(;t;)this.queue.push(t.buffer),t=t.next}}get(e){let t=e;for(;t>=this.length;)t-=this.length;for(;t<0;)t+=this.length;let r=this.queue.head,{offset:s}=this;for(;r;){if(r.buffer.length-s>t)return r.buffer[t+s];t-=r.buffer.length-s,s=0,r=r.next}}slice(e,t){for("number"!=typeof e&&(e=0),"number"!=typeof t&&(t=this.length);e<0;)e+=this.length;for(;t<0;)t+=this.length;if(t=Math.min(t,this.length),e>=this.length||0===t)return Buffer.alloc(0);const r=e;e=Math.min(r,t),t=Math.max(r,t);const s=this.queue.slice(e+this.offset,t+this.offset);if(1===s.count)return s.first;let n=s.head;const i=Buffer.allocUnsafe(s.length);let o=0;for(let e=0;e<s.count;e+=1)i.set(n.buffer,o),o+=n.buffer.length,n=n.next;return i}toString(e,t,r){return this.slice(t,r).toString(e)}consume(e){let t=e;for(;this.length>0;){const e=this.queue.first.length-this.offset;if(!(t>=e)){this.offset+=t;break}this.queue.shift(),t-=e,this.offset=0}}indexOf(e,t=0){if(!Number.isInteger(e))throw new TypeError("Invalid argument 1");if(e<0||e>255)throw new Error("Invalid argument 1");for(Number.isInteger(t)||(t=0);t>=this.length;)t-=this.length;for(;t<0;)t+=this.length;let r=this.queue.head,s=0;const n=()=>{s+=r.buffer.length,r=r.next};for(;r;){let i=0;if(r===this.queue.head&&(i+=this.offset),t>=r.buffer.length-i){t-=r.buffer.length-i,n();continue}t<r.buffer.length&&(i+=t);const o=r.buffer.indexOf(e,i);if(o>-1)return o+s-this.offset;n(),i>this.offset&&(t=0)}return-1}}const o={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};Object.keys(o).forEach((e=>{const t=s();t(`\n    function bufferlist_${e}(offset = 0) {\n      const start = offset + this.offset;\n      const head = this.queue.first;\n      const size = ${t.formats.d(o[e])};\n      const isFirtsChunkEnough = head.length - start >= size;\n\n      return isFirtsChunkEnough\n        ? head.${e}(start)\n        : this.slice(offset, offset + size).${e}(0)\n    }\n  `),i.prototype[e]=t.toFunction()}));["readIntBE","readIntLE","readUIntBE","readUIntLE"].forEach((e=>{const t=s();t(`\n    function bufferlist_${e}(size, offset = 0) {\n      const start = offset + this.offset;\n      const head = this.queue.first;\n      const isFirtsChunkEnough = head.length - start >= size;\n\n      return isFirtsChunkEnough\n        ? head.${e}(start, size)\n        : this.slice(offset, offset + size).${e}(0, size)\n    }\n  `),i.prototype[e]=t.toFunction()}));const a={writeDoubleBE:8,writeDoubleLE:8,writeFloatBE:4,writeFloatLE:4,writeInt32BE:4,writeInt32LE:4,writeUInt32BE:4,writeUInt32LE:4,writeInt16BE:2,writeInt16LE:2,writeUInt16BE:2,writeUInt16LE:2,writeInt8:1,writeUInt8:1};Object.keys(a).forEach((e=>{const t=s();t(`\n    function bufferlist_${e}(value) {\n      const size = ${t.formats.d(a[e])};\n      const buf = Buffer.allocUnsafe(size);\n      buf.${e}(value, 0);\n      this.append(buf);\n    }\n  `),i.prototype[e]=t.toFunction()}));["writeIntBE","writeIntLE","writeUIntBE","writeUIntLE"].forEach((e=>{const t=s();t(`\n    function bufferlist_${e}(value, size) {\n      const buf = Buffer.allocUnsafe(size);\n      buf.${e}(value, 0, size);\n      this.append(buf);\n    }\n  `),i.prototype[e]=t.toFunction()})),e.exports=i},8774:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.supportedAudioCodecs=t.supportedVideoCodecs=t.supportedCodecs=t.usePCMU=t.useOPUS=t.useAV1X=t.useVP9=t.useVP8=t.useH264=void 0;const s=r(7734),n=r(4582);t.useH264=(e={})=>new n.RTCRtpCodecParameters({mimeType:"video/h264",clockRate:9e4,rtcpFeedback:[(0,s.useNACK)(),(0,s.usePLI)(),(0,s.useREMB)()],parameters:"profile-level-id=42e01f;packetization-mode=1;level-asymmetry-allowed=1",...e});t.useVP8=(e={})=>new n.RTCRtpCodecParameters({mimeType:"video/VP8",clockRate:9e4,rtcpFeedback:[(0,s.useNACK)(),(0,s.usePLI)(),(0,s.useREMB)()],...e});t.useVP9=(e={})=>new n.RTCRtpCodecParameters({mimeType:"video/VP9",clockRate:9e4,rtcpFeedback:[(0,s.useNACK)(),(0,s.usePLI)(),(0,s.useREMB)()],...e});t.useAV1X=(e={})=>new n.RTCRtpCodecParameters({mimeType:"video/AV1X",clockRate:9e4,rtcpFeedback:[(0,s.useNACK)(),(0,s.usePLI)(),(0,s.useREMB)()],...e});t.useOPUS=(e={})=>new n.RTCRtpCodecParameters({mimeType:"audio/OPUS",clockRate:48e3,channels:2,...e});t.usePCMU=(e={})=>new n.RTCRtpCodecParameters({mimeType:"audio/PCMU",clockRate:8e3,channels:1,payloadType:0,...e}),t.supportedCodecs=[(0,t.useAV1X)(),(0,t.useVP9)(),(0,t.useVP8)(),(0,t.useH264)(),(0,t.useOPUS)(),(0,t.usePCMU)()].map((e=>e.mimeType)),t.supportedVideoCodecs=t.supportedCodecs.filter((e=>e.toLowerCase().startsWith("video/"))),t.supportedAudioCodecs=t.supportedCodecs.filter((e=>e.toLowerCase().startsWith("audio/")))},8782:(e,t)=>{"use strict";function r(e,t){return e<t&&t-e>32768||e>t&&e-t<32768}function s(e,t){const r=2147483648;return e<t&&t-e>r||e>t&&e-t<r}Object.defineProperty(t,"__esModule",{value:!0}),t.int=void 0,t.uint8Add=function(e,t){return e+t&255},t.uint16Add=function(e,t){return e+t&65535},t.uint32Add=function(e,t){return Number(BigInt(e)+BigInt(t)&0xffffffffn)},t.uint24=function(e){return 16777215&e},t.uint16Gt=r,t.uint16Gte=function(e,t){return e===t||r(e,t)},t.uint32Gt=s,t.uint32Gte=function(e,t){return e===t||s(e,t)};t.int=e=>Number.parseInt(e,10)},8806:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deepMerge=t.MediaStreamTrackFactory=t.createSelfSignedCertificate=t.compactNtp=t.ntpTime=t.timestampSeconds=t.microTime=t.milliTime=t.andDirection=void 0,t.fingerprint=function(e,t){const r=(0,s.createHash)(t).update(e).digest("hex");return(e=>e.match(/(.{2})/g).join(":"))((n=r,n.toUpperCase()));var n},t.isDtls=function(e){const t=e[0];return t>19&&t<64},t.reverseSimulcastDirection=function(e){return"recv"===e?"send":"recv"},t.reverseDirection=function(e){return"sendonly"===e?"recvonly":"recvonly"===e?"sendonly":e},t.parseIceServers=function(e){const t=e=>{if(!e)return;const[t,r]=e.split(":");return[t,Number.parseInt(r)]},r=t(e.find((({urls:e})=>e.includes("stun:")))?.urls.slice(5)),s=t(e.find((({urls:e})=>e.includes("turn:")))?.urls.slice(5)),{credential:n,username:i}=e.find((({urls:e})=>e.includes("turn:")))||{},o={stunServer:r,turnServer:s,turnUsername:i,turnPassword:n};return l("iceOptions",o),o};const s=r(6982),n=r(7194),i=r(2987),o=r(5433),a=r(1597),c=r(3862),u=r(3535),l=(0,o.debug)("werift:packages/webrtc/src/utils.ts");t.andDirection=(e,t)=>c.Directions[c.Directions.indexOf(e)&c.Directions.indexOf(t)],t.milliTime=Date.now;const d=1000n*BigInt(Date.now())-process.hrtime.bigint()/1000n;t.microTime=()=>d+process.hrtime.bigint()/1000n;t.timestampSeconds=()=>Date.now()/1e3;t.ntpTime=()=>{const e=(i.performance.timeOrigin+i.performance.now()-Date.UTC(1900,0,1))/1e3,[t,r]=e.toString().split(".").map(Number);return(0,o.bufferWriter)([4,4],[t,r]).readBigUInt64BE()};t.compactNtp=e=>{const t=(0,o.bufferWriter)([8],[e]),[,r,s]=(0,o.bufferReader)(t,[2,2,2,2]);return(0,o.bufferWriter)([2,2],[r,s]).readUInt32BE()},t.createSelfSignedCertificate=a.CipherContext.createSelfSignedCertificateWithKey;t.MediaStreamTrackFactory=class{static async rtpSource({port:e,kind:t,cb:r}){e??=await(0,o.randomPort)();const s=new u.MediaStreamTrack({kind:t}),i=(0,n.createSocket)("udp4");i.bind(e);const a=e=>{r&&(e=r(e)),s.writeRtp(e)};i.addListener("message",a);return[s,e,()=>{i.removeListener("message",a);try{i.close()}catch(e){}}]}};t.deepMerge=(e,t)=>{if(!e||"object"!=typeof e)return null!==t&&"object"==typeof t?t:e;if(!t||"object"!=typeof t)return null==t?e:t;for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const s=t[r];null!=s&&(e[r]=s)}return e}},8920:(e,t,r)=>{"use strict";const s=r(181).Buffer,n=r(7229),i=r(9686),o=r(8195),a=r(5300),c=r(8489),u=r(381),l=32768,d=t.name={};d.encode=function(e,t,r,{mail:n=!1}={}){t||(t=s.alloc(d.encodingLength(e))),r||(r=0);const i=r,o=e.replace(/^\.|\.$/gm,"");if(o.length){let e=[];if(n){let t="";o.split(".").forEach((r=>{r.endsWith("\\")?t+=(t.length?".":"")+r.slice(0,-1):0===e.length&&t.length?e.push(t+"."+r):e.push(r)}))}else e=o.split(".");for(let s=0;s<e.length;s++){const n=t.write(e[s],r+1);t[r]=n,r+=n+1}}return t[r++]=0,d.encode.bytes=r-i,t},d.encode.bytes=0,d.decode=function(e,t,{mail:r=!1}={}){t||(t=0);const s=[];let n=t,i=0,o=0,a=!1;for(;;){if(t>=e.length)throw new Error("Cannot decode name (buffer overflow)");const c=e[t++];if(o+=a?0:1,0===c)break;if(192&c){if(192&~c)throw new Error("Cannot decode name (bad label)");{if(t+1>e.length)throw new Error("Cannot decode name (buffer overflow)");const r=e.readUInt16BE(t-1)-49152;if(r>=n)throw new Error("Cannot decode name (bad pointer)");t=r,n=r,o+=a?0:1,a=!0}}else{if(t+c>e.length)throw new Error("Cannot decode name (buffer overflow)");if(i+=c+1,i>254)throw new Error("Cannot decode name (name too long)");let n=e.toString("utf-8",t,t+c);r&&(n=n.replace(/\./g,"\\.")),s.push(n),t+=c,o+=a?0:c}}return d.decode.bytes=o,0===s.length?".":s.join(".")},d.decode.bytes=0,d.encodingLength=function(e){return"."===e||".."===e?1:s.byteLength(e.replace(/^\.|\.$/gm,""))+2};const h={encode:function(e,t,r){t||(t=s.alloc(h.encodingLength(e))),r||(r=0);const n=t.write(e,r+1);return t[r]=n,h.encode.bytes=n+1,t}};h.encode.bytes=0,h.decode=function(e,t){t||(t=0);const r=e[t],s=e.toString("utf-8",t+1,t+1+r);return h.decode.bytes=r+1,s},h.decode.bytes=0,h.encodingLength=function(e){return s.byteLength(e)+1};const p={encode:function(e,t,r){t||(t=p.encodingLength(e)),r||(r=0);const s=32767&(e.flags||0),n="response"===e.type?32768:0;return t.writeUInt16BE(e.id||0,r),t.writeUInt16BE(s|n,r+2),t.writeUInt16BE(e.questions.length,r+4),t.writeUInt16BE(e.answers.length,r+6),t.writeUInt16BE(e.authorities.length,r+8),t.writeUInt16BE(e.additionals.length,r+10),t}};p.encode.bytes=12,p.decode=function(e,t){if(t||(t=0),e.length<12)throw new Error("Header must be 12 bytes");const r=e.readUInt16BE(t+2);return{id:e.readUInt16BE(t),type:32768&r?"response":"query",flags:32767&r,flag_qr:1==(r>>15&1),opcode:o.toString(r>>11&15),flag_aa:1==(r>>10&1),flag_tc:1==(r>>9&1),flag_rd:1==(r>>8&1),flag_ra:1==(r>>7&1),flag_z:1==(r>>6&1),flag_ad:1==(r>>5&1),flag_cd:1==(r>>4&1),rcode:i.toString(15&r),questions:new Array(e.readUInt16BE(t+4)),answers:new Array(e.readUInt16BE(t+6)),authorities:new Array(e.readUInt16BE(t+8)),additionals:new Array(e.readUInt16BE(t+10))}},p.decode.bytes=12,p.encodingLength=function(){return 12};const f=t.unknown={};f.encode=function(e,t,r){return t||(t=s.alloc(f.encodingLength(e))),r||(r=0),t.writeUInt16BE(e.length,r),e.copy(t,r+2),f.encode.bytes=e.length+2,t},f.encode.bytes=0,f.decode=function(e,t){t||(t=0);const r=e.readUInt16BE(t),s=e.slice(t+2,t+2+r);return f.decode.bytes=r+2,s},f.decode.bytes=0,f.encodingLength=function(e){return e.length+2};const g=t.ns={};g.encode=function(e,t,r){return t||(t=s.alloc(g.encodingLength(e))),r||(r=0),d.encode(e,t,r+2),t.writeUInt16BE(d.encode.bytes,r),g.encode.bytes=d.encode.bytes+2,t},g.encode.bytes=0,g.decode=function(e,t){t||(t=0);const r=e.readUInt16BE(t),s=d.decode(e,t+2);return g.decode.bytes=r+2,s},g.decode.bytes=0,g.encodingLength=function(e){return d.encodingLength(e)+2};const m=t.soa={};m.encode=function(e,t,r){t||(t=s.alloc(m.encodingLength(e))),r||(r=0);const n=r;return r+=2,d.encode(e.mname,t,r),r+=d.encode.bytes,d.encode(e.rname,t,r,{mail:!0}),r+=d.encode.bytes,t.writeUInt32BE(e.serial||0,r),r+=4,t.writeUInt32BE(e.refresh||0,r),r+=4,t.writeUInt32BE(e.retry||0,r),r+=4,t.writeUInt32BE(e.expire||0,r),r+=4,t.writeUInt32BE(e.minimum||0,r),r+=4,t.writeUInt16BE(r-n-2,n),m.encode.bytes=r-n,t},m.encode.bytes=0,m.decode=function(e,t){t||(t=0);const r=t,s={};return t+=2,s.mname=d.decode(e,t),t+=d.decode.bytes,s.rname=d.decode(e,t,{mail:!0}),t+=d.decode.bytes,s.serial=e.readUInt32BE(t),t+=4,s.refresh=e.readUInt32BE(t),t+=4,s.retry=e.readUInt32BE(t),t+=4,s.expire=e.readUInt32BE(t),t+=4,s.minimum=e.readUInt32BE(t),t+=4,m.decode.bytes=t-r,s},m.decode.bytes=0,m.encodingLength=function(e){return 22+d.encodingLength(e.mname)+d.encodingLength(e.rname)};const y=t.txt={};y.encode=function(e,t,r){Array.isArray(e)||(e=[e]);for(let t=0;t<e.length;t++)if("string"==typeof e[t]&&(e[t]=s.from(e[t])),!s.isBuffer(e[t]))throw new Error("Must be a Buffer");t||(t=s.alloc(y.encodingLength(e))),r||(r=0);const n=r;return r+=2,e.forEach((function(e){t[r++]=e.length,e.copy(t,r,0,e.length),r+=e.length})),t.writeUInt16BE(r-n-2,n),y.encode.bytes=r-n,t},y.encode.bytes=0,y.decode=function(e,t){t||(t=0);const r=t;let s=e.readUInt16BE(t);t+=2;let n=[];for(;s>0;){const r=e[t++];if(--s,s<r)throw new Error("Buffer overflow");n.push(e.slice(t,t+r)),t+=r,s-=r}return y.decode.bytes=t-r,n},y.decode.bytes=0,y.encodingLength=function(e){Array.isArray(e)||(e=[e]);let t=2;return e.forEach((function(e){t+="string"==typeof e?s.byteLength(e)+1:e.length+1})),t};const b=t.null={};b.encode=function(e,t,r){t||(t=s.alloc(b.encodingLength(e))),r||(r=0),"string"==typeof e&&(e=s.from(e)),e||(e=s.alloc(0));const n=r;r+=2;const i=e.length;return e.copy(t,r,0,i),r+=i,t.writeUInt16BE(r-n-2,n),b.encode.bytes=r-n,t},b.encode.bytes=0,b.decode=function(e,t){t||(t=0);const r=t,s=e.readUInt16BE(t);t+=2;const n=e.slice(t,t+s);return t+=s,b.decode.bytes=t-r,n},b.decode.bytes=0,b.encodingLength=function(e){return e?(s.isBuffer(e)?e.length:s.byteLength(e))+2:2};const v=t.hinfo={};v.encode=function(e,t,r){t||(t=s.alloc(v.encodingLength(e))),r||(r=0);const n=r;return r+=2,h.encode(e.cpu,t,r),r+=h.encode.bytes,h.encode(e.os,t,r),r+=h.encode.bytes,t.writeUInt16BE(r-n-2,n),v.encode.bytes=r-n,t},v.encode.bytes=0,v.decode=function(e,t){t||(t=0);const r=t,s={};return t+=2,s.cpu=h.decode(e,t),t+=h.decode.bytes,s.os=h.decode(e,t),t+=h.decode.bytes,v.decode.bytes=t-r,s},v.decode.bytes=0,v.encodingLength=function(e){return h.encodingLength(e.cpu)+h.encodingLength(e.os)+2};const S=t.ptr={},w=t.cname=S,E=t.dname=S;S.encode=function(e,t,r){return t||(t=s.alloc(S.encodingLength(e))),r||(r=0),d.encode(e,t,r+2),t.writeUInt16BE(d.encode.bytes,r),S.encode.bytes=d.encode.bytes+2,t},S.encode.bytes=0,S.decode=function(e,t){t||(t=0);const r=d.decode(e,t+2);return S.decode.bytes=d.decode.bytes+2,r},S.decode.bytes=0,S.encodingLength=function(e){return d.encodingLength(e)+2};const C=t.srv={};C.encode=function(e,t,r){t||(t=s.alloc(C.encodingLength(e))),r||(r=0),t.writeUInt16BE(e.priority||0,r+2),t.writeUInt16BE(e.weight||0,r+4),t.writeUInt16BE(e.port||0,r+6),d.encode(e.target,t,r+8);const n=d.encode.bytes+6;return t.writeUInt16BE(n,r),C.encode.bytes=n+2,t},C.encode.bytes=0,C.decode=function(e,t){t||(t=0);const r=e.readUInt16BE(t),s={};return s.priority=e.readUInt16BE(t+2),s.weight=e.readUInt16BE(t+4),s.port=e.readUInt16BE(t+6),s.target=d.decode(e,t+8),C.decode.bytes=r+2,s},C.decode.bytes=0,C.encodingLength=function(e){return 8+d.encodingLength(e.target)};const T=t.caa={};T.ISSUER_CRITICAL=128,T.encode=function(e,t,r){const n=T.encodingLength(e);return t||(t=s.alloc(T.encodingLength(e))),r||(r=0),e.issuerCritical&&(e.flags=T.ISSUER_CRITICAL),t.writeUInt16BE(n-2,r),r+=2,t.writeUInt8(e.flags||0,r),r+=1,h.encode(e.tag,t,r),r+=h.encode.bytes,t.write(e.value,r),r+=s.byteLength(e.value),T.encode.bytes=n,t},T.encode.bytes=0,T.decode=function(e,t){t||(t=0);const r=e.readUInt16BE(t),s=t+=2,n={};return n.flags=e.readUInt8(t),t+=1,n.tag=h.decode(e,t),t+=h.decode.bytes,n.value=e.toString("utf-8",t,s+r),n.issuerCritical=!!(n.flags&T.ISSUER_CRITICAL),T.decode.bytes=r+2,n},T.decode.bytes=0,T.encodingLength=function(e){return h.encodingLength(e.tag)+h.encodingLength(e.value)+2};const I=t.mx={};I.encode=function(e,t,r){t||(t=s.alloc(I.encodingLength(e))),r||(r=0);const n=r;return r+=2,t.writeUInt16BE(e.preference||0,r),r+=2,d.encode(e.exchange,t,r),r+=d.encode.bytes,t.writeUInt16BE(r-n-2,n),I.encode.bytes=r-n,t},I.encode.bytes=0,I.decode=function(e,t){t||(t=0);const r=t,s={};return t+=2,s.preference=e.readUInt16BE(t),t+=2,s.exchange=d.decode(e,t),t+=d.decode.bytes,I.decode.bytes=t-r,s},I.encodingLength=function(e){return 4+d.encodingLength(e.exchange)};const _=t.a={};_.encode=function(e,t,r){return t||(t=s.alloc(_.encodingLength(e))),r||(r=0),t.writeUInt16BE(4,r),r+=2,u.v4.encode(e,t,r),_.encode.bytes=6,t},_.encode.bytes=0,_.decode=function(e,t){t||(t=0),t+=2;const r=u.v4.decode(e,t);return _.decode.bytes=6,r},_.decode.bytes=0,_.encodingLength=function(){return 6};const A=t.aaaa={};A.encode=function(e,t,r){return t||(t=s.alloc(A.encodingLength(e))),r||(r=0),t.writeUInt16BE(16,r),r+=2,u.v6.encode(e,t,r),A.encode.bytes=18,t},A.encode.bytes=0,A.decode=function(e,t){t||(t=0),t+=2;const r=u.v6.decode(e,t);return A.decode.bytes=18,r},A.decode.bytes=0,A.encodingLength=function(){return 18};const R=t.option={};R.encode=function(e,t,r){t||(t=s.alloc(R.encodingLength(e))),r||(r=0);const n=r,i=c.toCode(e.code);if(t.writeUInt16BE(i,r),r+=2,e.data)t.writeUInt16BE(e.data.length,r),r+=2,e.data.copy(t,r),r+=e.data.length;else switch(i){case 8:const n=e.sourcePrefixLength||0,i=e.family||u.familyOf(e.ip),o=u.encode(e.ip,s.alloc),a=Math.ceil(n/8);t.writeUInt16BE(a+4,r),r+=2,t.writeUInt16BE(i,r),r+=2,t.writeUInt8(n,r++),t.writeUInt8(e.scopePrefixLength||0,r++),o.copy(t,r,0,a),r+=a;break;case 11:e.timeout?(t.writeUInt16BE(2,r),r+=2,t.writeUInt16BE(e.timeout,r),r+=2):(t.writeUInt16BE(0,r),r+=2);break;case 12:const c=e.length||0;t.writeUInt16BE(c,r),r+=2,t.fill(0,r,r+c),r+=c;break;case 14:const l=2*e.tags.length;t.writeUInt16BE(l,r),r+=2;for(const s of e.tags)t.writeUInt16BE(s,r),r+=2;break;default:throw new Error(`Unknown roption code: ${e.code}`)}return R.encode.bytes=r-n,t},R.encode.bytes=0,R.decode=function(e,t){t||(t=0);const r={};r.code=e.readUInt16BE(t),r.type=c.toString(r.code),t+=2;const n=e.readUInt16BE(t);switch(t+=2,r.data=e.slice(t,t+n),r.code){case 8:r.family=e.readUInt16BE(t),t+=2,r.sourcePrefixLength=e.readUInt8(t++),r.scopePrefixLength=e.readUInt8(t++);const i=s.alloc(1===r.family?4:16);e.copy(i,0,t,t+n-4),r.ip=u.decode(i);break;case 11:n>0&&(r.timeout=e.readUInt16BE(t),t+=2);break;case 14:r.tags=[];for(let s=0;s<n;s+=2)r.tags.push(e.readUInt16BE(t)),t+=2}return R.decode.bytes=n+4,r},R.decode.bytes=0,R.encodingLength=function(e){if(e.data)return e.data.length+4;switch(c.toCode(e.code)){case 8:const t=e.sourcePrefixLength||0;return Math.ceil(t/8)+8;case 11:return"number"==typeof e.timeout?6:4;case 12:return e.length+4;case 14:return 4+2*e.tags.length}throw new Error(`Unknown roption code: ${e.code}`)};const P=t.opt={};P.encode=function(e,t,r){t||(t=s.alloc(P.encodingLength(e))),r||(r=0);const n=r,i=V(e,R);return t.writeUInt16BE(i,r),r=q(e,R,t,r+2),P.encode.bytes=r-n,t},P.encode.bytes=0,P.decode=function(e,t){t||(t=0);const r=t,s=[];let n=e.readUInt16BE(t);t+=2;let i=0;for(;n>0;)s[i++]=R.decode(e,t),t+=R.decode.bytes,n-=R.decode.bytes;return P.decode.bytes=t-r,s},P.decode.bytes=0,P.encodingLength=function(e){return 2+V(e||[],R)};const k=t.dnskey={};k.PROTOCOL_DNSSEC=3,k.ZONE_KEY=128,k.SECURE_ENTRYPOINT=32768,k.encode=function(e,t,r){t||(t=s.alloc(k.encodingLength(e))),r||(r=0);const n=r,i=e.key;if(!s.isBuffer(i))throw new Error("Key must be a Buffer");return r+=2,t.writeUInt16BE(e.flags,r),r+=2,t.writeUInt8(k.PROTOCOL_DNSSEC,r),r+=1,t.writeUInt8(e.algorithm,r),r+=1,i.copy(t,r,0,i.length),r+=i.length,k.encode.bytes=r-n,t.writeUInt16BE(k.encode.bytes-2,n),t},k.encode.bytes=0,k.decode=function(e,t){t||(t=0);const r=t;var s={},n=e.readUInt16BE(t);if(t+=2,s.flags=e.readUInt16BE(t),t+=2,e.readUInt8(t)!==k.PROTOCOL_DNSSEC)throw new Error("Protocol must be 3");return t+=1,s.algorithm=e.readUInt8(t),t+=1,s.key=e.slice(t,r+n+2),t+=s.key.length,k.decode.bytes=t-r,s},k.decode.bytes=0,k.encodingLength=function(e){return 6+s.byteLength(e.key)};const B=t.rrsig={};B.encode=function(e,t,r){t||(t=s.alloc(B.encodingLength(e))),r||(r=0);const i=r,o=e.signature;if(!s.isBuffer(o))throw new Error("Signature must be a Buffer");return r+=2,t.writeUInt16BE(n.toType(e.typeCovered),r),r+=2,t.writeUInt8(e.algorithm,r),r+=1,t.writeUInt8(e.labels,r),r+=1,t.writeUInt32BE(e.originalTTL,r),r+=4,t.writeUInt32BE(e.expiration,r),r+=4,t.writeUInt32BE(e.inception,r),r+=4,t.writeUInt16BE(e.keyTag,r),r+=2,d.encode(e.signersName,t,r),r+=d.encode.bytes,o.copy(t,r,0,o.length),r+=o.length,B.encode.bytes=r-i,t.writeUInt16BE(B.encode.bytes-2,i),t},B.encode.bytes=0,B.decode=function(e,t){t||(t=0);const r=t;var s={},i=e.readUInt16BE(t);return t+=2,s.typeCovered=n.toString(e.readUInt16BE(t)),t+=2,s.algorithm=e.readUInt8(t),t+=1,s.labels=e.readUInt8(t),t+=1,s.originalTTL=e.readUInt32BE(t),t+=4,s.expiration=e.readUInt32BE(t),t+=4,s.inception=e.readUInt32BE(t),t+=4,s.keyTag=e.readUInt16BE(t),t+=2,s.signersName=d.decode(e,t),t+=d.decode.bytes,s.signature=e.slice(t,r+i+2),t+=s.signature.length,B.decode.bytes=t-r,s},B.decode.bytes=0,B.encodingLength=function(e){return 20+d.encodingLength(e.signersName)+s.byteLength(e.signature)};const O=t.rp={};O.encode=function(e,t,r){t||(t=s.alloc(O.encodingLength(e))),r||(r=0);const n=r;return r+=2,d.encode(e.mbox||".",t,r,{mail:!0}),r+=d.encode.bytes,d.encode(e.txt||".",t,r),r+=d.encode.bytes,O.encode.bytes=r-n,t.writeUInt16BE(O.encode.bytes-2,n),t},O.encode.bytes=0,O.decode=function(e,t){t||(t=0);const r=t,s={};return t+=2,s.mbox=d.decode(e,t,{mail:!0})||".",t+=d.decode.bytes,s.txt=d.decode(e,t)||".",t+=d.decode.bytes,O.decode.bytes=t-r,s},O.decode.bytes=0,O.encodingLength=function(e){return 2+d.encodingLength(e.mbox||".")+d.encodingLength(e.txt||".")};const x={encode:function(e,t,r){t||(t=s.alloc(x.encodingLength(e))),r||(r=0);const i=r;for(var o=[],a=0;a<e.length;a++){var c=n.toType(e[a]);void 0===o[c>>8]&&(o[c>>8]=[]),o[c>>8][c>>3&31]|=1<<7-(7&c)}for(a=0;a<o.length;a++)if(void 0!==o[a]){var u=s.from(o[a]);t.writeUInt8(a,r),r+=1,t.writeUInt8(u.length,r),r+=1,u.copy(t,r),r+=u.length}return x.encode.bytes=r-i,t}};x.encode.bytes=0,x.decode=function(e,t,r){t||(t=0);const s=t;for(var i=[];t-s<r;){var o=e.readUInt8(t);t+=1;var a=e.readUInt8(t);t+=1;for(var c=0;c<a;c++)for(var u=e.readUInt8(t+c),l=0;l<8;l++)if(u&1<<7-l){var d=n.toString(o<<8|c<<3|l);i.push(d)}t+=a}return x.decode.bytes=t-s,i},x.decode.bytes=0,x.encodingLength=function(e){for(var t=[],r=0;r<e.length;r++){var s=n.toType(e[r]);t[s>>8]=Math.max(t[s>>8]||0,255&s)}var i=0;for(r=0;r<t.length;r++)void 0!==t[r]&&(i+=2+Math.ceil((t[r]+1)/8));return i};const N=t.nsec={};N.encode=function(e,t,r){t||(t=s.alloc(N.encodingLength(e))),r||(r=0);const n=r;return r+=2,d.encode(e.nextDomain,t,r),r+=d.encode.bytes,x.encode(e.rrtypes,t,r),r+=x.encode.bytes,N.encode.bytes=r-n,t.writeUInt16BE(N.encode.bytes-2,n),t},N.encode.bytes=0,N.decode=function(e,t){t||(t=0);const r=t;var s={},n=e.readUInt16BE(t);return t+=2,s.nextDomain=d.decode(e,t),t+=d.decode.bytes,s.rrtypes=x.decode(e,t,n-(t-r)),t+=x.decode.bytes,N.decode.bytes=t-r,s},N.decode.bytes=0,N.encodingLength=function(e){return 2+d.encodingLength(e.nextDomain)+x.encodingLength(e.rrtypes)};const D=t.nsec3={};D.encode=function(e,t,r){t||(t=s.alloc(D.encodingLength(e))),r||(r=0);const n=r,i=e.salt;if(!s.isBuffer(i))throw new Error("salt must be a Buffer");const o=e.nextDomain;if(!s.isBuffer(o))throw new Error("nextDomain must be a Buffer");return r+=2,t.writeUInt8(e.algorithm,r),r+=1,t.writeUInt8(e.flags,r),r+=1,t.writeUInt16BE(e.iterations,r),r+=2,t.writeUInt8(i.length,r),r+=1,i.copy(t,r,0,i.length),r+=i.length,t.writeUInt8(o.length,r),r+=1,o.copy(t,r,0,o.length),r+=o.length,x.encode(e.rrtypes,t,r),r+=x.encode.bytes,D.encode.bytes=r-n,t.writeUInt16BE(D.encode.bytes-2,n),t},D.encode.bytes=0,D.decode=function(e,t){t||(t=0);const r=t;var s={},n=e.readUInt16BE(t);t+=2,s.algorithm=e.readUInt8(t),t+=1,s.flags=e.readUInt8(t),t+=1,s.iterations=e.readUInt16BE(t),t+=2;const i=e.readUInt8(t);t+=1,s.salt=e.slice(t,t+i),t+=i;const o=e.readUInt8(t);return t+=1,s.nextDomain=e.slice(t,t+o),t+=o,s.rrtypes=x.decode(e,t,n-(t-r)),t+=x.decode.bytes,D.decode.bytes=t-r,s},D.decode.bytes=0,D.encodingLength=function(e){return 8+e.salt.length+e.nextDomain.length+x.encodingLength(e.rrtypes)};const L=t.ds={};L.encode=function(e,t,r){t||(t=s.alloc(L.encodingLength(e))),r||(r=0);const n=r,i=e.digest;if(!s.isBuffer(i))throw new Error("Digest must be a Buffer");return r+=2,t.writeUInt16BE(e.keyTag,r),r+=2,t.writeUInt8(e.algorithm,r),r+=1,t.writeUInt8(e.digestType,r),r+=1,i.copy(t,r,0,i.length),r+=i.length,L.encode.bytes=r-n,t.writeUInt16BE(L.encode.bytes-2,n),t},L.encode.bytes=0,L.decode=function(e,t){t||(t=0);const r=t;var s={},n=e.readUInt16BE(t);return t+=2,s.keyTag=e.readUInt16BE(t),t+=2,s.algorithm=e.readUInt8(t),t+=1,s.digestType=e.readUInt8(t),t+=1,s.digest=e.slice(t,r+n+2),t+=s.digest.length,L.decode.bytes=t-r,s},L.decode.bytes=0,L.encodingLength=function(e){return 6+s.byteLength(e.digest)};const M=t.sshfp={};M.getFingerprintLengthForHashType=function(e){switch(e){case 1:return 20;case 2:return 32}},M.encode=function(e,t,r){t||(t=s.alloc(M.encodingLength(e))),r||(r=0);const n=r;t[r+=2]=e.algorithm,t[r+=1]=e.hash,r+=1;const i=s.from(e.fingerprint.toUpperCase(),"hex");if(i.length!==M.getFingerprintLengthForHashType(e.hash))throw new Error("Invalid fingerprint length");return i.copy(t,r),r+=i.byteLength,M.encode.bytes=r-n,t.writeUInt16BE(M.encode.bytes-2,n),t},M.encode.bytes=0,M.decode=function(e,t){t||(t=0);const r=t,s={};t+=2,s.algorithm=e[t],t+=1,s.hash=e[t],t+=1;const n=M.getFingerprintLengthForHashType(s.hash);return s.fingerprint=e.slice(t,t+n).toString("hex").toUpperCase(),t+=n,M.decode.bytes=t-r,s},M.decode.bytes=0,M.encodingLength=function(e){return 4+s.from(e.fingerprint,"hex").byteLength};const U=t.naptr={};U.encode=function(e,t,r){t||(t=s.alloc(U.encodingLength(e))),r||(r=0);const n=r;return r+=2,t.writeUInt16BE(e.order||0,r),r+=2,t.writeUInt16BE(e.preference||0,r),r+=2,h.encode(e.flags,t,r),r+=h.encode.bytes,h.encode(e.services,t,r),r+=h.encode.bytes,h.encode(e.regexp,t,r),r+=h.encode.bytes,d.encode(e.replacement,t,r),r+=d.encode.bytes,U.encode.bytes=r-n,t.writeUInt16BE(U.encode.bytes-2,n),t},U.encode.bytes=0,U.decode=function(e,t){t||(t=0);const r=t,s={};return t+=2,s.order=e.readUInt16BE(t),t+=2,s.preference=e.readUInt16BE(t),t+=2,s.flags=h.decode(e,t),t+=h.decode.bytes,s.services=h.decode(e,t),t+=h.decode.bytes,s.regexp=h.decode(e,t),t+=h.decode.bytes,s.replacement=d.decode(e,t),t+=d.decode.bytes,U.decode.bytes=t-r,s},U.decode.bytes=0,U.encodingLength=function(e){return h.encodingLength(e.flags)+h.encodingLength(e.services)+h.encodingLength(e.regexp)+d.encodingLength(e.replacement)+6};const j=t.tlsa={};j.encode=function(e,t,r){t||(t=s.alloc(j.encodingLength(e))),r||(r=0);const n=r,i=e.certificate;if(!s.isBuffer(i))throw new Error("Certificate must be a Buffer");return r+=2,t.writeUInt8(e.usage,r),r+=1,t.writeUInt8(e.selector,r),r+=1,t.writeUInt8(e.matchingType,r),r+=1,i.copy(t,r,0,i.length),r+=i.length,j.encode.bytes=r-n,t.writeUInt16BE(j.encode.bytes-2,n),t},j.encode.bytes=0,j.decode=function(e,t){t||(t=0);const r=t,s={},n=e.readUInt16BE(t);return t+=2,s.usage=e.readUInt8(t),t+=1,s.selector=e.readUInt8(t),t+=1,s.matchingType=e.readUInt8(t),t+=1,s.certificate=e.slice(t,r+n+2),t+=s.certificate.length,j.decode.bytes=t-r,s},j.decode.bytes=0,j.encodingLength=function(e){return 5+s.byteLength(e.certificate)};const H=t.record=function(e){switch(e.toUpperCase()){case"A":return _;case"PTR":return S;case"CNAME":return w;case"DNAME":return E;case"TXT":return y;case"NULL":return b;case"AAAA":return A;case"SRV":return C;case"HINFO":return v;case"CAA":return T;case"NS":return g;case"SOA":return m;case"MX":return I;case"OPT":return P;case"DNSKEY":return k;case"RRSIG":return B;case"RP":return O;case"NSEC":return N;case"NSEC3":return D;case"SSHFP":return M;case"DS":return L;case"NAPTR":return U;case"TLSA":return j}return f},F=t.answer={};F.encode=function(e,t,r){t||(t=s.alloc(F.encodingLength(e))),r||(r=0);const i=r;if(d.encode(e.name,t,r),r+=d.encode.bytes,t.writeUInt16BE(n.toType(e.type),r),"OPT"===e.type.toUpperCase()){if("."!==e.name)throw new Error("OPT name must be root.");t.writeUInt16BE(e.udpPayloadSize||4096,r+2),t.writeUInt8(e.extendedRcode||0,r+4),t.writeUInt8(e.ednsVersion||0,r+5),t.writeUInt16BE(e.flags||0,r+6),r+=8,P.encode(e.options||[],t,r),r+=P.encode.bytes}else{let s=a.toClass(void 0===e.class?"IN":e.class);e.flush&&(s|=l),t.writeUInt16BE(s,r+2),t.writeUInt32BE(e.ttl||0,r+4),r+=8;const n=H(e.type);n.encode(e.data,t,r),r+=n.encode.bytes}return F.encode.bytes=r-i,t},F.encode.bytes=0,F.decode=function(e,t){t||(t=0);const r={},s=t;if(r.name=d.decode(e,t),t+=d.decode.bytes,r.type=n.toString(e.readUInt16BE(t)),"OPT"===r.type)r.udpPayloadSize=e.readUInt16BE(t+2),r.extendedRcode=e.readUInt8(t+4),r.ednsVersion=e.readUInt8(t+5),r.flags=e.readUInt16BE(t+6),r.flag_do=1==(r.flags>>15&1),r.options=P.decode(e,t+8),t+=8+P.decode.bytes;else{const s=e.readUInt16BE(t+2);r.ttl=e.readUInt32BE(t+4),r.class=a.toString(-32769&s),r.flush=!!(s&l);const n=H(r.type);r.data=n.decode(e,t+8),t+=8+n.decode.bytes}return F.decode.bytes=t-s,r},F.decode.bytes=0,F.encodingLength=function(e){const t=null!==e.data&&void 0!==e.data?e.data:e.options;return d.encodingLength(e.name)+8+H(e.type).encodingLength(t)};const z=t.question={};function V(e,t){let r=0;for(let s=0;s<e.length;s++)r+=t.encodingLength(e[s]);return r}function q(e,t,r,s){for(let n=0;n<e.length;n++)t.encode(e[n],r,s),s+=t.encode.bytes;return s}function K(e,t,r,s){for(let n=0;n<e.length;n++)e[n]=t.decode(r,s),s+=t.decode.bytes;return s}z.encode=function(e,t,r){t||(t=s.alloc(z.encodingLength(e))),r||(r=0);const i=r;return d.encode(e.name,t,r),r+=d.encode.bytes,t.writeUInt16BE(n.toType(e.type),r),r+=2,t.writeUInt16BE(a.toClass(void 0===e.class?"IN":e.class),r),r+=2,z.encode.bytes=r-i,e},z.encode.bytes=0,z.decode=function(e,t){t||(t=0);const r=t,s={};s.name=d.decode(e,t),t+=d.decode.bytes,s.type=n.toString(e.readUInt16BE(t)),t+=2,s.class=a.toString(e.readUInt16BE(t)),t+=2;return!!(32768&s.class)&&(s.class&=-32769),z.decode.bytes=t-r,s},z.decode.bytes=0,z.encodingLength=function(e){return d.encodingLength(e.name)+4},t.AUTHORITATIVE_ANSWER=1024,t.TRUNCATED_RESPONSE=512,t.RECURSION_DESIRED=256,t.RECURSION_AVAILABLE=128,t.AUTHENTIC_DATA=32,t.CHECKING_DISABLED=16,t.DNSSEC_OK=32768,t.encode=function(e,r,n){const i=!r;i&&(r=s.alloc(t.encodingLength(e))),n||(n=0);const o=n;return e.questions||(e.questions=[]),e.answers||(e.answers=[]),e.authorities||(e.authorities=[]),e.additionals||(e.additionals=[]),p.encode(e,r,n),n+=p.encode.bytes,n=q(e.questions,z,r,n),n=q(e.answers,F,r,n),n=q(e.authorities,F,r,n),n=q(e.additionals,F,r,n),t.encode.bytes=n-o,i&&t.encode.bytes!==r.length?r.slice(0,t.encode.bytes):r},t.encode.bytes=0,t.decode=function(e,r){r||(r=0);const s=r,n=p.decode(e,r);return r+=p.decode.bytes,r=K(n.questions,z,e,r),r=K(n.answers,F,e,r),r=K(n.authorities,F,e,r),r=K(n.additionals,F,e,r),t.decode.bytes=r-s,n},t.decode.bytes=0,t.encodingLength=function(e){return p.encodingLength(e)+V(e.questions||[],z)+V(e.answers||[],F)+V(e.authorities||[],F)+V(e.additionals||[],F)},t.streamEncode=function(e){const r=t.encode(e),n=s.alloc(2);n.writeUInt16BE(r.byteLength);const i=s.concat([n,r]);return t.streamEncode.bytes=i.byteLength,i},t.streamEncode.bytes=0,t.streamDecode=function(e){const r=e.readUInt16BE(0);if(e.byteLength<r+2)return null;const s=t.decode(e.slice(2));return t.streamDecode.bytes=t.decode.bytes,s},t.streamDecode.bytes=0},8982:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReceiverEstimatedMaxBitrate=void 0;const s=r(9543);class n{constructor(e={}){this.count=n.count,this.uniqueID="REMB",this.ssrcNum=0,this.ssrcFeedbacks=[],Object.assign(this,e)}static deSerialize(e){const[t,r,i,o,a]=(0,s.bufferReader)(e,[4,4,4,1,1]),c=(0,s.getBit)(a,0,6),u=((0,s.getBit)(a,6,2)<<16)+(e[14]<<8)+e[15],l=c>46?18446744073709551615n:BigInt(u)<<BigInt(c),d=[];for(let t=16;t<e.length;t+=4){const r=e.slice(t).readUIntBE(0,4);d.push(r)}return new n({senderSsrc:t,mediaSsrc:r,uniqueID:(0,s.bufferWriter)([4],[i]).toString(),ssrcNum:o,brExp:c,brMantissa:u,ssrcFeedbacks:d,bitrate:l})}serialize(){const e=Buffer.concat([(0,s.bufferWriter)([4,4],[this.senderSsrc,this.mediaSsrc]),Buffer.from(this.uniqueID),(0,s.bufferWriter)([1],[this.ssrcNum])]),t=new s.BitWriter(24);t.set(6,0,this.brExp).set(18,6,this.brMantissa);const r=Buffer.concat(this.ssrcFeedbacks.map((e=>(0,s.bufferWriter)([4],[e])))),n=Buffer.concat([e,(0,s.bufferWriter)([3],[t.value]),r]);return this.length=n.length/4,n}}t.ReceiverEstimatedMaxBitrate=n,n.count=15},9023:e=>{"use strict";e.exports=require("util")},9056:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTCSctpCapabilities=t.InboundStream=t.SCTP=void 0;const s=r(6982),n=r(4694),i=r(1221),o=r(9475),a=r(3506),c=r(4408),u=r(9981),l=(0,c.debug)("werift/sctp/sctp"),d=1200,h=1/8,p=2**32,f=["new","closed","connected","connecting"];class g{constructor(e,t=5e3){this.transport=e,this.port=t,this.flush=new c.Event,this.stateChanged=(0,a.createEventsFromList)(f),this.onReconfigStreams=new c.Event,this.onReceive=new c.Event,this.onSackReceived=async()=>{},this.associationState=o.SCTP_STATE.CLOSED,this.started=!1,this.state="new",this.isServer=!0,this.hmacKey=(0,s.randomBytes)(16),this.localPartialReliability=!0,this.localVerificationTag=(0,c.random32)(),this.remoteExtensions=[],this.remotePartialReliability=!0,this.remoteVerificationTag=0,this.advertisedRwnd=1048576,this.inboundStreams={},this._inboundStreamsCount=0,this._inboundStreamsMax=65535,this.sackDuplicates=[],this.sackMisOrdered=new Set,this.sackNeeded=!1,this.cwnd=3600,this.fastRecoveryTransmit=!1,this.flightSize=0,this.outboundQueue=[],this.outboundStreamSeq={},this._outboundStreamsCount=65535,this.localTsn=Number((0,c.random32)()),this.lastSackedTsn=b(this.localTsn),this.advancedPeerAckTsn=b(this.localTsn),this.partialBytesAcked=0,this.sentQueue=[],this.reconfigRequestSeq=this.localTsn,this.reconfigResponseSeq=0,this.reconfigQueue=[],this.rto=3,this.timer1Failures=0,this.timer2Failures=0,this.timerReconfigFailures=0,this.send=async(e,t,r,{expiry:s,maxRetransmits:n,ordered:o}={expiry:void 0,maxRetransmits:void 0,ordered:!0})=>{const a=o&&this.outboundStreamSeq[e]||0,u=Math.ceil(r.length/d);let l=0;const h=[];for(let c=0;c<u;c++){const p=new i.DataChunk(0,void 0);p.flags=0,o||(p.flags=4),0===c&&(p.flags|=2),c===u-1&&(p.flags|=1),p.tsn=this.localTsn,p.streamId=e,p.streamSeqNum=a,p.protocol=t,p.userData=r.slice(l,l+d),p.bookSize=p.userData.length,p.expiry=s,p.maxRetransmits=n,l+=d,this.localTsn=v(this.localTsn),h.push(p)}h.forEach((e=>{this.outboundQueue.push(e)})),o&&(this.outboundStreamSeq[e]=(0,c.uint16Add)(a,1)),this.timer3Handle?this.outboundQueue.length?await this.flush.asPromise():await new Promise((e=>setImmediate(e))):await this.transmit()},this.timer1Expired=()=>{this.timer1Failures++,this.timer1Handle=void 0,this.timer1Failures>8?this.setState(o.SCTP_STATE.CLOSED):(setImmediate((()=>{this.sendChunk(this.timer1Chunk).catch((e=>{l("send timer1 chunk failed",e.message)}))})),this.timer1Handle=setTimeout(this.timer1Expired,1e3*this.rto))},this.timer2Expired=()=>{this.timer2Failures++,this.timer2Handle=void 0,this.timer2Failures>10?this.setState(o.SCTP_STATE.CLOSED):(setImmediate((()=>{this.sendChunk(this.timer2Chunk).catch((e=>{l("send timer2Chunk failed",e.message)}))})),this.timer2Handle=setTimeout(this.timer2Expired,1e3*this.rto))},this.timer3Expired=()=>{this.timer3Handle=void 0,this.sentQueue.forEach((e=>{this.maybeAbandon(e)||(e.retransmit=!0)})),this.updateAdvancedPeerAckPoint(),this.fastRecoveryExit=void 0,this.flightSize=0,this.partialBytesAcked=0,this.ssthresh=Math.max(Math.floor(this.cwnd/2),4800),this.cwnd=d,this.transmit()},this.timerReconfigHandleExpired=async()=>{this.timerReconfigFailures++,this.rto=Math.ceil(1.5*this.rto),this.timerReconfigFailures>10?(l("timerReconfigFailures",this.timerReconfigFailures),this.setState(o.SCTP_STATE.CLOSED),this.timerReconfigHandle=void 0):this.reconfigRequest&&(l("timerReconfigHandleExpired",this.timerReconfigFailures,this.rto),await this.sendReconfigParam(this.reconfigRequest),this.timerReconfigHandle=setTimeout(this.timerReconfigHandleExpired,1e3*this.rto))},this.localPort=this.port,this.transport.onData=e=>{this.handleData(e)}}get maxChannels(){if(this._inboundStreamsCount>0)return Math.min(this._inboundStreamsCount,this._outboundStreamsCount)}static client(e,t=5e3){const r=new g(e,t);return r.isServer=!1,r}static server(e,t=5e3){const r=new g(e,t);return r.isServer=!0,r}async handleData(e){let t;const[,,r,s]=(0,i.parsePacket)(e);if(s.filter((e=>e.type===i.InitChunk.type)).length>0){if(1!=s.length)throw new Error;t=0}else t=this.localVerificationTag;if(r===t){for(const e of s)await this.receiveChunk(e);this.sackNeeded&&await this.sendSack()}}async sendSack(){if(this.sackTimeout)return;if(await new Promise((e=>this.sackTimeout=setImmediate(e))),this.sackTimeout=void 0,!this.sackNeeded)return;const e=[];let t;[...this.sackMisOrdered].sort().forEach((r=>{const s=(r-this.lastReceivedTsn)%p;r===t?e[e.length-1][1]=s:e.push([s,s]),t=v(r)}));const r=new i.SackChunk(0,void 0);r.cumulativeTsn=this.lastReceivedTsn,r.advertisedRwnd=Math.max(0,this.advertisedRwnd),r.duplicates=[...this.sackDuplicates],r.gaps=e,await this.sendChunk(r).catch((e=>{l("send sack failed",e.message)})),this.sackDuplicates=[],this.sackNeeded=!1}async receiveChunk(e){switch(e.type){case i.DataChunk.type:this.receiveDataChunk(e);break;case i.InitChunk.type:{if(!this.isServer)return;const t=e;l("receive init",t),this.lastReceivedTsn=b(t.initialTsn),this.reconfigResponseSeq=b(t.initialTsn),this.remoteVerificationTag=t.initiateTag,this.ssthresh=t.advertisedRwnd,this.getExtensions(t.params),this._inboundStreamsCount=Math.min(t.outboundStreams,this._inboundStreamsMax),this._outboundStreamsCount=Math.min(this._outboundStreamsCount,t.inboundStreams);const r=new i.InitAckChunk;r.initiateTag=this.localVerificationTag,r.advertisedRwnd=this.advertisedRwnd,r.outboundStreams=this._outboundStreamsCount,r.inboundStreams=this._inboundStreamsCount,r.initialTsn=this.localTsn,this.setExtensions(r.params);const o=Date.now()/1e3;let a=Buffer.from(n.jspack.Pack("!L",[o]));a=Buffer.concat([a,(0,s.createHmac)("sha1",this.hmacKey).update(a).digest()]),r.params.push([7,a]),l("send initAck",r),await this.sendChunk(r).catch((e=>{l("send initAck failed",e.message)}))}break;case i.InitAckChunk.type:{if(this.associationState!=o.SCTP_STATE.COOKIE_WAIT)return;const t=e;this.timer1Cancel(),this.lastReceivedTsn=b(t.initialTsn),this.reconfigResponseSeq=b(t.initialTsn),this.remoteVerificationTag=t.initiateTag,this.ssthresh=t.advertisedRwnd,this.getExtensions(t.params),this._inboundStreamsCount=Math.min(t.outboundStreams,this._inboundStreamsMax),this._outboundStreamsCount=Math.min(this._outboundStreamsCount,t.inboundStreams);const r=new i.CookieEchoChunk;for(const[e,s]of t.params)if(7===e){r.body=s;break}await this.sendChunk(r).catch((e=>{l("send echo failed",e.message)})),this.timer1Start(r),this.setState(o.SCTP_STATE.COOKIE_ECHOED)}break;case i.SackChunk.type:await this.receiveSackChunk(e);break;case i.HeartbeatChunk.type:{const t=new i.HeartbeatAckChunk;t.params=e.params,await this.sendChunk(t).catch((e=>{l("send heartbeat ack failed",e.message)}))}break;case i.AbortChunk.type:this.setState(o.SCTP_STATE.CLOSED);break;case i.ShutdownChunk.type:{this.timer2Cancel(),this.setState(o.SCTP_STATE.SHUTDOWN_RECEIVED);const e=new i.ShutdownAckChunk;await this.sendChunk(e).catch((e=>{l("send shutdown ack failed",e.message)})),this.t2Start(e),this.setState(o.SCTP_STATE.SHUTDOWN_SENT)}break;case i.ErrorChunk.type:l("ErrorChunk",e.descriptions);break;case i.CookieEchoChunk.type:{if(!this.isServer)return;const t=e.body,r=(0,s.createHmac)("sha1",this.hmacKey).update(t.slice(0,4)).digest();if(24!=t?.length||!t.slice(4).equals(r))return void l("x State cookie is invalid");const a=Date.now()/1e3,c=n.jspack.Unpack("!L",t)[0];if(c<a-60||c>a){const e=new i.ErrorChunk(0,void 0);return e.params.push([i.ErrorChunk.CODE.StaleCookieError,Buffer.concat([...Array(8)].map((()=>Buffer.from("\0"))))]),void await this.sendChunk(e).catch((e=>{l("send errorChunk failed",e.message)}))}const u=new i.CookieAckChunk;await this.sendChunk(u).catch((e=>{l("send cookieAck failed",e.message)})),this.setState(o.SCTP_STATE.ESTABLISHED)}break;case i.CookieAckChunk.type:if(this.associationState!=o.SCTP_STATE.COOKIE_ECHOED)return;this.timer1Cancel(),this.setState(o.SCTP_STATE.ESTABLISHED);break;case i.ShutdownCompleteChunk.type:if(this.associationState!=o.SCTP_STATE.SHUTDOWN_ACK_SENT)return;this.timer2Cancel(),this.setState(o.SCTP_STATE.CLOSED);break;case i.ReconfigChunk.type:{if(this.associationState!=o.SCTP_STATE.ESTABLISHED)return;const t=e;for(const[e,r]of t.params){const t=u.RECONFIG_PARAM_BY_TYPES[e];t&&await this.receiveReconfigParam(t.parse(r))}}break;case i.ForwardTsnChunk.type:this.receiveForwardTsnChunk(e)}}getExtensions(e){for(const[t,r]of e)49152===t?this.remotePartialReliability=!0:32776===t&&(this.remoteExtensions=[...r])}async receiveReconfigParam(e){switch(l("receiveReconfigParam",u.RECONFIG_PARAM_BY_TYPES[e.type]),e.type){case u.OutgoingSSNResetRequestParam.type:{const t=e,r=new u.ReconfigResponseParam(t.requestSequence,u.reconfigResult.ReconfigResultSuccessPerformed);this.reconfigResponseSeq=t.requestSequence,await this.sendReconfigParam(r),await Promise.all(t.streams.map((async e=>{delete this.inboundStreams[e],this.outboundStreamSeq[e]&&(this.reconfigQueue.includes(e)||this.reconfigQueue.push(e))}))),await this.transmitReconfigRequest(),this.onReconfigStreams.execute(t.streams)}break;case u.ReconfigResponseParam.type:{const t=e;if(t.result!==u.reconfigResult.ReconfigResultSuccessPerformed)l("OutgoingSSNResetRequestParam failed",Object.keys(u.reconfigResult).find((e=>u.reconfigResult[e]===t.result)));else if(t.responseSequence===this.reconfigRequest?.requestSequence){const e=this.reconfigRequest.streams.map((e=>(delete this.outboundStreamSeq[e],e)));this.onReconfigStreams.execute(e),this.reconfigRequest=void 0,this.timerReconfigCancel(),this.rto=3,this.timerReconfigFailures=0,this.reconfigQueue.length>0&&await this.transmitReconfigRequest()}}break;case u.StreamAddOutgoingParam.type:{const t=e;this._inboundStreamsCount+=t.newStreams;const r=new u.ReconfigResponseParam(t.requestSequence,1);this.reconfigResponseSeq=t.requestSequence,await this.sendReconfigParam(r)}}}receiveDataChunk(e){if(this.sackNeeded=!0,this.markReceived(e.tsn))return;const t=this.getInboundStream(e.streamId);t.addChunk(e),this.advertisedRwnd-=e.userData.length;for(const e of t.popMessages())this.advertisedRwnd+=e[2].length,this.receive(...e)}async receiveSackChunk(e){if((0,c.uint32Gt)(this.lastSackedTsn,e.cumulativeTsn))return;const t=Date.now()/1e3;this.lastSackedTsn=e.cumulativeTsn;const r=this.flightSize>=this.cwnd;let s=0,n=0;for(;this.sentQueue.length>0&&(0,c.uint32Gte)(this.lastSackedTsn,this.sentQueue[0].tsn);){const e=this.sentQueue.shift();s++,e?.acked||(n+=e.bookSize,this.flightSizeDecrease(e)),1===s&&1===e.sentCount&&this.updateRto(t-e.sentTime)}this.sentQueue.length||(this.sentQueue=[]);let i=!1;if(e.gaps.length>0){const t=new Set;let r;e.gaps.forEach((s=>{for(let n=s[0];n<s[1]+1;n++)r=(e.cumulativeTsn+n)%p,t.add(r)}));let s=e.cumulativeTsn;for(const e of this.sentQueue){if((0,c.uint32Gt)(e.tsn,r))break;t.has(e.tsn)&&!e.acked&&(n+=e.bookSize,e.acked=!0,this.flightSizeDecrease(e),s=e.tsn)}for(const e of this.sentQueue){if((0,c.uint32Gt)(e.tsn,s))break;t.has(e.tsn)||(e.misses++,3===e.misses&&(e.misses=0,this.maybeAbandon(e)||(e.retransmit=!0),e.acked=!1,this.flightSizeDecrease(e),i=!0))}}void 0===this.fastRecoveryExit?(s&&r&&(this.cwnd<=this.ssthresh?this.cwnd+=Math.min(n,d):(this.partialBytesAcked+=n,this.partialBytesAcked>=this.cwnd&&(this.partialBytesAcked-=this.cwnd,this.cwnd+=d))),i&&(this.ssthresh=Math.max(Math.floor(this.cwnd/2),4800),this.cwnd=this.ssthresh,this.partialBytesAcked=0,this.fastRecoveryExit=this.sentQueue[this.sentQueue.length-1].tsn,this.fastRecoveryTransmit=!0)):(0,c.uint32Gte)(e.cumulativeTsn,this.fastRecoveryExit)&&(this.fastRecoveryExit=void 0),0===this.sentQueue.length?this.timer3Cancel():s>0&&this.timer3Restart(),this.updateAdvancedPeerAckPoint(),await this.onSackReceived(),await this.transmit()}receiveForwardTsnChunk(e){if(this.sackNeeded=!0,(0,c.uint32Gte)(this.lastReceivedTsn,e.cumulativeTsn))return;const t=e=>(0,c.uint32Gt)(e,this.lastReceivedTsn);this.lastReceivedTsn=e.cumulativeTsn,this.sackMisOrdered=new Set([...this.sackMisOrdered].filter(t));for(const e of[...this.sackMisOrdered].sort()){if(e!==v(this.lastReceivedTsn))break;this.lastReceivedTsn=e}this.sackDuplicates=this.sackDuplicates.filter(t),this.sackMisOrdered=new Set([...this.sackMisOrdered].filter(t));for(const[t,r]of e.streams){const e=this.getInboundStream(t);e.streamSequenceNumber=(0,c.uint16Add)(r,1);for(const t of e.popMessages())this.advertisedRwnd+=t[2].length,this.receive(...t)}Object.values(this.inboundStreams).forEach((e=>{this.advertisedRwnd+=e.pruneChunks(this.lastReceivedTsn)}))}updateRto(e){this.srtt?(this.rttvar=.75*this.rttvar+.25*Math.abs(this.srtt-e),this.srtt=.875*this.srtt+h*e):(this.rttvar=e/2,this.srtt=e),this.rto=Math.max(1,Math.min(this.srtt+4*this.rttvar,60))}receive(e,t,r){this.onReceive.execute(e,t,r)}getInboundStream(e){return this.inboundStreams[e]||(this.inboundStreams[e]=new m),this.inboundStreams[e]}markReceived(e){if((0,c.uint32Gte)(this.lastReceivedTsn,e)||this.sackMisOrdered.has(e))return this.sackDuplicates.push(e),!0;this.sackMisOrdered.add(e);for(const e of[...this.sackMisOrdered].sort()){if(e!==v(this.lastReceivedTsn))break;this.lastReceivedTsn=e}const t=e=>(0,c.uint32Gt)(e,this.lastReceivedTsn);return this.sackDuplicates=this.sackDuplicates.filter(t),this.sackMisOrdered=new Set([...this.sackMisOrdered].filter(t)),!1}async transmit(){this.forwardTsnChunk&&(await this.sendChunk(this.forwardTsnChunk).catch((e=>{l("send forwardTsn failed",e.message)})),this.forwardTsnChunk=void 0,this.timer3Handle||this.timer3Start());const e=null!=this.fastRecoveryExit?2400:4800,t=Math.min(this.flightSize+e,this.cwnd);let r=!0;for(const e of this.sentQueue){if(e.retransmit){if(this.fastRecoveryTransmit)this.fastRecoveryTransmit=!1;else if(this.flightSize>=t)return;this.flightSizeIncrease(e),e.misses=0,e.retransmit=!1,e.sentCount++,await this.sendChunk(e).catch((e=>{l("send data failed",e.message)})),r&&this.timer3Restart()}r=!1}for(;this.outboundQueue.length>0;){const e=this.outboundQueue.shift();if(!e)return;this.sentQueue.push(e),this.flightSizeIncrease(e),e.sentCount++,e.sentTime=Date.now()/1e3,await this.sendChunk(e).catch((e=>{l("send data outboundQueue failed",e.message)})),this.timer3Handle||this.timer3Start()}this.outboundQueue=[],this.flush.execute()}async transmitReconfigRequest(){if(this.reconfigQueue.length>0&&this.associationState===o.SCTP_STATE.ESTABLISHED&&!this.reconfigRequest){const e=[...new Set(this.reconfigQueue)],t=e.slice(0,135);this.reconfigQueue=e.slice(135);const r=new u.OutgoingSSNResetRequestParam(this.reconfigRequestSeq,this.reconfigResponseSeq,b(this.localTsn),t);this.reconfigRequestSeq=v(this.reconfigRequestSeq),this.reconfigRequest=r,await this.sendReconfigParam(r),this.timerReconfigHandleStart()}}async sendReconfigParam(e){l("sendReconfigParam",e);const t=new i.ReconfigChunk;t.params.push([e.type,e.bytes]),await this.sendChunk(t).catch((e=>{l("send reconfig failed",e.message)}))}async sendResetRequest(e){l("sendResetRequest",e);const t=new i.DataChunk(0,void 0);t.streamId=e,this.outboundQueue.push(t),this.timer3Handle||await this.transmit()}flightSizeIncrease(e){this.flightSize+=e.bookSize}flightSizeDecrease(e){this.flightSize=Math.max(0,this.flightSize-e.bookSize)}timer1Start(e){if(this.timer1Handle)throw new Error;this.timer1Chunk=e,this.timer1Failures=0,this.timer1Handle=setTimeout(this.timer1Expired,1e3*this.rto)}timer1Cancel(){this.timer1Handle&&(clearTimeout(this.timer1Handle),this.timer1Handle=void 0,this.timer1Chunk=void 0)}t2Start(e){if(this.timer2Handle)throw new Error;this.timer2Chunk=e,this.timer2Failures=0,this.timer2Handle=setTimeout(this.timer2Expired,1e3*this.rto)}timer2Cancel(){this.timer2Handle&&(clearTimeout(this.timer2Handle),this.timer2Handle=void 0,this.timer2Chunk=void 0)}timer3Start(){if(this.timer3Handle)throw new Error;this.timer3Handle=setTimeout(this.timer3Expired,1e3*this.rto)}timer3Restart(){this.timer3Cancel(),this.timer3Handle=setTimeout(this.timer3Expired,this.rto)}timer3Cancel(){this.timer3Handle&&(clearTimeout(this.timer3Handle),this.timer3Handle=void 0)}timerReconfigHandleStart(){this.timerReconfigHandle||(l("timerReconfigHandleStart",{rto:this.rto}),this.timerReconfigFailures=0,this.timerReconfigHandle=setTimeout(this.timerReconfigHandleExpired,1e3*this.rto))}timerReconfigCancel(){this.timerReconfigHandle&&(l("timerReconfigCancel"),clearTimeout(this.timerReconfigHandle),this.timerReconfigHandle=void 0,this.timerReconfigFailures=0)}updateAdvancedPeerAckPoint(){(0,c.uint32Gt)(this.lastSackedTsn,this.advancedPeerAckTsn)&&(this.advancedPeerAckTsn=this.lastSackedTsn);let e=0;const t={};for(;this.sentQueue.length>0&&this.sentQueue[0].abandoned;){const r=this.sentQueue.shift();this.advancedPeerAckTsn=r.tsn,e++,4&r.flags||(t[r.streamId]=r.streamSeqNum)}this.sentQueue.length||(this.sentQueue=[]),e&&(this.forwardTsnChunk=new i.ForwardTsnChunk(0,void 0),this.forwardTsnChunk.cumulativeTsn=this.advancedPeerAckTsn,this.forwardTsnChunk.streams=Object.entries(t).map((([e,t])=>[Number(e),t])))}maybeAbandon(e){if(e.abandoned)return!0;if(!(!!e.maxRetransmits&&e.maxRetransmits<e.sentCount||!!e.expiry&&e.expiry<Date.now()/1e3))return!1;const t=this.sentQueue.findIndex((t=>t.type===e.type));for(let e=t;e>=0;e--){const t=this.sentQueue[e];if(t.abandoned=!0,t.retransmit=!1,1&t.flags)break}for(let e=t;e<this.sentQueue.length;e++){const t=this.sentQueue[e];if(t.abandoned=!0,t.retransmit=!1,1&t.flags)break}return!0}static getCapabilities(){return new y(65536)}setRemotePort(e){this.remotePort=e}async start(e){this.started||(this.started=!0,this.setConnectionState("connecting"),e&&this.setRemotePort(e),this.isServer||await this.init())}async init(){const e=new i.InitChunk;e.initiateTag=this.localVerificationTag,e.advertisedRwnd=this.advertisedRwnd,e.outboundStreams=this._outboundStreamsCount,e.inboundStreams=this._inboundStreamsMax,e.initialTsn=this.localTsn,this.setExtensions(e.params),l("send init",e);try{await this.sendChunk(e),this.timer1Start(e),this.setState(o.SCTP_STATE.COOKIE_WAIT)}catch(e){l("send init failed",e.message)}}setExtensions(e){const t=[];this.localPartialReliability&&(e.push([49152,Buffer.from("")]),t.push(i.ForwardTsnChunk.type)),t.push(i.ReConfigChunk.type),e.push([32776,Buffer.from(t)])}async sendChunk(e){if("closed"===this.state)return;if(void 0===this.remotePort)throw new Error("invalid remote port");const t=(0,i.serializePacket)(this.localPort,this.remotePort,this.remoteVerificationTag,e);await this.transport.send(t)}setState(e){e!=this.associationState&&(this.associationState=e),e===o.SCTP_STATE.ESTABLISHED?this.setConnectionState("connected"):e===o.SCTP_STATE.CLOSED&&(this.timer1Cancel(),this.timer2Cancel(),this.timer3Cancel(),this.timerReconfigCancel(),this.setConnectionState("closed"),this.removeAllListeners())}setConnectionState(e){this.state=e,l("setConnectionState",e),this.stateChanged[e].execute()}async stop(){this.associationState!==o.SCTP_STATE.CLOSED&&await this.abort(),this.setState(o.SCTP_STATE.CLOSED),clearTimeout(this.timer1Handle),clearTimeout(this.timer2Handle),clearTimeout(this.timer3Handle),clearTimeout(this.timerReconfigHandle)}async abort(){const e=new i.AbortChunk;await this.sendChunk(e).catch((e=>{l("send abort failed",e.message)}))}removeAllListeners(){Object.values(this.stateChanged).forEach((e=>e.allUnsubscribe()))}}t.SCTP=g;class m{constructor(){this.reassembly=[],this.streamSequenceNumber=0}addChunk(e){if(0===this.reassembly.length||(0,c.uint32Gt)(e.tsn,this.reassembly[this.reassembly.length-1].tsn))this.reassembly.push(e);else for(const[t,r]of(0,a.enumerate)(this.reassembly)){if(r.tsn===e.tsn)throw new Error("duplicate chunk in reassembly");if((0,c.uint32Gt)(r.tsn,e.tsn)){this.reassembly.splice(t,0,e);break}}}*popMessages(){let e,t,r,s=0;for(;s<this.reassembly.length;){const n=this.reassembly[s];if(void 0===e){if(r=!(4&n.flags),!(2&n.flags)){if(r)break;s++;continue}if(r&&(0,c.uint16Gt)(n.streamSeqNum,this.streamSequenceNumber))break;t=n.tsn,e=s}else if(n.tsn!==t){if(r)break;e=void 0,s++;continue}if(1&n.flags){const t=this.reassembly.slice(e,s+1).map((e=>e.userData)).reduce(((e,t)=>(e.push(t),e.push(Buffer.from("")),e)),[]);t.pop();const i=Buffer.concat(t);this.reassembly=[...this.reassembly.slice(0,e),...this.reassembly.slice(s+1)],r&&n.streamSeqNum===this.streamSequenceNumber&&(this.streamSequenceNumber=(0,c.uint16Add)(this.streamSequenceNumber,1)),s=e,yield[n.streamId,n.protocol,i]}else s++;t=v(t)}}pruneChunks(e){let t=-1,r=0;for(const[s,n]of this.reassembly.entries()){if(!(0,c.uint32Gte)(e,n.tsn))break;t=s,r+=n.userData.length}return this.reassembly=this.reassembly.slice(t+1),r}}t.InboundStream=m;class y{constructor(e){this.maxMessageSize=e}}function b(e){return(e-1)%p}function v(e){return(e+1)%p}t.RTCSctpCapabilities=y},9133:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerHello=void 0;const s=r(6353),n=r(7077),i=r(3268),o=r(9602),a=r(9750);class c{constructor(e,t,r,s,n,i){this.serverVersion=e,this.random=t,this.sessionId=r,this.cipherSuite=s,this.compressionMethod=n,this.extensions=i,this.msgType=o.HandshakeType.server_hello_2}static createEmpty(){return new c(void 0,void 0,void 0,void 0,void 0,void 0)}static deSerialize(e){const t=(0,s.decode)(e,c.spec),r=new c(...Object.values(t));return r.serialize().length<e.length?new c(...Object.values((0,s.decode)(e,{...c.spec,extensions:i.ExtensionList}))):r}serialize(){const e=void 0===this.extensions?(0,s.encode)(this,c.spec).slice():(0,s.encode)(this,{...c.spec,extensions:i.ExtensionList}).slice();return Buffer.from(e)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.ServerHello=c,c.spec={serverVersion:i.ProtocolVersion,random:a.DtlsRandom.spec,sessionId:s.types.buffer(s.types.uint8),cipherSuite:s.types.uint16be,compressionMethod:s.types.uint8}},9142:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SrtcpSession=void 0;const s=r(3450),n=r(6550);class i extends n.Session{constructor(e){super(s.SrtcpContext),this.config=e,this.decrypt=e=>{const[t]=this.remoteContext.decryptRTCP(e);return t},this.start(e.keys.localMasterKey,e.keys.localMasterSalt,e.keys.remoteMasterKey,e.keys.remoteMasterSalt,e.profile)}encrypt(e){return this.localContext.encryptRTCP(e)}}t.SrtcpSession=i},9260:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTCRtpReceiver=void 0;const s=r(6982),n=r(6460),i=r(5433),o=r(6252),a=r(8806),c=r(5693),u=r(8172),l=r(7005),d=r(4262),h=r(7734),p=r(4579),f=r(3535),g=(0,o.debug)("werift:packages/webrtc/src/media/rtpReceiver.ts");t.RTCRtpReceiver=class{get codecArray(){return Object.values(this.codecs).sort(((e,t)=>e.payloadType-t.payloadType))}constructor(e,t,r){this.config=e,this.kind=t,this.rtcpSsrc=r,this.codecs={},this.ssrcByRtx={},this.nack=new c.NackHandler(this),this.audioRedHandler=new o.RedHandler,this.type="receiver",this.uuid=(0,s.randomUUID)().toString(),this.tracks=[],this.trackBySSRC={},this.trackByRID={},this.lastSRtimestamp={},this.receiveLastSRTimestamp={},this.onPacketLost=this.nack.onPacketLost,this.onRtcp=new i.Event,this.stopped=!1,this.rtcpRunning=!1,this.rtcpCancel=new AbortController,this.remoteStreams={},this.handleRtpBySsrc=(e,t)=>{const r=this.trackBySSRC[e.header.ssrc];this.handleRTP(e,t,r)},this.handleRtpByRid=(e,t,r)=>{const s=this.trackByRID[t];this.trackBySSRC[e.header.ssrc]||(this.trackBySSRC[e.header.ssrc]=s),this.handleRTP(e,r,s)}}setDtlsTransport(e){this.dtlsTransport=e}get track(){return this.tracks[0]??new f.MediaStreamTrack({kind:this.kind})}get nackEnabled(){return this.codecArray[0]?.rtcpFeedback.find((e=>"nack"===e.type))}get twccEnabled(){return this.codecArray[0]?.rtcpFeedback.find((e=>e.type===(0,h.useTWCC)().type))}get pliEnabled(){return this.codecArray[0]?.rtcpFeedback.find((e=>e.type===(0,h.usePLI)().type))}prepareReceive(e){e.codecs.forEach((e=>{this.codecs[e.payloadType]=e})),e.encodings.forEach((e=>{e.rtx&&(this.ssrcByRtx[e.rtx.ssrc]=e.ssrc)}))}setupTWCC(e){this.twccEnabled&&!this.receiverTWCC&&(this.receiverTWCC=new u.ReceiverTWCC(this.dtlsTransport,this.rtcpSsrc,e))}addTrack(e){return!this.tracks.find((t=>t.rid?t.rid===e.rid:t.ssrc?t.ssrc===e.ssrc:void 0))&&(this.tracks.push(e),e.ssrc&&(this.trackBySSRC[e.ssrc]=e),e.rid&&(this.trackByRID[e.rid]=e),!0)}stop(){this.stopped=!0,this.rtcpRunning=!1,this.rtcpCancel.abort(),this.receiverTWCC&&(this.receiverTWCC.twccRunning=!1),this.nack.close()}async runRtcp(){if(!this.rtcpRunning&&!this.stopped){this.rtcpRunning=!0;try{for(;this.rtcpRunning;){await(0,n.setTimeout)(500+1e3*Math.random(),void 0,{signal:this.rtcpCancel.signal});const e=Object.entries(this.remoteStreams).map((([e,t])=>{let r=0,s=0;if(this.lastSRtimestamp[e]){r=this.lastSRtimestamp[e];const t=(0,a.timestampSeconds)()-this.receiveLastSRTimestamp[e];t>0&&t<65536&&(s=(0,i.int)(65536*t))}return new o.RtcpReceiverInfo({ssrc:Number(e),fractionLost:t.fraction_lost,packetsLost:t.packets_lost,highestSequence:t.max_seq,jitter:t.jitter,lsr:r,dlsr:s})})),t=new o.RtcpRrPacket({ssrc:this.rtcpSsrc,reports:e});try{this.config.debug.receiverReportDelay&&await(0,n.setTimeout)(this.config.debug.receiverReportDelay),await this.dtlsTransport.sendRtcp([t])}catch(e){g("sendRtcp failed",e),await(0,n.setTimeout)(500+1e3*Math.random())}}}catch(e){}}}async getStats(){const e=(0,p.getStatsTimestamp)(),t=[];if(!this.dtlsTransport)return t;const r=(0,p.generateStatsId)("transport",this.dtlsTransport.id);for(const s of this.tracks){if(!s.ssrc)continue;const n=this.remoteStreams[s.ssrc];if(!n)continue;const i={type:"inbound-rtp",id:(0,p.generateStatsId)("inbound-rtp",s.ssrc),timestamp:e,ssrc:s.ssrc,kind:this.kind,transportId:r,codecId:this.codecs[0]?(0,p.generateStatsId)("codec",this.codecs[0].payloadType,r):void 0,mid:this.sdesMid,trackIdentifier:s.id,packetsReceived:n.packets_received,packetsLost:n.packets_lost,jitter:n.jitter};if(t.push(i),this.lastSRtimestamp[s.ssrc]){const n={type:"remote-outbound-rtp",id:(0,p.generateStatsId)("remote-outbound-rtp",s.ssrc),timestamp:e,ssrc:s.ssrc,kind:this.kind,transportId:r,codecId:i.codecId,localId:i.id,remoteTimestamp:1e3*this.receiveLastSRTimestamp[s.ssrc]};t.push(n)}}return t}async sendRtcpPLI(e){if(!this.pliEnabled)return void g("pli not supported",{mediaSsrc:e});if(this.stopped)return;g("sendRtcpPLI",{mediaSsrc:e});const t=new o.RtcpPayloadSpecificFeedback({feedback:new o.PictureLossIndication({senderSsrc:this.rtcpSsrc,mediaSsrc:e})});try{await this.dtlsTransport.sendRtcp([t])}catch(e){g(e)}}handleRtcpPacket(e){if(e.type===o.RtcpSrPacket.type){const t=e;this.lastSRtimestamp[t.ssrc]=(0,a.compactNtp)(t.senderInfo.ntpTimestamp),this.receiveLastSRTimestamp[t.ssrc]=(0,a.timestampSeconds)();const r=this.trackBySSRC[e.ssrc];r&&r.onReceiveRtcp.execute(e)}this.onRtcp.execute(e)}handleRTP(e,t,r){if(this.stopped)return;const s=this.codecs[e.header.payloadType];if(!s)return;if(this.remoteStreams[e.header.ssrc]=this.remoteStreams[e.header.ssrc]??new l.StreamStatistics(s.clockRate),this.remoteStreams[e.header.ssrc].add(e),this.receiverTWCC){const e=t[o.RTP_EXTENSION_URI.transportWideCC];if(null==!e)throw new Error("undefined");this.receiverTWCC.handleTWCC(e)}else this.twccEnabled&&this.setupTWCC(e.header.ssrc);if("rtx"===s.name.toLowerCase()){const t=this.ssrcByRtx[e.header.ssrc],n=(0,d.codecParametersFromString)(s.parameters??""),i=this.codecs[n.apt];if(e.payload.length<2)return;e=(0,o.unwrapRtx)(e,i.payloadType,t),r=this.trackBySSRC[t]}let n;if("red"!==s.name.toLowerCase()||(n=o.Red.deSerialize(e.payload),Object.keys(this.codecs).includes(n.header.fields[0].blockPT.toString()))){if("video"===r?.kind&&this.nackEnabled&&this.nack.addPacket(e),r)if(n){if("audio"===r.kind){const s=this.audioRedHandler.push(n,e);for(const e of s)r.onReceiveRtp.execute(e.clone(),t)}}else r.onReceiveRtp.execute(e.clone(),t);this.runRtcp()}}}},9262:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9023),n=r(5865);var i,o;!function(e){e[e.UNIVERSAL=0]="UNIVERSAL",e[e.APPLICATION=64]="APPLICATION",e[e.CONTEXT_SPECIFIC=128]="CONTEXT_SPECIFIC",e[e.PRIVATE=192]="PRIVATE"}(i=t.Class||(t.Class={})),function(e){e[e.NONE=0]="NONE",e[e.BOOLEAN=1]="BOOLEAN",e[e.INTEGER=2]="INTEGER",e[e.BITSTRING=3]="BITSTRING",e[e.OCTETSTRING=4]="OCTETSTRING",e[e.NULL=5]="NULL",e[e.OID=6]="OID",e[e.ENUMERATED=10]="ENUMERATED",e[e.UTF8=12]="UTF8",e[e.SEQUENCE=16]="SEQUENCE",e[e.SET=17]="SET",e[e.NUMERICSTRING=18]="NUMERICSTRING",e[e.PRINTABLESTRING=19]="PRINTABLESTRING",e[e.T61STRING=20]="T61STRING",e[e.IA5STRING=22]="IA5STRING",e[e.UTCTIME=23]="UTCTIME",e[e.GENERALIZEDTIME=24]="GENERALIZEDTIME",e[e.GENERALSTRING=27]="GENERALSTRING"}(o=t.Tag||(t.Tag={}));class a{constructor(e,t){this.buf=e,this.bitLen=t}at(e){if(e<0||e>=this.bitLen||!Number.isInteger(e))return 0;const t=Math.floor(e/8),r=7-e%8;return this.buf[t]>>r&1}rightAlign(){const e=8-this.bitLen%8;if(8===e||0===this.buf.length)return this.buf;const t=Buffer.alloc(this.buf.length);t[0]=this.buf[0]>>e;for(let r=1;r<this.buf.length;r++)t[r]=this.buf[r-1]<<8-e,t[r]|=this.buf[r]>>e;return t}}t.BitString=a;class c{static Bool(e){const t=new c(i.UNIVERSAL,o.BOOLEAN,Buffer.from([e?255:0]));return t._value=e,t}static parseBool(e){if(!(e instanceof Buffer)||1!==e.length)throw new Error("ASN1 syntax error: invalid boolean");switch(e[0]){case 0:return!1;case 255:return!0;default:throw new Error("ASN1 syntax error: invalid boolean")}}static Integer(e){if(e instanceof Buffer){const t=new c(i.UNIVERSAL,o.INTEGER,e);return t._value=e.toString("hex"),t}if(!Number.isSafeInteger(e))throw new Error("ASN1 syntax error: invalid integer");let t;if(e>=-128&&e<128)t=Buffer.alloc(1),t.writeInt8(e,0);else if(e>=-32768&&e<32768)t=Buffer.alloc(2),t.writeIntBE(e,0,2);else if(e>=-8388608&&e<8388608)t=Buffer.alloc(3),t.writeIntBE(e,0,3);else if(e>=-2147483648&&e<2147483648)t=Buffer.alloc(4),t.writeIntBE(e,0,4);else if(e>=-549755813888&&e<549755813888)t=Buffer.alloc(5),t.writeIntBE(e,0,5);else{if(!(e>=-0x800000000000&&e<0x800000000000))throw new Error("ASN1 syntax error: invalid Integer");t=Buffer.alloc(6),t.writeIntBE(e,0,6)}const r=new c(i.UNIVERSAL,o.INTEGER,t);return r._value=e,r}static parseInteger(e){if(!(e instanceof Buffer)||0===e.length)throw new Error("ASN1 syntax error: invalid Integer");return e.length>6?e.toString("hex"):e.readIntBE(0,e.length)}static parseIntegerNum(e){const t=c.parseInteger(e);if("number"!=typeof t)throw new Error("ASN1 syntax error: invalid Integer number");return t}static parseIntegerStr(e){const t=c.parseInteger(e);return"number"==typeof t?t.toString(16):t}static BitString(e){e instanceof Buffer&&(e=new a(e,8*e.length));const t=8*e.buf.length-e.bitLen,r=Buffer.alloc(e.buf.length+1);return r.writeInt8(t,0),e.buf.copy(r,1),new c(i.UNIVERSAL,o.BITSTRING,r)}static parseBitString(e){if(!(e instanceof Buffer)||0===e.length)throw new Error("ASN1 syntax error: invalid BitString");const t=e[0];if(t>7||1===e.length&&t>0||e[e.length-1]&(1<<e[0])-1)throw new Error("ASN1 syntax error: invalid padding bits in BIT STRING");return new a(e.slice(1),8*(e.length-1)-t)}static Null(){const e=new c(i.UNIVERSAL,o.NULL,Buffer.alloc(0));return e._value=null,e}static parseNull(e){if(!(e instanceof Buffer)||0!==e.length)throw new Error("ASN1 syntax error: invalid null");return null}static OID(e){const t=e.split(".");if(0===t.length)throw new Error("ASN1 syntax error: invalid Object Identifier");const r=[];r.push(40*d(t[0])+d(t[1]));const s=[];for(let e=2;e<t.length;++e){let n=d(t[e]);for(s.length=0,s.push(127&n);n>127;)n>>>=7,s.unshift(127&n|128);r.push(...s)}const n=new c(i.UNIVERSAL,o.OID,Buffer.from(r));return n._value=e,n}static parseOID(e){if(!(e instanceof Buffer)||0===e.length)throw new Error("ASN1 syntax error: invalid OID");let t=Math.floor(e[0]/40)+"."+e[0]%40,r=0;for(let s=1;s<e.length;s++)e[s]>=128?(r+=127&e[s],r<<=7):(t+="."+(r+e[s]),r=0);return t}static UTF8(e){const t=new c(i.UNIVERSAL,o.UTF8,Buffer.from(e,"utf8"));return t._value=e,t}static parseUTF8(e){if(!(e instanceof Buffer))throw new Error("parse ASN1 error: invalid Buffer");return e.toString("utf8")}static NumericString(e){if(!u(e))throw new Error("ASN1 syntax error: invalid NumericString");const t=new c(i.UNIVERSAL,o.NUMERICSTRING,Buffer.from(e,"utf8"));return t._value=e,t}static parseNumericString(e){if(!(e instanceof Buffer))throw new Error("parse ASN1 error: invalid Buffer");const t=e.toString("utf8");if(!u(t))throw new Error("ASN1 syntax error: invalid NumericString");return t}static PrintableString(e){const t=new c(i.UNIVERSAL,o.PRINTABLESTRING,Buffer.from(e,"utf8"));return t._value=e,t}static parsePrintableString(e){if(!(e instanceof Buffer))throw new Error("parse ASN1 error: invalid Buffer");return e.toString("utf8")}static IA5String(e){if(!l(e))throw new Error("ASN1 syntax error: invalid IA5String");const t=new c(i.UNIVERSAL,o.IA5STRING,Buffer.from(e,"utf8"));return t._value=e,t}static parseIA5String(e){if(!(e instanceof Buffer))throw new Error("parse ASN1 error: invalid Buffer");const t=e.toString("utf8");if(!l(t))throw new Error("ASN1 syntax error: invalid IA5String");return t}static T61String(e){const t=new c(i.UNIVERSAL,o.T61STRING,Buffer.from(e,"utf8"));return t._value=e,t}static parseT61String(e){if(!(e instanceof Buffer))throw new Error("parse ASN1 error: invalid Buffer");return e.toString("utf8")}static GeneralString(e){const t=new c(i.UNIVERSAL,o.GENERALSTRING,Buffer.from(e,"utf8"));return t._value=e,t}static parseGeneralString(e){if(!(e instanceof Buffer))throw new Error("parse ASN1 error: invalid Buffer");return e.toString("utf8")}static UTCTime(e){let t="";const r=[];r.push((""+e.getUTCFullYear()).substr(2)),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(const e of r)e.length<2&&(t+="0"),t+=e;t+="Z";const s=new c(i.UNIVERSAL,o.UTCTIME,Buffer.from(t,"utf8"));return s._value=e,s}static parseUTCTime(e){if(!(e instanceof Buffer)||0===e.length)throw new Error("ASN1 syntax error: invalid UTC Time");const t=e.toString("utf8"),r=new Date;let s=d(t.substr(0,2));s=s>=50?1900+s:2e3+s;const n=d(t.substr(2,2))-1,i=d(t.substr(4,2)),o=d(t.substr(6,2)),a=d(t.substr(8,2));let c=0,u=0,l="";if(t.length>11&&(u=10,l=t.charAt(u),"+"!==l&&"-"!==l&&(c=d(t.substr(10,2)),u+=2)),r.setUTCFullYear(s,n,i),r.setUTCHours(o,a,c,0),u>0&&(l=t.charAt(u),"+"===l||"-"===l)){let e=60*d(t.substr(u+1,2))+d(t.substr(u+4,2));e*=6e4,"+"===l?r.setTime(+r-e):r.setTime(+r+e)}return r}static GeneralizedTime(e){let t="";const r=[];r.push(""+e.getUTCFullYear()),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(const e of r)e.length<2&&(t+="0"),t+=e;t+="Z";const s=new c(i.UNIVERSAL,o.GENERALIZEDTIME,Buffer.from(t,"utf8"));return s._value=e,s}static parseGeneralizedTime(e){if(!(e instanceof Buffer)||0===e.length)throw new Error("ASN1 syntax error: invalid Generalized Time");const t=e.toString("utf8"),r=new Date,s=d(t.substr(0,4)),n=d(t.substr(4,2))-1,i=d(t.substr(6,2)),o=d(t.substr(8,2)),a=d(t.substr(10,2)),c=d(t.substr(12,2));let u=0,l=0,h=!1;"Z"===t.charAt(t.length-1)&&(h=!0);const p=t.length-5,f=t.charAt(p);if("+"===f||"-"===f){l=60*d(t.substr(p+1,2))+d(t.substr(p+4,2)),l*=6e4,"+"===f&&(l*=-1),h=!0}return"."===t.charAt(14)&&(u=1e3*parseFloat(t.substr(14))),h?(r.setUTCFullYear(s,n,i),r.setUTCHours(o,a,c,u),r.setTime(+r+l)):(r.setFullYear(s,n,i),r.setHours(o,a,c,u)),r}static parseTime(e,t){switch(e){case o.UTCTIME:return c.parseUTCTime(t);case o.GENERALIZEDTIME:return c.parseGeneralizedTime(t);default:throw new Error("Invalid ASN1 time tag")}}static Set(e){const t=new c(i.UNIVERSAL,o.SET,Buffer.concat(e.map((e=>e.toDER()))));return t._value=e,t}static Seq(e){const t=new c(i.UNIVERSAL,o.SEQUENCE,Buffer.concat(e.map((e=>e.toDER()))));return t._value=e,t}static Spec(e,t,r=!0){const s=Array.isArray(t)?Buffer.concat(t.map((e=>e.toDER()))):t.toDER();Array.isArray(t)&&(r=!0);const n=new c(i.CONTEXT_SPECIFIC,e,s,r);return n._value=t,n}static fromDER(e,t=!1){return c._fromDER(new n.BufferVisitor(e),t)}static parseDER(e,t,r){const s=c._fromDER(new n.BufferVisitor(e),!1);if(s.class!==t&&s.tag!==r)throw new Error(`invalid ASN.1 DER for class ${t} and tag ${r}`);return s}static parseDERWithTemplate(e,t){const r=c._fromDER(new n.BufferVisitor(e),!0),s={},i=r.validate(t,s);if(null!=i)throw i.data=r,i;return s}static _parseCompound(e,t){const r=[],s=e.length,i=new n.BufferVisitor(e);let o=0;for(;o<s;){const e=i.end;r.push(c._fromDER(i,t)),o+=i.end-e}return r}static _fromDER(e,t){if(!(e.buf instanceof Buffer)||0===e.length)throw new Error("ASN1 syntax error: invalid Generalized Time");e.mustWalk(1,"Too few bytes to read ASN.1 tag.");const r=e.start,s=e.buf[r],n=192&s,i=31&s,a=function(e){e.mustWalk(1,"Too few bytes to read ASN.1 value length.");const t=e.buf[e.start];if(!(128&t))return t;const r=127&t;return e.mustWalk(r,"Too few bytes to read ASN.1 value length."),e.buf.readUIntBE(e.start,r)}(e);if(e.mustHas(a),0!==a&&i===o.NULL)throw new Error("invalid value length or NULL tag.");e.mustWalk(a);const u=!(32&~s),l=new c(n,i,e.buf.slice(e.start,e.end),u);return u&&t&&(l._value=c._parseCompound(l.bytes,t)),l._der=e.buf.slice(r,e.end),l}constructor(e,t,r,s=!1){this.class=e,this.tag=t,this.bytes=r,this.isCompound=s||t===o.SEQUENCE||t===o.SET,this._value=void 0,this._der=null}get value(){return void 0===this._value&&(this._value=this.valueOf()),this._value}get DER(){return null==this._der&&(this._der=this.toDER()),this._der}mustCompound(e="asn1 object value is not compound"){if(!this.isCompound||!Array.isArray(this.value)){const t=new Error(e);throw t.data=this.toJSON(),t}return this.value}equals(e){return e instanceof c&&(this.class===e.class&&this.tag===e.tag&&this.isCompound===e.isCompound&&!!this.bytes.equals(e.bytes))}toDER(){let e=this.class|this.tag;this.isCompound&&(e|=32);const t=function(e){if(e<=127)return 0;if(e<=255)return 1;if(e<=65535)return 2;if(e<=16777215)return 3;if(e<=4294967295)return 4;if(e<=0xffffffffff)return 5;if(e<=0xffffffffffff)return 6;throw new Error("invalid value length")}(this.bytes.length),r=Buffer.allocUnsafe(2+t+this.bytes.length);return r.writeInt8(e,0),0===t?(r.writeUInt8(this.bytes.length,1),this.bytes.copy(r,2)):(r.writeUInt8(128|t,1),r.writeUIntBE(this.bytes.length,2,t),this.bytes.copy(r,2+t)),r}valueOf(){if(this.isCompound)return c._parseCompound(this.bytes,!1);if(this.class!==i.UNIVERSAL)return this.bytes;switch(this.tag){case o.BOOLEAN:return c.parseBool(this.bytes);case o.INTEGER:return c.parseInteger(this.bytes);case o.BITSTRING:return c.parseBitString(this.bytes);case o.NULL:return c.parseNull(this.bytes);case o.OID:return c.parseOID(this.bytes);case o.UTF8:return c.parseUTF8(this.bytes);case o.NUMERICSTRING:return c.parseNumericString(this.bytes);case o.PRINTABLESTRING:return c.parsePrintableString(this.bytes);case o.T61STRING:return c.parseT61String(this.bytes);case o.IA5STRING:return c.parseIA5String(this.bytes);case o.GENERALSTRING:return c.parseGeneralString(this.bytes);case o.UTCTIME:return c.parseUTCTime(this.bytes);case o.GENERALIZEDTIME:return c.parseGeneralizedTime(this.bytes);default:return this.bytes}}validate(e,t={}){if(this.class!==e.class)return new Error(`ASN.1 object validate failure for ${e.name} : error class ${i[this.class]}`);if(!(Array.isArray(e.tag)?e.tag:[e.tag]).includes(this.tag))return new Error(`ASN.1 object validate failure for ${e.name}: error tag ${o[this.tag]}`);if(null!=e.capture&&(t[e.capture]=this),Array.isArray(e.value)){const r=this.mustCompound(`${e.name} need compound ASN1 value`);for(let s=0,n=0;s<e.value.length;s++)if(null!=r[n]){const i=r[n].validate(e.value[s],t);if(null==i)n++;else if(!0!==e.value[s].optional)return i}else if(!0!==e.value[s].optional)return new Error(`ASN.1 object validate failure for ${e.value[s].name}: not exists`)}else if(null!=e.value){const r=this.tag===o.BITSTRING?this.bytes.slice(1):this.bytes;return c.fromDER(r).validate(e.value,t)}return null}toJSON(){let e=this.value;return Array.isArray(e)&&(e=e.map((e=>e.toJSON()))),{class:i[this.class],tag:this.class===i.UNIVERSAL?o[this.tag]:this.tag,value:e}}[s.inspect.custom](e,t){return t.depth<=2&&(t.depth=10),`<${this.constructor.name} ${s.inspect(this.toJSON(),t)}>`}}function u(e){for(const t of e){const e=t.charCodeAt(0);if(32!==e&&(e<48||e>57))return!1}return!0}function l(e){for(const t of e)if(t.charCodeAt(0)>=128)return!1;return!0}function d(e,t=10){const r=parseInt(e,t);if(Number.isNaN(r))throw new Error(`Invalid numeric string "${e}" in radix ${t}.`);return r}t.ASN1=c},9270:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.LEB128=t.SignedLEB128=t.UnsignedLEB128=void 0,function(e){e[e.LOWER_7=127]="LOWER_7",e[e.UPPER_1=128]="UPPER_1"}(r||(r={}));const s=e=>Number.isSafeInteger(e);class n{static decode(e,t=0){const s=this.$scanForNullBytes(e,t);let n=0,i=0;for(let o=0;o<=s-t;o++){n|=(e[t+o]&r.LOWER_7)<<i,i+=7}return n}static encode(e){if(this.check(e),e<0)throw new Error(`An unsigned number must NOT be negative, ${e} is!`);let t=[],s=e;do{let e=s&r.LOWER_7;s>>=7,s&&(e|=r.UPPER_1),t.push(e)}while(s);return Uint8Array.from(t)}static check(e){if(!s(e))throw new Error(`${e} is not a safe integer!`)}static $scanForNullBytes(e,t=0){let s=t,n=0;do{if(s>=e.byteLength)throw new Error("This is not a LEB128-encoded Uint8Array, no ending found!");n=e.slice(s,s+1)[0],s++}while(n&r.UPPER_1);return s-1}static getLength(e,t=0){return this.$scanForNullBytes(e,t)-t}}t.UnsignedLEB128=n;class i{static $ceil7mul(e){let t=e;for(;t%7;)t++;return t}static check(e){if(!s(e))throw new Error(`${e} is not a safe integer!`)}static encode(e){if(this.check(e),e>=0)throw new Error(`A signed number must be negative, ${e} isn't!`);const t=Math.ceil(Math.log2(-e));return n.encode((1<<this.$ceil7mul(t))+e)}static decode(e,t=0){const r=n.decode(e,t);return-((1<<Math.ceil(Math.log2(r)))-r)}}t.SignedLEB128=i;class o{}t.LEB128=o,o.encode=e=>(e>=0?n:i).encode(e),o.decode=(e,t=0,r=!1)=>(r?i:n).decode(e,t)},9278:e=>{"use strict";e.exports=require("net")},9284:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyExchange=void 0,t.createRSAKeyExchange=function(){const e=new i;return e.id=n.RSA,e.name="RSA",e.keyType=s.RSA,e},t.createECDHERSAKeyExchange=function(){const e=new i;return e.id=n.ECDHE_RSA,e.name="ECDHE_RSA",e.signType=r.ECDHE,e.keyType=s.RSA,e},t.createECDHEECDSAKeyExchange=function(){const e=new i;return e.id=n.ECDHE_ECDSA,e.name="ECDHE_ECDSA",e.signType=r.ECDHE,e.keyType=s.ECDSA,e},t.createNULLKeyExchange=function(){const e=new i;return e.id=n.NULL,e.name="NULL",e.signType=r.NULL,e.keyType=s.NULL,e},t.createPSKKeyExchange=function(){const e=new i;return e.id=n.PSK,e.name="PSK",e.signType=r.NULL,e.keyType=s.PSK,e},t.createECDHEPSKKeyExchange=function(){const e=new i;return e.id=n.ECDHE_PSK,e.name="ECDHE_PSK",e.signType=r.ECDHE,e.keyType=s.PSK,e};const r={NULL:0,ECDHE:1},s={NULL:0,RSA:1,ECDSA:2,PSK:3},n={NULL:0,RSA:1,ECDHE_RSA:2,ECDHE_ECDSA:3,PSK:4,ECDHE_PSK:5};class i{constructor(){this.id=0}toString(){return this.name}}t.KeyExchange=i},9379:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionType=void 0,t.SessionType={CLIENT:1,SERVER:2};t.default=class{constructor(){this.id=0,this.verifyDataLength=12}init(...e){throw new Error("not implemented")}encrypt(...e){throw new Error("not implemented")}decrypt(...e){throw new Error("not implemented")}toString(){return this.name}}},9385:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9278);t.bytesFromIP=function(e){switch(s.isIP(e)){case 4:return Buffer.from(e.split(".").map((e=>parseInt(e,10))));case 6:const t=e.split(":"),r=Buffer.alloc(16);let s=0;""===t[t.length-1]&&(t[t.length-1]="0");for(let e=0;e<t.length;e++)""!==t[e]?(r.writeUInt16BE(parseInt(t[e],16),s),s+=2):e+1<t.length&&""!==t[e+1]&&(s=16-2*(t.length-e-1));return r;default:return null}},t.bytesToIP=function(e){switch(e.length){case 4:return[e[0],e[1],e[2],e[3]].join(".");case 16:const t=[];let r=-1,s=0,n=-1,i=0;for(let o=0;o<e.length;o+=2){const a=e[o]<<8|e[o+1];0===a?(s++,-1===r&&(r=t.length),s>i&&(i=s,n=r)):(r=-1,s=0),t.push(a.toString(16))}if(i>0){let e="";const r=t.slice(n+i);t.length=n,0===t.length&&(e+=":"),0===r.length&&(e+=":"),t.push(e,...r)}return t.join(":");default:return""}};const n=Object.create(null),i=/^[0-9.]+$/;function o(e,t){n[e]=t,n[t]=e}t.getOID=function(e){return i.test(e)&&""!==n[e]?e:null==n[e]?"":n[e]},t.getOIDName=function(e){return i.test(e)||""===n[e]?null==n[e]?e:n[e]:e},o("1.2.840.113549.1.1.1","rsaEncryption"),o("1.2.840.113549.1.1.4","md5WithRsaEncryption"),o("1.2.840.113549.1.1.5","sha1WithRsaEncryption"),o("1.2.840.113549.1.1.8","mgf1"),o("1.2.840.113549.1.1.10","RSASSA-PSS"),o("1.2.840.113549.1.1.11","sha256WithRsaEncryption"),o("1.2.840.113549.1.1.12","sha384WithRsaEncryption"),o("1.2.840.113549.1.1.13","sha512WithRsaEncryption"),o("1.2.840.10045.2.1","ecEncryption"),o("1.2.840.10045.4.1","ecdsaWithSha1"),o("1.2.840.10045.4.3.2","ecdsaWithSha256"),o("1.2.840.10045.4.3.3","ecdsaWithSha384"),o("1.2.840.10045.4.3.4","ecdsaWithSha512"),o("1.2.840.10040.4.3","dsaWithSha1"),o("2.16.840.1.101.3.4.3.2","dsaWithSha256"),o("1.3.14.3.2.7","desCBC"),o("1.3.14.3.2.26","sha1"),o("2.16.840.1.101.3.4.2.1","sha256"),o("2.16.840.1.101.3.4.2.2","sha384"),o("2.16.840.1.101.3.4.2.3","sha512"),o("1.2.840.113549.2.5","md5"),o("1.3.101.110","X25519"),o("1.3.101.111","X448"),o("1.3.101.112","Ed25519"),o("1.3.101.113","Ed448"),o("1.2.840.113549.1.7.1","data"),o("1.2.840.113549.1.7.2","signedData"),o("1.2.840.113549.1.7.3","envelopedData"),o("1.2.840.113549.1.7.4","signedAndEnvelopedData"),o("1.2.840.113549.1.7.5","digestedData"),o("1.2.840.113549.1.7.6","encryptedData"),o("1.2.840.113549.1.9.1","emailAddress"),o("1.2.840.113549.1.9.2","unstructuredName"),o("1.2.840.113549.1.9.3","contentType"),o("1.2.840.113549.1.9.4","messageDigest"),o("1.2.840.113549.1.9.5","signingTime"),o("1.2.840.113549.1.9.6","counterSignature"),o("1.2.840.113549.1.9.7","challengePassword"),o("1.2.840.113549.1.9.8","unstructuredAddress"),o("1.2.840.113549.1.9.14","extensionRequest"),o("1.2.840.113549.1.9.20","friendlyName"),o("1.2.840.113549.1.9.21","localKeyId"),o("1.2.840.113549.1.9.22.1","x509Certificate"),o("1.2.840.113549.1.12.10.1.1","keyBag"),o("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag"),o("1.2.840.113549.1.12.10.1.3","certBag"),o("1.2.840.113549.1.12.10.1.4","crlBag"),o("1.2.840.113549.1.12.10.1.5","secretBag"),o("1.2.840.113549.1.12.10.1.6","safeContentsBag"),o("1.2.840.113549.1.5.13","pkcs5PBES2"),o("1.2.840.113549.1.5.12","pkcs5PBKDF2"),o("1.2.840.113549.2.7","hmacWithSha1"),o("1.2.840.113549.2.9","hmacWithSha256"),o("1.2.840.113549.2.10","hmacWithSha384"),o("1.2.840.113549.2.11","hmacWithSha512"),o("1.2.840.113549.3.7","3desCBC"),o("2.16.840.1.101.3.4.1.2","aesCBC128"),o("2.16.840.1.101.3.4.1.42","aesCBC256"),o("2.5.4.3","commonName"),o("2.5.4.5","serialName"),o("2.5.4.6","countryName"),o("2.5.4.7","localityName"),o("2.5.4.8","stateOrProvinceName"),o("2.5.4.10","organizationName"),o("2.5.4.11","organizationalUnitName"),o("2.5.4.15","businessCategory"),o("2.16.840.1.113730.1.1","nsCertType"),o("2.5.29.2","keyAttributes"),o("2.5.29.4","keyUsageRestriction"),o("2.5.29.6","subtreesConstraint"),o("2.5.29.9","subjectDirectoryAttributes"),o("2.5.29.14","subjectKeyIdentifier"),o("2.5.29.15","keyUsage"),o("2.5.29.16","privateKeyUsagePeriod"),o("2.5.29.17","subjectAltName"),o("2.5.29.18","issuerAltName"),o("2.5.29.19","basicConstraints"),o("2.5.29.20","cRLNumber"),o("2.5.29.21","cRLReason"),o("2.5.29.22","expirationDate"),o("2.5.29.23","instructionCode"),o("2.5.29.24","invalidityDate"),o("2.5.29.27","deltaCRLIndicator"),o("2.5.29.28","issuingDistributionPoint"),o("2.5.29.29","certificateIssuer"),o("2.5.29.30","nameConstraints"),o("2.5.29.31","cRLDistributionPoints"),o("2.5.29.32","certificatePolicies"),o("2.5.29.33","policyMappings"),o("2.5.29.35","authorityKeyIdentifier"),o("2.5.29.36","policyConstraints"),o("2.5.29.37","extKeyUsage"),o("2.5.29.46","freshestCRL"),o("2.5.29.54","inhibitAnyPolicy"),o("1.3.6.1.4.1.311.60.2.1.2","jurisdictionST"),o("1.3.6.1.4.1.311.60.2.1.3","jurisdictionC"),o("1.3.6.1.4.1.11129.2.4.2","timestampList"),o("1.3.6.1.5.5.7.1.1","authorityInfoAccess"),o("1.3.6.1.5.5.7.3.1","serverAuth"),o("1.3.6.1.5.5.7.3.2","clientAuth"),o("1.3.6.1.5.5.7.3.3","codeSigning"),o("1.3.6.1.5.5.7.3.4","emailProtection"),o("1.3.6.1.5.5.7.3.8","timeStamping"),o("1.3.6.1.5.5.7.48.1","authorityInfoAccessOcsp"),o("1.3.6.1.5.5.7.48.2","authorityInfoAccessIssuers")},9409:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpusRepacketizer=void 0;t.OpusRepacketizer=class{constructor(e){this.framesPerPacket=e,this.depacketized=[],this.extraPackets=0}repacketize(e){const t=3&e.payload[0];let r;const s=()=>{let t=e.payload.readUInt8(r++);return t>=252&&(r++,t+=4*e.payload.readUInt8(r)),t};if(0===t){if(1===this.framesPerPacket&&!this.depacketized.length)return[e];this.depacketized.push(e.payload.subarray(1))}else if(1===t){if(2===this.framesPerPacket&&!this.depacketized.length)return[e];const t=e.payload.length-1;if(t%2)throw new Error("expected equal sized opus packets (code 1)");const r=t/2;this.depacketized.push(e.payload.subarray(1,1+r)),this.depacketized.push(e.payload.subarray(1+r))}else if(2===t){if(2===this.framesPerPacket&&!this.depacketized.length)return[e];r=1;const t=s();this.depacketized.push(e.payload.subarray(r,r+t)),this.depacketized.push(e.payload.subarray(r+t))}else if(3===t){const t=e.payload[1],n=63&t,i=128&t;if(this.framesPerPacket===n&&!this.depacketized.length)return[e];r=2;let o=0;if(64&t&&(o=e.payload.readUInt8(r),r++,255===o&&(o=254+e.payload.readUInt8(r),r++)),i){const t=[];for(let e=0;e<n-1;e++){const e=s();t.push(e)}for(let s=0;s<t.length;s++){const n=t[s],i=r;r+=n,this.depacketized.push(e.payload.subarray(i,r))}const i=e.payload.length-o-r;this.depacketized.push(e.payload.subarray(r,r+i))}else{const t=e.payload.length-r-o;if(t%n)throw new Error("expected equal sized opus packets (code 3)");const s=t/n;for(let t=0;t<n;t++){const n=r+t*s,i=n+s;this.depacketized.push(e.payload.subarray(n,i))}}}if(this.depacketized.length<this.framesPerPacket)return[];const n=[];for(;;){if(this.depacketized.length<this.framesPerPacket)return n;const t=this.depacketized.slice(0,this.framesPerPacket);this.depacketized=this.depacketized.slice(this.framesPerPacket);let r=e.payload[0];r|=3;const s=[r,128|this.framesPerPacket];s.push(...t.slice(0,-1).map((e=>e.length)));const i=Buffer.from(s),o=Buffer.concat([i,...t]),a=e.clone();n.length&&this.extraPackets++,a.header.sequenceNumber=(e.header.sequenceNumber+this.extraPackets+65536)%65536,a.payload=o,n.push(a)}}}},9411:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.randomPort=void 0;var i=r(9543);Object.defineProperty(t,"randomPort",{enumerable:!0,get:function(){return i.randomPort}}),n(r(4687),t),n(r(9851),t),n(r(7830),t),n(r(599),t),n(r(2126),t),n(r(372),t),n(r(9428),t),n(r(730),t),n(r(9761),t)},9420:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTCDataChannelParameters=t.RTCDataChannel=void 0;const s=r(5433),n=r(8655),i=(0,s.debug)("werift:packages/webrtc/src/dataChannel.ts");class o extends n.EventTarget{constructor(e,t,r=!0){if(super(),this.sctp=e,this.parameters=t,this.sendOpen=r,this.stateChange=new s.Event,this.stateChanged=new s.Event,this.onMessage=new s.Event,this.error=new s.Event,this.bufferedAmountLow=new s.Event,this.isCreatedByRemote=!1,this.readyState="connecting",this.bufferedAmount=0,this._bufferedAmountLowThreshold=0,this.messagesSent=0,this.bytesSent=0,this.messagesReceived=0,this.bytesReceived=0,this.id=this.parameters.id,t.negotiated){if(null==this.id||this.id<0||this.id>65534)throw new Error("ID must be in range 0-65534 if data channel is negotiated out-of-band");this.sctp.dataChannelAddNegotiated(this)}else r&&(this.sendOpen=!1,this.sctp.dataChannelOpen(this))}get ordered(){return this.parameters.ordered}get maxRetransmits(){return this.parameters.maxRetransmits}get maxPacketLifeTime(){return this.parameters.maxPacketLifeTime}get label(){return this.parameters.label}get protocol(){return this.parameters.protocol}get negotiated(){return this.parameters.negotiated}get bufferedAmountLowThreshold(){return this._bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){if(e<0||e>4294967295)throw new Error("bufferedAmountLowThreshold must be in range 0 - 4294967295");this._bufferedAmountLowThreshold=e}setId(e){this.id=e}setReadyState(e){if(e!==this.readyState){switch(this.readyState=e,this.stateChange.execute(e),this.stateChanged.execute(e),e){case"open":this.onopen&&this.onopen(),this.emit("open");break;case"closed":this.onclose&&this.onclose(),this.emit("close");break;case"closing":this.onclosing&&this.onclosing()}i("change state",e)}}addBufferedAmount(e){const t=this.bufferedAmount>this.bufferedAmountLowThreshold&&this.bufferedAmount+e<=this.bufferedAmountLowThreshold;this.bufferedAmount+=e,t&&(this.bufferedAmountLow.execute(),this.emit("bufferedamountlow"))}send(e){const t=Buffer.isBuffer(e)?e.length:Buffer.byteLength(e);this.messagesSent++,this.bytesSent+=t,this.sctp.datachannelSend(this,e)}close(){this.sctp.dataChannelClose(this)}}t.RTCDataChannel=o;t.RTCDataChannelParameters=class{constructor(e={}){this.label="",this.ordered=!0,this.protocol="",this.negotiated=!1,Object.assign(this,e)}}},9428:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9447:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CipherAesCtr=void 0;const s=r(6982),n=r(2148),i=r(4221),o=r(1193);class a extends n.CipherAesBase{constructor(e,t,r,s,n,i){super(e,t,r,s),this.srtpSessionAuthTag=n,this.srtcpSessionAuthTag=i,this.authTagLength=10}encryptRtp(e,t,r){const n=e.serialize(e.serializeSize),i=this.generateCounter(e.sequenceNumber,r,e.ssrc,this.srtpSessionSalt),o=(0,s.createCipheriv)("aes-128-ctr",this.srtpSessionKey,i).update(t),a=this.generateSrtpAuthTag(r,n,o);return Buffer.concat([n,o,a])}decryptRtp(e,t){const r=o.RtpHeader.deSerialize(e),n=e.length-this.authTagLength;e=e.subarray(0,e.length-this.authTagLength);const i=this.generateCounter(r.sequenceNumber,t,r.ssrc,this.srtpSessionSalt),a=(0,s.createDecipheriv)("aes-128-ctr",this.srtpSessionKey,i),c=e.subarray(r.payloadOffset),u=a.update(c);return[Buffer.concat([e.subarray(0,r.payloadOffset),u,Buffer.alloc(n-r.payloadOffset-u.length)]),r]}encryptRTCP(e,t){let r=Buffer.from(e);const n=r.readUInt32BE(4),i=this.generateCounter(65535&t,t>>16,n,this.srtcpSessionSalt);(0,s.createCipheriv)("aes-128-ctr",this.srtcpSessionKey,i).update(r.slice(8)).copy(r,8),r=Buffer.concat([r,Buffer.alloc(4)]),r.writeUInt32BE(t,r.length-4),r[r.length-4]|=128;const o=this.generateSrtcpAuthTag(r);return r=Buffer.concat([r,o]),r}decryptRTCP(e){const t=i.RtcpHeader.deSerialize(e),r=e.length-(this.authTagLength+c),n=Buffer.from(e).slice(0,r);if(0===e[r]>>7)return[n,t];let o=e.readUInt32BE(r);o&=~(1<<31);const a=e.readUInt32BE(4),u=(e.subarray(e.length-10),this.generateCounter(65535&o,o>>16,a,this.srtcpSessionSalt));return(0,s.createDecipheriv)("aes-128-ctr",this.srtcpSessionKey,u).update(n.subarray(8)).copy(n,8),[n,t]}generateSrtcpAuthTag(e){return(0,s.createHmac)("sha1",this.srtcpSessionAuthTag).update(e).digest().slice(0,10)}generateCounter(e,t,r,s){const n=Buffer.alloc(16);n.writeUInt32BE(r,4),n.writeUInt32BE(t,8),n.writeUInt32BE(Number(BigInt(e)<<16n),12);for(let e=0;e<s.length;e++)n[e]^=s[e];return n}generateSrtpAuthTag(e,...t){const r=(0,s.createHmac)("sha1",this.srtpSessionAuthTag),n=Buffer.alloc(4);n.writeUInt32BE(e);for(const e of t)r.update(e);return r.update(n).digest().subarray(0,10)}}t.CipherAesCtr=a;const c=4},9475:(e,t)=>{"use strict";var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.SCTP_STATE=t.WEBRTC_PPID=void 0,function(e){e[e.DCEP=50]="DCEP",e[e.STRING=51]="STRING",e[e.BINARY=53]="BINARY",e[e.STRING_EMPTY=56]="STRING_EMPTY",e[e.BINARY_EMPTY=57]="BINARY_EMPTY"}(r||(t.WEBRTC_PPID=r={})),function(e){e[e.CLOSED=1]="CLOSED",e[e.COOKIE_WAIT=2]="COOKIE_WAIT",e[e.COOKIE_ECHOED=3]="COOKIE_ECHOED",e[e.ESTABLISHED=4]="ESTABLISHED",e[e.SHUTDOWN_PENDING=5]="SHUTDOWN_PENDING",e[e.SHUTDOWN_SENT=6]="SHUTDOWN_SENT",e[e.SHUTDOWN_RECEIVED=7]="SHUTDOWN_RECEIVED",e[e.SHUTDOWN_ACK_SENT=8]="SHUTDOWN_ACK_SENT"}(s||(t.SCTP_STATE=s={}))},9511:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(5865);t.BufferVisitor=s.BufferVisitor;var n=r(4933);t.PEM=n.PEM;var i=r(9262);t.ASN1=i.ASN1,t.Class=i.Class,t.Tag=i.Tag,t.BitString=i.BitString},9543:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(66),t),n(r(8782),t),n(r(3890),t),n(r(7449),t),n(r(4131),t),n(r(673),t),n(r(5903),t),n(r(8246),t)},9587:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtpRouter=void 0;const s=r(6252),n=r(9260),i=r(3535),o=(0,s.debug)("werift:packages/webrtc/src/media/router.ts");t.RtpRouter=class{constructor(){this.ssrcTable={},this.ridTable={},this.extIdUriMap={},this.routeRtp=e=>{const t=(0,s.rtpHeaderExtensionsParser)(e.header.extensions,this.extIdUriMap);let r=this.ssrcTable[e.header.ssrc];const i=t[s.RTP_EXTENSION_URI.sdesRTPStreamID];if("string"==typeof i?(r=this.ridTable[i],r.latestRid=i,r.handleRtpByRid(e,i,t)):r?r.handleRtpBySsrc(e,t):(r=Object.values(this.ridTable).filter((e=>e instanceof n.RTCRtpReceiver)).find((t=>t.trackBySSRC[e.header.ssrc])),r&&(o("simulcast register receiver by ssrc",e.header.ssrc),this.registerRtpReceiver(r,e.header.ssrc),r.handleRtpBySsrc(e,t))),!r)return void o("ssrcReceiver not found");const a=t[s.RTP_EXTENSION_URI.sdesMid];"string"==typeof a&&(r.sdesMid=a);const c=t[s.RTP_EXTENSION_URI.repairedRtpStreamId];"string"==typeof c&&(r.latestRepairedRid=c)},this.routeRtcp=e=>{const t=[];switch(e.type){case s.RtcpSrPacket.type:t.push(this.ssrcTable[e.ssrc]);break;case s.RtcpRrPacket.type:e.reports.forEach((e=>{t.push(this.ssrcTable[e.ssrc])}));break;case s.RtcpSourceDescriptionPacket.type:break;case s.RtcpTransportLayerFeedback.type:{const r=e;r.feedback&&t.push(this.ssrcTable[r.feedback.mediaSourceSsrc])}break;case s.RtcpPayloadSpecificFeedback.type:{const r=e;if(r.feedback.count===s.ReceiverEstimatedMaxBitrate.count){const e=r.feedback;t.push(this.ssrcTable[e.ssrcFeedbacks[0]])}else t.push(this.ssrcTable[r.feedback.senderSsrc]||this.ssrcTable[r.feedback.mediaSsrc])}}t.filter((e=>e)).forEach((t=>t.handleRtcpPacket(e)))}}registerRtpSender(e){this.ssrcTable[e.ssrc]=e}registerRtpReceiver(e,t){o("registerRtpReceiver",t),this.ssrcTable[t]=e}registerRtpReceiverBySsrc(e,t){o("registerRtpReceiverBySsrc",t),t.encodings.filter((e=>null!=e.ssrc)).forEach(((r,s)=>{this.registerRtpReceiver(e.receiver,r.ssrc),e.addTrack(new i.MediaStreamTrack({ssrc:r.ssrc,kind:e.kind,id:e.sender.trackId,remote:!0,codec:t.codecs[s]})),r.rtx&&this.registerRtpReceiver(e.receiver,r.rtx.ssrc)})),t.headerExtensions.forEach((e=>{this.extIdUriMap[e.id]=e.uri}))}registerRtpReceiverByRid(e,t,r){const[s]=r.codecs;o("registerRtpReceiverByRid",t),e.addTrack(new i.MediaStreamTrack({rid:t.rid,kind:e.kind,id:e.sender.trackId,remote:!0,codec:s})),this.ridTable[t.rid]=e.receiver}}},9602:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.HandshakeType=void 0,function(e){e[e.hello_request_0=0]="hello_request_0",e[e.client_hello_1=1]="client_hello_1",e[e.server_hello_2=2]="server_hello_2",e[e.hello_verify_request_3=3]="hello_verify_request_3",e[e.certificate_11=11]="certificate_11",e[e.server_key_exchange_12=12]="server_key_exchange_12",e[e.certificate_request_13=13]="certificate_request_13",e[e.server_hello_done_14=14]="server_hello_done_14",e[e.certificate_verify_15=15]="certificate_verify_15",e[e.client_key_exchange_16=16]="client_key_exchange_16",e[e.finished_20=20]="finished_20"}(r||(t.HandshakeType=r={}))},9686:(e,t)=>{"use strict";t.toString=function(e){switch(e){case 0:return"NOERROR";case 1:return"FORMERR";case 2:return"SERVFAIL";case 3:return"NXDOMAIN";case 4:return"NOTIMP";case 5:return"REFUSED";case 6:return"YXDOMAIN";case 7:return"YXRRSET";case 8:return"NXRRSET";case 9:return"NOTAUTH";case 10:return"NOTZONE";case 11:return"RCODE_11";case 12:return"RCODE_12";case 13:return"RCODE_13";case 14:return"RCODE_14";case 15:return"RCODE_15"}return"RCODE_"+e},t.toRcode=function(e){switch(e.toUpperCase()){case"NOERROR":return 0;case"FORMERR":return 1;case"SERVFAIL":return 2;case"NXDOMAIN":return 3;case"NOTIMP":return 4;case"REFUSED":return 5;case"YXDOMAIN":return 6;case"YXRRSET":return 7;case"NXRRSET":return 8;case"NOTAUTH":return 9;case"NOTZONE":return 10;case"RCODE_11":return 11;case"RCODE_12":return 12;case"RCODE_13":return 13;case"RCODE_14":return 14;case"RCODE_15":return 15}return 0}},9688:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DtlsServer=void 0;const s=r(9379),n=r(1328),i=r(3222),o=r(476),a=r(9602),c=r(4953),u=r(5205),l=r(654),d=(0,u.debug)("werift-dtls : packages/dtls/src/server.ts : log");class h extends l.DtlsSocket{constructor(e){super(e,s.SessionType.SERVER),this.handleHandshakes=async e=>{d(this.dtls.sessionId,"handleHandshakes",e.map((e=>e.msg_type)));for(const t of e)switch(t.msg_type){case a.HandshakeType.client_hello_1:{this.connected&&this.renegotiation();const e=c.ClientHello.deSerialize(t.fragment);0===e.cookie.length?(d(this.dtls.sessionId,"send flight2"),(0,n.flight2)(this.transport,this.dtls,this.cipher,this.srtp)(e)):this.dtls.cookie&&e.cookie.equals(this.dtls.cookie)?(d(this.dtls.sessionId,"send flight4"),await new i.Flight4(this.transport,this.dtls,this.cipher,this.srtp).exec(t,this.options.certificateRequest)):d("wrong state",{dtlsCookie:this.dtls.cookie?.toString("hex").slice(10),helloCookie:e.cookie.toString("hex").slice(10)})}break;case a.HandshakeType.certificate_11:case a.HandshakeType.certificate_verify_15:case a.HandshakeType.client_key_exchange_16:if(this.connected)return;this.flight6=new o.Flight6(this.transport,this.dtls,this.cipher),this.flight6.handleHandshake(t);break;case a.HandshakeType.finished_20:await this.waitForReady((()=>!!this.flight6)),this.flight6?.handleHandshake(t),await this.waitForReady((()=>this.dtls.checkHandshakesExist([16]))),await(this.flight6?.exec()),this.connected=!0,this.onConnect.execute(),d(this.dtls.sessionId,"dtls connected")}},this.onHandleHandshakes=this.handleHandshakes,d(this.dtls.sessionId,"start server")}}t.DtlsServer=h},9696:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ScryptedSessionControl=void 0;const n=r(3290),i=r(3515),o=r(336),a=r(4890),c=s(r(2743)),{mediaManager:u}=c.default;t.ScryptedSessionControl=class{constructor(e,t){this.intercom=e,this.audioTransceiver=t,this.killed=new n.Deferred,this.killed.promise.finally((async()=>{this.rtspServer?.client.destroy();try{await(this.intercom?.stopIntercom())}catch(e){}}))}async setPlayback(e){await this.setPlaybackInternal(e)}async setPlaybackInternal(e){if(this.killed.finished)return;if(!this.intercom)return;this.audioTransceiver.receiver.track||await this.audioTransceiver.onTrack.asPromise();const t=this.audioTransceiver.receiver.track;if(t.onReceiveRtp.allUnsubscribe(),await this.intercom.stopIntercom(),!e.audio)return;this.rtspServer?.client.destroy();const r=await(0,i.listenZeroSingleClient)("127.0.0.1"),s=r.url.replace("tcp:","rtsp:"),n={container:"rtsp",url:s,mediaStreamOptions:{id:void 0,video:null},inputArguments:["-analyzeduration","0","-probesize","512","-rtsp_transport","tcp","-i",s]},c=await u.createFFmpegMediaObject(n);return r.clientPromise.then((async e=>{let r=["v=0","o=- 0 0 IN IP4 127.0.0.1","s=WebRTC Audio Talkback","c=IN IP4 127.0.0.1","t=0 0","b=AS:24","m=audio 0 RTP/AVP 110","a=rtpmap:110 opus/48000/2","a=fmtp:101 minptime=10;useinbandfec=1"].join("\r\n");r=(0,a.createSdpInput)(0,0,r);const s=new o.RtspServer(e,r);this.rtspServer=s,s.console=console,await s.handlePlayback();const n=(0,a.parseSdp)(s.sdp).msections.find((e=>"audio"===e.type)).control;t.onReceiveRtp.subscribe((e=>{e.header.payloadType=110,s.sendTrack(n,e.serialize(),!1)}))})),await this.intercom.startIntercom(c),await r.clientPromise,c}async getRefreshAt(){}async extendSession(){}async endSession(){this.killed.resolve(void 0)}}},9750:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DtlsRandom=void 0;const s=r(6982),n=r(6353);class i{constructor(e=Math.floor(Date.now()/1e3),t=(0,s.randomBytes)(28)){this.gmt_unix_time=e,this.random_bytes=t}static deSerialize(e){return new i(...Object.values((0,n.decode)(e,i.spec)))}static from(e){return new i(...Object.values(e))}serialize(){const e=(0,n.encode)(this,i.spec).slice();return Buffer.from(e)}}t.DtlsRandom=i,i.spec={gmt_unix_time:n.types.uint32be,random_bytes:n.types.buffer(28)}},9761:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=t.CandidatePairState=t.CONSENT_FAILURES=t.CONSENT_INTERVAL=t.ICE_FAILED=t.ICE_COMPLETED=t.CandidatePair=void 0,t.validateRemoteCandidate=function(e){if(!["host","relay","srflx"].includes(e.type))throw new Error(`Unexpected candidate type "${e.type}"`);return e},t.sortCandidatePairs=function(e,t){return e.sort(((e,r)=>l(e.localCandidate,e.remoteCandidate,t)-l(r.localCandidate,r.remoteCandidate,t))).reverse()},t.candidatePairPriority=l,t.serverReflexiveCandidate=async function(e,t){const r=new a.Message(o.methods.BINDING,o.classes.REQUEST);try{const[s]=await e.request(r,t),i=e.localCandidate;if(!i)throw new Error("not exist");return new n.Candidate((0,n.candidateFoundation)("srflx","udp",i.host),i.component,i.transport,(0,n.candidatePriority)("srflx"),s.getAttributeValue("XOR-MAPPED-ADDRESS")[0],s.getAttributeValue("XOR-MAPPED-ADDRESS")[1],"srflx",i.host,i.port)}catch(e){c("error serverReflexiveCandidate",e)}},t.validateAddress=function(e){if(e&&Number.isNaN(e[1]))return[e[0],443];return e};const s=r(6982),n=r(2126),i=r(2261),o=r(4687),a=r(9851),c=(0,i.debug)("werift-ice : packages/ice/src/ice.ts : log");var u;function l(e,t,r){const s=r&&e.priority||t.priority,n=r&&t.priority||e.priority;return 1*Math.min(s,n)+2*Math.max(s,n)+(s>n?1:0)}t.CandidatePair=class{get state(){return this._state}toJSON(){return this.json}get json(){return{protocol:this.protocol.type,localCandidate:this.localCandidate.toSdp(),remoteCandidate:this.remoteCandidate.toSdp()}}constructor(e,t,r){this.protocol=e,this.remoteCandidate=t,this.iceControlling=r,this.id=(0,s.randomUUID)().toString(),this.nominated=!1,this.remoteNominated=!1,this._state=u.FROZEN,this.packetsSent=0,this.packetsReceived=0,this.bytesSent=0,this.bytesReceived=0,this.totalRoundTripTime=0,this.roundTripTimeMeasurements=0}updateState(e){this._state=e}get localCandidate(){if(!this.protocol.localCandidate)throw new Error("localCandidate not exist");return this.protocol.localCandidate}get remoteAddr(){return[this.remoteCandidate.host,this.remoteCandidate.port]}get component(){return this.localCandidate.component}get priority(){return l(this.localCandidate,this.remoteCandidate,this.iceControlling)}get foundation(){return this.localCandidate.foundation}},t.ICE_COMPLETED=1,t.ICE_FAILED=2,t.CONSENT_INTERVAL=5,t.CONSENT_FAILURES=6,function(e){e[e.FROZEN=0]="FROZEN",e[e.WAITING=1]="WAITING",e[e.IN_PROGRESS=2]="IN_PROGRESS",e[e.SUCCEEDED=3]="SUCCEEDED",e[e.FAILED=4]="FAILED"}(u||(t.CandidatePairState=u={})),t.defaultOptions={useIpv4:!0,useIpv6:!0}},9821:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SrtpSession=void 0;const s=r(5193),n=r(6550);class i extends n.Session{constructor(e){super(s.SrtpContext),this.config=e,this.decrypt=e=>{const[t]=this.remoteContext.decryptRtp(e);return t},this.start(e.keys.localMasterKey,e.keys.localMasterSalt,e.keys.remoteMasterKey,e.keys.remoteMasterSalt,e.profile)}encrypt(e,t){return this.localContext.encryptRtp(e,t)}}t.SrtpSession=i},9827:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeBuffer=function(e,t){return Buffer.from((0,s.encode)(e,t).slice())};const s=r(6353)},9849:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScryptedMimeTypes=t.ScryptedInterface=t.MediaPlayerState=t.SecuritySystemObstruction=t.SecuritySystemMode=t.AirQuality=t.AirPurifierMode=t.AirPurifierStatus=t.ChargeState=t.LockState=t.PanTiltZoomMovement=t.ThermostatMode=t.TemperatureUnit=t.FanMode=t.HumidityMode=t.ScryptedDeviceType=t.ScryptedInterfaceDescriptors=t.ScryptedInterfaceMethod=t.ScryptedInterfaceProperty=t.DeviceBase=t.TYPES_VERSION=void 0,t.TYPES_VERSION="0.5.48";var r,s,n,i,o,a,c,u,l,d,h,p,f,g,m,y,b,v;t.DeviceBase=class{},function(e){e.id="id",e.info="info",e.interfaces="interfaces",e.mixins="mixins",e.name="name",e.nativeId="nativeId",e.pluginId="pluginId",e.providedInterfaces="providedInterfaces",e.providedName="providedName",e.providedRoom="providedRoom",e.providedType="providedType",e.providerId="providerId",e.room="room",e.type="type",e.scryptedRuntimeArguments="scryptedRuntimeArguments",e.on="on",e.brightness="brightness",e.colorTemperature="colorTemperature",e.rgb="rgb",e.hsv="hsv",e.buttons="buttons",e.sensors="sensors",e.running="running",e.paused="paused",e.docked="docked",e.temperatureSetting="temperatureSetting",e.temperature="temperature",e.temperatureUnit="temperatureUnit",e.humidity="humidity",e.resolution="resolution",e.audioVolumes="audioVolumes",e.recordingActive="recordingActive",e.ptzCapabilities="ptzCapabilities",e.lockState="lockState",e.entryOpen="entryOpen",e.batteryLevel="batteryLevel",e.chargeState="chargeState",e.online="online",e.fromMimeType="fromMimeType",e.toMimeType="toMimeType",e.converters="converters",e.binaryState="binaryState",e.tampered="tampered",e.sleeping="sleeping",e.powerDetected="powerDetected",e.audioDetected="audioDetected",e.motionDetected="motionDetected",e.ambientLight="ambientLight",e.occupied="occupied",e.flooded="flooded",e.ultraviolet="ultraviolet",e.luminance="luminance",e.position="position",e.securitySystemState="securitySystemState",e.pm10Density="pm10Density",e.pm25Density="pm25Density",e.vocDensity="vocDensity",e.noxDensity="noxDensity",e.co2ppm="co2ppm",e.airQuality="airQuality",e.airPurifierState="airPurifierState",e.filterChangeIndication="filterChangeIndication",e.filterLifeLevel="filterLifeLevel",e.humiditySetting="humiditySetting",e.fan="fan",e.applicationInfo="applicationInfo",e.chatCompletionCapabilities="chatCompletionCapabilities",e.systemDevice="systemDevice"}(r||(t.ScryptedInterfaceProperty=r={})),function(e){e.listen="listen",e.probe="probe",e.setMixins="setMixins",e.setName="setName",e.setRoom="setRoom",e.setType="setType",e.getPluginJson="getPluginJson",e.turnOff="turnOff",e.turnOn="turnOn",e.setBrightness="setBrightness",e.getTemperatureMaxK="getTemperatureMaxK",e.getTemperatureMinK="getTemperatureMinK",e.setColorTemperature="setColorTemperature",e.setRgb="setRgb",e.setHsv="setHsv",e.pressButton="pressButton",e.sendNotification="sendNotification",e.start="start",e.stop="stop",e.pause="pause",e.resume="resume",e.dock="dock",e.setTemperature="setTemperature",e.setTemperatureUnit="setTemperatureUnit",e.getPictureOptions="getPictureOptions",e.takePicture="takePicture",e.getAudioStream="getAudioStream",e.setAudioVolumes="setAudioVolumes",e.startDisplay="startDisplay",e.stopDisplay="stopDisplay",e.getVideoStream="getVideoStream",e.getVideoStreamOptions="getVideoStreamOptions",e.getPrivacyMasks="getPrivacyMasks",e.setPrivacyMasks="setPrivacyMasks",e.getVideoTextOverlays="getVideoTextOverlays",e.setVideoTextOverlay="setVideoTextOverlay",e.getRecordingStream="getRecordingStream",e.getRecordingStreamCurrentTime="getRecordingStreamCurrentTime",e.getRecordingStreamOptions="getRecordingStreamOptions",e.getRecordingStreamThumbnail="getRecordingStreamThumbnail",e.deleteRecordingStream="deleteRecordingStream",e.setRecordingActive="setRecordingActive",e.ptzCommand="ptzCommand",e.getRecordedEvents="getRecordedEvents",e.getVideoClip="getVideoClip",e.getVideoClips="getVideoClips",e.getVideoClipThumbnail="getVideoClipThumbnail",e.removeVideoClips="removeVideoClips",e.setVideoStreamOptions="setVideoStreamOptions",e.startIntercom="startIntercom",e.stopIntercom="stopIntercom",e.lock="lock",e.unlock="unlock",e.addPassword="addPassword",e.getPasswords="getPasswords",e.removePassword="removePassword",e.activate="activate",e.deactivate="deactivate",e.isReversible="isReversible",e.closeEntry="closeEntry",e.openEntry="openEntry",e.getDevice="getDevice",e.releaseDevice="releaseDevice",e.adoptDevice="adoptDevice",e.discoverDevices="discoverDevices",e.createDevice="createDevice",e.getCreateDeviceSettings="getCreateDeviceSettings",e.reboot="reboot",e.getRefreshFrequency="getRefreshFrequency",e.refresh="refresh",e.getMediaStatus="getMediaStatus",e.load="load",e.seek="seek",e.skipNext="skipNext",e.skipPrevious="skipPrevious",e.convert="convert",e.convertMedia="convertMedia",e.getSettings="getSettings",e.putSetting="putSetting",e.armSecuritySystem="armSecuritySystem",e.disarmSecuritySystem="disarmSecuritySystem",e.setAirPurifierState="setAirPurifierState",e.getReadmeMarkdown="getReadmeMarkdown",e.getOauthUrl="getOauthUrl",e.onOauthCallback="onOauthCallback",e.canMixin="canMixin",e.getMixin="getMixin",e.releaseMixin="releaseMixin",e.onRequest="onRequest",e.onConnection="onConnection",e.onPush="onPush",e.run="run",e.eval="eval",e.loadScripts="loadScripts",e.saveScript="saveScript",e.forkInterface="forkInterface",e.getDetectionInput="getDetectionInput",e.getObjectTypes="getObjectTypes",e.detectObjects="detectObjects",e.generateObjectDetections="generateObjectDetections",e.getDetectionModel="getDetectionModel",e.setHumidity="setHumidity",e.setFan="setFan",e.startRTCSignalingSession="startRTCSignalingSession",e.createRTCSignalingSession="createRTCSignalingSession",e.getScryptedUserAccessControl="getScryptedUserAccessControl",e.generateVideoFrames="generateVideoFrames",e.connectStream="connectStream",e.getTTYSettings="getTTYSettings",e.getChatCompletion="getChatCompletion",e.streamChatCompletion="streamChatCompletion",e.getTextEmbedding="getTextEmbedding",e.getImageEmbedding="getImageEmbedding",e.callLLMTool="callLLMTool",e.getLLMTools="getLLMTools"}(s||(t.ScryptedInterfaceMethod=s={})),t.ScryptedInterfaceDescriptors={ScryptedDevice:{name:"ScryptedDevice",methods:["listen","probe","setMixins","setName","setRoom","setType"],properties:["id","info","interfaces","mixins","name","nativeId","pluginId","providedInterfaces","providedName","providedRoom","providedType","providerId","room","type"]},ScryptedPlugin:{name:"ScryptedPlugin",methods:["getPluginJson"],properties:[]},ScryptedPluginRuntime:{name:"ScryptedPluginRuntime",methods:[],properties:["scryptedRuntimeArguments"]},OnOff:{name:"OnOff",methods:["turnOff","turnOn"],properties:["on"]},Brightness:{name:"Brightness",methods:["setBrightness"],properties:["brightness"]},ColorSettingTemperature:{name:"ColorSettingTemperature",methods:["getTemperatureMaxK","getTemperatureMinK","setColorTemperature"],properties:["colorTemperature"]},ColorSettingRgb:{name:"ColorSettingRgb",methods:["setRgb"],properties:["rgb"]},ColorSettingHsv:{name:"ColorSettingHsv",methods:["setHsv"],properties:["hsv"]},Buttons:{name:"Buttons",methods:[],properties:["buttons"]},PressButtons:{name:"PressButtons",methods:["pressButton"],properties:[]},Sensors:{name:"Sensors",methods:[],properties:["sensors"]},Notifier:{name:"Notifier",methods:["sendNotification"],properties:[]},StartStop:{name:"StartStop",methods:["start","stop"],properties:["running"]},Pause:{name:"Pause",methods:["pause","resume"],properties:["paused"]},Dock:{name:"Dock",methods:["dock"],properties:["docked"]},TemperatureSetting:{name:"TemperatureSetting",methods:["setTemperature"],properties:["temperatureSetting"]},Thermometer:{name:"Thermometer",methods:["setTemperatureUnit"],properties:["temperature","temperatureUnit"]},HumiditySensor:{name:"HumiditySensor",methods:[],properties:["humidity"]},Camera:{name:"Camera",methods:["getPictureOptions","takePicture"],properties:[]},Resolution:{name:"Resolution",methods:[],properties:["resolution"]},Microphone:{name:"Microphone",methods:["getAudioStream"],properties:[]},AudioVolumeControl:{name:"AudioVolumeControl",methods:["setAudioVolumes"],properties:["audioVolumes"]},Display:{name:"Display",methods:["startDisplay","stopDisplay"],properties:[]},VideoCamera:{name:"VideoCamera",methods:["getVideoStream","getVideoStreamOptions"],properties:[]},VideoCameraMask:{name:"VideoCameraMask",methods:["getPrivacyMasks","setPrivacyMasks"],properties:[]},VideoTextOverlays:{name:"VideoTextOverlays",methods:["getVideoTextOverlays","setVideoTextOverlay"],properties:[]},VideoRecorder:{name:"VideoRecorder",methods:["getRecordingStream","getRecordingStreamCurrentTime","getRecordingStreamOptions","getRecordingStreamThumbnail"],properties:["recordingActive"]},VideoRecorderManagement:{name:"VideoRecorderManagement",methods:["deleteRecordingStream","setRecordingActive"],properties:[]},PanTiltZoom:{name:"PanTiltZoom",methods:["ptzCommand"],properties:["ptzCapabilities"]},EventRecorder:{name:"EventRecorder",methods:["getRecordedEvents"],properties:[]},VideoClips:{name:"VideoClips",methods:["getVideoClip","getVideoClips","getVideoClipThumbnail","removeVideoClips"],properties:[]},VideoCameraConfiguration:{name:"VideoCameraConfiguration",methods:["setVideoStreamOptions"],properties:[]},Intercom:{name:"Intercom",methods:["startIntercom","stopIntercom"],properties:[]},Lock:{name:"Lock",methods:["lock","unlock"],properties:["lockState"]},PasswordStore:{name:"PasswordStore",methods:["addPassword","getPasswords","removePassword"],properties:[]},Scene:{name:"Scene",methods:["activate","deactivate","isReversible"],properties:[]},Entry:{name:"Entry",methods:["closeEntry","openEntry"],properties:[]},EntrySensor:{name:"EntrySensor",methods:[],properties:["entryOpen"]},DeviceProvider:{name:"DeviceProvider",methods:["getDevice","releaseDevice"],properties:[]},DeviceDiscovery:{name:"DeviceDiscovery",methods:["adoptDevice","discoverDevices"],properties:[]},DeviceCreator:{name:"DeviceCreator",methods:["createDevice","getCreateDeviceSettings"],properties:[]},Battery:{name:"Battery",methods:[],properties:["batteryLevel"]},Charger:{name:"Charger",methods:[],properties:["chargeState"]},Reboot:{name:"Reboot",methods:["reboot"],properties:[]},Refresh:{name:"Refresh",methods:["getRefreshFrequency","refresh"],properties:[]},MediaPlayer:{name:"MediaPlayer",methods:["getMediaStatus","load","seek","skipNext","skipPrevious"],properties:[]},Online:{name:"Online",methods:[],properties:["online"]},BufferConverter:{name:"BufferConverter",methods:["convert"],properties:["fromMimeType","toMimeType"]},MediaConverter:{name:"MediaConverter",methods:["convertMedia"],properties:["converters"]},Settings:{name:"Settings",methods:["getSettings","putSetting"],properties:[]},BinarySensor:{name:"BinarySensor",methods:[],properties:["binaryState"]},TamperSensor:{name:"TamperSensor",methods:[],properties:["tampered"]},Sleep:{name:"Sleep",methods:[],properties:["sleeping"]},PowerSensor:{name:"PowerSensor",methods:[],properties:["powerDetected"]},AudioSensor:{name:"AudioSensor",methods:[],properties:["audioDetected"]},MotionSensor:{name:"MotionSensor",methods:[],properties:["motionDetected"]},AmbientLightSensor:{name:"AmbientLightSensor",methods:[],properties:["ambientLight"]},OccupancySensor:{name:"OccupancySensor",methods:[],properties:["occupied"]},FloodSensor:{name:"FloodSensor",methods:[],properties:["flooded"]},UltravioletSensor:{name:"UltravioletSensor",methods:[],properties:["ultraviolet"]},LuminanceSensor:{name:"LuminanceSensor",methods:[],properties:["luminance"]},PositionSensor:{name:"PositionSensor",methods:[],properties:["position"]},SecuritySystem:{name:"SecuritySystem",methods:["armSecuritySystem","disarmSecuritySystem"],properties:["securitySystemState"]},PM10Sensor:{name:"PM10Sensor",methods:[],properties:["pm10Density"]},PM25Sensor:{name:"PM25Sensor",methods:[],properties:["pm25Density"]},VOCSensor:{name:"VOCSensor",methods:[],properties:["vocDensity"]},NOXSensor:{name:"NOXSensor",methods:[],properties:["noxDensity"]},CO2Sensor:{name:"CO2Sensor",methods:[],properties:["co2ppm"]},AirQualitySensor:{name:"AirQualitySensor",methods:[],properties:["airQuality"]},AirPurifier:{name:"AirPurifier",methods:["setAirPurifierState"],properties:["airPurifierState"]},FilterMaintenance:{name:"FilterMaintenance",methods:[],properties:["filterChangeIndication","filterLifeLevel"]},Readme:{name:"Readme",methods:["getReadmeMarkdown"],properties:[]},OauthClient:{name:"OauthClient",methods:["getOauthUrl","onOauthCallback"],properties:[]},MixinProvider:{name:"MixinProvider",methods:["canMixin","getMixin","releaseMixin"],properties:[]},HttpRequestHandler:{name:"HttpRequestHandler",methods:["onRequest"],properties:[]},EngineIOHandler:{name:"EngineIOHandler",methods:["onConnection"],properties:[]},PushHandler:{name:"PushHandler",methods:["onPush"],properties:[]},Program:{name:"Program",methods:["run"],properties:[]},Scriptable:{name:"Scriptable",methods:["eval","loadScripts","saveScript"],properties:[]},ClusterForkInterface:{name:"ClusterForkInterface",methods:["forkInterface"],properties:[]},ObjectDetector:{name:"ObjectDetector",methods:["getDetectionInput","getObjectTypes"],properties:[]},ObjectDetection:{name:"ObjectDetection",methods:["detectObjects","generateObjectDetections","getDetectionModel"],properties:[]},ObjectDetectionPreview:{name:"ObjectDetectionPreview",methods:[],properties:[]},ObjectDetectionGenerator:{name:"ObjectDetectionGenerator",methods:[],properties:[]},HumiditySetting:{name:"HumiditySetting",methods:["setHumidity"],properties:["humiditySetting"]},Fan:{name:"Fan",methods:["setFan"],properties:["fan"]},RTCSignalingChannel:{name:"RTCSignalingChannel",methods:["startRTCSignalingSession"],properties:[]},RTCSignalingClient:{name:"RTCSignalingClient",methods:["createRTCSignalingSession"],properties:[]},LauncherApplication:{name:"LauncherApplication",methods:[],properties:["applicationInfo"]},ScryptedUser:{name:"ScryptedUser",methods:["getScryptedUserAccessControl"],properties:[]},VideoFrameGenerator:{name:"VideoFrameGenerator",methods:["generateVideoFrames"],properties:[]},StreamService:{name:"StreamService",methods:["connectStream"],properties:[]},TTY:{name:"TTY",methods:[],properties:[]},TTYSettings:{name:"TTYSettings",methods:["getTTYSettings"],properties:[]},ChatCompletion:{name:"ChatCompletion",methods:["getChatCompletion","streamChatCompletion"],properties:["chatCompletionCapabilities"]},TextEmbedding:{name:"TextEmbedding",methods:["getTextEmbedding"],properties:[]},ImageEmbedding:{name:"ImageEmbedding",methods:["getImageEmbedding"],properties:[]},LLMTools:{name:"LLMTools",methods:["callLLMTool","getLLMTools"],properties:[]},ScryptedSystemDevice:{name:"ScryptedSystemDevice",methods:[],properties:["systemDevice"]},ScryptedDeviceCreator:{name:"ScryptedDeviceCreator",methods:[],properties:[]},ScryptedSettings:{name:"ScryptedSettings",methods:[],properties:[]}},function(e){e.Builtin="Builtin",e.Internal="Internal",e.Camera="Camera",e.Fan="Fan",e.Light="Light",e.Switch="Switch",e.Outlet="Outlet",e.Sensor="Sensor",e.Scene="Scene",e.Program="Program",e.Automation="Automation",e.Vacuum="Vacuum",e.Notifier="Notifier",e.Thermostat="Thermostat",e.Lock="Lock",e.PasswordControl="PasswordControl",e.Display="Display",e.SmartDisplay="SmartDisplay",e.Speaker="Speaker",e.SmartSpeaker="SmartSpeaker",e.RemoteDesktop="RemoteDesktop",e.Event="Event",e.Entry="Entry",e.Garage="Garage",e.DeviceProvider="DeviceProvider",e.DataSource="DataSource",e.API="API",e.Buttons="Buttons",e.Doorbell="Doorbell",e.Irrigation="Irrigation",e.Valve="Valve",e.Person="Person",e.SecuritySystem="SecuritySystem",e.WindowCovering="WindowCovering",e.Siren="Siren",e.AirPurifier="AirPurifier",e.Internet="Internet",e.Network="Network",e.Bridge="Bridge",e.LLM="LLM",e.Unknown="Unknown"}(n||(t.ScryptedDeviceType=n={})),function(e){e.Humidify="Humidify",e.Dehumidify="Dehumidify",e.Auto="Auto",e.Off="Off"}(i||(t.HumidityMode=i={})),function(e){e.Auto="Auto",e.Manual="Manual"}(o||(t.FanMode=o={})),function(e){e.C="C",e.F="F"}(a||(t.TemperatureUnit=a={})),function(e){e.Off="Off",e.Cool="Cool",e.Heat="Heat",e.HeatCool="HeatCool",e.Auto="Auto",e.FanOnly="FanOnly",e.Purifier="Purifier",e.Eco="Eco",e.Dry="Dry",e.On="On"}(c||(t.ThermostatMode=c={})),function(e){e.Absolute="Absolute",e.Relative="Relative",e.Continuous="Continuous",e.Preset="Preset",e.Home="Home"}(u||(t.PanTiltZoomMovement=u={})),function(e){e.Locked="Locked",e.Unlocked="Unlocked",e.Jammed="Jammed"}(l||(t.LockState=l={})),function(e){e.Trickle="trickle",e.Charging="charging",e.NotCharging="not-charging"}(d||(t.ChargeState=d={})),function(e){e.Inactive="Inactive",e.Idle="Idle",e.Active="Active",e.ActiveNightMode="ActiveNightMode"}(h||(t.AirPurifierStatus=h={})),function(e){e.Manual="Manual",e.Automatic="Automatic"}(p||(t.AirPurifierMode=p={})),function(e){e.Unknown="Unknown",e.Excellent="Excellent",e.Good="Good",e.Fair="Fair",e.Inferior="Inferior",e.Poor="Poor"}(f||(t.AirQuality=f={})),function(e){e.Disarmed="Disarmed",e.HomeArmed="HomeArmed",e.AwayArmed="AwayArmed",e.NightArmed="NightArmed"}(g||(t.SecuritySystemMode=g={})),function(e){e.Sensor="Sensor",e.Occupied="Occupied",e.Time="Time",e.Error="Error"}(m||(t.SecuritySystemObstruction=m={})),function(e){e.Idle="Idle",e.Playing="Playing",e.Paused="Paused",e.Buffering="Buffering"}(y||(t.MediaPlayerState=y={})),function(e){e.ScryptedDevice="ScryptedDevice",e.ScryptedPlugin="ScryptedPlugin",e.ScryptedPluginRuntime="ScryptedPluginRuntime",e.OnOff="OnOff",e.Brightness="Brightness",e.ColorSettingTemperature="ColorSettingTemperature",e.ColorSettingRgb="ColorSettingRgb",e.ColorSettingHsv="ColorSettingHsv",e.Buttons="Buttons",e.PressButtons="PressButtons",e.Sensors="Sensors",e.Notifier="Notifier",e.StartStop="StartStop",e.Pause="Pause",e.Dock="Dock",e.TemperatureSetting="TemperatureSetting",e.Thermometer="Thermometer",e.HumiditySensor="HumiditySensor",e.Camera="Camera",e.Resolution="Resolution",e.Microphone="Microphone",e.AudioVolumeControl="AudioVolumeControl",e.Display="Display",e.VideoCamera="VideoCamera",e.VideoCameraMask="VideoCameraMask",e.VideoTextOverlays="VideoTextOverlays",e.VideoRecorder="VideoRecorder",e.VideoRecorderManagement="VideoRecorderManagement",e.PanTiltZoom="PanTiltZoom",e.EventRecorder="EventRecorder",e.VideoClips="VideoClips",e.VideoCameraConfiguration="VideoCameraConfiguration",e.Intercom="Intercom",e.Lock="Lock",e.PasswordStore="PasswordStore",e.Scene="Scene",e.Entry="Entry",e.EntrySensor="EntrySensor",e.DeviceProvider="DeviceProvider",e.DeviceDiscovery="DeviceDiscovery",e.DeviceCreator="DeviceCreator",e.Battery="Battery",e.Charger="Charger",e.Reboot="Reboot",e.Refresh="Refresh",e.MediaPlayer="MediaPlayer",e.Online="Online",e.BufferConverter="BufferConverter",e.MediaConverter="MediaConverter",e.Settings="Settings",e.BinarySensor="BinarySensor",e.TamperSensor="TamperSensor",e.Sleep="Sleep",e.PowerSensor="PowerSensor",e.AudioSensor="AudioSensor",e.MotionSensor="MotionSensor",e.AmbientLightSensor="AmbientLightSensor",e.OccupancySensor="OccupancySensor",e.FloodSensor="FloodSensor",e.UltravioletSensor="UltravioletSensor",e.LuminanceSensor="LuminanceSensor",e.PositionSensor="PositionSensor",e.SecuritySystem="SecuritySystem",e.PM10Sensor="PM10Sensor",e.PM25Sensor="PM25Sensor",e.VOCSensor="VOCSensor",e.NOXSensor="NOXSensor",e.CO2Sensor="CO2Sensor",e.AirQualitySensor="AirQualitySensor",e.AirPurifier="AirPurifier",e.FilterMaintenance="FilterMaintenance",e.Readme="Readme",e.OauthClient="OauthClient",e.MixinProvider="MixinProvider",e.HttpRequestHandler="HttpRequestHandler",e.EngineIOHandler="EngineIOHandler",e.PushHandler="PushHandler",e.Program="Program",e.Scriptable="Scriptable",e.ClusterForkInterface="ClusterForkInterface",e.ObjectDetector="ObjectDetector",e.ObjectDetection="ObjectDetection",e.ObjectDetectionPreview="ObjectDetectionPreview",e.ObjectDetectionGenerator="ObjectDetectionGenerator",e.HumiditySetting="HumiditySetting",e.Fan="Fan",e.RTCSignalingChannel="RTCSignalingChannel",e.RTCSignalingClient="RTCSignalingClient",e.LauncherApplication="LauncherApplication",e.ScryptedUser="ScryptedUser",e.VideoFrameGenerator="VideoFrameGenerator",e.StreamService="StreamService",e.TTY="TTY",e.TTYSettings="TTYSettings",e.ChatCompletion="ChatCompletion",e.TextEmbedding="TextEmbedding",e.ImageEmbedding="ImageEmbedding",e.LLMTools="LLMTools",e.ScryptedSystemDevice="ScryptedSystemDevice",e.ScryptedDeviceCreator="ScryptedDeviceCreator",e.ScryptedSettings="ScryptedSettings"}(b||(t.ScryptedInterface=b={})),function(e){e.Url="text/x-uri",e.InsecureLocalUrl="text/x-insecure-local-uri",e.LocalUrl="text/x-local-uri",e.ServerId="text/x-server-id",e.PushEndpoint="text/x-push-endpoint",e.SchemePrefix="x-scrypted/x-scrypted-scheme-",e.MediaStreamUrl="text/x-media-url",e.MediaObject="x-scrypted/x-scrypted-media-object",e.RequestMediaObject="x-scrypted/x-scrypted-request-media-object",e.RequestMediaStream="x-scrypted/x-scrypted-request-stream",e.MediaStreamFeedback="x-scrypted/x-media-stream-feedback",e.FFmpegInput="x-scrypted/x-ffmpeg-input",e.FFmpegTranscodeStream="x-scrypted/x-ffmpeg-transcode-stream",e.RTCSignalingChannel="x-scrypted/x-scrypted-rtc-signaling-channel",e.RTCSignalingSession="x-scrypted/x-scrypted-rtc-signaling-session",e.RTCConnectionManagement="x-scrypted/x-scrypted-rtc-connection-management",e.Image="x-scrypted/x-scrypted-image"}(v||(t.ScryptedMimeTypes=v={}))},9851:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Message=void 0,t.parseMessage=function(e,t){if(e.length<c.HEADER_LENGTH)return;const r=e.readUint16BE(2);if(e.length!==c.HEADER_LENGTH+r)return;const s=e.readUint16BE(0),n=Buffer.from(e.slice(c.HEADER_LENGTH-12,c.HEADER_LENGTH)),i=new a.AttributeRepository;for(let r=c.HEADER_LENGTH;r<=e.length-4;){const s=e.readUInt16BE(r),o=e.readUInt16BE(r+2),c=e.slice(r+4,r+4+o),u=4*Math.floor((o+3)/4)-o;if(Object.keys(a.ATTRIBUTES_BY_TYPE).includes(s.toString())){const[,o,,u]=a.ATTRIBUTES_BY_TYPE[s];if(u.name===a.unpackXorAddress.name?i.setAttribute(o,u(c,n)):i.setAttribute(o,u(c)),"FINGERPRINT"===o){const t=d(e.slice(0,r));if(i.getAttributeValue("FINGERPRINT")!==t)return}else if("MESSAGE-INTEGRITY"===o&&t){const s=h(e.slice(0,r),t),n=i.getAttributeValue("MESSAGE-INTEGRITY");if(!s.equals(n))return}}r+=4+o+u}const o=i.getAttributes();return i.clear(),new u(16111&s,272&s,n,o)},t.paddingLength=function(e){const t=e%4;return 0===t?0:4-t};const n=r(6982),i=s(r(7187)),o=r(1227),a=r(4255),c=r(4687);class u extends a.AttributeRepository{constructor(e,t,r=(0,o.randomTransactionId)(),s=[]){super(s),this.messageMethod=e,this.messageClass=t,this.transactionId=r}toJSON(){return this.json}get json(){return{messageMethod:c.methods[this.messageMethod],messageClass:c.classes[this.messageClass],attributes:this.attributes}}get transactionIdHex(){return this.transactionId.toString("hex")}get bytes(){let e=Buffer.from([]);for(const t of this.attributesKeys){const r=this.getAttributeValue(t),[s,,n]=a.ATTRIBUTES_BY_NAME[t],i=n.name===a.packXorAddress.name?n(r,this.transactionId):n(r),o=i.length,c=4*Math.floor((o+3)/4)-o,u=Buffer.alloc(4);u.writeUInt16BE(s,0),u.writeUInt16BE(o,2),e=Buffer.concat([e,u,i,Buffer.alloc(c,0)])}const t=Buffer.alloc(8);return t.writeUInt16BE(this.messageMethod|this.messageClass,0),t.writeUInt16BE(e.length,2),t.writeUInt32BE(c.COOKIE,4),Buffer.concat([t,this.transactionId,e])}addMessageIntegrity(e){return this.setAttribute("MESSAGE-INTEGRITY",this.messageIntegrity(e)),this}messageIntegrity(e){const t=l(this.bytes,this.bytes.length-c.HEADER_LENGTH+c.INTEGRITY_LENGTH);return Buffer.from((0,n.createHmac)("sha1",e).update(t).digest("hex"),"hex")}addFingerprint(){this.setAttribute("FINGERPRINT",d(this.bytes))}}t.Message=u;const l=(e,t)=>{const r=Buffer.alloc(e.length);return e.copy(r,0,0,2),r.writeUInt16BE(t,2),e.copy(r,4,4),r};function d(e){const t=l(e,e.length-c.HEADER_LENGTH+c.FINGERPRINT_LENGTH),r=(0,i.default)(t),s=Buffer.alloc(4);s.writeInt32BE(c.FINGERPRINT_XOR,0);return(0,o.bufferXor)(r,s).readUInt32BE(0)}function h(e,t){const r=l(e,e.length-c.HEADER_LENGTH+c.INTEGRITY_LENGTH);return Buffer.from((0,n.createHmac)("sha1",t).update(r).digest("hex"),"hex")}},9896:e=>{"use strict";e.exports=require("fs")},9919:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientKeyExchange=void 0;const s=r(6353),n=r(7077),i=r(9602);class o{constructor(e){this.publicKey=e,this.msgType=i.HandshakeType.client_key_exchange_16}static createEmpty(){return new o(void 0)}static deSerialize(e){const t=(0,s.decode)(e,o.spec);return new o(...Object.values(t))}serialize(){const e=(0,s.encode)(this,o.spec).slice();return Buffer.from(e)}toFragment(){const e=this.serialize();return new n.FragmentedHandshake(this.msgType,e.length,this.messageSeq,0,e.length,e)}}t.ClientKeyExchange=o,o.spec={publicKey:s.types.buffer(s.types.uint8)}},9925:e=>{"use strict";e.exports=function(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}},9981:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RECONFIG_PARAM_BY_TYPES=t.ReconfigResponseParam=t.reconfigResult=t.StreamAddOutgoingParam=t.OutgoingSSNResetRequestParam=void 0;const s=r(4694);class n{constructor(e,t,r,s){this.requestSequence=e,this.responseSequence=t,this.lastTsn=r,this.streams=s}get type(){return n.type}get bytes(){const e=Buffer.from(s.jspack.Pack("!LLL",[this.requestSequence,this.responseSequence,this.lastTsn]));return Buffer.concat([e,...this.streams.map((e=>Buffer.from(s.jspack.Pack("!H",[e]))))])}static parse(e){const[t,r,i]=s.jspack.Unpack("!LLL",e),o=[];for(let t=12;t<e.length;t+=2)o.push(s.jspack.Unpack("!H",e.slice(t))[0]);return new n(t,r,i,o)}}t.OutgoingSSNResetRequestParam=n,n.type=13;class i{constructor(e,t){this.requestSequence=e,this.newStreams=t}get type(){return i.type}get bytes(){return Buffer.from(s.jspack.Pack("!LHH",[this.requestSequence,this.newStreams,0]))}static parse(e){const[t,r]=s.jspack.Unpack("!LHH",e);return new i(t,r)}}t.StreamAddOutgoingParam=i,i.type=17,t.reconfigResult={ReconfigResultSuccessPerformed:1,BadSequenceNumber:5};class o{constructor(e,t){this.responseSequence=e,this.result=t}get type(){return o.type}get bytes(){return Buffer.from(s.jspack.Pack("!LL",[this.responseSequence,this.result]))}static parse(e){const[t,r]=s.jspack.Unpack("!LL",e);return new o(t,r)}}t.ReconfigResponseParam=o,o.type=16,t.RECONFIG_PARAM_BY_TYPES={13:n,16:o,17:i}}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,r),i.exports}r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s=r(431),n=exports="undefined"==typeof exports?{}:exports;for(var i in s)n[i]=s[i];s.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();
//# sourceMappingURL=main.nodejs.js.map